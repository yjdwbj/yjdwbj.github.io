<!DOCTYPE html>






  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.2.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.2.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="最是人间留不住,朱颜辞镜花辞树">
<meta property="og:type" content="website">
<meta property="og:title" content="Sunrise 博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Sunrise 博客">
<meta property="og:description" content="最是人间留不住,朱颜辞镜花辞树">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sunrise 博客">
<meta name="twitter:description" content="最是人间留不住,朱颜辞镜花辞树">






  <link rel="canonical" href="http://yoursite.com/page/2/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Sunrise 博客</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Sunrise 博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/09/Django-uWsgi-nginx-https-完全配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/09/Django-uWsgi-nginx-https-完全配置/" itemprop="url">
                  Django+uWsgi+nginx+https 完全配置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-11-09 00:00:00" itemprop="dateCreated datePublished" datetime="2016-11-09T00:00:00+08:00">2016-11-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2016-12-13 00:00:00" itemprop="dateModified" datetime="2016-12-13T00:00:00+08:00">2016-12-13</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/笔记/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h6 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h6><p>-　<a href="https://letsencrypt.org/" target="_blank" rel="external">https://letsencrypt.org/</a></p>
<hr>
<h4 id="编译Nginx"><a href="#编译Nginx" class="headerlink" title="编译Nginx"></a>编译Nginx</h4><p>*　这里要使用<code>http v2</code>所以nginx版要大于<code>1.9.4</code>,nginx 主要用这里的WEB前端反向代理.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># apt-get install libpcre3-dev libssl-dev  zlib1g-dev libzip-dev</span></div><div class="line"><span class="comment"># ./configure --with-http_v2_module --with-http_ssl_module --with-threads --with-poll_module --with-file_aio --user=nginx --group=nginx --with-http_gzip_module --with-stream --with-stream_ssl_module --with-pcre</span></div></pre></td></tr></table></figure>
<hr>
<h3 id="申请Let’-Encrypt-证书"><a href="#申请Let’-Encrypt-证书" class="headerlink" title="申请Let’ Encrypt 证书"></a>申请Let’ Encrypt 证书</h3><ul>
<li>Let’s Encrypt 是由互联网安全研究小组（ISRG，一个公益组织）提供的服务。主要赞助商包括电子前哨基金会，Mozilla基金会，Akamai以及思科。</li>
</ul>
<ul>
<li>这里参照<a href="https://certbot.eff.org/#debianjessie-nginx" target="_blank" rel="external">Certbot</a>安装相关的客户端程序.根据自已的域创建一个配置文件,用于自动请求证书.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cat /etc/letsencrypt/configs/www.example.com.conf </span></div><div class="line">domains = www.example.com</div><div class="line">rsa-key-size = 2048</div><div class="line">email = yjdwbj@gmail.com</div><div class="line">text = True</div><div class="line"></div><div class="line">authenticator = standalone</div><div class="line"></div><div class="line">webroot-path = /opt/www</div></pre></td></tr></table></figure>
<hr>
<h3 id="nginx-配置"><a href="#nginx-配置" class="headerlink" title="nginx 配置"></a>nginx 配置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cat /usr/local/nginx/conf/nginx.conf | grep -v '^$' | grep -v '#'</span></div><div class="line">worker_processes 8;  </div><div class="line">worker_rlimit_nofile 1048576;</div><div class="line">events &#123; </div><div class="line">    use epoll;</div><div class="line">    multi_accept on; </div><div class="line">    worker_connections  65535;</div><div class="line">&#125;</div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line">    sendfile        on;</div><div class="line">    tcp_nopush     on;</div><div class="line">    tcp_nodelay on;</div><div class="line">    reset_timedout_connection on;</div><div class="line">    client_body_timeout 10;</div><div class="line">    send_timeout 2;</div><div class="line">    keepalive_timeout  30;</div><div class="line">    keepalive_requests 500000;</div><div class="line">    client_body_buffer_size      128k;</div><div class="line">    client_max_body_size         10m;</div><div class="line">    client_header_buffer_size    8k;</div><div class="line">    large_client_header_buffers  16 64k;</div><div class="line">    output_buffers               1 32k;</div><div class="line">    postpone_output              1460;</div><div class="line">    gzip  on;</div><div class="line">    gzip_http_version 1.0;</div><div class="line">    gzip_proxied      any;</div><div class="line">    gzip_min_length   500;</div><div class="line">    gzip_disable      <span class="string">"MSIE [1-6]\."</span>;</div><div class="line">    gzip_types        text/plain text/xml text/css</div><div class="line">                      text/comma-separated-values</div><div class="line">                      text/javascript</div><div class="line">                      application/x-javascript</div><div class="line">                      application/atom+xml;</div><div class="line">    server &#123;</div><div class="line">        listen      443 ssl http2 ;</div><div class="line">        </div><div class="line">        server_name  ssl.example.com;</div><div class="line">       </div><div class="line">        <span class="comment">## 优化HTTPS设置</span></div><div class="line">        ssl_session_cache shared:SSL:200m;</div><div class="line">        ssl_session_timeout 1800m;</div><div class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</div><div class="line">        ssl_prefer_server_ciphers on;</div><div class="line">        add_header Strict-Transport-Security <span class="string">"max-age=31536000"</span> always;</div><div class="line">        ssl_ciphers AES128-SHA:DES-CBC3-SHA:AES128-SHA256:!ADH:!AECDH:!MD5;</div><div class="line"></div><div class="line">        <span class="comment"># 这里使用Let's Encrypt 的证书,免费值得信赖. 后面会讲如何申请与更新它.</span></div><div class="line">        ssl_certificate /etc/letsencrypt/live/exmaple.com/fullchain.pem;</div><div class="line">        ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;</div><div class="line">        ssl_trusted_certificate /etc/letsencrypt/live/example.com/fullchain.pem;</div><div class="line"></div><div class="line">        access_log  off;</div><div class="line">        location /static/ &#123;</div><div class="line">            <span class="built_in">alias</span> /home/www/mqtt_auth/static/;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">            include     uwsgi_params;</div><div class="line">            <span class="comment">#　这里把请求转发给uwsgi 处理.</span></div><div class="line">            uwsgi_pass  unix:///tmp/uwsgi.sock;</div><div class="line">        &#125;</div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="测试NGINX-HTTPS设置"><a href="#测试NGINX-HTTPS设置" class="headerlink" title="测试NGINX　HTTPS设置"></a>测试NGINX　HTTPS设置</h2><ul>
<li><h4 id="查看网站使用的证书"><a href="#查看网站使用的证书" class="headerlink" title="查看网站使用的证书"></a>查看网站使用的证书</h4></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">openssl s_client -connect  ftp.example.com:18090</div><div class="line">[...]</div><div class="line">Certificate chain</div><div class="line"> 0 s:/CN=ftp.example.com</div><div class="line">   i:/C=US/O=Let<span class="string">'s Encrypt/CN=Let'</span>s Encrypt Authority X3</div><div class="line"> 1 s:/C=US/O=Let<span class="string">'s Encrypt/CN=Let'</span>s Encrypt Authority X3</div><div class="line">   i:/O=Digital Signature Trust Co./CN=DST Root CA X3</div><div class="line">---</div><div class="line">Server certificate</div><div class="line">.... </div><div class="line">No client certificate CA names sent</div><div class="line">---</div><div class="line">SSL handshake has <span class="built_in">read</span> 2812 bytes and written 631 bytes</div><div class="line">---</div><div class="line">New, TLSv1/SSLv3, Cipher is AES128-SHA</div><div class="line">Server public key is 2048 bit</div><div class="line">Secure Renegotiation IS supported</div><div class="line">Compression: NONE</div><div class="line">Expansion: NONE</div><div class="line">SSL-Session:</div><div class="line">    Protocol  : TLSv1.2</div><div class="line">    Cipher    : AES128-SHA</div><div class="line">    Session-ID: 47AD316DA0733301D8E2C982BE52168749FF6272CA584466584DA39C28EC2FD9</div><div class="line">    Session-ID-ctx: </div><div class="line">    Master-Key: D2EA8F60B4E83D7CA91DD42CA176D6AB21608824C2A7631130291214E7092831B0D795B8E82085E7BCF2D5D32C7A06CA</div><div class="line">    Key-Arg   : None</div><div class="line">    PSK identity: None</div><div class="line">    PSK identity hint: None</div><div class="line">    SRP username: None</div><div class="line">    TLS session ticket lifetime hint: 600000 (seconds)</div><div class="line">    TLS session ticket:</div><div class="line">    0000 - 3a a1 7f 93 72 a6 d1 04<span class="_">-d</span>9 79 f7 ab 24 0d 17 94   :...r....y..$...</div><div class="line">    0010 - fa 68 1e e1 1c 6c b0 8f-04 cb ae ad 3a 16 68 b3   .h...l......:.h.</div><div class="line">    0020 - e4 1a 69 46 30 08 21 50-6f 1d c5 7e d5 77 a8 0c   ..iF0.!Po..~.w..</div><div class="line">    0030 - 66 74 82 f8 3d bb 2f 2a-43 71 65 f3 a9 d0 36 8e   ft..=./*Cqe...6.</div><div class="line">    0040 - 8b 57 d8 a3 4f 9d c8 42-89 7e 9e 27 bc 7d 7a 21   .W..O..B.~.<span class="string">'.&#125;z!</span></div><div class="line">    0050 - 5e fe 99 63 b7 20 9d c4-1a ad 80 16 4c cc 67 13   ^..c. ......L.g.</div><div class="line">    0060 - f1 7e cf 48 f6 ee c4 d6-dc 49 0b f1 c5 58 59 b2   .~.H.....I...XY.</div><div class="line">    0070 - 2b 4e 74 b6 05 74 b1 3c-68 72 b2 3a 92 3e 31 b9   +Nt..t.&lt;hr.:.&gt;1.</div><div class="line">    0080 - c6 99 20 7a 80 63 93 e8-e5 7c a5 be 7a 49 a9 43   .. z.c...|..zI.C</div><div class="line">    0090 - 08 df 34 18 d5 91 0c b0-1d 53 ca b3 24 ea 24 c5   ..4......S..$.$.</div><div class="line">    00a0 - c0 8f d0 74 76 3d 7d a0-e7 59 fe e7 87 57 68 8f   ...tv=&#125;..Y...Wh.</div><div class="line"></div><div class="line">    Start Time: 1481641417</div><div class="line">    Timeout   : 300 (sec)</div><div class="line">    Verify return code: 0 (ok)</div></pre></td></tr></table></figure>
<ul>
<li><h4 id="SSLScan"><a href="#SSLScan" class="headerlink" title="SSLScan"></a>SSLScan</h4></li>
</ul>
<p>*　根据不同的发行版安装sslcan , <code>apt-get install sslcan</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">$ sslscan -tlsall ftp.example.com:18090</div><div class="line">                   _</div><div class="line">           ___ ___| |___  ___ __ _ _ __</div><div class="line">          / __/ __| / __|/ __/ _` | <span class="string">'_ \</span></div><div class="line">          \__ \__ \ \__ \ (_| (_| | | | |</div><div class="line">          |___/___/_|___/\___\__,_|_| |_|</div><div class="line"></div><div class="line">                  Version 1.8.2</div><div class="line">             http://www.titania.co.uk</div><div class="line">        Copyright Ian Ventura-Whiting 2009</div><div class="line"></div><div class="line">Testing SSL server ftp.example.com on port 18090</div><div class="line"></div><div class="line">  Supported Server Cipher(s):</div><div class="line">    Failed    SSLv3  256 bits  ECDHE-RSA-AES256-GCM-SHA384</div><div class="line">    Failed    SSLv3  256 bits  ECDHE-ECDSA-AES256-GCM-SHA384</div><div class="line">    Failed    TLSv1  112 bits  SRP-DSS-3DES-EDE-CBC-SHA</div><div class="line">    Failed    TLSv1  112 bits  SRP-RSA-3DES-EDE-CBC-SHA</div><div class="line">    Accepted  TLSv1  112 bits  DES-CBC3-SHA</div><div class="line">    Failed    TLSv1  112 bits  PSK-3DES-EDE-CBC-SHA</div><div class="line">    Rejected  TLSv1  0 bits    ECDH-ECDSA-NULL-SHA</div><div class="line">    Failed    TLSv1  0 bits    NULL-SHA256</div><div class="line">    [...]</div><div class="line"></div><div class="line">  Prefered Server Cipher(s):</div><div class="line">    TLSv1  128 bits  AES128-SHA</div><div class="line"></div><div class="line">  SSL Certificate:</div><div class="line">    Version: 2</div><div class="line">    SerialCPS: http://cps.letsencrypt.org</div><div class="line">    [....]</div><div class="line">          User Notice:</div><div class="line">            Explicit Text: This Certificate may only be relied upon by Relying Parties and only in accordance with the Certificate Policy found at https://letsencrypt.org/repository/</div><div class="line"></div><div class="line">  Verify Certificate:</div><div class="line">    unable to get local issuer certificate</div></pre></td></tr></table></figure>
<ul>
<li><h4 id="NMAP-测试"><a href="#NMAP-测试" class="headerlink" title="NMAP 测试"></a>NMAP 测试</h4></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">$ nmap --script ssl-enum-ciphers -p 443 ssl.example.com</div><div class="line"></div><div class="line">Starting Nmap 6.47 ( http://nmap.org ) at 2016-12-13 23:13 CST</div><div class="line">Nmap scan report for ssl.example.com (18x.2x4.21.5x)</div><div class="line">Host is up (0.0063s latency).</div><div class="line">PORT    STATE SERVICE</div><div class="line">443/tcp open  https</div><div class="line">| ssl-enum-ciphers: </div><div class="line">|   TLSv1.0: </div><div class="line">|     ciphers: </div><div class="line">|       TLS_RSA_WITH_3DES_EDE_CBC_SHA - strong</div><div class="line">|       TLS_RSA_WITH_AES_128_CBC_SHA - strong</div><div class="line">|     compressors: </div><div class="line">|       NULL</div><div class="line">|   TLSv1.1: </div><div class="line">|     ciphers: </div><div class="line">|       TLS_RSA_WITH_3DES_EDE_CBC_SHA - strong</div><div class="line">|       TLS_RSA_WITH_AES_128_CBC_SHA - strong</div><div class="line">|     compressors: </div><div class="line">|       NULL</div><div class="line">|   TLSv1.2: </div><div class="line">|     ciphers: </div><div class="line">|       TLS_RSA_WITH_3DES_EDE_CBC_SHA - strong</div><div class="line">|       TLS_RSA_WITH_AES_128_CBC_SHA - strong</div><div class="line">|       TLS_RSA_WITH_AES_128_CBC_SHA256 - strong</div><div class="line">|     compressors: </div><div class="line">|       NULL</div><div class="line">|_  least strength: strong</div><div class="line"></div><div class="line">Nmap done: 1 IP address (1 host up) scanned in 0.27 seconds</div></pre></td></tr></table></figure>
<ul>
<li><h4 id="在线检测"><a href="#在线检测" class="headerlink" title="在线检测"></a>在线检测</h4></li>
</ul>
<p>*　可以通过<a href="https://www.ssllabs.com/ssltest/" target="_blank" rel="external">SSL Server Test</a>检测,生成评分报告与建议.</p>
<hr>
<hr>
<h2 id="Django-环境"><a href="#Django-环境" class="headerlink" title="Django 环境"></a>Django 环境</h2><p>*　安装virtualenv</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># pip install virtualenv</span></div><div class="line"></div><div class="line"><span class="comment"># cd /opt/www</span></div><div class="line"></div><div class="line"><span class="comment"># virtualenv pyenv</span></div><div class="line"></div><div class="line"><span class="comment"># source pyenv/bin/active</span></div><div class="line">　<span class="comment">#　这里通过pip安装项目要用的库.</span></div><div class="line">(pyenv) root@localhost:/opt/www<span class="comment">#  pip install django uwsgi</span></div></pre></td></tr></table></figure>
<ul>
<li><h4 id="Django-关键配置"><a href="#Django-关键配置" class="headerlink" title="Django 关键配置"></a>Django 关键配置</h4></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 使用Redis 保存django的会话.</span></div><div class="line">CACHES = &#123;</div><div class="line">    <span class="string">"default"</span>: &#123;</div><div class="line">        <span class="string">"BACKEND"</span>: <span class="string">"django_redis.cache.RedisCache"</span>,</div><div class="line">        <span class="string">"LOCATION"</span> : <span class="string">"unix://:f4e4821080ca489d3361a520fc2123495755559b45fb24323c5b02e79163e425@/var/run/redis/redis.sock?db=1"</span>,</div><div class="line">        <span class="string">"OPTIONS"</span>: &#123;</div><div class="line">            <span class="string">"DB"</span>:<span class="number">0</span>,</div><div class="line">            <span class="string">"PASSWORD"</span>:<span class="string">"f4e4821080ca489d3361a520fc2123495755559b45fb24323c5b02e79163e425"</span>,</div><div class="line">            <span class="string">"CONNECTION_POOL_KWARGS"</span>: &#123;<span class="string">"max_connections"</span>: <span class="number">65535</span>&#125;,</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">SESSION_ENGINE = <span class="string">"django.contrib.sessions.backends.cache"</span></div><div class="line">SESSION_CACHE_ALIAS = <span class="string">"default"</span></div><div class="line">PASSWORD_HASER=[</div><div class="line">        <span class="string">"django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher"</span>,</div><div class="line">        <span class="string">"django.contrib.auth.hashers.SHA1PasswordHasher"</span>,</div><div class="line">    ]</div><div class="line">INSTALLED_APPS = [</div><div class="line">    <span class="string">'django.contrib.admin'</span>,</div><div class="line">    <span class="string">'django.contrib.auth'</span>,</div><div class="line">    <span class="string">'django.contrib.contenttypes'</span>,</div><div class="line">    <span class="string">'django.contrib.sessions'</span>,</div><div class="line">    <span class="string">'django.contrib.messages'</span>,</div><div class="line">    <span class="string">'django.contrib.staticfiles'</span>,</div><div class="line">    <span class="string">'user_manager'</span>,</div><div class="line">]</div><div class="line">MIDDLEWARE = [</div><div class="line">    <span class="string">'django.middleware.security.SecurityMiddleware'</span>,</div><div class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</div><div class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</div><div class="line">    <span class="string">'django.middleware.csrf.CsrfViewMiddleware'</span>,</div><div class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</div><div class="line">    <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</div><div class="line">    <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</div><div class="line">]</div><div class="line">ROOT_URLCONF = <span class="string">'my_app.urls'</span></div><div class="line">TEMPLATES = [</div><div class="line">    &#123;</div><div class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.template.backends.django.DjangoTemplates'</span>,</div><div class="line">        <span class="string">'DIRS'</span>: [os.path.join(BASE_DIR),<span class="string">'templates'</span>],</div><div class="line">        <span class="string">'APP_DIRS'</span>: <span class="keyword">True</span>,</div><div class="line">        <span class="string">'OPTIONS'</span>: &#123;</div><div class="line">            <span class="string">'context_processors'</span>: [</div><div class="line">                <span class="string">'django.template.context_processors.debug'</span>,</div><div class="line">                <span class="string">'django.template.context_processors.request'</span>,</div><div class="line">                <span class="string">'django.contrib.auth.context_processors.auth'</span>,</div><div class="line">                <span class="string">'django.contrib.messages.context_processors.messages'</span>,</div><div class="line">            ],</div><div class="line">        &#125;,</div><div class="line">    &#125;,</div><div class="line">]</div><div class="line">WSGI_APPLICATION = <span class="string">'my_app.wsgi.application'</span></div><div class="line"></div><div class="line">* 配置连接接两个数据库</div><div class="line">DATABASES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;</div><div class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.postgresql_psycopg2'</span>,</div><div class="line">        <span class="string">'NAME'</span> : <span class="string">'testapp'</span>,</div><div class="line">        <span class="string">'USER'</span> :<span class="string">'testapp'</span>,</div><div class="line">        <span class="string">'PASSWORD'</span>:<span class="string">'testapp123'</span>,</div><div class="line">        <span class="string">'HOST'</span> : <span class="string">'127.0.0.1'</span>,</div><div class="line">        <span class="comment">## 端口这里可以指定数据库的端口,也可以是连接池的端口</span></div><div class="line">        <span class="string">'PORT'</span> : <span class="string">'5432'</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="string">'seconddb'</span>:&#123;</div><div class="line">        <span class="string">'ENGINE'</span>:<span class="string">'django.db.backends.postgresql_psycopg2'</span>,</div><div class="line">        <span class="string">'NAME'</span> : <span class="string">'otherdb'</span>,</div><div class="line">        <span class="string">'USER'</span> : <span class="string">'testapp'</span>,</div><div class="line">        <span class="string">'PASSWORD'</span>:<span class="string">'testapp123'</span>,</div><div class="line">        <span class="string">'HOST'</span>:<span class="string">'127.0.0.1'</span>,</div><div class="line">        <span class="string">'PORT'</span>:<span class="string">'5432'</span>,</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line">AUTH_PASSWORD_VALIDATORS = [</div><div class="line">    &#123;</div><div class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.UserAttributeSimilarityValidator'</span>,</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.MinimumLengthValidator'</span>,</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.CommonPasswordValidator'</span>,</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.NumericPasswordValidator'</span>,</div><div class="line">    &#125;,</div><div class="line">]</div><div class="line">LANGUAGE_CODE = <span class="string">'en-us'</span></div><div class="line">TIME_ZONE = <span class="string">'UTC'</span></div><div class="line">USE_I18N = <span class="keyword">True</span></div><div class="line">USE_L10N = <span class="keyword">True</span></div><div class="line">USE_TZ = <span class="keyword">True</span></div><div class="line">AUTO_LOGOUT_DELAY = <span class="number">1</span></div><div class="line">APPEND_SLASH=<span class="keyword">True</span></div><div class="line">STATICFILES_DIRS = (</div><div class="line">        os.path.join(BASE_DIR,<span class="string">'static'</span>),</div><div class="line">        )</div><div class="line">STATIC_ROOT = os.path.join(BASE_DIR)</div><div class="line">STATIC_URL = <span class="string">'/static/'</span></div></pre></td></tr></table></figure>
<hr>
<ul>
<li><h4 id="uWSGI配置"><a href="#uWSGI配置" class="headerlink" title="uWSGI配置"></a>uWSGI配置</h4></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">project = my_app</div><div class="line">base = /home/www</div><div class="line"><span class="built_in">chdir</span> = %(base)/%(project)</div><div class="line">module = %(project).wsgi:application</div><div class="line">uid = nginx</div><div class="line">gid = nginx</div><div class="line">listen = 65536</div><div class="line">master = <span class="literal">true</span></div><div class="line">virtualenv = /home/www/pyenv</div><div class="line">home = /home/www/pyenv</div><div class="line">master = <span class="literal">true</span></div><div class="line">cpu = affinity</div><div class="line">async = <span class="literal">true</span></div><div class="line">py-autoreload=<span class="literal">true</span></div><div class="line">processes = 88</div><div class="line">die-on-term = <span class="literal">true</span></div><div class="line"><span class="comment">#threads = 32</span></div><div class="line">max-requests = 65536</div><div class="line"><span class="comment">#socket = /tmp/uwsgi.sock</span></div><div class="line"><span class="comment">#http = 127.0.0.1:9090</span></div><div class="line"><span class="comment">#socket = 192.168.25.109:4599</span></div><div class="line"><span class="built_in">disable</span>-logging = <span class="literal">true</span> </div><div class="line">buffer-size =32768</div><div class="line">harakiri = 20</div><div class="line">chmod-socket = 664</div><div class="line">daemonize=/home/www/<span class="built_in">log</span>/uwsgi.log</div><div class="line">vcauum = <span class="literal">true</span></div></pre></td></tr></table></figure>
<h3 id="为Postgresql配置连接池"><a href="#为Postgresql配置连接池" class="headerlink" title="为Postgresql配置连接池"></a>为Postgresql配置连接池</h3><ul>
<li><strong>如果不为Postgresl配置连接池,程序会在高并发的情况下把数据库的连接全部用完</strong></li>
<li>参考链接<a href="https://pgbouncer.github.io/" target="_blank" rel="external">pgbouncer</a></li>
<li>下面设置很简单.更多高级功能后面挖掘.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># grep -v "^;" /etc/pgbouncer/pgbouncer.ini  | grep -v "^$"</span></div><div class="line">[databases]</div><div class="line"><span class="comment">## 下面这个连接信息必需与postgresql里设一样.就是说,postgresql 要有test_db数库名,test用户,它的密码是test123,....</span></div><div class="line">test_db = host=127.0.0.1 port=5432 user=<span class="built_in">test</span> password=<span class="built_in">test</span>123 client_encoding=UNICODE datestyle=ISO connect_query=<span class="string">'SELECT 1'</span></div><div class="line"></div><div class="line">[pgbouncer]</div><div class="line">pidfile = /var/run/postgresql/pgbouncer.pid</div><div class="line"><span class="comment">##  绑定所有地址</span></div><div class="line">listen_addr = *</div><div class="line">listen_port = 6432</div><div class="line"><span class="comment">## 通过unix　socket与postgresql 通信</span></div><div class="line">unix_socket_dir = /var/run/postgresql</div><div class="line">auth_type = md5</div><div class="line"></div><div class="line"><span class="comment">## 认证用户的信息,每行格式: "test" "test123"</span></div><div class="line">auth_file = /etc/pgbouncer/userlist.txt</div><div class="line">admin_users = admin</div><div class="line">pool_mode = transaction</div><div class="line">server_reset_query = DISCARD ALL</div><div class="line"></div><div class="line"><span class="comment">## 我测试到的一个比较理想的数值,过大过小对程序的并发都有影响.</span></div><div class="line">max_client_conn = 100</div><div class="line">default_pool_size = 20</div><div class="line">listen_backlog = 1024</div></pre></td></tr></table></figure>
<hr>
<ul>
<li><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4></li>
</ul>
<p>*　在网上看到好多人声称uWSGI与Nginx会达到很高的性能,我用这种配置组合,压测的数据很难看.　TPS  1K/sec.安装了连接池之后,虽然没有做读写分享,但是它的提升还是很大的.</p>
<hr>
<h3 id="谢谢打赏支持"><a href="#谢谢打赏支持" class="headerlink" title="谢谢打赏支持"></a>谢谢打赏支持</h3><ul>
<li>您的打赏将会鼓励我写出更多的博客。  </li>
<li>微信二维码:</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/14/Linux-下翻墙指南/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/14/Linux-下翻墙指南/" itemprop="url">
                  Linux 下翻墙指南
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-09-14 00:00:00" itemprop="dateCreated datePublished" datetime="2016-09-14T00:00:00+08:00">2016-09-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-05-02 00:00:00" itemprop="dateModified" datetime="2017-05-02T00:00:00+08:00">2017-05-02</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/笔记/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>参考链接:</strong></p>
<ul>
<li><a href="https://getlantern.org" target="_blank" rel="external">lantern(蓝灯)</a></li>
<li><a href="https://www.torproject.org" target="_blank" rel="external">tor</a></li>
<li><a href="http://vpngate.net" target="_blank" rel="external">vpngate</a></li>
<li><a href="https://www.psiphon3.com/en/index.html" target="_blank" rel="external">赛风</a></li>
<li><a href="https://www.shadowsocks.org/en/index.html" target="_blank" rel="external">ShadowSocks</a></li>
</ul>
<p>在国内做为一个程序员,翻墙是一门必不可少的技能,至少对于我来说是这样子的,我很多的知识经验来源于<a href="https://www.google.com.hk" target="_blank" rel="external">google</a>学习到的.</p>
<p><strong>vpngate</strong></p>
<p>分布式VPN,日本人开发的,曾经一段时间很快很稳定后来被封了,只支持window平台,好久没有关注它了</p>
<p><strong>赛风</strong></p>
<p>赛风是windows下很好的工具.带宽速度一般,但是免费可靠,缺点是不支持linux,在linux有一个基于python的客户,偶尔能用,早有终止开发了,配置很复杂.</p>
<p><strong>lantern</strong></p>
<p>lantern(蓝灯)是近年来新起的一个工具,支持多平台,有收费与免费版,开源安全可靠.</p>
<p><strong>tor</strong></p>
<p>洋萄头是很老牌的一个工具,它的功能不是翻墙,是隐藏自已,就是所谓的<code>暗网</code>.<br>这里只讲述在Linux如何翻墙的,我是用一台树莓派做翻墙工具,24小时在线.</p>
<p><strong>ShadowSocks</strong><br>它其实就是一个代理工具,方便一些有虚拟在国外或连接一些名费的服务器.</p>
<h3 id="Lantern-蓝灯"><a href="#Lantern-蓝灯" class="headerlink" title="Lantern(蓝灯)"></a>Lantern(蓝灯)</h3><p>直接按照官网教程先安装一些系统工具,git,go,make,docker,工具.这里以编译lantern 2.2.5为例.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># build lantern for raspberry pi</span></div><div class="line"><span class="comment">#</span></div><div class="line"></div><div class="line"><span class="built_in">set</span> -xe</div><div class="line"></div><div class="line"><span class="comment">#VERSION=$&#123;1:?version is empty&#125;</span></div><div class="line">VERSION=2.2.5</div><div class="line"></div><div class="line">git <span class="built_in">clone</span> https://github.com/getlantern/lantern.git</div><div class="line"><span class="built_in">cd</span> lantern</div><div class="line"></div><div class="line">VERSION=<span class="variable">$VERSION</span> HEADLESS=<span class="literal">true</span> make docker-linux-arm</div><div class="line">mv lantern_linux_arm lantern-<span class="variable">$VERSION</span>-armv7h</div><div class="line"></div><div class="line">sed -i <span class="string">'s/GOARM=7/GOARM=6/'</span> Makefile</div><div class="line"></div><div class="line">VERSION=<span class="variable">$VERSION</span> HEADLESS=<span class="literal">true</span> make docker-linux-arm</div><div class="line">mv lantern_linux_arm lantern-<span class="variable">$VERSION</span>-armv6h</div><div class="line"></div><div class="line">mkdir -p lantern/&#123;DEBIAN,lib/systemd/system,usr/bin&#125;/</div><div class="line">cp lantern-<span class="variable">$VERSION</span>-armv6h lantern/usr/bin/lantern</div><div class="line">cat &gt; lantern/DEBIAN/control &lt;&lt;_EOF_</div><div class="line">Package: lantern</div><div class="line">Version: <span class="variable">$VERSION</span>-1</div><div class="line">Maintainer: noreply@easypi.info</div><div class="line">Homepage: https://getlantern.org</div><div class="line">Architecture: armhf</div><div class="line">Priority: optional</div><div class="line">Section: net</div><div class="line">Description: Open Internet <span class="keyword">for</span> Everyone</div><div class="line">_EOF_</div><div class="line">cat &gt; lantern/lib/systemd/system/lantern.service &lt;&lt;_EOF_</div><div class="line">[Unit]</div><div class="line">Description=Open Internet <span class="keyword">for</span> Everyone</div><div class="line">Documentation=https://getlantern.org</div><div class="line">After=network.target</div><div class="line">[Service]</div><div class="line">ExecStart=/usr/bin/lantern -addr=0.0.0.0:8787</div><div class="line">StandardOutput=null</div><div class="line">StandardError=null</div><div class="line">Restart=always</div><div class="line">[Install]</div><div class="line">WantedBy=multi-user.target</div><div class="line">_EOF_</div><div class="line">dpkg -b lantern lantern_<span class="variable">$VERSION</span>-1_armhf.deb</div><div class="line"></div><div class="line">sudo mv lantern-<span class="variable">$VERSION</span>-armv[67]h lantern_<span class="variable">$VERSION</span>-1_armhf.deb ..</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line">sudo chmod a+rw lantern-<span class="variable">$VERSION</span>-armv[67]h lantern_<span class="variable">$VERSION</span>-1_armhf.deb</div></pre></td></tr></table></figure>
<ul>
<li>最终在lantern目录会生成.deb文件.lantern-2.2.5-armv7h,lantern-2.2.5-armv6h是树莓派下可执行的文件.<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ file lantern-2.2.5-armv6h </div><div class="line">lantern-2.2.5-armv6h: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.3, stripped</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>把lantern 运行起来,在软件或浏览器中设置代理项指向树莓派生的IP地址,端口8787,就可以看google,facebook…..</li>
</ul>
<h3 id="TOR"><a href="#TOR" class="headerlink" title="TOR"></a>TOR</h3><ul>
<li><p>在各种Linux发行版的软件库里都有tor的安装直接安装就行了.这里的polipo,dnsmasq 不是必需的.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># apt-get install tor obfsproxy polipo dnsmasq</span></div></pre></td></tr></table></figure>
</li>
<li><p>为tor建一个普通用户,使用root用户会报错也不建议使用.在普通用户下的家目录里创建一个名为torrc的配置文件.内容如下.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">SocksPort 9050 <span class="comment"># Default: Bind to localhost:9050 for local connections.</span></div><div class="line">SocksPolicy accept 127.0.0.1/32</div><div class="line">SocksPolicy reject *</div><div class="line">ClientOnly 1</div><div class="line">VirtualAddrNetwork 10.192.0.0/16</div><div class="line">DNSPort 9053</div><div class="line">DNSListenAddress  127.0.0.1</div><div class="line">AutomapHostsOnResolve 1</div><div class="line">AutomapHostsSuffixes .onion,.exit</div><div class="line">TransPort 9040</div><div class="line">Log notice file ~/tor/notices.log　　<span class="comment"># log日志途径</span></div><div class="line">RunAsDaemon 1</div><div class="line">ClientTransportPlugin  obfs2,obfs3 <span class="built_in">exec</span> /usr/bin/obfsproxy --managed</div><div class="line">UseBridges 1</div><div class="line">Bridge obfs3 192.36.31.133:42292 BD93F5439A71F8303BFDBF82066A11A6795596ED</div><div class="line">Bridge obfs3 194.132.208.198:28340 61258900CFD7BE034E938DC338C2F7197E2881AE</div><div class="line">Bridge obfs3 95.215.44.119:44527 1F1C600CE1E854E18123422EAD9267A5943815A4</div><div class="line">Bridge obfs3 163.172.161.87:34827 70C720468D057BBF9F59081506D660CE87CA4AD0</div><div class="line">Bridge obfs3 192.36.31.90:43445 78E6001D9B8B58122E8EAD0E9CF7E21D8595885C</div><div class="line">Bridge obfs3 23.252.105.31:3443 CDAE9FD7710761D1914182F62B1B47F2FBF1FDE1</div><div class="line">Bridge obfs3 192.36.31.245:42808 9D0091413CB15261A90A3256B752258CC509D5B8</div><div class="line">Bridge obfs3 37.218.246.101:35072 42F4F371DE858E634CEBB487759228838D791B66</div><div class="line">Bridge obfs3 84.39.34.97:27322 6FBE4B8B9E43D1114DEA26E82D6AC9EFEB407EB0</div><div class="line">Bridge obfs3 78.46.188.239:37356 5A2D2F4158D0453E00C7C176978D3F41D69C45DB</div><div class="line">Bridge obfs3 194.132.208.242:1287 988131F4E85BC3F07B78FCC8C5F8108440DBB9F1</div><div class="line">Bridge obfs3 194.132.208.107:9751 E2FCCB85809EE9B4747CADB86F8F3FD97389DB4C</div><div class="line">Bridge obfs3 52.207.232.222:45808 C32CF82A13BB9B6C746CE8E7D3CD873F876BAB65</div><div class="line">Bridge obfs3 192.36.31.144:54443 8C68078CCF04D2BD2CC110EF05336FF26020F8E5</div><div class="line">Bridge obfs3 95.247.9.235:45870 73DF00295D046C40B52F6CE7098EFD6799DCBA9E</div><div class="line">Bridge obfs3 192.241.211.52:41657 0BF680354EE20E1BBD385595C59B2824FFD6412D</div><div class="line">Bridge obfs3 45.79.190.81:38127 85DB43C92C5D83DAC3919D1EC751ECC5CE2A1240</div><div class="line">Bridge obfs3 205.185.120.120:35676 2D7DB306E8D7C750E18519DF362C5B54A36A1652</div></pre></td></tr></table></figure>
<p>上面的<code>obfs3</code>时效性不保,需要不定时去<strong><a href="https://bridges.torproject.org/bridges?transport=obfs3" target="_blank" rel="external">BrideDB</a></strong>更新.<br>现在可以运行一下tor,如果遇错按照错误提示解决.如果无错,就如下面运行在后台了.<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ tor <span class="_">-f</span> torcc</div><div class="line">Sep 12 23:46:18.865 [notice] Tor v0.2.7.6 running on Linux with Libevent 2.0.21-stable, OpenSSL 1.0.1t and Zlib 1.2.8.</div><div class="line">Sep 12 23:46:18.872 [notice] Tor can<span class="string">'t help you if you use it wrong! Learn how to be safe at https://www.torproject.org/download/download#warning</span></div><div class="line">Sep 12 23:46:18.881 [notice] Read configuration file "/home/user/torrc".</div><div class="line">Sep 12 23:46:19.156 [notice] Opening Socks listener on 127.0.0.1:9050</div><div class="line">Sep 12 23:46:19.171 [notice] Opening DNS listener on 127.0.0.1:9053</div><div class="line">Sep 12 23:46:19.183 [notice] Opening Transparent pf/netfilter listener on 127.0.0.1:9040</div></pre></td></tr></table></figure></p>
<ul>
<li>现在可以通过TOR查询DNS,国内的DNS对外网污染的很严重,都是张冠李戴的解析. 如果无错,下面显示解析正确的结果.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ tor-resolve www.google.com</div><div class="line">216.58.208.36</div></pre></td></tr></table></figure>
<h4 id="dnsmasq"><a href="#dnsmasq" class="headerlink" title="dnsmasq"></a>dnsmasq</h4><ul>
<li>通过dnsmasq 来为本机或者LAN局域网提供高效DNS缓存服务,这里的dnsmasq是通过TOR连接去查询,是未经ISP污染的结果.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ cat /etc/dnsmasq.conf  | grep -v <span class="string">'^#'</span> | grep -v <span class="string">'^$'</span></div><div class="line">resolv-file=/etc/resolv.dnsmasq.conf</div><div class="line">no-resolv</div><div class="line">server=127.0.0.1<span class="comment">#9053</span></div><div class="line">listen-address=127.0.0.1,192.168.10.1</div><div class="line">no-dhcp-interface=eth0</div><div class="line">dhcp-range=192.168.10.100,192.168.10.150,12h</div><div class="line">dhcp-option=3,192.168.10.1</div><div class="line">dhcp-option=option:dns-server,192.168.10.1,8.8.8.8</div></pre></td></tr></table></figure>
<ul>
<li>本机的resolv.conf 配置<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ cat /etc/resolv.conf</div><div class="line"># Generated by resolvconf</div><div class="line">nameserver 127.0.0.1</div><div class="line">nameserver 8.8.8.8</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="polipo-代理服务"><a href="#polipo-代理服务" class="headerlink" title="polipo 代理服务"></a>polipo 代理服务</h4><p>polipo 可以代理TOR的连接,就是把其它程序的代理指本机IP,端口8123</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">socksParentProxy = localhost:9050</div><div class="line">proxyAddress = 0.0.0.0</div><div class="line">dnsNameServer = 127.0.0.1</div><div class="line"><span class="built_in">log</span>Syslog = <span class="literal">true</span></div><div class="line"><span class="built_in">log</span>File = /var/<span class="built_in">log</span>/polipo/polipo.log</div></pre></td></tr></table></figure>
<h4 id="本机的服务"><a href="#本机的服务" class="headerlink" title="本机的服务"></a>本机的服务</h4><p>运下上述的服务之后,查看本机树莓派生上的服务是否正常运行起来的,正常情况应包含如下字段:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ netstat -tnlp</div><div class="line">tcp        0      0 127.0.0.1:9050          0.0.0.0:*               LISTEN      1498/tor        </div><div class="line">tcp        0      0 0.0.0.0:8123            0.0.0.0:*               LISTEN      648/polipo      </div><div class="line">tcp        0      0 127.0.0.1:9040          0.0.0.0:*               LISTEN      1498/tor        </div><div class="line">tcp        0      0 127.0.0.1:8788          0.0.0.0:*               LISTEN      19220/lantern-2.2.5</div><div class="line">tcp        0      0 0.0.0.0:53              0.0.0.0:*               LISTEN      2053/dnsmasq    </div><div class="line">tcp        0      0 127.0.0.1:16823         0.0.0.0:*               LISTEN      19220/lantern-2.2.5</div><div class="line">tcp6       0      0 :::8787                 :::*                    LISTEN      19220/lantern-2.2.5</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="ShadowSocks"><a href="#ShadowSocks" class="headerlink" title="ShadowSocks"></a>ShadowSocks</h3><ul>
<li>各平台详细安装可以看<a href="https://www.shadowsocks.org/en/download/clients.html" target="_blank" rel="external">这里</a>.</li>
<li>Linux python 安装</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">~$ pip install shadowsocks</div><div class="line">Collecting shadowsocks</div><div class="line">  Downloading https://files.pythonhosted.org/packages/02/1e/e3a5135255d06813aca6631da31768d44f63692480af3a1621818008eb4a/shadowsocks-2.8.2.tar.gz</div><div class="line">Building wheels for collected packages: shadowsocks</div><div class="line">  Running setup.py bdist_wheel for shadowsocks ... done</div><div class="line">  Stored in directory: /home/michael/.cache/pip/wheels/5e/8d/b6/3e2243a7e116984b2c3597c122c29abcfeac77daa260079e88</div><div class="line">Successfully built shadowsocks</div><div class="line">Installing collected packages: shadowsocks</div><div class="line"></div><div class="line">~$ sudo apt-get install shadowsocks-libev</div></pre></td></tr></table></figure>
<ul>
<li>直接命令行方式运行如下:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">$ sslocal</div><div class="line">ERROR: config not specified</div><div class="line">usage: sslocal [OPTION]...</div><div class="line">A fast tunnel proxy that helps you bypass firewalls.</div><div class="line"></div><div class="line">You can supply configurations via either config file or command line arguments.</div><div class="line"></div><div class="line">Proxy options:</div><div class="line">  -c CONFIG              path to config file</div><div class="line">  -s SERVER_ADDR         server address</div><div class="line">  -p SERVER_PORT         server port, default: 8388</div><div class="line">  -b LOCAL_ADDR          local binding address, default: 127.0.0.1</div><div class="line">  -l LOCAL_PORT          local port, default: 1080</div><div class="line">  -k PASSWORD            password</div><div class="line">  -m METHOD              encryption method, default: aes-256-cfb</div><div class="line">  -t TIMEOUT             timeout in seconds, default: 300</div><div class="line">  --fast-open            use TCP_FASTOPEN, requires Linux 3.7+</div><div class="line"></div><div class="line">General options:</div><div class="line">  -h, --help             show this help message and exit</div><div class="line">  -d start/stop/restart  daemon mode</div><div class="line">  --pid-file PID_FILE    pid file for daemon mode</div><div class="line">  --log-file LOG_FILE    log file for daemon mode</div><div class="line">  --user USER            username to run as</div><div class="line">  -v, -vv                verbose mode</div><div class="line">  -q, -qq                quiet mode, only show warnings/errors</div><div class="line">  --version              show version information</div><div class="line"></div><div class="line">Online help: &lt;https://github.com/shadowsocks/shadowsocks&gt;</div><div class="line"></div><div class="line">~$ sslocal  -s s1.l3l.bid -p 2048 -k forgoogle -m aes-256-cfb</div></pre></td></tr></table></figure>
<ul>
<li>如果出现下面的错误:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">2018-05-07 15:22:14 INFO     loading libcrypto from libcrypto.so.1.1</div><div class="line">Traceback (most recent call last):</div><div class="line">  File &quot;/home/michael/.pyenv/versions/py3dev/bin/sslocal&quot;, line 11, in &lt;module&gt;</div><div class="line">    sys.exit(main())</div><div class="line">  File &quot;/home/michael/.pyenv/versions/3.6.5/envs/py3dev/lib/python3.6/site-packages/shadowsocks/local.py&quot;, line 39, in main</div><div class="line">    config = shell.get_config(True)</div><div class="line">  File &quot;/home/michael/.pyenv/versions/3.6.5/envs/py3dev/lib/python3.6/site-packages/shadowsocks/shell.py&quot;, line 262, in get_config</div><div class="line">    check_config(config, is_local)</div><div class="line">  File &quot;/home/michael/.pyenv/versions/3.6.5/envs/py3dev/lib/python3.6/site-packages/shadowsocks/shell.py&quot;, line 124, in check_config</div><div class="line">    encrypt.try_cipher(config[&apos;password&apos;], config[&apos;method&apos;])</div><div class="line">  File &quot;/home/michael/.pyenv/versions/3.6.5/envs/py3dev/lib/python3.6/site-packages/shadowsocks/encrypt.py&quot;, line 44, in try_cipher</div><div class="line">    Encryptor(key, method)</div><div class="line">  File &quot;/home/michael/.pyenv/versions/3.6.5/envs/py3dev/lib/python3.6/site-packages/shadowsocks/encrypt.py&quot;, line 83, in __init__</div><div class="line">    random_string(self._method_info[1]))</div><div class="line">  File &quot;/home/michael/.pyenv/versions/3.6.5/envs/py3dev/lib/python3.6/site-packages/shadowsocks/encrypt.py&quot;, line 109, in get_cipher</div><div class="line">    return m[2](method, key, iv, op)</div><div class="line">  File &quot;/home/michael/.pyenv/versions/3.6.5/envs/py3dev/lib/python3.6/site-packages/shadowsocks/crypto/openssl.py&quot;, line 76, in __init__</div><div class="line">    load_openssl()</div><div class="line">  File &quot;/home/michael/.pyenv/versions/3.6.5/envs/py3dev/lib/python3.6/site-packages/shadowsocks/crypto/openssl.py&quot;, line 52, in load_openssl</div><div class="line">    libcrypto.EVP_CIPHER_CTX_cleanup.argtypes = (c_void_p,)</div><div class="line">  File &quot;/home/michael/.pyenv/versions/3.6.5/lib/python3.6/ctypes/__init__.py&quot;, line 361, in __getattr__</div><div class="line">    func = self.__getitem__(name)</div><div class="line">  File &quot;/home/michael/.pyenv/versions/3.6.5/lib/python3.6/ctypes/__init__.py&quot;, line 366, in __getitem__</div><div class="line">    func = self._FuncPtr((name_or_ordinal, self))</div><div class="line">AttributeError: /usr/lib/x86_64-linux-gnu/libcrypto.so.1.1: undefined symbol: EVP_CIPHER_CTX_cleanup</div></pre></td></tr></table></figure>
<p>这个问题是由于在openssl1.1.0版本中，废弃了EVP_CIPHER_CTX_cleanup函数，如官网中所说：</p>
<p>EVP_CIPHER_CTX was made opaque in OpenSSL 1.1.0. As a result, EVP_CIPHER_CTX_reset() appeared and EVP_CIPHER_CTX_cleanup() disappeared. EVP_CIPHER_CTX_init() remains as an alias for EVP_CIPHER_CTX_reset().<br>在<code>openssl.py</code>里把所有的<strong>EVP_CIPHER_CTX_cleanup</strong>函数替换成<code>EVP_CIPHER_CTX_reset</code>.</p>
<ul>
<li>如果是使用CONFIG的方式如下:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;server&quot;:&quot;my_server_ip&quot;,</div><div class="line">    &quot;server_port&quot;:8388,</div><div class="line">    &quot;local_port&quot;:1080,</div><div class="line">    &quot;password&quot;:&quot;barfoo!&quot;,</div><div class="line">    &quot;timeout&quot;:600,</div><div class="line">    &quot;method&quot;:&quot;chacha20-ietf-poly1305&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>一些免费SS资源</strong><br><a href="https://github.com/max2max/freess" target="_blank" rel="external">https://github.com/max2max/freess</a><br><a href="https://github.com/Alvin9999/new-pac/wiki/%E8%87%AA%E5%BB%BAss%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%99%E7%A8%8B" target="_blank" rel="external">自建ss服务器教程</a><br><a href="https://freessr.win/" target="_blank" rel="external">https://freessr.win/</a></p>
<hr>
<h3 id="谢谢打赏支持"><a href="#谢谢打赏支持" class="headerlink" title="谢谢打赏支持"></a>谢谢打赏支持</h3><ul>
<li>您的打赏将会鼓励我写出更多的博客。  </li>
<li>微信二维码:</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/13/Linux下编译静态MinGW环境-编译windows平台Qt程序/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/13/Linux下编译静态MinGW环境-编译windows平台Qt程序/" itemprop="url">
                  Linux下编译静态MinGW环境,编译windows平台Qt程序
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-09-13 00:00:00" itemprop="dateCreated datePublished" datetime="2016-09-13T00:00:00+08:00">2016-09-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2016-09-15 00:00:00" itemprop="dateModified" datetime="2016-09-15T00:00:00+08:00">2016-09-15</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Qt/" itemprop="url" rel="index"><span itemprop="name">Qt</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>参考链接:</li>
<li><a href="http://mxe.cc" target="_blank" rel="external">MXE</a>.<br>&gt;<br>大多数程序都是在windows平台下开发的程序.windows 在现实中也是绕不过的一个系统平台,做为受过几年VC,MFC”虐待”的程序员,在做为一个程序员之前是一位Linux重度使用者,受够了MFC之后一直想要找一个框架替换,<br>使用过GTK,wxWidgets,Qt,最后还是Qt用得多一些.我认为程序跨平台应该是一个基本标准,同一份代码不需改动,或者改动极少,放在不同的平台下编译就能使用.不同平台,同样的界面,同样的操作,同样的体验.<br>这里要讲的是我如何在Linux 下开发跨平台的Qt程序,如何在linux开发windows程序.<br>&gt;</li>
</ul>
<h3 id="MXE-M-cross-environment"><a href="#MXE-M-cross-environment" class="headerlink" title="MXE (M cross environment)"></a>MXE (M cross environment)</h3><ul>
<li>MXE 真的是一个了不起的项目,详情请查看上面链接,非常详细.因为MXE就是在Linux下静态编译的跨平台环境,不需要你一步一步繁杂的编译工具链,直接按教程一键make就下载安装好,但是对Linux的操作熟悉会更加好排错.</li>
</ul>
<h4 id="安装教程"><a href="#安装教程" class="headerlink" title="安装教程"></a>安装教程</h4><ul>
<li>尽量查看<a href="http://mxe.cc/#tutorial" target="_blank" rel="external">英文教程</a>,这里简单记录一在<code>debian8 x86_64</code>下的安装过程.遇到问题找<a href="https://www.google.com.hk" target="_blank" rel="external">google</a>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">apt-get install \</div><div class="line">    autoconf automake autopoint bash bison bzip2 flex gettext\</div><div class="line">    git g++ gperf intltool libffi-dev libgdk-pixbuf2.0-dev \</div><div class="line">    libtool libltdl-dev libssl-dev libxml-parser-perl make \</div><div class="line">    openssl p7zip-full patch perl pkg-config python ruby scons \</div><div class="line">    sed unzip wget xz-utils g++-multilib libc6-dev-i386 libtool-bin</div></pre></td></tr></table></figure>
<h4 id="获取最新版本"><a href="#获取最新版本" class="headerlink" title="获取最新版本"></a>获取最新版本</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> /opt</div><div class="line">$ git <span class="built_in">clone</span> https://github.com/mxe/mxe.git</div><div class="line">$ make MXE_TARGETS=<span class="string">'x86_64-w64-mingw32.static i686-w64-mingw32.static'</span> qt5</div></pre></td></tr></table></figure>
<ul>
<li>如果中间不出错,安装完成如下. <code>i686-w64-mingw32.static</code>目录下就在如:我电脑系统64位下编译32位的exe, 而<code>x86_64-w64-mingw32.static</code>就是编译生成64位的exe.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ls</span>  /opt/mxe/usr/</div><div class="line">bin  i686-w64-mingw32.static  include  installed  lib  libexec  share  x86_64-unknown-linux-gnu  x86_64-w64-mingw32.static</div></pre></td></tr></table></figure>
<h3 id="设置Qt"><a href="#设置Qt" class="headerlink" title="设置Qt"></a>设置Qt</h3><ul>
<li><p><a href="http://mxe.cc/#tutorial" target="_blank" rel="external">英文教程</a>有详细教程如何使用,如:(autotools,CMake,Makefile,QT…),这里贴图记录一下在<code>QtCreator</code> 下的设置.</p>
</li>
<li><p>设置编译器</p>

</li>
<li><p>设置Qt版本</p>

</li>
<li><p>添加Qt Kit</p>

</li>
<li><p>现在就可以在<code>Qt Creator</code>里的工程下添加这个Kit里了,因为这里只是静态编了Release版本,如果指定为Debug配置,编译会出错的.</p>
</li>
</ul>
<p>###　一些Qt 工程问题</p>
<p><strong>Linux GL 链接库错误.</strong></p>
<ul>
<li>如果在Linux遇到链接系统下的GL库出错,只要在.pro 加入<code>QMAKE_LIBS_OPENGL -= -lGL</code>,重新qmake,编译.</li>
</ul>
<p><strong>Release版本加入调试符号</strong></p>
<ul>
<li>在实际开发有遇到这种问题,在Linux的编译Debug,Release调试与运行都没有错误,但是在windows平台下运就崩溃出错,这时调试最有效的调试手段是是加入调试符号信息,在windows下运行GDB加载该程序,查看出错的原因.pro \</li>
<li>在.pro中在加如下三行,重新<code>qmake</code>,编译.带调试信息的exe会长到几十M.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">QMAKE_CXXFLAGS_RELEASE += -g </div><div class="line">QMAKE_CFLAGS_RELEASE += -g</div><div class="line">QMAKE_LFLAGS_RELEASE =</div></pre></td></tr></table></figure>
<hr>
<h3 id="谢谢打赏支持"><a href="#谢谢打赏支持" class="headerlink" title="谢谢打赏支持"></a>谢谢打赏支持</h3><ul>
<li>您的打赏将会鼓励我写出更多的博客。  </li>
<li>微信二维码:</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/04/vsftpd-FTP服务器与django前端共用sqlite3数据库的示例/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/04/vsftpd-FTP服务器与django前端共用sqlite3数据库的示例/" itemprop="url">
                  vsftpd FTP服务器与django前端共用sqlite3数据库的示例
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-09-04 00:00:00" itemprop="dateCreated datePublished" datetime="2016-09-04T00:00:00+08:00">2016-09-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2016-12-14 22:18:00" itemprop="dateModified" datetime="2016-12-14T22:18:00+08:00">2016-12-14</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>本示例接合vsftpd与Django共用Sqlite3(不限于<code>sqlite3,Mysql,Postgresql</code>)中的数据表认证做一个Web端FTP管理的应用.可以支持多用户,Web端管理帐户,上传文件,Vsftpd端只可以下载当前用户目录下的内容,</li>
<li>Ｗeb端的上传目录与Vsftpd下载目录映射到服务器的同一个目录.</li>
</ul>
<h3 id="Vsftpd"><a href="#Vsftpd" class="headerlink" title="Vsftpd"></a>Vsftpd</h3><ul>
<li><p>这里使用<code>vsftpd-3.0.2</code>版本,这里要对它的源做一小修改,确保每一个用户登录成功之后自动创建一个名为用户名目录.这个目录专属于这个用户,用户上传下载也只限于这个目录下.</p>
</li>
<li><p>源代码位置在<code>vsftpd-3.0.2/twoprocess.c</code> 里的　<code>common_do_login</code> 函数中.如下面代码片段.</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line"><span class="number">385</span>    <span class="keyword">static</span> <span class="keyword">void</span></div><div class="line"><span class="number">386</span>  common_do_login(<span class="keyword">struct</span> vsf_session* p_sess, <span class="keyword">const</span> <span class="keyword">struct</span> mystr* p_user_str,</div><div class="line"><span class="number">387</span>                  <span class="keyword">int</span> do_chroot, <span class="keyword">int</span> anon)</div><div class="line"><span class="number">388</span>  &#123;</div><div class="line"><span class="number">389</span>      <span class="keyword">int</span> was_anon = anon;</div><div class="line"><span class="number">390</span>      <span class="keyword">const</span> <span class="keyword">struct</span> mystr* p_orig_user_str = p_user_str;</div><div class="line"><span class="number">391</span>      <span class="keyword">int</span> newpid;</div><div class="line"><span class="number">392</span>      vsf_sysutil_install_null_sighandler(kVSFSysUtilSigCHLD);</div><div class="line"><span class="number">393</span>      <span class="comment">/* Tells the pre-login child all is OK (it may exit in response) */</span></div><div class="line"><span class="number">394</span>      priv_sock_send_result(p_sess-&gt;parent_fd, PRIV_SOCK_RESULT_OK);</div><div class="line"><span class="number">395</span>      <span class="keyword">if</span> (!p_sess-&gt;control_use_ssl)</div><div class="line"><span class="number">396</span>      &#123;</div><div class="line"><span class="number">397</span>          (<span class="keyword">void</span>) vsf_sysutil_wait();</div><div class="line"><span class="number">398</span>      &#125;</div><div class="line"><span class="number">399</span>      <span class="keyword">else</span></div><div class="line"><span class="number">400</span>      &#123;</div><div class="line"><span class="number">401</span>          p_sess-&gt;ssl_slave_active = <span class="number">1</span>;</div><div class="line"><span class="number">402</span>      &#125;</div><div class="line"><span class="number">403</span>      <span class="comment">/* Handle loading per-user config options */</span></div><div class="line"><span class="number">404</span>      handle_per_user_config(p_user_str);</div><div class="line"><span class="number">405</span>      <span class="comment">/* Set this before we fork */</span></div><div class="line"><span class="number">406</span>      p_sess-&gt;is_anonymous = anon;</div><div class="line"><span class="number">407</span>      priv_sock_close(p_sess);</div><div class="line"><span class="number">408</span>      priv_sock_init(p_sess);</div><div class="line"><span class="number">409</span>      vsf_sysutil_install_sighandler(kVSFSysUtilSigCHLD, handle_sigchld, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line"><span class="number">410</span>      <span class="keyword">if</span> (tunable_isolate_network &amp;&amp; !tunable_port_promiscuous)</div><div class="line"><span class="number">411</span>      &#123;</div><div class="line"><span class="number">412</span>          newpid = vsf_sysutil_fork_newnet();</div><div class="line"><span class="number">413</span>      &#125;</div><div class="line"><span class="number">414</span>      <span class="keyword">else</span></div><div class="line"><span class="number">415</span>      &#123;</div><div class="line"><span class="number">416</span>          newpid = vsf_sysutil_fork();</div><div class="line"><span class="number">417</span>      &#125;</div><div class="line"><span class="number">418</span>      <span class="keyword">if</span> (newpid == <span class="number">0</span>)</div><div class="line"><span class="number">419</span>      &#123;</div><div class="line"><span class="number">420</span>          <span class="keyword">struct</span> mystr guest_user_str = INIT_MYSTR;</div><div class="line"><span class="number">421</span>          <span class="keyword">struct</span> mystr chroot_str = INIT_MYSTR;</div><div class="line"><span class="number">422</span>          <span class="keyword">struct</span> mystr chdir_str = INIT_MYSTR;</div><div class="line"><span class="number">423</span>          <span class="keyword">struct</span> mystr userdir_str = INIT_MYSTR;</div><div class="line"><span class="number">424</span>          <span class="keyword">unsigned</span> <span class="keyword">int</span> secutil_option = VSF_SECUTIL_OPTION_USE_GROUPS |</div><div class="line"><span class="number">425</span>                                        VSF_SECUTIL_OPTION_NO_PROCS;</div><div class="line"><span class="number">426</span>          <span class="comment">/* Child - drop privs and start proper FTP! */</span></div><div class="line"><span class="number">427</span>          <span class="comment">/* This PR_SET_PDEATHSIG doesn't work for all possible process tree setups.</span></div><div class="line">428           * The other cases are taken care of by a shutdown() of the command</div><div class="line">429           * connection in our SIGTERM handler.</div><div class="line">430           */</div><div class="line"><span class="number">431</span>          vsf_set_die_if_parent_dies();</div><div class="line"><span class="number">432</span>          priv_sock_set_child_context(p_sess);</div><div class="line"><span class="number">433</span>          <span class="keyword">if</span> (tunable_guest_enable &amp;&amp; !anon)</div><div class="line"><span class="number">434</span>          &#123;</div><div class="line"><span class="number">435</span>              p_sess-&gt;is_guest = <span class="number">1</span>;</div><div class="line"><span class="number">436</span>              <span class="comment">/* Remap to the guest user */</span></div><div class="line"><span class="number">437</span>              <span class="keyword">if</span> (tunable_guest_username)</div><div class="line"><span class="number">438</span>              &#123;</div><div class="line"><span class="number">439</span>                  str_alloc_text(&amp;guest_user_str, tunable_guest_username);</div><div class="line"><span class="number">440</span>              &#125;</div><div class="line"><span class="number">441</span>              p_user_str = &amp;guest_user_str;</div><div class="line"><span class="number">442</span>              <span class="keyword">if</span> (!tunable_virtual_use_local_privs)</div><div class="line"><span class="number">443</span>              &#123;</div><div class="line"><span class="number">444</span>                  anon = <span class="number">1</span>;</div><div class="line"><span class="number">445</span>                  do_chroot = <span class="number">1</span>;</div><div class="line"><span class="number">446</span>              &#125;</div><div class="line"><span class="number">447</span>          &#125;</div><div class="line"><span class="number">448</span>          <span class="keyword">if</span> (do_chroot)</div><div class="line"><span class="number">449</span>          &#123;</div><div class="line"><span class="number">450</span>              secutil_option |= VSF_SECUTIL_OPTION_CHROOT;</div><div class="line"><span class="number">451</span>          &#125;</div><div class="line"><span class="number">452</span>          <span class="keyword">if</span> (!anon)</div><div class="line"><span class="number">453</span>          &#123;</div><div class="line"><span class="number">454</span>              secutil_option |= VSF_SECUTIL_OPTION_CHANGE_EUID;</div><div class="line"><span class="number">455</span>          &#125;</div><div class="line"><span class="number">456</span>          <span class="keyword">if</span> (!was_anon &amp;&amp; tunable_allow_writeable_chroot)</div><div class="line"><span class="number">457</span>          &#123;</div><div class="line"><span class="number">458</span>              secutil_option |= VSF_SECUTIL_OPTION_ALLOW_WRITEABLE_ROOT;</div><div class="line"><span class="number">459</span>          &#125;</div><div class="line"><span class="number">460</span>          calculate_chdir_dir(was_anon, &amp;userdir_str, &amp;chroot_str, &amp;chdir_str,</div><div class="line"><span class="number">461</span>                              p_user_str, p_orig_user_str);</div><div class="line"><span class="number">462</span>  </div><div class="line"><span class="number">463</span>  </div><div class="line">             <span class="comment">/* 通过我的调式这里加下面这一句,用户通过FTP端户登录成功就会创建它自已的目录*/</span></div><div class="line"><span class="number">464</span>          str_mkdir(&amp;chroot_str, <span class="number">0777</span>);</div><div class="line"><span class="number">465</span>  </div><div class="line"><span class="number">466</span>          chown(str_getbuf(&amp;chroot_str),p_sess-&gt;guest_user_uid,p_sess-&gt;guest_user_uid);</div><div class="line"><span class="number">467</span>  </div><div class="line"><span class="number">468</span>  </div><div class="line"><span class="number">469</span>          vsf_secutil_change_credentials(p_user_str, &amp;userdir_str, &amp;chroot_str,</div><div class="line"><span class="number">470</span>                                         <span class="number">0</span>, secutil_option);</div><div class="line"><span class="number">471</span>          <span class="keyword">if</span> (!str_isempty(&amp;chdir_str))</div><div class="line"><span class="number">472</span>          &#123;</div><div class="line"><span class="number">473</span>              (<span class="keyword">void</span>) str_chdir(&amp;chdir_str);</div><div class="line"><span class="number">474</span>          &#125;</div><div class="line"><span class="number">475</span>          str_free(&amp;guest_user_str);</div><div class="line"><span class="number">476</span>          str_free(&amp;chroot_str);</div><div class="line"><span class="number">477</span>          str_free(&amp;chdir_str);</div><div class="line"><span class="number">478</span>          str_free(&amp;userdir_str);</div><div class="line"><span class="number">479</span>          p_sess-&gt;is_anonymous = anon;</div><div class="line"><span class="number">480</span>          seccomp_sandbox_init();</div><div class="line"><span class="number">481</span>          seccomp_sandbox_setup_postlogin(p_sess);</div><div class="line"><span class="number">482</span>          seccomp_sandbox_lockdown();</div><div class="line"><span class="number">483</span>  </div><div class="line"><span class="number">484</span>          process_post_login(p_sess);</div><div class="line"><span class="number">485</span>          bug(<span class="string">"should not get here: common_do_login"</span>);</div><div class="line"><span class="number">486</span>      &#125;</div><div class="line"><span class="number">487</span>      <span class="comment">/* Parent */</span></div><div class="line"><span class="number">488</span>      priv_sock_set_parent_context(p_sess);</div><div class="line"><span class="number">489</span>      <span class="keyword">if</span> (tunable_ssl_enable)</div><div class="line"><span class="number">490</span>      &#123;</div><div class="line"><span class="number">491</span>          ssl_comm_channel_set_producer_context(p_sess);</div><div class="line"><span class="number">492</span>      &#125;</div><div class="line"><span class="number">493</span>      <span class="comment">/* The seccomp sandbox lockdown for the priv parent is done inside here */</span></div><div class="line"><span class="number">494</span>      vsf_priv_parent_postlogin(p_sess);</div><div class="line"><span class="number">495</span>      bug(<span class="string">"should not get here in common_do_login"</span>);</div><div class="line"><span class="number">496</span>  &#125;</div></pre></td></tr></table></figure>
<ul>
<li>参照<code>vsftpd-3.0.2/INSTALL</code>　直接编译安装.</li>
</ul>
<h3 id="配置vsftpd"><a href="#配置vsftpd" class="headerlink" title="配置vsftpd"></a>配置vsftpd</h3><ul>
<li><code>/etc/vsftpd.conf</code> 修改如下:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">grep -v &apos;^#&apos; /etc/vsftpd.conf </div><div class="line">cmds_allowed=ABOR,CWD,LIST,NLST,PWD,QUIT,RETR,SIZE,TYPE,USER,ACCT,CDUP,MODE,SYST,FEAT,PASV</div><div class="line">listen=YES</div><div class="line">listen_ipv6=NO</div><div class="line">anonymous_enable=NO</div><div class="line">local_enable=YES</div><div class="line">write_enable=NO</div><div class="line"></div><div class="line">dirmessage_enable=YES</div><div class="line">use_localtime=YES</div><div class="line">xferlog_enable=NO</div><div class="line">connect_from_port_20=YES</div><div class="line">idle_session_timeout=600</div><div class="line">data_connection_timeout=120</div><div class="line">nopriv_user=vsftpd</div><div class="line">chroot_local_user=YES</div><div class="line">pam_service_name=vsftpd</div><div class="line">user_sub_token=$USER</div><div class="line">guest_enable=YES</div><div class="line">guest_username=vsftpd</div><div class="line">local_root=/opt/data/ftproot/$USER #所有用户目录会在这个目录下.</div><div class="line">chroot_local_user=YES</div><div class="line">allow_writeable_chroot=YES</div><div class="line">chroot_list_enable=NO</div><div class="line">virtual_use_local_privs=YES</div><div class="line">file_open_mode=0770</div><div class="line">anon_mkdir_write_enable=NO</div><div class="line">ssl_enable=NO</div><div class="line">max_per_ip=65536</div><div class="line">log_ftp_protocol=YES</div></pre></td></tr></table></figure>
<ul>
<li><code>/etc/pam.d/vsftpd</code> 修改如下:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"># Standard behaviour for ftpd(8).</div><div class="line">#auth   required    pam_listfile.so item=user sense=deny file=/etc/ftpusers onerr=succeed</div><div class="line"></div><div class="line"># Note: vsftpd handles anonymous logins on its own. Do not enable pam_ftp.so.</div><div class="line"></div><div class="line"># Standard pam includes</div><div class="line">#@include common-account</div><div class="line">#@include common-session</div><div class="line">#@include common-auth</div><div class="line">#auth   required    pam_shells.so</div><div class="line"># 如果使用其它数据库如:postgresql ,把pam_sqlite3.so替换掉</div><div class="line">auth        required    /lib/x86_64-linux-gnu/security/pam_sqlite3.so </div><div class="line">account     required    /lib/x86_64-linux-gnu/security/pam_sqlite3.so</div><div class="line">password    required    /lib/x86_64-linux-gnu/security/pam_sqlite3.so</div></pre></td></tr></table></figure>
<h3 id="pam-sqlite-0-3"><a href="#pam-sqlite-0-3" class="headerlink" title="pam_sqlite-0.3"></a>pam_sqlite-0.3</h3><ul>
<li>在github上找到两个项目<strong><a href="https://github.com/sangeeths/libpam-sqlite" target="_blank" rel="external">libpam-sqlite</a>,<a href="https://github.com/dtjm/pam_sqlite3" target="_blank" rel="external">dtjm/pam_sqlite3</a></strong>是关于pam_sqlite3认证的,两个项目都很老了,</li>
<li>这两个代码应该是大同小异,我没有对比,这里用是用libpam-sqlite.也修了源码才可以使用.<code>pam_sqlite3</code>没有测试,应该也是可以的.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> git@github.com:sangeeths/libpam-sqlite.git</div></pre></td></tr></table></figure>
<ul>
<li>这里的修改不一定是通用的可能要根据调试结果来决定,我这里修改是为了迎合后面的<code>Django</code>项目登录认证的.修改的源代如下:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">~/libpam-sqlite<span class="comment"># git diff</span></div><div class="line">diff --git a/pam_sqlite3.c b/pam_sqlite3.c</div><div class="line">index 565ce30..f2545a4 100644</div><div class="line">--- a/pam_sqlite3.c</div><div class="line">+++ b/pam_sqlite3.c</div><div class="line">@@ -455,7 +455,9 @@ static int auth_verify_password(const char *un,</div><div class="line">     &#125;</div><div class="line">     </div><div class="line">     /* get the encrypted password from the database */</div><div class="line">+    //const char *stored_pwd = (char*)sqlite3_column_text(stmt, 0);</div><div class="line">     const char *stored_pwd = (char *)sqlite3_column_text(stmt, 0);</div><div class="line">+    stored_pwd = stored_pwd +7; // skip the crypt$$</div><div class="line"> </div><div class="line">     result = PAM_AUTH_ERR;</div><div class="line">     switch(options-&gt;pw_type) &#123;</div><div class="line">@@ -581,7 +583,7 @@ PAM_EXTERN int pam_sm_acct_mgmt(pam_handle_t *pamh,</div><div class="line">     /* <span class="keyword">if</span> new password is required <span class="keyword">then</span> newtok_column = <span class="string">'y'</span> or <span class="string">'1'</span> */</div><div class="line">     <span class="keyword">if</span>(options-&gt;newtok_column || options-&gt;sql_check_newtok) &#123;</div><div class="line">         query = format_query(options-&gt;sql_check_newtok ? options-&gt;sql_check_newtok :</div><div class="line">-                <span class="string">"SELECT 1 FROM %Ot WHERE %Ou='%U' AND (%On='y' OR %On='1')"</span>,</div><div class="line">+                <span class="string">"SELECT 1 FROM %Ot WHERE %Ou='%U' AND (%On='y' OR %On='0')"</span>,</div><div class="line">                 options, un, NULL);</div><div class="line">         DBGLOG(<span class="string">"query: %s"</span>, query);</div></pre></td></tr></table></figure>
<ul>
<li>参照源码目录下的<code>README</code>编译与设置</li>
</ul>
<h4 id="pam-sqlite-conf"><a href="#pam-sqlite-conf" class="headerlink" title="pam_sqlite.conf"></a>pam_sqlite.conf</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$cat</span> /etc/pam_sqlite.conf </div><div class="line">database = /opt/data/db.sqlite3</div><div class="line">table = ftp_ftpuser </div><div class="line">user_column = email</div><div class="line">pwd_column = password</div><div class="line">newtok_column = is_staff</div><div class="line">pw_type = crypt</div></pre></td></tr></table></figure>
<h3 id="Django配置"><a href="#Django配置" class="headerlink" title="Django配置"></a>Django配置</h3><p>####　Sqlite3表结构</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sqlite&gt; .schema ftp_ftpuser</div><div class="line">CREATE TABLE <span class="string">"ftp_ftpuser"</span> (<span class="string">"password"</span> varchar(128) NOT NULL, <span class="string">"last_login"</span> datetime NULL, <span class="string">"is_superuser"</span> bool NOT NULL, <span class="string">"name"</span> varchar(256) NOT NULL, <span class="string">"email"</span> varchar(254) NOT NULL PRIMARY KEY, <span class="string">"phone_num"</span> varchar(15) NOT NULL, <span class="string">"reg_ip"</span> char(39) NOT NULL, <span class="string">"is_active"</span> bool NOT NULL, <span class="string">"is_staff"</span> bool NOT NULL, <span class="string">"date_joined"</span> datetime NOT NULL, <span class="string">"last_ip"</span> char(39) NOT NULL);</div><div class="line">CREATE UNIQUE INDEX <span class="string">"ftp_ftpuser_name_2294ce6a_uniq"</span> ON <span class="string">"ftp_ftpuser"</span> (<span class="string">"name"</span>, <span class="string">"email"</span>);</div></pre></td></tr></table></figure>
<h4 id="Settings"><a href="#Settings" class="headerlink" title="Settings"></a>Settings</h4><ul>
<li>在Django项目里的<code>settings.py</code> 添加如下代码片段.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Application definition</span></div><div class="line">PASSWORD_HASHERS = (</div><div class="line">            <span class="string">'django.contrib.auth.hashers.CryptPasswordHasher'</span>,</div><div class="line">            )</div><div class="line"></div><div class="line">DATABASES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;</div><div class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.sqlite3'</span>,</div><div class="line">        <span class="string">'NAME'</span>: os.path.join(BASE_DIR, <span class="string">'db.sqlite3'</span>),  <span class="comment">#这里的**db.sqlite3** 应该与**/etc/pam_sqlite.conf**里对应</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Password validation</span></div><div class="line"><span class="comment"># https://docs.djangoproject.com/en/1.9/ref/settings/#authassword-validators</span></div><div class="line"></div><div class="line">AUTH_PASSWORD_VALIDATORS = [</div><div class="line">    &#123;</div><div class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.UserAttributeSimilarityValidator'</span>,</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.MinimumLengthValidator'</span>,</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.CommonPasswordValidator'</span>,</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.NumericPasswordValidator'</span>,</div><div class="line">    &#125;,</div><div class="line">]</div><div class="line"></div><div class="line"><span class="comment">#AUTHENTICATION_BACKENDS = ['ftp.auth.CustomBackEnd']</span></div><div class="line">AUTH_USER_MODEL=<span class="string">'ftp.FtpUser'</span></div><div class="line">MEDIA_ROOT=<span class="string">'/opt/data/ftproot'</span>  <span class="comment">#这里的路径与vsftpd.conf是对应的.这里Django 程序创建的目录就会在这个目录下面</span></div></pre></td></tr></table></figure>
<ul>
<li>Django 程序创建目录的代码片段如下:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">def get_upload_dir(req,filename):</div><div class="line">    tname  = req.target_name</div><div class="line">    pname = tname.product_name</div><div class="line">    fdir = <span class="string">'/'</span>.join([settings.MEDIA_ROOT,pname.ftp_user.email,pname.name,tname.name,req.ver_name])</div><div class="line">    <span class="comment">#fdir = '/'.join([settings.MEDIA_ROOT,product.ftp_user.email,req.name.name,req.target_name.target_name,req.ver_name])</span></div><div class="line">    fdir = unicode(fdir)</div><div class="line">    <span class="keyword">if</span> os.path.exists(fdir):</div><div class="line">        try:</div><div class="line">            os.makedirs(fdir)</div><div class="line">        except OSError:</div><div class="line">            pass</div><div class="line">    filepath = <span class="string">'/'</span>.join([fdir,req.file_name.name])</div><div class="line">    <span class="keyword">if</span> os.path.isfile(filepath):</div><div class="line">        os.remove(filepath)</div><div class="line"><span class="built_in">return</span> filepath</div></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>这里的数据库表结构都是通过Django的模型创建的,通过Django端注册用户,设置相应权限(如是否允许该用户登录等.),FTP端就可以使用该用户登录服务器进行下载.具体应用要根据需求灵活改变,这里只是做了一个简单示例,</li>
<li>也没有添加SSL加密连接.后续加入SSL支持.</li>
</ul>
<hr>
<h3 id="谢谢打赏支持"><a href="#谢谢打赏支持" class="headerlink" title="谢谢打赏支持"></a>谢谢打赏支持</h3><ul>
<li>您的打赏将会鼓励我写出更多的博客。  </li>
<li>微信二维码:</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/26/使用的一些常见问题-不定期更新/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/26/使用的一些常见问题-不定期更新/" itemprop="url">
                  Linux 使用的一些常见问题,不定期更新.
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-08-26 00:00:00" itemprop="dateCreated datePublished" datetime="2016-08-26T00:00:00+08:00">2016-08-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-02-03 22:27:00" itemprop="dateModified" datetime="2017-02-03T22:27:00+08:00">2017-02-03</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/笔记/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="minicom-使用"><a href="#minicom-使用" class="headerlink" title="minicom 使用　"></a>minicom 使用　</h3><ul>
<li><p>Linux 下的超级终端工具<code>minicom</code> 是命令行的工具不像windows下的串口工具那么直观,但是使用习惯了就一样.</p>
</li>
<li><p>初次使用minicom除了一些串口的常规设置,跟其它串口工具都是一样的.</p>
</li>
<li><p>在当前Shell下输入 <code>minicom -s</code> 会出现如下界面:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">+-----[configuration]------+                                     </div><div class="line">| Filenames and paths      |                                     </div><div class="line">| File transfer protocols  |                                     </div><div class="line">| Serial port setup        |                                     </div><div class="line">| Modem and dialing        |                                     </div><div class="line">| Screen and keyboard      |</div><div class="line">| Save setup as dfl        |</div><div class="line">| Save setup as..          |</div><div class="line">| Exit                     |</div><div class="line">| Exit from Minicom        |</div><div class="line">+--------------------------+</div></pre></td></tr></table></figure>
</li>
<li><p>选择<code>Serial port setup</code> 设置串口参数:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">+-----------------------------------------------------------------------+</div><div class="line">| A -    Serial Device      : /dev/ttyUSB5                              |</div><div class="line">| B - Lockfile Location     : /var/lock                                 |</div><div class="line">| C -   Callin Program      :                                           |</div><div class="line">| D -  Callout Program      :                                           |</div><div class="line">| E -    Bps/Par/Bits       : 115200 8N1                                |</div><div class="line">| F - Hardware Flow Control : No                                        |</div><div class="line">| G - Software Flow Control : No                                        |</div><div class="line">|                                                                       |</div><div class="line">|    Change <span class="built_in">which</span> setting?                                              |</div><div class="line">+-----------------------------------------------------------------------+</div></pre></td></tr></table></figure>
</li>
<li><p>设置完成回车返回到一个菜单.选择<code>Save setup as dfl</code> 保存退出.</p>
</li>
<li><p>我一般使用minicom 的参数去连接.例如:</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$  minicom -o -b 115200 -D /dev/ttyUSB5</div></pre></td></tr></table></figure>
<h4 id="AT命令"><a href="#AT命令" class="headerlink" title="AT命令"></a>AT命令</h4><ul>
<li>一般图形串口工具都有一项,发送新行或者<code>**newline**</code>这个选项.在连接一些硬件串口时发送AT命令时,这个是必选的.</li>
<li><p>但是在minicom就只能用组合快捷键来替换了.</p>
</li>
<li><p>在minicom 里发送AT命令如:<code>AT+OK</code> 直接回车,它是不会有反应的,必须还要加一个<code>ctrl+j</code>,才能提交,这个问题也是困扰了我很久.</p>
</li>
</ul>
<h3 id="esptool升级固件"><a href="#esptool升级固件" class="headerlink" title="esptool升级固件"></a>esptool升级固件</h3><ul>
<li>参考链接:</li>
</ul>
<ul>
<li><a href="http://wiki.ai-thinker.com/doku.php/utils/esp_bin_download" target="_blank" rel="external">ESP8266 Tools</a></li>
<li><a href="https://github.com/esp8266/esp8266-wiki/wiki/Boot-Process#esp-boot-modes" target="_blank" rel="external">ESP8266 Wiki</a></li>
<li><a href="http://wiki.ai-thinker.com/doku.php/release/esp8266_sdk_release" target="_blank" rel="external">ESP8266 SDK</a></li>
<li><a href="http://cms.35g.tw/coding/%e4%bd%bf%e7%94%a8arduino%e6%9b%b4%e6%96%b0esp8266-firmware" target="_blank" rel="external">使用Arduino更新ESP8266 firmware</a></li>
</ul>
<p>ESP-01　为例.　<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">GPIO0 --&gt; GND</div><div class="line">GPIO2 --&gt; 3V3</div><div class="line">CH_PD --&gt; 3V3</div><div class="line">RST   --&gt; 3V3 </div><div class="line">VCC   --&gt; 3V3</div><div class="line">GND   --&gt; GND</div><div class="line">TX    --&gt; UART(RX)</div><div class="line">RX    --&gt; UART(TX)</div></pre></td></tr></table></figure></p>
<ul>
<li><p><a href="https://github.com/themadinventor/esptool" target="_blank" rel="external">esptool工具</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ esptool.py   -p /dev/ttyUSB5 write_flash --flash_mode dio --flash_size 8m 0x0 AiThinker_ESP8266_DIO_8M_8M_20160615_V1.5.4.bin</div></pre></td></tr></table></figure>
</li>
<li><p>这个升级问题折腾了我很久,今天总算是升级成功.它们的文档很杂,图与板子上的名称又不全部对应.</p>
</li>
</ul>
<h3 id="转换GBK文本文件的问题"><a href="#转换GBK文本文件的问题" class="headerlink" title="转换GBK文本文件的问题"></a>转换GBK文本文件的问题</h3><ul>
<li>有时在Linux下打开GBK编码的文件会出现乱码,优其是一些在window下载打包的源码压缩包,源码文件全都是GBK编码.在Linux下用一些文本编辑器打开全是乱码,有些甚至连目录都是乱码.</li>
<li>下面记录一个shell脚本批量转换成UTF8格式的文件.<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ cat convert.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">TMP_IFS=<span class="variable">$IFS</span></div><div class="line">IFS=$(<span class="built_in">echo</span> -en <span class="string">"\n\b"</span>)</div><div class="line"><span class="keyword">for</span> f <span class="keyword">in</span> `find . -type f`;<span class="keyword">do</span> </div><div class="line">    org=$(file <span class="variable">$f</span>)</div><div class="line">    string=$(<span class="built_in">echo</span> <span class="variable">$org</span> | grep <span class="string">"ISO-8859"</span>) ;</div><div class="line">    <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$string</span>"</span> ]; <span class="keyword">then</span> </div><div class="line">        infile=$(<span class="built_in">echo</span> <span class="variable">$string</span> | awk -F<span class="string">':'</span> <span class="string">'&#123;print $1&#125;'</span>);</div><div class="line">        <span class="comment">#echo $infile</span></div><div class="line">        iconv <span class="_">-f</span> GBK -t UTF8 <span class="variable">$infile</span> &gt; 1;</div><div class="line">        mv 1 <span class="variable">$infile</span>;</div><div class="line">    <span class="keyword">fi</span> ;</div><div class="line"><span class="keyword">done</span></div><div class="line">IFS=<span class="variable">$TMP_IFS</span></div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">TMP_IFS=<span class="variable">$IFS</span></div><div class="line">IFS=$(<span class="built_in">echo</span> -en <span class="string">"\n\b"</span>)</div><div class="line"></div><div class="line"><span class="keyword">for</span> f <span class="keyword">in</span> `find  . \( -iname <span class="string">"*.txt"</span> -o -iname <span class="string">"*.c"</span> -o -iname <span class="string">"*.h"</span> \)`;<span class="keyword">do</span> </div><div class="line">    iconv <span class="_">-f</span> GBK -t UTF8 -c <span class="variable">$f</span> &gt; 1; mv 1 <span class="variable">$f</span>;</div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure>
<ul>
<li>在转换文件时,有时候路径中会包含空格,如果不按照上面的方式设置<code>IFS</code>变量,脚本就会出错在有空格的地方分隔,认为是两个文件.上面这个脚本只是</li>
<li>一个很简单的处理当前目录下所有文件的转换.还可以把它写的更通用灵活.</li>
</ul>
<hr>
<h3 id="批量清除文件名中的特定字符串"><a href="#批量清除文件名中的特定字符串" class="headerlink" title="批量清除文件名中的特定字符串"></a>批量清除文件名中的特定字符串</h3><ul>
<li>有时从网站下载一些文件,资源经会把自已的名字或者网址加在文件名如: <code>电影名_[www.xxx.com].mkv</code>,这样的格式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">TMP_IFS=$IFS</div><div class="line">IFS=$(echo -en &quot;\n\b&quot;)</div><div class="line">sub1=&quot;www\.xxx\.com&quot;</div><div class="line">sub2=&quot;www\.bbb\.com&quot;</div><div class="line">sub3=&quot;www\.ccc\.com&quot;</div><div class="line">#sub4=&quot;[(]www.ddd.com[)]&quot;  # 例如:  fname-(www.ddd.com).pdf, sed -re &quot;s/$sub4//g&quot;</div><div class="line"></div><div class="line">for fname in `ls`;</div><div class="line">do</div><div class="line">	string=$(echo $fname)</div><div class="line">	if [[ $string = *$&#123;sub1&#125;* || $string = *$&#123;sub2&#125;* || $string = *$&#123;sub3&#125;*  || $string = *$&#123;sub4&#125;* ]];</div><div class="line">	then</div><div class="line">    	nstring=$(echo $s | sed -e &quot;s/$&#123;sub1&#125;//g&quot; -e &quot;s/$sub2//g&quot; -e &quot;s/$sub3//g&quot; -e &quot;s/\(()\)//g/&quot; -e &quot;s/\[[]\]//g&quot; )</div><div class="line">      </div><div class="line">        echo $nstring</div><div class="line">        mv $f $nstring</div><div class="line">    fi</div><div class="line">done</div><div class="line"></div><div class="line">IFS=$TMP_IFS</div></pre></td></tr></table></figure>
<hr>
<h3 id="Linux-下-wireless-WPA加密连接"><a href="#Linux-下-wireless-WPA加密连接" class="headerlink" title="Linux 下 wireless  WPA加密连接"></a>Linux 下 wireless  WPA加密连接</h3><ul>
<li><p>确保安装了wpasupplicant</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install wpasupplicant.</div></pre></td></tr></table></figure>
</li>
<li><p>创建 /etc/wpa_supplicant.conf 或者从 <strong>/usr/share/doc/wpa_supplicant/examples/wpa_supplicant.conf.gz</strong> 复制 </p>
</li>
<li><p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">network=&#123;</div><div class="line">    ssid=&quot;ssid_name&quot;</div><div class="line">    psk=&quot;password&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>手动命令行连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo wpa_supplicant -B -iwlan0 -c/etc/wpa_supplicant.conf -Dwext</div><div class="line">$ sudo dhclient wlan0</div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="Linux-下是使用蓝牙串口通信"><a href="#Linux-下是使用蓝牙串口通信" class="headerlink" title="Linux 下是使用蓝牙串口通信"></a>Linux 下是使用蓝牙串口通信</h3><ul>
<li>Linux 下使用蓝牙工具要安装<code>bluez</code>软件,有一个图形配置程序<code>blueman</code>,使用会报一些Python与Dbus的错误,还是直接修改配置文件解决使用问题.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ cat /etc/bluetooth/rfcomm.conf </div><div class="line">rfcomm0 &#123;</div><div class="line">        <span class="built_in">bind</span> yes;</div><div class="line">        device 00:15:83:00:43:AB</div><div class="line">        channel 0;</div><div class="line">        comment <span class="string">"Serial Port"</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">rfcomm1 &#123;</div><div class="line">    <span class="built_in">bind</span> yes;</div><div class="line">    device 00:14:01:22:14:49;</div><div class="line">    channel 1;</div><div class="line">    connment <span class="string">"Serial Port 1"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="配对蓝牙"><a href="#配对蓝牙" class="headerlink" title="配对蓝牙"></a>配对蓝牙</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ bluetoothctl </div><div class="line">[NEW] Controller 00:02:5B:0A:59:3A debian-0 [default]</div><div class="line">[NEW] Device 00:14:01:22:14:49 lcy</div><div class="line">[bluetooth]# power on</div><div class="line">Changing power on succeeded</div><div class="line">[bluetooth]# agent on</div><div class="line">Agent registered</div><div class="line">[bluetooth]# pair 00:14:01:22:14:49</div><div class="line">Attempting to pair with 00:14:01:22:14:49</div><div class="line">[CHG] Device 00:14:01:22:14:49 Connected: yes</div><div class="line">Request PIN code</div><div class="line">[agent] Enter PIN code: 1234</div><div class="line">[CHG] Device 00:14:01:22:14:49 Paired: yes</div><div class="line">Pairing successful</div><div class="line">[CHG] Device 00:14:01:22:14:49 Connected: no</div></pre></td></tr></table></figure>
<h4 id="手动边接RFCOMM串口"><a href="#手动边接RFCOMM串口" class="headerlink" title="手动边接RFCOMM串口"></a>手动边接RFCOMM串口</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> sudo rfcomm connect /dev/rfcomm0 00:14:01:22:14:49 1</div><div class="line">Connected /dev/rfcomm0 to 00:14:01:22:14:49 on channel 1</div><div class="line">Press CTRL-C <span class="keyword">for</span> hangup</div></pre></td></tr></table></figure>
<ul>
<li>运行上面的命令无错,就可以使用minicom 连接它了,<code>sudo minicom  -o -b 115200 -D /dev/rfcomm0</code></li>
</ul>
<h3 id="Linux-Systemctl-启动服务超时设置"><a href="#Linux-Systemctl-启动服务超时设置" class="headerlink" title="Linux Systemctl 启动服务超时设置"></a>Linux Systemctl 启动服务超时设置</h3><ul>
<li>下面用一个网络连接服务为示例,如果网络配置是DHCP,刚好网络没有提供DHCP服务,这时该服务程序会重试(默认)两分钟才会报错,这里可以设置成5到10秒,快速跳过该服务启动.</li>
<li>在文件/lib/systemd/system/networking.service.d/network-pre.conf里添加下面两行:<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[Service]</div><div class="line">TimeoutStartSec=15</div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="BOSSAC-烧写Arduino-DUE无法找到设备"><a href="#BOSSAC-烧写Arduino-DUE无法找到设备" class="headerlink" title="BOSSAC 烧写Arduino-DUE无法找到设备"></a>BOSSAC 烧写Arduino-DUE无法找到设备</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">./bossac -i <span class="_">-d</span> --port=ttyACM0 -U <span class="literal">false</span> <span class="_">-e</span> -w -v -b ./nuttx.bin -R</div><div class="line"></div><div class="line"></div><div class="line">Set binary mode</div><div class="line">Send auto-baud</div><div class="line">Set binary mode</div><div class="line">No device found on /dev/ttyACM0</div></pre></td></tr></table></figure>
<h4 id="处理方法"><a href="#处理方法" class="headerlink" title="处理方法"></a>处理方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">stty -F /dev/ttyACM0 speed 1200 cs8 -cstopb -parenb</div></pre></td></tr></table></figure>
<hr>
<h3 id="Virt-Manager-虚拟机无法启动"><a href="#Virt-Manager-虚拟机无法启动" class="headerlink" title="Virt-Manager 虚拟机无法启动"></a>Virt-Manager 虚拟机无法启动</h3><ul>
<li>有时KVM框架虚拟机系统无法启动,错误如下:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Error starting domain: Requested operation is not valid: network &apos;default&apos; is not active</div><div class="line"></div><div class="line">Traceback (most recent call last):</div><div class="line">[...]</div></pre></td></tr></table></figure>
<ul>
<li>通过如下命令启动网络即可.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">~$ sudo virsh net-list --all </div><div class="line"> Name                 State      Autostart     Persistent</div><div class="line">----------------------------------------------------------</div><div class="line"> default              inactive   no            yes</div><div class="line"></div><div class="line">~$ sudo virsh net-start default</div><div class="line">Network default started</div></pre></td></tr></table></figure>
<hr>
<h3 id="创建Debian-Live-USB系统盘"><a href="#创建Debian-Live-USB系统盘" class="headerlink" title="创建Debian Live USB系统盘"></a>创建Debian Live USB系统盘</h3><ul>
<li>如果想要试用Linux,又不想安装它,可以把它烧写到U盘里,做为启动盘或者系统恢复盘.</li>
<li><a href="http://mirrors.163.com/debian-cd" target="_blank" rel="external"><code>Debian 国内镜像下载链接</code></a></li>
<li><strong>注意:</strong> 这里一定要选择<code>live</code>标志的iso镜像下载.在windows下面要先下载一个叫<a href="http://launchpad.net/win32-image-writer/0.2/0.2/+download/win32diskimager-RELEASE-0.2-r23-win32.zip" target="_blank" rel="external"><code>Win32DiskImager</code></a>的烧写工具,Linux 就很简单使用下面命令就能完成:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ ls  debian-live-9.4.0-amd64-mate.iso </div><div class="line">debian-live-9.4.0-amd64-mate.iso</div><div class="line">$ sudo dd if=debian-live-9.4.0-amd64-mate.iso of=/dev/sdc1 </div><div class="line">4002944+0 records in</div><div class="line">4002944+0 records out</div><div class="line">2049507328 bytes (2.0 GB, 1.9 GiB) copied, 7.39192 s, 277 MB/s</div></pre></td></tr></table></figure>
<ul>
<li><strong>严重注意</strong> 这里的<code>/dev/sdc1</code>一要是你想要格式华的U盘,如果这里是当前硬盘,或者是有重要资料的盘符,就会直接覆盖它,找不回来.<strong>注意,注意,注意</strong></li>
</ul>
<hr>
<h3 id="谢谢打赏支持"><a href="#谢谢打赏支持" class="headerlink" title="谢谢打赏支持"></a>谢谢打赏支持</h3><ul>
<li>您的打赏将会鼓励我写出更多的博客。  </li>
<li>微信二维码:</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/26/常见编译问题-不定期更新/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/26/常见编译问题-不定期更新/" itemprop="url">
                  常见编译问题,不定期更新.
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-08-26 00:00:00" itemprop="dateCreated datePublished" datetime="2016-08-26T00:00:00+08:00">2016-08-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-12-25 22:27:00" itemprop="dateModified" datetime="2017-12-25T22:27:00+08:00">2017-12-25</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/笔记/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="GCC-编译出错"><a href="#GCC-编译出错" class="headerlink" title="GCC 编译出错"></a>GCC 编译出错</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">In file included from /home/michael/3TB-DISK/Embedded-System/NuttX/buildroot/toolchain_build_arm_nofpu/gcc-4.8.5/gcc/cp/except.c:1008:0:</div><div class="line">cfns.gperf: In <span class="keyword">function</span> ‘const char* libc_name_p(const char*, unsigned int)’:</div><div class="line">cfns.gperf:101:1: error: ‘const char* libc_name_p(const char*, unsigned int)’ redeclared inline with ‘gnu_inline’ attribute</div><div class="line">cfns.gperf:26:14: note: ‘const char* libc_name_p(const char*, unsigned int)’ previously declared here</div><div class="line">cfns.gperf: At global scope:</div><div class="line">cfns.gperf:26:14: warning: inline <span class="keyword">function</span> ‘const char* libc_name_p(const char*, unsigned int)’ used but never defined</div><div class="line">Makefile:1059: recipe <span class="keyword">for</span> target <span class="string">'cp/except.o'</span> failed</div><div class="line">make[3]: *** [cp/except.o] Error 1</div></pre></td></tr></table></figure>
<h4 id="处理方法"><a href="#处理方法" class="headerlink" title="处理方法"></a>处理方法</h4><ul>
<li>添加条件宏定义到这两个文件中<strong>gcc-4.8.5/gcc/cp/cfns.{gperf,h} </strong></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">19	<span class="comment">#ifdef __GNUC__</span></div><div class="line">   20	__inline</div><div class="line">   21	<span class="comment">#endif</span></div><div class="line">   22	static unsigned int <span class="built_in">hash</span> (const char *, unsigned int);</div><div class="line">   23	<span class="comment">#ifdef __GNUC__</span></div><div class="line">   24	__inline</div><div class="line">   25	<span class="comment">#ifdef __GNUC_STDC_INLINE__</span></div><div class="line">   26	__attribute__ ((__gnu_inline__))</div><div class="line">   27	<span class="comment">#endif</span></div><div class="line">   28	<span class="comment">#endif</span></div><div class="line">   29	const char * libc_name_p (const char *, unsigned int);</div></pre></td></tr></table></figure>
<h4 id="编译gcc-texi-出错如下"><a href="#编译gcc-texi-出错如下" class="headerlink" title="编译gcc texi 出错如下:"></a>编译gcc texi 出错如下:</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/home/michael/3TB-DISK/Embedded-System/NuttX/buildroot/toolchain_build_arm_nofpu/gcc-4.8.5/gcc/doc/gcc.texi:88: warning: @tex should only appear at the beginning of a line</div><div class="line">/home/michael/3TB-DISK/Embedded-System/NuttX/buildroot/toolchain_build_arm_nofpu/gcc-4.8.5/gcc/doc/gcc.texi:208: no matching `@end tex<span class="string">'</span></div><div class="line">/home/michael/3TB-DISK/Embedded-System/NuttX/buildroot/toolchain_build_arm_nofpu/gcc-4.8.5/gcc/doc/gcc.texi:208: no matching `@end multitable'</div><div class="line">/home/michael/3TB-DISK/Embedded-System/NuttX/buildroot/toolchain_build_arm_nofpu/gcc-4.8.5/gcc/doc/gcc.texi:208: no matching `@end titlepage<span class="string">'</span></div><div class="line">Makefile:4353: recipe for target 'doc/gcc.info<span class="string">' failed</span></div><div class="line">make[3]: *** [doc/gcc.info] Error 1</div><div class="line">make[3]: Leaving directory '/home/michael/3TB-DISK/Embedded-System/NuttX/buildroot/toolchain_build_arm_nofpu/gcc-4.8.5-build/gcc<span class="string">'</span></div><div class="line">Makefile:3889: recipe for target 'all-gcc<span class="string">' failed</span></div></pre></td></tr></table></figure>
<h4 id="处理方法-1"><a href="#处理方法-1" class="headerlink" title="处理方法"></a>处理方法</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$cd</span> /home/michael/3TB-DISK/Embedded-System/NuttX/buildroot/toolchain_build_arm_nofpu/gcc-4.8.5-build/gcc</div><div class="line">$ vi Makefile</div><div class="line">注释 doc: 这一行,跳过编译doc相关的东西</div></pre></td></tr></table></figure>
<h3 id="C-函数定义错误"><a href="#C-函数定义错误" class="headerlink" title="C++ 函数定义错误"></a>C++ 函数定义错误</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">libxx_new.cxx:66:40: error: &apos;operator new&apos; takes type &apos;size_t&apos; (&apos;unsigned int&apos;) as first parameter [-fpermissive]</div><div class="line"> void *operator new(unsigned long nbytes)</div><div class="line">                                        ^</div><div class="line">Makefile:111: recipe for target &apos;libxx_new.o&apos; failed</div><div class="line">make[1]: *** [libxx_new.o] Error 1</div></pre></td></tr></table></figure>
<h4 id="处理方法-2"><a href="#处理方法-2" class="headerlink" title="处理方法"></a>处理方法</h4><ul>
<li><p>Linux 下要定义成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">void *operator new(size_t nbytes)</div></pre></td></tr></table></figure>
</li>
<li><p>MinGW 下要定义成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#ifdef CONFIG_CXX_NEWLONG</div><div class="line">void *operator new(unsigned long nbytes)</div><div class="line">#else</div><div class="line">void *operator new(unsigned int nbytes)</div><div class="line">#endif</div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="谢谢打赏支持"><a href="#谢谢打赏支持" class="headerlink" title="谢谢打赏支持"></a>谢谢打赏支持</h3><ul>
<li>您的打赏将会鼓励我写出更多的博客。  </li>
<li>微信二维码:</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/06/为Radeon驱动编译Mesa-GLX支持/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/06/为Radeon驱动编译Mesa-GLX支持/" itemprop="url">
                  为Radeon驱动编译Mesa-GLX支持
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-08-06 00:00:00" itemprop="dateCreated datePublished" datetime="2016-08-06T00:00:00+08:00">2016-08-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2016-12-14 22:19:00" itemprop="dateModified" datetime="2016-12-14T22:19:00+08:00">2016-12-14</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/笔记/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本人有空会折腾编译最新的Linux内核,使用的笔记本电脑又AMD的平台,AMD显卡fglrx驱动一直是一个巨大的坑,<br>没有一次可以完全正常编译的,对于不同的内核本版要打无数的补丁才能编译成功,且它的驱动不支持VAPDU特性.<br>对于不是很新的显卡用开源的radeon驱动都能很好的使用.</p>
<p>[参考链接]<br><a href="http://www.linuxfromscratch.org/blfs/view/svn/x/mesa.html" target="_blank" rel="external">Mesa-12.0.1</a></p>
<h3 id="安装依赖库"><a href="#安装依赖库" class="headerlink" title="安装依赖库"></a>安装依赖库</h3><h4 id="LLVM-3-8"><a href="#LLVM-3-8" class="headerlink" title="LLVM-3.8"></a>LLVM-3.8</h4><p><a href="http://llvm.org/releases/3.8.0/clang+llvm-3.8.0-x86_64-linux-gnu-debian8.tar.xz" target="_blank" rel="external">下载</a>LLVM3.8后解压到<br><code>/usr/local/clang+llvm-3.8.0-x86_64-linux-gnu-debian8</code></p>
<ul>
<li><a href="https://dri.freedesktop.org/libdrm/libdrm-2.4.68.tar.bz2" target="_blank" rel="external">libdrm-2.4.68</a></li>
<li><p>下载后解压编译如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ ../configure --enable-udev --enable-radeon --enable-amdgpu --disable-intel --disable-nouveau --disable-vmwgfx</div><div class="line">[...]</div><div class="line">$ make &amp;&amp; sudo make install</div></pre></td></tr></table></figure>
</li>
<li><p>下面这些依赖的库文件很简单的编译,直接解压进去,<code>./configure &amp;&amp; make &amp;&amp; make install</code> 就可以了,</p>
</li>
<li>安装的目录在<code>/usr/local</code>,如果编译过程碰到错误,就是少某些头文件,安装它就可以继续编译了.<br>&gt;</li>
</ul>
<ul>
<li><a href="https://www.x.org/archive/individual/proto/dri2proto-2.8.tar.bz2" target="_blank" rel="external">dri2proto-2.8</a></li>
<li><a href="http://people.freedesktop.org/~aplattner/vdpau/libvdpau-1.1.1.tar.bz2" target="_blank" rel="external">libvdpau-1.1.1</a></li>
<li><a href="https://fedorahosted.org/releases/e/l/elfutils/0.166/elfutils-0.166.tar.bz2" target="_blank" rel="external">elfutils-0.166</a></li>
<li><a href="https://www.freedesktop.org/software/vaapi/releases/libva/libva-1.7.3.tar.bz2" target="_blank" rel="external">libva-1.7.3</a></li>
</ul>
<p>&gt;</p>
<h3 id="安装libva"><a href="#安装libva" class="headerlink" title="安装libva"></a>安装libva</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$  ../configure --enable-x11 --enable-drm  --enable-egl --enable-glx </div><div class="line">$ make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h3 id="安装MESA"><a href="#安装MESA" class="headerlink" title="安装MESA"></a>安装MESA</h3><p><a href="ftp://ftp.freedesktop.org/pub/mesa/12.0.1/mesa-12.0.1.tar.xz" target="_blank" rel="external">mesa-12.0.1</a><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ tar xvf mesa-12.0.1.tar.gz</div><div class="line">$ <span class="built_in">cd</span> mesa-12.0.1 &amp;&amp; mkdir build &amp;&amp; <span class="built_in">cd</span> build</div><div class="line">$ GLL_DRV=<span class="string">"r300,r600,radeonsi,swrast"</span></div><div class="line">$ ../autogen.sh --enable-dri --enable-glx --enable-vdpau  --enable-opencl --enable-opencl-icd \</div><div class="line">  --enable-glx-tls --with-llvm-prefix=/usr/<span class="built_in">local</span>/clang+llvm-3.8.0-x86_64-linux-gnu-debian8 \ </div><div class="line">  --disable-llvm-shared-libs --enable-egl --enable-gbm \</div><div class="line">    --enable-texture-float --enable-xa --with-gallium-drivers=<span class="variable">$GLL_DRV</span> \</div><div class="line">    --with-dri-drivers=radeon --with-egl-platforms=drm,x11 --enable-gles1 \</div><div class="line">    --enable-gles2 --enable-osmesa --enable-va --with-osmesa-bits=32 --enable-gallium-extra-hud</div><div class="line">[....]</div><div class="line">$ make install</div></pre></td></tr></table></figure></p>
<ul>
<li><strong>替换系统的MESA库</strong><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$cd</span> /usr/lib/x86_64-linux-gnu/dri </div><div class="line">debian:/usr/lib/x86_64-linux-gnu/dri$ ls <span class="_">-l</span></div><div class="line">total 82908</div><div class="line">-rw-r--r-- 1 root root   22504 Oct 24  2014 dummy_drv_video.so</div><div class="line">-rw-r--r-- 5 root root 5505624 Aug 20  2015 i915_dri.so</div><div class="line">-rw-r--r-- 5 root root 5505624 Aug 20  2015 i965_dri.so</div><div class="line">-rw-r--r-- 7 root root 8175344 Aug 20  2015 kms_swrast_dri.so</div><div class="line">-rw-r--r-- 7 root root 8175344 Aug 20  2015 nouveau_dri.so</div><div class="line">lrwxrwxrwx 1 root root      18 Aug  8  2014 nouveau_drv_video.so -&gt; vdpau_drv_video.so</div><div class="line">-rw-r--r-- 5 root root 5505624 Aug 20  2015 nouveau_vieux_dri.so</div><div class="line">lrwxrwxrwx 1 root root      18 Aug  8  2014 nvidia_drv_video.so -&gt; vdpau_drv_video.so</div><div class="line">-rw-r--r-- 5 root root 5505624 Aug 20  2015 r200_dri.so</div><div class="line">-rw-r--r-- 7 root root 8175344 Aug 20  2015 r300_dri.so</div><div class="line">lrwxrwxrwx 1 root root      30 Aug  6 23:20 r600_dri.so -&gt; /usr/<span class="built_in">local</span>/lib/dri/r600_dri.so</div><div class="line">-rw-r--r-- 7 root root 8175344 Aug 20  2015 r600_dri.so.org</div><div class="line">lrwxrwxrwx 1 root root      18 Aug  8  2014 r600_drv_video.so -&gt; vdpau_drv_video.so</div><div class="line">-rw-r--r-- 5 root root 5505624 Aug 20  2015 radeon_dri.so</div><div class="line">-rw-r--r-- 7 root root 8175344 Aug 20  2015 radeonsi_dri.so</div><div class="line">lrwxrwxrwx 1 root root      18 Aug  8  2014 radeonsi_drv_video.so -&gt; vdpau_drv_video.so</div><div class="line">lrwxrwxrwx 1 root root      18 Aug  8  2014 s3g_drv_video.so -&gt; vdpau_drv_video.so</div><div class="line">lrwxrwxrwx 1 root root      32 Aug  7 00:46 swrast_dri.so -&gt; /usr/<span class="built_in">local</span>/lib/dri/swrast_dri.so</div><div class="line">-rw-r--r-- 7 root root 8175344 Aug 20  2015 swrast_dri.so.org</div><div class="line">-rw-r--r-- 1 root root   97056 Aug  8  2014 vdpau_drv_video.so</div><div class="line">-rw-r--r-- 7 root root 8175344 Aug 20  2015 vmwgfx_dri.so</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">ls /usr/lib/x86_64-linux-gnu/libdrm_* -l</div><div class="line">lrwxrwxrwx 1 root root     37 Dec 11 19:14 /usr/lib/x86_64-linux-gnu/libdrm_amdgpu.so -&gt; /usr/local/lib/libdrm_amdgpu.so.1.0.0</div><div class="line">-rw-r--r-- 1 root root 206760 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_intel.a</div><div class="line">lrwxrwxrwx 1 root root     30 Dec 11 13:30 /usr/lib/x86_64-linux-gnu/libdrm_intel.so -&gt; /usr/local/lib/libdrm_intel.so</div><div class="line">lrwxrwxrwx 1 root root     21 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_intel.so.1 -&gt; libdrm_intel.so.1.0.0</div><div class="line">-rw-r--r-- 1 root root 139328 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_intel.so.1.0.0</div><div class="line">-rw-r--r-- 1 root root  31552 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_nouveau.a</div><div class="line">lrwxrwxrwx 1 root root     32 Dec 11 13:30 /usr/lib/x86_64-linux-gnu/libdrm_nouveau.so -&gt; /usr/local/lib/libdrm_nouveau.so</div><div class="line">lrwxrwxrwx 1 root root     23 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_nouveau.so.2 -&gt; libdrm_nouveau.so.2.0.0</div><div class="line">-rw-r--r-- 1 root root  26896 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_nouveau.so.2.0.0</div><div class="line">-rw-r--r-- 1 root root  71708 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_radeon.a</div><div class="line">lrwxrwxrwx 1 root root     37 Dec 11 19:13 /usr/lib/x86_64-linux-gnu/libdrm_radeon.so -&gt; /usr/local/lib/libdrm_radeon.so.1.0.1</div><div class="line">lrwxrwxrwx 1 root root     37 Dec 11 19:13 /usr/lib/x86_64-linux-gnu/libdrm_radeon.so.1 -&gt; /usr/local/lib/libdrm_radeon.so.1.0.1</div><div class="line">-rw-r--r-- 1 root root  51688 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_radeon.so.1.0.1</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">for i in &#123;drm,egl,glx,va,tpi,wayland,x11&#125;;do sudo ln -svf /usr/local/lib/libva-$i.so.1.3904.0 libva-$i.so.1  ;done</div><div class="line">‘libva-drm.so.1’ -&gt; ‘/usr/local/lib/libva-drm.so.1.3904.0’</div><div class="line">‘libva-egl.so.1’ -&gt; ‘/usr/local/lib/libva-egl.so.1.3904.0’</div><div class="line">‘libva-glx.so.1’ -&gt; ‘/usr/local/lib/libva-glx.so.1.3904.0’</div><div class="line">‘libva-va.so.1’ -&gt; ‘/usr/local/lib/libva-va.so.1.3904.0’</div><div class="line">‘libva-tpi.so.1’ -&gt; ‘/usr/local/lib/libva-tpi.so.1.3904.0’</div><div class="line">‘libva-wayland.so.1’ -&gt; ‘/usr/local/lib/libva-wayland.so.1.3904.0’</div><div class="line">‘libva-x11.so.1’ -&gt; ‘/usr/local/lib/libva-x11.so.1.3904.0’</div><div class="line">michael@debian:/usr/lib/x86_64-linux-gnu$ for i in &#123;drm,egl,glx,va,tpi,wayland,x11&#125;;do sudo ln -svf /usr/local/lib/libva-$i.so.1.3904.0 libva-$i.so  ;done</div><div class="line">‘libva-drm.so’ -&gt; ‘/usr/local/lib/libva-drm.so.1.3904.0’</div><div class="line">‘libva-egl.so’ -&gt; ‘/usr/local/lib/libva-egl.so.1.3904.0’</div><div class="line">‘libva-glx.so’ -&gt; ‘/usr/local/lib/libva-glx.so.1.3904.0’</div><div class="line">‘libva-va.so’ -&gt; ‘/usr/local/lib/libva-va.so.1.3904.0’</div><div class="line">‘libva-tpi.so’ -&gt; ‘/usr/local/lib/libva-tpi.so.1.3904.0’</div><div class="line">‘libva-wayland.so’ -&gt; ‘/usr/local/lib/libva-wayland.so.1.3904.0’</div><div class="line">‘libva-x11.so’ -&gt; ‘/usr/local/lib/libva-x11.so.1.3904.0’</div></pre></td></tr></table></figure>
<ul>
<li>进入到系统MESA库目录下</li>
<li><p>下面文件中有一些是<code>.org</code>结尾是的系统的MESA库文,为保险起见保留了它</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$cd</span> /usr/lib/mesa-diverted/x86_64-linux-gnu</div><div class="line">$/usr/lib/mesa-diverted/x86_64-linux-gnu$ ls <span class="_">-l</span></div><div class="line">total 836</div><div class="line">lrwxrwxrwx 1 root root     15 Aug 20  2015 libEGL.so -&gt; libEGL.so.1.0.0</div><div class="line">lrwxrwxrwx 1 root root     15 Aug 20  2015 libEGL.so.1 -&gt; libEGL.so.1.0.0</div><div class="line">lrwxrwxrwx 1 root root     30 Aug  7 01:08 libEGL.so.1.0.0 -&gt; /usr/<span class="built_in">local</span>/lib/libEGL.so.1.0.0</div><div class="line">-rw-r--r-- 1 root root 173144 Aug 20  2015 libEGL.so.1.0.0.org</div><div class="line">lrwxrwxrwx 1 root root     21 Aug 20  2015 libGLESv1_CM.so -&gt; libGLESv1_CM.so.1.1.0</div><div class="line">lrwxrwxrwx 1 root root     21 Aug 20  2015 libGLESv1_CM.so.1 -&gt; libGLESv1_CM.so.1.1.0</div><div class="line">lrwxrwxrwx 1 root root     36 Aug  7 01:08 libGLESv1_CM.so.1.1.0 -&gt; /usr/<span class="built_in">local</span>/lib/libGLESv1_CM.so.1.1.0</div><div class="line">-rw-r--r-- 1 root root  18232 Aug 20  2015 libGLESv1_CM.so.1.1.0.org</div><div class="line">lrwxrwxrwx 1 root root     18 Aug 20  2015 libGLESv2.so -&gt; libGLESv2.so.2.0.0</div><div class="line">lrwxrwxrwx 1 root root     18 Aug 20  2015 libGLESv2.so.2 -&gt; libGLESv2.so.2.0.0</div><div class="line">lrwxrwxrwx 1 root root     33 Aug  7 01:10 libGLESv2.so.2.0.0 -&gt; /usr/<span class="built_in">local</span>/lib/libGLESv2.so.2.0.0</div><div class="line">-rw-r--r-- 1 root root  26424 Aug 20  2015 libGLESv2.so.2.0.0.org</div><div class="line">lrwxrwxrwx 1 root root     10 Aug  6 22:07 libGL.so -&gt; libGL.so.1</div><div class="line">lrwxrwxrwx 1 root root     14 Aug 20  2015 libGL.so.1 -&gt; libGL.so.1.2.0</div><div class="line">lrwxrwxrwx 1 root root     29 Aug  7 01:10 libGL.so.1.2.0 -&gt; /usr/<span class="built_in">local</span>/lib/libGL.so.1.2.0</div><div class="line">-rw-r--r-- 1 root root 627320 Aug 20  2015 libGL.so.1.2.0.org</div></pre></td></tr></table></figure>
</li>
<li><p>查看本机的显卡数量,我这台笔记本电脑有两个GPU如下:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ lspci | grep <span class="string">"VGA"</span></div><div class="line">00:01.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] BeaverCreek [Radeon HD 6520G]</div><div class="line">01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Thames [Radeon HD 7500M/7600M Series]</div></pre></td></tr></table></figure>
</li>
<li><p>我这里修改/etc/X11/xorg.conf如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line">$ grep -v &apos;#|^$&apos; /etc/X11/xorg.conf</div><div class="line">Section &quot;ServerLayout&quot;</div><div class="line">    Identifier     &quot;X.org Configured&quot;</div><div class="line">    Screen      0  &quot;Screen0&quot; 0 0</div><div class="line">    Screen      1  &quot;Screen1&quot; RightOf &quot;Screen0&quot;</div><div class="line">    InputDevice    &quot;Mouse0&quot; &quot;CorePointer&quot;</div><div class="line">    InputDevice    &quot;Keyboard0&quot; &quot;CoreKeyboard&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Files&quot;</div><div class="line">    ModulePath   &quot;/usr/local/lib/xorg/modules&quot;</div><div class="line">    ModulePath   &quot;/usr/lib/xorg/modules&quot;</div><div class="line">    FontPath     &quot;/usr/share/fonts/X11/misc&quot;</div><div class="line">    FontPath     &quot;/usr/share/fonts/X11/cyrillic&quot;</div><div class="line">    FontPath     &quot;/usr/share/fonts/X11/100dpi/:unscaled&quot;</div><div class="line">    FontPath     &quot;/usr/share/fonts/X11/75dpi/:unscaled&quot;</div><div class="line">    FontPath     &quot;/usr/share/fonts/X11/Type1&quot;</div><div class="line">    FontPath     &quot;/usr/share/fonts/X11/100dpi&quot;</div><div class="line">    FontPath     &quot;/usr/share/fonts/X11/75dpi&quot;</div><div class="line">    FontPath     &quot;built-ins&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Module&quot;</div><div class="line">    Load  &quot;glx&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;InputDevice&quot;</div><div class="line">    Identifier  &quot;Keyboard0&quot;</div><div class="line">    Driver      &quot;kbd&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;InputDevice&quot;</div><div class="line">    Identifier  &quot;Mouse0&quot;</div><div class="line">    Driver      &quot;mouse&quot;</div><div class="line">    Option      &quot;Protocol&quot; &quot;auto&quot;</div><div class="line">    Option      &quot;Device&quot; &quot;/dev/input/mice&quot;</div><div class="line">    Option      &quot;ZAxisMapping&quot; &quot;4 5 6 7&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Monitor&quot;</div><div class="line">    Identifier   &quot;Monitor0&quot;</div><div class="line">    VendorName   &quot;Monitor Vendor&quot;</div><div class="line">    ModelName    &quot;Monitor Model&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Monitor&quot;</div><div class="line">    Identifier   &quot;Monitor1&quot;</div><div class="line">    VendorName   &quot;Monitor Vendor&quot;</div><div class="line">    ModelName    &quot;Monitor Model&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line"></div><div class="line">Section &quot;Device&quot;</div><div class="line">        ### Available Driver options are:-</div><div class="line">        ### Values: &lt;i&gt;: integer, &lt;f&gt;: float, &lt;bool&gt;: &quot;True&quot;/&quot;False&quot;,</div><div class="line">        ### &lt;string&gt;: &quot;String&quot;, &lt;freq&gt;: &quot;&lt;f&gt; Hz/kHz/MHz&quot;,</div><div class="line">        ### &lt;percent&gt;: &quot;&lt;f&gt;%&quot;</div><div class="line">        ### [arg]: arg optional</div><div class="line">        #Option     &quot;Accel&quot;                 # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;SWcursor&quot;              # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;EnablePageFlip&quot;        # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;ColorTiling2D&quot;         # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;RenderAccel&quot;           # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;SubPixelOrder&quot;         # [&lt;str&gt;]</div><div class="line">        #Option     &quot;AccelMethod&quot;           &quot;glamor&quot;</div><div class="line">        Option     &quot;DRI&quot;                &quot;3&quot;</div><div class="line">        Option     &quot;ColorTiling&quot;            &quot;1&quot;</div><div class="line">        Option     &quot;AccelMethod&quot;            &quot;EXA&quot;</div><div class="line">        Option      &quot;TearFree&quot;          &quot;on&quot;</div><div class="line">        #Option     &quot;EnablePageFlip&quot;     &quot;1&quot;</div><div class="line">        Option     &quot;RenderAccel&quot;        &quot;on&quot;    # [&lt;bool&gt;]</div><div class="line">        Option     &quot;AGPMode&quot;            &quot;4&quot;</div><div class="line">        #Option      &quot;AIGLX&quot;                 &quot;off&quot;</div><div class="line">        #Option     &quot;EXAVSync&quot;              # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;EXAPixmaps&quot;            # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;ZaphodHeads&quot;           # &lt;str&gt;</div><div class="line">        #Option     &quot;SwapbuffersWait&quot;       # [&lt;bool&gt;]</div><div class="line">    Identifier  &quot;Advanced Micro Devices, Inc. [AMD/ATI] BeaverCreek [Radeon HD 6520G]&quot;</div><div class="line">    Driver      &quot;radeon&quot;</div><div class="line">    BusID       &quot;PCI:0:1:0&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Device&quot;</div><div class="line">        ### Available Driver options are:-</div><div class="line">        ### Values: &lt;i&gt;: integer, &lt;f&gt;: float, &lt;bool&gt;: &quot;True&quot;/&quot;False&quot;,</div><div class="line">        ### &lt;string&gt;: &quot;String&quot;, &lt;freq&gt;: &quot;&lt;f&gt; Hz/kHz/MHz&quot;,</div><div class="line">        ### &lt;percent&gt;: &quot;&lt;f&gt;%&quot;</div><div class="line">        ### [arg]: arg optional</div><div class="line">        #Option     &quot;Accel&quot;                 # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;SWcursor&quot;              # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;EnablePageFlip&quot;        # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;ColorTiling&quot;           # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;ColorTiling2D&quot;         # [&lt;bool&gt;]</div><div class="line">        Option     &quot;RenderAccel&quot;        &quot;on&quot;    # [&lt;bool&gt;]</div><div class="line">        Option     &quot;AGPMode&quot;            &quot;4&quot;</div><div class="line">        #Option     &quot;SubPixelOrder&quot;         # [&lt;str&gt;]</div><div class="line">        #Option     &quot;AccelMethod&quot;           # &lt;str&gt;</div><div class="line">        #Option     &quot;EXAVSync&quot;              # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;EXAPixmaps&quot;            # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;ZaphodHeads&quot;           # &lt;str&gt;</div><div class="line">        #Option     &quot;EnablePageFlip&quot;        # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;SwapbuffersWait&quot;       # [&lt;bool&gt;]</div><div class="line">        #Option      &quot;AIGLX&quot;                 &quot;off&quot;</div><div class="line">        Option     &quot;DRI&quot;                &quot;3&quot;</div><div class="line">        Option     &quot;ColorTiling&quot;            &quot;1&quot;</div><div class="line">        Option     &quot;AccelMethod&quot;            &quot;EXA&quot;</div><div class="line">        Option      &quot;TearFree&quot;          &quot;on&quot;</div><div class="line">        #Option     &quot;EnablePageFlip&quot;     &quot;1&quot;</div><div class="line">    Identifier  &quot;Advanced Micro Devices, Inc. [AMD/ATI] Thames [Radeon HD 7500M/7600M Series]&quot;</div><div class="line">    Driver      &quot;radeon&quot;</div><div class="line">    BusID       &quot;PCI:1:0:0&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Screen&quot;</div><div class="line">    Identifier &quot;Screen0&quot;</div><div class="line">    Device     &quot;Card0&quot;</div><div class="line">    Monitor    &quot;Monitor0&quot;</div><div class="line">    SubSection &quot;Display&quot;</div><div class="line">        Viewport   0 0</div><div class="line">        Depth     24</div><div class="line">    EndSubSection</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Screen&quot;</div><div class="line">    Identifier &quot;Screen1&quot;</div><div class="line">    Device &quot;Card1&quot;</div><div class="line">    Monitor    &quot;Monitor1&quot;</div><div class="line">    SubSection &quot;Display&quot;</div><div class="line">        Viewport   0 0</div><div class="line">        Depth     24</div><div class="line">    EndSubSection</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Extensions&quot;</div><div class="line">    Option  &quot;Composite&quot;     &quot;Enable&quot;</div><div class="line">EndSection</div></pre></td></tr></table></figure>
</li>
<li><p>重启Xorg,用xrander 查看可用的GPU数量,下面显示两个GPU可供使用.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ xrandr --listproviders</div><div class="line">Providers: number : 2</div><div class="line">Provider 0: id: 0x8a <span class="built_in">cap</span>: 0xf, Source Output, Sink Output, Source Offload, Sink Offload crtcs: 2 outputs: 3 associated providers: 0 name:radeon</div><div class="line">Provider 1: id: 0x55 <span class="built_in">cap</span>: 0xf, Source Output, Sink Output, Source Offload, Sink Offload crtcs: 6 outputs: 0 associated providers: 0 name:radeon</div></pre></td></tr></table></figure>
</li>
<li><p>修改radeon驱动的内核参数,<a href="https://www.x.org/wiki/RadeonFeature/#index4h2" target="_blank" rel="external">RadeonFeature</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ cat /etc/modprobe.d/radeon.conf </div><div class="line">options radeon audio=1</div><div class="line">options radeon agpmode=1</div><div class="line">options radeon tv=1</div><div class="line">options radeon modeset=1</div></pre></td></tr></table></figure>
</li>
<li><p>测试GLX信息, 如下显示GLX功能正常</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ glxinfo | head -n 10</div><div class="line">name of display: :0.0</div><div class="line">display: :0  screen: 0</div><div class="line">direct rendering: Yes</div><div class="line">server glx vendor string: SGI</div><div class="line">server glx version string: 1.4</div><div class="line">server glx extensions:</div><div class="line">    GLX_ARB_create_context, GLX_ARB_create_context_profile, </div><div class="line">    GLX_ARB_create_context_robustness, GLX_ARB_fbconfig_float, </div><div class="line">    GLX_ARB_framebuffer_sRGB, GLX_ARB_multisample, </div><div class="line">    GLX_EXT_create_context_es2_profile, GLX_EXT_framebuffer_sRGB,</div><div class="line">   [...]</div></pre></td></tr></table></figure>
</li>
<li><p>检查VDPAU支持,如下显示已经开启VAPDU功能.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">$ vainfo</div><div class="line">libva info: VA-API version 0.36.0</div><div class="line">libva info: va_getDriverName() returns 0</div><div class="line">libva info: Trying to open /usr/lib/x86_64-linux-gnu/dri/r600_drv_video.so</div><div class="line">libva info: Found init <span class="keyword">function</span> __vaDriverInit_0_35</div><div class="line">libva info: va_openDriver() returns 0</div><div class="line">vainfo: VA-API version: 0.36 (libva 1.4.1)</div><div class="line">vainfo: Driver version: Splitted-Desktop Systems VDPAU backend <span class="keyword">for</span> VA-API - 0.7.4</div><div class="line">vainfo: Supported profile and entrypoints</div><div class="line">      VAProfileMPEG2Simple            : VAEntrypointVLD</div><div class="line">      VAProfileMPEG2Main              : VAEntrypointVLD</div><div class="line">      VAProfileMPEG4Simple            : VAEntrypointVLD</div><div class="line">      VAProfileMPEG4AdvancedSimple    : VAEntrypointVLD</div><div class="line">      VAProfileH264Baseline           : VAEntrypointVLD</div><div class="line">      VAProfileH264Main               : VAEntrypointVLD</div><div class="line">      VAProfileH264High               : VAEntrypointVLD</div><div class="line">      VAProfileVC1Simple              : VAEntrypointVLD</div><div class="line">      VAProfileVC1Main                : VAEntrypointVLD</div><div class="line">      VAProfileVC1Advanced            : VAEntrypointVLD</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="遇到过的名错误"><a href="#遇到过的名错误" class="headerlink" title="遇到过的名错误"></a>遇到过的名错误</h3><ul>
<li>检查Xorg错误信息 ,如果出现很多”EE”信息,轻则功能缺失,重则不能开启图界面,下面只有一个EE,没有找到出错的原因.<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ grep <span class="string">"EE"</span> /var/<span class="built_in">log</span>/Xorg.0.log</div><div class="line">    (WW) warning, (EE) error, (NI) not implemented, (??) unknown.</div><div class="line">[  6597.997] (EE) RADEON(1): No modes.</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="vainfo-vdpauinfo-出错"><a href="#vainfo-vdpauinfo-出错" class="headerlink" title="vainfo , vdpauinfo 出错."></a>vainfo , vdpauinfo 出错.</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">~$ VDPAU_DRIVER=r600 vdpauinfo</div><div class="line">display: :0.0   screen: 0</div><div class="line">Error creating VDPAU device: 23</div><div class="line"></div><div class="line">~$ vdpauinfo</div><div class="line">display: :0.0   screen: 0</div><div class="line">Failed to open VDPAU backend libvdpau_nvidia.so: cannot open shared object file: No such file or directory</div><div class="line">Error creating VDPAU device: 1</div><div class="line"></div><div class="line">~$ vainfo</div><div class="line">libva info: VA-API version 0.39.4</div><div class="line">libva info: va_getDriverName() returns -1</div><div class="line">libva error: va_getDriverName() failed with unknown libva error,driver_name=(null)</div><div class="line">vaInitialize failed with error code -1 (unknown libva error),exit</div></pre></td></tr></table></figure>
<ul>
<li>上面错误是因为 <code>/etc/X11/xorg.conf</code> 的　<code>AccelMethod</code> 设置 <code>Glamor</code> ,改成<code>EXA</code> 解决问题.</li>
</ul>
<h5 id="新显卡加载固件问题"><a href="#新显卡加载固件问题" class="headerlink" title="新显卡加载固件问题"></a>新显卡加载固件问题</h5><p>*　R7 显卡遇无法加载radeon驱动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">$ lspci | grep <span class="string">"VGA"</span></div><div class="line">00:01.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Kaveri [Radeon R7 Graphics] (rev d6)</div><div class="line">``` </div><div class="line"></div><div class="line">* 通过dmesg 发现如下错误</div><div class="line">```bash</div><div class="line">[  449.155790] radeon 0000:00:01.0: Direct firmware load <span class="keyword">for</span></div><div class="line">radeon/kaveri_pfp.bin failed with error -2</div><div class="line">[  449.156090] radeon 0000:00:01.0: Direct firmware load <span class="keyword">for</span></div><div class="line">radeon/kaveri_me.bin failed with error -2</div><div class="line">[  449.156407] radeon 0000:00:01.0: Direct firmware load <span class="keyword">for</span></div><div class="line">radeon/kaveri_ce.bin failed with error -2</div><div class="line">[  449.156680] radeon 0000:00:01.0: Direct firmware load <span class="keyword">for</span></div><div class="line">radeon/kaveri_mec.bin failed with error -2</div><div class="line">[  449.156990] radeon 0000:00:01.0: Direct firmware load <span class="keyword">for</span></div><div class="line">radeon/kaveri_mec2.bin failed with error -2</div><div class="line">[  449.156992] cik_cp: Failed to load firmware <span class="string">"radeon/kaveri_mec2.bin"</span></div><div class="line">[  449.157153] [drm:cik_init [radeon]] *ERROR* Failed to load firmware!</div><div class="line">[  449.157241] radeon 0000:00:01.0: Fatal error during GPU init</div><div class="line">[  449.157327] [drm] radeon: finishing device.</div><div class="line">[  449.164593] [TTM] Finalizing pool allocator</div><div class="line">[  449.164597] [TTM] Finalizing DMA pool allocator</div><div class="line">[  449.164697] [TTM] Zone  kernel: Used memory at <span class="built_in">exit</span>: 0 kiB</div><div class="line">[  449.164701] [TTM] Zone   dma32: Used memory at <span class="built_in">exit</span>: 0 kiB</div><div class="line">[  449.164703] [drm] radeon: ttm finalized</div><div class="line">[  449.165170] radeon: probe of 0000:00:01.0 failed with error -2</div></pre></td></tr></table></figure>
<ul>
<li><a href="git://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git" target="_blank" rel="external">下载最新的固件</a> , 把<code>radeon</code>目录下的所有文件复制到<code>/lib/firmware/radeon</code>,重新<code>modprobe radeon</code>解决</li>
</ul>
<ul>
<li><p>使用xrandr 设置多屏</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">$ xrandr </div><div class="line">Screen 0: minimum 320 x 200, current 3286 x 1080, maximum 8192 x 8192</div><div class="line">VGA-0 disconnected (normal left inverted right x axis y axis)</div><div class="line">LVDS connected 1366x768+0+0 (normal left inverted right x axis y axis) 344mm x 194mm</div><div class="line">   1366x768      60.00*+</div><div class="line">   1280x720      59.86  </div><div class="line">   1152x768      59.78  </div><div class="line">   1024x768      59.92  </div><div class="line">   800x600       59.86  </div><div class="line">   848x480       59.66  </div><div class="line">   720x480       59.71  </div><div class="line">   640x480       59.38  </div><div class="line">HDMI-0 connected 1920x1080+1366+0 (normal left inverted right x axis y axis) 480mm x 270mm</div><div class="line">   1920x1080     60.00*+  50.00    59.94  </div><div class="line">   1920x1080i    60.00    50.00    59.94  </div><div class="line">   1680x1050     59.88  </div><div class="line">   1400x1050     59.95  </div><div class="line">   1600x900      60.00  </div><div class="line">   1280x1024     75.02    60.02  </div><div class="line">   1440x900      59.90  </div><div class="line">   1280x800      59.91  </div><div class="line">   1152x864      75.00  </div><div class="line">   1280x720      60.00    50.00    59.94  </div><div class="line">   1024x768      75.08    60.00  </div><div class="line">   800x600       75.00    60.32  </div><div class="line">   720x576       50.00  </div><div class="line">   720x480       60.00    59.94  </div><div class="line">   640x480       75.00    60.00    59.94  </div><div class="line">   720x400       70.08  </div><div class="line">$ xrandr --output LVDS --mode 1366x768 --output HDMI-0 --mode 1920x1080 --right-of LVDS</div></pre></td></tr></table></figure>
</li>
<li><p>基于<code>debian</code>发行版安装mesa 驱并支持,VDPAU,VA API,GLX, 需要安装如下的包,下面是64位系统上的包列表.</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"># uname -a</div><div class="line">Linux debian 4.8.13-20161211 #2 SMP Sun Dec 11 13:11:44 CST 2016 x86_64 GNU/Linux</div><div class="line"># lspci | grep &quot;VGA&quot;</div><div class="line">00:01.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Kaveri [Radeon R7 Graphics] (rev d6)</div><div class="line"></div><div class="line"></div><div class="line"># apt-get install glx-alternative-mesa libegl1-mesa:amd64 libegl1-mesa-dev:amd64 libegl1-mesa-drivers:amd64 libgl1-mesa-dev:amd64 libgl1-mesa-dri:amd64  </div><div class="line">libgl1-mesa-dri:i386 libgl1-mesa-glx:amd64 libgl1-mesa-glx:i386 libglapi-mesa:amd64 libglapi-mesa:i386 libgles1-mesa:amd64 </div><div class="line">libgles1-mesa-dev:amd64 libgles2-mesa:amd64 libgles2-mesa-dev:amd64 libglu1-mesa:amd64 libglu1-mesa:i386 </div><div class="line">libglu1-mesa-dev libglw1-mesa:amd64 libglw1-mesa-dev libopenvg1-mesa:amd64  libosmesa6:amd64  </div><div class="line">libosmesa6-dev:amd64 libwayland-egl1-mesa:amd64 mesa-common-dev:amd64  mesa-opencl-icd </div><div class="line">mesa-utils mesa-va-drivers:amd64  mesa-vdpau-drivers:amd64 libdrm-amdgpu1:amd64 libdrm-dev:amd64  </div><div class="line">libdrm-intel1:amd64 libdrm-intel1:i386 libdrm-nouveau2:amd64  libdrm-nouveau2:i386 libdrm-radeon1:amd64 </div><div class="line">libdrm-radeon1:i386 libdrm2:amd64  libdrm2:i386  libva-drm1:amd64  libvdpau1:amd64 </div><div class="line">mesa-vdpau-drivers:amd64 vdpauinfo libva-dev:amd64 libva-drm1:amd64  libva-egl1:amd64  </div><div class="line">libva-glx1:amd64  libva-tpi1:amd64  libva-wayland1:amd64 libva-x11-1:amd64 libva1:amd64  </div><div class="line">libva1:i386 libval-bin libval14:amd64</div></pre></td></tr></table></figure>
<ul>
<li>到次如果没有错误就算是折腾完了,如果遇到问题一定<a href="https://www.google.com.hk" target="_blank" rel="external">google</a> 一下.</li>
</ul>
<hr>
<h3 id="谢谢打赏支持"><a href="#谢谢打赏支持" class="headerlink" title="谢谢打赏支持"></a>谢谢打赏支持</h3><ul>
<li>您的打赏将会鼓励我写出更多的博客。  </li>
<li>微信二维码:</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/07/为树莓派交叉编译FFMPEG程序/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/07/为树莓派交叉编译FFMPEG程序/" itemprop="url">
                  为树莓派交叉编译FFMPEG工具
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-07-07 00:00:00" itemprop="dateCreated datePublished" datetime="2016-07-07T00:00:00+08:00">2016-07-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2016-12-14 00:00:00" itemprop="dateModified" datetime="2016-12-14T00:00:00+08:00">2016-12-14</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="0x1-下载Raspberrypi-的工具链"><a href="#0x1-下载Raspberrypi-的工具链" class="headerlink" title="0x1 下载Raspberrypi 的工具链"></a>0x1 下载Raspberrypi 的工具链</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span>  https://github.com/raspberrypi/tools.git</div><div class="line">$ <span class="built_in">cd</span> tools</div></pre></td></tr></table></figure>
<ul>
<li><code>tools</code>目录结构如下:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">├── arm-bcm2708</div><div class="line">│   ├── arm-bcm2708hardfp-linux-gnueabi</div><div class="line">│   ├── arm-bcm2708-linux-gnueabi</div><div class="line">│   ├── arm-rpi-4.9.3-linux-gnueabihf</div><div class="line">│   ├── gcc-linaro-arm-linux-gnueabihf-raspbian</div><div class="line">│   └── gcc-linaro-arm-linux-gnueabihf-raspbian-x64</div><div class="line">├── armstubs</div><div class="line">├── configs</div><div class="line">├── mkimage</div><div class="line">├── pkg</div><div class="line">├── test_code</div><div class="line">└── usbboot</div></pre></td></tr></table></figure>
<ul>
<li>因为我的操作系统是<code>debian x86_64</code> ,所以我要使用 <code>gcc-linaro-arm-linux-gnueabihf-raspbian-x64</code> 下面的工具链程序.设置环境变量<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:tools$/home/user/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin </div><div class="line">$ <span class="built_in">export</span> CC=arm-linux-gnueabihf-gcc </div><div class="line">$ <span class="built_in">export</span> GCC=<span class="variable">$CC</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="0x2-编译ffmpeg依赖软件包"><a href="#0x2-编译ffmpeg依赖软件包" class="headerlink" title="0x2 编译ffmpeg依赖软件包"></a>0x2 编译ffmpeg依赖软件包</h3><ul>
<li>下面先要编译安装一些依赖的库,这里用到的<code>x264,libmp3lame</code>,编译的过程出现任何问题,要查看<code>config.log</code>分析处理解决.假设编译安装的目是<code>/home/user</code> 具体可以自己更改.</li>
</ul>
<h4 id="x264"><a href="#x264" class="headerlink" title="x264"></a>x264</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$  git <span class="built_in">clone</span> http://git.videolan.org/git/x264.git</div><div class="line">$ <span class="built_in">cd</span> x264 &amp;&amp; mkdir build-rpi &amp;&amp; <span class="built_in">cd</span> build-rpi</div><div class="line">$ ../configure --enable-static --enable-shared --cross-prefix=arm-linux-gnueabihf- --host=arm-linux --prefix=/home/user/</div><div class="line">$ make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h4 id="libmp3lame"><a href="#libmp3lame" class="headerlink" title="libmp3lame"></a>libmp3lame</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> https://github.com/gypified/libmp3lame</div><div class="line">$ <span class="built_in">cd</span> libmp3lame &amp;&amp; mkdir build-rpi &amp;&amp; build-rpi</div><div class="line">$ ../configure --host=arm-linux --prefix=/home/user</div><div class="line">$ make &amp;&amp; make install</div></pre></td></tr></table></figure>
<ul>
<li>编译完成后的<code>/home/user</code> 目录结构如下: <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">$ tree user </div><div class="line">user </div><div class="line">├── bin</div><div class="line">│   ├── lame</div><div class="line">│   └── x264</div><div class="line">├── include</div><div class="line">│   ├── lame</div><div class="line">│   │   └── lame.h</div><div class="line">│   ├── x264_config.h</div><div class="line">│   └── x264.h</div><div class="line">├── lib</div><div class="line">│   ├── libmp3lame.a</div><div class="line">│   ├── libmp3lame.la</div><div class="line">│   ├── libmp3lame.so -&gt; libmp3lame.so.0.0.0</div><div class="line">│   ├── libmp3lame.so.0 -&gt; libmp3lame.so.0.0.0</div><div class="line">│   ├── libmp3lame.so.0.0.0</div><div class="line">│   ├── libx264.a</div><div class="line">│   ├── libx264.so -&gt; libx264.so.148</div><div class="line">│   ├── libx264.so.148</div><div class="line">│   └── pkgconfig</div><div class="line">│       └── x264.pc</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="0x3-下载并编译FFMPEG"><a href="#0x3-下载并编译FFMPEG" class="headerlink" title="0x3 下载并编译FFMPEG"></a>0x3 下载并编译FFMPEG</h3><ul>
<li><p>这里最好新建一个目录用来编译,防止在当前目录下编译污染了当前目录.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> https://git.ffmpeg.org/ffmpeg.git</div><div class="line">$ <span class="built_in">cd</span> ffmpeg &amp;&amp; mkdir build-rpi &amp;&amp; <span class="built_in">cd</span> build-rpi</div><div class="line">$ ../configure --arch=armel --target-os=linux --enable-gpl --enable-libx264 --enable-nonfree</div><div class="line">  --enable-cross-compile --cross-prefix=arm-linux-gnueabihf-</div><div class="line">  --enable-libmp3lame --enable-encoder=png --enable-decoder=png </div><div class="line">  --enable-encoder=libx264 --enable-encoder=ljpeg --enable-zlib </div><div class="line">  --enable-bzlib --enable-muxer=mp4 --enable-muxer=avi --enable-muxer=avi</div><div class="line">  --enable-muxer=h264 --enable-parser=png --enable-parser=h264 --enable-parser=bmp </div><div class="line">  --extra-cflags=-I/home/user/include --extra-ldflags=-L/home/user/lib</div><div class="line">$ make &amp;&amp; make install</div></pre></td></tr></table></figure>
</li>
<li><p>如果不出问题出问题会在编译目录下出现以下二进制文件:<code>ffserver,ffprobe,ffmpeg</code> ,使用file 测试一下文件类型如下:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ file ffmpeg</div><div class="line">ffmpeg: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), dynamically linked, </div><div class="line">interpreter /lib/ld-linux-armhf.so.3, <span class="keyword">for</span> GNU/Linux 2.6.26, BuildID[sha1]=ec3417b6de5c9d89fe351048f6718a0857e760ff, stripped</div></pre></td></tr></table></figure>
</li>
<li><p>把上述三个文件复制到树莓派的机器下就可以直接运行了.</p>
</li>
</ul>
<hr>
<h3 id="谢谢打赏支持"><a href="#谢谢打赏支持" class="headerlink" title="谢谢打赏支持"></a>谢谢打赏支持</h3><ul>
<li>您的打赏将会鼓励我写出更多的博客。  </li>
<li>微信二维码:</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/06/27/在Windows-环境下编译Qt静态库/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/27/在Windows-环境下编译Qt静态库/" itemprop="url">
                  在Windows 环境下编译Qt静态库
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-06-27 20:46:25 / 修改时间：00:00:00" itemprop="dateCreated datePublished" datetime="2016-06-27T20:46:25+08:00">2016-06-27</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Qt/" itemprop="url" rel="index"><span itemprop="name">Qt</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><a href="https://wiki.qt.io/Building_a_static_Qt_for_Windows_using_MinGW" target="_blank" rel="external">参考链接</a></li>
<li><a href="https://wiki.qt.io/Qt_5.3_Tools_and_Versions" target="_blank" rel="external">Qt5.3 Tools and Versions</a></li>
<li><a href="https://sourceforge.net/projects/mingw" target="_blank" rel="external">MinGW</a></li>
<li><a href="http://source.icu-project.org/repos/icu/icu/tags/release-49-1-2" target="_blank" rel="external">ICU</a></li>
<li><a href="https://www.activestate.com/activeperl/downloads" target="_blank" rel="external">ActivePerl</a></li>
<li><a href="http://www.qt.io" target="_blank" rel="external">Qt</a></li>
</ul>
<h3 id="安装MinGW工具链环境"><a href="#安装MinGW工具链环境" class="headerlink" title="安装MinGW工具链环境"></a>安装MinGW工具链环境</h3><ul>
<li><p>这里在Win32环境下要安装一个<code>MinGW</code>工具链,这里最好是先安装一个Qt环境,使用Qt自带的MinGW工具链,我这里是先安装一个Qt5.6的环境再用它来编译Qt5.3.2的静态库.下载并安装<code>ActivePerl</code>软件. </p>
</li>
<li><p>这里要用到MSYS环境,把编译<code>ICU</code>,<code>openssl</code>的gcc 都指向QT5.6.1自带的工具链GCC,这样才能保能Qt,ICU,openssl<br>  编译出来的C++二进制文是兼容的,修改<code>msys_env.bat</code>脚本如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">set path=C:\Python27;C:\Perl\bin;C:\Qt\Qt5.6.1\Tools\mingw492_32\bin;D:\mingw\bin;</div><div class="line">D:\mingw\mingw32\bin;D:\mingw\msys\1.0\bin</div><div class="line">set HOME=D:\mingw\msys\1.0</div><div class="line">bash.exe</div></pre></td></tr></table></figure>
</li>
<li><p>修改<code>fstab</code>文件,这里从<a href="http://stackoverflow.com/questions/10171761/qt-undefined-reference-to-time32" target="_blank" rel="external">StackOverFlow</a><br>看到解释</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">C:/Qt/Qt5.6.1/Tools/mingw492_32  /mingw</div><div class="line">c:/perl/Perl</div></pre></td></tr></table></figure>
<h3 id="下载ICU"><a href="#下载ICU" class="headerlink" title="下载ICU"></a>下载ICU</h3><ul>
<li>经过测试通过下面页下载的库是不能用来静态链接的.还是需要自已用QT的<code>mingw-GCC</code> 工具链编译源码才能用.</li>
<li>根据链接<a href="https://wiki.qt.io/Qt_5.3_Tools_and_Versions" target="_blank" rel="external">Qt5.3 Tools and Versions</a> 下载一个合适的ICU</li>
<li>打开<a href="http://download.qt.io/development_releases/prebuilt/icu/prebuilt/mingw/" target="_blank" rel="external">http://download.qt.io/development_releases/prebuilt/icu/prebuilt/mingw/</a> 选择下载<br><a href="http://download.qt.io/development_releases/prebuilt/icu/prebuilt/mingw/icu_53_1_mingw_builds_4_9_1_posix_seh_64_devel.7z" target="_blank" rel="external"> icu_53_1_mingw_builds_4_9_1_posix_seh_64_devel.7z</a>   </li>
</ul>
<h3 id="下载编译ICU"><a href="#下载编译ICU" class="headerlink" title="下载编译ICU"></a>下载编译ICU</h3><ul>
<li><a href="http://downloads.sourceforge.net/project/icu/ICU4C/53.1/icu4c-53_1-src.zip" target="_blank" rel="external">下载ICU4C_53_1</a></li>
<li>这里以icu-53_1为例编译 解压ICU包进入到source目录</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">bash.exe-3.1$ <span class="built_in">cd</span> icu/<span class="built_in">source</span></div><div class="line">bash.exe-3.1$ ./runConfigureICU M<span class="keyword">in</span>GW --prefix=/c/icu4c53_1 --enable-static --disable-shared</div><div class="line">--enable-release --disable-debug</div><div class="line">[...]</div><div class="line">bash.exe-3.1$ make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h3 id="编译openssl"><a href="#编译openssl" class="headerlink" title="编译openssl"></a>编译openssl</h3><ul>
<li>下载 <a href="https://www.openssl.org/source/openssl-1.0.1g.tar.gz" target="_blank" rel="external">https://www.openssl.org/source/openssl-1.0.1g.tar.gz</a> </li>
<li>编译openssl 必需要有msys环境.请仔细查看解压后文件夹里的<code>INSTALL.W32</code>文档.</li>
<li>运行<code>msys shell</code> ,切换的<code>openssl-1.0.1g</code>目录下:<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">bash.exe-3.1$  ./config --prefix=/c/openssl-1.0.1g no-asm no-shared</div><div class="line">[...]</div><div class="line">bash.exe-3.1$ make depend</div><div class="line">[...] </div><div class="line">bash.exe-3.1$ make </div><div class="line">[...]</div><div class="line">bash.exe-3.1$ make install</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="编译Qt源码"><a href="#编译Qt源码" class="headerlink" title="编译Qt源码"></a>编译Qt源码</h3><ul>
<li>下载<a href="http://download.qt.io/archive/qt/5.3/5.3.2/single/qt-everywhere-opensource-src-5.3.2.zip" target="_blank" rel="external">Qt5.3.2</a></li>
<li>解压文件并且修改 <code>qtbase\mkspecs\win32-g++\qmake.conf</code>  最终文件如下:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># qmake configuration for win32-g++</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Written for MinGW / gcc 4.6 or higher</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Cross compile example for i686-w64-mingw32-g++:</span></div><div class="line"><span class="comment">#   configure -xplatform win32-g++ -device-option CROSS_COMPILE=i686-w64-mingw32-</span></div><div class="line"><span class="comment">#</span></div><div class="line">load(device_config)</div><div class="line">MAKEFILE_GENERATOR      = MINGW</div><div class="line">QMAKE_PLATFORM          = win32 mingw</div><div class="line">CONFIG                 += debug_and_release debug_and_release_target precompile_header</div><div class="line">DEFINES                += UNICODE</div><div class="line">QMAKE_COMPILER_DEFINES += __GNUC__ WIN32</div><div class="line">QMAKE_EXT_OBJ           = .o</div><div class="line">QMAKE_EXT_RES           = _res.o</div><div class="line">QMAKE_COMPILER          = gcc</div><div class="line">QMAKE_CC                = $<span class="variable">$&#123;CROSS_COMPILE&#125;</span>gcc</div><div class="line">QMAKE_LEX               = flex</div><div class="line">QMAKE_LEXFLAGS          =</div><div class="line">QMAKE_YACC              = byacc</div><div class="line">QMAKE_YACCFLAGS         = <span class="_">-d</span></div><div class="line">QMAKE_CFLAGS            = -pipe -fno-keep-inline-dllexport</div><div class="line">QMAKE_CFLAGS_DEPS       = -M</div><div class="line">QMAKE_CFLAGS_WARN_ON    = -Wall -Wextra</div><div class="line">QMAKE_CFLAGS_WARN_OFF   = -w</div><div class="line">QMAKE_CFLAGS_RELEASE -= -O2</div><div class="line">QMAKE_CFLAGS_RELEASE += -Os -momit-leaf-frame-pointer  <span class="comment">#注意这一行</span></div><div class="line">QMAKE_CFLAGS_DEBUG      = -g</div><div class="line">QMAKE_CFLAGS_YACC       = -Wno-unused -Wno-parentheses</div><div class="line">QMAKE_CFLAGS_SPLIT_SECTIONS = -ffunction-sections</div><div class="line">QMAKE_CFLAGS_SSE2       = -msse2 -mstackrealign</div><div class="line">QMAKE_CFLAGS_SSE3       = -msse3</div><div class="line">QMAKE_CFLAGS_SSSE3      = -mssse3</div><div class="line">QMAKE_CFLAGS_SSE4_1     = -msse4.1</div><div class="line">QMAKE_CFLAGS_SSE4_2     = -msse4.2</div><div class="line">QMAKE_CFLAGS_AVX        = -mavx</div><div class="line">QMAKE_CFLAGS_AVX2       = -mavx2</div><div class="line">QMAKE_CFLAGS_IWMMXT     = -mcpu=iwmmxt</div><div class="line">QMAKE_CFLAGS_NEON       = -mfpu=neon</div><div class="line">QMAKE_CXX               = $<span class="variable">$&#123;CROSS_COMPILE&#125;</span>g++</div><div class="line">QMAKE_CXXFLAGS          = $<span class="variable">$QMAKE_CFLAGS</span></div><div class="line">QMAKE_CXXFLAGS_DEPS     = $<span class="variable">$QMAKE_CFLAGS_DEPS</span></div><div class="line">QMAKE_CXXFLAGS_WARN_ON  = $<span class="variable">$QMAKE_CFLAGS_WARN_ON</span></div><div class="line">QMAKE_CXXFLAGS_WARN_OFF = $<span class="variable">$QMAKE_CFLAGS_WARN_OFF</span></div><div class="line">QMAKE_CXXFLAGS_RELEASE  = $<span class="variable">$QMAKE_CFLAGS_RELEASE</span></div><div class="line">QMAKE_CXXFLAGS_DEBUG    = $<span class="variable">$QMAKE_CFLAGS_DEBUG</span></div><div class="line">QMAKE_CXXFLAGS_YACC     = $<span class="variable">$QMAKE_CFLAGS_YACC</span></div><div class="line">QMAKE_CXXFLAGS_THREAD   = $<span class="variable">$QMAKE_CFLAGS_THREAD</span></div><div class="line">QMAKE_CXXFLAGS_RTTI_ON  = -frtti</div><div class="line">QMAKE_CXXFLAGS_RTTI_OFF = -fno-rtti</div><div class="line">QMAKE_CXXFLAGS_EXCEPTIONS_ON = -fexceptions -mthreads</div><div class="line">QMAKE_CXXFLAGS_EXCEPTIONS_OFF = -fno-exceptions</div><div class="line">QMAKE_CXXFLAGS_CXX11    = -std=c++0x</div><div class="line">QMAKE_CXXFLAGS_SPLIT_SECTIONS = $<span class="variable">$QMAKE_CFLAGS_SPLIT_SECTIONS</span></div><div class="line">QMAKE_INCDIR            =</div><div class="line">QMAKE_RUN_CC            = $(CC) -c $(CFLAGS) $(INCPATH) -o <span class="variable">$obj</span> <span class="variable">$src</span></div><div class="line">QMAKE_RUN_CC_IMP        = $(CC) -c $(CFLAGS) $(INCPATH) -o <span class="variable">$@</span> $&lt;</div><div class="line">QMAKE_RUN_CXX           = $(CXX) -c $(CXXFLAGS) $(INCPATH) -o <span class="variable">$obj</span> <span class="variable">$src</span></div><div class="line">QMAKE_RUN_CXX_IMP       = $(CXX) -c $(CXXFLAGS) $(INCPATH) -o <span class="variable">$@</span> $&lt;</div><div class="line">QMAKE_LINK              = $<span class="variable">$&#123;CROSS_COMPILE&#125;</span>g++</div><div class="line">QMAKE_LINK_C            = $<span class="variable">$&#123;CROSS_COMPILE&#125;</span>gcc</div><div class="line">QMAKE_LFLAGS            = -static -static-libgcc <span class="comment"># 添加这一行</span></div><div class="line">QMAKE_LFLAGS_EXCEPTIONS_ON = -mthreads</div><div class="line">QMAKE_LFLAGS_EXCEPTIONS_OFF =</div><div class="line">QMAKE_LFLAGS_RELEASE    = -Wl,<span class="_">-s</span></div><div class="line">QMAKE_LFLAGS_DEBUG      =</div><div class="line">QMAKE_LFLAGS_CONSOLE    = -Wl,-subsystem,console</div><div class="line">QMAKE_LFLAGS_WINDOWS    = -Wl,-subsystem,windows</div><div class="line">QMAKE_LFLAGS_DLL        = -static</div><div class="line">QMAKE_LFLAGS_CXX11      =</div><div class="line">QMAKE_LFLAGS_GCSECTIONS = -Wl,--gc-sections</div><div class="line">QMAKE_LINK_OBJECT_MAX   = 10</div><div class="line">QMAKE_LINK_OBJECT_SCRIPT = object_script</div><div class="line">QMAKE_PREFIX_STATICLIB  = lib</div><div class="line">QMAKE_EXTENSION_STATICLIB = a</div><div class="line">QMAKE_LIBS              =</div><div class="line">QMAKE_LIBS_CORE         = -lole32 -luuid -lws2_32 -ladvapi32 -lshell32 -luser32 -lkernel32</div><div class="line">QMAKE_LIBS_GUI          = -lgdi32 -lcomdlg32 -loleaut32 -limm32 -lwinmm -lws2_32 -lole32 -luuid -luser32 -ladvapi32</div><div class="line">QMAKE_LIBS_NETWORK      = -lws2_32</div><div class="line">QMAKE_LIBS_OPENGL       = -lglu32 -lopengl32 -lgdi32 -luser32</div><div class="line">QMAKE_LIBS_OPENGL_ES2   = -llibEGL -llibGLESv2 -lgdi32 -luser32</div><div class="line">QMAKE_LIBS_OPENGL_ES2_DEBUG = -llibEGLd -llibGLESv2d -lgdi32 -luser32</div><div class="line">QMAKE_LIBS_COMPAT       = -ladvapi32 -lshell32 -lcomdlg32 -luser32 -lgdi32 -lws2_32</div><div class="line">QMAKE_LIBS_QT_ENTRY     = -lmingw32 -lqtmain</div><div class="line">!isEmpty(QMAKE_SH) &#123;</div><div class="line">    MINGW_IN_SHELL      = 1</div><div class="line">    QMAKE_DIR_SEP       = /</div><div class="line">    QMAKE_DIRLIST_SEP   = :</div><div class="line">    include(../common/shell-unix.conf)</div><div class="line">    <span class="comment"># Because install's ability to set permissions is not relevant on Windows,</span></div><div class="line">    <span class="comment"># and git's msys does not provide it to start with.</span></div><div class="line">    QMAKE_INSTALL_FILE    = cp <span class="_">-f</span></div><div class="line">    QMAKE_INSTALL_PROGRAM = cp <span class="_">-f</span></div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    include(../common/shell-win32.conf)</div><div class="line">&#125;</div><div class="line">QMAKE_IDL               = midl</div><div class="line">QMAKE_LIB               = $<span class="variable">$&#123;CROSS_COMPILE&#125;</span>ar -ru</div><div class="line">QMAKE_RC                = $<span class="variable">$&#123;CROSS_COMPILE&#125;</span>windres</div><div class="line">QMAKE_STRIP             = $<span class="variable">$&#123;CROSS_COMPILE&#125;</span>strip</div><div class="line">QMAKE_STRIPFLAGS_LIB   += --strip-unneeded</div><div class="line">QMAKE_OBJCOPY           = $<span class="variable">$&#123;CROSS_COMPILE&#125;</span>objcopy</div><div class="line">QMAKE_NM                = $<span class="variable">$&#123;CROSS_COMPILE&#125;</span>nm -P</div><div class="line">load(qt_config)</div></pre></td></tr></table></figure>
<h3 id="创建编译脚本"><a href="#创建编译脚本" class="headerlink" title="创建编译脚本"></a>创建编译脚本</h3><ul>
<li>创建一个bat的脚本件内容如下,有些变量请按实际系统环境做相应的修改.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">set</span> RDIR=c:/Qt/Qt5.6.1</div><div class="line"><span class="built_in">set</span> VERGCC=mingw492_32</div><div class="line"><span class="built_in">set</span> PATH=C:/Python27;C:/Perl/bin;%RDIR%/5.6/%VERGCC%/bin;%RDIR%/Tools/%VERGCC%/bin;C:\icu\bin;%RDIR%/Tools/QtCreator/bin</div><div class="line"><span class="built_in">set</span> INCLUDE=%RDIR%/5.6/%VERGCC%/include;%RDIR%/Tools/%VERGCC%/include;C:\icu4c53_1\include;C:\openssl-1.0.1g\include</div><div class="line"><span class="built_in">set</span> LIB=%RDIR%/5.6/%VERGCC%/lib;%RDIR%/Tools/%VERGCC%/lib;C:\icu4c53_1\lib;C:\openssl-1.0.1g\lib</div><div class="line"><span class="built_in">set</span> SDIR=D:/qt-everywhere-opensource-src-5.3.2</div><div class="line"><span class="built_in">cd</span> %SDIR%</div><div class="line">configure.bat -mp    -platform win32-g++  -opensource -confirm-license -release </div><div class="line">-static -ltcg -c++11 -prefix <span class="string">"c:/Qt/5.3.2-static"</span> -accessibility</div><div class="line">-rtti -qt-sql-sqlite -qt-sql-odbc -plugin-sql-sqlite -plugin-sql-odbc -icu -qt-zlib -qt-libpng -qt-libjpeg </div><div class="line">-audio-backend  -opengl desktop -qml-debug -no-vcproj -no-dbus -nomake tests  </div><div class="line">-openssl -I C:/openssl-1.0.1g/include -L C:/openssl-1.0.1g/lib</div><div class="line">-nomake examples -qt-freetype -no-compile-examples -no-openvg -iconv -no-directwrite </div><div class="line">-no-iwmmxt -no-crt -skip qtwebkit  </div><div class="line">;编译 </div><div class="line">mingw32-make</div><div class="line">;安装到-prefix的变量路径中</div><div class="line">mingw32-make install</div></pre></td></tr></table></figure>
<hr>
<h3 id="谢谢打赏支持"><a href="#谢谢打赏支持" class="headerlink" title="谢谢打赏支持"></a>谢谢打赏支持</h3><ul>
<li>您的打赏将会鼓励我写出更多的博客。  </li>
<li>微信二维码:</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/29/安装mate桌面与设置多屏/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/29/安装mate桌面与设置多屏/" itemprop="url">
                  debian 安装mate桌面与设置多屏
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-05-29 00:00:00" itemprop="dateCreated datePublished" datetime="2016-05-29T00:00:00+08:00">2016-05-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2016-12-14 22:28:00" itemprop="dateModified" datetime="2016-12-14T22:28:00+08:00">2016-12-14</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/笔记/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p>MATE 桌面环境 是 GNOME 2 的一个分支,旨在使用传统的方式，为Linux用户提供一个有吸引力的和直观的桌面. </p>
</li>
<li><p>MATE 现在位于 <a href="https://github.com/mate-desktop" target="_blank" rel="external">GitHub</a>: </p>
</li>
</ul>
<ul>
<li><p><strong>安装MATE相关的软件包:</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">root<span class="comment"># apt-get update &amp;&amp; apt-get upgrade</span></div><div class="line">root<span class="comment"># apt-get install gir1.2-mate-panel libmate-desktop-2-17:amd64 libmate-desktop-doc libmate-menu2:amd64 </span></div><div class="line">libmate-panel-applet-4-1 libmate-window-settings1:amd64 libmatedict6 libmatekbd-common libmatekbd4:amd64 </div><div class="line">libmatepolkit-dev:amd64 libpolkit-gtk-mate-1-0:amd64 live-image-mate-desktop mate-applets mate-applets-common </div><div class="line">mate-backgrounds mate-control-center mate-control-center-common mate-desktop mate-desktop-common </div><div class="line">mate-gnome-main-menu-applet mate-icon-theme mate-icon-theme-faenza mate-media mate-media-common mate-media-pulse </div><div class="line">mate-menus mate-netbook mate-panel mate-panel-common mate-polkit:amd64 mate-polkit-common mate-power-manager </div><div class="line">mate-power-manager-common mate-screensaver mate-screensaver-common mate-sensors-applet mate-session-manager </div><div class="line">mate-settings-daemon mate-settings-daemon-common mate-settings-daemon-pulse mate-system-monitor </div><div class="line">mate-system-monitor-common mate-system-tools mate-system-tools-common mate-terminal mate-terminal-common </div><div class="line">mate-themes mate-utils mate-utils-common</div></pre></td></tr></table></figure>
</li>
<li><p>安装FVWM相关软件包:</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root<span class="comment"># apt-get install fvwm&#123;,-&#123;crystal,icons&#125;&#125;</span></div></pre></td></tr></table></figure>
<h3 id="安装Lightdm"><a href="#安装Lightdm" class="headerlink" title="安装Lightdm"></a>安装Lightdm</h3><blockquote>
<p> LightDM 是一个跨桌面环境的显示管理器，其目的是为X窗口系统提供一个标准的显示管理器。它的特点有:</p>
<ul>
<li>代码轻量</li>
<li>符合标准 (如 PAM, logind, 等)</li>
<li>为用户提供一个良好的界面。</li>
<li>跨桌面（用户可以使用各种各样的桌面环境）.<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root<span class="comment"># apt-get install liblightdm-gobject-1-0 lightdm lightdm-gtk-greeter</span></div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<ul>
<li>配置系统的<code>Xsession</code>, 这里要选择<code>/usr/bin/mate-session</code> :<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">root<span class="comment"># update-alternatives --config x-session-manager</span></div><div class="line">There are 2 choices <span class="keyword">for</span> the alternative x-session-manager (providing /usr/bin/x-session-manager).</div><div class="line"></div><div class="line">  Selection    Path                      Priority   Status</div><div class="line">  ------------------------------------------------------------</div><div class="line">    0            /usr/bin/openbox-session   40        auto mode</div><div class="line">  * 1            /usr/bin/mate-session      30        manual mode</div><div class="line">    2            /usr/bin/openbox-session   40        manual mode</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>配置系统的<code>X-window-manager</code>,这里要选择<code>/usr/bin/fvwm2</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">root<span class="comment"># update-alternatives --config x-window-manager</span></div><div class="line">There are 7 choices <span class="keyword">for</span> the alternative x-window-manager (providing /usr/bin/x-window-manager).</div><div class="line"></div><div class="line">Selection    Path                   Priority   Status</div><div class="line"> ------------------------------------------------------------</div><div class="line">* 0            /usr/bin/fvwm2          90        auto mode</div><div class="line">  1            /usr/bin/awesome        20        manual mode</div><div class="line">  2            /usr/bin/fvwm-crystal   50        manual mode</div></pre></td></tr></table></figure>
<h3 id="双屏幕设置"><a href="#双屏幕设置" class="headerlink" title="双屏幕设置"></a>双屏幕设置</h3><ul>
<li>安装<code>x11-xserver-utils</code> 包,这里要用到<code>xrandr</code> 去设置屏幕.</li>
<li>获取屏幕的信息如下图所示.</li>
</ul>
<p><img src="/imgs/xrandr_cmd.png" alt=""></p>
<ul>
<li><ul>
<li>通过命令行设置.</li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ xrandr --output HDMI1  --mode 1680x1050 --primary --output VGA1 --mode 1920x1080 --rotate left --right-of HDMI1</div></pre></td></tr></table></figure>
<ul>
<li>最后效果图如下.</li>
</ul>
<p><img src="/imgs/xrandr_example.png" alt=""></p>
<ul>
<li>也可以通过一个图形界面工具(<code>arandr</code>)去设置多屏幕,下面是我的笔记本外接一个HDMI的显示的图.</li>
</ul>
<p><img src="/imgs/arandr.png" alt=""></p>
<hr>
<h3 id="谢谢打赏支持"><a href="#谢谢打赏支持" class="headerlink" title="谢谢打赏支持"></a>谢谢打赏支持</h3><ul>
<li>您的打赏将会鼓励我写出更多的博客。  </li>
<li>微信二维码:</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/imgs/avatar.jpg"
                alt="yjdwbj" />
            
              <p class="site-author-name" itemprop="name">yjdwbj</p>
              <p class="site-description motion-element" itemprop="description">最是人间留不住,朱颜辞镜花辞树</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">分类</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">19</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/yjdwbj" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:yjdwbj@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://plus.google.com/yjdwbj" target="_blank" title="Google"><i class="fa fa-fw fa-google"></i>Google</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yjdwbj</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.2.2</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.2.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.2.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.2.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>

<!DOCTYPE html>






  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.2.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.2.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Ｗindows 下 Perl 运行环境Perl脚本语言在windows下有三个实现可以用，一般网上会建议安装ActivePerl的免费社区版本，我在 winxp 下安装不成功选了另一个DWIN Perl,还有一个StrawberryPerl没有试过.

默认安装在C:\Dwimperl,完成之后把它添加到环境变量，或者运行它自带的脚本C:\Dwimperl\update_env.pl.bat.">
<meta property="og:type" content="article">
<meta property="og:title" content="Windows下编译一些开源基础库">
<meta property="og:url" content="http://yoursite.com/2017/04/19/Windows下编译一些开源基础库/index.html">
<meta property="og:site_name" content="Sunrise 博客">
<meta property="og:description" content="Ｗindows 下 Perl 运行环境Perl脚本语言在windows下有三个实现可以用，一般网上会建议安装ActivePerl的免费社区版本，我在 winxp 下安装不成功选了另一个DWIN Perl,还有一个StrawberryPerl没有试过.

默认安装在C:\Dwimperl,完成之后把它添加到环境变量，或者运行它自带的脚本C:\Dwimperl\update_env.pl.bat.">
<meta property="og:image" content="http://yoursite.com/imgs/mm_reward_qrcode_1525013906055.png">
<meta property="og:updated_time" content="2020-06-19T03:01:28.411Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Windows下编译一些开源基础库">
<meta name="twitter:description" content="Ｗindows 下 Perl 运行环境Perl脚本语言在windows下有三个实现可以用，一般网上会建议安装ActivePerl的免费社区版本，我在 winxp 下安装不成功选了另一个DWIN Perl,还有一个StrawberryPerl没有试过.

默认安装在C:\Dwimperl,完成之后把它添加到环境变量，或者运行它自带的脚本C:\Dwimperl\update_env.pl.bat.">
<meta name="twitter:image" content="http://yoursite.com/imgs/mm_reward_qrcode_1525013906055.png">






  <link rel="canonical" href="http://yoursite.com/2017/04/19/Windows下编译一些开源基础库/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Windows下编译一些开源基础库 | Sunrise 博客</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-78826582-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-78826582-1');
</script>






  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Sunrise 博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/19/Windows下编译一些开源基础库/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/321919?s=400&u=67298bd9fc3b622eaf93a6cc511a24ac878e86db&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Windows下编译一些开源基础库
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-04-19 21:09:29" itemprop="dateCreated datePublished" datetime="2017-04-19T21:09:29+08:00">2017-04-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-06-19 11:01:28" itemprop="dateModified" datetime="2020-06-19T11:01:28+08:00">2020-06-19</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/笔记/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Windows-下-Perl-运行环境"><a href="#Windows-下-Perl-运行环境" class="headerlink" title="Ｗindows 下 Perl 运行环境"></a><code>Ｗindows</code> 下 Perl 运行环境</h1><p><a href="https://www.perl.org/get.html" target="_blank" rel="external"><strong>Perl</strong></a>脚本语言在<code>windows</code>下有三个实现可以用，一般网上会建议安装<a href="https://www.activestate.com/activeperl/downloads" target="_blank" rel="external"><strong>ActivePerl</strong></a>的免费社区版本，我在 winxp 下安装不成功选了另一个<a href="http://dwimperl.com/windows.html" target="_blank" rel="external"><strong>DWIN Perl</strong></a>,还有一个<a href="http://strawberryperl.com/" target="_blank" rel="external"><strong>StrawberryPerl</strong></a>没有试过.</p>
<ul>
<li>默认安装在<code>C:\Dwimperl</code>,完成之后把它添加到环境变量，或者运行它自带的脚本<code>C:\Dwimperl\update_env.pl.bat</code>.</li>
</ul>
<h1 id="Cygwin-MinGW-MSYS"><a href="#Cygwin-MinGW-MSYS" class="headerlink" title="Cygwin,MinGW,MSYS"></a>Cygwin,MinGW,MSYS</h1><p>windows 下一些 GNU 工具套装介绍，摘自网络。</p>
<ol>
<li><a href="http://www.mingw.org/" target="_blank" rel="external"><strong>MinGW</strong></a>是 windows 版本的 gcc 集合，不需要依赖中间层。</li>
<li>MSYS 是小型的 linux 的环境的模拟，可以与 MinGW 结合来模拟 linux 环境下使用 MinGW 的 gcc,但是好久都不更新了，现在网有一个<a href="http://www.msys2.org/" target="_blank" rel="external"><strong>MSYS2</strong></a>,但是这两个环境在 winxp 下安装不成功，之前是可以安装 msys.。</li>
<li><a href="http://www.cygwin.com/" target="_blank" rel="external"><strong>Cygwin</strong></a>是功能强大的 linux 环境，由于有 cygwin1.dll 实现了底层的 windows api 到 linux api 的转化。所以在 Cygwin 里开发就相当于在 linux 上开发，对于开发人员来说就相当于调用 linux 类型的 api，所以这样开发的程序也可以直接移植到 linux 上。但是如果这样的程序要在 windows 上执行的话，运行时必须要<code>cygwin1.dll</code>支持。</li>
</ol>
<h1 id="安装Qt-MinGW-版本的-IDE"><a href="#安装Qt-MinGW-版本的-IDE" class="headerlink" title="安装Qt ＭinGW 版本的 IDE"></a>安装<code>Qt ＭinGW</code> 版本的 IDE</h1><ul>
<li>本人还是喜欢使用 Qt 来现在界面程，惟一缺点就是生成静态库的执行程序有比较大,Qt 在 win 下面有两个版本，<code>GCC,MSVC</code>.我下面要做的编译基础库都是基于 QT 安装自带的 <code>MinGW GCC</code>，这样在 QT 中再调用这些库就不会出现一些奇奇怪怪的问题了。</li>
</ul>
<h1 id="Zlib"><a href="#Zlib" class="headerlink" title="Zlib"></a>Zlib</h1><h2 id="MinGW-编译"><a href="#MinGW-编译" class="headerlink" title="MinGW 编译"></a>MinGW 编译</h2><ul>
<li>下截<a href="http://zlib.net/zlib-1.2.11.tar.gz" target="_blank" rel="external"><code>zlib</code></a>最新版本，解压到出来。打开一个命令行窗口，执行Ｑ t MinGW 环境脚本<code>C:\WINDOWS\system32\cmd.exe /A /Q /K C:\Qt\Qt5.7.1\5.7\mingw53_32\bin\qtenv2.bat</code>,一般装完Ｑ t 会有指向这个脚本的快捷方式，点击运行即可。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">D:\zlib-1.2.11\zlib-1.2.11&gt;mingw32-make <span class="_">-f</span> win32/Makefile.gcc</div><div class="line">gcc  -O3 -Wall -c -o adler32.o adler32.c</div><div class="line">gcc  -O3 -Wall -c -o compress.o compress.c</div><div class="line">gcc  -O3 -Wall -c -o crc32.o crc32.c</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">strip example_d.exe</div><div class="line">gcc  -o minigzip_d.exe minigzip.o libz.dll.a</div><div class="line">strip minigzip_d.exe</div></pre></td></tr></table></figure>
<p>按上面编译成功后，会当前目录下生成 zlib1.dll,libz.dll.a ,libz 等库文件，把这些库文件与头文件复到一个目录，包含并链接它们就可以了。</p>
<h2 id="MSVC-编译"><a href="#MSVC-编译" class="headerlink" title="MSVC 编译"></a>MSVC 编译</h2><h3 id="x86-32bit"><a href="#x86-32bit" class="headerlink" title="x86 32bit"></a>x86 32bit</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">D:\SourceBuild\zlib-1.2.11&gt;vcvarsall.bat</div><div class="line">Setting environment <span class="keyword">for</span> using Microsoft Visual Studio 2010 x86 tools.</div><div class="line">D:\SourceBuild\zlib-1.2.11&gt;nmake /f win32/Makefile.msc</div><div class="line"></div><div class="line">Microsoft (R) 程序维护实用工具 10.00.30319.01 版</div><div class="line">版权所有(C) Microsoft Corporation。保留所有权利。</div><div class="line"></div><div class="line">        cl -c -D_CRT_SECURE_NO_DEPRECATE -D_CRT_NONSTDC_NO_DEPRECATE -nologo -MD</div><div class="line"> -W3 -O2 -Oy- -Zi -Fd<span class="string">"zlib"</span>  .\adler32.c</div><div class="line">adler32.c</div><div class="line">        cl -c -D_CRT_SECURE_NO_DEPRECATE -D_CRT_NONSTDC_NO_DEPRECATE -nologo -MD</div><div class="line"> -W3 -O2 -Oy- -Zi -Fd<span class="string">"zlib"</span>  .\compress.c</div><div class="line">compress.c</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">fest -outputresource:example_d.exe;1</div><div class="line">        link -nologo -debug -incremental:no -opt:ref -out:minigzip_d.exe minigzi</div><div class="line">p.obj zdll.lib</div><div class="line">        <span class="keyword">if</span> exist minigzip_d.exe.manifest  mt -nologo -manifest minigzip_d.exe.ma</div><div class="line">nifest -outputresource:minigzip_d.exe;1</div></pre></td></tr></table></figure>
<p>编译完成后会生成 zlib.lib,zlib1.dll 等一些文件。</p>
<h3 id="x86-amd64"><a href="#x86-amd64" class="headerlink" title="x86_amd64"></a>x86_amd64</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">D:\SourceBuild\zlib-1.2.11&gt;vcvarsx86_amd64.bat</div><div class="line">Setting environment <span class="keyword">for</span> using Microsoft Visual Studio 2010 x64 cross tools.</div><div class="line"></div><div class="line"></div><div class="line">D:\SourceBuild\zlib-1.2.11&gt;nmake /f win32/Makefile.msc</div><div class="line"></div><div class="line">Microsoft (R) 程序维护实用工具 10.00.30319.01 版</div><div class="line">版权所有(C) Microsoft Corporation。保留所有权利。</div><div class="line"></div><div class="line">        cl -c -D_CRT_SECURE_NO_DEPRECATE -D_CRT_NONSTDC_NO_DEPRECATE -nologo -MD</div><div class="line"> -W3 -O2 -Oy- -Zi -Fd<span class="string">"zlib"</span>  .\adler32.c</div><div class="line">adler32.c</div><div class="line">        cl -c -D_CRT_SECURE_NO_DEPRECATE -D_CRT_NONSTDC_NO_DEPRECATE -nologo -MD</div><div class="line"> -W3 -O2 -Oy- -Zi -Fd<span class="string">"zlib"</span>  .\compress.c</div><div class="line">compress.c</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">fest -outputresource:example_d.exe;1</div><div class="line">        link -nologo -debug -incremental:no -opt:ref -out:minigzip_d.exe minigzi</div><div class="line">p.obj zdll.lib</div><div class="line">        <span class="keyword">if</span> exist minigzip_d.exe.manifest  mt -nologo -manifest minigzip_d.exe.ma</div><div class="line">nifest -outputresource:minigzip_d.exe;1</div></pre></td></tr></table></figure>
<h2 id="OpenSSL"><a href="#OpenSSL" class="headerlink" title="OpenSSL"></a>OpenSSL</h2><ul>
<li>下载<a href="https://www.openssl.org/source/openssl-1.1.0e.tar.gz" target="_blank" rel="external"><code>openssl-1.1.0e</code></a>,解压出来，仔细阅读里面<code>NOTES.WIN</code>,<code>INSTALL</code>这两个文本文档，里面有详细的编译安装说明。里面调用<code>nmake</code>native 编译的，要确保机器安装了<code>Visual Stduio</code>开发环境，winxp 最高只能安装 vs2010.这里没有找到使用 MinGW 编译的方法只能使用 nmake 来编译，开发启<code>zlib</code>支持就只能使用 zlib 的<code>MSVC</code>的编译版本。</li>
<li>编译前先初始化 MSVC 的环境变量，有分<code>x86</code>与<code>x86_amd64</code>,确保<code>C:\Program Files\Microsoft Visual Studio 10.0\VC</code>加入用户的<code>PATH</code>变量里面。打开一个新命令行窗口执行：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">D:\SourceBuild\openssl-1.1.0e&gt;vcvarsall.bat</div><div class="line">Setting environment <span class="keyword">for</span> using Microsoft Visual Studio 2010 x86 tools.</div><div class="line"></div><div class="line">D:\SourceBuild\openssl-1.1.0e&gt; perl Configure VC-WIN32</div><div class="line">Configuring OpenSSL version 1.1.0e (0x1010005fL)</div><div class="line">    no-asan         [default]  OPENSSL_NO_ASAN</div><div class="line">    no-crypto-mdebug [default]  OPENSSL_NO_CRYPTO_MDEBUG</div><div class="line">    no-crypto-mdebug-backtrace [default]  OPENSSL_NO_CRYPTO_MDEBUG_BACKTRACE</div><div class="line">    no-ec_nistp_64_gcc_128 [default]  OPENSSL_NO_EC_NISTP_64_GCC_128</div><div class="line">    no-egd          [default]  OPENSSL_NO_EGD</div><div class="line">    no-fuzz-afl     [default]  OPENSSL_NO_FUZZ_AFL</div><div class="line">    no-fuzz-libfuzzer [default]  OPENSSL_NO_FUZZ_LIBFUZZER</div><div class="line">    no-heartbeats   [default]  OPENSSL_NO_HEARTBEATS</div><div class="line">    no-md2          [default]  OPENSSL_NO_MD2 (skip dir)</div><div class="line">    no-msan         [default]  OPENSSL_NO_MSAN</div><div class="line">    no-rc5          [default]  OPENSSL_NO_RC5 (skip dir)</div><div class="line">    no-sctp         [default]  OPENSSL_NO_SCTP</div><div class="line">    no-ssl-trace    [default]  OPENSSL_NO_SSL_TRACE</div><div class="line">    no-ssl3         [default]  OPENSSL_NO_SSL3</div><div class="line">    no-ssl3-method  [default]  OPENSSL_NO_SSL3_METHOD</div><div class="line">    no-ubsan        [default]  OPENSSL_NO_UBSAN</div><div class="line">    no-unit-test    [default]  OPENSSL_NO_UNIT_TEST</div><div class="line">    no-weak-ssl-ciphers [default]  OPENSSL_NO_WEAK_SSL_CIPHERS</div><div class="line">    no-zlib         [default]</div><div class="line">    no-zlib-dynamic [default]</div><div class="line">Configuring <span class="keyword">for</span> VC-WIN32</div><div class="line">CC            =cl</div><div class="line">CFLAG         =-W3 -wd4090 -Gs0 -GF -Gy -nologo -DOPENSSL_SYS_WIN32 -DWIN32_LEAN</div><div class="line">_AND_MEAN -DL_ENDIAN -D_CRT_SECURE_NO_DEPRECATE -DUNICODE -D_UNICODE /MD /O2</div><div class="line">[...]</div><div class="line"></div><div class="line">D:\SourceBuild\openssl-1.1.0e&gt;nmake</div><div class="line">[...]</div><div class="line"></div><div class="line">D:\SourceBuild\openssl-1.1.0e&gt;nmake <span class="built_in">test</span></div><div class="line">[...]</div></pre></td></tr></table></figure>
<h3 id="C-ares"><a href="#C-ares" class="headerlink" title="C-ares"></a>C-ares</h3><ul>
<li>下载<a href="https://c-ares.haxx.se/download/c-ares-1.12.0.tar.gz" target="_blank" rel="external"><code>C-ares-1.12</code></a>,查看了它自带<code>README</code>，通过命令行使用<code>nmake</code>安装不成功，通过它的 vc 目录下的 VC 工程,要用 vs2010IDE 打开就可以编译在成功。生成了<br>cares.lib,cares.dll.</li>
</ul>
<h3 id="Curl"><a href="#Curl" class="headerlink" title="Curl"></a>Curl</h3><ul>
<li><p>下载<a href="https://curl.haxx.se/download/curl-7.53.1.zip" target="_blank" rel="external"><code>curl-7.53.1</code></a>,解压出来，仔细阅读它的文档。<code>winbuild/BUILD.WINDOWS.txt</code>文档详细说明了如何编译安装。</p>
</li>
<li><p>根据文档指示，如果依赖一些其它库要在它的同级目录新建如下结构的目录结构</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">If you wish to support zlib, openssl, c-ares, ssh2, you will have to download</div><div class="line">  them separately and copy them to the deps directory as shown below:</div><div class="line"></div><div class="line">  somedirectory</div><div class="line">   |_curl-src</div><div class="line">   | |_winbuild</div><div class="line">   |</div><div class="line">   |_deps</div><div class="line">     |_ lib</div><div class="line">     |_ include</div><div class="line">     |_ bin</div></pre></td></tr></table></figure>
<ul>
<li>目录结构如下</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">D:\SourceBuild\deps&gt;tree /?</div><div class="line">以图形显示驱动器或路径的文件夹结构。</div><div class="line"></div><div class="line">TREE [drive:][path] [/F] [/A]</div><div class="line"></div><div class="line">   /F   显示每个文件夹中文件的名称。</div><div class="line">   /A   使用 ASCII 字符，而不使用扩展字符。</div><div class="line"></div><div class="line"></div><div class="line">D:\SourceBuild\deps&gt;tree /F</div><div class="line">卷 新加卷 的文件夹 PATH 列表</div><div class="line">卷序列号码为 0006EE44 E462:E6DB</div><div class="line">D:.</div><div class="line">├─include</div><div class="line">│  │  ares.h</div><div class="line">│  │  ares_build.h</div><div class="line">│  │  ares_rules.h</div><div class="line">│  │  ares_version.h</div><div class="line">│  │  zconf.h</div><div class="line">│  │  zlib.h</div><div class="line">│  │</div><div class="line">│  ├─internal</div><div class="line">│  │      bio.h</div><div class="line">│  │      comp.h</div><div class="line">│  │      conf.h</div><div class="line">│  │      constant_time_locl.h</div><div class="line">│  │      dane.h</div><div class="line">│  │      dso.h</div><div class="line">│  │      err.h</div><div class="line">│  │      numbers.h</div><div class="line">│  │      o_dir.h</div><div class="line">│  │      o_str.h</div><div class="line">│  │      thread_once.h</div><div class="line">│  │</div><div class="line">│  └─openssl</div><div class="line">│          aes.h</div><div class="line">│          asn1.h</div><div class="line">│          asn1t.h</div><div class="line">│          asn1_mac.h</div><div class="line">│          async.h</div><div class="line">│          [...]</div><div class="line">│          x509v3.h</div><div class="line">│          x509_vfy.h</div><div class="line">│          __DECC_INCLUDE_EPILOGUE.H</div><div class="line">│          __DECC_INCLUDE_PROLOGUE.H</div><div class="line">│</div><div class="line">└─lib</div><div class="line">        cares.dll</div><div class="line">        cares.lib</div><div class="line">        libcrypto-1_1.dll</div><div class="line">        libcrypto.lib</div><div class="line">        libssl-1_1.dll</div><div class="line">        libssl.lib</div><div class="line">        zdll.lib</div><div class="line">        zlib.h</div><div class="line">        zlib.lib</div><div class="line">        zlib1.dll</div></pre></td></tr></table></figure>
<ul>
<li>因为这个版本的 CURL 依赖 openssl 时，会连接<code>libeay32.lib,ssleay32.lib</code>.这里要在脚本文件<code>\winbuild\MakefileBuild.vc</code>里把它改成<code>libssl.lib,libcrypto.lib</code>.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">D:\SourceBuild\curl-7.53.1\winbuild&gt;nmake /f Makefile.vc mode=dll vc=10 with_ssl</div><div class="line">=dll with_cares=dll with_zlib=dll machine=x86</div></pre></td></tr></table></figure>
<ul>
<li>如果不出错就会产生几个新的文件夹如下：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">D:\SourceBuild\curl-7.53.1\builds&gt;tree</div><div class="line">卷 新加卷 的文件夹 PATH 列表</div><div class="line">卷序列号码为 0006EE44 E462:E6DB</div><div class="line">D:.</div><div class="line">├─libcurl-vc10-x86-release-dll-ssl-dll-cares-dll-zlib-dll-ipv6-sspi</div><div class="line">│  ├─bin</div><div class="line">│  ├─include</div><div class="line">│  │  └─curl</div><div class="line">│  └─lib</div><div class="line">├─libcurl-vc10-x86-release-dll-ssl-dll-cares-dll-zlib-dll-ipv6-sspi-obj-curl</div><div class="line">└─libcurl-vc10-x86-release-dll-ssl-dll-cares-dll-zlib-dll-ipv6-sspi-obj-lib</div><div class="line">    ├─vauth</div><div class="line">    └─vtls</div></pre></td></tr></table></figure>
<h3 id="MinGW-编译-CURL"><a href="#MinGW-编译-CURL" class="headerlink" title="MinGW 编译 CURL"></a>MinGW 编译 CURL</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">D:\SourceBuild\curl-7.53.1&gt;mkdir mingwbuild</div><div class="line">D:\SourceBuild\curl-7.53.1&gt;<span class="built_in">cd</span> mingwbuild</div><div class="line">D:\SourceBuild\curl-7.53.1\mingwbuild&gt;cmake -G <span class="string">"MinGW Makefiles"</span> ../</div><div class="line">D:\SourceBuild\curl-7.53.1\mingwbuild&gt;mingw32-make</div></pre></td></tr></table></figure>
<ul>
<li>会在当前目录下生成库文件与一些测试程序。</li>
</ul>
<hr>
<h1 id="MXE-环境下交叉编译一些库"><a href="#MXE-环境下交叉编译一些库" class="headerlink" title="MXE 环境下交叉编译一些库"></a>MXE 环境下交叉编译一些库</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$cd</span> mxe</div><div class="line">mxe$ make MXE_TARGETS=<span class="string">"i686-w64-mingw32.shared"</span> curl libwebsockets</div><div class="line"></div><div class="line">$ <span class="built_in">cd</span> ~/mxe/download_src/c-ares-1.12.0/build$</div><div class="line">$ <span class="built_in">export</span> CROSS_COMPILER=i686-w64-mingw32.shared-</div><div class="line">$ ../configure  --prefix=/path/mxe/usr/i686-w64-mingw32.shared --host=i686-w64-mingw32</div><div class="line">$ make &amp;&amp; make install</div><div class="line">$ ls /path/mxe/usr/i686-w64-mingw32.shared/lib/libcares.*</div><div class="line">/path/mxe/usr/i686-w64-mingw32.shared/lib/libcares.dll.a  /path/mxe/usr/i686-w64-mingw32.shared/lib/libcares.la</div></pre></td></tr></table></figure>
<h4 id="mosquitto"><a href="#mosquitto" class="headerlink" title="mosquitto"></a>mosquitto</h4><ul>
<li>下载<a href="http://mosquitto.org/files/source/mosquitto-1.4.11.tar.gz" target="_blank" rel="external"><code>Mosquitto-1.4.11</code></a>,解压出来，看了一下它的<code>readme-windows.txt</code>在 winxp 下编译安装不成功，不管是 MSVC 还是 MinGW.我根据错误提示做了一些源代码的修改，使用Ｑ t MinGW 还有 MXE 环境下编译成功了。修改如下：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div></pre></td><td class="code"><pre><div class="line">$ diff -r mosquitto-1.4.11 mosquitto-1.4.11-lcy-changed</div><div class="line">Only <span class="keyword">in</span> mosquitto-1.4.11-lcy-changed: build</div><div class="line">diff -r mosquitto-1.4.11/config.mk mosquitto-1.4.11-lcy-changed/config.mk</div><div class="line">68c68</div><div class="line">&lt; WITH_WEBSOCKETS:=no</div><div class="line">---</div><div class="line">&gt; WITH_WEBSOCKETS:=yes</div><div class="line">diff -r mosquitto-1.4.11/lib/CMakeLists.txt mosquitto-1.4.11-lcy-changed/lib/CMakeLists.txt</div><div class="line">7,8c7,12</div><div class="line">&lt; 		<span class="built_in">set</span> (PTHREAD_LIBRARIES C:\\pthreads\\Pre-built.2\\lib\\x86\\pthreadVC2.lib)</div><div class="line">&lt; 		<span class="built_in">set</span> (PTHREAD_INCLUDE_DIR C:\\pthreads\\Pre-built.2\\include)</div><div class="line">---</div><div class="line">&gt;     <span class="keyword">if</span> (MINGW)</div><div class="line">&gt;       <span class="built_in">set</span> (PTHREAD_LIBRARIES -lpthread)</div><div class="line">&gt;     <span class="keyword">else</span> ( MINGW)</div><div class="line">&gt; 		  <span class="built_in">set</span> (PTHREAD_LIBRARIES C:\\pthreads\\Pre-built.2\\lib\\x86\\pthreadVC2.lib)</div><div class="line">&gt; 		  <span class="built_in">set</span> (PTHREAD_INCLUDE_DIR C:\\pthreads\\Pre-built.2\\include)</div><div class="line">&gt;     endif (MINGW)</div><div class="line">diff -r mosquitto-1.4.11/lib/mosquitto_internal.h mosquitto-1.4.11-lcy-changed/lib/mosquitto_internal.h</div><div class="line">20a21</div><div class="line">&gt; <span class="comment">#include &lt;stdint.h&gt;</span></div><div class="line">diff -r mosquitto-1.4.11/lib/net_mosq.c mosquitto-1.4.11-lcy-changed/lib/net_mosq.c</div><div class="line">29a30</div><div class="line">&gt; <span class="comment">#define AI_ADDRCONFIG 0x400</span></div><div class="line">diff -r mosquitto-1.4.11/lib/time_mosq.c mosquitto-1.4.11-lcy-changed/lib/time_mosq.c</div><div class="line">45,47c45,48</div><div class="line">&lt; 		<span class="keyword">if</span>(vi.dwMajorVersion &gt; 5)&#123;</div><div class="line">&lt; 			tick64 = <span class="literal">true</span>;</div><div class="line">&lt; 		&#125;</div><div class="line">---</div><div class="line">&gt; 		<span class="keyword">if</span>(vi.dwMajorVersion &gt; 5 )</div><div class="line">&gt;     &#123;</div><div class="line">&gt;       tick64 = <span class="literal">true</span>;</div><div class="line">&gt;     &#125;</div><div class="line">56c57</div><div class="line">&lt; 		<span class="built_in">return</span> GetTickCount64()/1000;</div><div class="line">---</div><div class="line">&gt; 		<span class="built_in">return</span> GetTickCount()/1000;</div><div class="line">diff -r mosquitto-1.4.11/lib/tls_mosq.c mosquitto-1.4.11-lcy-changed/lib/tls_mosq.c</div><div class="line">21a22</div><div class="line">&gt; <span class="comment"># include &lt;windows.h&gt;</span></div><div class="line">118,119c119,128</div><div class="line">&lt; 	ipv6_ok = InetPton(AF_INET6, hostname, &amp;ipv6_addr);</div><div class="line">&lt; 	ipv4_ok = InetPton(AF_INET, hostname, &amp;ipv4_addr);</div><div class="line">---</div><div class="line">&gt;   typedef INT (WSAAPI *ptrInetPton)( INT     Family, PCTSTR pszAddrString, PVOID  pAddrBuf);</div><div class="line">&gt;   HMODULE  h = LoadLibrary(L<span class="string">"ws2_32.dll"</span>);</div><div class="line">&gt;   ptrInetPton  func = (ptrInetPton)GetProcAddress(h,<span class="string">"InetPtonW"</span>);</div><div class="line">&gt;</div><div class="line">&gt; 	ipv6_ok = func(AF_INET6, hostname, &amp;ipv6_addr);</div><div class="line">&gt; 	ipv4_ok = func(AF_INET, hostname, &amp;ipv4_addr);</div><div class="line">&gt;   FreeLibrary(h); h = NULL;</div><div class="line">&gt;</div><div class="line">&gt; 	//ipv6_ok = InetPton(AF_INET6, hostname, &amp;ipv6_addr);</div><div class="line">&gt; 	//ipv4_ok = InetPton(AF_INET, hostname, &amp;ipv4_addr);</div><div class="line">diff -r mosquitto-1.4.11/src/conf.c mosquitto-1.4.11-lcy-changed/src/conf.c</div><div class="line">33a34</div><div class="line">&gt; <span class="comment">#define AI_ADDRCONFIG 0x400</span></div><div class="line">diff -r mosquitto-1.4.11/src/loop.c mosquitto-1.4.11-lcy-changed/src/loop.c</div><div class="line">27a28,107</div><div class="line">&gt; <span class="comment">#include &lt;windows.h&gt;</span></div><div class="line">&gt; <span class="comment">#if (_WIN32_WINNT &lt; 0x0600)</span></div><div class="line">&gt;</div><div class="line">&gt; <span class="comment">#define POLLIN 0x0001</span></div><div class="line">&gt; <span class="comment">#define POLLPRI 0x0002</span></div><div class="line">&gt; <span class="comment">#define POLLOUT 0x0004</span></div><div class="line">&gt; <span class="comment">#define POLLERR 0x0008</span></div><div class="line">&gt; <span class="comment">#define POLLHUP 0x0010</span></div><div class="line">&gt; <span class="comment">#define POLLNVAL 0x0020</span></div><div class="line">&gt;</div><div class="line">&gt; <span class="comment">#ifdef FD_SETSIZE</span></div><div class="line">&gt; <span class="comment">#undef FD_SETSIZE</span></div><div class="line">&gt; <span class="comment">#endif</span></div><div class="line">&gt;</div><div class="line">&gt; <span class="comment">#define FD_SETSIZE 1000</span></div><div class="line">&gt;</div><div class="line">&gt; struct pollfd &#123;</div><div class="line">&gt;   SOCKET fd;</div><div class="line">&gt;   short events;</div><div class="line">&gt;   short revents;</div><div class="line">&gt; &#125;;</div><div class="line">&gt;</div><div class="line">&gt;</div><div class="line">&gt; int mingw_poll(struct pollfd *fds, unsigned int nfds, int timo)</div><div class="line">&gt; &#123;</div><div class="line">&gt;     struct timeval timeout, *toptr;</div><div class="line">&gt;     fd_set ifds, ofds, efds, *ip, *op;</div><div class="line">&gt;     int i, rc;</div><div class="line">&gt;</div><div class="line">&gt;     /* Set up the file-descriptor sets <span class="keyword">in</span> ifds, ofds and efds. */</div><div class="line">&gt;     FD_ZERO(&amp;ifds);</div><div class="line">&gt;     FD_ZERO(&amp;ofds);</div><div class="line">&gt;     FD_ZERO(&amp;efds);</div><div class="line">&gt;     <span class="keyword">for</span> (i = 0, op = ip = 0; i &lt; nfds; ++i) &#123;</div><div class="line">&gt;         fds[i].revents = 0;</div><div class="line">&gt;         <span class="keyword">if</span>(fds[i].events &amp; (POLLIN|POLLPRI)) &#123;</div><div class="line">&gt;             ip = &amp;ifds;</div><div class="line">&gt;             FD_SET(fds[i].fd, ip);</div><div class="line">&gt;         &#125;</div><div class="line">&gt;         <span class="keyword">if</span>(fds[i].events &amp; POLLOUT) &#123;</div><div class="line">&gt;             op = &amp;ofds;</div><div class="line">&gt;             FD_SET(fds[i].fd, op);</div><div class="line">&gt;         &#125;</div><div class="line">&gt;         FD_SET(fds[i].fd, &amp;efds);</div><div class="line">&gt;     &#125;</div><div class="line">&gt;</div><div class="line">&gt;     /* Set up the timeval structure <span class="keyword">for</span> the timeout parameter */</div><div class="line">&gt;     <span class="keyword">if</span>(timo &lt; 0) &#123;</div><div class="line">&gt;         toptr = 0;</div><div class="line">&gt;     &#125; <span class="keyword">else</span> &#123;</div><div class="line">&gt;         toptr = &amp;timeout;</div><div class="line">&gt;         timeout.tv_sec = timo / 1000;</div><div class="line">&gt;         timeout.tv_usec = (timo - timeout.tv_sec * 1000) * 1000;</div><div class="line">&gt;     &#125;</div><div class="line">&gt;</div><div class="line">&gt;     //kWarning()&lt;&lt;QString(<span class="string">"Entering select() sec=%1 usec=%2 ip=%3 op=%4"</span>).arg(timeout.tv_sec).arg(timeout.tv_usec).arg((long)ip).arg((long)op);</div><div class="line">&gt;</div><div class="line">&gt;     rc = select(0, ip, op, &amp;efds, toptr);</div><div class="line">&gt;</div><div class="line">&gt;     //kWarning()&lt;&lt;<span class="string">"Exiting select rc="</span>&lt;&lt;rc;</div><div class="line">&gt;</div><div class="line">&gt;     <span class="keyword">if</span>(rc &lt;= 0)</div><div class="line">&gt;         <span class="built_in">return</span> rc;</div><div class="line">&gt;</div><div class="line">&gt;     <span class="keyword">if</span>(rc &gt; 0) &#123;</div><div class="line">&gt;         <span class="keyword">for</span> (i = 0; i &lt; nfds; ++i) &#123;</div><div class="line">&gt;             int fd = fds[i].fd;</div><div class="line">&gt;             <span class="keyword">if</span>(fds[i].events &amp; (POLLIN|POLLPRI) &amp;&amp; FD_ISSET(fd, &amp;ifds))</div><div class="line">&gt;                 fds[i].revents |= POLLIN;</div><div class="line">&gt;             <span class="keyword">if</span>(fds[i].events &amp; POLLOUT &amp;&amp; FD_ISSET(fd, &amp;ofds))</div><div class="line">&gt;                 fds[i].revents |= POLLOUT;</div><div class="line">&gt;             <span class="keyword">if</span>(FD_ISSET(fd, &amp;efds))</div><div class="line">&gt;                 /* Some error was detected ... should be some way to know. */</div><div class="line">&gt;                 fds[i].revents |= POLLHUP;</div><div class="line">&gt;             //kWarning()&lt;&lt;QString(<span class="string">"%1 %2 %3 revent = %4"</span>).arg(FD_ISSET(fd, &amp;ifds)).arg(FD_ISSET(fd, &amp;ofds)).arg(FD_ISSET(fd, &amp;efds)).arg(fds[i].revents);</div><div class="line">&gt;         &#125;</div><div class="line">&gt;     &#125;</div><div class="line">&gt;     <span class="built_in">return</span> rc;</div><div class="line">&gt; &#125;</div><div class="line">&gt; <span class="comment">#endif</span></div><div class="line">354c434,435</div><div class="line">&lt; 		fdcount = WSAPoll(pollfds, pollfd_index, 100);</div><div class="line">---</div><div class="line">&gt; 		//fdcount = WSAPoll(pollfds, pollfd_index, 100);</div><div class="line">&gt; 		fdcount = mingw_poll(pollfds, pollfd_index, 100);</div><div class="line">diff -r mosquitto-1.4.11/src/net.c mosquitto-1.4.11-lcy-changed/src/net.c</div><div class="line">26a27</div><div class="line">&gt; <span class="comment">#include &lt;windows.h&gt;</span></div><div class="line">516a518,523</div><div class="line">&gt; <span class="comment">#ifdef WIN32</span></div><div class="line">&gt;</div><div class="line">&gt; typedef PCTSTR (WSAAPI *ptrInetNtop)( INT     Family, PVOID  pAddr, PTSTR  pStringBuf, size_t StringBufSize);</div><div class="line">&gt;   HMODULE  h = LoadLibrary(L<span class="string">"ws2_32.dll"</span>);</div><div class="line">&gt;   ptrInetNtop  func = (ptrInetNtop)GetProcAddress(h,<span class="string">"InetNtop"</span>);</div><div class="line">&gt; <span class="comment">#endif</span></div><div class="line">520a528,531</div><div class="line">&gt; <span class="comment">#ifdef WIN32</span></div><div class="line">&gt; 			<span class="keyword">if</span>(func(AF_INET, &amp;((struct sockaddr_in *)&amp;addr)-&gt;sin_addr.s_addr, buf, len))&#123;</div><div class="line">&gt; 				<span class="built_in">return</span> 0;</div><div class="line">&gt; <span class="comment">#else</span></div><div class="line">522a534</div><div class="line">&gt; <span class="comment">#endif</span></div><div class="line">524a537,540</div><div class="line">&gt; <span class="comment">#ifdef WIN32</span></div><div class="line">&gt; 			<span class="keyword">if</span>(func(AF_INET6, &amp;((struct sockaddr_in6 *)&amp;addr)-&gt;sin6_addr.s6_addr, buf, len))&#123;</div><div class="line">&gt; 				<span class="built_in">return</span> 0;</div><div class="line">&gt; <span class="comment">#else</span></div><div class="line">526a543</div><div class="line">&gt; <span class="comment">#endif</span></div><div class="line">529a547,549</div><div class="line">&gt; <span class="comment">#ifdef WIN32</span></div><div class="line">&gt; FreeLibrary(h);</div></pre></td></tr></table></figure>
<ul>
<li><code>MXE</code>编译参数如下，要先安装<code>OPENSSL</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cmake -DCMAKE_SHARED_LIBRARY_LINK_C_FLAGS=<span class="string">""</span> -DCMAKE_SHARED_LIBRARY_LINK_CXX_FLAGS=<span class="string">""</span> -DWIN32=ON -DMINGW=ON -DCMAKE_SYSTEM_NAME=Windows -DCMAKE_C_COMPILER=i686-w64-mingw32.shared-gcc  -DOPENSSL_ROOT_DIR=/path/usr/i686-w64-mingw32.shared ..</div></pre></td></tr></table></figure>
<ul>
<li>Qt MinGW 编译</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">D:\SourceBuild\mosquitto-1.4.11-lcy-changed&gt; mkdir build</div><div class="line">D:\SourceBuild\mosquitto-1.4.11-lcy-changed&gt; <span class="built_in">cd</span> build</div><div class="line">D:\SourceBuild\mosquitto-1.4.11-lcy-changed\build&gt;cmake -G <span class="string">"MinGW Makefiles"</span> ..</div><div class="line">-- The C compiler identification is GNU 5.3.0</div><div class="line">-- The CXX compiler identification is GNU 5.3.0</div><div class="line">-- Check <span class="keyword">for</span> working C compiler: C:/Qt/Qt5.7.1/Tools/mingw530_32/bin/gcc.exe</div><div class="line">-- Check <span class="keyword">for</span> working C compiler: C:/Qt/Qt5.7.1/Tools/mingw530_32/bin/gcc.exe --</div><div class="line">works</div><div class="line">-- Detecting C compiler ABI info</div><div class="line">-- Detecting C compiler ABI info - <span class="keyword">done</span></div><div class="line">-- Detecting C compile features</div><div class="line">-- Detecting C compile features - <span class="keyword">done</span></div><div class="line">-- Check <span class="keyword">for</span> working CXX compiler: C:/Qt/Qt5.7.1/Tools/mingw530_32/bin/g++.exe</div><div class="line">-- Check <span class="keyword">for</span> working CXX compiler: C:/Qt/Qt5.7.1/Tools/mingw530_32/bin/g++.exe -</div><div class="line">- works</div><div class="line">-- Detecting CXX compiler ABI info</div><div class="line">-- Detecting CXX compiler ABI info - <span class="keyword">done</span></div><div class="line">-- Detecting CXX compile features</div><div class="line">-- Detecting CXX compile features - <span class="keyword">done</span></div><div class="line">-- Found OpenSSL: C:/Dwimperl/c/lib/libssleay32.a (found version <span class="string">"1.0.0d"</span>)</div><div class="line">CMake Warning at lib/CMakeLists.txt:73 (message):</div><div class="line">  c-ares library not found.</div><div class="line"></div><div class="line"></div><div class="line">-- Looking <span class="keyword">for</span> getaddrinfo_a <span class="keyword">in</span> anl</div><div class="line">-- Looking <span class="keyword">for</span> getaddrinfo_a <span class="keyword">in</span> anl - not found</div><div class="line">-- Configuring <span class="keyword">done</span></div><div class="line">-- Generating <span class="keyword">done</span></div><div class="line">-- Build files have been written to: D:/SourceBuild/mosquitto-1.4.11-lcy-changed</div><div class="line">/build</div><div class="line"></div><div class="line">D:\SourceBuild\mosquitto-1.4.11-lcy-changed\build&gt; mingw32-make</div><div class="line"></div><div class="line">[...]</div></pre></td></tr></table></figure>
<h2 id="MinGW-编译-rabbitmq-c"><a href="#MinGW-编译-rabbitmq-c" class="headerlink" title="MinGW 编译 rabbitmq-c"></a>MinGW 编译 rabbitmq-c</h2><ul>
<li>rabbitmq-c 是 RabbitMQ 的一个Ｃ语言客户实现,它的代码可以通过使用 MinGW 交叉编译到 Windows 上使用.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">~$ git <span class="built_in">clone</span> https://github.com/alanxz/rabbitmq-c</div><div class="line">~$ <span class="built_in">cd</span> rabbitmq-c &amp;&amp; mkdir build</div><div class="line">~$ <span class="built_in">cd</span> build</div><div class="line">~$ cmake  -DWIN32=ON -DMINGW=ON -DCMAKE_SYSTEM_NAME=Windows -DCMAKE_C_COMPILER=x86_64-w64-mingw32.static-gcc  -DOPENSSL_ROOT_DIR=/fullpath/usr/x86_64-w64-mingw32.static  ..</div></pre></td></tr></table></figure>
<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><ul>
<li>如果出现下面错误,需要在<code>CMakeLists.txt</code>加下面的参数.</li>
</ul>
<p>####　 CMAKE 出错</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-- Check <span class="keyword">if</span> compiler accepts -pthread</div><div class="line">CMake Error: TRY_RUN() invoked <span class="keyword">in</span> cross-compiling mode, please <span class="built_in">set</span> the following cache variables appropriately:</div><div class="line">   THREADS_PTHREAD_ARG (advanced)</div></pre></td></tr></table></figure>
<ul>
<li>加入下面三行到 CMakeLists.txt</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SET( THREADS_PTHREAD_ARG</div><div class="line">        <span class="string">"PLEASE_FILL_OUT-FAILED_TO_RUN"</span></div><div class="line">        CACHE STRING <span class="string">"Result from TRY_RUN"</span> FORCE)</div></pre></td></tr></table></figure>
<h4 id="编译-tests-出错"><a href="#编译-tests-出错" class="headerlink" title="编译 tests 出错"></a>编译 tests 出错</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">rabbitmq-c/tests/test_basic.c:34:22: fatal error: W<span class="keyword">in</span>Sock2.h: No such file or directory</div><div class="line">compilation terminated.</div><div class="line">tests/CMakeFiles/test_basic.dir/build.make:63: recipe <span class="keyword">for</span> target <span class="string">'tests/CMakeFiles/test_basic.dir/test_basic.c.obj'</span> failed</div><div class="line">make[2]: *** [tests/CMakeFiles/test_basic.dir/test_basic.c.obj] Error 1</div><div class="line">CMakeFiles/Makefile2:406: recipe <span class="keyword">for</span> target <span class="string">'tests/CMakeFiles/test_basic.dir/all'</span> failed</div><div class="line">make[1]: *** [tests/CMakeFiles/test_basic.dir/all] Error 2</div></pre></td></tr></table></figure>
<ul>
<li>1, 可以在<code>CMAKE</code>时不编译<code>tests</code>.</li>
<li>2, 把<code>ＷinSock2.h</code>改成<code>winsock2.h</code>试试.</li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul>
<li>上面提到这些库都是可以通过 MSVC 或者 MinGW 可以编译出来，一整套的编译环境加上一大堆的依赖库，还要应对一些编译器带来的错误，一般是不会像上面这样一个一个的去编译，更好的方法是使用 MXE 去编译上面这些库,但是依赖的动态库文件会比较多。</li>
</ul>
<h1 id="谢谢支持"><a href="#谢谢支持" class="headerlink" title="谢谢支持"></a>谢谢支持</h1><ul>
<li>微信二维码:</li>
<li><a href="mailto:yjdwbj@gmail.com" target="_blank" rel="external">联系作者</a></li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/MinGW-驱动/" rel="tag"># MinGW,驱动</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/04/19/Windows下WinDDK驱动开发/" rel="next" title="Windows下WinDDK驱动开发">
                <i class="fa fa-chevron-left"></i> Windows下WinDDK驱动开发
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/04/28/基于QT5编译OpenCV3-支持Python3/" rel="prev" title="基于QT5编译OpenCV3,支持Python3">
                基于QT5编译OpenCV3,支持Python3 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://avatars0.githubusercontent.com/u/321919?s=400&u=67298bd9fc3b622eaf93a6cc511a24ac878e86db&v=4"
                alt="yjdwbj" />
            
              <p class="site-author-name" itemprop="name">yjdwbj</p>
              <p class="site-description motion-element" itemprop="description">最是人间留不住,朱颜辞镜花辞树</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">40</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">分类</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">35</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/yjdwbj" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:yjdwbj@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://plus.google.com/yjdwbj" target="_blank" title="Google"><i class="fa fa-fw fa-google"></i>Google</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Windows-下-Perl-运行环境"><span class="nav-number">1.</span> <span class="nav-text">Ｗindows 下 Perl 运行环境</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Cygwin-MinGW-MSYS"><span class="nav-number">2.</span> <span class="nav-text">Cygwin,MinGW,MSYS</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装Qt-MinGW-版本的-IDE"><span class="nav-number">3.</span> <span class="nav-text">安装Qt ＭinGW 版本的 IDE</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Zlib"><span class="nav-number">4.</span> <span class="nav-text">Zlib</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MinGW-编译"><span class="nav-number">4.1.</span> <span class="nav-text">MinGW 编译</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MSVC-编译"><span class="nav-number">4.2.</span> <span class="nav-text">MSVC 编译</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#x86-32bit"><span class="nav-number">4.2.1.</span> <span class="nav-text">x86 32bit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#x86-amd64"><span class="nav-number">4.2.2.</span> <span class="nav-text">x86_amd64</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenSSL"><span class="nav-number">4.3.</span> <span class="nav-text">OpenSSL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#C-ares"><span class="nav-number">4.3.1.</span> <span class="nav-text">C-ares</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Curl"><span class="nav-number">4.3.2.</span> <span class="nav-text">Curl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MinGW-编译-CURL"><span class="nav-number">4.3.3.</span> <span class="nav-text">MinGW 编译 CURL</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MXE-环境下交叉编译一些库"><span class="nav-number">5.</span> <span class="nav-text">MXE 环境下交叉编译一些库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#mosquitto"><span class="nav-number">5.0.0.1.</span> <span class="nav-text">mosquitto</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MinGW-编译-rabbitmq-c"><span class="nav-number">5.1.</span> <span class="nav-text">MinGW 编译 rabbitmq-c</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#错误处理"><span class="nav-number">5.1.1.</span> <span class="nav-text">错误处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#编译-tests-出错"><span class="nav-number">5.1.1.1.</span> <span class="nav-text">编译 tests 出错</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#总结"><span class="nav-number">6.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#谢谢支持"><span class="nav-number">7.</span> <span class="nav-text">谢谢支持</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yjdwbj</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.2.2</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.2.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.2.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.2.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.2.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.2.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>

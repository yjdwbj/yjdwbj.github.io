<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="简介 参考链接: Arty A7-35T: Artix-7 FPGA Development Board for Makers and Hobbyists Arty Reference Manual    Vivado安装 Vivado的安装文件非常大,Web版本安装包Xilinx Unified Installer 2021.1: Linux Self Extracting Web Instal">
<meta name="keywords" content="FPGA,RISC-V,Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="XILINX_Arty-A7-35T实践指南">
<meta property="og:url" content="http://yoursite.com/2021/10/12/XILINX-Arty-A7-35T实践指南/index.html">
<meta property="og:site_name" content="Sunrise 博客">
<meta property="og:description" content="简介 参考链接: Arty A7-35T: Artix-7 FPGA Development Board for Makers and Hobbyists Arty Reference Manual    Vivado安装 Vivado的安装文件非常大,Web版本安装包Xilinx Unified Installer 2021.1: Linux Self Extracting Web Instal">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/imgs/xilinx/artya735t_add_config_mem_dev.png">
<meta property="og:image" content="http://yoursite.com/imgs/xilinx/artya735t_program_config_mcs.png">
<meta property="og:image" content="http://yoursite.com/imgs/xilinx/vivado-project.png">
<meta property="og:image" content="http://yoursite.com/imgs/xilinx/create_new_block_design.png">
<meta property="og:image" content="http://yoursite.com/imgs/xilinx/sdram_block_diagram.png">
<meta property="og:image" content="http://yoursite.com/imgs/xilinx/microblaze_ip_core.png">
<meta property="og:image" content="http://yoursite.com/imgs/xilinx/microblaze_ip_config.png">
<meta property="og:image" content="http://yoursite.com/imgs/xilinx/microblaze_layout.png">
<meta property="og:image" content="http://yoursite.com/imgs/xilinx/microblaze_bitstream_done.png">
<meta property="og:image" content="http://yoursite.com/imgs/xilinx/microblaze_app_create.png">
<meta property="og:image" content="http://yoursite.com/imgs/xilinx/microblaze_apps_done.png">
<meta property="og:image" content="http://yoursite.com/imgs/mm_reward_qrcode_1525013906055.png">
<meta property="og:updated_time" content="2021-12-14T08:38:18.514Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="XILINX_Arty-A7-35T实践指南">
<meta name="twitter:description" content="简介 参考链接: Arty A7-35T: Artix-7 FPGA Development Board for Makers and Hobbyists Arty Reference Manual    Vivado安装 Vivado的安装文件非常大,Web版本安装包Xilinx Unified Installer 2021.1: Linux Self Extracting Web Instal">
<meta name="twitter:image" content="http://yoursite.com/imgs/xilinx/artya735t_add_config_mem_dev.png">

<link rel="canonical" href="http://yoursite.com/2021/10/12/XILINX-Arty-A7-35T实践指南/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>XILINX_Arty-A7-35T实践指南 | Sunrise 博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sunrise 博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/10/12/XILINX-Arty-A7-35T实践指南/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="最是人间留不住,朱颜辞镜花辞树">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          XILINX_Arty-A7-35T实践指南
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-12 22:24:36" itemprop="dateCreated datePublished" datetime="2021-10-12T22:24:36+08:00">2021-10-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-14 16:38:18" itemprop="dateModified" datetime="2021-12-14T16:38:18+08:00">2021-12-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><ul>
<li>参考链接:<ul>
<li><a href="https://www.xilinx.com/products/boards-and-kits/1-elhaap.html" target="_blank" rel="noopener">Arty A7-35T: Artix-7 FPGA Development Board for Makers and Hobbyists</a></li>
<li><a href="https://digilent.com/reference/programmable-logic/arty/reference-manual?redirect=1" target="_blank" rel="noopener">Arty Reference Manual</a></li>
</ul>
</li>
</ul>
<h1 id="Vivado安装"><a href="#Vivado安装" class="headerlink" title="Vivado安装"></a>Vivado安装</h1><ul>
<li><a href="https://www.xilinx.com/support/download.html" target="_blank" rel="noopener">Vivado</a>的安装文件非常大,Web版本安装包<a href="https://www.xilinx.com/member/forms/download/xef.html?filename=Xilinx_Unified_2021.1_0610_2318_Lin64.bin" target="_blank" rel="noopener">Xilinx Unified Installer 2021.1: Linux Self Extracting Web Installer (BIN - 301.28 MB) </a>,离线版安装包<a href="https://www.xilinx.com/member/forms/download/xef.html?filename=Xilinx_Unified_2021.1_0610_2318.tar.gz" target="_blank" rel="noopener">Xilinx Unified Installer 2021.1 SFD (TAR/GZIP - 51.87 GB) </a>. 下载前,需要官网注册一个帐号,这里使用<code>Web</code>安装没有成功,后面还是使用离线版安装成功的.</li>
</ul>
<h1 id="RISC-V"><a href="#RISC-V" class="headerlink" title="RISC-V"></a>RISC-V</h1><ul>
<li><a href="https://forum.digikey.com/t/digilent-arty-a7-with-xilinx-artix-7-implementing-sifive-fe310-risc-v/13311" target="_blank" rel="noopener">Digilent Arty A7 with Xilinx Artix-7 Implementing SiFive FE310 RISC-V</a></li>
<li><a href="https://www.symmathics.com/index.php/risc-v-softcore-on-arty-a7/" target="_blank" rel="noopener">Building Symmathics Zero RISC-V</a></li>
<li><a href="https://www.rs-online.com/designspark/arty-100trisc-v-1-cn" target="_blank" rel="noopener">为ARTY-100T搭建RISC-V</a></li>
<li><a href="https://nm-projects.de/2017/06/open-source-risc-v-on-the-xilinx-artix-7-35t-arty/" target="_blank" rel="noopener">Open Source Risc-V on the Xilinx Artix-7 35T Arty – Part 1</a></li>
<li><a href="https://www.fpgadeveloper.com/2017/11/petalinux-for-artix-7-arty-base-project.html/" target="_blank" rel="noopener">PetaLinux for Artix-7 Arty Base Project</a></li>
<li><a href="https://www.rs-online.com/designspark/build-an-open-source-mcu-and-program-it-with-arduino" target="_blank" rel="noopener">Build an open source MCU and program it with Arduino</a></li>
</ul>
<h1 id="开源工具"><a href="#开源工具" class="headerlink" title="开源工具"></a>开源工具</h1><h2 id="Chisel-FIRRTL硬件编译框架"><a href="#Chisel-FIRRTL硬件编译框架" class="headerlink" title="Chisel/FIRRTL硬件编译框架"></a><code>Chisel/FIRRTL</code>硬件编译框架</h2><ul>
<li><a href="https://www.scala-sbt.org/download.html" target="_blank" rel="noopener">sbt</a><ul>
<li><code>sbt</code>是一个代码编译工具,是<code>scala</code>界的<code>mvn</code>,可以编译<code>scala</code>,<code>java</code>等,需要java1.6以上.作为<code>Scala</code>的标准构建工具,使用风格与<code>Maven</code>类似,由<code>Scala</code>语言写的,参考官方网站,目前的版本是1.54,虽然说Scala的项目可以通过Maven来构建和管理,但是依然推荐<code>sbt</code>,更适合一些.</li>
</ul>
</li>
<li><a href="https://www.chisel-lang.org/" target="_blank" rel="noopener">Chisel/FIRRTL Hardware Compiler Framework</a></li>
<li><a href="https://github.com/chipsalliance/rocket-chip" target="_blank" rel="noopener">chipsalliance/rocket-chip</a><ul>
<li><code>Rocket-chip</code>是一个<code>SoC</code>生成器,在很多场景下我们常用<code>Rocket</code>指代Rocket<strong>处理器</strong>,而实际上<code>Rocket-chip</code>是一个SoC生成器(Generator),它用来根据不同的配置参数产生不同处理器的<code>RTL</code>代码,而后者才是一个真正的<strong>处理器</strong>.</li>
</ul>
</li>
<li><a href="https://github.com/chipsalliance/chisel3" target="_blank" rel="noopener">chipsalliance/chisel3</a><ul>
<li><code>Chisel（Constructing Hardware In a Scala Embedded Language</code>）是<code>UC Berkeley</code>开发的一种开源硬件构造语言.它是建构在<code>Scala</code>语言之上的领域专用语言（DSL）,支持高度参数化的硬件生成器.</li>
</ul>
</li>
<li><a href="https://github.com/chipsalliance/firrtl" target="_blank" rel="noopener">chipsalliance/firrtl</a><ul>
<li>Firrtl is an intermediate representation (IR) for digital circuits designed as a platform for writing circuit-level transformations. This repository consists of a collection of transformations (written in Scala) which simplify, verify, transform, or emit their input circuit.</li>
</ul>
</li>
</ul>
<h2 id="LiteX框架"><a href="#LiteX框架" class="headerlink" title="LiteX框架"></a>LiteX框架</h2><ul>
<li><a href="https://github.com/enjoy-digital/litex/wiki" target="_blank" rel="noopener">litex/wiki</a></li>
<li>The <a href="https://github.com/enjoy-digital/litex" target="_blank" rel="noopener">LiteX</a> framework provides a convenient and efficient infrastructure to create FPGA Cores/SoCs, to explore various digital design architectures and create full FPGA based systems.</li>
</ul>
<h2 id="SymbiFlow"><a href="#SymbiFlow" class="headerlink" title="SymbiFlow"></a>SymbiFlow</h2><ul>
<li><a href="https://github.com/SymbiFlow" target="_blank" rel="noopener">SymbiFlow</a> is a fully open source toolchain for the development of FPGAs of multiple vendors. Currently, it targets the Xilinx 7-Series, Lattice iCE40, Lattice ECP5 FPGAs, QuickLogic EOS S3 and is gradually being expanded to provide a comprehensive end-to-end FPGA synthesis flow.</li>
</ul>
<h2 id="Xc3sprog"><a href="#Xc3sprog" class="headerlink" title="Xc3sprog"></a>Xc3sprog</h2><ul>
<li><a href="https://github.com/matrix-io/xc3sprog" target="_blank" rel="noopener">xc3sprog</a>是一套实用程序套件,用于使用<code>Xilinx</code>并行电缆和其他<code>JTAG</code>适配器对<code>Xilinx FPGA,CPLD</code>和<code>EEPROM</code>进行编程</li>
</ul>
<h2 id="OpenSBI"><a href="#OpenSBI" class="headerlink" title="OpenSBI"></a>OpenSBI</h2><ul>
<li><a href="https://github.com/riscv-software-src/opensbi" target="_blank" rel="noopener">riscv-software-src/opensbi</a><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/litex-hub/opensbi</span><br><span class="line">~$ <span class="built_in">cd</span> opensbi</span><br><span class="line">~$ make PLATFORM_RISCV_XLEN=32 PLATFORM_RISCV_ABI=ilp32  CROSS_COMPILE=riscv32-unknown-elf- PLATFORM=litex/vexriscv</span><br><span class="line">~$ tree build/platform/litex/vexriscv/</span><br><span class="line">build/platform/litex/vexriscv/</span><br><span class="line">├── firmware</span><br><span class="line">│   ├── fw_dynamic.bin</span><br><span class="line">│   ├── fw_dynamic.dep</span><br><span class="line">│   ├── fw_dynamic.elf</span><br><span class="line">│   ├── fw_dynamic.elf.ld</span><br><span class="line">│   ├── fw_dynamic.o</span><br><span class="line">│   ├── fw_jump.bin</span><br><span class="line">│   ├── fw_jump.dep</span><br><span class="line">│   ├── fw_jump.elf</span><br><span class="line">│   ├── fw_jump.elf.ld</span><br><span class="line">│   ├── fw_jump.o</span><br><span class="line">│   ├── fw_payload.bin</span><br><span class="line">│   ├── fw_payload.dep</span><br><span class="line">│   ├── fw_payload.elf</span><br><span class="line">│   ├── fw_payload.elf.ld</span><br><span class="line">│   ├── fw_payload.o</span><br><span class="line">│   └── payloads</span><br><span class="line">│       ├── test.bin</span><br><span class="line">│       ├── test.dep</span><br><span class="line">│       ├── test.elf</span><br><span class="line">│       ├── test.elf.ld</span><br><span class="line">│       ├── test_head.dep</span><br><span class="line">│       ├── test_head.o</span><br><span class="line">│       ├── test_main.dep</span><br><span class="line">│       ├── test_main.o</span><br><span class="line">│       └── test.o</span><br><span class="line">├── lib</span><br><span class="line">│   └── libplatsbi.a</span><br><span class="line">├── litex.dep</span><br><span class="line">├── litex.o</span><br><span class="line">├── platform.dep</span><br><span class="line">└── platform.o</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="LibreSOC"><a href="#LibreSOC" class="headerlink" title="LibreSOC"></a>LibreSOC</h2><ul>
<li><a href="https://libre-soc.org/" target="_blank" rel="noopener">https://libre-soc.org/</a></li>
</ul>
<h3 id="自编译工具链-riscv64-unknown-elf-gcc"><a href="#自编译工具链-riscv64-unknown-elf-gcc" class="headerlink" title="自编译工具链(riscv64-unknown-elf-gcc)"></a>自编译工具链(riscv64-unknown-elf-gcc)</h3><ul>
<li><a href="https://github.com/riscv/riscv-gnu-toolchain" target="_blank" rel="noopener">riscv-gnu-toolchain</a></li>
<li><a href="https://github.com/cliffordwolf/picorv32#building-a-pure-rv32i-toolchain" target="_blank" rel="noopener">building-a-pure-rv32i-toolchain</a></li>
<li><a href="https://www.sifive.com/software" target="_blank" rel="noopener">SiFive</a>提供二进制的工具链,但是需要注册帐号才能下载,而且注册帐号和邮箱,还必须是公司或者是大学的.或者就下载使用开源的版本<a href="https://github.com/sifive/freedom-tools/releases" target="_blank" rel="noopener">sifive/freedom-tools/releases</a>.还有可以从<a href="https://hex-five.com/wp-content/uploads/riscv-openocd-20210618.tar.xz" target="_blank" rel="noopener">Hex Five</a>下载.这里还是自已去下载源码编译出来.这里<code>GCC</code>编译环境就算是配置好,下面提据源码文档指导,完成工具链的编译.编译过程中它会去网上下载组件,第一次编译时间会比较长.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/riscv/riscv-gnu-toolchain</span><br></pre></td></tr></table></figure>
<ul>
<li><p>支持32位<code>newlib</code>,<code>--host=riscv32-unknown-elf-</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ ./configure --prefix=/home/michael/riscv-toolchain  --with-multilib-generator=<span class="string">"rv32imac-ilp32--f*c"</span> \</span><br><span class="line">   --with-abi=ilp32  --with-arch=rv32imc</span><br><span class="line">~$ make</span><br></pre></td></tr></table></figure>
</li>
<li><p>支持64位<code>newlib</code>,<code>--host=riscv64-unknown-elf-</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~$ ./configure --prefix=/home/michael/riscv64-toolchain  --with-multilib-generator=<span class="string">"rv32imac-ilp32--f*c"</span> \</span><br><span class="line">    --<span class="built_in">enable</span>-multilib --target=riscv64-multilib-elf</span><br><span class="line">~$ make</span><br><span class="line"></span><br><span class="line">~$ ~/riscv64-toolchain/bin/riscv64-unknown-elf-gcc -v</span><br><span class="line">Using built-in specs.</span><br><span class="line">COLLECT_GCC=/home/michael/riscv64-toolchain/bin/riscv64-unknown-elf-gcc</span><br><span class="line">COLLECT_LTO_WRAPPER=/home/michael/riscv64-toolchain/libexec/gcc/riscv64-unknown-elf/11.1.0/lto-wrapper</span><br><span class="line">Target: riscv64-unknown-elf</span><br><span class="line">Configured with: /home/michael/3TB-DISK/github/risc-v/riscv-gnu-toolchain/riscv-gcc/configure --target=riscv64-unknown-elf --prefix=/home/michael/riscv64-toolchain --<span class="built_in">disable</span>-shared --<span class="built_in">disable</span>-threads --<span class="built_in">enable</span>-languages=c,c++ --with-system-zlib --<span class="built_in">enable</span>-tls --with-newlib --with-sysroot=/home/michael/riscv64-toolchain/riscv64-unknown-elf --with-native-system-header-dir=/include --<span class="built_in">disable</span>-libmudflap --<span class="built_in">disable</span>-libssp --<span class="built_in">disable</span>-libquadmath --<span class="built_in">disable</span>-libgomp --<span class="built_in">disable</span>-nls --<span class="built_in">disable</span>-tm-clone-registry --src=.././riscv-gcc --<span class="built_in">enable</span>-multilib --with-multilib-generator=<span class="string">'rv32imac-ilp32--f*c'</span> --with-abi=lp64d --with-arch=rv64imafdc --with-tune=rocket <span class="string">'CFLAGS_FOR_TARGET=-Os   -mcmodel=medlow'</span> <span class="string">'CXXFLAGS_FOR_TARGET=-Os   -mcmodel=medlow'</span></span><br><span class="line">Thread model: single</span><br><span class="line">Supported LTO compression algorithms: zlib zstd</span><br><span class="line">gcc version 11.1.0 (GCC)</span><br></pre></td></tr></table></figure>
</li>
<li><p>支持64位<code>linux</code>,<code>--host=riscv64-unknown-linux-gnu-</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~$ ./configure --prefix=/home/michael/riscv64-toolchain  --with-multilib-generator=<span class="string">"rv32imac-ilp32--f*c"</span>   -<span class="built_in">enable</span>-multilib --target=riscv64-linux-multilib</span><br><span class="line"></span><br><span class="line">~$ make linux</span><br><span class="line"></span><br><span class="line">~$ ~/riscv64-toolchain/bin/riscv64-unknown-linux-gnu-gcc -v</span><br><span class="line">Using built-in specs.</span><br><span class="line">COLLECT_GCC=/home/michael/riscv64-toolchain/bin/riscv64-unknown-linux-gnu-gcc</span><br><span class="line">COLLECT_LTO_WRAPPER=/home/michael/riscv64-toolchain/libexec/gcc/riscv64-unknown-linux-gnu/11.1.0/lto-wrapper</span><br><span class="line">Target: riscv64-unknown-linux-gnu</span><br><span class="line">Configured with: /home/michael/3TB-DISK/github/risc-v/riscv-gnu-toolchain/riscv-gcc/configure --target=riscv64-unknown-linux-gnu --prefix=/home/michael/riscv64-toolchain --with-sysroot=/home/michael/riscv64-toolchain/sysroot --with-system-zlib --<span class="built_in">enable</span>-shared --<span class="built_in">enable</span>-tls --<span class="built_in">enable</span>-languages=c,c++,fortran --<span class="built_in">disable</span>-libmudflap --<span class="built_in">disable</span>-libssp --<span class="built_in">disable</span>-libquadmath --<span class="built_in">disable</span>-libsanitizer --<span class="built_in">disable</span>-nls --<span class="built_in">disable</span>-bootstrap --src=.././riscv-gcc --<span class="built_in">enable</span>-multilib --with-abi=lp64d --with-arch=rv64imafdc --with-tune=rocket <span class="string">'CFLAGS_FOR_TARGET=-O2   -mcmodel=medlow'</span> <span class="string">'CXXFLAGS_FOR_TARGET=-O2   -mcmodel=medlow'</span></span><br><span class="line">Thread model: posix</span><br><span class="line">Supported LTO compression algorithms: zlib zstd</span><br><span class="line">gcc version 11.1.0 (GCC)</span><br></pre></td></tr></table></figure>
</li>
<li><p>上面命令编译完成后,它会自动安装到<code>prefix</code>目录下.因为这边的PC系统就是<code>x86_64</code>的,所以就选择<code>--enable-multilib --target=riscv64-multilib-elf</code>,启用<code>multilib</code>就可通过传送<code>-march=rv32</code>来支持生成32位版的程序.</p>
</li>
<li><p>查看它支持的目标架构信息</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">~$ riscv64-unknown-elf-gcc -Q --<span class="built_in">help</span>=target</span><br><span class="line">The following options are target specific:</span><br><span class="line">  -mabi=                      		lp64d</span><br><span class="line">  -malign-data=               		xlen</span><br><span class="line">  -march=                     		rv64imafdc</span><br><span class="line">  -mbig-endian                		[disabled]</span><br><span class="line">  -mbranch-cost=N             		3</span><br><span class="line">  -mcmodel=                   		medlow</span><br><span class="line">  -mcpu=PROCESSOR</span><br><span class="line">  -mdiv                       		[enabled]</span><br><span class="line">  -mexplicit-relocs           		[enabled]</span><br><span class="line">  -mfdiv                      		[enabled]</span><br><span class="line">  -misa-spec=                 		2.2</span><br><span class="line">  -mlittle-endian             		[enabled]</span><br><span class="line">  -mplt                       		[enabled]</span><br><span class="line">  -mpreferred-stack-boundary= 		0</span><br><span class="line">  -mrelax                     		[enabled]</span><br><span class="line">  -mriscv-attribute           		[enabled]</span><br><span class="line">  -msave-restore              		[disabled]</span><br><span class="line">  -mshorten-memrefs           		[enabled]</span><br><span class="line">  -msmall-data-limit=N        		8</span><br><span class="line">  -mstack-protector-guard-offset=</span><br><span class="line">  -mstack-protector-guard-reg=</span><br><span class="line">  -mstack-protector-guard=    		global</span><br><span class="line">  -mstrict-align              		[enabled]</span><br><span class="line">  -mtune=PROCESSOR            		rocket</span><br><span class="line"></span><br><span class="line">  Supported ABIs (<span class="keyword">for</span> use with the -mabi= option):</span><br><span class="line">    ilp32 ilp32d ilp32e ilp32f lp64 lp64d lp64f</span><br><span class="line"></span><br><span class="line">  Known code models (<span class="keyword">for</span> use with the -mcmodel= option):</span><br><span class="line">    medany medlow</span><br><span class="line"></span><br><span class="line">  Supported ISA specs (<span class="keyword">for</span> use with the -misa-spec= option):</span><br><span class="line">    2.2 20190608 20191213</span><br><span class="line"></span><br><span class="line">  Known data alignment choices (<span class="keyword">for</span> use with the -malign-data= option):</span><br><span class="line">    natural xlen</span><br><span class="line"></span><br><span class="line">  Valid arguments to -mstack-protector-guard=:</span><br><span class="line">    global tls</span><br></pre></td></tr></table></figure>
<h1 id="SiFive-Freedom"><a href="#SiFive-Freedom" class="headerlink" title="SiFive Freedom"></a><code>SiFive Freedom</code></h1><ul>
<li>参考链接:<ul>
<li><a href="https://digilent.com/reference/programmable-logic/arty-a7/arty_a7_100_risc_v" target="_blank" rel="noopener">Running a RISC-V Processor on the Arty A7</a></li>
<li><a href="https://www.xpmcu.com/article/10202" target="_blank" rel="noopener">构建开源 MCU 并使用 Arduino 进行编程</a></li>
<li><a href="https://github.com/sifive/freedom-tools" target="_blank" rel="noopener">sifive/freedom-tools</a></li>
</ul>
</li>
</ul>
<h2 id="下载开源工具链"><a href="#下载开源工具链" class="headerlink" title="下载开源工具链"></a>下载开源工具链</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ wget -c https://static.dev.sifive.com/dev-tools/freedom-tools/v2020.12/riscv64-unknown-elf-toolchain-10.2.0-2020.12.8-x86_64-linux-ubuntu14.tar.gz</span><br><span class="line">~$ wget -c https://static.dev.sifive.com/dev-tools/freedom-tools/v2020.12/riscv-openocd-0.10.0-2020.12.1-x86_64-linux-ubuntu14.tar.gz</span><br></pre></td></tr></table></figure>
<h2 id="编译Freedom"><a href="#编译Freedom" class="headerlink" title="编译Freedom"></a>编译<code>Freedom</code></h2><ul>
<li><code>freedom</code>这个项目已经进入归档状态,没有更新与维护了,按它的说明文档还是可以编译的.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> --recursive https://github.com/sifive/freedom</span><br><span class="line">~$ <span class="built_in">cd</span> freedom</span><br><span class="line">~$ git submodule sync</span><br><span class="line">~$ git submodule update --recursive --init</span><br></pre></td></tr></table></figure>
<ul>
<li><p>指定工具链的位置变量(RISCV)并编译<code>verilog</code>与<code>mcs</code>.这里如果是使用<code>Arty-A7-100T</code>的板子,要设定成<code>BOARD=arty_a7_100</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">export</span> RISCV=/fullpath/riscv64-unknown-elf-toolchain-10.2.0-2020.12.8-x86_64-linux-ubuntu14</span><br><span class="line">~$ <span class="built_in">export</span> PATH=/fullpath/Xilinx/Vivado/2021.1/bin:<span class="variable">$PATH</span></span><br><span class="line">~$ make BOARD=arty -f Makefile.e300artydevkit clean</span><br><span class="line">~$ make BOARD=arty -f Makefile.e300artydevkit verilog</span><br><span class="line">~$ make BOARD=arty -f Makefile.e300artydevkit mcs</span><br><span class="line">[...]</span><br><span class="line">Writing file /home/michael/workspace-xilinx/RISC-V/freedom/builds/e300artydevkit/obj/E300ArtyDevKitFPGAChip.mcs</span><br><span class="line">Writing <span class="built_in">log</span> file /home/michael/workspace-xilinx/RISC-V/freedom/builds/e300artydevkit/obj/E300ArtyDevKitFPGAChip.prm</span><br><span class="line">===================================</span><br><span class="line">Configuration Memory information</span><br><span class="line">===================================</span><br><span class="line">File Format        MCS</span><br><span class="line">Interface          SPIX4</span><br><span class="line">Size               16M</span><br><span class="line">Start Address      0x00000000</span><br><span class="line">End Address        0x00FFFFFF</span><br><span class="line"></span><br><span class="line">Addr1         Addr2         Date                    File(s)</span><br><span class="line">0x00000000    0x0021728B    Oct 31 16:43:46 2021    /home/michael/workspace-xilinx/RISC-V/freedom/builds/e300artydevkit/obj/E300ArtyDevKitFPGAChip.bit</span><br><span class="line">0 Infos, 0 Warnings, 0 Critical Warnings and 0 Errors encountered.</span><br><span class="line">write_cfgmem completed successfully</span><br><span class="line">INFO: [Common 17-206] Exiting Vivado at Sun Oct 31 16:44:16 2021...</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载开发板配置文件(board_files)到<code>Vivado</code>目录下,如下面所示,因为我这里的板子是<code>REV E</code>版本,也就是最新版,所以选择<code>new</code>目录下的配置.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/Digilent/vivado-boards.git</span><br><span class="line">~$ cp -r vivado-boards/new/board_files  ~/Xilinx/Vivado/2021.1/data/boards</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="烧写FPGA的mcs镜像"><a href="#烧写FPGA的mcs镜像" class="headerlink" title="烧写FPGA的mcs镜像"></a>烧写<code>FPGA</code>的<code>mcs</code>镜像</h2><ul>
<li>连接板子的<code>J10 USB</code>接口:<ul>
<li>打开<code>Vivado 2021 -&gt; Tasks -&gt; Open Hardware Manager</code>,点击<code>Hardware</code>下面的<code>Auto Connect</code>图标,连接设备.</li>
<li>显示:<code>localhost(1) -&gt; xilinx_tcf/Digilent/21031xxxxxxx(1) -&gt; xc7a35t_0(1)</code>.</li>
<li>在<code>xc7a35t_0(1)</code>点击右键,选择<code>Add Configuration Memory Device ...</code>.</li>
<li>这里会一个选择内存的窗口例表,对应自已的板上型号去选择,因为这里是<code>REV E</code>的版本,所以实际用的是<code>s25fl128sxxxxxx0-spi-x1_x2_x4</code>,厂商是<code>Spansion</code>的.</li>
</ul>
</li>
<li>添加完成内存,就会弹出一个<code>Program Configuration Memorg Device</code>的窗口,在<code>Configuration File</code>里选择编译出来的<code>mcs</code>文件,位置在<code>freedom/builds/e300artydevkit/obj/E300ArtyDevKitFPGAChip.mcs</code>下,按完成进行烧写.成功后,按板上的<code>PROG</code>加载到<code>FPGA</code>运行.</li>
</ul>
<h2 id="Freedom-E-SDK（应用软件）示例"><a href="#Freedom-E-SDK（应用软件）示例" class="headerlink" title="Freedom-E-SDK（应用软件）示例"></a><code>Freedom-E-SDK</code>（应用软件）示例</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/sifive/freedom<span class="_">-e</span>-sdk.git</span><br><span class="line">~$ git submodule sync</span><br><span class="line">~$ git submodule update --recursive --init</span><br></pre></td></tr></table></figure>
<ul>
<li><p>这里需要设置两个环境变量:<code>RISCV_PATH,RISCV_OPENOCD_PATH</code>,脚本里写的与<code>sifive/freedom</code>不一样.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">export</span> RISCV_PATH=/fullpath/riscv64-unknown-elf-toolchain-10.2.0-2020.12.8-x86_64-linux-ubuntu14</span><br><span class="line">~$ <span class="built_in">export</span> RISCV_OPENOCD_PATH=/fullpath/riscv-openocd-0.10.0-2020.12.1-x86_64-linux-ubuntu14</span><br><span class="line"></span><br><span class="line">~$ make BSP=metal PROGRAM=hello TARGET=freedom-e310-arty clean</span><br><span class="line">~$ make BSP=metal PROGRAM=hello TARGET=freedom-e310-arty software</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意,工程默认设置<code>OpenOCD</code>配置文件支持<code>Olimex OpenOCD JTAG ARM-USB-TINY-H</code>调试器的,而我这边手上只有一个<code>FTDI 232H</code>的设备,所以要做一些配置的修改,这里是使用<code>interface/ftdi/um232h.cfg</code>的配置.对照<a href="https://www.sifive.com/documentation/freedom-soc/freedom-e300-arty-fpga-dev-kit-getting-started-guide/" target="_blank" rel="noopener">Freedom E310 Arty FPGA Dev Kit Getting Started Guide</a>与<a href="https://ftdichip.com/wp-content/uploads/2020/07/DS_FT232H.pdf" target="_blank" rel="noopener">DS_FT232H.pdf</a>两边的接口文档,以及<code>interface/ftdi/um232h.cfg</code>里的描述,连接如下:</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Arty-A7-35T JD Header                   FT232H</span><br><span class="line"></span><br><span class="line">  TDO   (Pin 1)      &lt;------------&gt;   TDO   AD2</span><br><span class="line">  nTRST (Pin 2)      &lt;------------&gt;   TRST  AC0</span><br><span class="line">  TCK   (Pin 3)      &lt;------------&gt;   TCK   AD0</span><br><span class="line">  GND   (Pin 5)      &lt;------------&gt;   GND   GND</span><br><span class="line">  VREF  (Pin 6)      &lt;------------&gt;   3.3V  3.3V</span><br><span class="line">  TDI   (Pin 7)      &lt;------------&gt;   TDI   AD1</span><br><span class="line">  TMS   (Pin 8)      &lt;------------&gt;   TMS   AD3</span><br><span class="line">  nRST  (Pin 9)      &lt;------------&gt;   TMS   AC1</span><br><span class="line">  GND   (Pin 11)     &lt;------------&gt;   GND   GND</span><br><span class="line">  VREF  (Pin 12)     &lt;------------&gt;   3.3V  3.3V</span><br></pre></td></tr></table></figure>
<ul>
<li>再修改<code>freedom-e-sdk/bsp/freedom-e310-arty/openocd.cfg</code>文件,把<code>olimex-arm-usb-tiny-h.cfg</code>换成<code>um232h.cfg</code>,也可以应用下面的补丁.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">diff --git a/bsp/freedom-e310-arty/openocd.cfg b/bsp/freedom-e310-arty/openocd.cfg</span><br><span class="line">index 8ab6ff6..3529100 100644</span><br><span class="line">--- a/bsp/freedom-e310-arty/openocd.cfg</span><br><span class="line">+++ b/bsp/freedom-e310-arty/openocd.cfg</span><br><span class="line">@@ -19,7 +19,8 @@ <span class="built_in">set</span> debug_config <span class="string">"<span class="variable">$&#123;protocol&#125;</span>_<span class="variable">$&#123;connection&#125;</span>"</span></span><br><span class="line"> switch <span class="variable">$&#123;debug_config&#125;</span> &#123;</span><br><span class="line">   jtag_probe &#123;</span><br><span class="line">     <span class="built_in">echo</span> <span class="string">"Using JTAG"</span></span><br><span class="line">-    <span class="built_in">source</span> [find interface/ftdi/olimex-arm-usb-tiny-h.cfg]</span><br><span class="line">+    <span class="comment">#source [find interface/ftdi/olimex-arm-usb-tiny-h.cfg]</span></span><br><span class="line">+    <span class="built_in">source</span> [find interface/ftdi/um232h.cfg]</span><br><span class="line">     <span class="built_in">set</span> chain_length 5</span><br><span class="line">   &#125;</span><br><span class="line">   cjtag_probe &#123;</span><br><span class="line">@@ -69,4 +70,4 @@ halt</span><br><span class="line"></span><br><span class="line"> flash protect 0 64 last off</span><br><span class="line"></span><br><span class="line">-<span class="built_in">echo</span> <span class="string">"Ready for Remote Connections"</span></span><br><span class="line">\ No newline at end of file</span><br><span class="line">+<span class="built_in">echo</span> <span class="string">"Ready for Remote Connections"</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>烧写测试应用程序,先按板子上的<code>PROG</code>键,确保<code>FPGA</code>跑起来,再<code>upload</code>,如果,无法通过<code>JTAG</code>烧入应用,该板子无任何输出的.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">~$ make BSP=metal PROGRAM=hello TARGET=freedom-e310-arty upload</span><br><span class="line">[....]</span><br><span class="line">For bug reports:</span><br><span class="line">	https://github.com/sifive/freedom-tools/issues</span><br><span class="line">DEPRECATED! use <span class="string">'adapter speed'</span> not <span class="string">'adapter_khz'</span></span><br><span class="line">Using JTAG</span><br><span class="line">Info : auto-selecting first available session transport <span class="string">"jtag"</span>. To override use <span class="string">'transport select &lt;transport&gt;'</span>.</span><br><span class="line">Info : ftdi: <span class="keyword">if</span> you experience problems at higher adapter clocks, try the <span class="built_in">command</span> <span class="string">"ftdi_tdo_sample_edge falling"</span></span><br><span class="line">Info : clock speed 10000 kHz</span><br><span class="line">Info : JTAG tap: riscv.cpu tap/device found: 0x20000913 (mfg: 0x489 (SiFive Inc), part: 0x0000, ver: 0x2)</span><br><span class="line">Info : datacount=1 progbufsize=16</span><br><span class="line">Info : Disabling abstract <span class="built_in">command</span> reads from CSRs.</span><br><span class="line">Info : Examined RISC-V core; found 1 harts</span><br><span class="line">Info :  hart 0: XLEN=32, misa=0x40001105</span><br><span class="line">Info : starting gdb server <span class="keyword">for</span> riscv.cpu on 3333</span><br><span class="line">Info : Listening on port 3333 <span class="keyword">for</span> gdb connections</span><br><span class="line">Info : Found flash device <span class="string">'sp s25fl128s'</span> (ID 0x00182001)</span><br><span class="line">Ready <span class="keyword">for</span> Remote Connections</span><br><span class="line">Info : Listening on port 6666 <span class="keyword">for</span> tcl connections</span><br><span class="line">Info : Listening on port 4444 <span class="keyword">for</span> telnet connections</span><br><span class="line">Info : accepting <span class="string">'gdb'</span> connection on tcp/3333</span><br><span class="line">metal_shutdown (code=0) at /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/freedom-metal/src/shutdown.c:19</span><br><span class="line">19	        __asm__ volatile(<span class="string">"nop"</span>);</span><br><span class="line">Info : JTAG tap: riscv.cpu tap/device found: 0x20000913 (mfg: 0x489 (SiFive Inc), part: 0x0000, ver: 0x2)</span><br><span class="line">JTAG tap: riscv.cpu tap/device found: 0x20000913 (mfg: 0x489 (SiFive Inc), part: 0x0000, ver: 0x2)</span><br><span class="line">cleared protection <span class="keyword">for</span> sectors 64 through 255 on flash bank 0</span><br><span class="line"></span><br><span class="line">cleared protection <span class="keyword">for</span> sectors 64 through 255 on flash bank 0</span><br><span class="line"></span><br><span class="line">Info : Disabling abstract <span class="built_in">command</span> writes to CSRs.</span><br><span class="line"></span><br><span class="line">Thread 1 (Remote target):</span><br><span class="line">Info : JTAG tap: riscv.cpu tap/device found: 0x20000913 (mfg: 0x489 (SiFive Inc), part: 0x0000, ver: 0x2)</span><br><span class="line">Loading section .init, size 0x2c2 lma 0x20400000</span><br><span class="line">Loading section .init_array, size 0x4 lma 0x204002c8</span><br><span class="line">Loading section .ctors, size 0x24 lma 0x204002cc</span><br><span class="line">Loading section .rodata, size 0x33c lma 0x204002f0</span><br><span class="line">Loading section .text, size 0x4c80 lma 0x20400680</span><br><span class="line">Loading section .data, size 0x780 lma 0x20405300</span><br><span class="line">Info : Padding image section 0 at 0x204002c2 with 6 bytes</span><br><span class="line">Info : Padding image section 1 at 0x2040062c with 84 bytes</span><br><span class="line">Info : JTAG tap: riscv.cpu tap/device found: 0x20000913 (mfg: 0x489 (SiFive Inc), part: 0x0000, ver: 0x2)</span><br><span class="line">Start address 0x20400000, load size 23078</span><br><span class="line">Transfer rate: 43 KB/sec, 3296 bytes/write.</span><br><span class="line">shutdown <span class="built_in">command</span> invoked</span><br><span class="line">shutdown <span class="built_in">command</span> invoked</span><br><span class="line">A debugging session is active.</span><br><span class="line"></span><br><span class="line">	Inferior 1 [Remote target] will be detached.</span><br><span class="line"></span><br><span class="line">Quit anyway? (y or n) [answered Y; input not from terminal]</span><br><span class="line">Remote connection closed</span><br></pre></td></tr></table></figure>
</li>
<li><p>如上面所示,烧写应用成功,电脑上会有一个<code>/dev/ttyUSB2</code>的串口,连接后,每按一次<code>PROG</code>或者<code>RESET</code>键,会打印一次<code>Hello, World!</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo minicom -o -b 57600 -D /dev/ttyUSB2</span><br><span class="line">OPTIONS: I18n</span><br><span class="line">Port /dev/ttyUSB2, 21:07:42</span><br><span class="line"></span><br><span class="line">Press CTRL-A Z for help on special keys</span><br><span class="line"></span><br><span class="line">Hello, World!</span><br><span class="line">             Hello, World!</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="使用QEMU模拟运行"><a href="#使用QEMU模拟运行" class="headerlink" title="使用QEMU模拟运行"></a>使用<code>QEMU</code>模拟运行</h2><ul>
<li><p>我这边系统里已经编译好了<a href="https://www.qemu.org/" target="_blank" rel="noopener">qemu</a>最新版,并且支持了<code>riscv32-softmmu,riscv64-softmmu</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$ qemu-system-riscv32 -cpu <span class="built_in">help</span></span><br><span class="line">any</span><br><span class="line">lowrisc-ibex</span><br><span class="line">rv32</span><br><span class="line">sifive-e31</span><br><span class="line">sifive-e34</span><br><span class="line">sifive-u34</span><br><span class="line"></span><br><span class="line">~$ qemu-system-riscv32 -machine <span class="built_in">help</span></span><br><span class="line">Supported machines are:</span><br><span class="line">none                 empty machine</span><br><span class="line">opentitan            RISC-V Board compatible with OpenTitan</span><br><span class="line">sifive_e             RISC-V Board compatible with SiFive E SDK</span><br><span class="line">sifive_u             RISC-V Board compatible with SiFive U SDK</span><br><span class="line">spike                RISC-V Spike board (default)</span><br><span class="line">virt                 RISC-V VirtIO board</span><br></pre></td></tr></table></figure>
</li>
<li><p>编译软件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">~$ make PROGRAM=hello TARGET=qemu-sifive-e31 CONFIGURATION=debug software</span><br><span class="line">[...........]</span><br><span class="line">. /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/venv/bin/activate &amp;&amp; scripts/ldscript-generator/generate_ldscript.py -d /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/bsp/qemu-sifive-e31/design.dts -o /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/bsp/qemu-sifive-e31/metal.default.lds</span><br><span class="line">Generating linker script with default layout</span><br><span class="line">Using layout:</span><br><span class="line">	 rom: 0x20400000-0x3fffffff (/soc/spi@10014000)</span><br><span class="line">	 ram: 0x80000000-0x803fffff (/soc/dtim@80000000)</span><br><span class="line">RAM memories:</span><br><span class="line">	dtim_0: 0x80000000-0x00400000</span><br><span class="line">Consolidated RAM memories:</span><br><span class="line">	dtim_0: 0x80000000-0x00010000</span><br><span class="line">mkdir -p /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/software/hello/debug/</span><br><span class="line">make -C /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/software/hello hello \</span><br><span class="line">	PORT_DIR= \</span><br><span class="line">	PROGRAM=hello \</span><br><span class="line">	AR=/home/michael/riscv64-toolchain/bin/riscv64-unknown-elf-ar \</span><br><span class="line">	CC=/home/michael/riscv64-toolchain/bin/riscv64-unknown-elf-gcc \</span><br><span class="line">	CXX=/home/michael/riscv64-toolchain/bin/riscv64-unknown-elf-g++ \</span><br><span class="line">	ASFLAGS=<span class="string">"-march=rv32imac -mabi=ilp32 -mcmodel=medlow --specs=nano.specs -O0 -g"</span> \</span><br><span class="line">	CCASFLAGS=<span class="string">"-march=rv32imac -mabi=ilp32 -mcmodel=medlow -I/home/michael/workspace-xilinx/RISC-V/freedom-e-sdk/bsp/qemu-sifive-e31/install/include --specs=nano.specs"</span> \</span><br><span class="line">	CFLAGS=<span class="string">"-march=rv32imac -mabi=ilp32 -mcmodel=medlow -ffunction-sections -fdata-sections -I/home/michael/workspace-xilinx/RISC-V/freedom-e-sdk/bsp/qemu-sifive-e31/install/include --specs=nano.specs -DMTIME_RATE_HZ_DEF=10000000 -O0 -g"</span> \</span><br><span class="line">	CXXFLAGS=<span class="string">"-march=rv32imac -mabi=ilp32 -mcmodel=medlow -ffunction-sections -fdata-sections -I/home/michael/workspace-xilinx/RISC-V/freedom-e-sdk/bsp/qemu-sifive-e31/install/include --specs=nano.specs -DMTIME_RATE_HZ_DEF=10000000 -O0 -g"</span> \</span><br><span class="line">	XCFLAGS=<span class="string">"-DMETAL_WAIT_CYCLE=0"</span> \</span><br><span class="line">	LDFLAGS=<span class="string">"-Wl,--gc-sections -Wl,-Map,hello.map -nostartfiles -nostdlib -L/home/michael/workspace-xilinx/RISC-V/freedom-e-sdk/bsp/qemu-sifive-e31/install/lib/debug/ -T/home/michael/workspace-xilinx/RISC-V/freedom-e-sdk/bsp/qemu-sifive-e31/metal.default.lds"</span> \</span><br><span class="line">	LDLIBS=<span class="string">"-Wl,--start-group -lc -lgcc -lm -lmetal -lmetal-gloss -Wl,--end-group"</span> \</span><br><span class="line">	FREERTOS_METAL_VENV_PATH=<span class="string">"/home/michael/workspace-xilinx/RISC-V/freedom-e-sdk/venv"</span></span><br><span class="line">make[1]: Entering directory <span class="string">'/home/michael/workspace-xilinx/RISC-V/freedom-e-sdk/software/hello'</span></span><br><span class="line">/home/michael/riscv64-toolchain/bin/riscv64-unknown-elf-gcc -march=rv32imac -mabi=ilp32 -mcmodel=medlow -ffunction-sections -fdata-sections -I/home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/bsp/qemu-sifive-e31/install/include --specs=nano.specs -DMTIME_RATE_HZ_DEF=10000000 -O0 -g  -Wl,--gc-sections -Wl,-Map,hello.map -nostartfiles -nostdlib -L/home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/bsp/qemu-sifive-e31/install/lib/debug/ -T/home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/bsp/qemu-sifive-e31/metal.default.lds  hello.c  -Wl,--start-group -lc -lgcc -lm -lmetal -lmetal-gloss -Wl,--end-group -o hello</span><br><span class="line">make[1]: Leaving directory <span class="string">'/home/michael/workspace-xilinx/RISC-V/freedom-e-sdk/software/hello'</span></span><br><span class="line">mv /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/software/hello/hello /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/software/hello/debug/hello.elf</span><br><span class="line">mv /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/software/hello/hello.map /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/software/hello/debug/</span><br><span class="line">touch -c /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/software/hello/debug/hello.elf</span><br><span class="line">/home/michael/riscv64-toolchain/bin/riscv64-unknown-elf-objdump --<span class="built_in">source</span> --all-headers --demangle --line-numbers --wide /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/software/hello/debug/hello.elf &gt; /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/software/hello/debug/hello.lst</span><br><span class="line">/home/michael/riscv64-toolchain/bin/riscv64-unknown-elf-size /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/software/hello/debug/hello.elf</span><br><span class="line">   text	   data	    bss	    dec	    hex	filename</span><br><span class="line">  26204	   2004	   3236	  31444	   7ad4	/home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/software/hello/debug/hello.elf</span><br><span class="line">/home/michael/riscv64-toolchain/bin/riscv64-unknown-elf-objcopy -O ihex /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/software/hello/debug/hello.elf /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/software/hello/debug/hello.hex</span><br></pre></td></tr></table></figure>
</li>
<li><p>模拟运行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ make PROGRAM=hello TARGET=qemu-sifive-e31 CONFIGURATION=debug simulate</span><br><span class="line">scripts/simulate --elf /home/michael/workspace-xilinx/RISC-V/freedom<span class="_">-e</span>-sdk/software/hello/debug/hello.elf --qemu qemu-system-riscv32 --qemu-config bsp/qemu-sifive-e31/qemu.cfg</span><br><span class="line">Launching QEMU! Press Ctrl-A, X to <span class="built_in">exit</span></span><br><span class="line">Hello, World!</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Arduino环境测试开发"><a href="#Arduino环境测试开发" class="headerlink" title="Arduino环境测试开发"></a><code>Arduino</code>环境测试开发</h2><ul>
<li><a href="https://github.com/sifive/cinco" target="_blank" rel="noopener">sifive/cinco</a></li>
<li><code>Arty-A7-35T</code>板子上原本就带有兼容<code>Arduino</code>的接口,这里根据<a href="https://github.com/sifive/cinco" target="_blank" rel="noopener">sifive/cinco</a>指导,配置<code>Arduino IDE</code>支持一个名为<code>SiFive Freedom Boards</code>的板子,有两种方式:<ul>
<li>打开<code>Arduino IDE -&gt; File -&gt; Perferences -&gt; Additional Boards Manaer URLs:</code>,配置添加一行:<a href="http://static.dev.sifive.com/bsp/arduino/package_sifive_index.json" target="_blank" rel="noopener">http://static.dev.sifive.com/bsp/arduino/package_sifive_index.json </a>,完成.</li>
<li>第二种手动克隆<a href="https://github.com/sifive/cinco" target="_blank" rel="noopener">sifive/cinco</a>到<code>Arduino IDE</code>的<code>hardware</code>目录.<code>Arduino IDE</code>有两个位置<code>hardware</code>:<ul>
<li>一个是<code>Arduino IDE</code>安装自带的<code>avr</code>,位于<code>arduin-1.x.xx/hardware</code>,我一般不会把新增的硬件放入到这里.</li>
<li>另一个就是用户目录下的:<code>~/.arduino15/packages/*/hardware</code>,如:</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ls ~/.arduino15/packages/*/hardware</span><br><span class="line">/home/michael/.arduino15/packages/arduino/hardware:</span><br><span class="line">avr  megaavr  sam  samd  samd_beta  stm32f4</span><br><span class="line"></span><br><span class="line">/home/michael/.arduino15/packages/atmel-avr-xminis/hardware:</span><br><span class="line">avr</span><br><span class="line"></span><br><span class="line">/home/michael/.arduino15/packages/ATTinyCore/hardware:</span><br><span class="line">avr</span><br><span class="line"></span><br><span class="line">/home/michael/.arduino15/packages/esp32/hardware:</span><br><span class="line">esp32</span><br><span class="line"></span><br><span class="line">/home/michael/.arduino15/packages/sifive/hardware:</span><br><span class="line">riscv</span><br><span class="line"></span><br><span class="line">/home/michael/.arduino15/packages/SparkFun/hardware:</span><br><span class="line">avr</span><br><span class="line"></span><br><span class="line">/home/michael/.arduino15/packages/STM32/hardware:</span><br><span class="line">stm32</span><br></pre></td></tr></table></figure>
<ul>
<li>打开<code>Arduino IDE -&gt; Tools -&gt; Board: XXXX -&gt; Boards Manager ...</code>管理界面,它会自动去更新板子数据库,更新完成.在上面输入:<code>sifive</code>,就会过滤<code>SiFive Freedom Boards</code>,现在最新的版本是<code>1.0.2</code>,安装它.</li>
<li>安装完成后,本地用户目录下会有如下文件目录结构,</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">~$ tree -L 4  ~/.arduino15/packages/sifive/</span><br><span class="line">/home/michael/.arduino15/packages/sifive/</span><br><span class="line">├── hardware</span><br><span class="line">│   └── riscv</span><br><span class="line">│       └── 1.0.2</span><br><span class="line">│           ├── boards.txt</span><br><span class="line">│           ├── cores</span><br><span class="line">│           ├── freedom<span class="_">-e</span>-sdk</span><br><span class="line">│           ├── libraries</span><br><span class="line">│           ├── platform.txt</span><br><span class="line">│           ├── programmers.txt</span><br><span class="line">│           ├── system</span><br><span class="line">│           └── variants</span><br><span class="line">└── tools</span><br><span class="line">    ├── openocd</span><br><span class="line">    │   └── 9bab0782d313679bb0bfb634e6e87c757b8d5503</span><br><span class="line">    │       ├── bin</span><br><span class="line">    │       └── share</span><br><span class="line">    └── riscv32-unknown-elf-gcc</span><br><span class="line">        └── 3f7b3696217548bc31aeccf9a0c89bdfa4e16a8f</span><br><span class="line">            ├── bin</span><br><span class="line">            ├── include</span><br><span class="line">            ├── lib</span><br><span class="line">            ├── lib64</span><br><span class="line">            ├── libexec</span><br><span class="line">            ├── riscv32-unknown-elf</span><br><span class="line">            └── share</span><br></pre></td></tr></table></figure>
<ul>
<li>它就是从网上下载安装了<code>SiFive Freedom Boards</code>所要用到的<code>riscv32-unknown-elf-gcc</code>的工具链,以及<code>JTAG</code>调试烧写的<code>OpenOCD</code>.同时打开<code>Arduino IDE -&gt; Tools -&gt; Board: XXXX</code>列表,会看到<code>Freedom E300 Boards -&gt; Freedom E300 Arty DevKit</code>.</li>
</ul>
<h3 id="Blink测试"><a href="#Blink测试" class="headerlink" title="Blink测试"></a>Blink测试</h3><ul>
<li>这里打开<code>Arduino IDE -&gt; File -&gt; Examples -&gt; 01.Basics -&gt; Blink</code>工程.并配置<code>Arduino IDE -&gt; Tools</code>下的连接参数如下:<ul>
<li>Board: “Freedom E300 Arty DevKit”</li>
<li>CPU Clock Frequency: “65MHz FPGA Clock”</li>
<li>Tool Install Localtion: “Default”</li>
<li>Port: “/dev/ttyUSB2”</li>
<li>Programmer: “Manual SiFive OpenOCD”</li>
</ul>
</li>
<li>上面配置有两个要注意:<ul>
<li><code>Tool Install Localtion: &quot;Default&quot;</code>就是使用<code>~/.arduino15/packages/sifive/tools/riscv32-unknown-elf-gcc</code>下面的工具链进行编译,否则就是从<code>$PATH</code>变量里去要找<code>riscv32-unknown-elf-gcc</code>运行.</li>
<li><code>Programmer</code>指定也是类似,我这里没有选<code>SiFive OpenOCD</code>,而是选择了<code>Manual SiFive OpenOCD</code>,意思就是从<code>$PATH</code>变量里去要找<code>openocd</code>运行.因为这里的<code>openocd</code>版本比较旧,且默认<code>openocd.cfg</code>是仅支持<code>Olimex OpenOCD JTAG ARM-USB-TINY-H</code>调试,这里需要把上面<code>Freedom-E-SDK</code>修改过的<code>openocd.cfg</code>复制到<code>~/.arduino15/packages/sifive/hardware/riscv/1.0.2/freedom-e-sdk/bsp/env/freedom-e300-arty</code>下.</li>
<li>点击<code>Arduino IDE</code>工具栏的<code>Upload</code>编译并上传到板子上运行,日志如下:</li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">/home/michael/.arduino15/packages/sifive/tools/riscv32-unknown-elf-gcc/3f7b3696217548bc31aeccf9a0c89bdfa4e16a8f/bin/riscv32-unknown-elf-g++ -T /home/michael/.arduino15/packages/sifive/hardware/riscv/1.0.2/freedom<span class="_">-e</span>-sdk/bsp/env/freedom-e300-hifive1/link.lds -nostartfiles -Wl,-N -Wl,--gc-sections -Wl,--wrap=malloc -Wl,--wrap=free -Wl,--wrap=sbrk /tmp/arduino_build_232653/sketch/Blink.ino.cpp.o -nostdlib -Wl,--start-group /tmp/arduino_cache_428477/core/core_6ccdbc8b93e71222b4d531274eba2283.a -lm -lstdc++ -lc -lgloss -Wl,--end-group -lgcc -o /tmp/arduino_build_232653/Blink.ino.elf</span><br><span class="line">/home/michael/.arduino15/packages/sifive/tools/riscv32-unknown-elf-gcc/3f7b3696217548bc31aeccf9a0c89bdfa4e16a8f/bin/riscv32-unknown-elf-objcopy -R .rel.dyn -O binary /tmp/arduino_build_232653/Blink.ino.elf /tmp/arduino_build_232653/Blink.ino.bin</span><br><span class="line">/home/michael/.arduino15/packages/sifive/tools/riscv32-unknown-elf-gcc/3f7b3696217548bc31aeccf9a0c89bdfa4e16a8f/bin/riscv32-unknown-elf-objcopy -R .rel.dyn -O srec /tmp/arduino_build_232653/Blink.ino.elf /tmp/arduino_build_232653/Blink.ino.hex</span><br><span class="line">/home/michael/.arduino15/packages/sifive/tools/riscv32-unknown-elf-gcc/3f7b3696217548bc31aeccf9a0c89bdfa4e16a8f/bin/riscv32-unknown-elf-size -B /tmp/arduino_build_232653/Blink.ino.elf</span><br><span class="line">Sketch uses 6816 bytes (0%) of program storage space. Maximum is 8388608 bytes.</span><br><span class="line">openocd -f /home/michael/.arduino15/packages/sifive/hardware/riscv/1.0.2/freedom<span class="_">-e</span>-sdk/bsp/env/freedom-e300-arty/openocd.cfg -c flash protect 0 64 last off; program /tmp/arduino_build_232653/Blink.ino.elf verify; resume 0x20400000; <span class="built_in">exit</span></span><br><span class="line">Open On-Chip Debugger 0.10.0+dev-01524-g861e75f54-dirty (2020-12-06-19:34)</span><br><span class="line">Licensed under GNU GPL v2</span><br><span class="line">For bug reports, <span class="built_in">read</span></span><br><span class="line">	http://openocd.org/doc/doxygen/bugs.html</span><br><span class="line">DEPRECATED! use <span class="string">'adapter speed'</span> not <span class="string">'adapter_khz'</span></span><br><span class="line">Using JTAG</span><br><span class="line">Info : auto-selecting first available session transport <span class="string">"jtag"</span>. To override use <span class="string">'transport select &lt;transport&gt;'</span>.</span><br><span class="line">Info : ftdi: <span class="keyword">if</span> you experience problems at higher adapter clocks, try the <span class="built_in">command</span> <span class="string">"ftdi_tdo_sample_edge falling"</span></span><br><span class="line">Info : clock speed 10000 kHz</span><br><span class="line">Info : JTAG tap: riscv.cpu tap/device found: 0x20000913 (mfg: 0x489 (SiFive Inc), part: 0x0000, ver: 0x2)</span><br><span class="line">Info : datacount=1 progbufsize=16</span><br><span class="line">Info : Disabling abstract <span class="built_in">command</span> reads from CSRs.</span><br><span class="line">Info : Examined RISC-V core; found 1 harts</span><br><span class="line">Info :  hart 0: XLEN=32, misa=0x40001105</span><br><span class="line">Info : starting gdb server <span class="keyword">for</span> riscv.cpu on 3333</span><br><span class="line">Info : Listening on port 3333 <span class="keyword">for</span> gdb connections</span><br><span class="line">Info : Found flash device <span class="string">'sp s25fl128s'</span> (ID 0x00182001)</span><br><span class="line">Ready <span class="keyword">for</span> Remote Connections</span><br><span class="line">Info : JTAG tap: riscv.cpu tap/device found: 0x20000913 (mfg: 0x489 (SiFive Inc), part: 0x0000, ver: 0x2)</span><br><span class="line">** Programming Started **</span><br><span class="line">Info : Disabling abstract <span class="built_in">command</span> writes to CSRs.</span><br><span class="line">** Programming Finished **</span><br><span class="line">** Verify Started **</span><br><span class="line">** Verified OK **</span><br></pre></td></tr></table></figure>
<ul>
<li>此时,板子上的<code>LD1</code>会出现一秒周期的闪烁,实踐成功.</li>
</ul>
<h1 id="Hex-Five"><a href="#Hex-Five" class="headerlink" title="Hex Five"></a>Hex Five</h1><ul>
<li>参考链接:<ul>
<li><a href="https://github.com/hex-five/multizone-fpga" target="_blank" rel="noopener">hex-five/multizone-fpga</a></li>
<li><a href="https://www.wenyanet.com/opensource/zh/5fbd3bd2ead87360c459cc2f.html" target="_blank" rel="noopener">multizone-secure-iot-stack - 适用于RISC-V的MultiZone®安全物联网堆栈</a></li>
</ul>
</li>
<li><code>Hex Five Security</code>(RISC-V International的长期成员)已开发了<code>MultiZone Security IoT Stack</code>,可免费下载<code>RISC-V IoT</code>安全栈.由<code>Hex Five Security</code>公司开发的<code>MultiZone Security IoT Stack</code>,是第一个<code>RISC-V IoT</code>安全栈.可使用由该公司开发的开源软核<code>X300</code>,编程到<code>Digilent Arty A7-35T FPGA</code>开发板上进行框架评估.</li>
<li><code>Hex Five</code>发布了第一个支持<code>FreeRTOS</code>的<code>RISC-V</code>安全IoT协议栈.<code>MultiZone</code>安全物联网堆栈,第一个用于<code>RISC-V</code>的安全IoT堆栈:<code>FreeRTOS</code>的安全实现,在操作系统,<code>TCP/IP</code>堆栈和<code>TLS 1.3/ECC</code>的信任根之间采用硬件强制软件定义的分隔,以实现安全的物联网应用.</li>
</ul>
<h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><ul>
<li><p>下载源码,这里会耗时比较长,因为会从网上同步非常多的<code>submodule</code>.这里最终找到了<code>hex-five/multizone-fpga</code>来实践,它们的代码结构是一样的.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/hex-five/multizone-fpga</span><br><span class="line">~$ <span class="built_in">cd</span> multizone-fpga</span><br><span class="line">~$ git submodule update --init --recursive --<span class="built_in">jobs</span> 8</span><br></pre></td></tr></table></figure>
</li>
<li><p>编译<code>Verilog</code>,这里第一次运行,会要从网上下载很多<code>Scala</code>的插件.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">source</span> ~/Xilinx/Vivado/2021.1/settings64.sh</span><br><span class="line">~$ <span class="built_in">cd</span> multizone-fpga</span><br><span class="line">~$ make -j 16 -f Makefile.x300arty35devkit verilog</span><br></pre></td></tr></table></figure>
</li>
<li><p>编译<code>mcs</code>,是要用到<code>risc-v toolchain</code>的.因为系统用的是<code>python3.x</code>,所以这里还要打一个<code>patch</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">~$ cat ~/vlsi_rom_gen-fixed.patch</span><br><span class="line">diff --git a/scripts/vlsi_rom_gen b/scripts/vlsi_rom_gen</span><br><span class="line">index 3e97070db..c0185d1d2 100755</span><br><span class="line">--- a/scripts/vlsi_rom_gen</span><br><span class="line">+++ b/scripts/vlsi_rom_gen</span><br><span class="line">@@ -94,7 +94,7 @@ def iterate_by_n(it, n):</span><br><span class="line">                         <span class="string">'Iterable length not evenly divisible by &#123;&#125;'</span>.format(n)</span><br><span class="line">                     )</span><br><span class="line">                 <span class="keyword">else</span>:</span><br><span class="line">-                    raise</span><br><span class="line">+                    <span class="built_in">return</span></span><br><span class="line">         yield batch</span><br><span class="line"></span><br><span class="line">~$ <span class="built_in">cd</span> multizone-fpga/rocket-chip</span><br><span class="line">~$ git apply ~/vlsi_rom_gen-fixed.patch</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置<code>RISCV</code>变量,并编译. 这里会有一些耗时.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">~$ make  -f Makefile.x300arty35devkit mcs</span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line">Creating config memory files...</span><br><span class="line">Creating bitstream load up from address 0x00000000</span><br><span class="line">Loading bitfile /home/michael/workspace-xilinx/RISC-V/multizone-fpga/builds/x300arty35devkit/obj/X300ArtyDevKitFPGAChip.bit</span><br><span class="line">Writing file /home/michael/workspace-xilinx/RISC-V/multizone-fpga/builds/x300arty35devkit/obj/X300ArtyDevKitFPGAChip.mcs</span><br><span class="line">Writing <span class="built_in">log</span> file /home/michael/workspace-xilinx/RISC-V/multizone-fpga/builds/x300arty35devkit/obj/X300ArtyDevKitFPGAChip.prm</span><br><span class="line">===================================</span><br><span class="line">Configuration Memory information</span><br><span class="line">===================================</span><br><span class="line">File Format        MCS</span><br><span class="line">Interface          SPIX4</span><br><span class="line">Size               16M</span><br><span class="line">Start Address      0x00000000</span><br><span class="line">End Address        0x00FFFFFF</span><br><span class="line"></span><br><span class="line">Addr1         Addr2         Date                    File(s)</span><br><span class="line">0x00000000    0x0021728B    Oct 23 23:34:23 2021    /home/michael/workspace-xilinx/RISC-V/multizone-fpga/builds/x300arty35devkit/obj/X300ArtyDevKitFPGAChip.bit</span><br><span class="line">0 Infos, 0 Warnings, 0 Critical Warnings and 0 Errors encountered.</span><br><span class="line">write_cfgmem completed successfully</span><br><span class="line">INFO: [Common 17-206] Exiting Vivado at Sat Oct 23 23:34:54 2021...</span><br></pre></td></tr></table></figure>
<h2 id="烧写到QSPI-Flash"><a href="#烧写到QSPI-Flash" class="headerlink" title="烧写到QSPI Flash"></a>烧写到<code>QSPI Flash</code></h2><ul>
<li>Launch Vivado</li>
<li>Open Hardware Manager, click the auto-connect icon, and open the target board</li>
<li>Right click on the FPGA device and select ”Add Configuration Memory Device”</li>
<li>Select Part “s25fl128sxxxxxx0-spi-x1_x2_x4” (“mt25ql128-spi-x1_x2_x4” if you have an old Arty 35T)<br><img src="/imgs/xilinx/artya735t_add_config_mem_dev.png" alt="artya735t_add_config_mem_dev.png"></li>
<li>Click OK to ”Do you want to program the configuration memory device now?”</li>
<li>Add X300ArtyA7-35T.mcs or X300ArtyA7-100T.mcs depending on your board<br><img src="/imgs/xilinx/artya735t_program_config_mcs.png" alt="artya735t_program_config_mcs.png"></li>
<li>Select OK</li>
<li>Once the programming completes in Vivado, press the “PROG” Button on the Arty board to load the image into the FPGA</li>
</ul>
<h2 id="OpenOCD"><a href="#OpenOCD" class="headerlink" title="OpenOCD"></a>OpenOCD</h2><ul>
<li><a href="https://github.com/riscv/riscv-openocd" target="_blank" rel="noopener">riscv/riscv-openocd</a></li>
</ul>
<h1 id="VexRiscv"><a href="#VexRiscv" class="headerlink" title="VexRiscv"></a>VexRiscv</h1><ul>
<li>Links:<ul>
<li><a href="https://docs.zephyrproject.org/2.6.0/boards/riscv/litex_vexriscv/doc/index.html" target="_blank" rel="noopener">LiteX VexRiscv</a></li>
<li><a href="https://github.com/litex-hub/linux-on-litex-vexriscv" target="_blank" rel="noopener">litex-hub /linux-on-litex-vexriscv</a></li>
<li><a href="https://github.com/enjoy-digital/litex" target="_blank" rel="noopener">enjoy-digital /litex</a></li>
<li><a href="https://antmicro.com/blog/2020/05/multicore-vex-in-litex/" target="_blank" rel="noopener">Running Linux with Quad-core SMP in LiteX/VexRiscv on Arty A7</a></li>
<li><a href="https://digilent.com/reference/programmable-logic/arty-a7/arty_a7_100_risc_v/start" target="_blank" rel="noopener">Running a RISC-V Processor on the Arty A7</a></li>
<li><a href="https://github.com/cliffordwolf/picorv32" target="_blank" rel="noopener">PicoRV32 - A Size-Optimized RISC-V CPU</a> 跟进</li>
<li><a href="https://github.com/litex-hub/litex-boards" target="_blank" rel="noopener">litex-hub/litex-boards</a> 后续跟进</li>
</ul>
</li>
</ul>
<h2 id="linux-on-litex-vexriscv"><a href="#linux-on-litex-vexriscv" class="headerlink" title="linux-on-litex-vexriscv"></a>linux-on-litex-vexriscv</h2><ul>
<li><a href="https://github.com/litex-hub/linux-on-litex-vexriscv" target="_blank" rel="noopener">litex-hub/linux-on-litex-vexriscv</a></li>
<li>下面就是围绕<a href="https://github.com/litex-hub/linux-on-litex-vexriscv" target="_blank" rel="noopener">litex-hub/linux-on-litex-vexriscv</a>快速实验一下.</li>
</ul>
<h2 id="安装LiteX-Migen及工具"><a href="#安装LiteX-Migen及工具" class="headerlink" title="安装LiteX/Migen及工具"></a>安装<code>LiteX/Migen</code>及工具</h2><ul>
<li>参考链接:<ul>
<li><a href="https://github.com/enjoy-digital/litex" target="_blank" rel="noopener">enjoy-digital/litex</a></li>
<li><a href="https://reposhub.com/cpp/miscellaneous/litex-hub-linux-on-litex-rocket.html" target="_blank" rel="noopener">Run 64-bit Linux on LiteX + RocketChip</a></li>
<li><a href="https://thuchoang90.github.io/vexriscv.html" target="_blank" rel="noopener">VEXRISCV 32-bit MCU</a></li>
</ul>
</li>
<li>The LiteX framework provides a convenient and efficient infrastructure to create FPGA Cores/SoCs, to explore various digital design architectures and create full FPGA based systems.</li>
<li>首先这里的<code>LiteX</code>跟一个加密货币链是同名的.<code>Migen</code>是基于<code>FHDL</code>(嵌入<code>Python的eDSL</code>)的<code>EDA</code>工具箱,它还包含了<code>MiSoC/nMigen</code>之类的衍生和扩展来更好的简化硬件设计/开发.而<code>LiteX</code>则是一个基于<code>MiGen</code>的<code>Core/SoC</code>构建器,它包含了<code>SoC</code>设计框架和一组<code>IP</code>库/实用程序来高效地创建<code>SoC</code>和进行全定制<code>FPGA</code>设计.<code>LiteX</code>的生态正日益成熟,已支持各种常见的硬件IP和多种<code>RISC-V</code>软核,并在真正的硬件产品开发中使用.</li>
<li>安装必要的工具与一些库文件.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get install verilator libevent-dev libjson-c-dev</span><br><span class="line">~$ pip3 install meson ninja</span><br><span class="line">~$ sdk install sbt</span><br></pre></td></tr></table></figure>
<ul>
<li><p>在运行<code>litex_setup.py</code>时,它会网上下载很多的开源工具库下,大部分都是<code>python,scala</code>两种语写的.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://raw.githubusercontent.com/enjoy-digital/litex/master/litex_setup.py</span><br><span class="line">$ chmod +x litex_setup.py</span><br><span class="line">$ ./litex_setup.py init install --user (--user to install to user directory)</span><br><span class="line"></span><br><span class="line">~$ tree -L 1</span><br><span class="line">.</span><br><span class="line">├── litedram</span><br><span class="line">├── liteeth</span><br><span class="line">├── litehyperbus</span><br><span class="line">├── liteiclink</span><br><span class="line">├── litejesd204b</span><br><span class="line">├── litepcie</span><br><span class="line">├── litesata</span><br><span class="line">├── litescope</span><br><span class="line">├── litesdcard</span><br><span class="line">├── litespi</span><br><span class="line">├── litex</span><br><span class="line">├── litex-boards</span><br><span class="line">├── litex_setup.py</span><br><span class="line">├── migen</span><br><span class="line">├── nmigen</span><br><span class="line">├── pythondata-cpu-blackparrot</span><br><span class="line">├── pythondata-cpu-cv32e40p</span><br><span class="line">├── pythondata-cpu-ibex</span><br><span class="line">├── pythondata-cpu-lm32</span><br><span class="line">├── pythondata-cpu-microwatt</span><br><span class="line">├── pythondata-cpu-minerva</span><br><span class="line">├── pythondata-cpu-mor1kx</span><br><span class="line">├── pythondata-cpu-picorv32</span><br><span class="line">├── pythondata-cpu-rocket</span><br><span class="line">├── pythondata-cpu-serv</span><br><span class="line">├── pythondata-cpu-vexriscv</span><br><span class="line">├── pythondata-cpu-vexriscv-smp</span><br><span class="line">├── pythondata-misc-tapcfg</span><br><span class="line">├── pythondata-misc-usb_ohci</span><br><span class="line">├── pythondata-software-compiler_rt</span><br><span class="line">└── pythondata-software-picolibc</span><br></pre></td></tr></table></figure>
</li>
<li><p>关于<code>LiteX</code>更详细的资料,一定要参考它的<a href="https://github.com/enjoy-digital/litex/wiki" target="_blank" rel="noopener">litex/wiki</a>,及以一些常用的命令</p>
</li>
</ul>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><ul>
<li><p>可以时常升级保持更新</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ ./litex_setup.py --update</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用它的脚本,一键编译做工具链<code>RISC-V toolchain</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$  ./litex_setup.py --gcc=riscv</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Litex-Buildenv"><a href="#Litex-Buildenv" class="headerlink" title="Litex-Buildenv"></a>Litex-Buildenv</h2><ul>
<li><a href="https://github.com/timvideos/litex-buildenv" target="_blank" rel="noopener">litex-buildenv</a> An environment for building LiteX based FPGA designs. Makes it easy to get everything you need!</li>
<li>但是测试发现这个库有一点过时了,有很多东西没有维护了.</li>
</ul>
<h2 id="Litex-VexRiscv"><a href="#Litex-VexRiscv" class="headerlink" title="Litex-VexRiscv"></a>Litex-VexRiscv</h2><h3 id="模拟器运行"><a href="#模拟器运行" class="headerlink" title="模拟器运行"></a>模拟器运行</h3><ul>
<li><p>第一次运行它会下载相应的源码并编译.并且需要在<code>images</code>目录下有如下文件:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ ls images/</span><br><span class="line">boot.json  Image  opensbi.bin  rootfs.cpio  rv32.dtb</span><br></pre></td></tr></table></figure>
</li>
<li><p>主要三个类型的文件:<code>Linux Kernel, OpenSBI(uboot), Rootfs</code>. 可以先不自己构建,下载对应的的文件做快速测,</p>
<ul>
<li><a href="https://github.com/litex-hub/linux-on-litex-vexriscv/files/6220823/linux_2021_03_29.zip" target="_blank" rel="noopener">linux_2021_03_29.zip (5.12-rc4)</a></li>
<li><a href="https://github.com/litex-hub/linux-on-litex-vexriscv/files/5702162/opensbi_2020_12_15.zip" target="_blank" rel="noopener">linux_2021_03_29.zip (5.12-rc4)</a></li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">export</span> PATH=~/riscv64-toolchain/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line">~$ git <span class="built_in">clone</span> https://github.com/litex-hub/linux-on-litex-vexriscv</span><br><span class="line">~$ <span class="built_in">cd</span> linux-on-litex-vexriscv</span><br><span class="line">~$ ./sim.py</span><br><span class="line">[xgmii_ethernet] loaded (0x55e196f0d090)</span><br><span class="line">[clocker] loaded</span><br><span class="line">[spdeeprom] loaded (addr = 0x0)</span><br><span class="line">[serial2tcp] loaded (0x55e196f0d090)</span><br><span class="line">[serial2console] loaded (0x55e196f0d090)</span><br><span class="line">[gmii_ethernet] loaded (0x55e196f0d090)</span><br><span class="line">[ethernet] loaded (0x55e196f0d090)</span><br><span class="line">[clocker] sys_clk: freq_hz=1000000, phase_deg=0</span><br><span class="line"></span><br><span class="line">        __   _ __      _  __</span><br><span class="line">       / /  (_) /____ | |/_/</span><br><span class="line">      / /__/ / __/ -_)&gt;  &lt;</span><br><span class="line">     /____/_/\__/\__/_/|_|</span><br><span class="line">   Build your hardware, easily!</span><br><span class="line"></span><br><span class="line"> (c) Copyright 2012-2021 Enjoy-Digital</span><br><span class="line"> (c) Copyright 2007-2015 M-Labs</span><br><span class="line"></span><br><span class="line"> BIOS CRC passed (38bb961c)</span><br><span class="line"></span><br><span class="line"> Migen git sha1: 7507a2b</span><br><span class="line"> LiteX git sha1: af5167c7</span><br><span class="line"></span><br><span class="line">--=============== SoC ==================--</span><br><span class="line">CPU:		VexRiscv SMP-LINUX @ 100MHz</span><br><span class="line">BUS:		WISHBONE 32-bit @ 4GiB</span><br><span class="line">CSR:		32-bit data</span><br><span class="line">ROM:		32KiB</span><br><span class="line">SRAM:		8KiB</span><br><span class="line">L2:		0KiB</span><br><span class="line">SDRAM:		65536KiB 32-bit @ 100MT/s (CL-2 CWL-2)</span><br><span class="line"></span><br><span class="line">--========== Initialization ============--</span><br><span class="line">Initializing SDRAM @0x40000000...</span><br><span class="line">Switching SDRAM to software control.</span><br><span class="line">Switching SDRAM to hardware control.</span><br><span class="line"></span><br><span class="line">--============== Boot ==================--</span><br><span class="line">Booting from serial...</span><br><span class="line">Press Q or ESC to abort boot completely.</span><br><span class="line">sL5DdSMmkekro</span><br><span class="line">Timeout</span><br><span class="line">Executing booted program at 0x40f00000</span><br><span class="line"></span><br><span class="line">--============= Liftoff! ===============--</span><br><span class="line"></span><br><span class="line">OpenSBI v0.8-1-gecf7701</span><br><span class="line">   ____                    _____ ____ _____</span><br><span class="line">  / __ \                  / ____|  _ \_   _|</span><br><span class="line"> | |  | |_ __   ___ _ __ | (___ | |_) || |</span><br><span class="line"> | |  | | <span class="string">'_ \ / _ \ '</span>_ \ \___ \|  _ &lt; | |</span><br><span class="line"> | |__| | |_) |  __/ | | |____) | |_) || |_</span><br><span class="line">  \____/| .__/ \___|_| |_|_____/|____/_____|</span><br><span class="line">        | |</span><br><span class="line">        |_|</span><br><span class="line"></span><br><span class="line">Platform Name       : LiteX / VexRiscv-SMP</span><br><span class="line">Platform Features   : timer,mfdeleg</span><br><span class="line">Platform HART Count : 8</span><br><span class="line">Boot HART ID        : 0</span><br><span class="line">Boot HART ISA       : rv32imas</span><br><span class="line">BOOT HART Features  : time</span><br><span class="line">BOOT HART PMP Count : 0</span><br><span class="line">Firmware Base       : 0x40f00000</span><br><span class="line">Firmware Size       : 124 KB</span><br><span class="line">Runtime SBI Version : 0.2</span><br><span class="line"></span><br><span class="line">MIDELEG : 0x00000222</span><br><span class="line">MEDELEG : 0x0000b101</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里好像有问题,没有运行下去,出现一个shell console.</span></span><br></pre></td></tr></table></figure>
<ul>
<li>也可以使用<code>lxsim</code>运行,它是<code>litex_setup.py</code>安装的工具集,位于<code>~/.local/bin/lxsim</code>.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">~$ lxsim --cpu-type=vexriscv</span><br><span class="line">INFO:SoC:        __   _ __      _  __</span><br><span class="line">INFO:SoC:       / /  (_) /____ | |/_/</span><br><span class="line">INFO:SoC:      / /__/ / __/ -_)&gt;  &lt;</span><br><span class="line">INFO:SoC:     /____/_/\__/\__/_/|_|</span><br><span class="line">INFO:SoC:  Build your hardware, easily!</span><br><span class="line">INFO:SoC:--------------------------------------------------------------------------------</span><br><span class="line">INFO:SoC:Creating SoC... (2021-11-06 22:03:10)</span><br><span class="line">INFO:SoC:--------------------------------------------------------------------------------</span><br><span class="line">INFO:SoC:FPGA device : SIM.</span><br><span class="line">INFO:SoC:System clock: 1.000MHz.</span><br><span class="line">INFO:SoCBusHandler:Creating Bus Handler...</span><br><span class="line">INFO:SoCBusHandler:32-bit wishbone Bus, 4.0GiB Address Space.</span><br><span class="line">INFO:SoCBusHandler:Adding reserved Bus Regions...</span><br><span class="line">INFO:SoCBusHandler:Bus Handler created.</span><br><span class="line">INFO:SoCCSRHandler:Creating CSR Handler...</span><br><span class="line">INFO:SoCCSRHandler:32-bit CSR Bus, 32-bit Aligned, 16.0KiB Address Space, 2048B Paging, big Ordering (Up to 32 Locations).</span><br><span class="line">INFO:SoCCSRHandler:Adding reserved CSRs...</span><br><span class="line">INFO:SoCCSRHandler:CSR Handler created.</span><br><span class="line">INFO:SoCIRQHandler:Creating IRQ Handler...</span><br><span class="line">INFO:SoCIRQHandler:IRQ Handler (up to 32 Locations).</span><br><span class="line">INFO:SoCIRQHandler:Adding reserved IRQs...</span><br><span class="line">INFO:SoCIRQHandler:IRQ Handler created.</span><br><span class="line">[...]</span><br><span class="line">[...]</span><br><span class="line">[xgmii_ethernet] loaded (0x5575a247c090)</span><br><span class="line">[clocker] loaded</span><br><span class="line">[spdeeprom] loaded (addr = 0x0)</span><br><span class="line">[serial2tcp] loaded (0x5575a247c090)</span><br><span class="line">[serial2console] loaded (0x5575a247c090)</span><br><span class="line">[gmii_ethernet] loaded (0x5575a247c090)</span><br><span class="line">[ethernet] loaded (0x5575a247c090)</span><br><span class="line">[clocker] sys_clk: freq_hz=1000000, phase_deg=0</span><br><span class="line"></span><br><span class="line">        __   _ __      _  __</span><br><span class="line">       / /  (_) /____ | |/_/</span><br><span class="line">      / /__/ / __/ -_)&gt;  &lt;</span><br><span class="line">     /____/_/\__/\__/_/|_|</span><br><span class="line">   Build your hardware, easily!</span><br><span class="line"></span><br><span class="line"> (c) Copyright 2012-2021 Enjoy-Digital</span><br><span class="line"> (c) Copyright 2007-2015 M-Labs</span><br><span class="line"></span><br><span class="line"> BIOS built on Nov  6 2021 22:03:21</span><br><span class="line"> BIOS CRC passed (5bc979b3)</span><br><span class="line"></span><br><span class="line"> Migen git sha1: 7507a2b</span><br><span class="line"> LiteX git sha1: af5167c7</span><br><span class="line"></span><br><span class="line">--=============== SoC ==================--</span><br><span class="line">CPU:		VexRiscv @ 1MHz</span><br><span class="line">BUS:		WISHBONE 32-bit @ 4GiB</span><br><span class="line">CSR:		32-bit data</span><br><span class="line">ROM:		128KiB</span><br><span class="line">SRAM:		8KiB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--============== Boot ==================--</span><br><span class="line">Booting from serial...</span><br><span class="line">Press Q or ESC to abort boot completely.</span><br><span class="line">sL5DdSMmkekro</span><br><span class="line">Timeout</span><br><span class="line">No boot medium found</span><br><span class="line"></span><br><span class="line">--============= Console ================--</span><br><span class="line"></span><br><span class="line">litex&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="板上运行"><a href="#板上运行" class="headerlink" title="板上运行"></a>板上运行</h2><h3 id="编译FPGA-bitstream"><a href="#编译FPGA-bitstream" class="headerlink" title="编译FPGA bitstream"></a>编译<code>FPGA bitstream</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linux-on-litex-vexriscv$ ./make.py --board=arty --cpu-count=16 --build</span><br></pre></td></tr></table></figure>
<ul>
<li><p>编译完成后,有如下目录.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">linux-on-litex-vexriscv$ tree -L 2  build</span><br><span class="line">build</span><br><span class="line">├── arty</span><br><span class="line">│   ├── arty.dtb</span><br><span class="line">│   ├── arty.dts</span><br><span class="line">│   ├── csr.csv</span><br><span class="line">│   ├── csr.json</span><br><span class="line">│   ├── gateware</span><br><span class="line">│   └── software</span><br><span class="line">└── sim</span><br><span class="line">    ├── csr.json</span><br><span class="line">    ├── gateware</span><br><span class="line">    ├── sim.dts</span><br><span class="line">    └── software</span><br></pre></td></tr></table></figure>
</li>
<li><p>它的内存文件,以及其它文件都可以在<code>gateware</code>目录可以找到</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">linux-on-litex-vexriscv$ tree -L 2  build/arty/gateware/</span><br><span class="line">build/arty/gateware/</span><br><span class="line">├── arty.bin</span><br><span class="line">├── arty.bit</span><br><span class="line">├── arty.cache</span><br><span class="line">│   └── wt</span><br><span class="line">├── arty_clock_utilization.rpt</span><br><span class="line">├── arty_control_sets.rpt</span><br><span class="line">├── arty_drc.rpt</span><br><span class="line">├── arty.hw</span><br><span class="line">│   └── arty.lpr</span><br><span class="line">├── arty_io.rpt</span><br><span class="line">├── arty.ip_user_files</span><br><span class="line">├── arty_power.rpt</span><br><span class="line">├── arty.prm</span><br><span class="line">├── arty_route.dcp</span><br><span class="line">├── arty_route_status.rpt</span><br><span class="line">├── arty.tcl</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<h3 id="使用OpenOCD加载"><a href="#使用OpenOCD加载" class="headerlink" title="使用OpenOCD加载"></a>使用<code>OpenOCD</code>加载</h3><ul>
<li>因为<code>LiteX</code>是完全使用开源工具集合来开发自己的硬件,所以烧写器,可以使用<code>FT2232 + OpenOCD</code>这种组合来支持,<code>OpenOCD</code>这里无需特定分支版本,就用官方的标准版本就可以.也可以使用<code>Vivado</code>烧写它.还有这里可能有一个小的问题,因为<code>linux-on-litex-vexriscv/prog</code>下无<code>openocd</code>的配置文件,需要先把从<code>litex-boards/litex_boards/prog</code>把文件复制或者链到该目录下.</li>
<li>为了能让普通用户访问到<code>FT2232</code>的<code>/dev/ttyUSBX</code>,确做了如下的设置.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /etc/udev/rules.d/98-openocd.rules</span><br><span class="line"></span><br><span class="line"><span class="comment"># Adding Arduino M0/M0 Pro, Primo UDEV Rules for CMSIS-DAP port</span></span><br><span class="line"></span><br><span class="line">ACTION!=<span class="string">"add|change"</span>, GOTO=<span class="string">"openocd_rules_end"</span></span><br><span class="line">SUBSYSTEM!=<span class="string">"usb|tty|hidraw"</span>, GOTO=<span class="string">"openocd_rules_end"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Please keep this list sorted by VID:PID</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#CMSIS-DAP compatible adapters</span></span><br><span class="line">ATTRS&#123;product&#125;==<span class="string">"*CMSIS-DAP*"</span>, MODE=<span class="string">"664"</span>, GROUP=<span class="string">"plugdev"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Original FT232/FT245 VID:PID</span></span><br><span class="line">ATTRS&#123;idVendor&#125;==<span class="string">"0403"</span>, ATTRS&#123;idProduct&#125;==<span class="string">"6001"</span>, MODE=<span class="string">"664"</span>, GROUP=<span class="string">"plugdev"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Original FT2232 VID:PID</span></span><br><span class="line">ATTRS&#123;idVendor&#125;==<span class="string">"0403"</span>, ATTRS&#123;idProduct&#125;==<span class="string">"6010"</span>, MODE=<span class="string">"664"</span>, GROUP=<span class="string">"plugdev"</span></span><br><span class="line"></span><br><span class="line">LABEL=<span class="string">"openocd_rules_end"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>指定参数编译并加载,目标板<code>--board=arty</code>.或者使用<code>./make.py --board=arty --flash</code>烧写到flash.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">linux-on-litex-vexriscv$ ./make.py --board=arty  --load</span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line"> OBJCOPY  bios.bin</span><br><span class="line">chmod -x bios.bin</span><br><span class="line">python3 -m litex.soc.software.mkmscimg bios.bin --little</span><br><span class="line">python3 -m litex.soc.software.memusage bios.elf /home/michael/workspace-xilinx/RISC-V/litex-hub/linux-on-litex-vexriscv/build/arty/software/bios/../include/generated/regions.ld riscv64-unknown-elf</span><br><span class="line"></span><br><span class="line">ROM usage: 39.94KiB 	(62.40%)</span><br><span class="line">RAM usage: 0.61KiB 	(7.62%)</span><br><span class="line"></span><br><span class="line">make: Leaving directory <span class="string">'/home/michael/workspace-xilinx/RISC-V/litex-hub/linux-on-litex-vexriscv/build/arty/software/bios'</span></span><br><span class="line">INFO:SoC:Initializing ROM rom with contents (Size: 0x9fd8).</span><br><span class="line">INFO:SoC:Auto-Resizing ROM rom from 0x10000 to 0x9fd8.</span><br><span class="line">build/arty/arty.dts:767.34-778.19: Warning (unit_address_vs_reg): /soc/clk@f0005000/CLKOUT0: node has a reg or ranges property, but no unit name</span><br><span class="line">build/arty/arty.dts:780.34-791.19: Warning (unit_address_vs_reg): /soc/clk@f0005000/CLKOUT1: node has a reg or ranges property, but no unit name</span><br><span class="line">Open On-Chip Debugger 0.11.0+dev-00433-g97db87c22 (2021-11-01-22:36)</span><br><span class="line">Licensed under GNU GPL v2</span><br><span class="line">For bug reports, <span class="built_in">read</span></span><br><span class="line">	http://openocd.org/doc/doxygen/bugs.html</span><br><span class="line">DEPRECATED! use <span class="string">'adapter driver'</span> not <span class="string">'interface'</span></span><br><span class="line">DEPRECATED! use <span class="string">'ftdi vid_pid'</span> not <span class="string">'ftdi_vid_pid'</span></span><br><span class="line">DEPRECATED! use <span class="string">'ftdi channel'</span> not <span class="string">'ftdi_channel'</span></span><br><span class="line">DEPRECATED! use <span class="string">'ftdi layout_init'</span> not <span class="string">'ftdi_layout_init'</span></span><br><span class="line">Info : auto-selecting first available session transport <span class="string">"jtag"</span>. To override use <span class="string">'transport select &lt;transport&gt;'</span>.</span><br><span class="line">DEPRECATED! use <span class="string">'adapter speed'</span> not <span class="string">'adapter_khz'</span></span><br><span class="line">fpga_program</span><br><span class="line">Info : ftdi: <span class="keyword">if</span> you experience problems at higher adapter clocks, try the <span class="built_in">command</span> <span class="string">"ftdi tdo_sample_edge falling"</span></span><br><span class="line">Info : clock speed 25000 kHz</span><br><span class="line">Info : JTAG tap: xc7.tap tap/device found: 0x0362d093 (mfg: 0x049 (Xilinx), part: 0x362d, ver: 0x0)</span><br></pre></td></tr></table></figure>
<ul>
<li>加载成功后,板上的流水灯就会开始闪烁了.用<code>lxterm /dev/ttyUSB1 --speed=1e6</code>直接进入<code>litex boot</code>界面,如下:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"> ~/.<span class="built_in">local</span>/bin/lxterm /dev/ttyUSB1 --speed=1e6</span><br><span class="line"> BIOS CRC passed (cf084352)</span><br><span class="line"></span><br><span class="line"> Migen git sha1: 7507a2b</span><br><span class="line"> LiteX git sha1: 67431f41</span><br><span class="line"></span><br><span class="line">--=============== SoC ==================--</span><br><span class="line">CPU:		VexRiscv SMP-LINUX @ 100MHz</span><br><span class="line">BUS:		WISHBONE 32-bit @ 4GiB</span><br><span class="line">CSR:		32-bit data</span><br><span class="line">ROM:		64KiB</span><br><span class="line">SRAM:		8KiB</span><br><span class="line">L2:		0KiB</span><br><span class="line">FLASH:		16384KiB</span><br><span class="line">SDRAM:		262144KiB 16-bit @ 800MT/s (CL-7 CWL-5)</span><br><span class="line"></span><br><span class="line">--========== Initialization ============--</span><br><span class="line">Ethernet init...</span><br><span class="line">Initializing SDRAM @0x40000000...</span><br><span class="line">Switching SDRAM to software control.</span><br><span class="line">Write latency calibration:</span><br><span class="line">m0:0 m1:0</span><br><span class="line">Read leveling:</span><br><span class="line">  m0, b00: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m0, b01: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m0, b02: |11111111110000000000000000000000| delays: 05+-05</span><br><span class="line">  m0, b03: |00000000000011111111111110000000| delays: 19+-07</span><br><span class="line">  m0, b04: |00000000000000000000000000011111| delays: 30+-02</span><br><span class="line">  m0, b05: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m0, b06: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m0, b07: |00000000000000000000000000000000| delays: -</span><br><span class="line">  best: m0, b03 delays: 19+-07</span><br><span class="line">  m1, b00: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m1, b01: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m1, b02: |11111111110000000000000000000000| delays: 05+-05</span><br><span class="line">  m1, b03: |00000000000111111111111111000000| delays: 18+-07</span><br><span class="line">  m1, b04: |00000000000000000000000000001111| delays: 30+-02</span><br><span class="line">  m1, b05: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m1, b06: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m1, b07: |00000000000000000000000000000000| delays: -</span><br><span class="line">  best: m1, b03 delays: 19+-07</span><br><span class="line">Switching SDRAM to hardware control.</span><br><span class="line">Memtest at 0x40000000 (2.0MiB)...</span><br><span class="line">  Write: 0x40000000-0x40200000 2.0MiB</span><br><span class="line">   Read: 0x40000000-0x40200000 2.0MiB</span><br><span class="line">Memtest OK</span><br><span class="line">Memspeed at 0x40000000 (Sequential, 2.0MiB)...</span><br><span class="line">  Write speed: 31.7MiB/s</span><br><span class="line">   Read speed: 33.1MiB/s</span><br><span class="line"></span><br><span class="line">Initializing S25FL128L SPI Flash @0xd0000000...</span><br><span class="line">SPI Flash clk configured to 25 MHz</span><br><span class="line">Memspeed at 0xd0000000 (Sequential, 4.0KiB)...</span><br><span class="line">   Read speed: 2.5MiB/s</span><br><span class="line">Memspeed at 0xd0000000 (Random, 4.0KiB)...</span><br><span class="line">   Read speed: 1.1MiB/s</span><br><span class="line"></span><br><span class="line">--============== Boot ==================--</span><br><span class="line">Booting from serial...</span><br><span class="line">Press Q or ESC to abort boot completely.</span><br><span class="line">sL5DdSMmkekro</span><br><span class="line">Timeout</span><br><span class="line">Booting from SDCard <span class="keyword">in</span> SD-Mode...</span><br><span class="line">Booting from boot.json...</span><br><span class="line">Booting from boot.bin...</span><br><span class="line">SDCard boot failed.</span><br><span class="line">Booting from network...</span><br><span class="line">Local IP: 192.168.1.50</span><br><span class="line">Remote IP: 192.168.1.100</span><br><span class="line">Booting from boot.json...</span><br><span class="line">Booting from boot.bin...</span><br><span class="line">Copying boot.bin to 0x40000000...</span><br><span class="line">Network boot failed.</span><br><span class="line">No boot medium found</span><br><span class="line"></span><br><span class="line">--============= Console ================--</span><br><span class="line"></span><br><span class="line">litex&gt; <span class="built_in">help</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="加载运行Linux系统"><a href="#加载运行Linux系统" class="headerlink" title="加载运行Linux系统"></a>加载运行<code>Linux</code>系统</h3><ul>
<li><p>同样<code>lxterm</code>也是<code>litex_setup.py</code>安装的工具集之一,位于<code>~/.local/bin/lxterm</code>.如果你用的是<code>Mate Desktop</code>,它也有一个同名的工具,别混用了.运行下面命令时,要按一下板上的<code>PROG</code>键, 让它进入烧写状态.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br></pre></td><td class="code"><pre><span class="line">linux-on-litex-vexriscv$ ~/.<span class="built_in">local</span>/bin/lxterm --images=images/boot.json /dev/ttyUSB1 --speed=1e6</span><br><span class="line"> BIOS CRC passed (f7d62022)</span><br><span class="line"></span><br><span class="line"> Migen git sha1: 7507a2b</span><br><span class="line"> LiteX git sha1: af5167c7</span><br><span class="line"></span><br><span class="line">--=============== SoC ==================--</span><br><span class="line">CPU:		VexRiscv SMP-LINUX @ 100MHz</span><br><span class="line">BUS:		WISHBONE 32-bit @ 4GiB</span><br><span class="line">CSR:		32-bit data</span><br><span class="line">ROM:		64KiB</span><br><span class="line">SRAM:		8KiB</span><br><span class="line">L2:		0KiB</span><br><span class="line">FLASH:		16384KiB</span><br><span class="line">SDRAM:		262144KiB 16-bit @ 800MT/s (CL-7 CWL-5)</span><br><span class="line"></span><br><span class="line">--========== Initialization ============--</span><br><span class="line">Ethernet init...</span><br><span class="line">Initializing SDRAM @0x40000000...</span><br><span class="line">Switching SDRAM to software control.</span><br><span class="line">Write latency calibration:</span><br><span class="line">m0:0 m1:0</span><br><span class="line">Read leveling:</span><br><span class="line">  m0, b00: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m0, b01: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m0, b02: |11111111110000000000000000000000| delays: 05+-05</span><br><span class="line">  m0, b03: |00000000000011111111111110000000| delays: 18+-06</span><br><span class="line">  m0, b04: |00000000000000000000000000011111| delays: 29+-02</span><br><span class="line">  m0, b05: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m0, b06: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m0, b07: |00000000000000000000000000000000| delays: -</span><br><span class="line">  best: m0, b03 delays: 18+-06</span><br><span class="line">  m1, b00: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m1, b01: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m1, b02: |11111111110000000000000000000000| delays: 05+-05</span><br><span class="line">  m1, b03: |00000000000111111111111110000000| delays: 18+-07</span><br><span class="line">  m1, b04: |00000000000000000000000000011111| delays: 29+-02</span><br><span class="line">  m1, b05: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m1, b06: |00000000000000000000000000000000| delays: -</span><br><span class="line">  m1, b07: |00000000000000000000000000000000| delays: -</span><br><span class="line">  best: m1, b03 delays: 18+-07</span><br><span class="line">Switching SDRAM to hardware control.</span><br><span class="line">Memtest at 0x40000000 (2.0MiB)...</span><br><span class="line">  Write: 0x40000000-0x40200000 2.0MiB</span><br><span class="line">   Read: 0x40000000-0x40200000 2.0MiB</span><br><span class="line">Memtest OK</span><br><span class="line">Memspeed at 0x40000000 (Sequential, 2.0MiB)...</span><br><span class="line">  Write speed: 31.7MiB/s</span><br><span class="line">   Read speed: 33.1MiB/s</span><br><span class="line"></span><br><span class="line">Initializing S25FL128L SPI Flash @0xd0000000...</span><br><span class="line">SPI Flash clk configured to 25 MHz</span><br><span class="line">Memspeed at 0xd0000000 (Sequential, 4.0KiB)...</span><br><span class="line">   Read speed: 2.5MiB/s</span><br><span class="line">Memspeed at 0xd0000000 (Random, 4.0KiB)...</span><br><span class="line">   Read speed: 1.1MiB/s</span><br><span class="line"></span><br><span class="line">--============== Boot ==================--</span><br><span class="line">Booting from serial...</span><br><span class="line">Press Q or ESC to abort boot completely.</span><br><span class="line">sL5DdSMmkekro</span><br><span class="line">[LXTERM] Received firmware download request from the device.</span><br><span class="line">[LXTERM] Uploading images/Image to 0x40000000 (7420864 bytes)...</span><br><span class="line">[LXTERM] Upload calibration... (inter-frame: 10.00us, length: 64)</span><br><span class="line">[LXTERM] Upload complete (86.2KB/s).</span><br><span class="line">[LXTERM] Uploading images/rv32.dtb to 0x40ef0000 (12130 bytes)...</span><br><span class="line">[LXTERM] Upload calibration... (inter-frame: 10.00us, length: 64)</span><br><span class="line">[LXTERM] Upload complete (78.9KB/s).</span><br><span class="line">[LXTERM] Uploading images/rootfs.cpio to 0x41000000 (4010496 bytes)...</span><br><span class="line">[LXTERM] Upload calibration... (inter-frame: 10.00us, length: 64)</span><br><span class="line">[LXTERM] Upload complete (86.2KB/s).</span><br><span class="line">[LXTERM] Uploading images/opensbi.bin to 0x40f00000 (53640 bytes)...</span><br><span class="line">[LXTERM] Upload calibration... (inter-frame: 10.00us, length: 64)</span><br><span class="line">[LXTERM] Upload complete (85.3KB/s).</span><br><span class="line">[LXTERM] Booting the device.</span><br><span class="line">[LXTERM] Done.</span><br><span class="line">Executing booted program at 0x40f00000</span><br><span class="line"></span><br><span class="line">--============= Liftoff! ===============--</span><br><span class="line"></span><br><span class="line">OpenSBI v0.8-1-gecf7701</span><br><span class="line">   ____                    _____ ____ _____</span><br><span class="line">  / __ \                  / ____|  _ \_   _|</span><br><span class="line"> | |  | |_ __   ___ _ __ | (___ | |_) || |</span><br><span class="line"> | |  | | <span class="string">'_ \ / _ \ '</span>_ \ \___ \|  _ &lt; | |</span><br><span class="line"> | |__| | |_) |  __/ | | |____) | |_) || |_</span><br><span class="line">  \____/| .__/ \___|_| |_|_____/|____/_____|</span><br><span class="line">        | |</span><br><span class="line">        |_|</span><br><span class="line"></span><br><span class="line">Platform Name       : LiteX / VexRiscv-SMP</span><br><span class="line">Platform Features   : timer,mfdeleg</span><br><span class="line">Platform HART Count : 8</span><br><span class="line">Boot HART ID        : 0</span><br><span class="line">Boot HART ISA       : rv32imas</span><br><span class="line">BOOT HART Features  : time</span><br><span class="line">BOOT HART PMP Count : 0</span><br><span class="line">Firmware Base       : 0x40f00000</span><br><span class="line">Firmware Size       : 124 KB</span><br><span class="line">Runtime SBI Version : 0.2</span><br><span class="line"></span><br><span class="line">MIDELEG : 0x00000222</span><br><span class="line">MEDELEG : 0x0000b101</span><br><span class="line">[    0.000000] Linux version 5.12.0-rc4 (florent@panda) (riscv32-buildroot-linux-gnu-gcc.br_real (Buildroot 2020.11-281-g69e5046e7b) 10.2.0, GNU ld (GNU Binutils) 2.35.2) <span class="comment">#2 SMP Mon Mar 29 10:07:39 CEST 2021</span></span><br><span class="line">[    0.000000] Zone ranges:</span><br><span class="line">[    0.000000]   Normal   [mem 0x0000000040000000-0x000000004fffffff]</span><br><span class="line">[    0.000000] Movable zone start <span class="keyword">for</span> each node</span><br><span class="line">[    0.000000] Early memory node ranges</span><br><span class="line">[    0.000000]   node   0: [mem 0x0000000040000000-0x000000004fffffff]</span><br><span class="line">[    0.000000] Initmem setup node 0 [mem 0x0000000040000000-0x000000004fffffff]</span><br><span class="line">[    0.000000] SBI specification v0.2 detected</span><br><span class="line">[    0.000000] SBI implementation ID=0x1 Version=0x8</span><br><span class="line">[    0.000000] SBI v0.2 TIME extension detected</span><br><span class="line">[    0.000000] SBI v0.2 IPI extension detected</span><br><span class="line">[    0.000000] SBI v0.2 RFENCE extension detected</span><br><span class="line">[    0.000000] SBI v0.2 HSM extension detected</span><br><span class="line">[    0.000000] Invalid cpuid [8] <span class="keyword">for</span> hartid [8]</span><br><span class="line">[    0.000000] riscv: ISA extensions aim</span><br><span class="line">[    0.000000] riscv: ELF capabilities aim</span><br><span class="line">[    0.000000] percpu: Embedded 10 pages/cpu s19148 r0 d21812 u40960</span><br><span class="line">[    0.000000] CPU node <span class="keyword">for</span> /cpus/cpu@8 exist but the possible cpu range is :0-7</span><br><span class="line">[    0.000000] CPU node <span class="keyword">for</span> /cpus/cpu@9 exist but the possible cpu range is :0-7</span><br><span class="line">[    0.000000] CPU node <span class="keyword">for</span> /cpus/cpu@10 exist but the possible cpu range is :0-7</span><br><span class="line">[    0.000000] CPU node <span class="keyword">for</span> /cpus/cpu@11 exist but the possible cpu range is :0-7</span><br><span class="line">[    0.000000] CPU node <span class="keyword">for</span> /cpus/cpu@12 exist but the possible cpu range is :0-7</span><br><span class="line">[    0.000000] CPU node <span class="keyword">for</span> /cpus/cpu@13 exist but the possible cpu range is :0-7</span><br><span class="line">[    0.000000] CPU node <span class="keyword">for</span> /cpus/cpu@14 exist but the possible cpu range is :0-7</span><br><span class="line">[    0.000000] CPU node <span class="keyword">for</span> /cpus/cpu@15 exist but the possible cpu range is :0-7</span><br><span class="line">[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 65024</span><br><span class="line">[    0.000000] Kernel <span class="built_in">command</span> line: console=liteuart earlycon=liteuart,0xf0001000 rootwait root=/dev/ram0</span><br><span class="line">[    0.000000] Dentry cache <span class="built_in">hash</span> table entries: 32768 (order: 5, 131072 bytes, linear)</span><br><span class="line">[    0.000000] Inode-cache <span class="built_in">hash</span> table entries: 16384 (order: 4, 65536 bytes, linear)</span><br><span class="line">[    0.000000] Sorting __ex_table...</span><br><span class="line">[    0.000000] mem auto-init: stack:off, heap alloc:off, heap free:off</span><br><span class="line">[    0.000000] Memory: 243356K/262144K available (5596K kernel code, 572K rwdata, 860K rodata, 214K init, 221K bss, 18788K reserved, 0K cma-reserved)</span><br><span class="line">[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=8, Nodes=1</span><br><span class="line">[    0.000000] rcu: Hierarchical RCU implementation.</span><br><span class="line">[    0.000000] rcu: RCU calculated value of scheduler-enlistment delay is 25 jiffies.</span><br><span class="line">[    0.000000] NR_IRQS: 64, nr_irqs: 64, preallocated irqs: 0</span><br><span class="line">[    0.000000] riscv-intc: 32 <span class="built_in">local</span> interrupts mapped</span><br><span class="line">[    0.000000] Couldn<span class="string">'t find cpu id for hartid [8]</span></span><br><span class="line"><span class="string">[    0.000000] Couldn'</span>t find cpu id <span class="keyword">for</span> hartid [9]</span><br><span class="line">[    0.000000] Couldn<span class="string">'t find cpu id for hartid [10]</span></span><br><span class="line"><span class="string">[    0.000000] Couldn'</span>t find cpu id <span class="keyword">for</span> hartid [11]</span><br><span class="line">[    0.000000] Couldn<span class="string">'t find cpu id for hartid [12]</span></span><br><span class="line"><span class="string">[    0.000000] Couldn'</span>t find cpu id <span class="keyword">for</span> hartid [13]</span><br><span class="line">[    0.000000] Couldn<span class="string">'t find cpu id for hartid [14]</span></span><br><span class="line"><span class="string">[    0.000000] Couldn'</span>t find cpu id <span class="keyword">for</span> hartid [15]</span><br><span class="line">[    0.000000] Couldn<span class="string">'t find cpu id for hartid [8]</span></span><br><span class="line"><span class="string">[    0.000000] Couldn'</span>t find cpu id <span class="keyword">for</span> hartid [9]</span><br><span class="line">[    0.000000] plic: handler already present <span class="keyword">for</span> context 19.</span><br><span class="line">[    0.000000] Couldn<span class="string">'t find cpu id for hartid [10]</span></span><br><span class="line"><span class="string">[    0.000000] plic: handler already present for context 21.</span></span><br><span class="line"><span class="string">[    0.000000] Couldn'</span>t find cpu id <span class="keyword">for</span> hartid [11]</span><br><span class="line">[    0.000000] plic: handler already present <span class="keyword">for</span> context 23.</span><br><span class="line">[    0.000000] Couldn<span class="string">'t find cpu id for hartid [12]</span></span><br><span class="line"><span class="string">[    0.000000] plic: handler already present for context 25.</span></span><br><span class="line"><span class="string">[    0.000000] Couldn'</span>t find cpu id <span class="keyword">for</span> hartid [13]</span><br><span class="line">[    0.000000] plic: handler already present <span class="keyword">for</span> context 27.</span><br><span class="line">[    0.000000] Couldn<span class="string">'t find cpu id for hartid [14]</span></span><br><span class="line"><span class="string">[    0.000000] plic: handler already present for context 29.</span></span><br><span class="line"><span class="string">[    0.000000] Couldn'</span>t find cpu id <span class="keyword">for</span> hartid [15]</span><br><span class="line">[    0.000000] plic: handler already present <span class="keyword">for</span> context 31.</span><br><span class="line">[    0.000000] plic: interrupt-controller@f0c00000: mapped 32 interrupts with 16 handlers <span class="keyword">for</span> 32 contexts.</span><br><span class="line">[    0.000000] random: get_random_bytes called from start_kernel+0x360/0x4d0 with crng_init=0</span><br><span class="line">[    0.000000] riscv_timer_init_dt: Registering clocksource cpuid [0] hartid [0]</span><br><span class="line">[    0.000000] clocksource: riscv_clocksource: mask: 0xffffffffffffffff max_cycles: 0x171024e7e0, max_idle_ns: 440795205315 ns</span><br><span class="line">[    0.000021] sched_clock: 64 bits at 100MHz, resolution 10ns, wraps every 4398046511100ns</span><br><span class="line">[    0.002019] Couldn<span class="string">'t find cpu id for hartid [8]</span></span><br><span class="line"><span class="string">[    0.002715] Couldn'</span>t find cpu id <span class="keyword">for</span> hartid [9]</span><br><span class="line">[    0.003406] Couldn<span class="string">'t find cpu id for hartid [10]</span></span><br><span class="line"><span class="string">[    0.004035] Couldn'</span>t find cpu id <span class="keyword">for</span> hartid [11]</span><br><span class="line">[    0.004647] Couldn<span class="string">'t find cpu id for hartid [12]</span></span><br><span class="line"><span class="string">[    0.005269] Couldn'</span>t find cpu id <span class="keyword">for</span> hartid [13]</span><br><span class="line">[    0.005888] Couldn<span class="string">'t find cpu id for hartid [14]</span></span><br><span class="line"><span class="string">[    0.006510] Couldn'</span>t find cpu id <span class="keyword">for</span> hartid [15]</span><br><span class="line">[    0.008712] Console: colour dummy device 80x25</span><br><span class="line">[    0.009694] Calibrating delay loop (skipped), value calculated using timer frequency.. 200.00 BogoMIPS (lpj=400000)</span><br><span class="line">[    0.011160] pid_max: default: 32768 minimum: 301</span><br><span class="line">[    0.015359] Mount-cache <span class="built_in">hash</span> table entries: 1024 (order: 0, 4096 bytes, linear)</span><br><span class="line">[    0.016601] Mountpoint-cache <span class="built_in">hash</span> table entries: 1024 (order: 0, 4096 bytes, linear)</span><br><span class="line">[    0.039744] ASID allocator using 9 bits (512 entries)</span><br><span class="line">[    0.042606] rcu: Hierarchical SRCU implementation.</span><br><span class="line">[    0.052177] smp: Bringing up secondary CPUs ...</span><br><span class="line">[    1.106334] CPU1: failed to come online</span><br><span class="line">[    2.174473] CPU2: failed to come online</span><br><span class="line">[    3.242724] CPU3: failed to come online</span><br><span class="line">[    4.310959] CPU4: failed to come online</span><br><span class="line">[    5.379125] CPU5: failed to come online</span><br><span class="line">[    6.447274] CPU6: failed to come online</span><br><span class="line">[    7.515486] CPU7: failed to come online</span><br><span class="line">[    7.516400] smp: Brought up 1 node, 1 CPU</span><br><span class="line">[    7.522412] devtmpfs: initialized</span><br><span class="line">[    7.631706] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645041785100000 ns</span><br><span class="line">[    7.633017] futex <span class="built_in">hash</span> table entries: 2048 (order: 5, 131072 bytes, linear)</span><br><span class="line">[    7.639479] NET: Registered protocol family 16</span><br><span class="line">[    7.880381] FPGA manager framework</span><br><span class="line">[    7.895223] clocksource: Switched to clocksource riscv_clocksource</span><br><span class="line">[    8.064355] NET: Registered protocol family 2</span><br><span class="line">[    8.073113] tcp_listen_portaddr_hash <span class="built_in">hash</span> table entries: 512 (order: 0, 6144 bytes, linear)</span><br><span class="line">[    8.074433] TCP established <span class="built_in">hash</span> table entries: 2048 (order: 1, 8192 bytes, linear)</span><br><span class="line">[    8.076232] TCP <span class="built_in">bind</span> <span class="built_in">hash</span> table entries: 2048 (order: 2, 16384 bytes, linear)</span><br><span class="line">[    8.077425] TCP: Hash tables configured (established 2048 <span class="built_in">bind</span> 2048)</span><br><span class="line">[    8.079928] UDP <span class="built_in">hash</span> table entries: 256 (order: 1, 8192 bytes, linear)</span><br><span class="line">[    8.081038] UDP-Lite <span class="built_in">hash</span> table entries: 256 (order: 1, 8192 bytes, linear)</span><br><span class="line">[    8.092717] Unpacking initramfs...</span><br><span class="line">[    8.858450] Initramfs unpacking failed: invalid magic at start of compressed archive</span><br><span class="line">[    8.916140] Freeing initrd memory: 8192K</span><br><span class="line">[    8.932899] workingset: timestamp_bits=30 max_order=16 bucket_order=0</span><br><span class="line">[    9.193838] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 253)</span><br><span class="line">[    9.194565] io scheduler mq-deadline registered</span><br><span class="line">[    9.195468] io scheduler kyber registered</span><br><span class="line">[    9.223323] No litex,nclkout entry <span class="keyword">in</span> the dts file</span><br><span class="line">[    9.225515] LiteX SoC Controller driver initialized: subreg:4, align:4</span><br><span class="line">[   10.286467] f0001000.serial: ttyLXU0 at MMIO 0x0 (irq = 0, base_baud = 0) is a liteuart</span><br><span class="line">[   10.388082] printk: console [liteuart0] enabled</span><br><span class="line">[   10.443080] libphy: Fixed MDIO Bus: probed</span><br><span class="line">[   10.445897] liteeth f0002000.mac: unable to get rx-fifo-depth</span><br><span class="line">[   10.447597] liteeth: probe of f0002000.mac failed with error -22</span><br><span class="line">[   10.451740] i2c /dev entries driver</span><br><span class="line">[   10.459084] i2c i2c-0: Not I2C compliant: can\<span class="string">'t read SCL</span></span><br><span class="line"><span class="string">[   10.460008] i2c i2c-0: Bus may be unreliable</span></span><br><span class="line"><span class="string">[   10.491212] litex-mmc f0009000.mmc: Requested clk_freq=12500000: set to 12500000 via div=8</span></span><br><span class="line"><span class="string">[   10.523707] fpga_manager fpga0: LiteX ICAPBitstream FPGA Manager registered</span></span><br><span class="line"><span class="string">[   10.549391] NET: Registered protocol family 10</span></span><br><span class="line"><span class="string">[   10.558414] litex-mmc f0009000.mmc: Requested clk_freq=0: set to 390625 via div=256</span></span><br><span class="line"><span class="string">[   10.565072] Segment Routing with IPv6</span></span><br><span class="line"><span class="string">[   10.567088] sit: IPv6, IPv4 and MPLS over IPv4 tunneling driver</span></span><br><span class="line"><span class="string">[   10.582063] NET: Registered protocol family 17</span></span><br><span class="line"><span class="string">[   10.594660] Freeing unused kernel memory: 208K</span></span><br><span class="line"><span class="string">[   10.596083] Kernel memory protection not selected by kernel config.</span></span><br><span class="line"><span class="string">[   10.597491] Run /init as init process</span></span><br><span class="line"><span class="string">Starting syslogd: OK</span></span><br><span class="line"><span class="string">Starting klogd: OK</span></span><br><span class="line"><span class="string">Running sysctl: OK</span></span><br><span class="line"><span class="string">Saving random seed: [   12.456910] random: dd: uninitialized urandom read (512 bytes read)</span></span><br><span class="line"><span class="string">OK</span></span><br><span class="line"><span class="string">Starting network: OK</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Welcome to Buildroot</span></span><br><span class="line"><span class="string">buildroot login:</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>通过串口加载是稍慢的,加载成功后,会有一个<code>shell console</code>登录提示.<code>lxterm</code>是通过板上<code>J10 USB</code>接口使用<code>JTAGUART</code>协议来通信的,脚本是位于<br><code>litex/litex/tools/litex_term.py</code>. 也可以使用<code>sudo minicom -D /dev/ttyUSB1 -b 1000000</code>来连接,注意它的速率是<code>1000000</code>.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">buildroot login: root</span><br><span class="line">                   __   _</span><br><span class="line">                  / /  (_)__  __ ____ __</span><br><span class="line">                 / /__/ / _ \/ // /\ \ /</span><br><span class="line">                /____/_/_//_/\_,_//_\_\</span><br><span class="line">                      / _ \/ _ \</span><br><span class="line">   __   _ __      _  _\___/_//_/         ___  _</span><br><span class="line">  / /  (_) /____ | |/_/__| | / /____ __ / _ \(_)__ _____  __</span><br><span class="line"> / /__/ / __/ -_)&gt;  &lt;/___/ |/ / -_) \ // , _/ (_-&lt;/ __/ |/ /</span><br><span class="line">/____/_/\__/\__/_/|_|____|___/\__/_\_\/_/|_/_/___/\__/|___/</span><br><span class="line">                  / __/  |/  / _ \</span><br><span class="line">                 _\ \/ /|_/ / ___/</span><br><span class="line">                /___/_/  /_/_/</span><br><span class="line">  32-bit RISC-V Linux running on LiteX / VexRiscv-SMP.</span><br><span class="line"></span><br><span class="line">login[103]: root login on <span class="string">'console'</span></span><br><span class="line">root@buildroot:~<span class="comment"># cat /proc/cpuinfo</span></span><br><span class="line">processor	: 0</span><br><span class="line">hart		: 0</span><br><span class="line">isa		: rv32ima</span><br><span class="line">mmu		: sv32</span><br><span class="line"></span><br><span class="line">root@buildroot:~<span class="comment"># free -m</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:            245           3         236           0           5         233</span><br><span class="line">Swap:             0           0           0</span><br></pre></td></tr></table></figure>
<ul>
<li><code>images/boot.json</code>就是内存地址的映射表.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">linux-on-litex-vexriscv$ cat images/boot.json</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"Image"</span>:       <span class="string">"0x40000000"</span>,</span><br><span class="line">	<span class="string">"rv32.dtb"</span>:    <span class="string">"0x40ef0000"</span>,</span><br><span class="line">	<span class="string">"rootfs.cpio"</span>: <span class="string">"0x41000000"</span>,</span><br><span class="line">	<span class="string">"opensbi.bin"</span>: <span class="string">"0x40f00000"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>也可以直接使用<code>OpenOCD</code>来加载,如下:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">linux-on-litex-vexriscv$  openocd -f prog/openocd_xc7_ft2232.cfg -c <span class="string">"transport select jtag; init; pld load 0 build/arty/gateware/arty.bit; exit"</span></span><br><span class="line">Open On-Chip Debugger 0.11.0+dev-00433-g97db87c22 (2021-11-01-22:36)</span><br><span class="line">Licensed under GNU GPL v2</span><br><span class="line">For bug reports, <span class="built_in">read</span></span><br><span class="line">	http://openocd.org/doc/doxygen/bugs.html</span><br><span class="line">DEPRECATED! use <span class="string">'adapter driver'</span> not <span class="string">'interface'</span></span><br><span class="line">DEPRECATED! use <span class="string">'ftdi vid_pid'</span> not <span class="string">'ftdi_vid_pid'</span></span><br><span class="line">DEPRECATED! use <span class="string">'ftdi channel'</span> not <span class="string">'ftdi_channel'</span></span><br><span class="line">DEPRECATED! use <span class="string">'ftdi layout_init'</span> not <span class="string">'ftdi_layout_init'</span></span><br><span class="line">Info : auto-selecting first available session transport <span class="string">"jtag"</span>. To override use <span class="string">'transport select &lt;transport&gt;'</span>.</span><br><span class="line">DEPRECATED! use <span class="string">'adapter speed'</span> not <span class="string">'adapter_khz'</span></span><br><span class="line">fpga_program</span><br><span class="line">Warn : Transport <span class="string">"jtag"</span> was already selected</span><br><span class="line">Info : ftdi: <span class="keyword">if</span> you experience problems at higher adapter clocks, try the <span class="built_in">command</span> <span class="string">"ftdi tdo_sample_edge falling"</span></span><br><span class="line">Info : clock speed 25000 kHz</span><br><span class="line">Info : JTAG tap: xc7.tap tap/device found: 0x0362d093 (mfg: 0x049 (Xilinx), part: 0x362d, ver: 0x0)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="直接使用Litex-Boards脚本编译"><a href="#直接使用Litex-Boards脚本编译" class="headerlink" title="直接使用Litex-Boards脚本编译"></a>直接使用<code>Litex-Boards</code>脚本编译</h2><ul>
<li>前面运行<code>litex_setup.py --install --user</code>时,它就会在当前目录下,同步<code>https://github.com/litex-hub/litex-boards</code>的源码<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cd</span> litex-boards/litex-boards</span><br><span class="line"></span><br><span class="line">~$ ./targets/digilent_arty.py --cpu-type vexriscv --with-spi-flash --with-sdcard --with-ethernet --with-pmod-gpio --sdcard-adapter=numato --build</span><br><span class="line"></span><br><span class="line">[....]</span><br><span class="line">===================================</span><br><span class="line">Configuration Memory information</span><br><span class="line">===================================</span><br><span class="line">File Format        BIN</span><br><span class="line">Interface          SPIX4</span><br><span class="line">Size               16M</span><br><span class="line">Start Address      0x00000000</span><br><span class="line">End Address        0x00FFFFFF</span><br><span class="line"></span><br><span class="line">Addr1         Addr2         Date                    File(s)</span><br><span class="line">0x00000000    0x0021728B    Nov 21 23:17:41 2021    digilent_arty.bit</span><br><span class="line">0 Infos, 0 Warnings, 0 Critical Warnings and 0 Errors encountered.</span><br><span class="line">write_cfgmem completed successfully</span><br><span class="line"><span class="comment"># quit</span></span><br><span class="line">INFO: [Common 17-206] Exiting Vivado at Sun Nov 21 23:17:42 2021...</span><br><span class="line"></span><br><span class="line">~$ ./targets/digilent_arty.py --cpu-type vexriscv --sys-clk-freq 100e6 --with-ethernet   --with-sdcard --load</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="编译错误"><a href="#编译错误" class="headerlink" title="编译错误"></a>编译错误</h3><ul>
<li>下面提示: <code>FPGA</code>的逻辑容量不够大,因为这里使用了<code>--cpu-count=16</code>命令参数,使用默认或者<code>--cpu-count=1</code>就会无错.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[....]</span><br><span class="line">WARNING: [DRC RPBF-3] IO port buffering is incomplete: Device port i2c0_scl expects both input and output buffering but the buffers are incomplete.</span><br><span class="line">INFO: [Vivado_Tcl 4-198] DRC finished with 7 Errors, 1 Warnings</span><br><span class="line">ERROR: [Vivado_Tcl 4-23] Error(s) found during DRC. Placer not run.</span><br><span class="line">INFO: [Vivado_Tcl 4-199] Please refer to the DRC report (report_drc) <span class="keyword">for</span> more information.</span><br><span class="line">INFO: [Common 17-83] Releasing license: Implementation</span><br><span class="line">9 Infos, 1 Warnings, 0 Critical Warnings and 8 Errors encountered.</span><br><span class="line">place_design failed</span><br><span class="line">place_design: Time (s): cpu = 00:01:00 ; elapsed = 00:00:17 . Memory (MB): peak = 4696.504 ; gain = 0.000 ; free physical = 17632 ; free virtual = 88828</span><br><span class="line">ERROR: [Common 17-39] <span class="string">'place_design'</span> failed due to earlier errors.</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="定制编译buildroot"><a href="#定制编译buildroot" class="headerlink" title="定制编译buildroot"></a>定制编译<code>buildroot</code></h2><ul>
<li>这里其实只下载<code>buildroot</code>的官方源码,指定<code>linux-on-litex-vexriscv/buildroot</code>内的配置文件,就可以一键编译完成,因为这里当时编译时有一个小错误,这里改了使用了<code>git://github.com/litex-hub/linux.git</code>另一个<code>commit(版本): a2a2a69d144d66e0c36697da062b3949e3c2c870</code>,它是<code>Linux 5.15</code>的版本.这里几乎不需要修改,使用默认的配置就能编译出一个可用的<code>kernel</code>与<code>rootfs</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> http://github.com/buildroot/buildroot</span><br><span class="line">~$ <span class="built_in">cd</span> buildroot</span><br><span class="line">~$ make BR2_EXTERNAL=../linux-on-litex-vexriscv/buildroot/ litex_vexriscv_defconfig</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">~$ buildroot$ tree  output/images</span><br><span class="line">output/images</span><br><span class="line">├── Image</span><br><span class="line">├── rootfs.cpio</span><br><span class="line">└── rootfs.tar</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>BuildRoot</code>里的<code>Linux</code>几个关键配置如下:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ cat .config</span><br><span class="line">[...]</span><br><span class="line">BR2_LINUX_KERNEL_CUSTOM_REPO_VERSION=<span class="string">"a2a2a69d144d66e0c36697da062b3949e3c2c870"</span></span><br><span class="line">BR2_LINUX_KERNEL_VERSION=<span class="string">"a2a2a69d144d66e0c36697da062b3949e3c2c870"</span></span><br><span class="line">BR2_LINUX_KERNEL_CUSTOM_CONFIG_FILE=<span class="string">"<span class="variable">$(BR2_EXTERNAL_LITEX_VEXRISCV_PATH)</span>/board/litex_vexriscv/linux.config"</span></span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
</li>
<li><p>单独配置编译内核</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">buildroot$ <span class="built_in">cd</span> dl/linux/git/</span><br><span class="line">~$ ARCH=riscv CROSS_COMPILE=riscv64-unknown-elf- make menuconfig</span><br><span class="line">~$ ARCH=riscv CROSS_COMPILE=riscv64-unknown-elf- make -j10</span><br></pre></td></tr></table></figure>
</li>
<li><p>把<code>buildroot/output/images</code>里的<code>Image,rootfs.cpio</code>复制到<code>linux-on-litex-vexriscv/images</code>替换同名的文件.再加载到板上运行如下:</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Starting network: OK</span><br><span class="line"></span><br><span class="line">Welcome to Buildroot</span><br><span class="line">buildroot login: root</span><br><span class="line">                   __   _</span><br><span class="line">                  / /  (_)__  __ ____ __</span><br><span class="line">                 / /__/ / _ \/ // /\ \ /</span><br><span class="line">                /____/_/_//_/\_,_//_\_\</span><br><span class="line">                      / _ \/ _ \</span><br><span class="line">   __   _ __      _  _\___/_//_/         ___  _</span><br><span class="line">  / /  (_) /____ | |/_/__| | / /____ __ / _ \(_)__ _____  __</span><br><span class="line"> / /__/ / __/ -_)&gt;  &lt;/___/ |/ / -_) \ // , _/ (_-&lt;/ __/ |/ /</span><br><span class="line">/____/_/\__/\__/_/|_|____|___/\__/_\_\/_/|_/_/___/\__/|___/</span><br><span class="line">                  / __/  |/  / _ \</span><br><span class="line">                 _\ \/ /|_/ / ___/</span><br><span class="line">                /___/_/  /_/_/</span><br><span class="line">  32-bit RISC-V Linux running on LiteX / VexRiscv-SMP.</span><br><span class="line"></span><br><span class="line">login[69]: root login on <span class="string">'console'</span></span><br><span class="line">root@buildroot:~<span class="comment"># uname -a</span></span><br><span class="line">Linux buildroot 5.15.0 <span class="comment">#1 SMP Sun Nov 7 10:44:48 CST 2021 riscv32 GNU/Linux</span></span><br></pre></td></tr></table></figure>
<h1 id="运行64位Linux"><a href="#运行64位Linux" class="headerlink" title="运行64位Linux"></a>运行64位Linux</h1><ul>
<li><a href="https://github.com/westerndigitalcorporation/RISC-V-Linux" target="_blank" rel="noopener">RISC-V-Linux</a></li>
<li><a href="https://github.com/litex-hub/linux-on-litex-rocket" target="_blank" rel="noopener">litex-hub/linux-on-litex-rocket</a></li>
<li><code>Rocket Core</code>是一款处理器的核,它最大的特点是:使用<code>Chisel(Constructing Hardware in an ScalaEmbedded Language)</code>语言进行开发的.而<code>Rocket-Chip</code>是<code>SoC</code>生成器.</li>
</ul>
<h2 id="BOOM-Core"><a href="#BOOM-Core" class="headerlink" title="BOOM Core"></a><code>BOOM Core</code></h2><ul>
<li><a href="https://boom-core.org/" target="_blank" rel="noopener">RISC-V BOOM</a></li>
<li><a href="https://github.com/riscv-boom/riscv-boom" target="_blank" rel="noopener">riscv-boom/riscv-boom</a></li>
<li><code>BOOM Core</code>的全称是<code>Berkeley Out-of-Order Machine</code>,与<code>Rocket Core</code>不同的是,<code>BOOM Core</code>面向更高性能的目标,是一款超标量乱序发射,乱序执行的处理器核.</li>
</ul>
<h2 id="LowRISC-SOC"><a href="#LowRISC-SOC" class="headerlink" title="LowRISC SOC"></a><code>LowRISC SOC</code></h2><ul>
<li><a href="https://lowrisc.org/docs/" target="_blank" rel="noopener">LowRISC</a></li>
<li><a href="https://github.com/lowrisc" target="_blank" rel="noopener">https://github.com/lowrisc</a></li>
</ul>
<h2 id="编译-1"><a href="#编译-1" class="headerlink" title="编译"></a>编译</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ litex-boards/litex_boards/targets/digilent_arty.py --build --cpu-type rocket --cpu-variant linux4 --sys-clk-freq 50e6    --with-ethernet --with-sdcard --uart_name=usb_acm</span><br></pre></td></tr></table></figure>
<h1 id="Microblaze"><a href="#Microblaze" class="headerlink" title="Microblaze"></a>Microblaze</h1><ul>
<li><a href="https://www.hackster.io/whitney-knitter/hello-microblaze-on-arty-a7-70d9e1" target="_blank" rel="noopener">Hello MicroBlaze on Arty-A7</a></li>
<li><a href="https://digilent.com/reference/learn/programmable-logic/tutorials/arty-getting-started-with-microblaze/start" target="_blank" rel="noopener">Arty - Getting Started with Microblaze</a></li>
</ul>
<h2 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h2><ul>
<li>打开<code>Vivado</code>点击<code>Create New Project</code>:<ul>
<li><code>Project Name</code>:设置名称与工程位置,下一步.</li>
<li><code>Project Type</code>:选择<code>RTL Project</code>,并勾上<code>Do not secify sources at this time</code>,下一步.</li>
<li><code>Default Part</code>:选择<code>Boards</code>,下拉<code>Name</code>选择对应的板子型号,如果列表内没有找到,先按<code>Refresh</code>从网上更新,再去列表内选择.这里是选择择了<code>Arty-A7 35T</code>的板子.</li>
<li><code>New Project Summary</code>:显示工程的摘要信息,按<code>Finish</code>,完成工程创建,显示如下的界面.<br><img src="/imgs/xilinx/vivado-project.png" alt="vivado-project.png"></li>
</ul>
</li>
</ul>
<h2 id="Create-Block-Design"><a href="#Create-Block-Design" class="headerlink" title="Create Block Design"></a>Create Block Design</h2><ul>
<li>从左边导航栏里<code>IP INTEGRATOR -&gt; Create Block Design</code>,改名为<code>system</code>, 如图:<br><img src="/imgs/xilinx/create_new_block_design.png" alt="create_new_block_design.png"></li>
<li>切换到<code>Board</code>的<code>tab 页</code>,会显示<code>Arty A7-35</code>的所支持硬件资源列表,这个列表的所有项,都是由该板子的<code>board file</code>定义的.右边<code>Diagram</code>,按提示: <code>This design is empty, Press the + button to add IP</code>,来添加一些必要的<code>IP核</code>.也可以从左边的树型栏,拖入控件.</li>
</ul>
<h3 id="配置System-Clock"><a href="#配置System-Clock" class="headerlink" title="配置System Clock."></a>配置<code>System Clock</code>.</h3><ul>
<li>从<code>Arty A7-35 -&gt; Clocks</code>,拖入<code>System Clock</code>到<code>Diagram</code>的画布内.</li>
<li>双击控件下方的<code>Clocking Wizard</code>,打开时钟配置界面.右边表格,切换到<code>Output Clocks</code>页面,修改如:<ul>
<li><code>clk_out1</code>:勾选上,<code>Requested,Actual</code>栏改成<code>166.667</code>.</li>
<li><code>clk_out2</code>:勾选上,<code>Requested,Actual</code>栏改成<code>200.00</code>.</li>
<li><code>Reset Type</code>:选择<code>Active Low</code>. 完成.</li>
</ul>
</li>
</ul>
<h3 id="配置DDR3-SDRAM"><a href="#配置DDR3-SDRAM" class="headerlink" title="配置DDR3 SDRAM."></a>配置<code>DDR3 SDRAM</code>.</h3><ul>
<li>从<code>Arty A7-35 -&gt; External Memery</code>,拖入<code>DDR3 SDRAM</code>到<code>Diagram</code>的画布内.<code>Vivado</code>会把两个控件,自动连接.</li>
<li>这里先要删除<code>clk_ref_i,sys_clk_i</code>两个默认自动连接,再用鼠标拖线连接端口,如下:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sys_clock           mig_7series</span><br><span class="line">clk_out1   &lt;----&gt;   sys_clk_i</span><br><span class="line">clk_out2   &lt;----&gt;   clk_ref_i</span><br></pre></td></tr></table></figure>
<p><img src="/imgs/xilinx/sdram_block_diagram.png" alt="sdram_block_diagram.png"></p>
<ul>
<li>点击<code>Diagram</code>里的高亮提示链接:<code>Run Connection Automation</code>. 勾选上顶层<code>All Automation</code>,<code>OK</code>完成.</li>
</ul>
<h3 id="添加Microblaze处理器与配置"><a href="#添加Microblaze处理器与配置" class="headerlink" title="添加Microblaze处理器与配置"></a>添加<code>Microblaze</code>处理器与配置</h3><ul>
<li>点击左边栏上方<code>IP Catalog</code>,会在右边<code>Diagram</code>在边上添加一个<code>IP Catalog</code>的新<code>TAB</code>页.在页内的<code>Search:</code>输入<code>Microblaze</code>.<br><img src="/imgs/xilinx/microblaze_ip_core.png" alt="microblaze_ip_core.png"></li>
<li>再双击<code>Microblaze</code>去<code>Add IP</code>,点击<code>Add IP to Block Design</code>, 它就加入到设计页面里.再点击<code>Run Block Automaction</code>,就弹出一个配置界面,如下<br><img src="/imgs/xilinx/microblaze_ip_config.png" alt="microblaze_ip_config.png"></li>
<li>确保配置参数如上图所示,尤其是<code>Clock Connection</code>必须连接到<code>/mig_7series_0/ui_clk</code>上.<code>OK</code>完成后,先不进行<code>Run Connection Automation</code>.</li>
</ul>
<h3 id="添加外设-Peripheral"><a href="#添加外设-Peripheral" class="headerlink" title="添加外设(Peripheral)"></a>添加外设(Peripheral)</h3><ul>
<li>从<code>Arty A7-35 -&gt; UART</code>,拖入<code>USB UART</code>到<code>Diagram</code>的画布内.</li>
<li>点击<code>Run Connection Automation</code>,勾选顶层<code>All Automation</code>,<code>OK</code>完成.</li>
<li><code>Diagram</code>上,点击右键菜单<code>Regenerate Layout</code>. 最终布局如下:<br><img src="/imgs/xilinx/microblaze_layout.png" alt="microblaze_layout.png"></li>
</ul>
<h3 id="校验设计-添加HDL-Wrapper"><a href="#校验设计-添加HDL-Wrapper" class="headerlink" title="校验设计,添加HDL Wrapper"></a>校验设计,添加<code>HDL Wrapper</code></h3><ul>
<li>点击<code>Tools -&gt; Validate Design (F6)</code>,它检验出设计或连接错误.</li>
<li>检验完成后无报错,打开<code>Sources</code>页,<code>Design Sources -&gt; system(systemd.bd_)</code>右键菜单,选择<code>Create HDL Wrapper...</code>,再选<code>Let Vivado manage wrapper and auto-update</code>,<code>OK</code>完成.</li>
</ul>
<h3 id="生成Bitstream文件"><a href="#生成Bitstream文件" class="headerlink" title="生成Bitstream文件"></a>生成<code>Bitstream</code>文件</h3><ul>
<li>点击左边导航栏,<code>PROGRAM AND DEBUG -&gt; Generate Bitstream</code>, 会出现<code>Launch Runs</code>对话框,配置编译项的,这里直接<code>OK</code>完成.这个过程的时间,会根据电脑系统的性能,以及工程设计文件的大小所决定的.在<code>Vivado</code>最左上角会有<code>Running xxxxxxxxx Cancel</code>进程条与<code>Cancel</code>链接.完成后,如下:<br><img src="/imgs/xilinx/microblaze_bitstream_done.png" alt="microblaze_bitstream_done.png"></li>
<li>因为这里不需要做任何修改,就直接<code>Cancel</code>完成.</li>
</ul>
<h3 id="导出HDL到SDK"><a href="#导出HDL到SDK" class="headerlink" title="导出HDL到SDK"></a>导出<code>HDL</code>到<code>SDK</code></h3><ul>
<li><code>File -&gt; Export -&gt; Export Hardware</code>, <code>Output</code>选项,选择<code>Include bitstream</code>,下一步,可以修改<code>XSA</code>文件名,以及<code>Export to</code>的具体路径目录.完成后,会在导出的目录下,看到一个类似<code>system_wrapper.xsa</code>的文件.</li>
</ul>
<h2 id="创建应用工程（Vitis-IDE"><a href="#创建应用工程（Vitis-IDE" class="headerlink" title="创建应用工程（Vitis IDE)"></a>创建应用工程（Vitis IDE)</h2><h3 id="创建平台工程"><a href="#创建平台工程" class="headerlink" title="创建平台工程"></a>创建平台工程</h3><ul>
<li>这里可以从<code>Vivado-&gt; Tools-&gt; Launch Vitis IDE</code>运行它,<code>Vitis IDE</code>看它的界面,与大多数的厂商IDE差不多,都是基于<code>Java Eclipse</code>开发的.</li>
<li>打开<code>Vitis IDE-&gt; File-&gt; New-&gt; Platform Project</code>.<ul>
<li><code>Platform Project Name</code>:在<code>Platform project name:</code>输入<code>hello_microblaze_platform</code>.</li>
<li><code>Platform</code>:这里默认选择<code>Create a new platform hardware (XSA)</code>,通过<code>Browse</code>选择前面导出的硬件文件:<code>system_wrapper.xsa</code>. 完成.<br><img src="/imgs/xilinx/microblaze_app_create.png" alt="microblaze_app_create.png"></li>
</ul>
</li>
</ul>
<h3 id="创建应用工程"><a href="#创建应用工程" class="headerlink" title="创建应用工程"></a>创建应用工程</h3><ul>
<li>上面已经创建好平台工程（platform）,再创建一个应用工程<code>File -&gt; New -&gt; Application Project</code>:<ul>
<li><code>Welcome</code>:第一页,直接点下一步.</li>
<li><code>Platform</code>:默认已经选择<code>Select a platform from repository</code>页,并且选择高亮了<code>hello_microblaze_platform</code>,下一步.</li>
<li><code>Application Project Details</code>:输入项目名称:<code>hello_microblaze_app</code>.</li>
<li><code>Domain</code>:默认就是<code>standalone_domain</code>,下一步.</li>
<li><code>Templates</code>:这里会有一个模版的列表,这里就选择<code>Hello World</code>的模版,完成.</li>
</ul>
</li>
<li>最终工程文件结构如下图<br><img src="/imgs/xilinx/microblaze_apps_done.png" alt="microblaze_apps_done.png"></li>
</ul>
<h4 id="烧写设备"><a href="#烧写设备" class="headerlink" title="烧写设备"></a>烧写设备</h4><ul>
<li>打开<code>Xilinx-&gt; Program Device</code>对话框, 这里都是默认配置,连接<code>Arty A7-35</code>到电脑,直接点<code>Program</code>.下方的<code>Console</code>会有如下日志:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">updatemem -force -meminfo \</span><br><span class="line">/home/michael/workspace-xilinx/Project-ROOT/hello_microblaze_app/_ide/bitstream/system_wrapper.mmi \</span><br><span class="line">-bit \</span><br><span class="line">/home/michael/workspace-xilinx/Project-ROOT/hello_microblaze_app/_ide/bitstream/system_wrapper.bit \</span><br><span class="line">-data \</span><br><span class="line">/Xilinx-Installed-ROOT/Xilinx/Vitis/2021.1/data/embeddedsw/lib/microblaze/mb_bootloop_le.elf \</span><br><span class="line">-proc system_i/microblaze_0 -out \</span><br><span class="line">/home/michael/workspace-xilinx/Project-ROOT/hello_microblaze_app/_ide/bitstream/download.bit</span><br><span class="line"></span><br><span class="line">****** updatemem v2021.1 (64-bit)</span><br><span class="line">  **** SW Build 3247384 on Thu Jun 10 19:36:07 MDT 2021</span><br><span class="line">    ** Copyright 1986-2021 Xilinx, Inc. All Rights Reserved.</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /Xilinx-Installed-ROOT/Xilinx/Vitis/2021.1/scripts/updatemem/main.tcl -notrace</span><br><span class="line">Command: update_mem -meminfo /home/michael/workspace-xilinx/Project-ROOT/hello_microblaze_app/_ide/bitstream/system_wrapper.mmi -data /Xilinx-Installed-ROOT/Xilinx/Vitis/2021.1/data/embeddedsw/lib/microblaze/mb_bootloop_le.elf -proc system_i/microblaze_0 -bit /home/michael/workspace-xilinx/Project-ROOT/hello_microblaze_app/_ide/bitstream/system_wrapper.bit -out /home/michael/workspace-xilinx/Project-ROOT/hello_microblaze_app/_ide/bitstream/download.bit -force</span><br><span class="line">Loading bitfile /home/michael/workspace-xilinx/Project-ROOT/hello_microblaze_app/_ide/bitstream/system_wrapper.bit</span><br><span class="line">Loading data files...</span><br><span class="line">Updating memory content...</span><br><span class="line">Creating bitstream...</span><br><span class="line">Writing bitstream /home/michael/workspace-xilinx/Project-ROOT/hello_microblaze_app/_ide/bitstream/download.bit...</span><br><span class="line">0 Infos, 0 Warnings, 0 Critical Warnings and 0 Errors encountered.</span><br><span class="line">update_mem completed successfully</span><br><span class="line">update_mem: Time (s): cpu = 00:00:07 ; elapsed = 00:00:06 . Memory (MB): peak = 2143.617 ; gain = 873.242 ; free physical = 17872 ; free virtual = 88610</span><br><span class="line">INFO: [Common 17-206] Exiting updatemem at Sun Oct 17 00:19:15 2021...</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="编译及运行工程"><a href="#编译及运行工程" class="headerlink" title="编译及运行工程"></a>编译及运行工程</h4><ul>
<li>先点<code>Explorer -&gt; hello_microblaze_app</code>,右键<code>Build Project</code>,编译工程.</li>
<li>再点<code>Explorer -&gt; hello_microblaze_app</code>,右键<code>Run As -&gt; Launch Hardware (Single Application Debug)</code>.</li>
<li>现在可以连接到本机的<code>UART</code>串口去观看,板子的输出. 可以在IDE下方<code>Vitis Serial Terminal</code>页里,按<strong>+</strong>图标,添加一个串端配置.配置如:<code>/dev/ttyUSB1, 9600, 0, 8</code>.</li>
</ul>
<h1 id="谢谢支持"><a href="#谢谢支持" class="headerlink" title="谢谢支持"></a>谢谢支持</h1><ul>
<li>微信二维码:</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/FPGA-RISC-V-Linux/" rel="tag"># FPGA,RISC-V,Linux</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/05/24/OSX开发记录/" rel="prev" title="OSX开发记录">
      <i class="fa fa-chevron-left"></i> OSX开发记录
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/12/06/XILINX-PYNQ-Z1-XC7Z020实践指南-md/" rel="next" title="XILINX-PYNQ-Z1-XC7Z020实践指南.md">
      XILINX-PYNQ-Z1-XC7Z020实践指南.md <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Vivado安装"><span class="nav-number">2.</span> <span class="nav-text">Vivado安装</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RISC-V"><span class="nav-number">3.</span> <span class="nav-text">RISC-V</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#开源工具"><span class="nav-number">4.</span> <span class="nav-text">开源工具</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Chisel-FIRRTL硬件编译框架"><span class="nav-number">4.1.</span> <span class="nav-text">Chisel/FIRRTL硬件编译框架</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LiteX框架"><span class="nav-number">4.2.</span> <span class="nav-text">LiteX框架</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SymbiFlow"><span class="nav-number">4.3.</span> <span class="nav-text">SymbiFlow</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Xc3sprog"><span class="nav-number">4.4.</span> <span class="nav-text">Xc3sprog</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenSBI"><span class="nav-number">4.5.</span> <span class="nav-text">OpenSBI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LibreSOC"><span class="nav-number">4.6.</span> <span class="nav-text">LibreSOC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#自编译工具链-riscv64-unknown-elf-gcc"><span class="nav-number">4.6.1.</span> <span class="nav-text">自编译工具链(riscv64-unknown-elf-gcc)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SiFive-Freedom"><span class="nav-number">5.</span> <span class="nav-text">SiFive Freedom</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#下载开源工具链"><span class="nav-number">5.1.</span> <span class="nav-text">下载开源工具链</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编译Freedom"><span class="nav-number">5.2.</span> <span class="nav-text">编译Freedom</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#烧写FPGA的mcs镜像"><span class="nav-number">5.3.</span> <span class="nav-text">烧写FPGA的mcs镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Freedom-E-SDK（应用软件）示例"><span class="nav-number">5.4.</span> <span class="nav-text">Freedom-E-SDK（应用软件）示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用QEMU模拟运行"><span class="nav-number">5.5.</span> <span class="nav-text">使用QEMU模拟运行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Arduino环境测试开发"><span class="nav-number">5.6.</span> <span class="nav-text">Arduino环境测试开发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Blink测试"><span class="nav-number">5.6.1.</span> <span class="nav-text">Blink测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Hex-Five"><span class="nav-number">6.</span> <span class="nav-text">Hex Five</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#编译"><span class="nav-number">6.1.</span> <span class="nav-text">编译</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#烧写到QSPI-Flash"><span class="nav-number">6.2.</span> <span class="nav-text">烧写到QSPI Flash</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenOCD"><span class="nav-number">6.3.</span> <span class="nav-text">OpenOCD</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#VexRiscv"><span class="nav-number">7.</span> <span class="nav-text">VexRiscv</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#linux-on-litex-vexriscv"><span class="nav-number">7.1.</span> <span class="nav-text">linux-on-litex-vexriscv</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装LiteX-Migen及工具"><span class="nav-number">7.2.</span> <span class="nav-text">安装LiteX/Migen及工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常用命令"><span class="nav-number">7.2.1.</span> <span class="nav-text">常用命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Litex-Buildenv"><span class="nav-number">7.3.</span> <span class="nav-text">Litex-Buildenv</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Litex-VexRiscv"><span class="nav-number">7.4.</span> <span class="nav-text">Litex-VexRiscv</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#模拟器运行"><span class="nav-number">7.4.1.</span> <span class="nav-text">模拟器运行</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#板上运行"><span class="nav-number">7.5.</span> <span class="nav-text">板上运行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#编译FPGA-bitstream"><span class="nav-number">7.5.1.</span> <span class="nav-text">编译FPGA bitstream</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用OpenOCD加载"><span class="nav-number">7.5.2.</span> <span class="nav-text">使用OpenOCD加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#加载运行Linux系统"><span class="nav-number">7.5.3.</span> <span class="nav-text">加载运行Linux系统</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#直接使用Litex-Boards脚本编译"><span class="nav-number">7.6.</span> <span class="nav-text">直接使用Litex-Boards脚本编译</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#编译错误"><span class="nav-number">7.6.1.</span> <span class="nav-text">编译错误</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#定制编译buildroot"><span class="nav-number">7.7.</span> <span class="nav-text">定制编译buildroot</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#运行64位Linux"><span class="nav-number">8.</span> <span class="nav-text">运行64位Linux</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#BOOM-Core"><span class="nav-number">8.1.</span> <span class="nav-text">BOOM Core</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LowRISC-SOC"><span class="nav-number">8.2.</span> <span class="nav-text">LowRISC SOC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编译-1"><span class="nav-number">8.3.</span> <span class="nav-text">编译</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Microblaze"><span class="nav-number">9.</span> <span class="nav-text">Microblaze</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建工程"><span class="nav-number">9.1.</span> <span class="nav-text">创建工程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-Block-Design"><span class="nav-number">9.2.</span> <span class="nav-text">Create Block Design</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置System-Clock"><span class="nav-number">9.2.1.</span> <span class="nav-text">配置System Clock.</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置DDR3-SDRAM"><span class="nav-number">9.2.2.</span> <span class="nav-text">配置DDR3 SDRAM.</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加Microblaze处理器与配置"><span class="nav-number">9.2.3.</span> <span class="nav-text">添加Microblaze处理器与配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加外设-Peripheral"><span class="nav-number">9.2.4.</span> <span class="nav-text">添加外设(Peripheral)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#校验设计-添加HDL-Wrapper"><span class="nav-number">9.2.5.</span> <span class="nav-text">校验设计,添加HDL Wrapper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#生成Bitstream文件"><span class="nav-number">9.2.6.</span> <span class="nav-text">生成Bitstream文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导出HDL到SDK"><span class="nav-number">9.2.7.</span> <span class="nav-text">导出HDL到SDK</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建应用工程（Vitis-IDE"><span class="nav-number">9.3.</span> <span class="nav-text">创建应用工程（Vitis IDE)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建平台工程"><span class="nav-number">9.3.1.</span> <span class="nav-text">创建平台工程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建应用工程"><span class="nav-number">9.3.2.</span> <span class="nav-text">创建应用工程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#烧写设备"><span class="nav-number">9.3.2.1.</span> <span class="nav-text">烧写设备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编译及运行工程"><span class="nav-number">9.3.2.2.</span> <span class="nav-text">编译及运行工程</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#谢谢支持"><span class="nav-number">10.</span> <span class="nav-text">谢谢支持</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">yjdwbj</p>
  <div class="site-description" itemprop="description">最是人间留不住,朱颜辞镜花辞树</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yjdwbj</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>

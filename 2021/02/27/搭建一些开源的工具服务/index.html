<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="DoH服务 链接： dnscrypt-proxy Installation on Debian and Ubuntu Local-DoH DNS服务器列表   使用DoH(Dns Over HTTPS)服务,可以处理一部分网站不可访问的问题。  1~$ apt-get install dnscrypt-proxy -y  Open the file/etc/dnscrypt-proxy/dnscr">
<meta name="keywords" content="Cloud, Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="搭建一些开源的工具服务">
<meta property="og:url" content="http://yoursite.com/2021/02/27/搭建一些开源的工具服务/index.html">
<meta property="og:site_name" content="Sunrise 博客">
<meta property="og:description" content="DoH服务 链接： dnscrypt-proxy Installation on Debian and Ubuntu Local-DoH DNS服务器列表   使用DoH(Dns Over HTTPS)服务,可以处理一部分网站不可访问的问题。  1~$ apt-get install dnscrypt-proxy -y  Open the file/etc/dnscrypt-proxy/dnscr">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/imgs/mm_reward_qrcode_1525013906055.png">
<meta property="og:updated_time" content="2022-12-17T07:24:34.259Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="搭建一些开源的工具服务">
<meta name="twitter:description" content="DoH服务 链接： dnscrypt-proxy Installation on Debian and Ubuntu Local-DoH DNS服务器列表   使用DoH(Dns Over HTTPS)服务,可以处理一部分网站不可访问的问题。  1~$ apt-get install dnscrypt-proxy -y  Open the file/etc/dnscrypt-proxy/dnscr">
<meta name="twitter:image" content="http://yoursite.com/imgs/mm_reward_qrcode_1525013906055.png">

<link rel="canonical" href="http://yoursite.com/2021/02/27/搭建一些开源的工具服务/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>搭建一些开源的工具服务 | Sunrise 博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sunrise 博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/27/搭建一些开源的工具服务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="最是人间留不住,朱颜辞镜花辞树">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          搭建一些开源的工具服务
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-27 12:30:25" itemprop="dateCreated datePublished" datetime="2021-02-27T12:30:25+08:00">2021-02-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-17 15:24:34" itemprop="dateModified" datetime="2022-12-17T15:24:34+08:00">2022-12-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="DoH服务"><a href="#DoH服务" class="headerlink" title="DoH服务"></a>DoH服务</h1><ul>
<li>链接：<ul>
<li><a href="https://github.com/DNSCrypt/dnscrypt-proxy" target="_blank" rel="noopener">dnscrypt-proxy</a></li>
<li><a href="https://github.com/dnscrypt/dnscrypt-proxy/wiki/Installation-on-Debian-and-Ubuntu" target="_blank" rel="noopener">Installation on Debian and Ubuntu</a></li>
<li><a href="https://github.com/DNSCrypt/dnscrypt-proxy/wiki/Local-DoH" target="_blank" rel="noopener">Local-DoH</a></li>
<li><a href="https://github.com/DNSCrypt/dnscrypt-resolvers" target="_blank" rel="noopener">DNS服务器列表</a></li>
</ul>
</li>
<li>使用<code>DoH(Dns Over HTTPS)</code>服务,可以处理一部分网站不可访问的问题。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ apt-get install dnscrypt-proxy -y</span><br></pre></td></tr></table></figure>
<ul>
<li>Open the file<code>/etc/dnscrypt-proxy/dnscrypt-proxy.toml</code>in your favorite editor. Find the general section and change the <code>server_names</code>variable.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server_names = [<span class="string">'cloudflare'</span>]</span><br></pre></td></tr></table></figure>
<ul>
<li>And change the <code>nameserver</code> inside <code>/etc/resolv.conf</code>.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /etc/resolv.conf</span><br><span class="line"><span class="comment"># Generated by dhcpcd</span></span><br><span class="line">nameserver 127.0.0.1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="NextCloud"><a href="#NextCloud" class="headerlink" title="NextCloud"></a>NextCloud</h1><ul>
<li><p>简介</p>
<ul>
<li>Nextcloud offers the industry-leading, on-premises content collaboration platform.<br>Our technology combines the convenience and ease of use of consumer-grade solutions<br>like Dropbox and Google Drive with the security, privacy and control business needs.</li>
</ul>
</li>
<li><p>链接:</p>
<ul>
<li><a href="https://nextcloud.com/" target="_blank" rel="noopener">nextcloud</a></li>
<li><a href="https://github.com/nextcloud" target="_blank" rel="noopener">github</a></li>
<li><a href="https://hub.docker.com/_/nextcloud" target="_blank" rel="noopener">hub.docker</a></li>
<li><a href="https://help.nextcloud.com/t/howto-ubuntu-docker-nextcloud-talk-collabora/76430" target="_blank" rel="noopener">HowTo: Ubuntu + Docker + Nextcloud + Talk + Collabora</a></li>
<li><a href="https://itnext.io/nextcloud-docker-raspberry-pi-onion-service-84d4af13f7e6" target="_blank" rel="noopener">Nextcloud + Raspberry Pi + Docker + Onion service = </a></li>
<li><a href="https://github.com/gfodor/p2pcf" target="_blank" rel="noopener">p2pcf</a></li>
</ul>
</li>
</ul>
<h2 id="Docker-compose搭建nextcloud-collabora-code-无HTTPS"><a href="#Docker-compose搭建nextcloud-collabora-code-无HTTPS" class="headerlink" title="Docker-compose搭建nextcloud+collabora/code(无HTTPS)"></a><code>Docker-compose</code>搭建<code>nextcloud+collabora/code</code>(无HTTPS)</h2><ul>
<li><a href="https://sdk.collaboraonline.com/docs/installation/CODE_Docker_image.html" target="_blank" rel="noopener">CODE Docker image</a></li>
<li><p><a href="https://prod.releasehub.com/blog/6-docker-compose-best-practices-for-dev-and-prod" target="_blank" rel="noopener">6 Docker Compose Best Practices for Dev and Prod</a></p>
</li>
<li><p>目录结构</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">nextcloud$ tree -L 2</span><br><span class="line">.</span><br><span class="line">├── db-data [error opening dir]</span><br><span class="line">├── docker-compose.yml</span><br><span class="line">└── volumes</span><br><span class="line">    ├── config</span><br><span class="line">    ├── custom_apps</span><br><span class="line">    ├── data</span><br><span class="line">    ├── html</span><br><span class="line">    └── theme</span><br><span class="line"></span><br><span class="line">7 directories, 1 file</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>docker-compose.yml</code></p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">nextcloud$ cat docker-compose.yml</span><br><span class="line">version: <span class="string">"3"</span></span><br><span class="line">services:</span><br><span class="line">  pg11:</span><br><span class="line">    image: postgres:11-alpine</span><br><span class="line">    environment:</span><br><span class="line">      POSTGRES_DB: <span class="variable">$&#123;DB_NAME&#125;</span></span><br><span class="line">      POSTGRES_PASSWORD: <span class="variable">$&#123;DB_PASS&#125;</span></span><br><span class="line">      POSTGRES_USER: <span class="variable">$&#123;DB_USER&#125;</span></span><br><span class="line">    logging:</span><br><span class="line">      driver: <span class="string">"none"</span></span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    volumes:</span><br><span class="line">      - ./db-data:/var/lib/postgresql/data</span><br><span class="line">    env_file:</span><br><span class="line">      - ./.env</span><br><span class="line"></span><br><span class="line">  collabora:</span><br><span class="line">    image: collabora/code:latest</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - username=<span class="variable">$&#123;ADM_USER&#125;</span></span><br><span class="line">      - password=<span class="variable">$&#123;ADM_PASS&#125;</span></span><br><span class="line">      <span class="comment"># 注意下面这一行参数很重要.</span></span><br><span class="line">      - <span class="string">"extra_params=--o:ssl.enable=false --o:net.post_allow.host=192.168.1.100 --o:storage.wopi.host=192.168.1.100 --o:ssl.termination=false"</span></span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">"9080:9980"</span></span><br><span class="line">    cap_add:</span><br><span class="line">      - MKNOD</span><br><span class="line">    env_file:</span><br><span class="line">      - ./.env</span><br><span class="line">    volumes:</span><br><span class="line">      - /etc/hosts:/etc/hosts:ro</span><br><span class="line"></span><br><span class="line">  nextcloud:</span><br><span class="line">    image: nextcloud</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    depends_on:</span><br><span class="line">      - pg11</span><br><span class="line">    cap_add:</span><br><span class="line">      - MKNOD</span><br><span class="line">      - ALL</span><br><span class="line">    volumes:</span><br><span class="line">      - ./volumes/html:/var/www/html</span><br><span class="line">      - ./volumes/config:/var/www/html/config</span><br><span class="line">      - ./volumes/custom_apps:/var/www/html/custom_apps</span><br><span class="line">      - ./volumes/data:/var/www/html/data</span><br><span class="line">      - ./volumes/theme:/var/www/html/themes</span><br><span class="line">      - /etc/localtime:/etc/localtime:ro</span><br><span class="line">      - /etc/hosts:/etc/hosts:ro</span><br><span class="line">    ports:</span><br><span class="line">      - 8080:80</span><br></pre></td></tr></table></figure>
<ul>
<li>如果安装<code>nextcloud</code>是没有开启<code>HTTPS</code>访问的,就无法在<code>http://cloud.domain.im/settings/apps</code>页面里显示可安装的插件列表.这里也可以自己手动从<code>https://apps.nextcloud.com</code>下载插件包,手动解压到<code>nextcloud/html/apps</code>里,再启用它,就可以像是在线安装的那样使用了.并且如上面所示,需要在本机的<code>/etc/hosts</code>内加入一条如：<code>192.168.1.100 cloud.domain.im</code>这样的记录,并且把它挂载到容器中去,这样可以使用域名来测试,用域名来生成安全证书.</li>
</ul>
<ul>
<li><p>安装<code>Collabora Online</code>服务器功能</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ wget -c https://github.com/nextcloud-releases/richdocuments/releases/download/v5.0.3/richdocuments-v5.0.3.tar.gz</span><br><span class="line">~$ wget -c https://github.com/CollaboraOnline/richdocumentscode/releases/download/21.11.306/richdocumentscode.tar.gz</span><br><span class="line">~$ <span class="built_in">cd</span> volumes/html/apps</span><br><span class="line">~$ tar xvf *.gz &amp;&amp; sudo chown www-data:www-data -R richdocuments richdocumentscode</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置<code>Collabora Online</code>服务器的<code>URL</code>.</p>
<ul>
<li>打开<code>http://cloud.domain.im:8080/settings/admin/richdocuments</code>页,选择<code>Use your own server</code>,这里填入<code>http:://cloud.domain.im:9080</code>后,按<code>Save</code>保存配置,如果上面的状态显示绿色的钩,并且显示<code>Collabora Online server is reachable.</code>表示已经连接到服务器了.</li>
</ul>
</li>
<li><p>现在进去到网盘目录里,如果能打开<code>docx,odt</code>这样的文件,表示安装成功,<code>Collaboar Online</code></p>
</li>
<li>打开<code>http://cloud.domain.im:9080/browser/dist/admin/admin.html</code>会有服务器相关的管理监控信息.网盘里当前被<code>Collabora Online</code>打开编辑文件,也会显示在<code>Documents open</code>的列表内.</li>
</ul>
<h2 id="Self-Signed-HTTPS版本"><a href="#Self-Signed-HTTPS版本" class="headerlink" title="Self-Signed HTTPS版本"></a><code>Self-Signed HTTPS</code>版本</h2><ul>
<li><p><a href="https://sdk.collaboraonline.com/docs/installation/Proxy_settings.html" target="_blank" rel="noopener">Proxy settings</a></p>
</li>
<li><p>整个工程目录结构如下：</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">nextcloud$ tree -L 2</span><br><span class="line">.</span><br><span class="line">├── collabora</span><br><span class="line">│   └── coolwsd.xml</span><br><span class="line">├── create_self-sign-tls.sh</span><br><span class="line">├── db-data [error opening dir]</span><br><span class="line">├── docker-compose.yml</span><br><span class="line">├── nginx</span><br><span class="line">│   ├── certs</span><br><span class="line">│   ├── nginx.conf</span><br><span class="line">│   ├── sites-enabled</span><br><span class="line">│   └── ssl</span><br><span class="line">└── volumes</span><br><span class="line">    ├── config</span><br><span class="line">    ├── custom_apps</span><br><span class="line">    ├── data</span><br><span class="line">    ├── html</span><br><span class="line">    └── theme</span><br><span class="line"></span><br><span class="line">12 directories, 4 files</span><br></pre></td></tr></table></figure>
<ul>
<li><code>nginx</code>挂载目录结构如下</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">nextcloud$ tree nginx/</span><br><span class="line">nginx/</span><br><span class="line">├── certs</span><br><span class="line">│   ├── cloud.domain.im.crt</span><br><span class="line">│   └── cloud.domain.im.key</span><br><span class="line">├── nginx.conf</span><br><span class="line">├── sites-enabled</span><br><span class="line">│   └── nextcloud.conf</span><br><span class="line">└── ssl</span><br><span class="line">    └── dhparam.pem</span><br><span class="line"></span><br><span class="line">3 directories, 5 files</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>nginx</code>全局主配置文件.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">nextcloud$ cat nginx/nginx.conf</span><br><span class="line">user  nginx;</span><br><span class="line">worker_processes  1;</span><br><span class="line">error_log /var/<span class="built_in">log</span>/nginx/error.log warn;</span><br><span class="line">pid /var/run/nginx.pid;</span><br><span class="line">events &#123;</span><br><span class="line">  worker_connections  2048;</span><br><span class="line">  multi_accept        on;</span><br><span class="line">&#125;</span><br><span class="line">error_log syslog:server=unix:/dev/<span class="built_in">log</span>,facility=local6,tag=nginx,severity=error;</span><br><span class="line">http &#123;</span><br><span class="line">  log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">    <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">    <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line">  access_log  /var/<span class="built_in">log</span>/nginx/access.log  main;</span><br><span class="line">  index index.html index.htm;</span><br><span class="line">  charset utf-8;</span><br><span class="line">  server_tokens off;</span><br><span class="line">  autoindex off;</span><br><span class="line">  client_max_body_size 512m;</span><br><span class="line">  include       mime.types;</span><br><span class="line">  default_type  application/octet-stream;</span><br><span class="line">  sendfile        on;</span><br><span class="line">  sendfile_max_chunk  51200k;</span><br><span class="line">  tcp_nopush   on;</span><br><span class="line">  tcp_nodelay  on;</span><br><span class="line">  open_file_cache           max=1000 inactive=20s;</span><br><span class="line">  open_file_cache_valid     30s;</span><br><span class="line">  open_file_cache_min_uses  2;</span><br><span class="line">  open_file_cache_errors    off;</span><br><span class="line">  ssl_protocols             TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">  ssl_session_tickets off;</span><br><span class="line">  ssl_session_cache         shared:SSL:50m;</span><br><span class="line">  ssl_session_timeout       10m;</span><br><span class="line">  ssl_stapling              off;</span><br><span class="line">  ssl_stapling_verify       off;</span><br><span class="line">  resolver                  8.8.8.8 8.8.4.4;  <span class="comment"># replace with `127.0.0.1` if you have a local dns server</span></span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  ssl_dhparam               ssl/dhparam.pem;  <span class="comment"># openssl dhparam -out ssl/dhparam.pem 4096</span></span><br><span class="line">  gzip               on;</span><br><span class="line">  gzip_disable       msie6;</span><br><span class="line">  gzip_vary          on;</span><br><span class="line">  gzip_proxied       any;</span><br><span class="line">  gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</span><br><span class="line">  include conf.d/*.conf;</span><br><span class="line">  include sites-enabled/*.conf;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>nextcloud</code>站点代理配置文件</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">nextcloud$ cat nginx/sites-enabled/nextcloud.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    listen [::]:443 ssl http2;</span><br><span class="line"></span><br><span class="line">    server_name cloud.domain.im;</span><br><span class="line"></span><br><span class="line">    client_max_body_size 0;</span><br><span class="line">    underscores_in_headers on;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">        add_header Front-End-Https on;</span><br><span class="line"></span><br><span class="line">        proxy_headers_hash_max_size 512;</span><br><span class="line">        proxy_headers_hash_bucket_size 64;</span><br><span class="line"></span><br><span class="line">        proxy_buffering off;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_max_temp_file_size 0;</span><br><span class="line">        proxy_pass http://cloud.domain.im:8880;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># static files</span></span><br><span class="line">    location ^~ /browser &#123;</span><br><span class="line">        proxy_pass https://cloud.domain.im:9980;</span><br><span class="line">        proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># WOPI discovery URL</span></span><br><span class="line">    location ^~ /hosting/discovery &#123;</span><br><span class="line">      proxy_pass https://cloud.domain.im:9980;</span><br><span class="line">      proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Capabilities</span></span><br><span class="line">    location ^~ /hosting/capabilities &#123;</span><br><span class="line">      proxy_pass https://cloud.domain.im:9980;</span><br><span class="line">      proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># main websocket</span></span><br><span class="line">    location ~ ^/cool/(.*)/ws$ &#123;</span><br><span class="line">      proxy_pass https://cloud.domain.im:9980;</span><br><span class="line">      proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">      proxy_set_header Connection <span class="string">"Upgrade"</span>;</span><br><span class="line">      proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">      proxy_read_timeout 36000s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># download, presentation and image upload</span></span><br><span class="line">    location ~ ^/(c|l)ool &#123;</span><br><span class="line">      proxy_pass https://cloud.domain.im:9980;</span><br><span class="line">      proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Admin Console websocket</span></span><br><span class="line">    location ^~ /cool/adminws &#123;</span><br><span class="line">      proxy_pass https://cloud.domain.im:9980;</span><br><span class="line">      proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">      proxy_set_header Connection <span class="string">"Upgrade"</span>;</span><br><span class="line">      proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">      proxy_read_timeout 36000s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  ssl_certificate     /etc/nginx/certs/cloud.domain.im.crt;</span><br><span class="line">  ssl_certificate_key /etc/nginx/certs/cloud.domain.im.key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>这里用一键<code>openssl</code>脚本,创建自签名的证书.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nextcloud$ cat create_self-sign-tls.sh</span><br><span class="line">DOMAIN=<span class="variable">$1</span></span><br><span class="line">[[ -e nginx/ssl ]] &amp;&amp; mkdir -pv nginx/ssl</span><br><span class="line">DHP=./nginx/ssl/dhparam.pem</span><br><span class="line">openssl dhparam -out <span class="variable">$DHP</span> 2048</span><br><span class="line">[[ -e nginx/certs ]] &amp;&amp; mkdir -pv nginx/certs</span><br><span class="line">KEY=./nginx/certs/<span class="variable">$&#123;DOMAIN&#125;</span>.key</span><br><span class="line">CRT=./nginx/certs/<span class="variable">$&#123;DOMAIN&#125;</span>.crt</span><br><span class="line">openssl req -new -newkey rsa:4096 -days 3650 -nodes -x509 -subj <span class="string">"/C=US/ST=NC/L=Local/O=Dev/CN=<span class="variable">$&#123;DOMAIN&#125;</span>"</span> -keyout <span class="variable">$KEY</span> -out <span class="variable">$CRT</span></span><br></pre></td></tr></table></figure>
<ul>
<li>一键创建自签名<code>TLS</code>证书脚本</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If you using frp via IP address and not hostname, make sure to set the appropriate IP address in the Subject Alternative Name (SAN) area when generating SSL/TLS Certificates.</span></span><br><span class="line"></span><br><span class="line">DAYS=5000</span><br><span class="line"><span class="built_in">export</span> DOMAIN=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">"<span class="variable">$DOMAIN</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"not domain name, default : example.com"</span>;</span><br><span class="line">  DOMAIN=<span class="string">"example.com"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">rm -rf <span class="variable">$DOMAIN</span></span><br><span class="line">[ ! -d <span class="variable">$DOMAIN</span> ] &amp;&amp; mkdir  <span class="variable">$DOMAIN</span> &amp;&amp; <span class="built_in">cd</span> <span class="variable">$DOMAIN</span></span><br><span class="line"></span><br><span class="line">cat &gt; my-openssl.cnf &lt;&lt; EOF</span><br><span class="line">[ ca ]</span><br><span class="line">default_ca = CA_default</span><br><span class="line">[ CA_default ]</span><br><span class="line">x509_extensions = usr_cert</span><br><span class="line">[ req ]</span><br><span class="line">default_bits        = 2048</span><br><span class="line">default_md          = sha256</span><br><span class="line">default_keyfile     = privkey.pem</span><br><span class="line">distinguished_name  = req_distinguished_name</span><br><span class="line">attributes          = req_attributes</span><br><span class="line">x509_extensions     = v3_ca</span><br><span class="line">string_mask         = utf8only</span><br><span class="line">prompt              = no</span><br><span class="line">[ req_distinguished_name ]</span><br><span class="line">C  = US</span><br><span class="line">ST = VA</span><br><span class="line">L  = SomeCity</span><br><span class="line">O  = MyCompany</span><br><span class="line">OU = MyDivision</span><br><span class="line">CN = <span class="variable">$&#123;DOMAIN&#125;</span></span><br><span class="line">[ req_attributes ]</span><br><span class="line">[ usr_cert ]</span><br><span class="line">basicConstraints       = CA:FALSE</span><br><span class="line">nsComment              = <span class="string">"OpenSSL Generated Certificate"</span></span><br><span class="line">subjectKeyIdentifier   = <span class="built_in">hash</span></span><br><span class="line">authorityKeyIdentifier = keyid,issuer</span><br><span class="line">[ v3_ca ]</span><br><span class="line">subjectKeyIdentifier   = <span class="built_in">hash</span></span><br><span class="line">authorityKeyIdentifier = keyid:always,issuer</span><br><span class="line">basicConstraints       = CA:<span class="literal">true</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># build ca certificates</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"---&gt; build ca certificates"</span></span><br><span class="line">openssl genrsa -out ca.key 2048</span><br><span class="line">openssl req -x509 -new -nodes -key ca.key -subj <span class="string">"/CN=<span class="variable">$&#123;DOMAIN&#125;</span>"</span> -days <span class="variable">$&#123;DAYS&#125;</span> -out ca.crt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># build frps server side certificates</span></span><br><span class="line"></span><br><span class="line">mkdir server</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"---&gt; build frps server side certificates"</span></span><br><span class="line">openssl genrsa -out server/server.key 2048</span><br><span class="line"></span><br><span class="line">openssl req -new -sha256 -key server/server.key -out server/server.csr -config my-openssl.cnf</span><br><span class="line"></span><br><span class="line">openssl x509 -req -days <span class="variable">$&#123;DAYS&#125;</span> \</span><br><span class="line">	-<span class="keyword">in</span> server/server.csr -CA ca.crt -CAkey ca.key -CAcreateserial \</span><br><span class="line">  -extfile &lt;(<span class="built_in">printf</span> <span class="string">"subjectAltName=IP:127.0.0.1"</span>) \</span><br><span class="line">  -out server/server.crt</span><br><span class="line"></span><br><span class="line"><span class="comment"># build frpc client side  certificates</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"---&gt; build frpc client side  certificates"</span></span><br><span class="line">mkdir client</span><br><span class="line">openssl genrsa -out client/client.key 2048</span><br><span class="line">openssl req -new -sha256 -key client/client.key -out client/client.csr -config my-openssl.cnf</span><br><span class="line"></span><br><span class="line">openssl x509 -req -days <span class="variable">$&#123;DAYS&#125;</span> \</span><br><span class="line">    -<span class="keyword">in</span> client/client.csr -CA ca.crt -CAkey ca.key -CAcreateserial \</span><br><span class="line">    -extfile &lt;(<span class="built_in">printf</span> <span class="string">"subjectAltName=IP:127.0.0.1"</span>) \</span><br><span class="line">    -out client/client.crt</span><br><span class="line"></span><br><span class="line">cp ca.crt server/ca.crt</span><br><span class="line">mv ca.crt client/ca.crt</span><br><span class="line">rm ca.key ca.srl client/client.csr server/server.csr</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"create Certificates done!!!!"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"verify the server Certificates"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> server</span><br><span class="line">openssl verify -CAfile ca.crt  server.crt</span><br><span class="line"><span class="built_in">cd</span> ../client</span><br><span class="line">openssl verify -CAfile ca.crt  client.crt</span><br><span class="line">chmod 644 client/client.key server/server.key</span><br></pre></td></tr></table></figure>
<ul>
<li>最终<code>docker-compose</code>的文件</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">nextcloud$ cat docker-compose.yml</span><br><span class="line">version: <span class="string">"3"</span></span><br><span class="line">services:</span><br><span class="line">  nginx:</span><br><span class="line">    image: nginx:latest</span><br><span class="line">    volumes:</span><br><span class="line">      - ./nginx/nginx.conf:/etc/nginx/nginx.conf</span><br><span class="line">      - ./nginx/ssl/dhparam.pem:/etc/nginx/ssl/dhparam.pem</span><br><span class="line">      - ./nginx/certs:/etc/nginx/certs</span><br><span class="line">      - ./nginx/sites-enabled:/etc/nginx/sites-enabled</span><br><span class="line">      - /etc/hosts:/etc/hosts:ro</span><br><span class="line">    ports:</span><br><span class="line">      - 80:80</span><br><span class="line">      - 443:443</span><br><span class="line">    environment:</span><br><span class="line">     - SITE_DOMAIN=cloud.domain.im</span><br><span class="line">    depends_on:</span><br><span class="line">     - nextcloud</span><br><span class="line"></span><br><span class="line">  pg11:</span><br><span class="line">    image: postgres:11-alpine</span><br><span class="line">    environment:</span><br><span class="line">      POSTGRES_DB: db3</span><br><span class="line">      POSTGRES_PASSWORD: rocks</span><br><span class="line">      POSTGRES_USER: cloudjs</span><br><span class="line">    logging:</span><br><span class="line">      driver: <span class="string">"none"</span></span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    volumes:</span><br><span class="line">      - ./db-data:/var/lib/postgresql/data</span><br><span class="line"></span><br><span class="line">  collabora:</span><br><span class="line">    image: collabora/code:latest</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - username=admin</span><br><span class="line">      - password=admin</span><br><span class="line">      - cert_domain=cloud.domain.im</span><br><span class="line">      - <span class="string">"extra_params=--o:ssl.enable=true --o:net.post_allow.host=192.168.1.100 --o:storage.wopi.host=192.168.1.100 --o:ssl.termination=true"</span></span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">"9980:9980"</span></span><br><span class="line">    cap_add:</span><br><span class="line">      - MKNOD</span><br><span class="line">    volumes:</span><br><span class="line">      - /etc/hosts:/etc/hosts:ro</span><br><span class="line">      - ./collabora/coolwsd.xml:/etc/coolwsd/coolwsd.xml</span><br><span class="line"></span><br><span class="line">  nextcloud:</span><br><span class="line">    image: nextcloud</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    depends_on:</span><br><span class="line">      - pg11</span><br><span class="line">    cap_add:</span><br><span class="line">      - MKNOD</span><br><span class="line">    volumes:</span><br><span class="line">      - ./volumes/html:/var/www/html</span><br><span class="line">      - ./volumes/config:/var/www/html/config</span><br><span class="line">      - ./volumes/custom_apps:/var/www/html/custom_apps</span><br><span class="line">      - ./volumes/data:/var/www/html/data</span><br><span class="line">      - ./volumes/theme:/var/www/html/themes</span><br><span class="line">      - /etc/localtime:/etc/localtime:ro</span><br><span class="line">      - /etc/hosts:/etc/hosts:ro</span><br><span class="line">    ports:</span><br><span class="line">      - 8880:80</span><br></pre></td></tr></table></figure>
<ul>
<li>如上面的文件所示,还需要修改<code>collabora/code</code>内默认的配置文件,这里是先从运行容器中复制一份源文件出来,修改后再用挂载的方式,覆盖容器内的配置.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nextcloud$ docker cp &lt;container ID&gt;:/etc/coolwsd/coolwsd.xml ./collabora/coolwsd.xml</span><br><span class="line">nextcloud$ chmod 755 ./collabora/coolwsd.xml</span><br></pre></td></tr></table></figure>
<ul>
<li>打开<code>coolwsd.xml</code>,并找到<code>server_name</code>这个节点,设置值为：<code>cloud.domain.im</code>. 具体如下：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nextcloud$ cat collabora/coolwsd.xml</span><br><span class="line">[...]</span><br><span class="line">&lt;server_name desc=<span class="string">"External hostname:port of the server running coolwsd. If empty, it's derived from the request (please set it if this doesn't work). May be specified when behind a reverse-proxy or when the hostname is not reachable directly."</span> <span class="built_in">type</span>=<span class="string">"string"</span> default=<span class="string">""</span>&gt;cloud.domain.im&lt;/server_name&gt;</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<ul>
<li><p>在测试时发,如果没有上述<code>coolwsd.xml</code>的修改,就无法使<code>Collabora Online</code>打开文件编辑,日志中报出如下错误.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsd-00001-00039 2022-04-22 15:52:33.479492 +0000 [ websrv_poll ] ERR  <span class="comment">#29 Error while handling poll at 0 in websrv_poll: #29BIO error: 0, rc: -1: error:00000000:lib(0):func(0):reason(0):| net/Socket.cpp:467</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>因为是使用<code>nginx</code>做<code>HTTPS</code>代理,还需要对<code>nextcloud/config/config.php</code>修改,加入<code>&#39;overwriteprotocol&#39; =&gt; &#39;https&#39;,</code>,重定项跳转.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">nextcloud$ sudo cat volumes/config/config.php</span><br><span class="line">[...]</span><br><span class="line">  <span class="string">'overwriteprotocol'</span> =&gt; <span class="string">'https'</span>,</span><br><span class="line">  <span class="string">'datadirectory'</span> =&gt; <span class="string">'/var/www/html/data'</span>,</span><br><span class="line">  <span class="string">'dbtype'</span> =&gt; <span class="string">'pgsql'</span>,</span><br><span class="line">  <span class="string">'version'</span> =&gt; <span class="string">'23.0.3.2'</span>,</span><br><span class="line">  <span class="string">'overwrite.cli.url'</span> =&gt; <span class="string">'http://cloud.domain.im'</span>,</span><br><span class="line">  <span class="string">'dbname'</span> =&gt; <span class="string">'db3'</span>,</span><br><span class="line">  <span class="string">'dbhost'</span> =&gt; <span class="string">'pg11'</span>,</span><br><span class="line">  <span class="string">'dbport'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">  <span class="string">'dbtableprefix'</span> =&gt; <span class="string">'oc_'</span>,</span><br><span class="line">  <span class="string">'dbuser'</span> =&gt; <span class="string">'oc_lcy'</span>,</span><br><span class="line">  <span class="string">'appstoreenabled'</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">  <span class="string">'appstoreurl'</span> =&gt; <span class="string">'https://apps.nextcloud.com/api/v1'</span>,</span><br><span class="line">  <span class="string">'installed'</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h2><ul>
<li><a href="https://github.com/nextcloud/docker" target="_blank" rel="noopener">nextcloud/docker</a></li>
<li>这里是个人使用,所以对数据库没有什么特殊要求,就使用<code>sqlite</code>,但是安全方面还是要使用<code>HTTPS</code>,使用<code>docker</code>安装.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~$ docker images | grep <span class="string">"nextcloud"</span> || docker pull nextcloud</span><br><span class="line">~$ <span class="keyword">if</span> [ ! -d nextcloud ]; <span class="keyword">then</span></span><br><span class="line">    mkdir -pv nextcloud/&#123;nextcloud,config,custom_apps,data,theme&#125;</span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">~$ <span class="built_in">cd</span> nextcloud &amp;&amp; docker run -d --restart=always --name nextcloud -p 8443:443  \</span><br><span class="line">    -v nextcloud:/var/www/html \</span><br><span class="line">    -v config:/var/www/html/config \</span><br><span class="line">    -v custom_apps:/var/www/html/custom_apps \</span><br><span class="line">    -v data:/var/www/html/data \</span><br><span class="line">    -v theme:/var/www/html/themes \</span><br><span class="line">    -v /etc/localtime:/etc/localtime:ro \</span><br><span class="line">    nextcloud</span><br></pre></td></tr></table></figure>
<h2 id="Dokku安装"><a href="#Dokku安装" class="headerlink" title="Dokku安装"></a>Dokku安装</h2><ul>
<li><a href="https://nginx.org/en/docs/stream/ngx_stream_ssl_preread_module.html" target="_blank" rel="noopener">ngx_stream_ssl_preread_module</a></li>
</ul>
<h3 id="安装Plugins"><a href="#安装Plugins" class="headerlink" title="安装Plugins"></a>安装<code>Plugins</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo dokku plugin:install https://github.com/dokku/dokku-letsencrypt.git</span><br><span class="line">~$ sudo dokku plugin:install https://github.com/dokku/dokku-postgres.git postgres</span><br></pre></td></tr></table></figure>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~$ dokku apps:create mycloud</span><br><span class="line">~$ docker pull nextcloud</span><br><span class="line">~$ docker images</span><br><span class="line">REPOSITORY             TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">nextcloud              latest    7aa569922593   11 hours ago    835MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># Note: The image must be retagged `dokku/&lt;app-name&gt;:&lt;version&gt;`</span></span><br><span class="line">~$ docker tag nextcloud:latest dokku/mycloud:latest</span><br><span class="line"></span><br><span class="line">~$ sudo mkdir -p /var/lib/dokku/data/storage/mycloud</span><br><span class="line">~$ sudo chown -R dokku:dokku /var/lib/dokku/data/storage/mycloud</span><br><span class="line">~$ dokku storage:mount mycloud /var/lib/dokku/data/storage/mycloud:/var/www/html</span><br><span class="line">~$ dokku tags:deploy mycloud latest</span><br></pre></td></tr></table></figure>
<ul>
<li><p>链接数据库,运行下面操作后,打开浏览器,进入首次配置管理员与数据库类型(Storage &amp; database)的配置,默认是<code>SQLite</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ dokku postgres:create mycloud_db</span><br><span class="line">~$ dokku postgres:link mycloud_db mycloud</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置域名,域名是主要是为了使用<code>Let&#39;s Encrypt</code>,还有就是<code>SNI</code>的功能,这里没有注册域名,使用了<code>dynv6.net</code>的动态域名.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ dokku domains:add mycloud  nc.llccyy.dynv6.net</span><br><span class="line">~$ dokku domains:remove mycloud mycloud.localhost</span><br><span class="line">~$ dokku config:<span class="built_in">set</span> mycloud --no-restart DOKKU_LETSENCRYPT_EMAIL=yjdwbj@gmail.com</span><br><span class="line">~$ dokku letsencrypt mycloud</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取证书错误:</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">darkhttpd/1.12, copyright (c) 2003-2016 Emil Mikulic.</span><br><span class="line">listening on: http://0.0.0.0:80/</span><br><span class="line">2021-02-28 08:15:08,915:INFO:__main__:1406: Generating new certificate private key</span><br><span class="line">2021-02-28 08:15:32,772:ERROR:__main__:1388: CA marked some of the authorizations as invalid, <span class="built_in">which</span> likely means it could not access http://example.com/.well-known/acme-challenge/X. Did you <span class="built_in">set</span> correct path <span class="keyword">in</span> -d example.com:path or --default_root? Are all your domains accessible from the internet? Please check your domains<span class="string">' DNS entries, your host'</span>s network/firewall setup and your webserver config. If a domain<span class="string">'s DNS entry has both A and AAAA fields set up, some CAs such as Let'</span>s Encrypt will perform the challenge validation over IPv6. If your DNS provider does not answer correctly to CAA records request, Let<span class="string">'s Encrypt won'</span>t issue a certificate <span class="keyword">for</span> your domain (see https://letsencrypt.org/docs/caa/). Failing authorizations: https://acme-v02.api.letsencrypt.org/acme/authz-v3/11204345532</span><br><span class="line">Challenge validation has failed, see error <span class="built_in">log</span>.</span><br><span class="line"></span><br><span class="line">Debugging tips: -v improves output verbosity. Help is available under --<span class="built_in">help</span>.</span><br><span class="line">-----&gt; Certificate retrieval failed!</span><br><span class="line">-----&gt; Disabling ACME proxy <span class="keyword">for</span> fpm...</span><br><span class="line">       <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<ul>
<li>出现上面的问题,基本就是<code>DNS A</code>记录的问题,不能解析域名,也有可能是域名服务商的问题,在使用<code>dynv6.com</code>的服务是有碰到这种问题,有时不作任改动,过一段时间重试又可以了.也可以尝试使用其它的<code>DDNS</code>.</li>
<li>在<code>dokku</code>中使用<code>Let&#39;s Encrypt</code>获取证书,有几点要求注意的点:<ul>
<li>必须要有一个域名(有A或AAAA记录),二级动态域名也可.</li>
<li><code>DOKKU_DOCKERFILE_PORTS: 80/tcp</code>,必须是80端口.如:<code>nextcloud:latest</code>是<code>80/tcp</code>,<code>nextcloud:nextcloud:fpm-alpine</code>它是<code>9000/tcp</code>,而且<code>nextcloud:fpm-alpine only a php fpm instance without a web server</code>.所以,使用<code>nextcloud:latest</code>创建的应用是可以正确的获取证书.</li>
<li>如果<code>DOKKU_DOCKERFILE_PORTS</code>不是<code>80</code>端口,可以使用<code>dokku proxy:ports-set &lt;APP&gt; http:80:9000</code>先设置要代理,再申请获取证书.</li>
</ul>
</li>
<li>如果是从<code>Docker Images</code>去创建的<code>app</code>,也就是用<code>dokku tags:deploy &lt;appname&gt; latest</code>部署的,可以使用下面<code>docker</code>命令查看它所支持的资源<br>与<code>Exposed</code>的详情.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ docker inspect &lt;appname&gt;.web.1 | jq <span class="string">".[0].Config.ExposedPorts"</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>或者直接查看镜像的配置详情</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ docker image inspect &lt;image tag&gt; | jq <span class="string">'.[0].Config.ExposedPorts'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>设置上传文件限制</p>
</li>
<li><a href="https://github.com/dokku/dokku/blob/master/docs/configuration/nginx.md" target="_blank" rel="noopener">nginx configuration</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ dokku nginx:<span class="built_in">set</span> mycloud  client-max-body-size 100m</span><br><span class="line">~$ dokku nginx:show-config mycloud</span><br></pre></td></tr></table></figure>
<h1 id="影音视频"><a href="#影音视频" class="headerlink" title="影音视频"></a>影音视频</h1><h2 id="jellyfin媒体中心"><a href="#jellyfin媒体中心" class="headerlink" title="jellyfin媒体中心"></a><code>jellyfin</code>媒体中心</h2><ul>
<li><a href="https://github.com/jellyfin/jellyfin.git" target="_blank" rel="noopener">jellyfin</a></li>
<li><a href="https://jellyfin.org/docs/general/administration/hardware-acceleration/" target="_blank" rel="noopener">Hardware Acceleration</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ docker pull jellyfin/jellyfin</span><br><span class="line">~$ docker run  -d  -p 8096:8096 --name jellyfin   -v `<span class="built_in">pwd</span>`/jellyfin/config:/config  -v `<span class="built_in">pwd</span>`/jellyfin/cache:/cache  -v `<span class="built_in">pwd</span>`/Incoming:/media  --restart=unless-stopped docker.io/jellyfin/jellyfin:latest</span><br></pre></td></tr></table></figure>
<h2 id="KODI-XMBC"><a href="#KODI-XMBC" class="headerlink" title="KODI(XMBC)"></a>KODI(XMBC)</h2><ul>
<li><a href="https://kodi.tv/download/" target="_blank" rel="noopener">kodi</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地收藏夹服务</span></span><br><span class="line"></span><br><span class="line">* [sissbruecker/linkding](https://github.com/sissbruecker/linkding)</span><br><span class="line"></span><br><span class="line"><span class="comment"># PDF转文本OCR</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## poppler-utils</span></span><br><span class="line">* 下面是以一个日文说明书为例,`pdftotext`无法转码，显示乱码，`pdftohtml`显示版权问题。</span><br><span class="line"></span><br><span class="line">```sh</span><br><span class="line">~$ sudo apt-get install poppler-utils</span><br><span class="line">~$ pdftotext  ~/Downloads/SDFA.pdf target.txt</span><br><span class="line">~$ pdftohtml  ~/Downloads/SDFA.pdf target.html</span><br><span class="line">Permission Error: Copying of text from this document is not allowed.</span><br></pre></td></tr></table></figure>
<h2 id="ocrmypdf"><a href="#ocrmypdf" class="headerlink" title="ocrmypdf"></a>ocrmypdf</h2><ul>
<li><code>ocrmypdf</code>也是不能转换加密后的<code>PDF</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get install ocrmypdf</span><br><span class="line">~$ ocrmypdf ~/Downloads/SDFA.pdf  -l jpn test.txt</span><br><span class="line">EncryptedPdfError: Input PDF is encrypted. The encryption must be removed to</span><br><span class="line">perform OCR.</span><br><span class="line"></span><br><span class="line">For information about this PDF\<span class="string">'s security use</span></span><br><span class="line"><span class="string">    qpdf --show-encryption infilename</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You can remove the encryption using</span></span><br><span class="line"><span class="string">    qpdf --decrypt [--password=[password]] infilename</span></span><br></pre></td></tr></table></figure>
<h2 id="Tesseract"><a href="#Tesseract" class="headerlink" title="Tesseract"></a>Tesseract</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~$ dpkg -l | grep <span class="string">"tesseract"</span></span><br><span class="line">ii  libtesseract-dev:amd64                                      4.1.1-2.1                                                 amd64        Development files <span class="keyword">for</span> the tesseract <span class="built_in">command</span> line OCR tool</span><br><span class="line">ii  libtesseract4:amd64                                         4.1.1-2.1                                                 amd64        Tesseract OCR library</span><br><span class="line">ii  tesseract-ocr                                               4.1.1-2.1                                                 amd64        Tesseract <span class="built_in">command</span> line OCR tool</span><br><span class="line">ii  tesseract-ocr-chi-sim                                       1:4.00~git30-7274cfa-1.1                                  all          tesseract-ocr language files <span class="keyword">for</span> Chinese - Simplified</span><br><span class="line">ii  tesseract-ocr-cym                                           1:4.00~git30-7274cfa-1.1                                  all          tesseract-ocr language files <span class="keyword">for</span> Welsh</span><br><span class="line">ii  tesseract-ocr-dev                                           3.04.01-5                                                 all          transitional dummy package</span><br><span class="line">ii  tesseract-ocr-eng                                           1:4.00~git30-7274cfa-1.1                                  all          tesseract-ocr language files <span class="keyword">for</span> English</span><br><span class="line">ii  tesseract-ocr-equ                                           3.04.00-1                                                 all          tesseract-ocr language files <span class="keyword">for</span> equations</span><br><span class="line">ii  tesseract-ocr-jpn                                           1:4.00~git30-7274cfa-1.1                                  all          tesseract-ocr language files <span class="keyword">for</span> Japanese</span><br><span class="line">ii  tesseract-ocr-osd                                           1:4.00~git30-7274cfa-1.1                                  all          tesseract-ocr language files <span class="keyword">for</span> script and orientation</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>Tesseract</code>不支持对<code>PDF</code>文件进行识别</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ tesseract ~/Downloads/SDFA.pdf ttt --dpi 150</span><br><span class="line">Tesseract Open Source OCR Engine v4.1.1 with Leptonica</span><br><span class="line">Error <span class="keyword">in</span> pixReadStream: Pdf reading is not supported</span><br><span class="line">Error <span class="keyword">in</span> pixRead: pix not <span class="built_in">read</span></span><br><span class="line">Error during processing.</span><br></pre></td></tr></table></figure>
</li>
<li><p>先把它转成一张张<code>png</code>,</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ pdftoppm -png ~/Downloads/SDFA.pdf turing</span><br><span class="line">~$ ls turing-*.png</span><br><span class="line">turing-1.png  turing-2.png  turing-3.png  turing-4.png  turing-5.png</span><br></pre></td></tr></table></figure>
<ul>
<li><p>安装目标语言包</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ tesseract  --list-langs</span><br><span class="line">List of available languages (5):</span><br><span class="line">chi_sim</span><br><span class="line">cym</span><br><span class="line">eng</span><br><span class="line">jpn</span><br><span class="line">osd</span><br><span class="line"></span><br><span class="line">~$ tesseract turing-2.png turing -l jpn --dpi 150</span><br></pre></td></tr></table></figure>
</li>
<li><p>输出<code>turing.txt</code>的文本文件。</p>
</li>
</ul>
<h2 id="Frog"><a href="#Frog" class="headerlink" title="Frog"></a>Frog</h2><ul>
<li><a href="https://github.com/TenderOwl/Frog/" target="_blank" rel="noopener">TenderOwl/Frog/</a>Extract text from any image, video, QR Code and etc.</li>
</ul>
<h1 id="离线wiki"><a href="#离线wiki" class="headerlink" title="离线wiki"></a>离线wiki</h1><ul>
<li>链接：<ul>
<li><a href="https://wiki.openzim.org/wiki/ZIM_file_format" target="_blank" rel="noopener">ZIM_file_format</a></li>
<li><a href="https://wiki.openzim.org/wiki/Readers" target="_blank" rel="noopener">Zim file Readers</a></li>
<li><a href="https://library.kiwix.org/" target="_blank" rel="noopener">Zim file download center</a></li>
<li><a href="https://en.wikipedia.org/wiki/Wikipedia:Database_download" target="_blank" rel="noopener">Wikipedia:Database download</a></li>
</ul>
</li>
</ul>
<h2 id="Kiwix"><a href="#Kiwix" class="headerlink" title="Kiwix"></a>Kiwix</h2><ul>
<li><a href="https://github.com/kiwix/" target="_blank" rel="noopener">Kiwix</a></li>
</ul>
<ul>
<li>源码编译</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get install libxapian-dev libpugixml-dev</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://github.com/kiwix/libkiwix" target="_blank" rel="noopener">kiwix/libkiwix</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/kiwix/libkiwix</span><br><span class="line">~$ <span class="built_in">cd</span> libkiwix</span><br><span class="line">~$ meson . build &amp;&amp; ninja -C build install</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="git clone https://github.com/openzim/libzim">openzim/libzim</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/openzim/libzim</span><br><span class="line">~$ <span class="built_in">cd</span> libzim</span><br><span class="line">~$ meson . build &amp;&amp; ninja -C build install</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://github.com/kiwix/kiwix-desktop" target="_blank" rel="noopener">kiwix/kiwix-desktop</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/kiwix/kiwix-desktop</span><br><span class="line">~$ <span class="built_in">cd</span> kiwix-desktop</span><br><span class="line">~$ qmake &amp;&amp; make -j10 install</span><br></pre></td></tr></table></figure>
<h1 id="搭建Matrix服务"><a href="#搭建Matrix服务" class="headerlink" title="搭建Matrix服务"></a>搭建<code>Matrix</code>服务</h1><ul>
<li><p><a href="https://gholk.github.io/ccns-matrix-luser-review.html" target="_blank" rel="noopener">matrix 菜鳥使用心得</a></p>
</li>
<li><p>使用<code>docker-compose</code>搭建一个本地<code>matrix</code>服务做测试</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ mkdir matrix</span><br><span class="line">~$ docker network create --driver=bridge --subnet=10.10.10.0/24 --gateway=10.10.10.1 matrix_net</span><br><span class="line">~$ <span class="built_in">cd</span> matrix</span><br></pre></td></tr></table></figure>
<ul>
<li><p>如果只是测试,或者<code>VPS</code>资源有限,使用<code>sqlite3</code>就可以，注释掉<code>postgres</code>的一项。</p>
</li>
<li><p>docker-compose.yaml</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">version: &apos;3.8&apos;</span><br><span class="line">services:</span><br><span class="line">  postgres:</span><br><span class="line">    image: postgres:11-alpine</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        ipv4_address: 10.10.10.2</span><br><span class="line">    volumes:</span><br><span class="line">     - ./postgresdata:/var/lib/postgresql/data</span><br><span class="line"></span><br><span class="line">    # These will be used in homeserver.yaml later on</span><br><span class="line">    environment:</span><br><span class="line">     - POSTGRES_DB=synapse</span><br><span class="line">     - POSTGRES_USER=synapse</span><br><span class="line">     - POSTGRES_PASSWORD=STRONGPASSWORD</span><br><span class="line">     - POSTGRES_INITDB_ARGS=--lc-collate C --lc-ctype C --encoding UTF8</span><br><span class="line"></span><br><span class="line">  element:</span><br><span class="line">    image: vectorim/element-web:latest</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    volumes:</span><br><span class="line">      - ./element-config.json:/app/config.json</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        ipv4_address: 10.10.10.3</span><br><span class="line"></span><br><span class="line">  synapse:</span><br><span class="line">    image: matrixdotorg/synapse:latest</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        ipv4_address: 10.10.10.4</span><br><span class="line">    volumes:</span><br><span class="line">     - ./synapse:/data</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  default:</span><br><span class="line">    external:</span><br><span class="line">      name: matrix_net</span><br></pre></td></tr></table></figure>
<ul>
<li>下载<code>element</code>的模版本配置文件,并且删除<code>&quot;default_server_name&quot;: &quot;matrix.org&quot;</code>这一行。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">matrix$ wget https://develop.element.io/config.json</span><br><span class="line">matrix$ mv config.json element-config.json</span><br></pre></td></tr></table></figure>
<h2 id="生成Synapse配置文件"><a href="#生成Synapse配置文件" class="headerlink" title="生成Synapse配置文件"></a>生成<code>Synapse</code>配置文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">matrix$ mkdir synapse</span><br><span class="line">matrix$ docker run -it --rm \</span><br><span class="line">    -v <span class="string">"<span class="variable">$(PWD)</span>/synapse:/data"</span> \</span><br><span class="line">    -e SYNAPSE_SERVER_NAME=matrix.example.com \</span><br><span class="line">    -e SYNAPSE_REPORT_STATS=yes \</span><br><span class="line">    matrixdotorg/synapse:latest generate</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Synapse</code>默认是使用<code>sqlite3</code>的,如果是要使用<code>postgres</code>,需要把<code>synapse/homeserver.yaml</code>里的<code>database</code>设置如下：</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">database:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">psycopg2</span></span><br><span class="line">  <span class="attr">args:</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">synapse</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">STRONGPASSWORD</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">synapse</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">postgres</span></span><br><span class="line">    <span class="attr">cp_min:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">cp_max:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>
<ul>
<li>创建新的用户</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">matrix$ docker-compose up -d</span><br><span class="line"></span><br><span class="line">matrix$ docker <span class="built_in">exec</span> -it matrix_synapse_1 bash</span><br><span class="line">~<span class="comment"># register_new_matrix_user -c /data/homeserver.yaml http://localhost:8008</span></span><br><span class="line">New user localpart [root]: ruan</span><br><span class="line">Password:</span><br><span class="line">Confirm password:</span><br><span class="line">Make admin [no]: yes</span><br><span class="line">Sending registration request...</span><br><span class="line">Success!</span><br></pre></td></tr></table></figure>
<h2 id="caddy-V2代理"><a href="#caddy-V2代理" class="headerlink" title="caddy V2代理"></a><code>caddy V2</code>代理</h2><ul>
<li><a href="https://caddyserver.com/docs/getting-started" target="_blank" rel="noopener">Getting Started</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ apt install -y debian-keyring debian-archive-keyring apt-transport-https</span><br><span class="line">$ curl -1sLf <span class="string">'https://dl.cloudsmith.io/public/caddy/stable/gpg.key'</span> | sudo tee /etc/apt/trusted.gpg.d/caddy-stable.asc</span><br><span class="line">$ curl -1sLf <span class="string">'https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt'</span> | sudo tee /etc/apt/sources.list.d/caddy-stable.list</span><br><span class="line">$ apt update</span><br><span class="line">$ apt install caddy -y</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">matrix$ cat Caddyfile</span><br><span class="line">http://matrix.example.com &#123;</span><br><span class="line">  tls internal</span><br><span class="line">  reverse_proxy /_matrix/* 10.10.10.4:8008</span><br><span class="line">  reverse_proxy /_synapse/client/* 10.10.10.4:8008</span><br><span class="line">  <span class="built_in">log</span> &#123;</span><br><span class="line">    output file /var/<span class="built_in">log</span>/caddy/matrix.example.log</span><br><span class="line">  &#125;</span><br><span class="line">  header &#123;</span><br><span class="line">    X-Content-Type-Options nosniff</span><br><span class="line">    Referrer-Policy  strict-origin-when-cross-origin</span><br><span class="line">    Strict-Transport-Security <span class="string">"max-age=63072000; includeSubDomains;"</span></span><br><span class="line">    Permissions-Policy <span class="string">"accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=(), interest-cohort=()"</span></span><br><span class="line">    X-Frame-Options SAMEORIGIN</span><br><span class="line">    X-XSS-Protection 1</span><br><span class="line">    X-Robots-Tag none</span><br><span class="line">    -server</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http://element.example.com &#123;</span><br><span class="line">  tls internal</span><br><span class="line">  encode zstd gzip</span><br><span class="line">  reverse_proxy 10.10.10.3:80</span><br><span class="line"></span><br><span class="line">  <span class="built_in">log</span> &#123;</span><br><span class="line">    output file /var/<span class="built_in">log</span>/caddy/element.example.log</span><br><span class="line">  &#125;</span><br><span class="line">  header &#123;</span><br><span class="line">    X-Content-Type-Options nosniff</span><br><span class="line">    Referrer-Policy  strict-origin-when-cross-origin</span><br><span class="line">    Strict-Transport-Security <span class="string">"max-age=63072000; includeSubDomains;"</span></span><br><span class="line">    Permissions-Policy <span class="string">"accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=(), interest-cohort=()"</span></span><br><span class="line">    X-Frame-Options SAMEORIGIN</span><br><span class="line">    X-XSS-Protection 1</span><br><span class="line">    X-Robots-Tag none</span><br><span class="line">    -server</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>加入到系统的配置运行</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">matrix$ caddy adapt --config /path/path/Caddyfile</span><br><span class="line">matrix$ caddy fmt</span><br><span class="line">matrix$ caddy reload</span><br></pre></td></tr></table></figure>
<ul>
<li>注意：<code>Caddyfile</code>内如果只写 <code>&lt;domain.com&gt; {}</code>的格式,它就会自动转换<code>http -&gt; https</code>,这对于内网测试，本地浏览器测试会出现<code>Mixed content blocked</code>这样的错误.</li>
</ul>
<h2 id="移动APP的连接"><a href="#移动APP的连接" class="headerlink" title="移动APP的连接"></a>移动APP的连接</h2><ul>
<li>进入网页端的管理后台<code>https://&lt;domain&gt;/settings/user/security</code>. 在<code>Devices &amp; sessions</code>下面点击<code>Create new app password</code>生成一个动态的用户与密码,再点<code>Show QR code from mobile apps</code>,打开移动端<code>nextcloud</code>选择连接自建服务器,扫描连接.</li>
<li>如果碰到问题,可以通过查看<code>https://&lt;domain&gt;/settings/admin/logging</code>.</li>
</ul>
<h1 id="MinIO"><a href="#MinIO" class="headerlink" title="MinIO"></a>MinIO</h1><ul>
<li><a href="https://github.com/minio/minio" target="_blank" rel="noopener">minio</a></li>
<li><a href="http://www.minio.org.cn/" target="_blank" rel="noopener">http://www.minio.org.cn/</a></li>
<li><p><a href="https://zaher.dev/blog/2020/06/08/build-a-pi-cluster-for-local-development-part-1/" target="_blank" rel="noopener">Build a PI Cluster for Local Development - Part 1</a></p>
</li>
<li><p><code>MinIO</code>是在<code>GNU Affero</code>通用公共许可证<code>v3.0</code>下发布的高性能对象存储.它是与<code>Amazon S3</code>云存储服务兼容的<code>API</code>.使用<code>MinIO</code> 为机器学习、分析和应用<br>程序数据工作负载构建高性能基础架构.</p>
</li>
</ul>
<h2 id="容器运行"><a href="#容器运行" class="headerlink" title="容器运行"></a>容器运行</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get install podman -y</span><br><span class="line">~$ podman run \</span><br><span class="line">  -p 9000:9000 \</span><br><span class="line">  -p 9001:9001 \</span><br><span class="line">  minio/minio server /data --console-address <span class="string">":9001"</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>如果出现下面的错误,请确认<code>/etc/containers/registries.conf</code>里有这一行<code>unqualified-search-registries=[&quot;docker.io&quot;]</code>,再重试.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: error getting default registries to try: short-name <span class="string">"minio/minio"</span> did not resolve to an <span class="built_in">alias</span> and no unqualified-search registries are defined <span class="keyword">in</span> <span class="string">"/etc/containers/registries.conf"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>也可以<code>docker</code>运行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ docker run -it --rm -p 9000:9000 \</span><br><span class="line">  -v `<span class="built_in">pwd</span>`/minio-data:/data \</span><br><span class="line">  -e MINIO_ROOT_USER=minio \</span><br><span class="line">  -e MINIO_ROOT_PASSWORD=minio123 \</span><br><span class="line">  -p 9001:9001 minio/minio server /data --console-address <span class="string">":9001"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="直接单机运行"><a href="#直接单机运行" class="headerlink" title="直接单机运行"></a>直接单机运行</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ wget http://dl.minio.org.cn/server/minio/release/darwin-amd64/minio</span><br><span class="line">~$ chmod +x minio</span><br><span class="line">~$ ./minio server /data</span><br></pre></td></tr></table></figure>
<h2 id="客户端访问"><a href="#客户端访问" class="headerlink" title="客户端访问"></a>客户端访问</h2><h3 id="mc"><a href="#mc" class="headerlink" title="mc"></a>mc</h3><ul>
<li><a href="https://docs.min.io/docs/minio-client-quickstart-guide.html" target="_blank" rel="noopener">MinIO Client Quickstart Guide</a></li>
<li><a href="https://docs.min.io/docs/minio-admin-complete-guide.html" target="_blank" rel="noopener">MinIO Admin Complete Guide</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ ./mc <span class="built_in">alias</span> <span class="built_in">set</span> myminio http://127.0.0.1:9000 minio minio123</span><br><span class="line">Added `myminio` successfully.</span><br></pre></td></tr></table></figure>
<ul>
<li><p>添加用户</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~$ ./mc admin user add myminio testuser testpwd123</span><br><span class="line">Added user `testuser` successfully.</span><br><span class="line">~$ ./mc admin user info myminio testuser</span><br><span class="line">AccessKey: testuser</span><br><span class="line">Status: enabled</span><br><span class="line">PolicyName:</span><br><span class="line">MemberOf:</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加桶(bucket)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./mc mb myminio/<span class="built_in">test</span>-new-s3-bucket</span><br><span class="line">Bucket created successfully `myminio/<span class="built_in">test</span>-new-s3-bucket`.</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建一个<code>bucket policy</code></p>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~$ cat test-policy.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"Version"</span>: <span class="string">"2012-10-17"</span>,</span><br><span class="line">    <span class="attr">"Statement"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"Action"</span>: [</span><br><span class="line">          <span class="string">"s3:GetObject"</span>,</span><br><span class="line">          <span class="string">"s3:PutObject"</span>,</span><br><span class="line">          <span class="string">"s3:DeleteObject"</span>,</span><br><span class="line">          <span class="string">"s3:GetBucketLocation"</span>,</span><br><span class="line">          <span class="string">"s3:ListBucket"</span>,</span><br><span class="line">          <span class="string">"s3:ListAllMyBuckets"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"Effect"</span>: <span class="string">"Allow"</span>,</span><br><span class="line">        <span class="attr">"Resource"</span>: [</span><br><span class="line">          <span class="string">"arn:aws:s3:::&lt;change-this-to-your-bucket-name&gt;/*"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"Sid"</span>: <span class="string">"Public"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>把策略文件加入到服务器中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ ./mc admin policy add myminio <span class="built_in">test</span>-policy <span class="built_in">test</span>-policy.json</span><br><span class="line">Added policy `<span class="built_in">test</span>-policy` successfully.</span><br></pre></td></tr></table></figure>
</li>
<li><p>应用策略到指定的用户上</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ ./mc admin policy <span class="built_in">set</span> myminio <span class="string">"test-policy"</span> user=testuser</span><br><span class="line">Policy `<span class="built_in">test</span>-policy` is <span class="built_in">set</span> on user `testuser`</span><br><span class="line"></span><br><span class="line">~$ ./mc admin user info myminio testuser</span><br><span class="line">AccessKey: testuser</span><br><span class="line">Status: enabled</span><br><span class="line">PolicyName: <span class="built_in">test</span>-policy</span><br><span class="line">MemberOf:</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="awscli"><a href="#awscli" class="headerlink" title="awscli"></a>awscli</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ pip3 install awscli</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ aws configure --profile minio</span><br><span class="line">AWS Access Key ID [None]: minio</span><br><span class="line">AWS Secret Access Key [None]: minio123</span><br><span class="line">Default region name [None]: myminio</span><br><span class="line">Default output format [None]: json</span><br></pre></td></tr></table></figure>
<ul>
<li><p>创建一个<code>bucket</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ aws --profile minio --endpoint-url http://127.0.0.1:9000 s3 mb s3://new-s3-bucket</span><br></pre></td></tr></table></figure>
</li>
<li><p>列出服务器上的<code>bucket</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ aws --profile minio --endpoint-url http://127.0.0.1:9000 s3 ls</span><br><span class="line">2021-12-13 23:16:20 new-s3-bucket</span><br><span class="line">2021-12-13 22:58:15 <span class="built_in">test</span>-new-s3-bucket</span><br></pre></td></tr></table></figure>
</li>
<li><p>上传一个文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ aws --profile minio --endpoint-url http://127.0.0.1:9000 s3 cp <span class="built_in">test</span>-policy.json s3://new-s3-bucket</span><br><span class="line">upload: ./<span class="built_in">test</span>-policy.json to s3://new-s3-bucket/<span class="built_in">test</span>-policy.json</span><br></pre></td></tr></table></figure>
</li>
<li><p>再对比一下,绑定到<code>minio</code>容器的本地目录<code>minio-data</code>的结构.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">minio$ tree minio-data/</span><br><span class="line">minio-data/</span><br><span class="line">├── new-s3-bucket</span><br><span class="line">│   └── <span class="built_in">test</span>-policy.json</span><br><span class="line">└── <span class="built_in">test</span>-new-s3-bucket</span><br><span class="line"></span><br><span class="line">2 directories, 1 file</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Kubernetes</code>环境中,使用<a href="https://github.com/minio/operator" target="_blank" rel="noopener">MinIO Kubernetes Operator</a>来创建/配置/管理<code>k8s</code>的<code>MinIO</code>集群.</li>
</ul>
<h1 id="Syncthing"><a href="#Syncthing" class="headerlink" title="Syncthing"></a>Syncthing</h1><ul>
<li><a href="https://github.com/syncthing/syncthing" target="_blank" rel="noopener">https://github.com/syncthing/syncthing</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ docker pull syncthing/syncthing</span><br><span class="line">~$ docker run -p 8384:8384 -p 22000:22000 -v &lt;YOUR PC FOLDER&gt;/share:/var/syncthing syncthing/syncthing:latest</span><br></pre></td></tr></table></figure>
<h2 id="使用docker-compose创建"><a href="#使用docker-compose创建" class="headerlink" title="使用docker-compose创建"></a>使用<code>docker-compose</code>创建</h2><ul>
<li><p>这里使用<code>docker-compose</code>创建,并支持<code>Traefik</code>反向代理,暴露给外部访问,这里只是本地内部测试,未配置<code>https</code>与真实的域名.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">syncthing$ cat .env</span><br><span class="line"><span class="comment"># Syncthing</span></span><br><span class="line">DOCKER_SYNCTHING_IMAGE_NAME=syncthing/syncthing</span><br><span class="line">DOCKER_SYNCTHING_HOSTNAME=syncthing-on-storage</span><br><span class="line">DOCKER_SYNCTHING_DOMAIN=syncthing.localhost</span><br><span class="line"></span><br><span class="line"><span class="comment"># discosrv</span></span><br><span class="line">DOCKER_DISCOSRV_IMAGE_NAME=syncthing/discosrv</span><br><span class="line">DOCKER_DISCOSRV_HOSTNAME=discosrv-on-storage</span><br><span class="line">DOCKER_DISCOSRV_DOMAIN=discosrv.localhost</span><br><span class="line"></span><br><span class="line"><span class="comment"># exporter</span></span><br><span class="line">DOCKER_EXPORTER_IMAGE_NAME=soulteary/syncthing-exporter</span><br><span class="line"><span class="comment"># xxd -l 16 -p /dev/random | base64</span></span><br><span class="line">DOCKER_EXPORTER_API_TOKEN=OTU0NGJmMGJhYzRiNGEzM2Q3Yzc4MjhjOTdhZjJkMDAK</span><br><span class="line">DOCKER_EXPORTER_HOSTNAME=syncthing-exporter-on-storage</span><br><span class="line">DOCKER_EXPORTER_DOMAIN=syncthing-exporter.localhost</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>docker-compose.yml</code>文件,需要当前目录里的<code>.env</code>文件配合.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">syncthing$ cat docker-compose.yml</span><br><span class="line"></span><br><span class="line">version: <span class="string">"3"</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  syncthing:</span><br><span class="line">    image: <span class="variable">$&#123;DOCKER_SYNCTHING_IMAGE_NAME&#125;</span></span><br><span class="line">    container_name: <span class="variable">$&#123;DOCKER_SYNCTHING_HOSTNAME&#125;</span></span><br><span class="line">    hostname: <span class="variable">$&#123;DOCKER_SYNCTHING_HOSTNAME&#125;</span></span><br><span class="line">    environment:</span><br><span class="line">      - PUID=1000</span><br><span class="line">      - PGID=1000</span><br><span class="line">    volumes:</span><br><span class="line">      - ./data:/var/syncthing</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">"22000:22000"</span></span><br><span class="line">    restart: always</span><br><span class="line">    labels:</span><br><span class="line">      - <span class="string">"traefik.enable=true"</span></span><br><span class="line">      - <span class="string">"traefik.docker.network=traefik_default"</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.sync-http.entrypoints=http"</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.sync-http.rule=Host(`<span class="variable">$&#123;DOCKER_SYNCTHING_DOMAIN&#125;</span>`)"</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.sync-http.service=sync-backend"</span></span><br><span class="line">      - <span class="string">"traefik.http.services.sync-backend.loadbalancer.server.scheme=http"</span></span><br><span class="line">      - <span class="string">"traefik.http.services.sync-backend.loadbalancer.server.port=8384"</span></span><br><span class="line">    networks:</span><br><span class="line">      - traefik_default</span><br><span class="line">    logging:</span><br><span class="line">      driver: <span class="string">"json-file"</span></span><br><span class="line">      options:</span><br><span class="line">        max-size: <span class="string">"1m"</span></span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  traefik_default:</span><br><span class="line">    external: <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>通过浏览器打开<code>http://127.0.0.1:8384</code>访问控制台,移动端可以安装<code>syncthing</code>客户端进行连接.</li>
</ul>
<h2 id="使用docker-compose安装mysql-phpadmin"><a href="#使用docker-compose安装mysql-phpadmin" class="headerlink" title="使用docker-compose安装mysql+phpadmin"></a>使用<code>docker-compose</code>安装<code>mysql+phpadmin</code></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">version: &apos;3&apos;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: mysql</span><br><span class="line">    container_name: zlib-db</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_ROOT_PASSWORD: 123456</span><br><span class="line">      MYSQL_DATABASE: zlib-db</span><br><span class="line">      MYSQL_USER: zlib</span><br><span class="line">      MYSQL_PASSWORD: zlib123</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;3306:3306&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - ./db-data:/var/lib/mysql</span><br><span class="line">  phpmyadmin:</span><br><span class="line">    image: phpmyadmin</span><br><span class="line">    container_name: pma</span><br><span class="line">    links:</span><br><span class="line">      - db</span><br><span class="line">    environment:</span><br><span class="line">      PMA_HOST: zlib-db</span><br><span class="line">      PMA_PORT: 3306</span><br><span class="line">      PMA_ARBITRARY: 1</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - 8081:80</span><br><span class="line">volumes:</span><br><span class="line">  dbdata:</span><br></pre></td></tr></table></figure>
<h1 id="协作文档"><a href="#协作文档" class="headerlink" title="协作文档"></a>协作文档</h1><h2 id="CryptPad"><a href="#CryptPad" class="headerlink" title="CryptPad"></a>CryptPad</h2><ul>
<li><a href="https://github.com/xwiki-labs/cryptpad" target="_blank" rel="noopener">xwiki-labs/cryptpad</a><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo dokku apps:create cryptpad</span><br><span class="line">~$ docker tag promasu/cryptpad:latest dokku/cryptpad:latest</span><br><span class="line">~$ sudo dokku tags:deploy cryptpad latest</span><br><span class="line">~$ sudo dokku domains:add cryptpad cryptpad.llccyy.dynv6.net</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="wiki-js"><a href="#wiki-js" class="headerlink" title="wiki.js"></a>wiki.js</h2><ul>
<li><a href="https://js.wiki/" target="_blank" rel="noopener">wikijs</a></li>
<li><a href="https://github.com/Requarks/wiki" target="_blank" rel="noopener">Requarks/wiki</a></li>
</ul>
<h3 id="docker-compose安装"><a href="#docker-compose安装" class="headerlink" title="docker-compose安装"></a><code>docker-compose</code>安装</h3><ul>
<li><a href="https://docs.requarks.io/install/docker" target="_blank" rel="noopener">wikijs installation</a></li>
<li><a href="https://tuneit.me/docker/deploy-wiki-js-in-docker-swarm-behind-traefik/" target="_blank" rel="noopener">Deploy Wiki.js 2.4.107 in Docker Swarm</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">wiki.js$ cat docker-compose.yml</span><br><span class="line">version: <span class="string">"3"</span></span><br><span class="line">services:</span><br><span class="line"></span><br><span class="line">  db:</span><br><span class="line">    image: postgres:11-alpine</span><br><span class="line">    environment:</span><br><span class="line">      POSTGRES_DB: wiki</span><br><span class="line">      POSTGRES_PASSWORD: wikijsrocks</span><br><span class="line">      POSTGRES_USER: wikijs</span><br><span class="line">    logging:</span><br><span class="line">      driver: <span class="string">"none"</span></span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    networks:</span><br><span class="line">      - traefik_default</span><br><span class="line">    volumes:</span><br><span class="line">      - ./db-data:/var/lib/postgresql/data</span><br><span class="line"></span><br><span class="line">  wiki:</span><br><span class="line">    image: requarks/wiki:2</span><br><span class="line">    depends_on:</span><br><span class="line">      - db</span><br><span class="line">    networks:</span><br><span class="line">      - traefik_default</span><br><span class="line">    environment:</span><br><span class="line">      DB_TYPE: postgres</span><br><span class="line">      DB_HOST: db</span><br><span class="line">      DB_PORT: 5432</span><br><span class="line">      DB_USER: wikijs</span><br><span class="line">      DB_PASS: wikijsrocks</span><br><span class="line">      DB_NAME: wiki</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    expose:</span><br><span class="line">      - 3000</span><br><span class="line">    labels:</span><br><span class="line">      - traefik.enable=<span class="literal">true</span></span><br><span class="line">      - traefik.docker.network=traefik_default</span><br><span class="line">      - traefik.http.routers.wiki.rule=Host(`wiki.localhost`)</span><br><span class="line">      - traefik.http.routers.wiki.entrypoints=http</span><br><span class="line">      - traefik.http.services.wiki.loadbalancer.server.port=3000</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  traefik_default:</span><br><span class="line">    external: <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>如上面如示,<code>docker-compose.yml</code>是开启了<code>Traefik</code>反向代理的,启动后,打开<code>http://wiki.localhost/</code>就可以设置安装<code>wiki.js</code>向导页了.</li>
</ul>
<h2 id="配置TLS与域名"><a href="#配置TLS与域名" class="headerlink" title="配置TLS与域名"></a>配置<code>TLS</code>与域名</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">cat docker-compose-wikijs.yml</span><br><span class="line">version: <span class="string">"3"</span></span><br><span class="line">services:</span><br><span class="line"></span><br><span class="line">  db:</span><br><span class="line">    image: postgres:11-alpine</span><br><span class="line">    environment:</span><br><span class="line">      POSTGRES_DB: wiki</span><br><span class="line">      POSTGRES_PASSWORD: wikijsrocks</span><br><span class="line">      POSTGRES_USER: wikijs</span><br><span class="line">    logging:</span><br><span class="line">      driver: <span class="string">"none"</span></span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    networks:</span><br><span class="line">      - traefik_default</span><br><span class="line">    volumes:</span><br><span class="line">      - ./db-data:/var/lib/postgresql/data</span><br><span class="line"></span><br><span class="line">  wiki:</span><br><span class="line">    image: requarks/wiki:2</span><br><span class="line">    depends_on:</span><br><span class="line">      - db</span><br><span class="line">    networks:</span><br><span class="line">      - traefik_default</span><br><span class="line">    environment:</span><br><span class="line">      DB_TYPE: postgres</span><br><span class="line">      DB_HOST: db</span><br><span class="line">      DB_PORT: 5432</span><br><span class="line">      DB_USER: wikijs</span><br><span class="line">      DB_PASS: wikijsrocks</span><br><span class="line">      DB_NAME: wiki</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    expose:</span><br><span class="line">      - 3000</span><br><span class="line">    labels:</span><br><span class="line">      - traefik.enable=<span class="literal">true</span></span><br><span class="line">      - traefik.docker.network=traefik_default</span><br><span class="line">      - traefik.http.routers.wiki.rule=Host(`&lt;your full domain name&gt;`) &amp;&amp; (PathPrefix(`/wiki`) || PathPrefix(`/_assets`))</span><br><span class="line">      - traefik.http.routers.wiki.entrypoints=websecure</span><br><span class="line">      - traefik.http.routers.wiki.tls.certresolver=myresolver</span><br><span class="line">      - traefik.http.services.wiki.loadbalancer.server.port=3000</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  traefik_default:</span><br><span class="line">    external: <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>如上面所示,<code>entrypoints=websecure,tls.certresolver=myresolver</code>这两个指项的定义是在<code>traefik</code>启动命令行中定义的,而且路由规则<code>Rule</code>必须是匹配<code>/wiki</code>与<code>/_assets</code>的前缀.<code>traefix</code>的启动命令大概如下：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line">traefik:</span><br><span class="line">    image: <span class="string">"traefik:v2.5"</span></span><br><span class="line">    container_name: <span class="string">"traefik"</span></span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - <span class="string">"--api.insecure=false"</span></span><br><span class="line">      - <span class="string">"--providers.docker=true"</span></span><br><span class="line">      - <span class="string">"--providers.docker.exposedbydefault=false"</span></span><br><span class="line">      - <span class="string">"--providers.file.directory=/letsencrypt/"</span></span><br><span class="line">      - <span class="string">"--entrypoints.web.address=:80"</span></span><br><span class="line">      - <span class="string">"--entrypoints.websecure.address=:443"</span></span><br><span class="line">      - <span class="string">"--certificatesresolvers.myresolver.acme.httpchallenge=true"</span></span><br><span class="line">      - <span class="string">"--certificatesresolvers.myresolver.acme.httpchallenge.entrypoint=web"</span></span><br><span class="line">      <span class="comment">#- "--certificatesresolvers.myresolver.acme.caserver=https://acme-staging-v02.api.letsencrypt.org/directory"</span></span><br><span class="line">      - <span class="string">"--certificatesresolvers.myresolver.acme.email=&lt;your email&gt;@gmail.com"</span></span><br><span class="line">      - <span class="string">"--certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json"</span></span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<ul>
<li>第一次启动访问<code>wiki</code>页面时,会是一个初始化安装页,在<code>SITE URL</code>必须填写<code>https://&lt;your full domain&gt;/wiki</code>.</li>
</ul>
<h1 id="通信类"><a href="#通信类" class="headerlink" title="通信类"></a>通信类</h1><h2 id="Matrix"><a href="#Matrix" class="headerlink" title="Matrix"></a>Matrix</h2><h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><h4 id="Dendrite"><a href="#Dendrite" class="headerlink" title="Dendrite"></a>Dendrite</h4><ul>
<li><a href="https://github.com/matrix-org/dendrite" target="_blank" rel="noopener">dendrite</a></li>
<li><p><a href="https://github.com/matrix-org/dendrite/blob/master/docs/INSTALL.md" target="_blank" rel="noopener">INSTALL.md</a></p>
</li>
<li><p>这里主要根据官方的文档,通过<code>docker</code>快速部署一个服务实践.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/matrix-org/dendrite</span><br></pre></td></tr></table></figure>
<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><h1 id="项目管理"><a href="#项目管理" class="headerlink" title="项目管理"></a>项目管理</h1><h2 id="OpenProject"><a href="#OpenProject" class="headerlink" title="OpenProject"></a>OpenProject</h2><ul>
<li><a href="https://www.openproject.org" target="_blank" rel="noopener">openproject</a></li>
</ul>
<h1 id="自动化测试"><a href="#自动化测试" class="headerlink" title="自动化测试"></a>自动化测试</h1><h2 id="RobotFramework"><a href="#RobotFramework" class="headerlink" title="RobotFramework"></a>RobotFramework</h2><ul>
<li><a href="https://github.com/robotframework/robotframework" target="_blank" rel="noopener">robotframework</a></li>
</ul>
<h1 id="Trojan"><a href="#Trojan" class="headerlink" title="Trojan"></a>Trojan</h1><ul>
<li><code>trojan</code>与<code>dokku</code>共用 443端口,4层转发.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br></pre></td><td class="code"><pre><span class="line">~$ nginx  -T</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line"><span class="comment"># configuration file /etc/nginx/nginx.conf:</span></span><br><span class="line">user www-data;</span><br><span class="line">worker_processes auto;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line">include /etc/nginx/modules-enabled/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">	worker_connections 768;</span><br><span class="line">	<span class="comment"># multi_accept on;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line">	<span class="comment"># Basic Settings</span></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line"></span><br><span class="line">	sendfile on;</span><br><span class="line">	tcp_nopush on;</span><br><span class="line">	tcp_nodelay on;</span><br><span class="line">	keepalive_timeout 65;</span><br><span class="line">	types_hash_max_size 2048;</span><br><span class="line">	<span class="comment"># server_tokens off;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># server_names_hash_bucket_size 64;</span></span><br><span class="line">	<span class="comment"># server_name_in_redirect off;</span></span><br><span class="line"></span><br><span class="line">	include /etc/nginx/mime.types;</span><br><span class="line">	default_type application/octet-stream;</span><br><span class="line"></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line">	<span class="comment"># SSL Settings</span></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line"></span><br><span class="line">	ssl_protocols TLSv1 TLSv1.1 TLSv1.2; <span class="comment"># Dropping SSLv3, ref: POODLE</span></span><br><span class="line">	ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line">	<span class="comment"># Logging Settings</span></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line"></span><br><span class="line">	access_log /var/<span class="built_in">log</span>/nginx/access.log;</span><br><span class="line">	error_log /var/<span class="built_in">log</span>/nginx/error.log;</span><br><span class="line"></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line">	<span class="comment"># Gzip Settings</span></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line"></span><br><span class="line">	gzip on;</span><br><span class="line"></span><br><span class="line">	<span class="comment"># gzip_vary on;</span></span><br><span class="line">	<span class="comment"># gzip_proxied any;</span></span><br><span class="line">	<span class="comment"># gzip_comp_level 6;</span></span><br><span class="line">	<span class="comment"># gzip_buffers 16 8k;</span></span><br><span class="line">	<span class="comment"># gzip_http_version 1.1;</span></span><br><span class="line">	<span class="comment"># gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line">	<span class="comment"># Virtual Host Configs</span></span><br><span class="line">	<span class="comment">##</span></span><br><span class="line"></span><br><span class="line">	include /etc/nginx/conf.d/*.conf;</span><br><span class="line">	include /etc/nginx/sites-enabled/*;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#mail &#123;</span></span><br><span class="line"><span class="comment">#	# See sample authentication script at:</span></span><br><span class="line"><span class="comment">#	# http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	# auth_http localhost/auth.php;</span></span><br><span class="line"><span class="comment">#	# pop3_capabilities "TOP" "USER";</span></span><br><span class="line"><span class="comment">#	# imap_capabilities "IMAP4rev1" "UIDPLUS";</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	server &#123;</span></span><br><span class="line"><span class="comment">#		listen     localhost:110;</span></span><br><span class="line"><span class="comment">#		protocol   pop3;</span></span><br><span class="line"><span class="comment">#		proxy      on;</span></span><br><span class="line"><span class="comment">#	&#125;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	server &#123;</span></span><br><span class="line"><span class="comment">#		listen     localhost:143;</span></span><br><span class="line"><span class="comment">#		protocol   imap;</span></span><br><span class="line"><span class="comment">#		proxy      on;</span></span><br><span class="line"><span class="comment">#	&#125;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># https://raymii.org/s/tutorials/nginx_1.15.2_ssl_preread_protocol_multiplex_https_and_ssh_on_the_same_port.html</span></span><br><span class="line">stream &#123;</span><br><span class="line">    map <span class="variable">$ssl_preread_server_name</span> <span class="variable">$backend_name</span> &#123;</span><br><span class="line">	proxy.yjdwbj.cloudns.org trojan;</span><br><span class="line">	nc.llccyy.dynv6.net mycloud;</span><br><span class="line">	fpm.yjdwbj.cloudns.org fpm;</span><br><span class="line">        default dokku;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream dokku &#123;</span><br><span class="line">	server 127.0.0.1:2000;</span><br><span class="line">    &#125;</span><br><span class="line">	upstream fpm</span><br><span class="line">	&#123;</span><br><span class="line">		server 127.0.0.1:6443;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    upstream trojan &#123;</span><br><span class="line">        server 172.17.0.2:443;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	upstream mycloud &#123;</span><br><span class="line"></span><br><span class="line">	  server 127.0.0.1:5443;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 443 reuseport ;</span><br><span class="line">        listen [::]:443 reuseport;</span><br><span class="line">        proxy_pass  <span class="variable">$backend_name</span>;</span><br><span class="line">	<span class="comment">#proxy_protocol on;</span></span><br><span class="line">        ssl_preread on;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /etc/nginx/modules-enabled/50-mod-http-auth-pam.conf:</span></span><br><span class="line">load_module modules/ngx_http_auth_pam_module.so;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /etc/nginx/modules-enabled/50-mod-http-dav-ext.conf:</span></span><br><span class="line">load_module modules/ngx_http_dav_ext_module.so;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /etc/nginx/modules-enabled/50-mod-http-echo.conf:</span></span><br><span class="line">load_module modules/ngx_http_echo_module.so;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /etc/nginx/modules-enabled/50-mod-http-geoip.conf:</span></span><br><span class="line">load_module modules/ngx_http_geoip_module.so;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /etc/nginx/modules-enabled/50-mod-http-image-filter.conf:</span></span><br><span class="line">load_module modules/ngx_http_image_filter_module.so;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /etc/nginx/modules-enabled/50-mod-http-subs-filter.conf:</span></span><br><span class="line">load_module modules/ngx_http_subs_filter_module.so;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /etc/nginx/modules-enabled/50-mod-http-upstream-fair.conf:</span></span><br><span class="line">load_module modules/ngx_http_upstream_fair_module.so;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /etc/nginx/modules-enabled/50-mod-http-xslt-filter.conf:</span></span><br><span class="line">load_module modules/ngx_http_xslt_filter_module.so;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /etc/nginx/modules-enabled/50-mod-mail.conf:</span></span><br><span class="line">load_module modules/ngx_mail_module.so;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /etc/nginx/modules-enabled/50-mod-stream.conf:</span></span><br><span class="line">load_module modules/ngx_stream_module.so;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /etc/nginx/mime.types:</span></span><br><span class="line"></span><br><span class="line">types &#123;</span><br><span class="line">    text/html                             html htm shtml;</span><br><span class="line">    text/css                              css;</span><br><span class="line">    text/xml                              xml;</span><br><span class="line">    image/gif                             gif;</span><br><span class="line">    image/jpeg                            jpeg jpg;</span><br><span class="line">    application/javascript                js;</span><br><span class="line">    application/atom+xml                  atom;</span><br><span class="line">    application/rss+xml                   rss;</span><br><span class="line"></span><br><span class="line">    text/mathml                           mml;</span><br><span class="line">    text/plain                            txt;</span><br><span class="line">    text/vnd.sun.j2me.app-descriptor      jad;</span><br><span class="line">    text/vnd.wap.wml                      wml;</span><br><span class="line">    text/x-component                      htc;</span><br><span class="line"></span><br><span class="line">    image/png                             png;</span><br><span class="line">    image/tiff                            tif tiff;</span><br><span class="line">    image/vnd.wap.wbmp                    wbmp;</span><br><span class="line">    image/x-icon                          ico;</span><br><span class="line">    image/x-jng                           jng;</span><br><span class="line">    image/x-ms-bmp                        bmp;</span><br><span class="line">    image/svg+xml                         svg svgz;</span><br><span class="line">    image/webp                            webp;</span><br><span class="line"></span><br><span class="line">    application/font-woff                 woff;</span><br><span class="line">    application/java-archive              jar war ear;</span><br><span class="line">    application/json                      json;</span><br><span class="line">    application/mac-binhex40              hqx;</span><br><span class="line">    application/msword                    doc;</span><br><span class="line">    application/pdf                       pdf;</span><br><span class="line">    application/postscript                ps eps ai;</span><br><span class="line">    application/rtf                       rtf;</span><br><span class="line">    application/vnd.apple.mpegurl         m3u8;</span><br><span class="line">    application/vnd.ms-excel              xls;</span><br><span class="line">    application/vnd.ms-fontobject         eot;</span><br><span class="line">    application/vnd.ms-powerpoint         ppt;</span><br><span class="line">    application/vnd.wap.wmlc              wmlc;</span><br><span class="line">    application/vnd.google-earth.kml+xml  kml;</span><br><span class="line">    application/vnd.google-earth.kmz      kmz;</span><br><span class="line">    application/x-7z-compressed           7z;</span><br><span class="line">    application/x-cocoa                   cco;</span><br><span class="line">    application/x-java-archive-diff       jardiff;</span><br><span class="line">    application/x-java-jnlp-file          jnlp;</span><br><span class="line">    application/x-makeself                run;</span><br><span class="line">    application/x-perl                    pl pm;</span><br><span class="line">    application/x-pilot                   prc pdb;</span><br><span class="line">    application/x-rar-compressed          rar;</span><br><span class="line">    application/x-redhat-package-manager  rpm;</span><br><span class="line">    application/x-sea                     sea;</span><br><span class="line">    application/x-shockwave-flash         swf;</span><br><span class="line">    application/x-stuffit                 sit;</span><br><span class="line">    application/x-tcl                     tcl tk;</span><br><span class="line">    application/x-x509-ca-cert            der pem crt;</span><br><span class="line">    application/x-xpinstall               xpi;</span><br><span class="line">    application/xhtml+xml                 xhtml;</span><br><span class="line">    application/xspf+xml                  xspf;</span><br><span class="line">    application/zip                       zip;</span><br><span class="line"></span><br><span class="line">    application/octet-stream              bin exe dll;</span><br><span class="line">    application/octet-stream              deb;</span><br><span class="line">    application/octet-stream              dmg;</span><br><span class="line">    application/octet-stream              iso img;</span><br><span class="line">    application/octet-stream              msi msp msm;</span><br><span class="line"></span><br><span class="line">    application/vnd.openxmlformats-officedocument.wordprocessingml.document    docx;</span><br><span class="line">    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet          xlsx;</span><br><span class="line">    application/vnd.openxmlformats-officedocument.presentationml.presentation  pptx;</span><br><span class="line"></span><br><span class="line">    audio/midi                            mid midi kar;</span><br><span class="line">    audio/mpeg                            mp3;</span><br><span class="line">    audio/ogg                             ogg;</span><br><span class="line">    audio/x-m4a                           m4a;</span><br><span class="line">    audio/x-realaudio                     ra;</span><br><span class="line"></span><br><span class="line">    video/3gpp                            3gpp 3gp;</span><br><span class="line">    video/mp2t                            ts;</span><br><span class="line">    video/mp4                             mp4;</span><br><span class="line">    video/mpeg                            mpeg mpg;</span><br><span class="line">    video/quicktime                       mov;</span><br><span class="line">    video/webm                            webm;</span><br><span class="line">    video/x-flv                           flv;</span><br><span class="line">    video/x-m4v                           m4v;</span><br><span class="line">    video/x-mng                           mng;</span><br><span class="line">    video/x-ms-asf                        asx asf;</span><br><span class="line">    video/x-ms-wmv                        wmv;</span><br><span class="line">    video/x-msvideo                       avi;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /etc/nginx/conf.d/dokku-installer.conf:</span></span><br><span class="line">upstream dokku-installer &#123; server 127.0.0.1:2000; &#125;</span><br><span class="line">server &#123;</span><br><span class="line">  listen      80;</span><br><span class="line">  location    / &#123;</span><br><span class="line">    proxy_pass  http://dokku-installer;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /etc/nginx/conf.d/dokku.conf:</span></span><br><span class="line">include /home/dokku/*/nginx.conf;</span><br><span class="line"></span><br><span class="line">server_tokens off;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Settings from https://mozilla.github.io/server-side-tls/ssl-config-generator/</span></span><br><span class="line">ssl_session_cache   shared:SSL:20m;</span><br><span class="line">ssl_session_timeout 1d;</span><br><span class="line">ssl_session_tickets off;</span><br><span class="line"></span><br><span class="line">ssl_dhparam /etc/nginx/dhparam.pem;</span><br><span class="line">ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /home/dokku/fpm/nginx.conf:</span></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen      [::]:80;</span><br><span class="line">  listen      80;</span><br><span class="line">  server_name fpm.yjdwbj.cloudns.org;</span><br><span class="line">  access_log  /var/<span class="built_in">log</span>/nginx/fpm-access.log;</span><br><span class="line">  error_log   /var/<span class="built_in">log</span>/nginx/fpm-error.log;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> 301 https://<span class="variable">$host</span>:6443<span class="variable">$request_uri</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen      [::]:6443 ssl http2;</span><br><span class="line">  listen      6443 ssl http2;</span><br><span class="line"></span><br><span class="line">  server_name fpm.yjdwbj.cloudns.org;</span><br><span class="line">  access_log  /var/<span class="built_in">log</span>/nginx/fpm-access.log;</span><br><span class="line">  error_log   /var/<span class="built_in">log</span>/nginx/fpm-error.log;</span><br><span class="line"></span><br><span class="line">  ssl_certificate           /home/dokku/fpm/tls/server.crt;</span><br><span class="line">  ssl_certificate_key       /home/dokku/fpm/tls/server.key;</span><br><span class="line">  ssl_protocols             TLSv1.2 TLSv1.3;</span><br><span class="line">  ssl_prefer_server_ciphers off;</span><br><span class="line"></span><br><span class="line">  keepalive_timeout   70;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  location    / &#123;</span><br><span class="line"></span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_min_length  1100;</span><br><span class="line">    gzip_buffers  4 32k;</span><br><span class="line">    gzip_types    text/css text/javascript text/xml text/plain text/x-component application/javascript application/x-javascript application/json application/xml  application/rss+xml font/truetype application/x-font-ttf font/opentype application/vnd.ms-fontobject image/svg+xml;</span><br><span class="line">    gzip_vary on;</span><br><span class="line">    gzip_comp_level  6;</span><br><span class="line"></span><br><span class="line">    proxy_pass  http://fpm-80;</span><br><span class="line">    http2_push_preload on;</span><br><span class="line">    proxy_http_version 1.1;</span><br><span class="line">    proxy_read_timeout 60s;</span><br><span class="line">    proxy_buffer_size 4096;</span><br><span class="line">    proxy_buffering on;</span><br><span class="line">    proxy_buffers 8 4096;</span><br><span class="line">    proxy_busy_buffers_size 8192;</span><br><span class="line">    proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">    proxy_set_header Connection <span class="variable">$http_connection</span>;</span><br><span class="line">    proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-For <span class="variable">$remote_addr</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Port <span class="variable">$server_port</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    proxy_set_header X-Request-Start <span class="variable">$msec</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  include /home/dokku/fpm/nginx.conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">  error_page 400 401 402 403 405 406 407 408 409 410 411 412 413 414 415 416 417 418 420 422 423 424 426 428 429 431 444 449 450 451 /400-error.html;</span><br><span class="line">  location /400-error.html &#123;</span><br><span class="line">    root /var/lib/dokku/data/nginx-vhosts/dokku-errors;</span><br><span class="line">    internal;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  error_page 404 /404-error.html;</span><br><span class="line">  location /404-error.html &#123;</span><br><span class="line">    root /var/lib/dokku/data/nginx-vhosts/dokku-errors;</span><br><span class="line">    internal;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  error_page 500 501 503 504 505 506 507 508 509 510 511 /500-error.html;</span><br><span class="line">  location /500-error.html &#123;</span><br><span class="line">    root /var/lib/dokku/data/nginx-vhosts/dokku-errors;</span><br><span class="line">    internal;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  error_page 502 /502-error.html;</span><br><span class="line">  location /502-error.html &#123;</span><br><span class="line">    root /var/lib/dokku/data/nginx-vhosts/dokku-errors;</span><br><span class="line">    internal;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream fpm-80 &#123;</span><br><span class="line"></span><br><span class="line">  server 172.17.0.5:80;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /home/dokku/fpm/nginx.conf.d/hsts.conf:</span></span><br><span class="line">add_header Strict-Transport-Security <span class="string">"max-age=15724800; includeSubdomains"</span> always;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /home/dokku/mycloud/nginx.conf:</span></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen      [::]:80;</span><br><span class="line">  listen      80;</span><br><span class="line">  server_name nc.llccyy.dynv6.net;</span><br><span class="line">  access_log  /var/<span class="built_in">log</span>/nginx/mycloud-access.log;</span><br><span class="line">  error_log   /var/<span class="built_in">log</span>/nginx/mycloud-error.log;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> 301 https://<span class="variable">$host</span>:5443<span class="variable">$request_uri</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen      [::]:5443 ssl http2;</span><br><span class="line">  listen      5443 ssl http2;</span><br><span class="line"></span><br><span class="line">  server_name nc.llccyy.dynv6.net;</span><br><span class="line">  access_log  /var/<span class="built_in">log</span>/nginx/mycloud-access.log;</span><br><span class="line">  error_log   /var/<span class="built_in">log</span>/nginx/mycloud-error.log;</span><br><span class="line"></span><br><span class="line">  ssl_certificate           /home/dokku/mycloud/tls/server.crt;</span><br><span class="line">  ssl_certificate_key       /home/dokku/mycloud/tls/server.key;</span><br><span class="line">  ssl_protocols             TLSv1.2 TLSv1.3;</span><br><span class="line">  ssl_prefer_server_ciphers off;</span><br><span class="line"></span><br><span class="line">  keepalive_timeout   70;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  location    / &#123;</span><br><span class="line"></span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_min_length  1100;</span><br><span class="line">    gzip_buffers  4 32k;</span><br><span class="line">    gzip_types    text/css text/javascript text/xml text/plain text/x-component application/javascript application/x-javascript application/json application/xml  application/rss+xml font/truetype application/x-font-ttf font/opentype application/vnd.ms-fontobject image/svg+xml;</span><br><span class="line">    gzip_vary on;</span><br><span class="line">    gzip_comp_level  6;</span><br><span class="line"></span><br><span class="line">    proxy_pass  http://mycloud-80;</span><br><span class="line">    http2_push_preload on;</span><br><span class="line">    proxy_http_version 1.1;</span><br><span class="line">    proxy_read_timeout 60s;</span><br><span class="line">    proxy_buffer_size 4096;</span><br><span class="line">    proxy_buffering on;</span><br><span class="line">    proxy_buffers 8 4096;</span><br><span class="line">    proxy_busy_buffers_size 8192;</span><br><span class="line">    proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">    proxy_set_header Connection <span class="variable">$http_connection</span>;</span><br><span class="line">    proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-For <span class="variable">$remote_addr</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Port <span class="variable">$server_port</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    proxy_set_header X-Request-Start <span class="variable">$msec</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  client_max_body_size 100m;</span><br><span class="line">  include /home/dokku/mycloud/nginx.conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">  error_page 400 401 402 403 405 406 407 408 409 410 411 412 413 414 415 416 417 418 420 422 423 424 426 428 429 431 444 449 450 451 /400-error.html;</span><br><span class="line">  location /400-error.html &#123;</span><br><span class="line">    root /var/lib/dokku/data/nginx-vhosts/dokku-errors;</span><br><span class="line">    internal;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  error_page 404 /404-error.html;</span><br><span class="line">  location /404-error.html &#123;</span><br><span class="line">    root /var/lib/dokku/data/nginx-vhosts/dokku-errors;</span><br><span class="line">    internal;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  error_page 500 501 503 504 505 506 507 508 509 510 511 /500-error.html;</span><br><span class="line">  location /500-error.html &#123;</span><br><span class="line">    root /var/lib/dokku/data/nginx-vhosts/dokku-errors;</span><br><span class="line">    internal;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  error_page 502 /502-error.html;</span><br><span class="line">  location /502-error.html &#123;</span><br><span class="line">    root /var/lib/dokku/data/nginx-vhosts/dokku-errors;</span><br><span class="line">    internal;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream mycloud-80 &#123;</span><br><span class="line"></span><br><span class="line">  server 172.17.0.4:80;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /home/dokku/mycloud/nginx.conf.d/hsts.conf:</span></span><br><span class="line">add_header Strict-Transport-Security <span class="string">"max-age=15724800; includeSubdomains"</span> always;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /home/dokku/trojan/nginx.conf:</span></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen      [::]:7443 ssl http2;</span><br><span class="line">  listen      7443 ssl http2;</span><br><span class="line"></span><br><span class="line">  server_name proxy.yjdwbj.cloudns.org;</span><br><span class="line">  access_log  /var/<span class="built_in">log</span>/nginx/trojan-access.log;</span><br><span class="line">  error_log   /var/<span class="built_in">log</span>/nginx/trojan-error.log;</span><br><span class="line"></span><br><span class="line">  ssl_certificate           /home/dokku/trojan/tls/server.crt;</span><br><span class="line">  ssl_certificate_key       /home/dokku/trojan/tls/server.key;</span><br><span class="line">  ssl_protocols             TLSv1.2 TLSv1.3;</span><br><span class="line">  ssl_prefer_server_ciphers off;</span><br><span class="line"></span><br><span class="line">  keepalive_timeout   70;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  location    / &#123;</span><br><span class="line"></span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_min_length  1100;</span><br><span class="line">    gzip_buffers  4 32k;</span><br><span class="line">    gzip_types    text/css text/javascript text/xml text/plain text/x-component application/javascript application/x-javascript application/json application/xml  application/rss+xml font/truetype application/x-font-ttf font/opentype application/vnd.ms-fontobject image/svg+xml;</span><br><span class="line">    gzip_vary on;</span><br><span class="line">    gzip_comp_level  6;</span><br><span class="line"></span><br><span class="line">    proxy_pass  https://trojan-443;</span><br><span class="line">    http2_push_preload on;</span><br><span class="line">    proxy_http_version 1.1;</span><br><span class="line">    proxy_read_timeout 60s;</span><br><span class="line">    proxy_buffer_size 4096;</span><br><span class="line">    proxy_buffering on;</span><br><span class="line">    proxy_buffers 8 4096;</span><br><span class="line">    proxy_busy_buffers_size 8192;</span><br><span class="line">    proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">    proxy_set_header Connection <span class="variable">$http_connection</span>;</span><br><span class="line">    proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-For <span class="variable">$remote_addr</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Port <span class="variable">$server_port</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    proxy_set_header X-Request-Start <span class="variable">$msec</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  include /home/dokku/trojan/nginx.conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">  error_page 400 401 402 403 405 406 407 408 409 410 411 412 413 414 415 416 417 418 420 422 423 424 426 428 429 431 444 449 450 451 /400-error.html;</span><br><span class="line">  location /400-error.html &#123;</span><br><span class="line">    root /var/lib/dokku/data/nginx-vhosts/dokku-errors;</span><br><span class="line">    internal;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  error_page 404 /404-error.html;</span><br><span class="line">  location /404-error.html &#123;</span><br><span class="line">    root /var/lib/dokku/data/nginx-vhosts/dokku-errors;</span><br><span class="line">    internal;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  error_page 500 501 503 504 505 506 507 508 509 510 511 /500-error.html;</span><br><span class="line">  location /500-error.html &#123;</span><br><span class="line">    root /var/lib/dokku/data/nginx-vhosts/dokku-errors;</span><br><span class="line">    internal;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  error_page 502 /502-error.html;</span><br><span class="line">  location /502-error.html &#123;</span><br><span class="line">    root /var/lib/dokku/data/nginx-vhosts/dokku-errors;</span><br><span class="line">    internal;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream trojan-443 &#123;</span><br><span class="line"></span><br><span class="line">  server 172.17.0.2:443;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /home/dokku/trojan/nginx.conf.d/hsts.conf:</span></span><br><span class="line">add_header Strict-Transport-Security <span class="string">"max-age=15724800; includeSubdomains"</span> always;</span><br><span class="line"></span><br><span class="line"><span class="comment"># configuration file /etc/nginx/conf.d/server_names_hash_bucket_size.conf:</span></span><br><span class="line"><span class="comment">#server_names_hash_bucket_size 512;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>本地端口与上面对应有<code>5443,7443,6443</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">netstat -tnlp</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 0.0.0.0:6443            0.0.0.0:*               LISTEN      23764/nginx: master</span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      23764/nginx: master</span><br><span class="line">tcp        0      0 0.0.0.0:2000            0.0.0.0:*               LISTEN      27904/python3</span><br><span class="line">tcp        0      0 0.0.0.0:7443            0.0.0.0:*               LISTEN      23764/nginx: master</span><br><span class="line">tcp        0      0 0.0.0.0:2132            0.0.0.0:*               LISTEN      1027/sshd</span><br><span class="line">tcp        0      0 0.0.0.0:53              0.0.0.0:*               LISTEN      2715/dnsmasq</span><br><span class="line">tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      23764/nginx: master</span><br><span class="line">tcp        0      0 0.0.0.0:8123            0.0.0.0:*               LISTEN      444/polipo</span><br><span class="line">tcp        0      0 0.0.0.0:5443            0.0.0.0:*               LISTEN      23764/nginx: master</span><br><span class="line">tcp        0      0 0.0.0.0:1443            0.0.0.0:*               LISTEN      1435/ss-server</span><br><span class="line">tcp6       0      0 :::6443                 :::*                    LISTEN      23764/nginx: master</span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      23764/nginx: master</span><br><span class="line">tcp6       0      0 :::7443                 :::*                    LISTEN      23764/nginx: master</span><br><span class="line">tcp6       0      0 :::2132                 :::*                    LISTEN      1027/sshd</span><br><span class="line">tcp6       0      0 :::53                   :::*                    LISTEN      2715/dnsmasq</span><br><span class="line">tcp6       0      0 :::443                  :::*                    LISTEN      23764/nginx: master</span><br><span class="line">tcp6       0      0 :::5443                 :::*                    LISTEN      23764/nginx: master</span><br><span class="line">tcp6       0      0 :::1443                 :::*                    LISTEN      1435/ss-server</span><br></pre></td></tr></table></figure>
<h1 id="资源聚合"><a href="#资源聚合" class="headerlink" title="资源聚合"></a>资源聚合</h1><ul>
<li><a href="https://iyouport.substack.com/p/100" target="_blank" rel="noopener">100种不错的免费工具和资源</a></li>
<li><a href="https://arxiv.org/" target="_blank" rel="noopener">https://arxiv.org/</a><ul>
<li>arXiv is a free distribution service and an open-access archive for 1,993,024 scholarly articles in the fields of physics, mathematics, computer science, quantitative biology, quantitative finance, statistics, electrical engineering and systems science, and economics. Materials on this site are not peer-reviewed by arXiv.</li>
</ul>
</li>
<li><a href="https://github.com/rajesh-s/computer-engineering-resources" target="_blank" rel="noopener">计算机工程资料索引</a></li>
</ul>
<h1 id="谢谢支持"><a href="#谢谢支持" class="headerlink" title="谢谢支持"></a>谢谢支持</h1><ul>
<li>微信二维码:</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Cloud-Linux/" rel="tag"># Cloud, Linux</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/02/19/Kubernetes基于CephFS的存储/" rel="prev" title="Kubernetes基于CephFS的存储">
      <i class="fa fa-chevron-left"></i> Kubernetes基于CephFS的存储
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/03/21/Linux环境下开发与应用备忘/" rel="next" title="Linux环境下开发与应用备记">
      Linux环境下开发与应用备记 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#DoH服务"><span class="nav-number">1.</span> <span class="nav-text">DoH服务</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NextCloud"><span class="nav-number">2.</span> <span class="nav-text">NextCloud</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-compose搭建nextcloud-collabora-code-无HTTPS"><span class="nav-number">2.1.</span> <span class="nav-text">Docker-compose搭建nextcloud+collabora/code(无HTTPS)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Self-Signed-HTTPS版本"><span class="nav-number">2.2.</span> <span class="nav-text">Self-Signed HTTPS版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker安装"><span class="nav-number">2.3.</span> <span class="nav-text">Docker安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dokku安装"><span class="nav-number">2.4.</span> <span class="nav-text">Dokku安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装Plugins"><span class="nav-number">2.4.1.</span> <span class="nav-text">安装Plugins</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装"><span class="nav-number">2.5.</span> <span class="nav-text">安装</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#影音视频"><span class="nav-number">3.</span> <span class="nav-text">影音视频</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#jellyfin媒体中心"><span class="nav-number">3.1.</span> <span class="nav-text">jellyfin媒体中心</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#KODI-XMBC"><span class="nav-number">3.2.</span> <span class="nav-text">KODI(XMBC)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ocrmypdf"><span class="nav-number">3.3.</span> <span class="nav-text">ocrmypdf</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tesseract"><span class="nav-number">3.4.</span> <span class="nav-text">Tesseract</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Frog"><span class="nav-number">3.5.</span> <span class="nav-text">Frog</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#离线wiki"><span class="nav-number">4.</span> <span class="nav-text">离线wiki</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Kiwix"><span class="nav-number">4.1.</span> <span class="nav-text">Kiwix</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#搭建Matrix服务"><span class="nav-number">5.</span> <span class="nav-text">搭建Matrix服务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#生成Synapse配置文件"><span class="nav-number">5.1.</span> <span class="nav-text">生成Synapse配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#caddy-V2代理"><span class="nav-number">5.2.</span> <span class="nav-text">caddy V2代理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#移动APP的连接"><span class="nav-number">5.3.</span> <span class="nav-text">移动APP的连接</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MinIO"><span class="nav-number">6.</span> <span class="nav-text">MinIO</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#容器运行"><span class="nav-number">6.1.</span> <span class="nav-text">容器运行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#直接单机运行"><span class="nav-number">6.2.</span> <span class="nav-text">直接单机运行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#客户端访问"><span class="nav-number">6.3.</span> <span class="nav-text">客户端访问</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#mc"><span class="nav-number">6.3.1.</span> <span class="nav-text">mc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#awscli"><span class="nav-number">6.3.2.</span> <span class="nav-text">awscli</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Syncthing"><span class="nav-number">7.</span> <span class="nav-text">Syncthing</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用docker-compose创建"><span class="nav-number">7.1.</span> <span class="nav-text">使用docker-compose创建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用docker-compose安装mysql-phpadmin"><span class="nav-number">7.2.</span> <span class="nav-text">使用docker-compose安装mysql+phpadmin</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#协作文档"><span class="nav-number">8.</span> <span class="nav-text">协作文档</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#CryptPad"><span class="nav-number">8.1.</span> <span class="nav-text">CryptPad</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#wiki-js"><span class="nav-number">8.2.</span> <span class="nav-text">wiki.js</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-compose安装"><span class="nav-number">8.2.1.</span> <span class="nav-text">docker-compose安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置TLS与域名"><span class="nav-number">8.3.</span> <span class="nav-text">配置TLS与域名</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#通信类"><span class="nav-number">9.</span> <span class="nav-text">通信类</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Matrix"><span class="nav-number">9.1.</span> <span class="nav-text">Matrix</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#服务端"><span class="nav-number">9.1.1.</span> <span class="nav-text">服务端</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Dendrite"><span class="nav-number">9.1.1.1.</span> <span class="nav-text">Dendrite</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#客户端"><span class="nav-number">9.1.1.2.</span> <span class="nav-text">客户端</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#项目管理"><span class="nav-number">10.</span> <span class="nav-text">项目管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenProject"><span class="nav-number">10.1.</span> <span class="nav-text">OpenProject</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#自动化测试"><span class="nav-number">11.</span> <span class="nav-text">自动化测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RobotFramework"><span class="nav-number">11.1.</span> <span class="nav-text">RobotFramework</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Trojan"><span class="nav-number">12.</span> <span class="nav-text">Trojan</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#资源聚合"><span class="nav-number">13.</span> <span class="nav-text">资源聚合</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#谢谢支持"><span class="nav-number">14.</span> <span class="nav-text">谢谢支持</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yjdwbj"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">yjdwbj</p>
  <div class="site-description" itemprop="description">最是人间留不住,朱颜辞镜花辞树</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">52</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yjdwbj</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>

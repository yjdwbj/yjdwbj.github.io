<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>codeblocks与STM32的开发环境配置 | 码农记事本</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="软件硬件配置
STM32F4 Discovery
Codeblocks 16.01
OpenOCD
STLink
GCC ARM Embedded
OpenOCD
这里省略下载编译opencd 环节。

openocd 安装在/usr/local下
/usr/local/bin/openocd
配置文件目录
/usr/local/share/openocd/

在当前用户目录下创建一个.openo">
<meta property="og:type" content="article">
<meta property="og:title" content="codeblocks与STM32的开发环境配置">
<meta property="og:url" content="http://yjdwbj.github.io/2016/12/15/codeblocks与STM32的开发环境配置/index.html">
<meta property="og:site_name" content="码农记事本">
<meta property="og:description" content="软件硬件配置
STM32F4 Discovery
Codeblocks 16.01
OpenOCD
STLink
GCC ARM Embedded
OpenOCD
这里省略下载编译opencd 环节。

openocd 安装在/usr/local下
/usr/local/bin/openocd
配置文件目录
/usr/local/share/openocd/

在当前用户目录下创建一个.openo">
<meta property="og:image" content="http://yjdwbj.github.io/2016/12/15/codeblocks与STM32的开发环境配置/codecompletion.png">
<meta property="og:image" content="http://yjdwbj.github.io/2016/12/15/codeblocks与STM32的开发环境配置/compiler_settings.png">
<meta property="og:image" content="http://yjdwbj.github.io/2016/12/15/codeblocks与STM32的开发环境配置/compiler_settings_inc.png">
<meta property="og:image" content="http://yjdwbj.github.io/2016/12/15/codeblocks与STM32的开发环境配置/compiler_settings_lib.png">
<meta property="og:image" content="http://yjdwbj.github.io/2016/12/15/codeblocks与STM32的开发环境配置/project_options.png">
<meta property="og:image" content="http://yjdwbj.github.io/2016/12/15/codeblocks与STM32的开发环境配置/project_define.png">
<meta property="og:image" content="http://yjdwbj.github.io/2016/12/15/codeblocks与STM32的开发环境配置/project_link.png">
<meta property="og:image" content="http://yjdwbj.github.io/2016/12/15/codeblocks与STM32的开发环境配置/project_inc.png">
<meta property="og:image" content="http://yjdwbj.github.io/2016/12/15/codeblocks与STM32的开发环境配置/project_search_link.png">
<meta property="og:image" content="http://yjdwbj.github.io/2016/12/15/codeblocks与STM32的开发环境配置/project_shell.png">
<meta property="og:image" content="http://yjdwbj.github.io/2016/12/15/codeblocks与STM32的开发环境配置/project_shfile.png">
<meta property="og:image" content="http://yjdwbj.github.io/2016/12/15/codeblocks与STM32的开发环境配置/project_build.png">
<meta property="og:image" content="http://yjdwbj.github.io/imgs/aex05246pdr9ik5wosogj3b.png">
<meta property="og:updated_time" content="2016-12-14T14:25:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="codeblocks与STM32的开发环境配置">
<meta name="twitter:description" content="软件硬件配置
STM32F4 Discovery
Codeblocks 16.01
OpenOCD
STLink
GCC ARM Embedded
OpenOCD
这里省略下载编译opencd 环节。

openocd 安装在/usr/local下
/usr/local/bin/openocd
配置文件目录
/usr/local/share/openocd/

在当前用户目录下创建一个.openo">
<meta name="twitter:image" content="http://yjdwbj.github.io/2016/12/15/codeblocks与STM32的开发环境配置/codecompletion.png">
<link rel="publisher" href="yjdwbj@gmail.com">
  
  
    <link rel="icon" href="/favicon.png">
  
  <!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'> -->
  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css"> -->
  <link href="//fonts.useso.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css">
  <link href='//fonts.useso.com/css?family=Open+Sans:300,600' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/style.css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <a href="/" class="logo">码农记事本</a>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">主面</a>
        
          <a class="main-nav-link" href="/archives">文章</a>
        
          <a class="main-nav-link" href="/2016/05/20/about/index.html">关于</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yjdwbj.github.io"></form>
        </div>
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
        
        
          <a id="nav-github-link" class="nav-icon" href="https://github.com/ppoffice/hexo-theme-alex" title="Fork me on GitHub"></a>
        
      </nav>
    </div>
  </div>
</header>
      <nav id="mobile-nav" class="off">
  
    <a href="/" class="mobile-nav-link">主面</a>
  
    <a href="/archives" class="mobile-nav-link">文章</a>
  
    <a href="/2016/05/20/about/index.html" class="mobile-nav-link">关于</a>
  
  <div id="search-form-wrap-mobile">
    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yjdwbj.github.io"></form>
  </div>
</nav>
      <div class="outer">
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/笔记/">笔记</a><span class="category-list-count">8</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/15/codeblocks与STM32的开发环境配置/">codeblocks与STM32的开发环境配置</a>
          </li>
        
          <li>
            <a href="/2016/12/14/Linux-下翻墙指南/">Linux 下翻墙指南</a>
          </li>
        
          <li>
            <a href="/2016/11/09/Django-uWsgi-nginx-https-完全配置/">Django+uWsgi+nginx+https 完全配置</a>
          </li>
        
          <li>
            <a href="/2016/09/13/Linux下编译静态MinGW环境-编译windows平台Qt程序/">Linux下编译静态MinGW环境,编译windows平台Qt程序</a>
          </li>
        
          <li>
            <a href="/2016/09/04/vsftpd-FTP服务器与django前端共用sqlite3数据库的示例/">vsftpd FTP服务器与django前端共用sqlite3数据库的示例</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debian-Linux-GLX-ATI-RADEON/">Debian,Linux,GLX,ATI,RADEON</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debian-Linux-Mate/">Debian,Linux,Mate,</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debian-Linux-Raspberry-Pi-ffmpeg/">Debian,Linux,Raspberry Pi,ffmpeg</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debian-Linux-Shell/">Debian,Linux,Shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django-Ngninx-uWsgi-Let-s-Encrypt/">Django,Ngninx,uWsgi,Let's Encrypt</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Qt-C-MinGW/">Qt,C++,MinGW</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Qt5-MinGW/">Qt5,MinGW</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RaspberryPi-Linux/">RaspberryPi,Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/STM32-Codeblocks/">STM32,Codeblocks</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vsftpd-Django-Sqlite3/">Vsftpd,Django,Sqlite3</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Debian-Linux-GLX-ATI-RADEON/" style="font-size: 10px;">Debian,Linux,GLX,ATI,RADEON</a> <a href="/tags/Debian-Linux-Mate/" style="font-size: 10px;">Debian,Linux,Mate,</a> <a href="/tags/Debian-Linux-Raspberry-Pi-ffmpeg/" style="font-size: 10px;">Debian,Linux,Raspberry Pi,ffmpeg</a> <a href="/tags/Debian-Linux-Shell/" style="font-size: 10px;">Debian,Linux,Shell</a> <a href="/tags/Django-Ngninx-uWsgi-Let-s-Encrypt/" style="font-size: 10px;">Django,Ngninx,uWsgi,Let's Encrypt</a> <a href="/tags/Qt-C-MinGW/" style="font-size: 10px;">Qt,C++,MinGW</a> <a href="/tags/Qt5-MinGW/" style="font-size: 10px;">Qt5,MinGW</a> <a href="/tags/RaspberryPi-Linux/" style="font-size: 10px;">RaspberryPi,Linux</a> <a href="/tags/STM32-Codeblocks/" style="font-size: 10px;">STM32,Codeblocks</a> <a href="/tags/Vsftpd-Django-Sqlite3/" style="font-size: 10px;">Vsftpd,Django,Sqlite3</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://hexo.io">Hexo</a>
          </li>
        
          <li>
            <a href="mailto:yjdwbj@gmail.com">Email</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
        <section id="main"><article id="post-codeblocks与STM32的开发环境配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/codeblocks与STM32的开发环境配置/" class="article-date">
  <time datetime="2016-12-15T14:58:17.894Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      codeblocks与STM32的开发环境配置
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="软件硬件配置"><a href="#软件硬件配置" class="headerlink" title="软件硬件配置"></a>软件硬件配置</h3><ul>
<li><a href="http://www.st.com/stm32f4-discovery" target="_blank" rel="external">STM32F4 Discovery</a></li>
<li><a href="http://codeblocks.org/downloads" target="_blank" rel="external">Codeblocks 16.01</a></li>
<li><a href="https://sourceforge.net/projects/openocd/files/openocd/" target="_blank" rel="external">OpenOCD</a></li>
<li><a href="https://github.com/texane/stlink" target="_blank" rel="external">STLink</a></li>
<li><p><a href="https://launchpad.net/gcc-arm-embedded/+download" target="_blank" rel="external">GCC ARM Embedded</a></p>
<h3 id="OpenOCD"><a href="#OpenOCD" class="headerlink" title="OpenOCD"></a>OpenOCD</h3></li>
<li><p>这里省略下载编译opencd 环节。</p>
</li>
<li>openocd 安装在/usr/local下</li>
<li>/usr/local/bin/openocd</li>
<li>配置文件目录</li>
<li>/usr/local/share/openocd/</li>
</ul>
<p>在当前用户目录下创建一个<code>.openocd</code>目录<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">mkdir ~/.openocd</div><div class="line">``` </div><div class="line"></div><div class="line">* 添加下面三行到~/.openocd/openocd.cfg</div><div class="line">```sh     </div><div class="line"><span class="built_in">source</span> [find /usr/<span class="built_in">local</span>/share/openocd/scripts/interface/stlink-v2.cfg]  </div><div class="line"><span class="built_in">source</span> [find /usr/<span class="built_in">local</span>/share/openocd/scripts/target/stm32f4x.cfg]  </div><div class="line">reset_config srst_only srst_nogate  </div><div class="line">```    </div><div class="line"></div><div class="line">* 连接STM32F4开发板，运行/usr/<span class="built_in">local</span>/bin/openocd</div><div class="line">* 正常会出现下面信息</div><div class="line"></div><div class="line">```bash</div><div class="line">michael@debian:~$ /usr/<span class="built_in">local</span>/bin/openocd  </div><div class="line">Open On-Chip Debugger 0.10.0-dev-00146-g332023f (2015-12-05-18:09)  </div><div class="line">Licensed under GNU GPL v2   </div><div class="line">For bug reports, <span class="built_in">read</span>   </div><div class="line">  http://openocd.org/doc/doxygen/bugs.html  </div><div class="line">  Info : auto-selecting first available session transport <span class="string">"hla_swd"</span>. To override use <span class="string">'transport select &lt;transport&gt;'</span>.  </div><div class="line">  Info : The selected transport took over low-level target control. The results might differ compared to plain JTAG/SWD   </div><div class="line">  adapter speed: 2000 kHz   </div><div class="line">  adapter_nsrst_delay: 100   </div><div class="line">  none separate   </div><div class="line">  srst_only separate srst_nogate srst_open_drain connect_deassert_srst   </div><div class="line">  Info : Unable to match requested speed 2000 kHz, using 1800 kHz  </div><div class="line">  Info : Unable to match requested speed 2000 kHz, using 1800 kHz  </div><div class="line">  Info : clock speed 1800 kHz  </div><div class="line">  Info : STLINK v2 JTAG v24 API v2 SWIM v0 VID 0x0483 PID 0x3748  </div><div class="line">  Info : using stlink api v2  </div><div class="line">  Info : Target voltage: 2.881129  </div><div class="line">  Info : stm32f4x.cpu: hardware has 6 breakpoints, 4 watchpoints</div></pre></td></tr></table></figure></p>
<h3 id="STLink-驱动安装"><a href="#STLink-驱动安装" class="headerlink" title="STLink 驱动安装"></a>STLink 驱动安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> https://github.com/texane/stlink.git </div><div class="line">$ <span class="built_in">cd</span> STLink</div><div class="line">$ \./authorgen.sh</div><div class="line">$ \./configure --prefix=/opt/STLink</div><div class="line">$ make &amp;&amp; sudo make install</div><div class="line">$ sudo cp 49-stlinkv2.rules /etc/udev/rules.d/49-stlinkv2.rules</div></pre></td></tr></table></figure>
<ul>
<li>通过lsusb命令找出开板板的ID<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ lsusb</div><div class="line">Bus 001 Device 002: ID 0483:3748 STMicroelectronics ST-LINK/V2</div><div class="line">Bus 003 Device 010: ID 174c:5106 ASMedia Technology Inc. Transcend StoreJet 25M3</div></pre></td></tr></table></figure>
</li>
</ul>
<p><em>
</em></p>
<ul>
<li>修改<code>/etc/udev/rules.d/49-stlinkv2.rules</code>,注意  ATTRS{idProduct}==<strong>“3748”</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ cat /etc/udev/rules.d/49-stlinkv2.rules </div><div class="line"><span class="comment"># stm32 discovery boards, with onboard st/linkv2</span></div><div class="line"><span class="comment"># ie, STM32L, STM32F4.</span></div><div class="line"><span class="comment"># STM32VL has st/linkv1, which is quite different</span></div><div class="line">SUBSYSTEMS==<span class="string">"usb"</span>, ATTRS&#123;idVendor&#125;==<span class="string">"0483"</span>, ATTRS&#123;idProduct&#125;==<span class="string">"3748"</span>, \</div><div class="line">    MODE:=<span class="string">"0666"</span>, \</div><div class="line">    SYMLINK+=<span class="string">"stlinkv2_%n"</span>,OWNER=<span class="string">"michael"</span></div><div class="line"><span class="comment"># If you share your linux system with other users, or just don't like the</span></div><div class="line"><span class="comment"># idea of write permission for everybody, you can replace MODE:="0666" with</span></div><div class="line"><span class="comment"># OWNER:="yourusername" to create the device owned by you, or with</span></div><div class="line"><span class="comment"># GROUP:="somegroupname" and mange access using standard unix groups.</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="刷新系统规则"><a href="#刷新系统规则" class="headerlink" title="刷新系统规则"></a>刷新系统规则</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo udevadm control --reload-rules</div><div class="line">$ sudo udevadm trigger</div></pre></td></tr></table></figure>
<h3 id="GCC-ARM-Embedded"><a href="#GCC-ARM-Embedded" class="headerlink" title="GCC ARM Embedded"></a>GCC ARM Embedded</h3><ul>
<li>下载GCC工具链解压到<code>/home/user/Embedded-System/gcc-arm-none-eabi-4_9-2015q3</code>,并且把<code>/home/user/Embedded-System/gcc-arm-none-eabi-4_9-2015q3/bin</code> 添加系统环境变量里面</li>
</ul>
<h4 id="Codeblocks-配置"><a href="#Codeblocks-配置" class="headerlink" title="Codeblocks 配置"></a>Codeblocks 配置</h4><ul>
<li>安装相应平台的codeblocks二进制包。</li>
<li>打开<code>Settings-&gt;Editor-&gt;Code completion</code> . 设置如下图。<img src="/2016/12/15/codeblocks与STM32的开发环境配置/codecompletion.png" alt="codecompletion.png" title="">
</li>
</ul>
<h4 id="编译器的全局设置"><a href="#编译器的全局设置" class="headerlink" title="编译器的全局设置"></a>编译器的全局设置</h4><ul>
<li>设置ARM工具链的路径，根据自己的环境做相应改变，如下图所示。<img src="/2016/12/15/codeblocks与STM32的开发环境配置/compiler_settings.png" alt="compiler_settings.png" title="">
</li>
</ul>
<ul>
<li>工具链头文件设置，如下图所示。  <img src="/2016/12/15/codeblocks与STM32的开发环境配置/compiler_settings_inc.png" alt="compiler_settings_inc.png" title="">
</li>
</ul>
<ul>
<li>工具链库文件设置，如下图所示。  <img src="/2016/12/15/codeblocks与STM32的开发环境配置/compiler_settings_lib.png" alt="compiler_settings_lib.png" title="">
</li>
</ul>
<h4 id="STM32工程设置"><a href="#STM32工程设置" class="headerlink" title="STM32工程设置"></a>STM32工程设置</h4><ul>
<li><p>这里是针对STM32F4 Discovery开发板，工程设置的一些参数</p>
</li>
<li><p>编译选项设置，如下图所示。  </p>
</li>
</ul>
<blockquote>
<ul>
<li>设置基于特定CPU的CFLAGS  参数。<strong> -mthumb -mthumb-interwork -mlittle-endian -O2 -Wall -mcpu=cortex-m4 -mfloat-abi=hard -mfpu=fpv4-sp-d16 -DUSE_STDPERIPH_DRIVER -DSTM32F4XX -std=c99 </strong></li>
</ul>
</blockquote>
<img src="/2016/12/15/codeblocks与STM32的开发环境配置/project_options.png" alt="project_options.png" title="">
<ul>
<li><p>编译宏定义设置，如下图所示。  </p>
<img src="/2016/12/15/codeblocks与STM32的开发环境配置/project_define.png" alt="project_define.png" title="">
</li>
<li><p>链接选项设置，如下图所示。  </p>
<img src="/2016/12/15/codeblocks与STM32的开发环境配置/project_link.png" alt="project_link.png" title="">
</li>
</ul>
<ul>
<li>工程头文件查找目录,库文件查找目录。</li>
</ul>
<img src="/2016/12/15/codeblocks与STM32的开发环境配置/project_inc.png" alt="project_inc.png" title="">
<img src="/2016/12/15/codeblocks与STM32的开发环境配置/project_search_link.png" alt="project_search_link.png" title="">
<ul>
<li>结合openocd 自动烧写bin文件的设置，如下图所示。  <img src="/2016/12/15/codeblocks与STM32的开发环境配置/project_shell.png" alt="project_shell.png" title="">
</li>
</ul>
<p>&gt;</p>
<ul>
<li>工程中的自动烧写脚本文件。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/expect    </span></div><div class="line">spawn telnet localhost 4444  </div><div class="line"><span class="built_in">set</span> prompt <span class="string">"&gt;"</span>   </div><div class="line"><span class="built_in">set</span> hexf [lindex <span class="variable">$argv</span> 0];  </div><div class="line">interact -o -nobuffer -re <span class="variable">$prompt</span> <span class="built_in">return</span>  </div><div class="line">send <span class="string">"reset halt\r"</span>  </div><div class="line">interact -o -nobuffer -re <span class="variable">$prompt</span> <span class="built_in">return</span>  </div><div class="line">send <span class="string">"flash write_image erase unlock <span class="variable">$hexf</span>\r"</span>  </div><div class="line">interact -o -nobuffer -re <span class="variable">$prompt</span> <span class="built_in">return</span>  </div><div class="line">send <span class="string">"reset run\r"</span>  </div><div class="line">interact -o -nobuffer -re <span class="variable">$prompt</span> <span class="built_in">return</span>  </div><div class="line">send <span class="string">"exit\r"</span>  </div><div class="line">interact</div></pre></td></tr></table></figure>
<img src="/2016/12/15/codeblocks与STM32的开发环境配置/project_shfile.png" alt="project_shfile.png" title="">
<ul>
<li>因为GCC工具链与Keil的链接文件是一样，必须在下面这个LD文件上修改，不能使用Keil版本的链接文件。</li>
</ul>
<pre><code>/*
*****************************************************************************
**
**  File        : stm32_flash.ld
**
**  Abstract    : Linker script for STM32F407VG Device with
**                1024KByte FLASH, 192KByte RAM
**
**                Set heap size, stack size and stack location according
**                to application requirements.
**
**                Set memory bank area and size if external memory is used.
**
**  Target      : STMicroelectronics STM32
**
**  Environment : Atollic TrueSTUDIO(R)
**
**  Distribution: The file is distributed “as is,” without any warranty
**                of any kind.
**
**  (c)Copyright Atollic AB.
**  You may use this file as-is or modify it according to the needs of your
**  project. Distribution of this file (unmodified or modified) is not
**  permitted. Atollic AB permit registered Atollic TrueSTUDIO(R) users the
**  rights to distribute the assembled, compiled &amp; linked contents of this
**  file as part of an application binary file, provided that it is built
**  using the Atollic TrueSTUDIO(R) toolchain.
**
*****************************************************************************
*/
/* Entry Point */
ENTRY(Reset_Handler)
/* Highest address of the user mode stack */
_estack = 0x20020000;    /* end of 128K RAM on AHB bus*/
/* Generate a link error if heap and stack don&apos;t fit into RAM */
_Min_Heap_Size = 0;      /* required amount of heap  */
_Min_Stack_Size = 0x400; /* required amount of stack */

/* Specify the memory areas */
MEMORY
{
    FLASH (rx)      : ORIGIN = 0x08000000, LENGTH = 1024K
        RAM (xrw)       : ORIGIN = 0x20000000, LENGTH = 192K
        MEMORY_B1 (rx)  : ORIGIN = 0x60000000, LENGTH = 0K
    }
    /* Define output sections */
    SECTIONS
{
    /* The startup code goes first into FLASH */
.isr_vector :
    {
        . = ALIGN(4);
        KEEP(*(.isr_vector)) /* Startup code */
        . = ALIGN(4);
    } &gt;FLASH
    /* The program code and other data goes into FLASH */
.text :
    {
        . = ALIGN(4);
        *(.text)           /* .text sections (code) */
        *(.text*)          /* .text* sections (code) */
        *(.rodata)         /* .rodata sections (constants, strings, etc.) */
        *(.rodata*)        /* .rodata* sections (constants, strings, etc.) */
        *(.glue_7)         /* glue arm to thumb code */
        *(.glue_7t)        /* glue thumb to arm code */
        *(.eh_frame)
        KEEP (*(.init))
        KEEP (*(.fini))
        . = ALIGN(4);
        _etext = .;        /* define a global symbols at end of code */
        _exit = .;
    } &gt;FLASH
.ARM.extab   :
    { *(.ARM.extab* .gnu.linkonce.armextab.*) } &gt;FLASH
.ARM :
    {
        __exidx_start = .;
        *(.ARM.exidx*)
        __exidx_end = .;
    } &gt;FLASH

.preinit_array     :
    {
        PROVIDE_HIDDEN (__preinit_array_start = .);
        KEEP (*(.preinit_array*))
        PROVIDE_HIDDEN (__preinit_array_end = .);
    } &gt;FLASH
.init_array :
    {
        PROVIDE_HIDDEN (__init_array_start = .);
        KEEP (*(SORT(.init_array.*)))
        KEEP (*(.init_array*))
        PROVIDE_HIDDEN (__init_array_end = .);
    } &gt;FLASH
.fini_array :
    {
        PROVIDE_HIDDEN (__fini_array_start = .);
        KEEP (*(.fini_array*))
        KEEP (*(SORT(.fini_array.*)))
        PROVIDE_HIDDEN (__fini_array_end = .);
    } &gt;FLASH

    /* used by the startup to initialize data */
    _sidata = .;

    /* Initialized data sections goes into RAM, load LMA copy after code */
.data :
    AT ( _sidata )
    {
        . = ALIGN(4);
        _sdata = .;        /* create a global symbol at data start */
        *(.data)           /* .data sections */
        *(.data*)          /* .data* sections */

        . = ALIGN(4);
        _edata = .;        /* define a global symbol at data end */
    } &gt;RAM

    /* Uninitialized data section */
    . = ALIGN(4);
.bss :
    {
        /* This is used by the startup in order to initialize the .bss secion */
        _sbss = .;         /* define a global symbol at bss start */
        __bss_start__ = _sbss;
        *(.bss)
        *(.bss*)
        *(COMMON)

        . = ALIGN(4);
        _ebss = .;         /* define a global symbol at bss end */
        __bss_end__ = _ebss;
    } &gt;RAM

    /* User_heap_stack section, used to check that there is enough RAM left */
._user_heap_stack :
    {
        . = ALIGN(4);
        PROVIDE ( end = . );
        PROVIDE ( _end = . );
        . = . + _Min_Heap_Size;
        . = . + _Min_Stack_Size;
        . = ALIGN(4);
    } &gt;RAM

    /* MEMORY_bank1 section, code must be located here explicitly            */
    /* Example: extern int foo(void) __attribute__ ((section (&quot;.mb1text&quot;))); */
.memory_b1_text :
    {
        *(.mb1text)        /* .mb1text sections (code) */
        *(.mb1text*)       /* .mb1text* sections (code)  */
        *(.mb1rodata)      /* read-only data (constants) */
        *(.mb1rodata*)
    } &gt;MEMORY_B1

    /* Remove information from the standard libraries */
/DISCARD/ :
    {

        libc.a ( * )
        libm.a ( * )
        libgcc.a ( * )
    }

.ARM.attributes 0 :
    { *(.ARM.attributes) }
}
</code></pre><h3 id="编译下载"><a href="#编译下载" class="headerlink" title="编译下载"></a>编译下载</h3><ul>
<li>完成上述设置，每次编译完成后都会自动telenet 连接到<code>OpenOCD</code>烧写最新的文件</li>
<li>最终运行的效果如下图<img src="/2016/12/15/codeblocks与STM32的开发环境配置/project_build.png" alt="project_build.png" title="">
</li>
</ul>
<hr>
<h3 id="自愿打赏支持"><a href="#自愿打赏支持" class="headerlink" title="自愿打赏支持"></a>自愿打赏支持</h3><ul>
<li>你的打赏将会鼓励我写出更多的博客。 </li>
<li>支付宝二维码:<br><img src="imgs/aex05246pdr9ik5wosogj3b.png" alt=""></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yjdwbj.github.io/2016/12/15/codeblocks与STM32的开发环境配置/" data-id="ciwu2lje000064ti5f03vgn3z" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/STM32-Codeblocks/">STM32,Codeblocks</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/12/14/Linux-下翻墙指南/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Linux 下翻墙指南</div>
    </a>
  
</nav>

  
</article>

</section>
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <a href="/" class="logo">码农记事本</a>
      &copy; 2016 lcy<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    

<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.scrollLoading.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
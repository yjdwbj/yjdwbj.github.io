<!DOCTYPE html>






  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.2.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.2.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="一直以来的服务器开发都会使用PostgreSQL做为数据库.有人会问为什么不用 MySQL?这个是个人喜好.Postgresql 与 MySQL 也是一些区别的.Postgresql 有一些特性是 MySQL 没有具备的.有人会说:在中国为什么 MySQL 的使用会比 PostgreSQL 流行.可能其中一个原因是 PostgreSQL 没有服务好 PHP.PostgreSQL 与 MySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="安装Postgresql-XL">
<meta property="og:url" content="http://yoursite.com/2016/12/22/安装Postgresql-XL/index.html">
<meta property="og:site_name" content="Sunrise 博客">
<meta property="og:description" content="一直以来的服务器开发都会使用PostgreSQL做为数据库.有人会问为什么不用 MySQL?这个是个人喜好.Postgresql 与 MySQL 也是一些区别的.Postgresql 有一些特性是 MySQL 没有具备的.有人会说:在中国为什么 MySQL 的使用会比 PostgreSQL 流行.可能其中一个原因是 PostgreSQL 没有服务好 PHP.PostgreSQL 与 MySQL">
<meta property="og:image" content="http://yoursite.com/imgs/mm_reward_qrcode_1525013906055.png">
<meta property="og:updated_time" content="2019-03-22T13:25:08.165Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="安装Postgresql-XL">
<meta name="twitter:description" content="一直以来的服务器开发都会使用PostgreSQL做为数据库.有人会问为什么不用 MySQL?这个是个人喜好.Postgresql 与 MySQL 也是一些区别的.Postgresql 有一些特性是 MySQL 没有具备的.有人会说:在中国为什么 MySQL 的使用会比 PostgreSQL 流行.可能其中一个原因是 PostgreSQL 没有服务好 PHP.PostgreSQL 与 MySQL">
<meta name="twitter:image" content="http://yoursite.com/imgs/mm_reward_qrcode_1525013906055.png">






  <link rel="canonical" href="http://yoursite.com/2016/12/22/安装Postgresql-XL/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>安装Postgresql-XL | Sunrise 博客</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-78826582-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-78826582-1');
</script>






  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Sunrise 博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/22/安装Postgresql-XL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/321919?s=400&u=67298bd9fc3b622eaf93a6cc511a24ac878e86db&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">安装Postgresql-XL
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-12-22 22:17:16" itemprop="dateCreated datePublished" datetime="2016-12-22T22:17:16+08:00">2016-12-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-03-22 21:25:08" itemprop="dateModified" datetime="2019-03-22T21:25:08+08:00">2019-03-22</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/运维/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <ul>
<li>一直以来的服务器开发都会使用<code>PostgreSQL</code>做为数据库.有人会问为什么不用 MySQL?这个是个人喜好.Postgresql 与 MySQL 也是一些区别的.Postgresql 有一些特性是 MySQL 没有具备的.有人会说:在中国为什么 MySQL 的使用会比 PostgreSQL 流行.可能其中一个原因是 PostgreSQL 没有服务好 PHP.PostgreSQL 与 MySQL 的连接方式有很大不同,PostgreSQL 是 fork 进程,MySQL 是线程连接.所以在高并发下 PostgreSQL 的连接数会很快被用完.这时就需要一个连接池处理客户端的连接.</li>
<li>Pgbouncer,pgpool,<a href="http://www.postgres-xl.org" target="_blank" rel="external">PostgreSQL-XL</a></li>
</ul>
<h1 id="安装主机系统"><a href="#安装主机系统" class="headerlink" title="安装主机系统"></a>安装主机系统</h1><ul>
<li>本文的系统是基于<code>Debian 8</code>,安装 qemu-kvm 虚拟机.并于一些相关的软件.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># apt-get install qemu-kvm openvswitch-&#123;switch,common&#125; libvirt-bin virtinst virt-manager</span></div><div class="line">[...]</div><div class="line"></div><div class="line"><span class="comment"># /etc/init.d/openvswitch-switch start</span></div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># ovs-vsctl show</span></div><div class="line">504bd042<span class="_">-d</span>300-4<span class="built_in">fc</span>3-be49-5609ea5df49f</div><div class="line">    Bridge <span class="string">"ovs-br0"</span></div><div class="line">        Port <span class="string">"ovs-br0"</span></div><div class="line">            Interface <span class="string">"ovs-br0"</span></div><div class="line">                <span class="built_in">type</span>: internal</div><div class="line">    ovs_version: <span class="string">"2.5.0"</span></div></pre></td></tr></table></figure>
<h1 id="安装基础系统"><a href="#安装基础系统" class="headerlink" title="安装基础系统"></a>安装基础系统</h1><ul>
<li>本文的做实验的虚拟机系统是基于<code>Centos 7</code>的环境. 通过<code>virsh dumpxml vhost0</code>,配置如下:</li>
</ul>
<ul>
<li>两个 CPU,8G 内存,eth0 192.168.120/24, eth1 192.168.25.0/24,　 eth0 是桥接主机的 openvswitch 的虚拟网卡用作于 HostOnly 内部网络.eth1 是桥主机的物理网卡,可以连接到互联安装软件</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># virsh dumpxml vhost0</span></div><div class="line">&lt;domain <span class="built_in">type</span>=<span class="string">'kvm'</span> id=<span class="string">'53'</span>&gt;</div><div class="line">  &lt;name&gt;vhost0&lt;/name&gt;</div><div class="line">  &lt;uuid&gt;0fdbcbe7<span class="_">-f</span>7e9-443e-bf9b-7ac4a6d27612&lt;/uuid&gt;</div><div class="line">  &lt;memory unit=<span class="string">'KiB'</span>&gt;8388608&lt;/memory&gt;</div><div class="line">  &lt;currentMemory unit=<span class="string">'KiB'</span>&gt;8388608&lt;/currentMemory&gt;</div><div class="line">  &lt;vcpu placement=<span class="string">'static'</span>&gt;2&lt;/vcpu&gt;</div><div class="line">  &lt;resource&gt;</div><div class="line">    &lt;partition&gt;/machine&lt;/partition&gt;</div><div class="line">  &lt;/resource&gt;</div><div class="line">  &lt;os&gt;</div><div class="line">    &lt;<span class="built_in">type</span> arch=<span class="string">'x86_64'</span> machine=<span class="string">'pc-i440fx-xenial'</span>&gt;hvm&lt;/<span class="built_in">type</span>&gt;</div><div class="line">    &lt;boot dev=<span class="string">'hd'</span>/&gt;</div><div class="line">  &lt;/os&gt;</div><div class="line">  &lt;features&gt;</div><div class="line">    &lt;acpi/&gt;</div><div class="line">    &lt;apic/&gt;</div><div class="line">    &lt;pae/&gt;</div><div class="line">  &lt;/features&gt;</div><div class="line">  &lt;cpu mode=<span class="string">'custom'</span> match=<span class="string">'exact'</span>&gt;</div><div class="line">    &lt;model fallback=<span class="string">'allow'</span>&gt;Broadwell-noTSX&lt;/model&gt;</div><div class="line">  &lt;/cpu&gt;</div><div class="line">  &lt;clock offset=<span class="string">'utc'</span>&gt;</div><div class="line">    &lt;timer name=<span class="string">'rtc'</span> tickpolicy=<span class="string">'catchup'</span>/&gt;</div><div class="line">    &lt;timer name=<span class="string">'pit'</span> tickpolicy=<span class="string">'delay'</span>/&gt;</div><div class="line">    &lt;timer name=<span class="string">'hpet'</span> present=<span class="string">'no'</span>/&gt;</div><div class="line">  &lt;/clock&gt;</div><div class="line">  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;</div><div class="line">  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;</div><div class="line">  &lt;on_crash&gt;restart&lt;/on_crash&gt;</div><div class="line">  &lt;pm&gt;</div><div class="line">    &lt;<span class="built_in">suspend</span>-to-mem enabled=<span class="string">'no'</span>/&gt;</div><div class="line">    &lt;<span class="built_in">suspend</span>-to-disk enabled=<span class="string">'no'</span>/&gt;</div><div class="line">  &lt;/pm&gt;</div><div class="line">  &lt;devices&gt;</div><div class="line">    &lt;emulator&gt;/usr/bin/kvm-spice&lt;/emulator&gt;</div><div class="line">    &lt;disk <span class="built_in">type</span>=<span class="string">'file'</span> device=<span class="string">'disk'</span>&gt;</div><div class="line">      &lt;driver name=<span class="string">'qemu'</span> <span class="built_in">type</span>=<span class="string">'qcow2'</span>/&gt;</div><div class="line">      &lt;<span class="built_in">source</span> file=<span class="string">'/data/centos7.qcow2'</span>/&gt;</div><div class="line">      &lt;backingStore/&gt;</div><div class="line">      &lt;target dev=<span class="string">'vda'</span> bus=<span class="string">'virtio'</span>/&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'virtio-disk0'</span>/&gt;</div><div class="line">  &lt;address <span class="built_in">type</span>=<span class="string">'pci'</span> domain=<span class="string">'0x0000'</span> bus=<span class="string">'0x00'</span> slot=<span class="string">'0x07'</span> <span class="keyword">function</span>=<span class="string">'0x0'</span>/&gt;</div><div class="line">    &lt;/disk&gt;</div><div class="line">    &lt;controller <span class="built_in">type</span>=<span class="string">'usb'</span> index=<span class="string">'0'</span> model=<span class="string">'ich9-ehci1'</span>&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'usb'</span>/&gt;</div><div class="line">      &lt;address <span class="built_in">type</span>=<span class="string">'pci'</span> domain=<span class="string">'0x0000'</span> bus=<span class="string">'0x00'</span> slot=<span class="string">'0x06'</span> <span class="keyword">function</span>=<span class="string">'0x7'</span>/&gt;</div><div class="line">    &lt;/controller&gt;</div><div class="line">    &lt;controller <span class="built_in">type</span>=<span class="string">'usb'</span> index=<span class="string">'0'</span> model=<span class="string">'ich9-uhci1'</span>&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'usb'</span>/&gt;</div><div class="line">      &lt;master startport=<span class="string">'0'</span>/&gt;</div><div class="line">      &lt;address <span class="built_in">type</span>=<span class="string">'pci'</span> domain=<span class="string">'0x0000'</span> bus=<span class="string">'0x00'</span> slot=<span class="string">'0x06'</span> <span class="keyword">function</span>=<span class="string">'0x0'</span> multifunction=<span class="string">'on'</span>/&gt;</div><div class="line">    &lt;/controller&gt;</div><div class="line">    &lt;controller <span class="built_in">type</span>=<span class="string">'usb'</span> index=<span class="string">'0'</span> model=<span class="string">'ich9-uhci2'</span>&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'usb'</span>/&gt;</div><div class="line">      &lt;master startport=<span class="string">'2'</span>/&gt;</div><div class="line">      &lt;address <span class="built_in">type</span>=<span class="string">'pci'</span> domain=<span class="string">'0x0000'</span> bus=<span class="string">'0x00'</span> slot=<span class="string">'0x06'</span> <span class="keyword">function</span>=<span class="string">'0x1'</span>/&gt;</div><div class="line">    &lt;/controller&gt;</div><div class="line">    &lt;controller <span class="built_in">type</span>=<span class="string">'usb'</span> index=<span class="string">'0'</span> model=<span class="string">'ich9-uhci3'</span>&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'usb'</span>/&gt;</div><div class="line">      &lt;master startport=<span class="string">'4'</span>/&gt;</div><div class="line">      &lt;address <span class="built_in">type</span>=<span class="string">'pci'</span> domain=<span class="string">'0x0000'</span> bus=<span class="string">'0x00'</span> slot=<span class="string">'0x06'</span> <span class="keyword">function</span>=<span class="string">'0x2'</span>/&gt;</div><div class="line">    &lt;/controller&gt;</div><div class="line">    &lt;controller <span class="built_in">type</span>=<span class="string">'pci'</span> index=<span class="string">'0'</span> model=<span class="string">'pci-root'</span>&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'pci.0'</span>/&gt;</div><div class="line">    &lt;/controller&gt;</div><div class="line">    &lt;controller <span class="built_in">type</span>=<span class="string">'ide'</span> index=<span class="string">'0'</span>&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'ide'</span>/&gt;</div><div class="line">      &lt;address <span class="built_in">type</span>=<span class="string">'pci'</span> domain=<span class="string">'0x0000'</span> bus=<span class="string">'0x00'</span> slot=<span class="string">'0x01'</span> <span class="keyword">function</span>=<span class="string">'0x1'</span>/&gt;</div><div class="line">    &lt;/controller&gt;</div><div class="line">    &lt;controller <span class="built_in">type</span>=<span class="string">'virtio-serial'</span> index=<span class="string">'0'</span>&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'virtio-serial0'</span>/&gt;</div><div class="line">      &lt;address <span class="built_in">type</span>=<span class="string">'pci'</span> domain=<span class="string">'0x0000'</span> bus=<span class="string">'0x00'</span> slot=<span class="string">'0x05'</span> <span class="keyword">function</span>=<span class="string">'0x0'</span>/&gt;</div><div class="line">    &lt;/controller&gt;</div><div class="line">    &lt;interface <span class="built_in">type</span>=<span class="string">'direct'</span>&gt;</div><div class="line">      &lt;mac address=<span class="string">'52:54:00:a5:93:d5'</span>/&gt;</div><div class="line">      &lt;<span class="built_in">source</span> dev=<span class="string">'ovs-system'</span> mode=<span class="string">'bridge'</span>/&gt;</div><div class="line">      &lt;target dev=<span class="string">'macvtap10'</span>/&gt;</div><div class="line">      &lt;model <span class="built_in">type</span>=<span class="string">'virtio'</span>/&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'net0'</span>/&gt;</div><div class="line">      &lt;address <span class="built_in">type</span>=<span class="string">'pci'</span> domain=<span class="string">'0x0000'</span> bus=<span class="string">'0x00'</span> slot=<span class="string">'0x03'</span> <span class="keyword">function</span>=<span class="string">'0x0'</span>/&gt;</div><div class="line">    &lt;/interface&gt;</div><div class="line">    &lt;interface <span class="built_in">type</span>=<span class="string">'direct'</span>&gt;</div><div class="line">      &lt;mac address=<span class="string">'52:54:00:14:02:69'</span>/&gt;</div><div class="line">      &lt;<span class="built_in">source</span> dev=<span class="string">'enp5s0'</span> mode=<span class="string">'bridge'</span>/&gt;</div><div class="line">      &lt;target dev=<span class="string">'macvtap11'</span>/&gt;</div><div class="line">      &lt;model <span class="built_in">type</span>=<span class="string">'virtio'</span>/&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'net1'</span>/&gt;</div><div class="line">      &lt;address <span class="built_in">type</span>=<span class="string">'pci'</span> domain=<span class="string">'0x0000'</span> bus=<span class="string">'0x00'</span> slot=<span class="string">'0x09'</span> <span class="keyword">function</span>=<span class="string">'0x0'</span>/&gt;</div><div class="line">    &lt;/interface&gt;</div><div class="line">    &lt;console <span class="built_in">type</span>=<span class="string">'pty'</span> tty=<span class="string">'/dev/pts/18'</span>&gt;</div><div class="line">      &lt;<span class="built_in">source</span> path=<span class="string">'/dev/pts/18'</span>/&gt;</div><div class="line">      &lt;target <span class="built_in">type</span>=<span class="string">'virtio'</span> port=<span class="string">'0'</span>/&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'console0'</span>/&gt;</div><div class="line">    &lt;/console&gt;</div><div class="line">    &lt;channel <span class="built_in">type</span>=<span class="string">'unix'</span>&gt;</div><div class="line">      &lt;<span class="built_in">source</span> mode=<span class="string">'bind'</span> path=<span class="string">'/var/lib/libvirt/qemu/channel/target/domain-pgsql-xl-gmt/org.qemu.guest_agent.0'</span>/&gt;</div><div class="line">      &lt;target <span class="built_in">type</span>=<span class="string">'virtio'</span> name=<span class="string">'org.qemu.guest_agent.0'</span> state=<span class="string">'disconnected'</span>/&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'channel0'</span>/&gt;</div><div class="line">      &lt;address <span class="built_in">type</span>=<span class="string">'virtio-serial'</span> controller=<span class="string">'0'</span> bus=<span class="string">'0'</span> port=<span class="string">'1'</span>/&gt;</div><div class="line">    &lt;/channel&gt;</div><div class="line">    &lt;channel <span class="built_in">type</span>=<span class="string">'spicevmc'</span>&gt;</div><div class="line">      &lt;target <span class="built_in">type</span>=<span class="string">'virtio'</span> name=<span class="string">'com.redhat.spice.0'</span> state=<span class="string">'disconnected'</span>/&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'channel1'</span>/&gt;</div><div class="line">      &lt;address <span class="built_in">type</span>=<span class="string">'virtio-serial'</span> controller=<span class="string">'0'</span> bus=<span class="string">'0'</span> port=<span class="string">'2'</span>/&gt;</div><div class="line">    &lt;/channel&gt;</div><div class="line">    &lt;input <span class="built_in">type</span>=<span class="string">'tablet'</span> bus=<span class="string">'usb'</span>&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'input0'</span>/&gt;</div><div class="line">    &lt;/input&gt;</div><div class="line">    &lt;input <span class="built_in">type</span>=<span class="string">'mouse'</span> bus=<span class="string">'ps2'</span>/&gt;</div><div class="line">    &lt;input <span class="built_in">type</span>=<span class="string">'keyboard'</span> bus=<span class="string">'ps2'</span>/&gt;</div><div class="line">    &lt;graphics <span class="built_in">type</span>=<span class="string">'spice'</span> port=<span class="string">'5905'</span> autoport=<span class="string">'yes'</span> listen=<span class="string">'127.0.0.1'</span>&gt;</div><div class="line">      &lt;listen <span class="built_in">type</span>=<span class="string">'address'</span> address=<span class="string">'127.0.0.1'</span>/&gt;</div><div class="line">    &lt;/graphics&gt;</div><div class="line">    &lt;video&gt;</div><div class="line">      &lt;model <span class="built_in">type</span>=<span class="string">'qxl'</span> ram=<span class="string">'65536'</span> vram=<span class="string">'65536'</span> vgamem=<span class="string">'16384'</span> heads=<span class="string">'1'</span>/&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'video0'</span>/&gt;</div><div class="line">      &lt;address <span class="built_in">type</span>=<span class="string">'pci'</span> domain=<span class="string">'0x0000'</span> bus=<span class="string">'0x00'</span> slot=<span class="string">'0x02'</span> <span class="keyword">function</span>=<span class="string">'0x0'</span>/&gt;</div><div class="line">    &lt;/video&gt;</div><div class="line">    &lt;redirdev bus=<span class="string">'usb'</span> <span class="built_in">type</span>=<span class="string">'spicevmc'</span>&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'redir0'</span>/&gt;</div><div class="line">    &lt;/redirdev&gt;</div><div class="line">    &lt;redirdev bus=<span class="string">'usb'</span> <span class="built_in">type</span>=<span class="string">'spicevmc'</span>&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'redir1'</span>/&gt;</div><div class="line">    &lt;/redirdev&gt;</div><div class="line">    &lt;redirdev bus=<span class="string">'usb'</span> <span class="built_in">type</span>=<span class="string">'spicevmc'</span>&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'redir2'</span>/&gt;</div><div class="line">    &lt;/redirdev&gt;</div><div class="line">    &lt;redirdev bus=<span class="string">'usb'</span> <span class="built_in">type</span>=<span class="string">'spicevmc'</span>&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'redir3'</span>/&gt;</div><div class="line">    &lt;/redirdev&gt;</div><div class="line">    &lt;memballoon model=<span class="string">'virtio'</span>&gt;</div><div class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">'balloon0'</span>/&gt;</div><div class="line">      &lt;address <span class="built_in">type</span>=<span class="string">'pci'</span> domain=<span class="string">'0x0000'</span> bus=<span class="string">'0x00'</span> slot=<span class="string">'0x08'</span> <span class="keyword">function</span>=<span class="string">'0x0'</span>/&gt;</div><div class="line">    &lt;/memballoon&gt;</div><div class="line">  &lt;/devices&gt;</div><div class="line">  &lt;seclabel <span class="built_in">type</span>=<span class="string">'dynamic'</span> model=<span class="string">'apparmor'</span> relabel=<span class="string">'yes'</span>&gt;</div><div class="line">    &lt;label&gt;libvirt-0fdbcbe7<span class="_">-f</span>7e9-443e-bf9b-7ac4a6d27612&lt;/label&gt;</div><div class="line">    &lt;imagelabel&gt;libvirt-0fdbcbe7<span class="_">-f</span>7e9-443e-bf9b-7ac4a6d27612&lt;/imagelabel&gt;</div><div class="line">  &lt;/seclabel&gt;</div><div class="line">&lt;/domain&gt;</div></pre></td></tr></table></figure>
<h1 id="配置基础系统"><a href="#配置基础系统" class="headerlink" title="配置基础系统"></a>配置基础系统</h1><ul>
<li>在虚拟机里安装相关的软件并配置好环境,配置好各虚拟机之间自动使用证书登录 SSH 的功能.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ip addr</span></div><div class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</div><div class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</div><div class="line">    inet 127.0.0.1/8 scope host lo</div><div class="line">       valid_lft forever preferred_lft forever</div><div class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</div><div class="line">    link/ether 52:54:00:a5:93:d5 brd ff:ff:ff:ff:ff:ff</div><div class="line">    inet 192.168.120.20/24 brd 192.168.120.255 scope global eth0</div><div class="line">       valid_lft forever preferred_lft forever</div><div class="line">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</div><div class="line">    link/ether 52:54:00:14:02:69 brd ff:ff:ff:ff:ff:ff</div><div class="line">    inet 192.168.25.20/24 brd 192.168.25.255 scope global eth1</div><div class="line">       valid_lft forever preferred_lft forever</div></pre></td></tr></table></figure>
<ul>
<li>安装如下的软件包:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">// 安装编译环境</div><div class="line"><span class="comment"># yum install -y flex bison readline-devel zlib-devel openjade docbook-style-dsssl gcc git tmux libuuid libuuid-devel pcre pcre-devel openssl-devel perl curl</span></div><div class="line"></div><div class="line">// 添加用户</div><div class="line"></div><div class="line"><span class="comment"># groupadd postgres</span></div><div class="line"><span class="comment"># useradd -g postgres postgres</span></div><div class="line"><span class="comment"># mkdir /home/postgres &amp;&amp; chown postgres.postgres -R /home/postgres</span></div><div class="line"></div><div class="line">// 关闭防火墙,不然会有多问题.</div><div class="line"><span class="comment"># systemctl disable iptables.service</span></div><div class="line"><span class="comment"># iptables -F ; iptables -X</span></div><div class="line"></div><div class="line">// 关闭SELINUX,修改配置文件/etc/selinux/config，将SELINU置为disabled</div><div class="line"><span class="comment"># setenforce 0</span></div><div class="line">// OR</div><div class="line"><span class="comment"># sed -i '/SELINUX/s/enforcing/disabled/' /etc/selinux/config</span></div><div class="line"></div><div class="line">//预先配置好主机名与IP对应如下</div><div class="line"></div><div class="line"><span class="comment"># cat /etc/hosts</span></div><div class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">192.168.120.19 coord1</div><div class="line">192.168.120.18 gtmproxy</div><div class="line">192.168.120.20 gtmnode</div><div class="line">192.168.120.21 node01</div><div class="line">192.168.120.22 node02</div><div class="line">192.168.120.23 node03</div></pre></td></tr></table></figure>
<ul>
<li>修改内核参数,系统限制,有些参数要根据需求修改</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">vm.swappiness = 0</div><div class="line">net.ipv4.neigh.default.gc_stale_time = 120</div><div class="line">net.ipv4.conf.all.rp_filter = 0</div><div class="line">net.ipv4.conf.default.rp_filter = 0</div><div class="line">net.ipv4.conf.default.arp_announce = 2</div><div class="line">net.ipv4.conf.all.arp_announce = 2</div><div class="line">net.ipv4.tcp_max_tw_buckets = 10000</div><div class="line">net.ipv4.tcp_syncookies = 0</div><div class="line">net.ipv4.tcp_max_syn_backlog = 3240000</div><div class="line">net.ipv4.tcp_synack_retries = 2</div><div class="line">net.ipv6.conf.all.disable_ipv6 = 1</div><div class="line">net.ipv6.conf.default.disable_ipv6 = 1</div><div class="line">net.ipv6.conf.lo.disable_ipv6 = 1</div><div class="line">net.ipv4.conf.lo.arp_announce = 2</div><div class="line">fs.file-max = 40000500</div><div class="line">fs.nr_open = 40000500</div><div class="line">net.ipv4.tcp_tw_reuse = 1</div><div class="line">net.ipv4.tcp_tw_recycle = 1</div><div class="line">net.ipv4.tcp_keepalive_time = 1</div><div class="line">net.ipv4.tcp_keepalive_intvl = 4</div><div class="line">net.ipv4.tcp_keepalive_probes = 3</div><div class="line">net.ipv4.tcp_fin_timeout = 5</div><div class="line">net.ipv4.tcp_mem = 768432 2097152 15242880</div><div class="line">net.ipv4.tcp_rmem = 4096 4096 33554432</div><div class="line">net.ipv4.tcp_wmem = 4096 4096 33554432</div><div class="line">net.core.somaxconn = 32768</div><div class="line">net.ipv4.ip_local_port_range = 1025 65000</div><div class="line">net.core.wmem_default = 183888608</div><div class="line">net.core.rmem_default = 183888608</div><div class="line">net.core.rmem_max = 33554432</div><div class="line">net.core.wmem_max = 33554432</div><div class="line">net.core.netdev_max_backlog = 2621244</div><div class="line">kernel.sem = 250 65536 100 2048</div><div class="line">kernel.shmmni = 655360</div><div class="line">kernel.shmmax = 34359738368</div><div class="line">kernel.msgmni = 65535</div><div class="line">kernel.msgmax = 65536</div><div class="line">kernel.msgmnb = 65536</div><div class="line">net.netfilter.nf_conntrack_max = 1000000</div><div class="line">net.nf_conntrack_max = 1000000</div><div class="line">kernel.perf_event_max_sample_rate = 6250</div><div class="line">net.ipv4.tcp_max_orphans = 1048576</div><div class="line">kernel.sched_migration_cost_ns = 5000000</div><div class="line">net.core.optmem_max = 25165824</div><div class="line">kernel.sem = 10000 2560000 10000 256</div><div class="line"></div><div class="line"><span class="comment"># ulimit -a</span></div><div class="line">core file size          (blocks, -c) 0</div><div class="line">data seg size           (kbytes, <span class="_">-d</span>) unlimited</div><div class="line">scheduling priority             (<span class="_">-e</span>) 0</div><div class="line">file size               (blocks, <span class="_">-f</span>) unlimited</div><div class="line">pending signals                 (-i) 515045</div><div class="line">max locked memory       (kbytes, <span class="_">-l</span>) 64</div><div class="line">max memory size         (kbytes, -m) unlimited</div><div class="line">open files                      (-n) 20000500</div><div class="line">pipe size            (512 bytes, -p) 8</div><div class="line">POSIX message queues     (bytes, -q) 819200</div><div class="line">real-time priority              (-r) 0</div><div class="line">stack size              (kbytes, <span class="_">-s</span>) 8192</div><div class="line">cpu time               (seconds, -t) unlimited</div><div class="line">max user processes              (-u) 515045</div><div class="line">virtual memory          (kbytes, -v) unlimited</div><div class="line">file locks                      (-x) unlimited</div></pre></td></tr></table></figure>
<h2 id="编译-PostgreSQL-XL"><a href="#编译-PostgreSQL-XL" class="headerlink" title="编译 PostgreSQL-XL"></a>编译 PostgreSQL-XL</h2><ul>
<li>使用 git clone clone 下载源代码<a href="http://git.postgresql.org/gitweb/?p=postgres-xl.git;a=summary" target="_blank" rel="external">postgresql-xl</a>,或者下载源码包.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># curl -O http://files.postgres-xl.org/postgres-xl-9.5r1.4.tar.gz</span></div><div class="line"><span class="comment"># tar xvf postgres-xl-9.5r1.4.tar.gz</span></div><div class="line"><span class="comment"># cd postgres-xl-9.5r1.4 &amp;&amp; ./configure &amp;&amp; make &amp;&amp; make install</span></div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">//默认安装在这里</div><div class="line"><span class="comment"># ls /usr/local/pgsql/</span></div><div class="line">bin  include  lib  share</div></pre></td></tr></table></figure>
<h2 id="设置-postgres-用户的变量"><a href="#设置-postgres-用户的变量" class="headerlink" title="设置 postgres 用户的变量"></a>设置 postgres 用户的变量</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ cat .bashrc</div><div class="line"><span class="comment"># .bashrc</span></div><div class="line"><span class="comment"># User specific aliases and functions</span></div><div class="line"></div><div class="line"><span class="built_in">alias</span> rm=<span class="string">'rm -i'</span></div><div class="line"><span class="built_in">alias</span> cp=<span class="string">'cp -i'</span></div><div class="line"><span class="built_in">alias</span> mv=<span class="string">'mv -i'</span></div><div class="line"></div><div class="line"><span class="comment"># Source global definitions</span></div><div class="line"><span class="keyword">if</span> [ <span class="_">-f</span> /etc/bashrc ]; <span class="keyword">then</span></div><div class="line">        . /etc/bashrc</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="built_in">export</span> PGUSER=postgres</div><div class="line"><span class="comment"># export PGHOME=/usr/local/pgxl-9.5-stable</span></div><div class="line"><span class="built_in">export</span> PGHOME=/usr/<span class="built_in">local</span>/pgsql</div><div class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$PGHOME</span>/lib:<span class="variable">$LD_LIBRARY_PATH</span></div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$HOME</span>/bin:<span class="variable">$PGHOME</span>/bin:<span class="variable">$PATH</span></div></pre></td></tr></table></figure>
<h2 id="配置-PostgreSQL-XL"><a href="#配置-PostgreSQL-XL" class="headerlink" title="配置 PostgreSQL-XL"></a>配置 PostgreSQL-XL</h2><ul>
<li>上面的操作配置了一台虚拟机环境并且编译好了<code>Postgresql-XL</code>,现在此基础上克隆 5 台虚拟机出来,并修它们的网卡与主机名</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 确保做好SSH公钥认证登录</div><div class="line"><span class="comment"># for name in node01 node02 node03 coord1 gtmnode gtmproxy;  do &gt;     ssh $&#123;name&#125; "echo $&#123;name&#125; &gt; /etc/hostname";done</span></div></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># virsh  list</span></div><div class="line"> Id    Name                           State</div><div class="line">----------------------------------------------------</div><div class="line"> 52    pgsql-xl-coord1                 running</div><div class="line"> 53    pgsql-xl-gmtnode                running</div><div class="line"> 54    pgsql-xl-node01                 running</div><div class="line"> 55    pgsql-xl-node02                 running</div><div class="line"> 56    pgsql-xl-node03                 running</div><div class="line"> 57    pgsql-xl-gtmproxy               running</div></pre></td></tr></table></figure>
<ul>
<li>所有虚拟机都修改主机名与 IP,并且可以相互自动登录.现在到<code>gtmnode</code>这台机上的<code>postgres</code>用户下去部署 Postgresql-XL 集群了.</li>
</ul>
<ul>
<li>使用命令<code>pgxc_ctl prepare config minimal</code>,生成默认配置文件.里面配置比较多.这里要相应的修改.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> tree /home/postgres/</div><div class="line">/home/postgres/</div><div class="line">├── pgxc_ctl</div><div class="line">│   ├── coordExtraConfig</div><div class="line">│   ├── pgxc_ctl.conf</div></pre></td></tr></table></figure>
<ul>
<li>这里根据前面定的虚拟机数量,做了如下修改:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">[postgres@gtmnode ~]$ cat pgxc_ctl/pgxc_ctl.conf | grep -v <span class="string">'^#'</span> | grep -v <span class="string">'^$'</span>                                                                                                                                                                                       [114/1896]</div><div class="line">pgxcInstallDir=<span class="variable">$HOME</span>/pgxc</div><div class="line">pgxcOwner=<span class="variable">$USER</span>                 <span class="comment"># owner of the Postgres-XC databaseo cluster.  Here, we use this</span></div><div class="line">                                                <span class="comment"># both as linus user and database user.  This must be</span></div><div class="line">                                                <span class="comment"># the super user of each coordinator and datanode.</span></div><div class="line">pgxcUser=<span class="variable">$pgxcOwner</span>             <span class="comment"># OS user of Postgres-XC owner</span></div><div class="line">tmpDir=/tmp                                     <span class="comment"># temporary dir used in XC servers</span></div><div class="line"><span class="built_in">local</span>TmpDir=<span class="variable">$tmpDir</span>                     <span class="comment"># temporary dir used here locally</span></div><div class="line">configBackup=n                                  <span class="comment"># If you want config file backup, specify y to this value.</span></div><div class="line">configBackupHost=pgxc-linker    <span class="comment"># host to backup config file</span></div><div class="line">configBackupDir=<span class="variable">$HOME</span>/pgxc              <span class="comment"># Backup directory</span></div><div class="line">configBackupFile=pgxc_ctl.bak   <span class="comment"># Backup file name --&gt; Need to synchronize when original changed.</span></div><div class="line">gtmMasterServer=192.168.120.20</div><div class="line">gtmMasterPort=20001</div><div class="line">gtmMasterDir=<span class="variable">$HOME</span>/pgxc/nodes/gtm</div><div class="line">gtmExtraConfig=none                     <span class="comment"># Will be added gtm.conf for both Master and Slave (done at initilization only)</span></div><div class="line">gtmMasterSpecificExtraConfig=none       <span class="comment"># Will be added to Master's gtm.conf (done at initialization only)</span></div><div class="line">gtmSlave=n                                      <span class="comment"># Specify y if you configure GTM Slave.   Otherwise, GTM slave will not be configured and</span></div><div class="line">                                                        <span class="comment"># all the following variables will be reset.</span></div><div class="line">gtmSlaveName=gtmSlave</div><div class="line">gtmSlaveServer=node12           <span class="comment"># value none means GTM slave is not available.  Give none if you don't configure GTM Slave.</span></div><div class="line">gtmSlavePort=20001                      <span class="comment"># Not used if you don't configure GTM slave.</span></div><div class="line">gtmSlaveDir=<span class="variable">$HOME</span>/pgxc/nodes/gtm        <span class="comment"># Not used if you don't configure GTM slave.</span></div><div class="line">gtmSlaveSpecificExtraConfig=none <span class="comment"># Will be added to Slave's gtm.conf (done at initialization only)</span></div><div class="line">gtmProxyDir=<span class="variable">$HOME</span>/pgxc/nodes/gtm_pxy</div><div class="line">gtmProxy=n                              <span class="comment"># Specify y if you conifugre at least one GTM proxy.   You may not configure gtm proxies</span></div><div class="line">                                                <span class="comment"># only when you dont' configure GTM slaves.</span></div><div class="line">                                                <span class="comment"># If you specify this value not to y, the following parameters will be set to default empty values.</span></div><div class="line">                                                <span class="comment"># If we find there're no valid Proxy server names (means, every servers are specified</span></div><div class="line">                                                <span class="comment"># as none), then gtmProxy value will be set to "n" and all the entries will be set to</span></div><div class="line">                                                <span class="comment"># empty values.</span></div><div class="line">gtmProxyNames=(gtm_pxy1 gtm_pxy2 gtm_pxy3 gtm_pxy4)     <span class="comment"># No used if it is not configured</span></div><div class="line">gtmProxyServers=(node06 node07 node08 node09)                   <span class="comment"># Specify none if you dont' configure it.</span></div><div class="line">gtmProxyPorts=(20001 20001 20001 20001)                         <span class="comment"># Not used if it is not configured.</span></div><div class="line">gtmProxyDirs=(<span class="variable">$gtmProxyDir</span> <span class="variable">$gtmProxyDir</span> <span class="variable">$gtmProxyDir</span> <span class="variable">$gtmProxyDir</span>)      <span class="comment"># Not used if it is not configured.</span></div><div class="line">gtmPxyExtraConfig=none          <span class="comment"># Extra configuration parameter for gtm_proxy.  Coordinator section has an example.</span></div><div class="line">gtmPxySpecificExtraConfig=(none none none none)</div><div class="line">coordMasterDir=<span class="variable">$HOME</span>/pgxc/nodes/coord</div><div class="line">coordSlaveDir=<span class="variable">$HOME</span>/pgxc/nodes/coord_slave</div><div class="line">coordArchLogDir=<span class="variable">$HOME</span>/pgxc/nodes/coord_archlog</div><div class="line">coordNames=(coord1 coord2 )             <span class="comment"># Master and slave use the same name</span></div><div class="line">coordPorts=(20004 20004 )                       <span class="comment"># Master ports</span></div><div class="line">poolerPorts=(6433 6433 )                        <span class="comment"># Master pooler ports</span></div><div class="line">coordPgHbaEntries=(192.168.120.0/24)                            <span class="comment"># Assumes that all the coordinator (master/slave) accepts</span></div><div class="line">                                                                                                <span class="comment"># the same connection</span></div><div class="line">                                                                                                <span class="comment"># This entry allows only $pgxcOwner to connect.</span></div><div class="line">                                                                                                <span class="comment"># If you'd like to setup another connection, you should</span></div><div class="line">                                                                                                <span class="comment"># supply these entries through files specified below.</span></div><div class="line">coordMasterServers=(coord1 coord2)              <span class="comment"># none means this master is not available</span></div><div class="line">coordMasterDirs=(<span class="variable">$coordMasterDir</span> <span class="variable">$coordMasterDir</span> )</div><div class="line">coordMaxWALsernder=5    <span class="comment"># max_wal_senders: needed to configure slave. If zero value is specified,</span></div><div class="line">                                                <span class="comment"># it is expected to supply this parameter explicitly by external files</span></div><div class="line">                                                <span class="comment"># specified in the following.   If you don't configure slaves, leave this value to zero.</span></div><div class="line">coordMaxWALSenders=(<span class="variable">$coordMaxWALsernder</span> <span class="variable">$coordMaxWALsernder</span> )</div><div class="line">                                                <span class="comment"># max_wal_senders configuration for each coordinator.</span></div><div class="line">                                                <span class="comment"># postgresql.conf</span></div><div class="line">cat &gt; <span class="variable">$coordExtraConfig</span> &lt;&lt;EOF</div><div class="line">log_destination = <span class="string">'stderr'</span></div><div class="line">logging_collector = on</div><div class="line">log_directory = <span class="string">'pg_log'</span></div><div class="line">listen_addresses = <span class="string">'*'</span></div><div class="line">max_connections = 100</div><div class="line">EOF</div><div class="line">coordSpecificExtraConfig=(none none none none)</div><div class="line">coordExtraPgHba=none    <span class="comment"># Extra entry for pg_hba.conf.  This file will be added to all the coordinators' pg_hba.conf</span></div><div class="line">coordSpecificExtraPgHba=(none none none none)</div><div class="line">coordAdditionalSlaves=n         <span class="comment"># Additional slave can be specified as follows: where you</span></div><div class="line">coordAdditionalSlaveSet=(cad1)          <span class="comment"># Each specifies set of slaves.   This case, two set of slaves are</span></div><div class="line">                                                                                        <span class="comment"># configured</span></div><div class="line">cad1_Sync=n                             <span class="comment"># All the slaves at "cad1" are connected with asynchronous mode.</span></div><div class="line">                                                        <span class="comment"># If not, specify "y"</span></div><div class="line">                                                        <span class="comment"># The following lines specifies detailed configuration for each</span></div><div class="line">                                                        <span class="comment"># slave tag, cad1.  You can define cad2 similarly.</span></div><div class="line">cad1_Servers=(node08 node09 node06 node07)      <span class="comment"># Hosts</span></div><div class="line">cad1_dir=<span class="variable">$HOME</span>/pgxc/nodes/coord_slave_cad1</div><div class="line">cad1_Dirs=(<span class="variable">$cad1_dir</span> <span class="variable">$cad1_dir</span> <span class="variable">$cad1_dir</span> <span class="variable">$cad1_dir</span>)</div><div class="line">cad1_ArchLogDir=<span class="variable">$HOME</span>/pgxc/nodes/coord_archlog_cad1</div><div class="line">cad1_ArchLogDirs=(<span class="variable">$cad1_ArchLogDir</span> <span class="variable">$cad1_ArchLogDir</span> <span class="variable">$cad1_ArchLogDir</span> <span class="variable">$cad1_ArchLogDir</span>)</div><div class="line">datanodeMasterDir=<span class="variable">$HOME</span>/pgxc/nodes/dn_master</div><div class="line">datanodeSlaveDir=<span class="variable">$HOME</span>/pgxc/nodes/dn_slave</div><div class="line">datanodeArchLogDir=<span class="variable">$HOME</span>/pgxc/nodes/datanode_archlog</div><div class="line">primaryDatanode=node01</div><div class="line">datanodeNames=(node01 node02 node03)</div><div class="line">datanodePorts=(5432 5432 5432 ) <span class="comment"># Master ports</span></div><div class="line">datanodePoolerPorts=(6432 6432 6432 )   <span class="comment"># Master pooler ports</span></div><div class="line">datanodePgHbaEntries=(192.168.120.0/24) <span class="comment"># Assumes that all the coordinator (master/slave) accepts</span></div><div class="line">                                                                                <span class="comment"># the same connection</span></div><div class="line">                                                                                <span class="comment"># This list sets up pg_hba.conf for $pgxcOwner user.</span></div><div class="line">                                                                                <span class="comment"># If you'd like to setup other entries, supply them</span></div><div class="line">                                                                                <span class="comment"># through extra configuration files specified below.</span></div><div class="line">datanodeMasterServers=(node01 node02 node03)    <span class="comment"># none means this master is not available.</span></div><div class="line">                                                                                                        <span class="comment"># This means that there should be the master but is down.</span></div><div class="line">                                                                                                        <span class="comment"># The cluster is not operational until the master is</span></div><div class="line">                                                                                                        <span class="comment"># recovered and ready to run.</span></div><div class="line">datanodeMasterDirs=(<span class="variable">$datanodeMasterDir</span> <span class="variable">$datanodeMasterDir</span> <span class="variable">$datanodeMasterDir</span> )</div><div class="line">datanodeMaxWalSender=5                                                          <span class="comment"># max_wal_senders: needed to configure slave. If zero value is</span></div><div class="line">                                                                                                        <span class="comment"># specified, it is expected this parameter is explicitly supplied</span></div><div class="line">                                                                                                        <span class="comment"># by external configuration files.</span></div><div class="line">                                                                                                        <span class="comment"># If you don't configure slaves, leave this value zero.</span></div><div class="line">datanodeMaxWALSenders=(<span class="variable">$datanodeMaxWalSender</span> <span class="variable">$datanodeMaxWalSender</span> <span class="variable">$datanodeMaxWalSender</span> )</div><div class="line">                                                <span class="comment"># max_wal_senders configuration for each datanode</span></div><div class="line">datanodeSlave=n                 <span class="comment"># Specify y if you configure at least one coordiantor slave.  Otherwise, the following</span></div><div class="line">                                                <span class="comment"># configuration parameters will be set to empty values.</span></div><div class="line">                                                <span class="comment"># If no effective server names are found (that is, every servers are specified as none),</span></div><div class="line">                                                <span class="comment"># then datanodeSlave value will be set to n and all the following values will be set to</span></div><div class="line">                                                <span class="comment"># empty values.</span></div><div class="line">datanodeSlaveServers=(node07 node08 node09 node06)      <span class="comment"># value none means this slave is not available</span></div><div class="line">datanodeSlavePorts=(20008 20009 20008 20009)    <span class="comment"># value none means this slave is not available</span></div><div class="line"></div><div class="line"></div><div class="line">datanodeSlavePorts=(20008 20009 20008 20009)    <span class="comment"># value none means this slave is not available</span></div><div class="line">datanodeSlavePoolerPorts=(20012 20013 20012 20013)      <span class="comment"># value none means this slave is not available</span></div><div class="line">datanodeSlaveSync=y             <span class="comment"># If datanode slave is connected in synchronized mode</span></div><div class="line">datanodeSlaveDirs=(<span class="variable">$datanodeSlaveDir</span> <span class="variable">$datanodeSlaveDir</span> <span class="variable">$datanodeSlaveDir</span> <span class="variable">$datanodeSlaveDir</span>)</div><div class="line">datanodeArchLogDirs=( <span class="variable">$datanodeArchLogDir</span> <span class="variable">$datanodeArchLogDir</span> <span class="variable">$datanodeArchLogDir</span> <span class="variable">$datanodeArchLogDir</span> )</div><div class="line">datanodeExtraConfig=none        <span class="comment"># Extra configuration file for datanodes.  This file will be added to all the</span></div><div class="line">                                                        <span class="comment"># datanodes' postgresql.conf</span></div><div class="line">datanodeSpecificExtraConfig=(none none none none)</div><div class="line">datanodeExtraPgHba=none         <span class="comment"># Extra entry for pg_hba.conf.  This file will be added to all the datanodes' postgresql.conf</span></div><div class="line">datanodeSpecificExtraPgHba=(none none none none)</div><div class="line">datanodeAdditionalSlaves=n      <span class="comment"># Additional slave can be specified as follows: where you</span></div><div class="line">                                                                                        <span class="comment"># configured</span></div><div class="line">                                                        <span class="comment"># If not, specify "y"</span></div><div class="line">                                                        <span class="comment"># The following lines specifies detailed configuration for each</span></div><div class="line">                                                        <span class="comment"># slave tag, cad1.  You can define cad2 similarly.</span></div><div class="line">walArchive=n    <span class="comment"># If you'd like to configure WAL archive, edit this section.</span></div><div class="line">                                <span class="comment"># Pgxc_ctl assumes that if you configure WAL archive, you configure it</span></div><div class="line">                                <span class="comment"># for all the coordinators and datanodes.</span></div><div class="line">                                <span class="comment"># Default is "no".   Please specify "y" here to turn it on.</span></div><div class="line">walArchiveSet=(war1 war2)</div><div class="line">war1_source=(master)    <span class="comment"># you can specify master, slave or ano other additional slaves as a source of WAL archive.</span></div><div class="line">                                        <span class="comment"># Default is the master</span></div><div class="line">wal1_source=(slave)</div><div class="line">wal1_source=(additiona_coordinator_slave_set additional_datanode_slave_set)</div><div class="line">war1_host=node10        <span class="comment"># All the nodes are backed up at the same host for a given archive set</span></div><div class="line">war1_backupdir=<span class="variable">$HOME</span>/pgxc/backup_war1</div><div class="line">wal2_source=(master)</div><div class="line">war2_host=node11</div><div class="line">war2_backupdir=<span class="variable">$HOME</span>/pgxc/backup_war2</div><div class="line">coordSlave=n</div><div class="line">coordNames=( coord1 none  )</div><div class="line">coordMasterDirs=( /home/postgres/pgxc/nodes/coord none  )</div><div class="line">coordPorts=( 20004 -1  )</div><div class="line">poolerPorts=( 6433 -1  )</div><div class="line">coordMasterServers=( coord1 none  )</div><div class="line">coordMaxWALSenders=( 5 0  )</div><div class="line">coordSlaveServers=( none none  )</div><div class="line">coordSlavePorts=( none none  )</div><div class="line">coordSlavePoolerPorts=( none none  )</div><div class="line">coordSlaveDirs=( none none  )</div><div class="line">coordArchLogDirs=( none none  )</div><div class="line">coordSpecificExtraConfig=( none none none none  )</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### 这里在pgxc_ctl 命令中中修改的,这里的gtmProxy=y 把前的gtmProxy=n给替换掉了,</span></div><div class="line"></div><div class="line"></div><div class="line">gtmProxy=y</div><div class="line">gtmProxyNames=( gtm_pxy  )</div><div class="line">gtmProxyServers=( 192.168.120.18  )</div><div class="line">gtmProxyPorts=( 20009  )</div><div class="line">gtmProxyDirs=( <span class="variable">$HOME</span>/pgxc/nodes/gtm_pxy  )</div><div class="line">gtmPxySpecificExtraConfig=( none  )</div></pre></td></tr></table></figure>
<ul>
<li>请注意这里面配置的主机名要与机器一一对应上,关闭防火墙,初始化集群.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[postgres@gtmnode ~]$ pgxc_ctl init all</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line"></div><div class="line">[postgres@gtmnode ~]$ pgxc_ctl</div><div class="line">/bin/bash</div><div class="line">Installing pgxc_ctl_bash script as /home/postgres/pgxc_ctl/pgxc_ctl_bash.</div><div class="line">Installing pgxc_ctl_bash script as /home/postgres/pgxc_ctl/pgxc_ctl_bash.</div><div class="line">Reading configuration using /home/postgres/pgxc_ctl/pgxc_ctl_bash --home /home/postgres/pgxc_ctl --configuration /home/postgres/pgxc_ctl/pgxc_ctl.conf</div><div class="line">Finished reading configuration.</div><div class="line">   ******** PGXC_CTL START ***************</div><div class="line"></div><div class="line">Current directory: /home/postgres/pgxc_ctl</div><div class="line">PGXC <span class="built_in">help</span></div><div class="line">You are using pgxc_ctl, the configuration utility <span class="keyword">for</span> PGXL</div><div class="line">Type:</div><div class="line">        <span class="built_in">help</span> &lt;<span class="built_in">command</span>&gt;</div><div class="line">        <span class="built_in">where</span> &lt;<span class="built_in">command</span>&gt; is either add, Createdb, Createuser, clean,</div><div class="line">                configure, deploy, failover, init, <span class="built_in">kill</span>, <span class="built_in">log</span>, monitor,</div><div class="line">                prepare, q, reconnect, remove, <span class="built_in">set</span>, show, start,</div><div class="line">                stop or unregister</div></pre></td></tr></table></figure>
<h2 id="调优数据库"><a href="#调优数据库" class="headerlink" title="调优数据库"></a>调优数据库</h2><ul>
<li>这里是参考<a href="http://www.wanghengbin.com/2016/07/04/postgres-xl-presstest-optimize/" target="_blank" rel="external">Postgres XL 压力测试与性能调优</a>做的调整</li>
</ul>
<ul>
<li>Coordinator 节点的 postgresql.conf</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">max_connections = 200          <span class="comment"># 允许的最大并发连接数</span></div><div class="line">max_prepared_transactions = 200       <span class="comment"># 允许的最大预提交事务数，与更新操作相关</span></div><div class="line">shared_buffers = 8GB            <span class="comment"># 用于缓存数据的内存（推荐内存的1/4)</span></div><div class="line">temp_buffers = 80MB</div><div class="line">work_mem = 100MB                <span class="comment"># 用于内部排序和一些复杂的查询的内存</span></div><div class="line">dynamic_shared_memory_type = posix</div><div class="line">max_files_per_process = 2000</div><div class="line">effective_io_concurrency = 8</div><div class="line">max_worker_processes = 64</div><div class="line">effective_cache_size = 8GB</div><div class="line">max_pool_size = 1600            <span class="comment"># Coordinator与Datanode之间的连接池的最大连接数</span></div><div class="line">pool_conn_keepalive = 600</div><div class="line">persistent_datanode_connections = on</div></pre></td></tr></table></figure>
<ul>
<li>Datanode 节点 postgresql.conf</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">max_connections = 1600</div><div class="line">shared_buffers = 8GB</div><div class="line">temp_buffers = 80MB</div><div class="line">dynamic_shared_memory_type = posix</div><div class="line">effective_io_concurrency = 8</div><div class="line">max_worker_processes = 32</div><div class="line">random_page_cost = 1.5</div><div class="line">effective_cache_size = 24GB</div><div class="line">max_prepared_transactions = 100</div><div class="line">persistent_datanode_connections = on</div></pre></td></tr></table></figure>
<ul>
<li>GtmProxy 节点 gtm_pxy.conf</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">worker_threads = 2</div><div class="line">keepalives_idle = 120</div><div class="line">keepalives_interval = 30</div><div class="line">keepalives_count = 2</div></pre></td></tr></table></figure>
<p>Gtm 节点 gtm.conf</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">keepalives_idle = 120</div><div class="line">keepalives_interval = 30</div><div class="line">keepalives_count = 50</div></pre></td></tr></table></figure>
<h3 id="安装-Pgbouncer-连接池"><a href="#安装-Pgbouncer-连接池" class="headerlink" title="安装 Pgbouncer 连接池"></a>安装 Pgbouncer 连接池</h3><ul>
<li>pgbouncer 是 PostgreSQL 的一个轻量级连接池，可以给客户端提供一个统一的视图。</li>
<li><p>pgbouncer 的作用:<br>a)pgbouncer 可以在后端数据库和前端应用间简历连接的桥梁，由 pgbouncer 去处理和后端的连接关系。<br>b)对客户端的连接进行限制，防止过多的恶意连接。</p>
</li>
<li><p>pgbouncer 的特点：<br>a)内存消耗低。（默认 2k/连接）<br>b)可以把不同的数据库连接到一个机器上，而对客户端保持透明。<br>c)支持在线的重行配置而无需重启。</p>
</li>
</ul>
<hr>
<h3 id="谢谢支持"><a href="#谢谢支持" class="headerlink" title="谢谢支持"></a>谢谢支持</h3><ul>
<li>微信二维码:</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Postgresql/" rel="tag"># Postgresql</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/12/21/工作中的一些Bash-shell测试脚本/" rel="next" title="工作中的一些Bash shell测试脚本">
                <i class="fa fa-chevron-left"></i> 工作中的一些Bash shell测试脚本
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/01/08/Qt的一些开发技巧/" rel="prev" title="Qt的一些开发技巧">
                Qt的一些开发技巧 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://avatars0.githubusercontent.com/u/321919?s=400&u=67298bd9fc3b622eaf93a6cc511a24ac878e86db&v=4"
                alt="yjdwbj" />
            
              <p class="site-author-name" itemprop="name">yjdwbj</p>
              <p class="site-description motion-element" itemprop="description">最是人间留不住,朱颜辞镜花辞树</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">40</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">分类</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">35</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/yjdwbj" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:yjdwbj@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://plus.google.com/yjdwbj" target="_blank" title="Google"><i class="fa fa-fw fa-google"></i>Google</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#安装主机系统"><span class="nav-number">1.</span> <span class="nav-text">安装主机系统</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装基础系统"><span class="nav-number">2.</span> <span class="nav-text">安装基础系统</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#配置基础系统"><span class="nav-number">3.</span> <span class="nav-text">配置基础系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#编译-PostgreSQL-XL"><span class="nav-number">3.1.</span> <span class="nav-text">编译 PostgreSQL-XL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置-postgres-用户的变量"><span class="nav-number">3.2.</span> <span class="nav-text">设置 postgres 用户的变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置-PostgreSQL-XL"><span class="nav-number">3.3.</span> <span class="nav-text">配置 PostgreSQL-XL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#调优数据库"><span class="nav-number">3.4.</span> <span class="nav-text">调优数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装-Pgbouncer-连接池"><span class="nav-number">3.4.1.</span> <span class="nav-text">安装 Pgbouncer 连接池</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#谢谢支持"><span class="nav-number">3.4.2.</span> <span class="nav-text">谢谢支持</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yjdwbj</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.2.2</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.2.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.2.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.2.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.2.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.2.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>为Radeon驱动编译Mesa-GLX支持 | 码农记事本</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="本人有空会折腾编译最新的Linux内核,使用的笔记本电脑又AMD的平台,AMD显卡fglrx驱动一直是一个巨大的坑,没有一次可以完全正常编译的,对于不同的内核本版要打无数的补丁才能编译成功,且它的驱动不支持VAPDU特性.对于不是很新的显卡用开源的radeon驱动都能很好的使用.
[参考链接]Mesa-12.0.1
安装依赖库LLVM-3.8下载LLVM3.8后解压到/usr/local/clan">
<meta property="og:type" content="article">
<meta property="og:title" content="为Radeon驱动编译Mesa-GLX支持">
<meta property="og:url" content="http://yjdwbj.github.io/2016/08/06/为Radeon驱动编译Mesa-GLX支持/index.html">
<meta property="og:site_name" content="码农记事本">
<meta property="og:description" content="本人有空会折腾编译最新的Linux内核,使用的笔记本电脑又AMD的平台,AMD显卡fglrx驱动一直是一个巨大的坑,没有一次可以完全正常编译的,对于不同的内核本版要打无数的补丁才能编译成功,且它的驱动不支持VAPDU特性.对于不是很新的显卡用开源的radeon驱动都能很好的使用.
[参考链接]Mesa-12.0.1
安装依赖库LLVM-3.8下载LLVM3.8后解压到/usr/local/clan">
<meta property="og:image" content="http://yjdwbj.github.io/imgs/wx_shoukuan.png">
<meta property="og:updated_time" content="2016-12-14T14:19:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="为Radeon驱动编译Mesa-GLX支持">
<meta name="twitter:description" content="本人有空会折腾编译最新的Linux内核,使用的笔记本电脑又AMD的平台,AMD显卡fglrx驱动一直是一个巨大的坑,没有一次可以完全正常编译的,对于不同的内核本版要打无数的补丁才能编译成功,且它的驱动不支持VAPDU特性.对于不是很新的显卡用开源的radeon驱动都能很好的使用.
[参考链接]Mesa-12.0.1
安装依赖库LLVM-3.8下载LLVM3.8后解压到/usr/local/clan">
<meta name="twitter:image" content="http://yjdwbj.github.io/imgs/wx_shoukuan.png">
<link rel="publisher" href="yjdwbj@gmail.com">
  
  
    <link rel="icon" href="/favicon.png">
  
  <!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'> -->
  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css"> -->
  <link href="//fonts.useso.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css">
  <link href='//fonts.useso.com/css?family=Open+Sans:300,600' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
  <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78826582-1', 'auto');
  ga('send', 'pageview');

    </script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <a href="/" class="logo">码农记事本</a>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">文章</a>
        
          <a class="main-nav-link" href="/2016/05/20/about/index.html">关于</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yjdwbj.github.io"></form>
        </div>
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
        
        
          <a id="nav-github-link" class="nav-icon" href="https://github.com/ppoffice/hexo-theme-alex" title="Fork me on GitHub"></a>
        
      </nav>
    </div>
  </div>
</header>
      <nav id="mobile-nav" class="off">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">文章</a>
  
    <a href="/2016/05/20/about/index.html" class="mobile-nav-link">关于</a>
  
  <div id="search-form-wrap-mobile">
    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yjdwbj.github.io"></form>
  </div>
</nav>
      <div class="outer">
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Qt/">Qt</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/嵌入式/">嵌入式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/笔记/">笔记</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维/">运维</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/05/22/Linux-下翻墙指南/">Linux 下翻墙指南</a>
          </li>
        
          <li>
            <a href="/2017/05/22/codeblocks与STM32的开发环境配置/">codeblocks与STM32的开发环境配置</a>
          </li>
        
          <li>
            <a href="/2017/04/19/Windows下编译一些开源基础库/">Windows下编译一些开源基础库</a>
          </li>
        
          <li>
            <a href="/2017/04/19/Windows下WinDDK驱动开发/">Windows下WinDDK驱动开发</a>
          </li>
        
          <li>
            <a href="/2017/02/03/Mini2440移植最新的u-boot/">Mini2440移植最新的u-boot</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debian-Linux-GLX-ATI-RADEON/">Debian,Linux,GLX,ATI,RADEON</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debian-Linux-Mate/">Debian,Linux,Mate,</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debian-Linux-Raspberry-Pi-ffmpeg/">Debian,Linux,Raspberry Pi,ffmpeg</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debian-Linux-Shell/">Debian,Linux,Shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django-Ngninx-uWsgi-Let-s-Encrypt/">Django,Ngninx,uWsgi,Let's Encrypt</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MinGW-驱动/">MinGW,驱动</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Postgresql/">Postgresql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Qt-C-MinGW/">Qt,C++,MinGW</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Qt5-MinGW/">Qt5,MinGW</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RaspberryPi-Linux/">RaspberryPi,Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/STM32-Codeblocks/">STM32,Codeblocks</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vsftpd-Django-Sqlite3/">Vsftpd,Django,Sqlite3</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WinDDk-驱动/">WinDDk,驱动</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ffmpeg-QT/">ffmpeg,QT</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Debian-Linux-GLX-ATI-RADEON/" style="font-size: 10px;">Debian,Linux,GLX,ATI,RADEON</a> <a href="/tags/Debian-Linux-Mate/" style="font-size: 10px;">Debian,Linux,Mate,</a> <a href="/tags/Debian-Linux-Raspberry-Pi-ffmpeg/" style="font-size: 10px;">Debian,Linux,Raspberry Pi,ffmpeg</a> <a href="/tags/Debian-Linux-Shell/" style="font-size: 10px;">Debian,Linux,Shell</a> <a href="/tags/Django-Ngninx-uWsgi-Let-s-Encrypt/" style="font-size: 10px;">Django,Ngninx,uWsgi,Let's Encrypt</a> <a href="/tags/MinGW-驱动/" style="font-size: 10px;">MinGW,驱动</a> <a href="/tags/Postgresql/" style="font-size: 10px;">Postgresql</a> <a href="/tags/Qt-C-MinGW/" style="font-size: 10px;">Qt,C++,MinGW</a> <a href="/tags/Qt5-MinGW/" style="font-size: 10px;">Qt5,MinGW</a> <a href="/tags/RaspberryPi-Linux/" style="font-size: 10px;">RaspberryPi,Linux</a> <a href="/tags/STM32-Codeblocks/" style="font-size: 10px;">STM32,Codeblocks</a> <a href="/tags/Vsftpd-Django-Sqlite3/" style="font-size: 10px;">Vsftpd,Django,Sqlite3</a> <a href="/tags/WinDDk-驱动/" style="font-size: 10px;">WinDDk,驱动</a> <a href="/tags/ffmpeg-QT/" style="font-size: 10px;">ffmpeg,QT</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://hexo.io">Hexo</a>
          </li>
        
          <li>
            <a href="mailto:yjdwbj@gmail.com">Email</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
        <section id="main"><article id="post-为Radeon驱动编译Mesa-GLX支持" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/06/为Radeon驱动编译Mesa-GLX支持/" class="article-date">
  <time datetime="2016-08-05T16:00:00.000Z" itemprop="datePublished">2016-08-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      为Radeon驱动编译Mesa-GLX支持
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本人有空会折腾编译最新的Linux内核,使用的笔记本电脑又AMD的平台,AMD显卡fglrx驱动一直是一个巨大的坑,<br>没有一次可以完全正常编译的,对于不同的内核本版要打无数的补丁才能编译成功,且它的驱动不支持VAPDU特性.<br>对于不是很新的显卡用开源的radeon驱动都能很好的使用.</p>
<p>[参考链接]<br><a href="http://www.linuxfromscratch.org/blfs/view/svn/x/mesa.html" target="_blank" rel="external">Mesa-12.0.1</a></p>
<h3 id="安装依赖库"><a href="#安装依赖库" class="headerlink" title="安装依赖库"></a>安装依赖库</h3><h4 id="LLVM-3-8"><a href="#LLVM-3-8" class="headerlink" title="LLVM-3.8"></a>LLVM-3.8</h4><p><a href="http://llvm.org/releases/3.8.0/clang+llvm-3.8.0-x86_64-linux-gnu-debian8.tar.xz" target="_blank" rel="external">下载</a>LLVM3.8后解压到<br><code>/usr/local/clang+llvm-3.8.0-x86_64-linux-gnu-debian8</code></p>
<ul>
<li><a href="https://dri.freedesktop.org/libdrm/libdrm-2.4.68.tar.bz2" target="_blank" rel="external">libdrm-2.4.68</a></li>
<li><p>下载后解压编译如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ ../configure --enable-udev --enable-radeon --enable-amdgpu --disable-intel --disable-nouveau --disable-vmwgfx</div><div class="line">[...]</div><div class="line">$ make &amp;&amp; sudo make install</div></pre></td></tr></table></figure>
</li>
<li><p>下面这些依赖的库文件很简单的编译,直接解压进去,<code>./configure &amp;&amp; make &amp;&amp; make install</code> 就可以了,</p>
</li>
<li>安装的目录在<code>/usr/local</code>,如果编译过程碰到错误,就是少某些头文件,安装它就可以继续编译了.<br>&gt;</li>
</ul>
<ul>
<li><a href="https://www.x.org/archive/individual/proto/dri2proto-2.8.tar.bz2" target="_blank" rel="external">dri2proto-2.8</a></li>
<li><a href="http://people.freedesktop.org/~aplattner/vdpau/libvdpau-1.1.1.tar.bz2" target="_blank" rel="external">libvdpau-1.1.1</a></li>
<li><a href="https://fedorahosted.org/releases/e/l/elfutils/0.166/elfutils-0.166.tar.bz2" target="_blank" rel="external">elfutils-0.166</a></li>
<li><a href="https://www.freedesktop.org/software/vaapi/releases/libva/libva-1.7.3.tar.bz2" target="_blank" rel="external">libva-1.7.3</a></li>
</ul>
<p>&gt;</p>
<h3 id="安装libva"><a href="#安装libva" class="headerlink" title="安装libva"></a>安装libva</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$  ../configure --enable-x11 --enable-drm  --enable-egl --enable-glx </div><div class="line">$ make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h3 id="安装MESA"><a href="#安装MESA" class="headerlink" title="安装MESA"></a>安装MESA</h3><p><a href="ftp://ftp.freedesktop.org/pub/mesa/12.0.1/mesa-12.0.1.tar.xz" target="_blank" rel="external">mesa-12.0.1</a><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ tar xvf mesa-12.0.1.tar.gz</div><div class="line">$ <span class="built_in">cd</span> mesa-12.0.1 &amp;&amp; mkdir build &amp;&amp; <span class="built_in">cd</span> build</div><div class="line">$ GLL_DRV=<span class="string">"r300,r600,radeonsi,swrast"</span></div><div class="line">$ ../autogen.sh --enable-dri --enable-glx --enable-vdpau  --enable-opencl --enable-opencl-icd \</div><div class="line">  --enable-glx-tls --with-llvm-prefix=/usr/<span class="built_in">local</span>/clang+llvm-3.8.0-x86_64-linux-gnu-debian8 \ </div><div class="line">  --disable-llvm-shared-libs --enable-egl --enable-gbm \</div><div class="line">    --enable-texture-float --enable-xa --with-gallium-drivers=<span class="variable">$GLL_DRV</span> \</div><div class="line">    --with-dri-drivers=radeon --with-egl-platforms=drm,x11 --enable-gles1 \</div><div class="line">    --enable-gles2 --enable-osmesa --enable-va --with-osmesa-bits=32 --enable-gallium-extra-hud</div><div class="line">[....]</div><div class="line">$ make install</div></pre></td></tr></table></figure></p>
<ul>
<li><strong>替换系统的MESA库</strong><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$cd</span> /usr/lib/x86_64-linux-gnu/dri </div><div class="line">debian:/usr/lib/x86_64-linux-gnu/dri$ ls <span class="_">-l</span></div><div class="line">total 82908</div><div class="line">-rw-r--r-- 1 root root   22504 Oct 24  2014 dummy_drv_video.so</div><div class="line">-rw-r--r-- 5 root root 5505624 Aug 20  2015 i915_dri.so</div><div class="line">-rw-r--r-- 5 root root 5505624 Aug 20  2015 i965_dri.so</div><div class="line">-rw-r--r-- 7 root root 8175344 Aug 20  2015 kms_swrast_dri.so</div><div class="line">-rw-r--r-- 7 root root 8175344 Aug 20  2015 nouveau_dri.so</div><div class="line">lrwxrwxrwx 1 root root      18 Aug  8  2014 nouveau_drv_video.so -&gt; vdpau_drv_video.so</div><div class="line">-rw-r--r-- 5 root root 5505624 Aug 20  2015 nouveau_vieux_dri.so</div><div class="line">lrwxrwxrwx 1 root root      18 Aug  8  2014 nvidia_drv_video.so -&gt; vdpau_drv_video.so</div><div class="line">-rw-r--r-- 5 root root 5505624 Aug 20  2015 r200_dri.so</div><div class="line">-rw-r--r-- 7 root root 8175344 Aug 20  2015 r300_dri.so</div><div class="line">lrwxrwxrwx 1 root root      30 Aug  6 23:20 r600_dri.so -&gt; /usr/<span class="built_in">local</span>/lib/dri/r600_dri.so</div><div class="line">-rw-r--r-- 7 root root 8175344 Aug 20  2015 r600_dri.so.org</div><div class="line">lrwxrwxrwx 1 root root      18 Aug  8  2014 r600_drv_video.so -&gt; vdpau_drv_video.so</div><div class="line">-rw-r--r-- 5 root root 5505624 Aug 20  2015 radeon_dri.so</div><div class="line">-rw-r--r-- 7 root root 8175344 Aug 20  2015 radeonsi_dri.so</div><div class="line">lrwxrwxrwx 1 root root      18 Aug  8  2014 radeonsi_drv_video.so -&gt; vdpau_drv_video.so</div><div class="line">lrwxrwxrwx 1 root root      18 Aug  8  2014 s3g_drv_video.so -&gt; vdpau_drv_video.so</div><div class="line">lrwxrwxrwx 1 root root      32 Aug  7 00:46 swrast_dri.so -&gt; /usr/<span class="built_in">local</span>/lib/dri/swrast_dri.so</div><div class="line">-rw-r--r-- 7 root root 8175344 Aug 20  2015 swrast_dri.so.org</div><div class="line">-rw-r--r-- 1 root root   97056 Aug  8  2014 vdpau_drv_video.so</div><div class="line">-rw-r--r-- 7 root root 8175344 Aug 20  2015 vmwgfx_dri.so</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">ls /usr/lib/x86_64-linux-gnu/libdrm_* -l</div><div class="line">lrwxrwxrwx 1 root root     37 Dec 11 19:14 /usr/lib/x86_64-linux-gnu/libdrm_amdgpu.so -&gt; /usr/local/lib/libdrm_amdgpu.so.1.0.0</div><div class="line">-rw-r--r-- 1 root root 206760 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_intel.a</div><div class="line">lrwxrwxrwx 1 root root     30 Dec 11 13:30 /usr/lib/x86_64-linux-gnu/libdrm_intel.so -&gt; /usr/local/lib/libdrm_intel.so</div><div class="line">lrwxrwxrwx 1 root root     21 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_intel.so.1 -&gt; libdrm_intel.so.1.0.0</div><div class="line">-rw-r--r-- 1 root root 139328 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_intel.so.1.0.0</div><div class="line">-rw-r--r-- 1 root root  31552 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_nouveau.a</div><div class="line">lrwxrwxrwx 1 root root     32 Dec 11 13:30 /usr/lib/x86_64-linux-gnu/libdrm_nouveau.so -&gt; /usr/local/lib/libdrm_nouveau.so</div><div class="line">lrwxrwxrwx 1 root root     23 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_nouveau.so.2 -&gt; libdrm_nouveau.so.2.0.0</div><div class="line">-rw-r--r-- 1 root root  26896 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_nouveau.so.2.0.0</div><div class="line">-rw-r--r-- 1 root root  71708 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_radeon.a</div><div class="line">lrwxrwxrwx 1 root root     37 Dec 11 19:13 /usr/lib/x86_64-linux-gnu/libdrm_radeon.so -&gt; /usr/local/lib/libdrm_radeon.so.1.0.1</div><div class="line">lrwxrwxrwx 1 root root     37 Dec 11 19:13 /usr/lib/x86_64-linux-gnu/libdrm_radeon.so.1 -&gt; /usr/local/lib/libdrm_radeon.so.1.0.1</div><div class="line">-rw-r--r-- 1 root root  51688 Oct  6  2014 /usr/lib/x86_64-linux-gnu/libdrm_radeon.so.1.0.1</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">for i in &#123;drm,egl,glx,va,tpi,wayland,x11&#125;;do sudo ln -svf /usr/local/lib/libva-$i.so.1.3904.0 libva-$i.so.1  ;done</div><div class="line">‘libva-drm.so.1’ -&gt; ‘/usr/local/lib/libva-drm.so.1.3904.0’</div><div class="line">‘libva-egl.so.1’ -&gt; ‘/usr/local/lib/libva-egl.so.1.3904.0’</div><div class="line">‘libva-glx.so.1’ -&gt; ‘/usr/local/lib/libva-glx.so.1.3904.0’</div><div class="line">‘libva-va.so.1’ -&gt; ‘/usr/local/lib/libva-va.so.1.3904.0’</div><div class="line">‘libva-tpi.so.1’ -&gt; ‘/usr/local/lib/libva-tpi.so.1.3904.0’</div><div class="line">‘libva-wayland.so.1’ -&gt; ‘/usr/local/lib/libva-wayland.so.1.3904.0’</div><div class="line">‘libva-x11.so.1’ -&gt; ‘/usr/local/lib/libva-x11.so.1.3904.0’</div><div class="line">michael@debian:/usr/lib/x86_64-linux-gnu$ for i in &#123;drm,egl,glx,va,tpi,wayland,x11&#125;;do sudo ln -svf /usr/local/lib/libva-$i.so.1.3904.0 libva-$i.so  ;done</div><div class="line">‘libva-drm.so’ -&gt; ‘/usr/local/lib/libva-drm.so.1.3904.0’</div><div class="line">‘libva-egl.so’ -&gt; ‘/usr/local/lib/libva-egl.so.1.3904.0’</div><div class="line">‘libva-glx.so’ -&gt; ‘/usr/local/lib/libva-glx.so.1.3904.0’</div><div class="line">‘libva-va.so’ -&gt; ‘/usr/local/lib/libva-va.so.1.3904.0’</div><div class="line">‘libva-tpi.so’ -&gt; ‘/usr/local/lib/libva-tpi.so.1.3904.0’</div><div class="line">‘libva-wayland.so’ -&gt; ‘/usr/local/lib/libva-wayland.so.1.3904.0’</div><div class="line">‘libva-x11.so’ -&gt; ‘/usr/local/lib/libva-x11.so.1.3904.0’</div></pre></td></tr></table></figure>
<ul>
<li>进入到系统MESA库目录下</li>
<li><p>下面文件中有一些是<code>.org</code>结尾是的系统的MESA库文,为保险起见保留了它</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$cd</span> /usr/lib/mesa-diverted/x86_64-linux-gnu</div><div class="line">$/usr/lib/mesa-diverted/x86_64-linux-gnu$ ls <span class="_">-l</span></div><div class="line">total 836</div><div class="line">lrwxrwxrwx 1 root root     15 Aug 20  2015 libEGL.so -&gt; libEGL.so.1.0.0</div><div class="line">lrwxrwxrwx 1 root root     15 Aug 20  2015 libEGL.so.1 -&gt; libEGL.so.1.0.0</div><div class="line">lrwxrwxrwx 1 root root     30 Aug  7 01:08 libEGL.so.1.0.0 -&gt; /usr/<span class="built_in">local</span>/lib/libEGL.so.1.0.0</div><div class="line">-rw-r--r-- 1 root root 173144 Aug 20  2015 libEGL.so.1.0.0.org</div><div class="line">lrwxrwxrwx 1 root root     21 Aug 20  2015 libGLESv1_CM.so -&gt; libGLESv1_CM.so.1.1.0</div><div class="line">lrwxrwxrwx 1 root root     21 Aug 20  2015 libGLESv1_CM.so.1 -&gt; libGLESv1_CM.so.1.1.0</div><div class="line">lrwxrwxrwx 1 root root     36 Aug  7 01:08 libGLESv1_CM.so.1.1.0 -&gt; /usr/<span class="built_in">local</span>/lib/libGLESv1_CM.so.1.1.0</div><div class="line">-rw-r--r-- 1 root root  18232 Aug 20  2015 libGLESv1_CM.so.1.1.0.org</div><div class="line">lrwxrwxrwx 1 root root     18 Aug 20  2015 libGLESv2.so -&gt; libGLESv2.so.2.0.0</div><div class="line">lrwxrwxrwx 1 root root     18 Aug 20  2015 libGLESv2.so.2 -&gt; libGLESv2.so.2.0.0</div><div class="line">lrwxrwxrwx 1 root root     33 Aug  7 01:10 libGLESv2.so.2.0.0 -&gt; /usr/<span class="built_in">local</span>/lib/libGLESv2.so.2.0.0</div><div class="line">-rw-r--r-- 1 root root  26424 Aug 20  2015 libGLESv2.so.2.0.0.org</div><div class="line">lrwxrwxrwx 1 root root     10 Aug  6 22:07 libGL.so -&gt; libGL.so.1</div><div class="line">lrwxrwxrwx 1 root root     14 Aug 20  2015 libGL.so.1 -&gt; libGL.so.1.2.0</div><div class="line">lrwxrwxrwx 1 root root     29 Aug  7 01:10 libGL.so.1.2.0 -&gt; /usr/<span class="built_in">local</span>/lib/libGL.so.1.2.0</div><div class="line">-rw-r--r-- 1 root root 627320 Aug 20  2015 libGL.so.1.2.0.org</div></pre></td></tr></table></figure>
</li>
<li><p>查看本机的显卡数量,我这台笔记本电脑有两个GPU如下:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ lspci | grep <span class="string">"VGA"</span></div><div class="line">00:01.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] BeaverCreek [Radeon HD 6520G]</div><div class="line">01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Thames [Radeon HD 7500M/7600M Series]</div></pre></td></tr></table></figure>
</li>
<li><p>我这里修改/etc/X11/xorg.conf如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line">$ grep -v &apos;#|^$&apos; /etc/X11/xorg.conf</div><div class="line">Section &quot;ServerLayout&quot;</div><div class="line">    Identifier     &quot;X.org Configured&quot;</div><div class="line">    Screen      0  &quot;Screen0&quot; 0 0</div><div class="line">    Screen      1  &quot;Screen1&quot; RightOf &quot;Screen0&quot;</div><div class="line">    InputDevice    &quot;Mouse0&quot; &quot;CorePointer&quot;</div><div class="line">    InputDevice    &quot;Keyboard0&quot; &quot;CoreKeyboard&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Files&quot;</div><div class="line">    ModulePath   &quot;/usr/local/lib/xorg/modules&quot;</div><div class="line">    ModulePath   &quot;/usr/lib/xorg/modules&quot;</div><div class="line">    FontPath     &quot;/usr/share/fonts/X11/misc&quot;</div><div class="line">    FontPath     &quot;/usr/share/fonts/X11/cyrillic&quot;</div><div class="line">    FontPath     &quot;/usr/share/fonts/X11/100dpi/:unscaled&quot;</div><div class="line">    FontPath     &quot;/usr/share/fonts/X11/75dpi/:unscaled&quot;</div><div class="line">    FontPath     &quot;/usr/share/fonts/X11/Type1&quot;</div><div class="line">    FontPath     &quot;/usr/share/fonts/X11/100dpi&quot;</div><div class="line">    FontPath     &quot;/usr/share/fonts/X11/75dpi&quot;</div><div class="line">    FontPath     &quot;built-ins&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Module&quot;</div><div class="line">    Load  &quot;glx&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;InputDevice&quot;</div><div class="line">    Identifier  &quot;Keyboard0&quot;</div><div class="line">    Driver      &quot;kbd&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;InputDevice&quot;</div><div class="line">    Identifier  &quot;Mouse0&quot;</div><div class="line">    Driver      &quot;mouse&quot;</div><div class="line">    Option      &quot;Protocol&quot; &quot;auto&quot;</div><div class="line">    Option      &quot;Device&quot; &quot;/dev/input/mice&quot;</div><div class="line">    Option      &quot;ZAxisMapping&quot; &quot;4 5 6 7&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Monitor&quot;</div><div class="line">    Identifier   &quot;Monitor0&quot;</div><div class="line">    VendorName   &quot;Monitor Vendor&quot;</div><div class="line">    ModelName    &quot;Monitor Model&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Monitor&quot;</div><div class="line">    Identifier   &quot;Monitor1&quot;</div><div class="line">    VendorName   &quot;Monitor Vendor&quot;</div><div class="line">    ModelName    &quot;Monitor Model&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line"></div><div class="line">Section &quot;Device&quot;</div><div class="line">        ### Available Driver options are:-</div><div class="line">        ### Values: &lt;i&gt;: integer, &lt;f&gt;: float, &lt;bool&gt;: &quot;True&quot;/&quot;False&quot;,</div><div class="line">        ### &lt;string&gt;: &quot;String&quot;, &lt;freq&gt;: &quot;&lt;f&gt; Hz/kHz/MHz&quot;,</div><div class="line">        ### &lt;percent&gt;: &quot;&lt;f&gt;%&quot;</div><div class="line">        ### [arg]: arg optional</div><div class="line">        #Option     &quot;Accel&quot;                 # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;SWcursor&quot;              # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;EnablePageFlip&quot;        # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;ColorTiling2D&quot;         # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;RenderAccel&quot;           # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;SubPixelOrder&quot;         # [&lt;str&gt;]</div><div class="line">        #Option     &quot;AccelMethod&quot;           &quot;glamor&quot;</div><div class="line">        Option     &quot;DRI&quot;                &quot;3&quot;</div><div class="line">        Option     &quot;ColorTiling&quot;            &quot;1&quot;</div><div class="line">        Option     &quot;AccelMethod&quot;            &quot;EXA&quot;</div><div class="line">        Option      &quot;TearFree&quot;          &quot;on&quot;</div><div class="line">        #Option     &quot;EnablePageFlip&quot;     &quot;1&quot;</div><div class="line">        Option     &quot;RenderAccel&quot;        &quot;on&quot;    # [&lt;bool&gt;]</div><div class="line">        Option     &quot;AGPMode&quot;            &quot;4&quot;</div><div class="line">        #Option      &quot;AIGLX&quot;                 &quot;off&quot;</div><div class="line">        #Option     &quot;EXAVSync&quot;              # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;EXAPixmaps&quot;            # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;ZaphodHeads&quot;           # &lt;str&gt;</div><div class="line">        #Option     &quot;SwapbuffersWait&quot;       # [&lt;bool&gt;]</div><div class="line">    Identifier  &quot;Advanced Micro Devices, Inc. [AMD/ATI] BeaverCreek [Radeon HD 6520G]&quot;</div><div class="line">    Driver      &quot;radeon&quot;</div><div class="line">    BusID       &quot;PCI:0:1:0&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Device&quot;</div><div class="line">        ### Available Driver options are:-</div><div class="line">        ### Values: &lt;i&gt;: integer, &lt;f&gt;: float, &lt;bool&gt;: &quot;True&quot;/&quot;False&quot;,</div><div class="line">        ### &lt;string&gt;: &quot;String&quot;, &lt;freq&gt;: &quot;&lt;f&gt; Hz/kHz/MHz&quot;,</div><div class="line">        ### &lt;percent&gt;: &quot;&lt;f&gt;%&quot;</div><div class="line">        ### [arg]: arg optional</div><div class="line">        #Option     &quot;Accel&quot;                 # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;SWcursor&quot;              # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;EnablePageFlip&quot;        # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;ColorTiling&quot;           # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;ColorTiling2D&quot;         # [&lt;bool&gt;]</div><div class="line">        Option     &quot;RenderAccel&quot;        &quot;on&quot;    # [&lt;bool&gt;]</div><div class="line">        Option     &quot;AGPMode&quot;            &quot;4&quot;</div><div class="line">        #Option     &quot;SubPixelOrder&quot;         # [&lt;str&gt;]</div><div class="line">        #Option     &quot;AccelMethod&quot;           # &lt;str&gt;</div><div class="line">        #Option     &quot;EXAVSync&quot;              # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;EXAPixmaps&quot;            # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;ZaphodHeads&quot;           # &lt;str&gt;</div><div class="line">        #Option     &quot;EnablePageFlip&quot;        # [&lt;bool&gt;]</div><div class="line">        #Option     &quot;SwapbuffersWait&quot;       # [&lt;bool&gt;]</div><div class="line">        #Option      &quot;AIGLX&quot;                 &quot;off&quot;</div><div class="line">        Option     &quot;DRI&quot;                &quot;3&quot;</div><div class="line">        Option     &quot;ColorTiling&quot;            &quot;1&quot;</div><div class="line">        Option     &quot;AccelMethod&quot;            &quot;EXA&quot;</div><div class="line">        Option      &quot;TearFree&quot;          &quot;on&quot;</div><div class="line">        #Option     &quot;EnablePageFlip&quot;     &quot;1&quot;</div><div class="line">    Identifier  &quot;Advanced Micro Devices, Inc. [AMD/ATI] Thames [Radeon HD 7500M/7600M Series]&quot;</div><div class="line">    Driver      &quot;radeon&quot;</div><div class="line">    BusID       &quot;PCI:1:0:0&quot;</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Screen&quot;</div><div class="line">    Identifier &quot;Screen0&quot;</div><div class="line">    Device     &quot;Card0&quot;</div><div class="line">    Monitor    &quot;Monitor0&quot;</div><div class="line">    SubSection &quot;Display&quot;</div><div class="line">        Viewport   0 0</div><div class="line">        Depth     24</div><div class="line">    EndSubSection</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Screen&quot;</div><div class="line">    Identifier &quot;Screen1&quot;</div><div class="line">    Device &quot;Card1&quot;</div><div class="line">    Monitor    &quot;Monitor1&quot;</div><div class="line">    SubSection &quot;Display&quot;</div><div class="line">        Viewport   0 0</div><div class="line">        Depth     24</div><div class="line">    EndSubSection</div><div class="line">EndSection</div><div class="line"></div><div class="line">Section &quot;Extensions&quot;</div><div class="line">    Option  &quot;Composite&quot;     &quot;Enable&quot;</div><div class="line">EndSection</div></pre></td></tr></table></figure>
</li>
<li><p>重启Xorg,用xrander 查看可用的GPU数量,下面显示两个GPU可供使用.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ xrandr --listproviders</div><div class="line">Providers: number : 2</div><div class="line">Provider 0: id: 0x8a <span class="built_in">cap</span>: 0xf, Source Output, Sink Output, Source Offload, Sink Offload crtcs: 2 outputs: 3 associated providers: 0 name:radeon</div><div class="line">Provider 1: id: 0x55 <span class="built_in">cap</span>: 0xf, Source Output, Sink Output, Source Offload, Sink Offload crtcs: 6 outputs: 0 associated providers: 0 name:radeon</div></pre></td></tr></table></figure>
</li>
<li><p>修改radeon驱动的内核参数,<a href="https://www.x.org/wiki/RadeonFeature/#index4h2" target="_blank" rel="external">RadeonFeature</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ cat /etc/modprobe.d/radeon.conf </div><div class="line">options radeon audio=1</div><div class="line">options radeon agpmode=1</div><div class="line">options radeon tv=1</div><div class="line">options radeon modeset=1</div></pre></td></tr></table></figure>
</li>
<li><p>测试GLX信息, 如下显示GLX功能正常</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ glxinfo | head -n 10</div><div class="line">name of display: :0.0</div><div class="line">display: :0  screen: 0</div><div class="line">direct rendering: Yes</div><div class="line">server glx vendor string: SGI</div><div class="line">server glx version string: 1.4</div><div class="line">server glx extensions:</div><div class="line">    GLX_ARB_create_context, GLX_ARB_create_context_profile, </div><div class="line">    GLX_ARB_create_context_robustness, GLX_ARB_fbconfig_float, </div><div class="line">    GLX_ARB_framebuffer_sRGB, GLX_ARB_multisample, </div><div class="line">    GLX_EXT_create_context_es2_profile, GLX_EXT_framebuffer_sRGB,</div><div class="line">   [...]</div></pre></td></tr></table></figure>
</li>
<li><p>检查VDPAU支持,如下显示已经开启VAPDU功能.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">$ vainfo</div><div class="line">libva info: VA-API version 0.36.0</div><div class="line">libva info: va_getDriverName() returns 0</div><div class="line">libva info: Trying to open /usr/lib/x86_64-linux-gnu/dri/r600_drv_video.so</div><div class="line">libva info: Found init <span class="keyword">function</span> __vaDriverInit_0_35</div><div class="line">libva info: va_openDriver() returns 0</div><div class="line">vainfo: VA-API version: 0.36 (libva 1.4.1)</div><div class="line">vainfo: Driver version: Splitted-Desktop Systems VDPAU backend <span class="keyword">for</span> VA-API - 0.7.4</div><div class="line">vainfo: Supported profile and entrypoints</div><div class="line">      VAProfileMPEG2Simple            : VAEntrypointVLD</div><div class="line">      VAProfileMPEG2Main              : VAEntrypointVLD</div><div class="line">      VAProfileMPEG4Simple            : VAEntrypointVLD</div><div class="line">      VAProfileMPEG4AdvancedSimple    : VAEntrypointVLD</div><div class="line">      VAProfileH264Baseline           : VAEntrypointVLD</div><div class="line">      VAProfileH264Main               : VAEntrypointVLD</div><div class="line">      VAProfileH264High               : VAEntrypointVLD</div><div class="line">      VAProfileVC1Simple              : VAEntrypointVLD</div><div class="line">      VAProfileVC1Main                : VAEntrypointVLD</div><div class="line">      VAProfileVC1Advanced            : VAEntrypointVLD</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="遇到过的名错误"><a href="#遇到过的名错误" class="headerlink" title="遇到过的名错误"></a>遇到过的名错误</h3><ul>
<li>检查Xorg错误信息 ,如果出现很多”EE”信息,轻则功能缺失,重则不能开启图界面,下面只有一个EE,没有找到出错的原因.<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ grep <span class="string">"EE"</span> /var/<span class="built_in">log</span>/Xorg.0.log</div><div class="line">    (WW) warning, (EE) error, (NI) not implemented, (??) unknown.</div><div class="line">[  6597.997] (EE) RADEON(1): No modes.</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="vainfo-vdpauinfo-出错"><a href="#vainfo-vdpauinfo-出错" class="headerlink" title="vainfo , vdpauinfo 出错."></a>vainfo , vdpauinfo 出错.</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">~$ VDPAU_DRIVER=r600 vdpauinfo</div><div class="line">display: :0.0   screen: 0</div><div class="line">Error creating VDPAU device: 23</div><div class="line"></div><div class="line">~$ vdpauinfo</div><div class="line">display: :0.0   screen: 0</div><div class="line">Failed to open VDPAU backend libvdpau_nvidia.so: cannot open shared object file: No such file or directory</div><div class="line">Error creating VDPAU device: 1</div><div class="line"></div><div class="line">~$ vainfo</div><div class="line">libva info: VA-API version 0.39.4</div><div class="line">libva info: va_getDriverName() returns -1</div><div class="line">libva error: va_getDriverName() failed with unknown libva error,driver_name=(null)</div><div class="line">vaInitialize failed with error code -1 (unknown libva error),exit</div></pre></td></tr></table></figure>
<ul>
<li>上面错误是因为 <code>/etc/X11/xorg.conf</code> 的　<code>AccelMethod</code> 设置 <code>Glamor</code> ,改成<code>EXA</code> 解决问题.</li>
</ul>
<h5 id="新显卡加载固件问题"><a href="#新显卡加载固件问题" class="headerlink" title="新显卡加载固件问题"></a>新显卡加载固件问题</h5><p>*　R7 显卡遇无法加载radeon驱动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">$ lspci | grep <span class="string">"VGA"</span></div><div class="line">00:01.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Kaveri [Radeon R7 Graphics] (rev d6)</div><div class="line">``` </div><div class="line"></div><div class="line">* 通过dmesg 发现如下错误</div><div class="line">```bash</div><div class="line">[  449.155790] radeon 0000:00:01.0: Direct firmware load <span class="keyword">for</span></div><div class="line">radeon/kaveri_pfp.bin failed with error -2</div><div class="line">[  449.156090] radeon 0000:00:01.0: Direct firmware load <span class="keyword">for</span></div><div class="line">radeon/kaveri_me.bin failed with error -2</div><div class="line">[  449.156407] radeon 0000:00:01.0: Direct firmware load <span class="keyword">for</span></div><div class="line">radeon/kaveri_ce.bin failed with error -2</div><div class="line">[  449.156680] radeon 0000:00:01.0: Direct firmware load <span class="keyword">for</span></div><div class="line">radeon/kaveri_mec.bin failed with error -2</div><div class="line">[  449.156990] radeon 0000:00:01.0: Direct firmware load <span class="keyword">for</span></div><div class="line">radeon/kaveri_mec2.bin failed with error -2</div><div class="line">[  449.156992] cik_cp: Failed to load firmware <span class="string">"radeon/kaveri_mec2.bin"</span></div><div class="line">[  449.157153] [drm:cik_init [radeon]] *ERROR* Failed to load firmware!</div><div class="line">[  449.157241] radeon 0000:00:01.0: Fatal error during GPU init</div><div class="line">[  449.157327] [drm] radeon: finishing device.</div><div class="line">[  449.164593] [TTM] Finalizing pool allocator</div><div class="line">[  449.164597] [TTM] Finalizing DMA pool allocator</div><div class="line">[  449.164697] [TTM] Zone  kernel: Used memory at <span class="built_in">exit</span>: 0 kiB</div><div class="line">[  449.164701] [TTM] Zone   dma32: Used memory at <span class="built_in">exit</span>: 0 kiB</div><div class="line">[  449.164703] [drm] radeon: ttm finalized</div><div class="line">[  449.165170] radeon: probe of 0000:00:01.0 failed with error -2</div></pre></td></tr></table></figure>
<ul>
<li><a href="git://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git" target="_blank" rel="external">下载最新的固件</a> , 把<code>radeon</code>目录下的所有文件复制到<code>/lib/firmware/radeon</code>,重新<code>modprobe radeon</code>解决</li>
</ul>
<ul>
<li><p>使用xrandr 设置多屏</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">$ xrandr </div><div class="line">Screen 0: minimum 320 x 200, current 3286 x 1080, maximum 8192 x 8192</div><div class="line">VGA-0 disconnected (normal left inverted right x axis y axis)</div><div class="line">LVDS connected 1366x768+0+0 (normal left inverted right x axis y axis) 344mm x 194mm</div><div class="line">   1366x768      60.00*+</div><div class="line">   1280x720      59.86  </div><div class="line">   1152x768      59.78  </div><div class="line">   1024x768      59.92  </div><div class="line">   800x600       59.86  </div><div class="line">   848x480       59.66  </div><div class="line">   720x480       59.71  </div><div class="line">   640x480       59.38  </div><div class="line">HDMI-0 connected 1920x1080+1366+0 (normal left inverted right x axis y axis) 480mm x 270mm</div><div class="line">   1920x1080     60.00*+  50.00    59.94  </div><div class="line">   1920x1080i    60.00    50.00    59.94  </div><div class="line">   1680x1050     59.88  </div><div class="line">   1400x1050     59.95  </div><div class="line">   1600x900      60.00  </div><div class="line">   1280x1024     75.02    60.02  </div><div class="line">   1440x900      59.90  </div><div class="line">   1280x800      59.91  </div><div class="line">   1152x864      75.00  </div><div class="line">   1280x720      60.00    50.00    59.94  </div><div class="line">   1024x768      75.08    60.00  </div><div class="line">   800x600       75.00    60.32  </div><div class="line">   720x576       50.00  </div><div class="line">   720x480       60.00    59.94  </div><div class="line">   640x480       75.00    60.00    59.94  </div><div class="line">   720x400       70.08  </div><div class="line">$ xrandr --output LVDS --mode 1366x768 --output HDMI-0 --mode 1920x1080 --right-of LVDS</div></pre></td></tr></table></figure>
</li>
<li><p>基于<code>debian</code>发行版安装mesa 驱并支持,VDPAU,VA API,GLX, 需要安装如下的包,下面是64位系统上的包列表.</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"># uname -a</div><div class="line">Linux debian 4.8.13-20161211 #2 SMP Sun Dec 11 13:11:44 CST 2016 x86_64 GNU/Linux</div><div class="line"># lspci | grep &quot;VGA&quot;</div><div class="line">00:01.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Kaveri [Radeon R7 Graphics] (rev d6)</div><div class="line"></div><div class="line"></div><div class="line"># apt-get install glx-alternative-mesa libegl1-mesa:amd64 libegl1-mesa-dev:amd64 libegl1-mesa-drivers:amd64 libgl1-mesa-dev:amd64 libgl1-mesa-dri:amd64  </div><div class="line">libgl1-mesa-dri:i386 libgl1-mesa-glx:amd64 libgl1-mesa-glx:i386 libglapi-mesa:amd64 libglapi-mesa:i386 libgles1-mesa:amd64 </div><div class="line">libgles1-mesa-dev:amd64 libgles2-mesa:amd64 libgles2-mesa-dev:amd64 libglu1-mesa:amd64 libglu1-mesa:i386 </div><div class="line">libglu1-mesa-dev libglw1-mesa:amd64 libglw1-mesa-dev libopenvg1-mesa:amd64  libosmesa6:amd64  </div><div class="line">libosmesa6-dev:amd64 libwayland-egl1-mesa:amd64 mesa-common-dev:amd64  mesa-opencl-icd </div><div class="line">mesa-utils mesa-va-drivers:amd64  mesa-vdpau-drivers:amd64 libdrm-amdgpu1:amd64 libdrm-dev:amd64  </div><div class="line">libdrm-intel1:amd64 libdrm-intel1:i386 libdrm-nouveau2:amd64  libdrm-nouveau2:i386 libdrm-radeon1:amd64 </div><div class="line">libdrm-radeon1:i386 libdrm2:amd64  libdrm2:i386  libva-drm1:amd64  libvdpau1:amd64 </div><div class="line">mesa-vdpau-drivers:amd64 vdpauinfo libva-dev:amd64 libva-drm1:amd64  libva-egl1:amd64  </div><div class="line">libva-glx1:amd64  libva-tpi1:amd64  libva-wayland1:amd64 libva-x11-1:amd64 libva1:amd64  </div><div class="line">libva1:i386 libval-bin libval14:amd64</div></pre></td></tr></table></figure>
<ul>
<li>到次如果没有错误就算是折腾完了,如果遇到问题一定<a href="https://www.google.com.hk" target="_blank" rel="external">google</a> 一下.</li>
</ul>
<hr>
<h3 id="自愿打赏支持"><a href="#自愿打赏支持" class="headerlink" title="自愿打赏支持"></a>自愿打赏支持</h3><p>&gt;</p>
<ul>
<li>你的打赏将会鼓励我写出更多的博客。  </li>
<li>微信二维码:<br>&gt;<br><img src="/imgs/wx_shoukuan.png" width="40%" height="40%" align="center/"></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yjdwbj.github.io/2016/08/06/为Radeon驱动编译Mesa-GLX支持/" data-id="cj307oycq000mwyi5yndimcdm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Debian-Linux-GLX-ATI-RADEON/">Debian,Linux,GLX,ATI,RADEON</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/08/26/使用的一些常见问题-不定期更新/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Linux 使用的一些常见问题,不定期更新.
        
      </div>
    </a>
  
  
    <a href="/2016/07/07/为树莓派交叉编译FFMPEG程序/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">为树莓派交叉编译FFMPEG工具</div>
    </a>
  
</nav>

  
</article>

</section>
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <a href="/" class="logo">码农记事本</a>
      &copy; 2017 lcy<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    

<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.scrollLoading.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="PulseAudio 设置与应用 安装如下包,具体安装可参考这里&amp;gt;)  1234567891011~$ dpkg -l | grep &quot;pulseaudio&quot;ii  gstreamer1.0-pulseaudio:amd64                     1.10.4-1                                    amd64        GStream">
<meta name="keywords" content="Debian,Linux,Shell,Ardunio">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux使用的一些常见问题-不定期更新">
<meta property="og:url" content="http://yoursite.com/2016/08/26/使用的一些常见问题-不定期更新/index.html">
<meta property="og:site_name" content="Sunrise 博客">
<meta property="og:description" content="PulseAudio 设置与应用 安装如下包,具体安装可参考这里&amp;gt;)  1234567891011~$ dpkg -l | grep &quot;pulseaudio&quot;ii  gstreamer1.0-pulseaudio:amd64                     1.10.4-1                                    amd64        GStream">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/imgs/ovsbr0.png">
<meta property="og:image" content="http://yoursite.com/imgs/mm_reward_qrcode_1525013906055.png">
<meta property="og:updated_time" content="2020-02-28T14:27:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linux使用的一些常见问题-不定期更新">
<meta name="twitter:description" content="PulseAudio 设置与应用 安装如下包,具体安装可参考这里&amp;gt;)  1234567891011~$ dpkg -l | grep &quot;pulseaudio&quot;ii  gstreamer1.0-pulseaudio:amd64                     1.10.4-1                                    amd64        GStream">
<meta name="twitter:image" content="http://yoursite.com/imgs/ovsbr0.png">

<link rel="canonical" href="http://yoursite.com/2016/08/26/使用的一些常见问题-不定期更新/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Linux使用的一些常见问题-不定期更新 | Sunrise 博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sunrise 博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/26/使用的一些常见问题-不定期更新/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="最是人间留不住,朱颜辞镜花辞树">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Linux使用的一些常见问题-不定期更新
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-08-26 00:00:00" itemprop="dateCreated datePublished" datetime="2016-08-26T00:00:00+08:00">2016-08-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-28 22:27:00" itemprop="dateModified" datetime="2020-02-28T22:27:00+08:00">2020-02-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/笔记/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="PulseAudio-设置与应用"><a href="#PulseAudio-设置与应用" class="headerlink" title="PulseAudio 设置与应用"></a>PulseAudio 设置与应用</h1><ul>
<li>安装如下包,具体安装可参考<a href="https://wiki.archlinux.org/index.php/PulseAudio_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87" target="_blank" rel="noopener">这里</a>&gt;)</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~$ dpkg -l | grep <span class="string">"pulseaudio"</span></span><br><span class="line">ii  gstreamer1.0-pulseaudio:amd64                     1.10.4-1                                    amd64        GStreamer plugin <span class="keyword">for</span> PulseAudio</span><br><span class="line">ii  pulseaudio                                        10.0-1+deb9u1                               amd64        PulseAudio sound server</span><br><span class="line">ii  pulseaudio-dlna                                   0.5.2-1                                     all          Stream audio to DLNA devices and Chromecasts</span><br><span class="line">ii  pulseaudio-module-bluetooth                       10.0-1+deb9u1                               amd64        Bluetooth module <span class="keyword">for</span> PulseAudio sound server</span><br><span class="line">ii  pulseaudio-module-gconf                           10.0-1+deb9u1                               amd64        GConf module <span class="keyword">for</span> PulseAudio sound server</span><br><span class="line">ii  pulseaudio-module-jack                            10.0-1+deb9u1                               amd64        jackd modules <span class="keyword">for</span> PulseAudio sound server</span><br><span class="line">ii  pulseaudio-utils                                  10.0-1+deb9u1                               amd64        Command line tools <span class="keyword">for</span> the PulseAudio sound server</span><br><span class="line">ii  alsa-tools                                        1.1.3-1                                     amd64        Console based ALSA utilities <span class="keyword">for</span> specific hardware</span><br><span class="line">ii  alsa-utils                                        1.1.3-1                                     amd64        Utilities <span class="keyword">for</span> configuring and using ALSA</span><br><span class="line">ii  alsamixergui                                      0.9.0rc2-1-10                               amd64        graphical soundcard mixer <span class="keyword">for</span> ALSA soundcard driver</span><br></pre></td></tr></table></figure>
<ul>
<li>添加这一行<strong>load-module module-alsa-sink device=hw:1,0
</strong>到<code>/etc/pulse/default.pa</code>里面.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /etc/pulse/daemon.conf</span><br><span class="line">daemonize = yes</span><br><span class="line">allow-module-loading = yes</span><br><span class="line">system-instance = yes</span><br></pre></td></tr></table></figure>
<ul>
<li>把下面的输出转到 PulseAudio.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~$ cat ~/.asoundrc</span><br><span class="line">pcm.pulse &#123;</span><br><span class="line">        <span class="built_in">type</span> pulse</span><br><span class="line">&#125;</span><br><span class="line">ctl.pulse &#123;</span><br><span class="line">        <span class="built_in">type</span> pulse</span><br><span class="line">&#125;</span><br><span class="line">pcm.!default &#123;</span><br><span class="line">        <span class="built_in">type</span> pulse</span><br><span class="line">&#125;</span><br><span class="line">ctl.!default &#123;</span><br><span class="line">        <span class="built_in">type</span> pulse</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>启动,停止 PulseAudio</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~$ pulseaudio --<span class="built_in">kill</span></span><br><span class="line">~$ pulseaudio --start</span><br><span class="line"></span><br><span class="line">~$ aplay -l</span><br><span class="line">**** List of PLAYBACK Hardware Devices ****</span><br><span class="line">card 0: HDMI [HDA ATI HDMI], device 3: HDMI 0 [HDMI 0]</span><br><span class="line">  Subdevices: 1/1</span><br><span class="line">  Subdevice <span class="comment">#0: subdevice #0</span></span><br><span class="line">card 1: Generic [HD-Audio Generic], device 0: ALC887-VD Analog [ALC887-VD Analog]</span><br><span class="line">  Subdevices: 0/1</span><br><span class="line">  Subdevice <span class="comment">#0: subdevice #0</span></span><br><span class="line">card 1: Generic [HD-Audio Generic], device 1: ALC887-VD Digital [ALC887-VD Digital]</span><br><span class="line">  Subdevices: 1/1</span><br><span class="line">  Subdevice <span class="comment">#0: subdevice #0</span></span><br></pre></td></tr></table></figure>
<ul>
<li>如果出现任何问题,仔细查看系统日志解决.</li>
</ul>
<hr>
<h1 id="minicom-使用"><a href="#minicom-使用" class="headerlink" title="minicom 使用"></a>minicom 使用</h1><ul>
<li><p>Linux 下的超级终端工具<code>minicom</code> 是命令行的工具不像 windows 下的串口工具那么直观,但是使用习惯了就一样.</p>
</li>
<li><p>初次使用 minicom 除了一些串口的常规设置,跟其它串口工具都是一样的.</p>
</li>
<li>在当前 Shell 下输入 <code>minicom -s</code> 会出现如下界面:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+-----[configuration]------+</span><br><span class="line">| Filenames and paths      |</span><br><span class="line">| File transfer protocols  |</span><br><span class="line">| Serial port setup        |</span><br><span class="line">| Modem and dialing        |</span><br><span class="line">| Screen and keyboard      |</span><br><span class="line">| Save setup as dfl        |</span><br><span class="line">| Save setup as..          |</span><br><span class="line">| Exit                     |</span><br><span class="line">| Exit from Minicom        |</span><br><span class="line">+--------------------------+</span><br></pre></td></tr></table></figure>
<ul>
<li>选择<code>Serial port setup</code> 设置串口参数:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+-----------------------------------------------------------------------+</span><br><span class="line">| A -    Serial Device      : /dev/ttyUSB5                              |</span><br><span class="line">| B - Lockfile Location     : /var/lock                                 |</span><br><span class="line">| C -   Callin Program      :                                           |</span><br><span class="line">| D -  Callout Program      :                                           |</span><br><span class="line">| E -    Bps/Par/Bits       : 115200 8N1                                |</span><br><span class="line">| F - Hardware Flow Control : No                                        |</span><br><span class="line">| G - Software Flow Control : No                                        |</span><br><span class="line">|                                                                       |</span><br><span class="line">|    Change <span class="built_in">which</span> setting?                                              |</span><br><span class="line">+-----------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<ul>
<li><p>设置完成回车返回到一个菜单.选择<code>Save setup as dfl</code> 保存退出.</p>
</li>
<li><p>我一般使用 minicom 的参数去连接.例如:</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$  minicom -o -b 115200 -D /dev/ttyUSB5</span><br></pre></td></tr></table></figure>
<h2 id="AT-命令"><a href="#AT-命令" class="headerlink" title="AT 命令"></a>AT 命令</h2><ul>
<li><a href="https://www.question-defense.com/2010/07/27/use-minicom-for-linux-modem-dialup-at-command-testing" target="_blank" rel="noopener">Use Minicom For Linux Modem &amp; Dialup AT Command Testing</a></li>
<li><a href="https://marcin-chwedczuk.github.io/fun-with-at-commands-and-old-modem" target="_blank" rel="noopener">Fun with AT commands and an old modem</a></li>
<li><p><a href="https://www.tldp.org/HOWTO/Remote-Serial-Console-HOWTO/modem-hayes.html" target="_blank" rel="noopener">Configure modem with AT commands</a></p>
</li>
<li><p>一般图形串口工具都有一项,发送新行或者<code>**newline**</code>这个选项.在连接一些硬件串口时发送 AT 命令时,这个是必选的.</p>
</li>
<li><p>但是在<code>minicom</code>就只能用组合快捷键来替换了.</p>
</li>
<li><p>在<code>minicom</code>里发送<code>AT</code>命令如:<code>AT+OK</code> 直接回车,它是不会有反应的,必须还要加一个<code>ctrl+j</code>,才能提交,这个问题也是困扰了我很久.</p>
</li>
</ul>
<h1 id="esptool-升级固件"><a href="#esptool-升级固件" class="headerlink" title="esptool 升级固件"></a>esptool 升级固件</h1><ul>
<li>参考链接:</li>
<li><a href="http://wiki.ai-thinker.com/doku.php/utils/esp_bin_download" target="_blank" rel="noopener">ESP8266 Tools</a></li>
<li><a href="https://github.com/esp8266/esp8266-wiki/wiki/Boot-Process#esp-boot-modes" target="_blank" rel="noopener">ESP8266 Wiki</a></li>
<li><a href="http://wiki.ai-thinker.com/doku.php/release/esp8266_sdk_release" target="_blank" rel="noopener">ESP8266 SDK</a></li>
<li><a href="http://cms.35g.tw/coding/%e4%bd%bf%e7%94%a8arduino%e6%9b%b4%e6%96%b0esp8266-firmware" target="_blank" rel="noopener">使用 Arduino 更新 ESP8266 firmware</a></li>
</ul>
<p>ESP-01 　为例.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GPIO0 --&gt; GND</span><br><span class="line">GPIO2 --&gt; 3V3</span><br><span class="line">CH_PD --&gt; 3V3</span><br><span class="line">RST   --&gt; 3V3</span><br><span class="line">VCC   --&gt; 3V3</span><br><span class="line">GND   --&gt; GND</span><br><span class="line">TX    --&gt; UART(RX)</span><br><span class="line">RX    --&gt; UART(TX)</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://github.com/themadinventor/esptool" target="_blank" rel="noopener">esptool 工具</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ esptool.py   -p /dev/ttyUSB5 write_flash --flash_mode dio --flash_size 8m 0x0 AiThinker_ESP8266_DIO_8M_8M_20160615_V1.5.4.bin</span><br></pre></td></tr></table></figure>
<ul>
<li>这个升级问题折腾了我很久,今天总算是升级成功.它们的文档很杂,图与板子上的名称又不全部对应.</li>
</ul>
<h2 id="下面是更新部分"><a href="#下面是更新部分" class="headerlink" title="下面是更新部分"></a>下面是更新部分</h2><ul>
<li><a href="https://os.mbed.com/users/sschocke/code/WiFiLamp/wiki/Updating-ESP8266-Firmware" target="_blank" rel="noopener">Updating ESP8266 Firmware</a></li>
<li><a href="https://github.com/espressif" target="_blank" rel="noopener">Espressif Systems </a></li>
<li><a href="https://www.allaboutcircuits.com/projects/update-the-firmware-in-your-esp8266-wi-fi-module/" target="_blank" rel="noopener">Update the Firmware in Your ESP8266 Wi-Fi Module </a></li>
<li><p><a href="https://ukhas.net/wiki/esp8266_firmware_update" target="_blank" rel="noopener">ESP8266 - Upgrading the Firmware</a></p>
</li>
<li><p>这里以下载<a href="https://www.espressif.com/sites/default/files/ap/ESP8266_NonOS_AT_Bin_V1.7.4.zip" target="_blank" rel="noopener">最新的v1.7.4固件</a>为例，注意查看各个子文件目录里的<code>README.md</code>。</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">TTL-USB          ESP01</span><br><span class="line"></span><br><span class="line">RX    ---&gt; TX</span><br><span class="line">TX    ---&gt; RX</span><br><span class="line">GND   ---&gt; GND</span><br><span class="line">GND   ---&gt; GPIO0    <span class="comment"># 烧写完成后，把它移除就进入正常模式</span></span><br><span class="line">3V3   ---&gt; 3V3</span><br><span class="line">3V3   ---&gt; CH_PD</span><br><span class="line"></span><br><span class="line">~$ esptool.py  flash_id</span><br><span class="line">esptool.py v3.0-dev</span><br><span class="line">Found 2 serial ports</span><br><span class="line">Serial port /dev/ttyUSB1</span><br><span class="line">Connecting....</span><br><span class="line">Detecting chip <span class="built_in">type</span>... ESP8266</span><br><span class="line">Chip is ESP8266EX</span><br><span class="line">Features: WiFi</span><br><span class="line">Crystal is 26MHz</span><br><span class="line">MAC: 5c:cf:7f:0a:6c:b8</span><br><span class="line">Uploading stub...</span><br><span class="line">Running stub...</span><br><span class="line">Stub running...</span><br><span class="line">Manufacturer: e0</span><br><span class="line">Device: 4014</span><br><span class="line">Detected flash size: 1MB</span><br><span class="line">Hard resetting via RTS pin...</span><br><span class="line"></span><br><span class="line">~$ esptool.py   -p /dev/ttyUSB0 write_flash  --flash_mode qio --flash_freq 40m  0x00000 boot_v1.7.bin 0x01000 at/512+512/user1.1024.new.2.bin 0xfc000 esp_init_data_default_v08.bin 0x7e000 blank.bin 0xfe000 blank.bin 0xfb000 blank.bin</span><br><span class="line"></span><br><span class="line">esptool.py v3.0-dev</span><br><span class="line">Serial port /dev/ttyUSB0</span><br><span class="line">Connecting....</span><br><span class="line">Detecting chip <span class="built_in">type</span>... ESP8266</span><br><span class="line">Chip is ESP8266EX</span><br><span class="line">Features: WiFi</span><br><span class="line">Crystal is 26MHz</span><br><span class="line">MAC: 5c:cf:7f:0a:6c:b8</span><br><span class="line">Uploading stub...</span><br><span class="line">Running stub...</span><br><span class="line">Stub running...</span><br><span class="line">Configuring flash size...</span><br><span class="line">Auto-detected Flash size: 1MB</span><br><span class="line">Flash params <span class="built_in">set</span> to 0x0020</span><br><span class="line">Compressed 4080 bytes to 2936...</span><br><span class="line">Wrote 4080 bytes (2936 compressed) at 0x00000000 <span class="keyword">in</span> 0.3 seconds (effective 123.6 kbit/s)...</span><br><span class="line">Hash of data verified.</span><br><span class="line">Compressed 413444 bytes to 296966...</span><br><span class="line">Wrote 413444 bytes (296966 compressed) at 0x00001000 <span class="keyword">in</span> 26.3 seconds (effective 126.0 kbit/s)...</span><br><span class="line">Hash of data verified.</span><br><span class="line">Compressed 128 bytes to 75...</span><br><span class="line">Wrote 128 bytes (75 compressed) at 0x000fc000 <span class="keyword">in</span> 0.0 seconds (effective 85.1 kbit/s)...</span><br><span class="line">Hash of data verified.</span><br><span class="line">Compressed 4096 bytes to 26...</span><br><span class="line">Wrote 4096 bytes (26 compressed) at 0x0007e000 <span class="keyword">in</span> 0.0 seconds (effective 4089.5 kbit/s)...</span><br><span class="line">Hash of data verified.</span><br><span class="line">Compressed 4096 bytes to 26...</span><br><span class="line">Wrote 4096 bytes (26 compressed) at 0x000fe000 <span class="keyword">in</span> 0.0 seconds (effective 4159.4 kbit/s)...</span><br><span class="line">Hash of data verified.</span><br><span class="line">Compressed 4096 bytes to 26...</span><br><span class="line">Wrote 4096 bytes (26 compressed) at 0x000fb000 <span class="keyword">in</span> 0.0 seconds (effective 4216.8 kbit/s)...</span><br><span class="line">Hash of data verified.</span><br><span class="line"></span><br><span class="line">Leaving...</span><br><span class="line">Hard resetting via RTS pin...</span><br></pre></td></tr></table></figure>
<ul>
<li>使用<code>minicom</code>时注意，软硬件流控要为<code>NO</code>，具体设置<code>Ctrl-A Z, -&gt; O [Configure Minicom] -&gt; Serial Port Setup -&gt; F</code>.使用<code>putty</code>边接，输入下面的命令</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看固件</span></span><br><span class="line">at+GMR</span><br><span class="line">AT version:1.7.4.0(May 11 2020 19:13:04)</span><br><span class="line">SDK version:3.0.4(9532ceb)</span><br><span class="line">compile time:May 27 2020 10:12:17</span><br><span class="line">Bin version(Wroom 02):1.7.4</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># 扫AP</span></span><br><span class="line">AT+CWLAP</span><br><span class="line">+CWLAP:(4,<span class="string">"18575654312"</span>,-84,<span class="string">"cc:2d:21:64:23:40"</span>,1,63,0,4,4,7,0)</span><br><span class="line">+CWLAP:(3,<span class="string">"lcy"</span>,-43,<span class="string">"20:0d:b0:40:21:8f"</span>,1,75,0,4,4,3,0)</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># 看地址</span></span><br><span class="line">at+CIFSR</span><br><span class="line">+CIFSR:STAIP,<span class="string">"192.168.2.122"</span></span><br><span class="line">+CIFSR:STAMAC,<span class="string">"5c:cf:7f:0a:6c:b8"</span></span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># 看内存</span></span><br><span class="line">AT+SYSRAM?</span><br><span class="line">+SYSRAM:51952</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<h1 id="转换-GBK-文本文件的问题"><a href="#转换-GBK-文本文件的问题" class="headerlink" title="转换 GBK 文本文件的问题"></a>转换 GBK 文本文件的问题</h1><ul>
<li>有时在 Linux 下打开 GBK 编码的文件会出现乱码,优其是一些在 window 下载打包的源码压缩包,源码文件全都是 GBK 编码.在 Linux 下用一些文本编辑器打开全是乱码,有些甚至连目录都是乱码.</li>
<li>下面记录一个 shell 脚本批量转换成 UTF8 格式的文件.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ cat convert.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">TMP_IFS=<span class="variable">$IFS</span></span><br><span class="line">IFS=$(<span class="built_in">echo</span> -en <span class="string">"\n\b"</span>)</span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> `find . -<span class="built_in">type</span> f`;<span class="keyword">do</span></span><br><span class="line">    org=$(file <span class="variable">$f</span>)</span><br><span class="line">    string=$(<span class="built_in">echo</span> <span class="variable">$org</span> | grep <span class="string">"ISO-8859"</span>) ;</span><br><span class="line">    <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$string</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">        infile=$(<span class="built_in">echo</span> <span class="variable">$string</span> | awk -F<span class="string">':'</span> <span class="string">'&#123;print $1&#125;'</span>);</span><br><span class="line">        <span class="comment">#echo $infile</span></span><br><span class="line">        iconv -f GBK -t UTF8 <span class="variable">$infile</span> &gt; 1;</span><br><span class="line">        mv 1 <span class="variable">$infile</span>;</span><br><span class="line">    <span class="keyword">fi</span> ;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">IFS=<span class="variable">$TMP_IFS</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">TMP_IFS=<span class="variable">$IFS</span></span><br><span class="line">IFS=$(<span class="built_in">echo</span> -en <span class="string">"\n\b"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> `find  . \( -iname <span class="string">"*.txt"</span> -o -iname <span class="string">"*.c"</span> -o -iname <span class="string">"*.h"</span> \)`;<span class="keyword">do</span></span><br><span class="line">    iconv -f GBK -t UTF8 -c <span class="variable">$f</span> &gt; 1; mv 1 <span class="variable">$f</span>;</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在转换文件时,有时候路径中会包含空格,如果不按照上面的方式设置<code>IFS</code>变量,脚本就会出错在有空格的地方分隔,认为是两个文件.上面这个脚本只是</li>
<li>一个很简单的处理当前目录下所有文件的转换.还可以把它写的更通用灵活.</li>
</ul>
<hr>
<h1 id="批量清除文件名中的特定字符串"><a href="#批量清除文件名中的特定字符串" class="headerlink" title="批量清除文件名中的特定字符串"></a>批量清除文件名中的特定字符串</h1><ul>
<li>有时从网站下载一些文件,资源经会把自已的名字或者网址加在文件名如: <code>电影名_[www.xxx.com].mkv</code>,这样的格式</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">TMP_IFS=<span class="variable">$IFS</span></span><br><span class="line">IFS=$(<span class="built_in">echo</span> -en <span class="string">"\n\b"</span>)</span><br><span class="line">sub1=<span class="string">"www\.xxx\.com"</span></span><br><span class="line">sub2=<span class="string">"www\.bbb\.com"</span></span><br><span class="line">sub3=<span class="string">"www\.ccc\.com"</span></span><br><span class="line"><span class="comment">#sub4="[(]www.ddd.com[)]"  # 例如:  fname-(www.ddd.com).pdf, sed -re "s/$sub4//g"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 例如:匹配 538081 SCALA学习手册.pdf  556997 Scala函数式编.pdf 这样的文件名,删除前面的6个数字</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># reg='^([0-9]&#123;6&#125;)'</span></span><br><span class="line"><span class="comment"># for fname in `ls`;do</span></span><br><span class="line"><span class="comment">#	string=$(echo $fname)</span></span><br><span class="line"><span class="comment">#    if [[ $string =~ $reg ]];</span></span><br><span class="line"><span class="comment">#    then</span></span><br><span class="line"><span class="comment">#    	nstr=$(echo $string | sed -r "s/$&#123;reg&#125;//g")</span></span><br><span class="line"><span class="comment">#        echo $nstr</span></span><br><span class="line"><span class="comment">#        mv $fname $nstr</span></span><br><span class="line"><span class="comment">#    fi</span></span><br><span class="line"><span class="comment">#  done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> fname <span class="keyword">in</span> `ls`;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	string=$(<span class="built_in">echo</span> <span class="variable">$fname</span>)</span><br><span class="line">	<span class="keyword">if</span> [[ <span class="variable">$string</span> = *<span class="variable">$&#123;sub1&#125;</span>* || <span class="variable">$string</span> = *<span class="variable">$&#123;sub2&#125;</span>* || <span class="variable">$string</span> = *<span class="variable">$&#123;sub3&#125;</span>*  || <span class="variable">$string</span> = *<span class="variable">$&#123;sub4&#125;</span>* ]];</span><br><span class="line">	<span class="keyword">then</span></span><br><span class="line">    	nstring=$(<span class="built_in">echo</span> <span class="variable">$s</span> | sed -e <span class="string">"s/<span class="variable">$&#123;sub1&#125;</span>//g"</span> -e <span class="string">"s/<span class="variable">$sub2</span>//g"</span> -e <span class="string">"s/<span class="variable">$sub3</span>//g"</span> -e <span class="string">"s/\(()\)//g/"</span> -e <span class="string">"s/\[[]\]//g"</span> )</span><br><span class="line"></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$nstring</span></span><br><span class="line">        mv <span class="variable">$f</span> <span class="variable">$nstring</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">IFS=<span class="variable">$TMP_IFS</span></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="Linux-下-wireless-WPA-加密连接"><a href="#Linux-下-wireless-WPA-加密连接" class="headerlink" title="Linux 下 wireless WPA 加密连接"></a>Linux 下 wireless WPA 加密连接</h1><ul>
<li>确保安装了 wpasupplicant</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get install wpasupplicant.</span><br></pre></td></tr></table></figure>
<ul>
<li><p>创建 /etc/wpa_supplicant.conf 或者从 <strong>/usr/share/doc/wpa_supplicant/examples/wpa_supplicant.conf.gz</strong> 复制</p>
</li>
<li><p>例如:</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">network=&#123;</span><br><span class="line">    ssid=<span class="string">"ssid_name"</span></span><br><span class="line">    psk=<span class="string">"password"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>手动命令行连接</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo wpa_supplicant -B -iwlan0 -c/etc/wpa_supplicant.conf -Dwext</span><br><span class="line">~$ sudo dhclient wlan0</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="MT7601U-开启软件AP功能（非hostapd"><a href="#MT7601U-开启软件AP功能（非hostapd" class="headerlink" title="MT7601U 开启软件AP功能（非hostapd)"></a>MT7601U 开启软件AP功能（非hostapd)</h1><ul>
<li><a href="https://github.com/Anthony96922/mt7601u-ap" target="_blank" rel="noopener">https://github.com/Anthony96922/mt7601u-ap</a></li>
</ul>
<ul>
<li>如果安装或是编译了其它的<code>mt7601u</code>的驱动，需要把它卸载或者加入黑名单里，不能加载它。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /etc/modprobe.d/blacklist-mt7601u</span><br><span class="line">blacklist mt7601u</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="RTL8812AU驱动-0bda-0811"><a href="#RTL8812AU驱动-0bda-0811" class="headerlink" title="RTL8812AU驱动(0bda:0811)"></a>RTL8812AU驱动(0bda:0811)</h1><ul>
<li><a href="https://github.com/ulli-kroll/rtl8821au" target="_blank" rel="noopener">https://github.com/ulli-kroll/rtl8821au</a> （无AP功能）</li>
<li><a href="https://github.com/aircrack-ng/rtl8812au" target="_blank" rel="noopener">https://github.com/aircrack-ng/rtl8812au</a> （完全功能）</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ lsusb -s 008 -v</span><br><span class="line"></span><br><span class="line">Bus 008 Device 008: ID 0bda:0811 Realtek Semiconductor Corp.</span><br></pre></td></tr></table></figure>
<ul>
<li><p>这块<code>RTL8812AU</code>的网卡是<code>EDUP AC-1608</code>，查看它官方驱动是法支持AP功能且还不支持<code>nl80211</code>的驱动，之后去到<a href="https://github.com" target="_blank" rel="noopener">github</a>搜索到一些驱动，有一些是只能使用网卡功能，有一些还连编译都无法通过。后来验证两个驱动如上，最后使用了<a href="https://github.com/aircrack-ng/rtl8812au" target="_blank" rel="noopener">aircrack-ng</a>解决了所有的问题,不愧是黒技术的先锋.</p>
</li>
<li><p>按照<a href="https://github.com/aircrack-ng/rtl8812au" target="_blank" rel="noopener">aircrack-ng</a>的提示，直接<code>make &amp;&amp; make install</code>或者<code>sudo ./dkms-install.sh</code>就直接编译并安装到内核树的驱动里。加载成功后,查看模块信息，检测到功能如下：</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ modinfo 88XXau | grep <span class="string">"0811"</span></span><br><span class="line"><span class="built_in">alias</span>:          usb:v0BDAp0811d*dc*dsc*dp*ic*isc*ip*<span class="keyword">in</span>*</span><br></pre></td></tr></table></figure>
<ul>
<li>查看phy的信息。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line">~$ iw list</span><br><span class="line">Wiphy phy3</span><br><span class="line">	max <span class="comment"># scan SSIDs: 9</span></span><br><span class="line">	max scan IEs length: 2304 bytes</span><br><span class="line">	max <span class="comment"># sched scan SSIDs: 0</span></span><br><span class="line">	max <span class="comment"># match sets: 0</span></span><br><span class="line">	max <span class="comment"># scan plans: 1</span></span><br><span class="line">	max scan plan interval: -1</span><br><span class="line">	max scan plan iterations: 0</span><br><span class="line">	Retry short <span class="built_in">limit</span>: 7</span><br><span class="line">	Retry long <span class="built_in">limit</span>: 4</span><br><span class="line">	Coverage class: 0 (up to 0m)</span><br><span class="line">	Supported Ciphers:</span><br><span class="line">		* WEP40 (00-0f-ac:1)</span><br><span class="line">		* WEP104 (00-0f-ac:5)</span><br><span class="line">		* TKIP (00-0f-ac:2)</span><br><span class="line">		* CCMP-128 (00-0f-ac:4)</span><br><span class="line">		* CMAC (00-0f-ac:6)</span><br><span class="line">	Available Antennas: TX 0x1 RX 0x1</span><br><span class="line">	Supported interface modes:</span><br><span class="line">		 * IBSS</span><br><span class="line">		 * managed</span><br><span class="line">		 * AP</span><br><span class="line">		 * monitor</span><br><span class="line">		 * P2P-client</span><br><span class="line">		 * P2P-GO</span><br><span class="line">	Band 1:</span><br><span class="line">		Capabilities: 0x1972</span><br><span class="line">			HT20/HT40</span><br><span class="line">			Static SM Power Save</span><br><span class="line">			RX Greenfield</span><br><span class="line">			RX HT20 SGI</span><br><span class="line">			RX HT40 SGI</span><br><span class="line">			RX STBC 1-stream</span><br><span class="line">			Max AMSDU length: 7935 bytes</span><br><span class="line">			DSSS/CCK HT40</span><br><span class="line">		Maximum RX AMPDU length 65535 bytes (exponent: 0x003)</span><br><span class="line">		Minimum RX AMPDU time spacing: 16 usec (0x07)</span><br><span class="line">		HT Max RX data rate: 150 Mbps</span><br><span class="line">		HT TX/RX MCS rate indexes supported: 0-7</span><br><span class="line">		Bitrates (non-HT):</span><br><span class="line">			* 1.0 Mbps</span><br><span class="line">			* 2.0 Mbps</span><br><span class="line">			* 5.5 Mbps</span><br><span class="line">			* 11.0 Mbps</span><br><span class="line">			* 6.0 Mbps</span><br><span class="line">			* 9.0 Mbps</span><br><span class="line">			* 12.0 Mbps</span><br><span class="line">			* 18.0 Mbps</span><br><span class="line">			* 24.0 Mbps</span><br><span class="line">			* 36.0 Mbps</span><br><span class="line">			* 48.0 Mbps</span><br><span class="line">			* 54.0 Mbps</span><br><span class="line">		Frequencies:</span><br><span class="line">			* 2412 MHz [1] (20.0 dBm)</span><br><span class="line">			* 2417 MHz [2] (20.0 dBm)</span><br><span class="line">			* 2422 MHz [3] (20.0 dBm)</span><br><span class="line">			* 2427 MHz [4] (20.0 dBm)</span><br><span class="line">			* 2432 MHz [5] (20.0 dBm)</span><br><span class="line">			* 2437 MHz [6] (20.0 dBm)</span><br><span class="line">			* 2442 MHz [7] (20.0 dBm)</span><br><span class="line">			* 2447 MHz [8] (20.0 dBm)</span><br><span class="line">			* 2452 MHz [9] (20.0 dBm)</span><br><span class="line">			* 2457 MHz [10] (20.0 dBm)</span><br><span class="line">			* 2462 MHz [11] (20.0 dBm)</span><br><span class="line">			* 2467 MHz [12] (20.0 dBm)</span><br><span class="line">			* 2472 MHz [13] (20.0 dBm)</span><br><span class="line">			* 2484 MHz [14] (20.0 dBm)</span><br><span class="line">	Band 2:</span><br><span class="line">		Capabilities: 0x1972</span><br><span class="line">			HT20/HT40</span><br><span class="line">			Static SM Power Save</span><br><span class="line">			RX Greenfield</span><br><span class="line">			RX HT20 SGI</span><br><span class="line">			RX HT40 SGI</span><br><span class="line">			RX STBC 1-stream</span><br><span class="line">			Max AMSDU length: 7935 bytes</span><br><span class="line">			DSSS/CCK HT40</span><br><span class="line">		Maximum RX AMPDU length 65535 bytes (exponent: 0x003)</span><br><span class="line">		Minimum RX AMPDU time spacing: 16 usec (0x07)</span><br><span class="line">		HT Max RX data rate: 150 Mbps</span><br><span class="line">		HT TX/RX MCS rate indexes supported: 0-7</span><br><span class="line">		VHT Capabilities (0x03c03122):</span><br><span class="line">			Max MPDU length: 11454</span><br><span class="line">			Supported Channel Width: neither 160 nor 80+80</span><br><span class="line">			short GI (80 MHz)</span><br><span class="line">			SU Beamformee</span><br><span class="line">			+HTC-VHT</span><br><span class="line">		VHT RX MCS <span class="built_in">set</span>:</span><br><span class="line">			1 streams: MCS 0-9</span><br><span class="line">			2 streams: not supported</span><br><span class="line">			3 streams: not supported</span><br><span class="line">			4 streams: not supported</span><br><span class="line">			5 streams: not supported</span><br><span class="line">			6 streams: not supported</span><br><span class="line">			7 streams: not supported</span><br><span class="line">			8 streams: not supported</span><br><span class="line">		VHT RX highest supported: 434 Mbps</span><br><span class="line">		VHT TX MCS <span class="built_in">set</span>:</span><br><span class="line">			1 streams: MCS 0-9</span><br><span class="line">			2 streams: not supported</span><br><span class="line">			3 streams: not supported</span><br><span class="line">			4 streams: not supported</span><br><span class="line">			5 streams: not supported</span><br><span class="line">			6 streams: not supported</span><br><span class="line">			7 streams: not supported</span><br><span class="line">			8 streams: not supported</span><br><span class="line">		VHT TX highest supported: 434 Mbps</span><br><span class="line">		Bitrates (non-HT):</span><br><span class="line">			* 6.0 Mbps</span><br><span class="line">			* 9.0 Mbps</span><br><span class="line">			* 12.0 Mbps</span><br><span class="line">			* 18.0 Mbps</span><br><span class="line">			* 24.0 Mbps</span><br><span class="line">			* 36.0 Mbps</span><br><span class="line">			* 48.0 Mbps</span><br><span class="line">			* 54.0 Mbps</span><br><span class="line">		Frequencies:</span><br><span class="line">			* 5180 MHz [36] (23.0 dBm)</span><br><span class="line">			* 5200 MHz [40] (23.0 dBm)</span><br><span class="line">			* 5220 MHz [44] (23.0 dBm)</span><br><span class="line">			* 5240 MHz [48] (23.0 dBm)</span><br><span class="line">			* 5260 MHz [52] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5280 MHz [56] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5300 MHz [60] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5320 MHz [64] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5500 MHz [100] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5520 MHz [104] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5540 MHz [108] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5560 MHz [112] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5580 MHz [116] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5600 MHz [120] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5620 MHz [124] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5640 MHz [128] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5660 MHz [132] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5680 MHz [136] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5700 MHz [140] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5720 MHz [144] (23.0 dBm) (radar detection)</span><br><span class="line">			* 5745 MHz [149] (30.0 dBm)</span><br><span class="line">			* 5765 MHz [153] (30.0 dBm)</span><br><span class="line">			* 5785 MHz [157] (30.0 dBm)</span><br><span class="line">			* 5805 MHz [161] (30.0 dBm)</span><br><span class="line">			* 5825 MHz [165] (30.0 dBm)</span><br><span class="line">			* 5845 MHz [169] (30.0 dBm)</span><br><span class="line">			* 5865 MHz [173] (30.0 dBm)</span><br><span class="line">			* 5885 MHz [177] (30.0 dBm)</span><br><span class="line">	Supported commands:</span><br><span class="line">		 * new_interface</span><br><span class="line">		 * set_interface</span><br><span class="line">		 * new_key</span><br><span class="line">		 * start_ap</span><br><span class="line">		 * new_station</span><br><span class="line">		 * set_bss</span><br><span class="line">		 * join_ibss</span><br><span class="line">		 * set_pmksa</span><br><span class="line">		 * del_pmksa</span><br><span class="line">		 * flush_pmksa</span><br><span class="line">		 * remain_on_channel</span><br><span class="line">		 * frame</span><br><span class="line">		 * set_channel</span><br><span class="line">		 * connect</span><br><span class="line">		 * disconnect</span><br><span class="line">	Supported TX frame types:</span><br><span class="line">		 * IBSS: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 0xb0 0xc0 0xd0 0xe0 0xf0</span><br><span class="line">		 * managed: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 0xb0 0xc0 0xd0 0xe0 0xf0</span><br><span class="line">		 * AP: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 0xb0 0xc0 0xd0 0xe0 0xf0</span><br><span class="line">		 * AP/VLAN: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 0xb0 0xc0 0xd0 0xe0 0xf0</span><br><span class="line">		 * P2P-client: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 0xb0 0xc0 0xd0 0xe0 0xf0</span><br><span class="line">		 * P2P-GO: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 0xb0 0xc0 0xd0 0xe0 0xf0</span><br><span class="line">	Supported RX frame types:</span><br><span class="line">		 * IBSS: 0xd0</span><br><span class="line">		 * managed: 0x40 0xb0 0xd0</span><br><span class="line">		 * AP: 0x00 0x20 0x40 0xa0 0xb0 0xc0 0xd0</span><br><span class="line">		 * AP/VLAN: 0x00 0x20 0x40 0xa0 0xb0 0xc0 0xd0</span><br><span class="line">		 * P2P-client: 0x40 0xd0</span><br><span class="line">		 * P2P-GO: 0x00 0x20 0x40 0xa0 0xb0 0xc0 0xd0</span><br><span class="line">	WoWLAN support:</span><br><span class="line">		 * wake up on anything (device continues operating normally)</span><br><span class="line">	software interface modes (can always be added):</span><br><span class="line">		 * monitor</span><br><span class="line">	interface combinations are not supported</span><br><span class="line">	Device supports SAE with AUTHENTICATE <span class="built_in">command</span></span><br><span class="line">	Device supports scan flush.</span><br><span class="line">	Supported extended features:</span><br><span class="line">michael@debian:~/3TB-DISK$</span><br><span class="line">michael@debian:~/3TB-DISK$ iw wlan0 info</span><br><span class="line">Interface wlan0</span><br><span class="line">	ifindex 13</span><br><span class="line">	wdev 0x300000001</span><br><span class="line">	addr e8:4e:06:5b:fa:98</span><br><span class="line">	<span class="built_in">type</span> managed</span><br><span class="line">	wiphy 3</span><br><span class="line">	txpower 20.00 dBm</span><br></pre></td></tr></table></figure>
<h2 id="使用wpa-supplicant"><a href="#使用wpa-supplicant" class="headerlink" title="使用wpa_supplicant"></a>使用wpa_supplicant</h2><ul>
<li><a href="https://w1.fi/wpa_supplicant/" target="_blank" rel="noopener">wpa_supplicant</a> is a WPA Supplicant for Linux, BSD, Mac OS X, and Windows with support for WPA and WPA2 (IEEE 802.11i / RSN).</li>
</ul>
<ul>
<li>wpa_supplicant是一个提供WPA认证的客户端，它除了可以做为网卡端提供认证外，还可以在AP模式提供认证。</li>
</ul>
<h3 id="AP模式"><a href="#AP模式" class="headerlink" title="AP模式"></a>AP模式</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /etc/wpa_supplicant/wpa_supplicant.conf</span><br><span class="line">network=&#123;</span><br><span class="line">    ssid=<span class="string">"RPi3B"</span></span><br><span class="line">    mode=2     <span class="comment"># AP 模式。需要网卡支持。</span></span><br><span class="line">    proto=RSN</span><br><span class="line">    key_mgmt=WPA-PSK</span><br><span class="line">    pairwise=CCMP TKIP</span><br><span class="line">    group=CCMP TKIP</span><br><span class="line">    psk=<span class="string">"12345678"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>创建如上面的配置文件，就可以使用命令运行它成为一AP点。认证连接后，需要为客户端分配IP，具体可以在本机上安装一个udhcpd.<br>也可以客户端手动设置IP与这边的AP端是在同一个网络里。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo wpa_supplicant -Dnl80211 -iwlan0 -c/etc/wpa_supplicant/wpa_supplicant.conf</span><br><span class="line"><span class="comment"># 如果加 -B 就是运行在后台模式。</span></span><br><span class="line">Successfully initialized wpa_supplicant</span><br><span class="line"><span class="comment"># 这个错误是内核里没有选择`RF switch subsystem support`编译</span></span><br><span class="line">rfkill: Cannot open RFKILL control device</span><br><span class="line">Using interface wlan0 with hwaddr e8:xx:06:xx:xx:98 and ssid <span class="string">"RPi3B"</span></span><br><span class="line">wlan0: interface state UNINITIALIZED-&gt;ENABLED</span><br><span class="line">wlan0: AP-ENABLED</span><br><span class="line">wlan0: CTRL-EVENT-CONNECTED - Connection to e8:xx:06:xx:xx:98 completed [id=0 id_str=]</span><br></pre></td></tr></table></figure>
<ul>
<li>也可把它集成到<code>/etc/network/interfaces</code>里，网卡开启之后自动成为一个AP点。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /etc/network/interfaces</span><br><span class="line">auto wlan0</span><br><span class="line">iface wlan0 inet static</span><br><span class="line">	address 192.168.1.100</span><br><span class="line">	netmask 255.255.255.0</span><br><span class="line">	network 192.168.1.0</span><br><span class="line">	gateway 192.168.1.1</span><br><span class="line">	pre-up wpa_supplicant -B -Dnl80211 -iwlan0 -c/etc/wpa_supplicant/wpa_supplicant.conf</span><br><span class="line">	post-down killall -q wpa_supplicant</span><br><span class="line">	<span class="built_in">wait</span>-delay 15</span><br></pre></td></tr></table></figure>
<h2 id="RPi交叉编译"><a href="#RPi交叉编译" class="headerlink" title="RPi交叉编译"></a>RPi交叉编译</h2><ul>
<li><a href="https://www.fontenay-ronan.fr/kernel-module-cross-compilation-rtl8192eu-on-ubuntu-for-raspbian/" target="_blank" rel="noopener">Cross compilation of a Kernel module on Ubuntu for Raspbian</a></li>
</ul>
<ul>
<li>这里是参照上面的链接进行编译安装的。为了ABI的兼容，它需要知道具体的目标机固件的hash版本号。需要在RPi里运下面的命令。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~$ FIRMWARE_HASH=$(zgrep <span class="string">"* firmware as of"</span> /usr/share/doc/raspberrypi-bootloader/changelog.Debian.gz | head -1 | awk <span class="string">'&#123; print $5 &#125;'</span>)</span><br><span class="line">~$ <span class="built_in">echo</span> <span class="variable">$FIRMWARE_HASH</span></span><br><span class="line">9a34efbf2fc6a27231607ce91a7cb6bf3bdbc0c5</span><br><span class="line">~$ KERNEL_HASH=$(wget https://raw.github.com/raspberrypi/firmware/<span class="variable">$FIRMWARE_HASH</span>/extra/git_hash -O -)</span><br><span class="line">~$ <span class="built_in">echo</span> <span class="variable">$KERNEL_HASH</span></span><br><span class="line">ca312f557513e057c456598528e663fe9d009498</span><br><span class="line">/* 获取本机的内核配置参数 */</span><br><span class="line"></span><br><span class="line">~$ sudo modprobe configs</span><br><span class="line">~$ uname -r</span><br><span class="line">4.19.97+</span><br></pre></td></tr></table></figure>
<ul>
<li>下面是编译主机上运行的命令。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">~$ mkdir ~/rpi-build</span><br><span class="line">~$ <span class="built_in">export</span> BASEDIR=~/rpi-build &amp;&amp; <span class="built_in">cd</span> <span class="variable">$BASEDIR</span></span><br><span class="line">~$ <span class="built_in">export</span> KERNEL_HASH=ca312f557513e057c456598528e663fe9d009498</span><br><span class="line">~$ <span class="built_in">export</span> FIRMWARE_HASH=9a34efbf2fc6a27231607ce91a7cb6bf3bdbc0c5</span><br><span class="line">~$ wget https://github.com/raspberrypi/linux/archive/<span class="variable">$KERNEL_HASH</span>.tar.gz</span><br><span class="line">~$ tar xvf <span class="variable">$KERNEL_HASH</span>.tar.gz</span><br><span class="line">~$ <span class="built_in">export</span> KERNEL_SRC=<span class="variable">$BASEDIR</span>/linux-<span class="variable">$KERNEL_HASH</span></span><br><span class="line">/* 进入内核源码目录里 */</span><br><span class="line">~$ <span class="built_in">cd</span> <span class="variable">$KERNEL_SRC</span></span><br><span class="line">~$ scp rpi@&lt;rpiip&gt;:/proc/config.gz .</span><br><span class="line">~$ zcat config.gz &gt; .config</span><br><span class="line">~$ wget https://raw.githubusercontent.com/raspberrypi/firmware/<span class="variable">$FIRMWARE_HASH</span>/extra/Module.symvers</span><br><span class="line">/* 下载配置RPi的交叉编译工具链，参考其它文章 */</span><br><span class="line">~$ ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- make oldconfig</span><br><span class="line">~$ ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- make prepare</span><br></pre></td></tr></table></figure>
<ul>
<li>参照上面出现了如下错误：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  CC [M]  /home/michael/github/aircrack-ng/rtl8812au/core/rtw_cmd.o</span><br><span class="line">/bin/sh: 1: ./scripts/recordmcount: not found</span><br><span class="line">make[2]: *** [scripts/Makefile.build:304: /home/michael/github/aircrack-ng/rtl8812au/core/rtw_cmd.o] Error 127</span><br><span class="line">make[2]: *** Deleting file <span class="string">'/home/michael/github/aircrack-ng/rtl8812au/core/rtw_cmd.o'</span></span><br><span class="line">make[1]: *** [Makefile:1522: _module_/home/michael/github/aircrack-ng/rtl8812au] Error 2</span><br><span class="line">make[1]: Leaving directory <span class="string">'/home/michael/github/raspberrypi-chaintools/linux-f16e91dad2af9d57aef477cc1f522040353849f5'</span></span><br><span class="line">make: *** [Makefile:2246: modules] Error 2</span><br></pre></td></tr></table></figure>
<ul>
<li>处理上面错误</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- make scripts</span><br></pre></td></tr></table></figure>
<ul>
<li>下载驱动源</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/aircrack-ng/rtl8812au</span><br><span class="line">~$ <span class="built_in">cd</span> rtl8812au</span><br><span class="line">~$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- KVER=4.19.97+ KSRC=<span class="variable">$KERNEL_SRC</span></span><br><span class="line">~$ scp 88XXau.ko rpi@&lt;rpi_ip&gt;:   /* 上传ko文件到RPi上 */</span><br></pre></td></tr></table></figure>
<ul>
<li>安装驱动</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo install -p -m 88XXau.ko /lib/modules/`uname -r`/kernel/drivers/net/wireless</span><br><span class="line">~$ sudo depmod `uname -r`</span><br><span class="line">~$ sudo modprobe 88XXau</span><br><span class="line">~$ modinfo 88XXau</span><br><span class="line">~$ sudo modinfo 88XXau</span><br><span class="line">filename:       /lib/modules/4.19.97+/kernel/drivers/net/wireless/88XXau.ko</span><br><span class="line">version:        v5.6.4.2_35491.20191025</span><br><span class="line">author:         Realtek Semiconductor Corp.</span><br><span class="line">description:    Realtek Wireless Lan Driver</span><br><span class="line">license:        GPL</span><br><span class="line">srcversion:     3292CDBFE1545754D9DE289</span><br><span class="line"><span class="built_in">alias</span>:          usb:v0846p9054d*dc*dsc*dp*ic*isc*ip*<span class="keyword">in</span>*</span><br><span class="line"><span class="built_in">alias</span>:          usb:v20F4p809Bd*dc*dsc*dp*ic*isc*ip*<span class="keyword">in</span>*</span><br><span class="line"><span class="built_in">alias</span>:          usb:v20F4p809Ad*dc*dsc*dp*ic*isc*ip*<span class="keyword">in</span>*</span><br><span class="line"><span class="built_in">alias</span>:          usb:v2357p0106d*dc*dsc*dp*ic*isc*ip*<span class="keyword">in</span>*</span><br><span class="line"><span class="built_in">alias</span>:          usb:v2357p011Ed*dc*dsc*dp*ic*isc*ip*<span class="keyword">in</span>*</span><br><span class="line"><span class="built_in">alias</span>:          usb:v3823p6249d*dc*dsc*dp*ic*isc*ip*<span class="keyword">in</span>*</span><br><span class="line"><span class="built_in">alias</span>:          usb:v0BDApA811d*dc*dsc*dp*ic*isc*ip*<span class="keyword">in</span>*</span><br><span class="line">[.....]</span><br><span class="line">~$ sudo iw list | grep <span class="string">"Supported interface modes"</span> -A 8</span><br><span class="line">	Supported interface modes:</span><br><span class="line">		 * IBSS</span><br><span class="line">		 * managed</span><br><span class="line">		 * AP</span><br><span class="line">		 * monitor</span><br><span class="line">		 * P2P-client</span><br><span class="line">		 * P2P-GO</span><br><span class="line">	Band 1:</span><br><span class="line">		Capabilities: 0x1972</span><br><span class="line">		[....]</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="RTL8169-驱动"><a href="#RTL8169-驱动" class="headerlink" title="RTL8169 驱动"></a>RTL8169 驱动</h1><ul>
<li><a href="https://medium.com/@lgobinath/no-ethernet-connection-in-ubuntu-16-04-linux-mint-18-with-realtek-rtl8111-8168-8411-7ae2779dc9b8" target="_blank" rel="noopener">No Ethernet Connection in Ubuntu 16.04/Linux Mint 18 with Realtek RTL8111/8168/8411</a></li>
<li><a href="https://askubuntu.com/questions/864444/r8168-module-not-used-by-ethernet-controller" target="_blank" rel="noopener">r8168 module not used by ethernet controller</a></li>
<li><a href="https://github.com/fintecheando/r8168" target="_blank" rel="noopener">https://github.com/fintecheando/r8168</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">#  查看本机硬件信息.</span><br><span class="line">~$ lshw -c network</span><br><span class="line">*-network UNCLAIMED</span><br><span class="line">       description: Ethernet interface</span><br><span class="line">       product: RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller</span><br><span class="line">       vendor: Realtek Semiconductor Co., Ltd.</span><br><span class="line">       physical id: 0</span><br><span class="line">       bus info: pci@0000:02:00.0</span><br><span class="line">       [....]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">~$ tree r8168-8.043.02/</span><br><span class="line">r8168-8.043.02/</span><br><span class="line">├── dkms.conf</span><br><span class="line">├── Makefile</span><br><span class="line">├── r8168_asf.c</span><br><span class="line">├── r8168_asf.h</span><br><span class="line">├── r8168_dash.h</span><br><span class="line">├── r8168_fiber.h</span><br><span class="line">├── r8168.h</span><br><span class="line">├── r8168_n.c</span><br><span class="line">├── r8168_realwow.h</span><br><span class="line">├── rtl_eeprom.c</span><br><span class="line">├── rtl_eeprom.h</span><br><span class="line">├── rtltool.c</span><br><span class="line">└── rtltool.h</span><br><span class="line"></span><br><span class="line">0 directories, 13 files</span><br><span class="line"></span><br><span class="line"># 查看系统已经添加了那些dkms包.</span><br><span class="line">~$ cd /usr/src/</span><br><span class="line">lcy@debian:/usr/src$ dkms status</span><br><span class="line">aufs, 4.9+20161219, 4.9.0-7-amd64, x86_64: installed</span><br><span class="line">aufs, 4.9+20161219, 4.9.0-8-amd64, x86_64: installed</span><br><span class="line">nvidia, 410.48, 4.14.77-20181016-lcy-amd64, x86_64: installed</span><br><span class="line">r8168, 8.043.02, 4.9.0-8-amd64, x86_64: installed</span><br><span class="line">rtl8812au, 4.3.8.12175.20140902+dfsg, 4.14.77-20181016-lcy-amd64, x86_64: installed</span><br><span class="line">rtl8812au, 4.3.8.12175.20140902+dfsg, 4.9.0-8-amd64, x86_64: installed</span><br><span class="line"></span><br><span class="line"># 如果没有看到添加进来，先把源码目录复制到/usr/src/r8168-8.043.02,再用下面命令加入dkms.</span><br><span class="line">~$ sudo dkms add -m r8168 -v 8.043.02</span><br><span class="line"></span><br><span class="line"># 使用dkms编译驱动包.</span><br><span class="line">~$ sudo dkms build -m r8168 -v 8.043.02</span><br><span class="line"></span><br><span class="line">Kernel preparation unnecessary for this kernel.  Skipping...</span><br><span class="line"></span><br><span class="line">Building module:</span><br><span class="line">cleaning build area...</span><br><span class="line">make -j6 KERNELRELEASE=4.14.77-20181016-lcy-amd64 -C /lib/modules/4.14.77-20181016-lcy-amd64/build M=/var/lib/dkms/r8168/8.043.02/build...(bad exit status: 2)</span><br><span class="line">Error! Bad return status for module build on kernel: 4.14.77-20181016-lcy-amd64 (x86_64)</span><br><span class="line">Consult /var/lib/dkms/r8168/8.043.02/build/make.log for more information.</span><br><span class="line"></span><br><span class="line"># 查看dkms编译为什么出错.</span><br><span class="line">~$ cat /var/lib/dkms/r8168/8.043.02/build/make.log</span><br><span class="line">DKMS make.log for r8168-8.043.02 for kernel 4.14.77-20181016-lcy-amd64 (x86_64)</span><br><span class="line">Sat Dec 29 16:31:32 CST 2018</span><br><span class="line">make: Entering directory &apos;/usr/src/linux-4.14.77&apos;</span><br><span class="line">  AR      /var/lib/dkms/r8168/8.043.02/build/built-in.o</span><br><span class="line">  CC [M]  /var/lib/dkms/r8168/8.043.02/build/r8168_n.o</span><br><span class="line">  CC [M]  /var/lib/dkms/r8168/8.043.02/build/r8168_asf.o</span><br><span class="line">  CC [M]  /var/lib/dkms/r8168/8.043.02/build/rtl_eeprom.o</span><br><span class="line">  CC [M]  /var/lib/dkms/r8168/8.043.02/build/rtltool.o</span><br><span class="line">/var/lib/dkms/r8168/8.043.02/build/r8168_n.c: In function ‘rtl8168_rx_interrupt’:</span><br><span class="line">/var/lib/dkms/r8168/8.043.02/build/r8168_n.c:25418:28: error: ‘struct net_device’ has no member named ‘last_rx’</span><br><span class="line">                         dev-&gt;last_rx = jiffies;</span><br><span class="line">                            ^~</span><br><span class="line">scripts/Makefile.build:328: recipe for target &apos;/var/lib/dkms/r8168/8.043.02/build/r8168_n.o&apos; failed</span><br><span class="line">make[1]: *** [/var/lib/dkms/r8168/8.043.02/build/r8168_n.o] Error 1</span><br><span class="line">Makefile:1527: recipe for target &apos;_module_/var/lib/dkms/r8168/8.043.02/build&apos; failed</span><br><span class="line">make: *** [_module_/var/lib/dkms/r8168/8.043.02/build] Error 2</span><br><span class="line">make: Leaving directory &apos;/usr/src/linux-4.14.77&apos;</span><br></pre></td></tr></table></figure>
<ul>
<li>删除原有的系统包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get purge r8168-dkms</span><br><span class="line">~$ sudo sh -c ‘echo blacklist r8169 &gt;&gt; /etc/modprobe.d/blacklist.conf’</span><br></pre></td></tr></table></figure>
<ul>
<li>从<a href="https://github.com/fintecheando/r8168" target="_blank" rel="noopener">https://github.com/fintecheando/r8168</a>下载驱动.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">~$ git clone https://github.com/fintecheando/r8168</span><br><span class="line">~$ cd r8168</span><br><span class="line">~$ sudo ./autorun.sh</span><br><span class="line"># 查看内核参数</span><br><span class="line">~$ lsmod | grep r8168</span><br><span class="line">r8168                 520192  0</span><br><span class="line"></span><br><span class="line"># 查看网卡参数</span><br><span class="line">~$ ethtool -i eth0</span><br><span class="line">driver: r8168</span><br><span class="line">version: 8.045.08-NAPI</span><br><span class="line">firmware-version:</span><br><span class="line">expansion-rom-version:</span><br><span class="line">bus-info: 0000:02:00.0</span><br><span class="line">supports-statistics: yes</span><br><span class="line">supports-test: no</span><br><span class="line">supports-eeprom-access: no</span><br><span class="line">supports-register-dump: yes</span><br><span class="line">supports-priv-flags: no</span><br></pre></td></tr></table></figure>
<ul>
<li>防止重命名网卡的名字,<ul>
<li><a href="https://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/" target="_blank" rel="noopener">Predictable Network Interface Names</a></li>
<li><a href="https://askubuntu.com/questions/826325/how-to-revert-usb-wifi-interface-name-from-wlxxxxxxxxxxxxx-to-wlanx" target="_blank" rel="noopener">How to revert USB wifi interface name (from wlxXXXXXXXXXXXX to wlanX)?</a></li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo ln -nfs /dev/null /etc/systemd/network/99-default.link</span><br><span class="line">~$ sudo udevadm trigger</span><br></pre></td></tr></table></figure>
<h1 id="使用-hostapd-配置-WIFI-热点"><a href="#使用-hostapd-配置-WIFI-热点" class="headerlink" title="使用 hostapd 配置 WIFI 热点"></a>使用 hostapd 配置 WIFI 热点</h1><ul>
<li><a href="http://pisarenko.net/blog/2015/02/01/beginners-guide-to-802-dot-11ac-setup/" target="_blank" rel="noopener">Beginners guide to a custom 802.11ac setup</a></li>
<li><a href="https://wiki.gentoo.org/wiki/Hostapd" target="_blank" rel="noopener">Hostapd</a></li>
<li><a href="https://wiki.debian.org/WiFi/HowToUse" target="_blank" rel="noopener">WiFi/HowToUse</a></li>
<li><a href="https://www.96boards.org/documentation/consumer/guides/wifi_commandline.md.html" target="_blank" rel="noopener">Setting up a WIFI connection via command line on Debian/Ubuntu (Network Manager)</a></li>
</ul>
<h2 id="查看网卡配置"><a href="#查看网卡配置" class="headerlink" title="查看网卡配置"></a>查看网卡配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~$ iw list | grep &quot;Supported interface modes&quot; -A 8</span><br><span class="line">        Supported interface modes:</span><br><span class="line">                 * IBSS</span><br><span class="line">                 * managed</span><br><span class="line">                 * AP</span><br><span class="line">                 * monitor</span><br><span class="line">                 * P2P-client</span><br><span class="line">                 * P2P-GO</span><br><span class="line">        Band 1:</span><br><span class="line">                Capabilities: 0x1862</span><br><span class="line">~$ iw reg get</span><br><span class="line">global</span><br><span class="line">country 00: DFS-UNSET</span><br><span class="line">        (2402 - 2472 @ 40), (N/A, 20), (N/A)</span><br><span class="line">        (2457 - 2482 @ 20), (N/A, 20), (N/A), AUTO-BW, NO-IR</span><br><span class="line">        (2474 - 2494 @ 20), (N/A, 20), (N/A), NO-OFDM, NO-IR</span><br><span class="line">        (5170 - 5250 @ 80), (N/A, 20), (N/A), AUTO-BW, NO-IR</span><br><span class="line">        (5250 - 5330 @ 80), (N/A, 20), (0 ms), DFS, AUTO-BW, NO-IR</span><br><span class="line">        (5490 - 5730 @ 160), (N/A, 20), (0 ms), DFS, NO-IR</span><br><span class="line">        (5735 - 5835 @ 80), (N/A, 20), (N/A), NO-IR</span><br><span class="line">        (57240 - 63720 @ 2160), (N/A, 0), (N/A)</span><br></pre></td></tr></table></figure>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get install hostapd</span><br><span class="line">~$ cp /usr/share/doc/hostapd/examples/hostapd.config.gz /etc/hostapd/</span><br><span class="line">~$ gzip -d /etc/hostapd/hostapd.conf</span><br></pre></td></tr></table></figure>
<h2 id="调试配置文件错误"><a href="#调试配置文件错误" class="headerlink" title="调试配置文件错误"></a>调试配置文件错误</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置文件错误</span></span><br><span class="line">~$ hostapd /etc/hostapd/hostapd.conf</span><br><span class="line">Configuration file: /etc/hostapd/hostapd.conf</span><br><span class="line">Cannot <span class="built_in">enable</span> IEEE 802.11d without setting the country_code</span><br><span class="line">2 errors found <span class="keyword">in</span> configuration file <span class="string">'/etc/hostapd/hostapd.conf'</span></span><br><span class="line">Failed to <span class="built_in">set</span> up interface with /etc/hostapd/hostapd.conf</span><br><span class="line">Failed to initialize interface</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缺少rfkill模块支持.</span></span><br><span class="line">~$ sudo hostapd -dd /etc/hostapd/hostapd.conf</span><br><span class="line">random: Trying to <span class="built_in">read</span> entropy from /dev/random</span><br><span class="line">Configuration file: /etc/hostapd/hostapd.conf</span><br><span class="line">ctrl_interface_group=0</span><br><span class="line">rfkill: Cannot open RFKILL control device</span><br><span class="line">nl80211: RFKILL status not available</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试wpa_support</span></span><br><span class="line">~$ sudo cp /usr/share/doc/wpasupplicant/examples/wpa_supplicant.conf.gz /etc/wpa_supplicant/</span><br><span class="line">~$ wpa_supplicant -B -i wlan0 -D wext -c /etc/wpa_supplicant/wpa_supplicant.conf</span><br></pre></td></tr></table></figure>
<h2 id="配置实例"><a href="#配置实例" class="headerlink" title="配置实例"></a>配置实例</h2><ul>
<li><p><a href="https://wiki.gentoo.org/wiki/Hostapd" target="_blank" rel="noopener">Hostapd</a></p>
</li>
<li><p>下面的配置有一些网卡是不支持的，出错需注释相关行。</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo grep -v <span class="string">'^#'</span> hostapd.conf | grep -v <span class="string">'^$'</span></span><br><span class="line">interface=wlan0</span><br><span class="line">driver=nl80211</span><br><span class="line">logger_syslog=1</span><br><span class="line">logger_syslog_level=0</span><br><span class="line">logger_stdout=1</span><br><span class="line">logger_stdout_level=2</span><br><span class="line">ctrl_interface=/var/run/hostapd</span><br><span class="line">ctrl_interface_group=0</span><br><span class="line">ssid=lcy_home</span><br><span class="line">country_code=CN</span><br><span class="line">ieee80211d=1</span><br><span class="line">hw_mode=g</span><br><span class="line">channel=4</span><br><span class="line">auth_algs=3</span><br><span class="line">ignore_broadcast_ssid=0</span><br><span class="line">uapsd_advertisement_enabled=1</span><br><span class="line">ieee80211n=1</span><br><span class="line">ieee80211ac=1</span><br><span class="line">eap_server=0</span><br><span class="line">own_ip_addr=127.0.0.1</span><br><span class="line">wpa=2</span><br><span class="line">wpa_psk_file=/etc/hostapd.wpa_psk</span><br><span class="line">wpa_key_mgmt=WPA-PSK</span><br><span class="line">wpa_pairwise=TKIP</span><br><span class="line">rsn_pairwise=CCMP</span><br><span class="line">wpa_group_rekey=600</span><br><span class="line">wpa_gmk_rekey=86400</span><br></pre></td></tr></table></figure>
<h2 id="配置主机路由"><a href="#配置主机路由" class="headerlink" title="配置主机路由"></a>配置主机路由</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root<span class="comment"># echo "net.ipv4.ip_forward=1" &gt; /etc/sysconf.ctl  # 这一行很重要.</span></span><br><span class="line">root<span class="comment"># iptables -t nat -I  POSTROUTING -j MASQUERADE  # 配置主机的NAT路由.确定是在第一条规则.</span></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="Linux-下是使用蓝牙串口通信"><a href="#Linux-下是使用蓝牙串口通信" class="headerlink" title="Linux 下是使用蓝牙串口通信"></a>Linux 下是使用蓝牙串口通信</h1><ul>
<li>如果是自编译内核要确保<code>RFCOMM protocol support (BT_RFCOMM)</code>是编译成模块的，而不能直接编入内核或者不编。</li>
<li>Linux 下使用蓝牙工具要安装<code>bluez</code>软件,有一个图形配置程序<code>blueman</code>,使用会报一些 Python 与 Dbus 的错误,还是直接修改配置文件解决使用问题.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /etc/bluetooth/rfcomm.conf</span><br><span class="line">rfcomm0 &#123;</span><br><span class="line">        <span class="built_in">bind</span> yes;</span><br><span class="line">        device 00:15:83:00:43:AB</span><br><span class="line">        channel 0;</span><br><span class="line">        comment <span class="string">"Serial Port"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rfcomm1 &#123;</span><br><span class="line">    <span class="built_in">bind</span> yes;</span><br><span class="line">    device 00:14:01:22:14:49;</span><br><span class="line">    channel 1;</span><br><span class="line">    connment <span class="string">"Serial Port 1"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="配对蓝牙"><a href="#配对蓝牙" class="headerlink" title="配对蓝牙"></a>配对蓝牙</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ bluetoothctl</span><br><span class="line">[NEW] Controller 00:02:5B:0A:59:3A debian-0 [default]</span><br><span class="line">[NEW] Device 00:14:01:22:14:49 lcy</span><br><span class="line">[bluetooth]<span class="comment"># power on</span></span><br><span class="line">Changing power on succeeded</span><br><span class="line">[bluetooth]<span class="comment"># agent on</span></span><br><span class="line">Agent registered</span><br><span class="line">[bluetooth]<span class="comment"># pair 00:14:01:22:14:49</span></span><br><span class="line">Attempting to pair with 00:14:01:22:14:49</span><br><span class="line">[CHG] Device 00:14:01:22:14:49 Connected: yes</span><br><span class="line">Request PIN code</span><br><span class="line">[agent] Enter PIN code: 1234</span><br><span class="line">[CHG] Device 00:14:01:22:14:49 Paired: yes</span><br><span class="line">Pairing successful</span><br><span class="line">[CHG] Device 00:14:01:22:14:49 Connected: no</span><br></pre></td></tr></table></figure>
<h2 id="手动边接-RFCOMM-串口"><a href="#手动边接-RFCOMM-串口" class="headerlink" title="手动边接 RFCOMM 串口"></a>手动边接 RFCOMM 串口</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> sudo rfcomm connect /dev/rfcomm0 00:14:01:22:14:49 1</span><br><span class="line">Connected /dev/rfcomm0 to 00:14:01:22:14:49 on channel 1</span><br><span class="line">Press CTRL-C <span class="keyword">for</span> hangup</span><br></pre></td></tr></table></figure>
<ul>
<li>运行上面的命令无错,就可以使用 minicom 连接它了,<code>sudo minicom -o -b 115200 -D /dev/rfcomm0</code></li>
<li>如果运行图形配置向导，要先运行<code>blueman-applet</code>再运行<code>blueman-manager</code>,就可以配置了。</li>
</ul>
<h2 id="蓝牙错误"><a href="#蓝牙错误" class="headerlink" title="蓝牙错误"></a>蓝牙错误</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl status bluetooth</span><br><span class="line">● bluetooth.service - Bluetooth service</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/bluetooth.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: failed (Result: signal) since Wed 2018-06-20 14:54:03 CST; 5min ago</span><br><span class="line">     Docs: man:bluetoothd(8)</span><br><span class="line"> Main PID: 772 (code=killed, signal=KILL)</span><br><span class="line">   Status: <span class="string">"Running"</span></span><br><span class="line">michael@debian:/etc/init.d$ sudo systemctl status bluetooth</span><br><span class="line">● bluetooth.service - Bluetooth service</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/bluetooth.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: failed (Result: signal) since Wed 2018-06-20 14:54:03 CST; 5min ago</span><br><span class="line">     Docs: man:bluetoothd(8)</span><br><span class="line"> Main PID: 772 (code=killed, signal=KILL)</span><br><span class="line">   Status: <span class="string">"Running"</span></span><br><span class="line"></span><br><span class="line">Jun 20 14:41:29 debian bluetoothd[772]: Failed to obtain handles <span class="keyword">for</span> <span class="string">"Service Changed"</span> characteristic</span><br><span class="line">Jun 20 14:41:29 debian bluetoothd[772]: Sap driver initialization failed.</span><br><span class="line">Jun 20 14:41:29 debian bluetoothd[772]: sap-server: Operation not permitted (1)</span><br><span class="line">Jun 20 14:41:29 debian bluetoothd[772]: Endpoint registered: sender=:1.67 path=/MediaEndpoint/A2DPSource</span><br><span class="line">Jun 20 14:41:29 debian bluetoothd[772]: Endpoint registered: sender=:1.67 path=/MediaEndpoint/A2DPSink</span><br><span class="line">Jun 20 14:42:00 debian bluetoothd[772]: vendor 0x0 product: 0x0</span><br><span class="line">Jun 20 14:43:36 debian bluetoothd[772]: vendor 0x0 product: 0x0</span><br><span class="line">Jun 20 14:54:03 debian systemd[1]: bluetooth.service: Main process exited, code=killed, status=9/KILL</span><br><span class="line">Jun 20 14:54:03 debian systemd[1]: bluetooth.service: Unit entered failed state.</span><br><span class="line">Jun 20 14:54:03 debian systemd[1]: bluetooth.service: Failed with result <span class="string">'signal'</span>.</span><br></pre></td></tr></table></figure>
<h1 id="Linux-Systemctl-启动服务超时设置"><a href="#Linux-Systemctl-启动服务超时设置" class="headerlink" title="Linux Systemctl 启动服务超时设置"></a>Linux Systemctl 启动服务超时设置</h1><ul>
<li>下面用一个网络连接服务为示例,如果网络配置是 DHCP,刚好网络没有提供 DHCP 服务,这时该服务程序会重试(默认)两分钟才会报错,这里可以设置成 5 到 10 秒,快速跳过该服务启动.</li>
<li>在文件/lib/systemd/system/networking.service.d/network-pre.conf 里添加下面两行:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">TimeoutStartSec=15</span><br></pre></td></tr></table></figure>
<h1 id="安装-IBus-输入法框架"><a href="#安装-IBus-输入法框架" class="headerlink" title="安装 IBus 输入法框架"></a>安装 IBus 输入法框架</h1><ul>
<li>IBus (“Intelligent Input Bus”) 是一个 输入法框架，一个输入非英语字符的系统。IBus 的功能与 SCIM 和 UIM 类似。在 Debian 下面有一个问题,如果不安装<code>ibus-gtk3,ibus-gtk</code>就会出现<strong>wxWidgets</strong>框架下的文本输入框无法使用<code>Back Space,Arrown keys</code>这些按键.<a href="https://wiki.archlinux.org/index.php/IBus_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87" target="_blank" rel="noopener">安装指导</a>&gt;)</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">~$ dpkg -l | grep <span class="string">"ibus"</span></span><br><span class="line">ii  gir1.2-ibus-1.0:amd64                             1.5.14-3                                    amd64        Intelligent Input Bus - introspection data</span><br><span class="line">ii  ibus                                              1.5.14-3                                    amd64        Intelligent Input Bus - core</span><br><span class="line">ii  ibus-gtk:amd64                                    1.5.14-3                                    amd64        Intelligent Input Bus - GTK+2 support</span><br><span class="line">ii  ibus-gtk3:amd64                                   1.5.14-3                                    amd64        Intelligent Input Bus - GTK+3 support</span><br><span class="line">ii  ibus-qt4                                          1.3.3-1                                     amd64        qt-immodule <span class="keyword">for</span> ibus (QT4) (plugin)</span><br><span class="line">ii  ibus-table                                        1.9.14-3                                    all          table engine <span class="keyword">for</span> IBus</span><br><span class="line">ii  ibus-table-wubi                                   1.8.2-2                                     all          ibus-table input method: Wubi</span><br><span class="line">ii  libgusb-dev                                       0.2.9-1+b1                                  amd64        GLib wrapper around libusb1 - development files</span><br><span class="line">ii  libgusb2:amd64                                    0.2.9-1+b1                                  amd64        GLib wrapper around libusb1</span><br><span class="line">ii  libhidapi-libusb0:amd64                           0.8.0~rc1+git20140818.d17db57+dfsg-1        amd64        Multi-Platform library <span class="keyword">for</span> communication with HID devices (libusb backend)</span><br><span class="line">ii  libibus-1.0-5:amd64                               1.5.14-3                                    amd64        Intelligent Input Bus - shared library</span><br><span class="line">ii  libibus-1.0-dev:amd64                             1.5.14-3                                    amd64        Intelligent Input Bus - development file</span><br><span class="line">ii  libibus-qt1                                       1.3.3-1                                     amd64        qt-immodule <span class="keyword">for</span> ibus (QT4) (library)</span><br><span class="line"></span><br><span class="line">~$ cat ~/.xinitrc</span><br><span class="line"><span class="built_in">export</span> GTK_IM_MODULE=ibus</span><br><span class="line"><span class="built_in">export</span> QT_IM_MODULE=ibus</span><br><span class="line"><span class="built_in">export</span> XMODIFIERS=<span class="string">"@im=ibus"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>如果要配置<code>locales</code>,方法如下:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get install locales</span><br><span class="line">~$ sudo dpkg-reconfigure locales</span><br><span class="line">~$ sudo locale-gen</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="BOSSAC-烧写-Arduino-DUE-无法找到设备"><a href="#BOSSAC-烧写-Arduino-DUE-无法找到设备" class="headerlink" title="BOSSAC 烧写 Arduino-DUE 无法找到设备"></a>BOSSAC 烧写 Arduino-DUE 无法找到设备</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./bossac -i -d --port=ttyACM0 -U <span class="literal">false</span> -e -w -v -b ./nuttx.bin -R</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Set binary mode</span><br><span class="line">Send auto-baud</span><br><span class="line">Set binary mode</span><br><span class="line">No device found on /dev/ttyACM0</span><br></pre></td></tr></table></figure>
<h2 id="处理方法"><a href="#处理方法" class="headerlink" title="处理方法"></a>处理方法</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stty -F /dev/ttyACM0 speed 1200 cs8 -cstopb -parenb</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="Virt-Manager-虚拟机无法启动"><a href="#Virt-Manager-虚拟机无法启动" class="headerlink" title="Virt-Manager 虚拟机无法启动"></a>Virt-Manager 虚拟机无法启动</h1><ul>
<li>有时 KVM 框架虚拟机系统无法启动,错误如下:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Error starting domain: Requested operation is not valid: network <span class="string">'default'</span> is not active</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<ul>
<li>通过如下命令启动网络即可.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo virsh net-list --all</span><br><span class="line"> Name                 State      Autostart     Persistent</span><br><span class="line">----------------------------------------------------------</span><br><span class="line"> default              inactive   no            yes</span><br><span class="line"></span><br><span class="line">~$ sudo virsh net-start default</span><br><span class="line">Network default started</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Virt-Manager-使用-OpenvSwitch-交换机"><a href="#Virt-Manager-使用-OpenvSwitch-交换机" class="headerlink" title="Virt-Manager 使用 OpenvSwitch 交换机"></a>Virt-Manager 使用 OpenvSwitch 交换机</h2><ul>
<li>使用 OpenvSwitch 的网络服务启动会有延迟一分钟左右.</li>
</ul>
<h2 id="安装-OpenvSwitch"><a href="#安装-OpenvSwitch" class="headerlink" title="安装 OpenvSwitch"></a>安装 OpenvSwitch</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ dpkg -l | grep <span class="string">"openvswitch"</span></span><br><span class="line">ii  openvswitch-common                                2.6.2~pre+git20161223-3                     amd64        Open vSwitch common components</span><br><span class="line">ii  openvswitch-switch                                2.6.2~pre+git20161223-3                     amd64        Open vSwitch switch implementations</span><br></pre></td></tr></table></figure>
<h2 id="创建桥接端口"><a href="#创建桥接端口" class="headerlink" title="创建桥接端口"></a>创建桥接端口</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo ovs-vsctl add-br ovsbr0</span><br><span class="line">~$ sudo ovs-vsctl add-port ovsbr0 eth0</span><br><span class="line">~$ sudo ovs-vsctl show</span><br><span class="line">dbeec575-be91-48b6-bffa-0894b0fa24dd</span><br><span class="line">    Bridge <span class="string">"ovsbr0"</span></span><br><span class="line">        Port <span class="string">"ovsbr0"</span></span><br><span class="line">            Interface <span class="string">"ovsbr0"</span></span><br><span class="line">                <span class="built_in">type</span>: internal</span><br><span class="line">        Port <span class="string">"vnet0"</span></span><br><span class="line">            Interface <span class="string">"vnet0"</span></span><br><span class="line">        Port <span class="string">"eth0"</span></span><br><span class="line">            Interface <span class="string">"eth0"</span></span><br><span class="line">    ovs_version: <span class="string">"2.6.2"</span></span><br><span class="line"></span><br><span class="line">~$ sudo ip addr del 192.168.1.100 dev eth0</span><br><span class="line">~$ sudo ip addr add 192.168.1.100 dev ovsbr0</span><br></pre></td></tr></table></figure>
<h2 id="修改网卡启动配置"><a href="#修改网卡启动配置" class="headerlink" title="修改网卡启动配置"></a>修改网卡启动配置</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /etc/network/interfaces</span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet manual</span><br><span class="line">    up ip link <span class="built_in">set</span> dev <span class="variable">$IFACE</span> up</span><br><span class="line">    down ip link <span class="built_in">set</span> dev <span class="variable">$IFACE</span> down</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">auto ovsbr0</span><br><span class="line">iface ovsbr0 inet static</span><br><span class="line">    up ip link <span class="built_in">set</span> dev <span class="variable">$IFACE</span> up</span><br><span class="line">    down ip link <span class="built_in">set</span> dev <span class="variable">$IFACE</span> down</span><br><span class="line">    address 192.168.1.100</span><br><span class="line">    netmask 255.255.255.0</span><br><span class="line">    gateway 192.168.1.1</span><br><span class="line"></span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<h2 id="创建-Virt-Manager-桥接网络"><a href="#创建-Virt-Manager-桥接网络" class="headerlink" title="创建 Virt-Manager 桥接网络"></a>创建 Virt-Manager 桥接网络</h2><ul>
<li><a href="https://wiki.archlinux.org/index.php/Network_bridge" target="_blank" rel="noopener">Network_bridge</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo cp /etc/libvirt/qemu/networks/&#123;default.xml,ovsbr0.xml&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把内容修改成如下所示</span></span><br><span class="line">~$ cat /etc/libvirt/qemu/networks/ovsbr0.xml</span><br><span class="line">&lt;!--</span><br><span class="line">WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE</span><br><span class="line">OVERWRITTEN AND LOST. Changes to this xml configuration should be made using:</span><br><span class="line">  virsh net-edit ovsbr0</span><br><span class="line">or other application using the libvirt API.</span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line">&lt;network&gt;</span><br><span class="line">  &lt;name&gt;ovsbr0&lt;/name&gt;</span><br><span class="line">  &lt;uuid&gt;fc0b3bb1-c273-49dc-b469-153dc4c452e2&lt;/uuid&gt;</span><br><span class="line">  &lt;forward mode=<span class="string">'bridge'</span>/&gt;</span><br><span class="line">  &lt;bridge name=<span class="string">'ovsbr0'</span>/&gt;</span><br><span class="line">  &lt;virtualport <span class="built_in">type</span>=<span class="string">'openvswitch'</span>/&gt;</span><br><span class="line">&lt;/network&gt;</span><br><span class="line"></span><br><span class="line">~$ sudo virsh net-define /etc/libvirt/qemu/networks/ovsbr0.xml</span><br><span class="line">~$ sudo virsh net-create /etc/libvirt/qemu/networks/ovsbr0.xml</span><br><span class="line"></span><br><span class="line">~$ sudo virsh net-list --all</span><br><span class="line"> Name                 State      Autostart     Persistent</span><br><span class="line">----------------------------------------------------------</span><br><span class="line"> default              active     yes           yes</span><br><span class="line"> ovsbr0               inactive     no           yes</span><br><span class="line"></span><br><span class="line">~$ sudo virsh net-autostart ovsbr0</span><br></pre></td></tr></table></figure>
<h2 id="设置虚拟机的网络"><a href="#设置虚拟机的网络" class="headerlink" title="设置虚拟机的网络"></a>设置虚拟机的网络</h2><ul>
<li>现在 KVM 虚拟机就有<code>default</code>,<code>ovsbr0</code>两个网络,添加一个连接到<code>OpenvSwitch</code>上的网卡如下图所示:</li>
</ul>
<p><img src="/imgs/ovsbr0.png" alt="ovsbr0"></p>
<hr>
<h1 id="创建-Debian-Live-USB-系统盘"><a href="#创建-Debian-Live-USB-系统盘" class="headerlink" title="创建 Debian Live USB 系统盘"></a>创建 Debian Live USB 系统盘</h1><ul>
<li>如果想要试用 Linux,又不想安装它,可以把它烧写到 U 盘里,做为启动盘或者系统恢复盘.</li>
<li><a href="http://mirrors.163.com/debian-cd" target="_blank" rel="noopener"><code>Debian 国内镜像下载链接</code></a></li>
<li><strong>注意:</strong> 这里一定要选择<code>live</code>标志的 iso 镜像下载.在 windows 下面要先下载一个叫<a href="http://launchpad.net/win32-image-writer/0.2/0.2/+download/win32diskimager-RELEASE-0.2-r23-win32.zip" target="_blank" rel="noopener"><code>Win32DiskImager</code></a>的烧写工具,Linux 就很简单使用下面命令就能完成:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ls  debian-live-9.4.0-amd64-mate.iso</span><br><span class="line">debian-live-9.4.0-amd64-mate.iso</span><br><span class="line">$ sudo dd <span class="keyword">if</span>=debian-live-9.4.0-amd64-mate.iso of=/dev/sdc1</span><br><span class="line">4002944+0 records <span class="keyword">in</span></span><br><span class="line">4002944+0 records out</span><br><span class="line">2049507328 bytes (2.0 GB, 1.9 GiB) copied, 7.39192 s, 277 MB/s</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>严重注意</strong> 这里的<code>/dev/sdc1</code>一要是你想要格式华的 U 盘,如果这里是当前硬盘,或者是有重要资料的盘符,就会直接覆盖它,找不回来.<strong>注意,注意,注意</strong></li>
</ul>
<hr>
<h1 id="开启-Debian-Hibernate-功能"><a href="#开启-Debian-Hibernate-功能" class="headerlink" title="开启 Debian Hibernate 功能"></a>开启 Debian Hibernate 功能</h1><ul>
<li>有时工作进行到一个阶段,不想系统重启之后,再费时间来打开与配置环境.开启系统休眠功能非常有用.先要确保有一个<code>swap</code>分区,最好是两倍与系统内存的大小.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get install acpi-support pm-utils</span><br><span class="line">~$ sudo mkswap /dev/sdb1</span><br><span class="line">~$ sudo swapon /dev/sdb1</span><br><span class="line"><span class="comment"># 确保下面这两个文件里有这些行.</span></span><br><span class="line">~$ sudo cat /etc/fstab  | grep <span class="string">"swap"</span></span><br><span class="line">/dev/sdb1       none    swap    pri=1      0       0</span><br><span class="line"></span><br><span class="line">~$ blkid</span><br><span class="line">[...]</span><br><span class="line">/dev/sdb3: UUID=<span class="string">"ae170b9d-832a-46a7-beca-5fb7c9329b1b"</span> TYPE=<span class="string">"swap"</span> PARTUUID=<span class="string">"6daebe63-03"</span></span><br><span class="line">~$ sudo cat /etc/default/grub | grep <span class="string">"resume"</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">"resume=UUID=ae170b9d-832a-46a7-beca-5fb7c9329b1b"</span></span><br><span class="line"></span><br><span class="line">~<span class="variable">$cat</span> /etc/initramfs-tools/conf.d/resume</span><br><span class="line">RESUME=UUID=ae170b9d-832a-46a7-beca-5fb7c9329b1b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#这一操作很重要.</span></span><br><span class="line">~$  update-initramfs -u -k `uname -r`  <span class="comment">## 更新当前内核的启动镜像.</span></span><br><span class="line">~$ sudo update-grub</span><br><span class="line"></span><br><span class="line">~$ cat /proc/acpi/wakeup</span><br><span class="line">Device	S-state	  Status   Sysfs node</span><br><span class="line">PB31	  S4	*disabled  pci:0000:00:03.1</span><br><span class="line">PB32	  S4	*disabled</span><br><span class="line">PB33	  S4	*disabled  pci:0000:00:03.3</span><br><span class="line">PB34	  S4	*disabled</span><br><span class="line">SBAZ	  S4	*disabled  pci:0000:00:14.2</span><br><span class="line">PS2K	  S3	*disabled</span><br><span class="line">PS2M	  S3	*disabled</span><br><span class="line">ECIR	  S4	*disabled</span><br><span class="line">P0PC	  S4	*disabled  pci:0000:00:14.4</span><br><span class="line">OHC1	  S4	*disabled  pci:0000:00:12.0</span><br><span class="line">EHC1	  S4	*disabled  pci:0000:00:12.2</span><br><span class="line">OHC2	  S4	*disabled  pci:0000:00:13.0</span><br><span class="line">EHC2	  S4	*disabled  pci:0000:00:13.2</span><br><span class="line">OHC3	  S4	*disabled</span><br><span class="line">EHC3	  S4	*disabled</span><br><span class="line">OHC4	  S4	*disabled  pci:0000:00:14.5</span><br><span class="line">XHC0	  S4	*disabled  pci:0000:00:10.0</span><br><span class="line">XHC1	  S4	*disabled  pci:0000:00:10.1</span><br><span class="line">PE20	  S4	*disabled</span><br><span class="line">PE21	  S4	*disabled</span><br><span class="line">PE22	  S4	*disabled</span><br><span class="line">PE23	  S4	*disabled</span><br><span class="line">PWRB	  S3	*enabled   platform:PNP0C0C:00</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上面是一些如何唤醒休眠的设备, 休眠中是可以通过移动鼠标或者键盘来唤醒,但是我这里把它们都关闭,让它只能通过电源按钮(PWRB)唤醒系统.</span></span><br><span class="line"></span><br><span class="line">~$  grep <span class="string">"echo"</span> /etc/rc.local</span><br><span class="line">[...]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> OHC1 EHC1 OHC2 EHC2 OHC4 XHC0 XHC1;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">cat /proc/acpi/wakeup  | grep <span class="string">"<span class="variable">$i</span>"</span> | grep <span class="string">"enabled"</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span>"</span> &gt; /proc/acpi/wakeup</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<ul>
<li><p>测试休眠功能<code>echo disk &gt; /sys/power/state</code>,或者运行<code>pm-hibernate</code>进行休眠.</p>
</li>
<li><p>通过上面设置,系统休眠与唤醒都很符合我的预期.还有一种方法是使用一个交换文件,不需要一个独立的分区,请<a href="https://wiki.debian.org/Hibernation/Hibernate_Without_Swap_Partition" target="_blank" rel="noopener">参考这里</a></p>
</li>
<li><p>如果上述设置能休眠不能关机,就是休眠后马上又重启了,<a href="https://wiki.archlinux.org/index.php/Power_management/Suspend_and_hibernate#System_does_not_power_off_when_hibernating" target="_blank" rel="noopener">参照这里</a>需要如下设置:</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/etc/systemd/sleep.conf.d/hibernatemode.conf</span><br><span class="line"></span><br><span class="line">[Sleep]</span><br><span class="line">HibernateMode=shutdown</span><br></pre></td></tr></table></figure>
<ul>
<li>如果不能使用界的<code>System-&gt;Shut Down-&gt;Hibernate</code>的进行休眠,但是可以直接使用<code>sudo pm-hibernate</code>.需要重装下面的包试试.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ apt-get install --reinstall pm-utils mate-power-manager-common hibernate upower</span><br></pre></td></tr></table></figure>
<ul>
<li>如果休眠后恢复系统不能使用<code>usb wifi</code>(rtl8812au) 网卡.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo  lshw -C network | grep <span class="string">"wlan"</span> -A +3 | grep <span class="string">"driver"</span></span><br><span class="line">       configuration: broadcast=yes driver=rtl8812au ip=192.168.5.190 multicast=yes wireless=IEEE 802.11</span><br><span class="line"><span class="comment"># 创建如下文件</span></span><br><span class="line">~$ sudo cat /etc/pm/config.d/unload_modules</span><br><span class="line">SUSPEND_MODULES=<span class="string">"<span class="variable">$SUSPEND_MODULES</span> rtl8812au"</span></span><br><span class="line"><span class="comment"># 创建成功,要加上运行权限.</span></span><br><span class="line">~$ sudo cat /etc/pm/sleep.d/10_resume_wifi</span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$&#123;1&#125;</span>"</span> <span class="keyword">in</span></span><br><span class="line">  resume|thaw)</span><br><span class="line">    nmcli r wifi off &amp;&amp; nmcli r wifi on;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<h1 id="程序找不到链接库位置"><a href="#程序找不到链接库位置" class="headerlink" title="程序找不到链接库位置"></a>程序找不到链接库位置</h1><ul>
<li>Python ImportError,这种错误是因为在<code>PYTHONPATH</code>路径中找不相就的模块.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~$ ./modes_rx</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"./modes_rx"</span>, line 27, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    import air_modes</span><br><span class="line">ImportError: No module named air_modes</span><br><span class="line"></span><br><span class="line">~$ PYTHONPATH=../lib/python2.7/dist-packages　./modes_rx    <span class="comment">#指定的环境变量对了就可以了.</span></span><br></pre></td></tr></table></figure>
<ul>
<li>本地库链接错误</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~$ ldd /usr/<span class="built_in">local</span>/bin/rtl_tcp</span><br><span class="line">	linux-vdso.so.1 (0x00007fff3d3eb000)</span><br><span class="line">	librtlsdr.so.0 =&gt; not found　　<span class="comment">#　默认位置/lib/x86_64-linux-gnu找不该库.</span></span><br><span class="line">	libusb-1.0.so.0 =&gt; /lib/x86_64-linux-gnu/libusb-1.0.so.0 (0x00007f3d0b328000)</span><br><span class="line">	libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f3d0b108000)</span><br><span class="line">	libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f3d0ad68000)</span><br><span class="line">	libudev.so.1 =&gt; /lib/x86_64-linux-gnu/libudev.so.1 (0x00007f3d0b6d8000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007f3d0b548000)</span><br><span class="line">	librt.so.1 =&gt; /lib/x86_64-linux-gnu/librt.so.1 (0x00007f3d0ab60000)</span><br><span class="line"></span><br><span class="line">~$ ls  /usr/<span class="built_in">local</span>/lib/librtlsdr.so.0　　<span class="comment">#　这个位置有这个库</span></span><br><span class="line">/usr/<span class="built_in">local</span>/lib/librtlsdr.so.0</span><br></pre></td></tr></table></figure>
<ul>
<li>上面的错误有两种方法可以解决.１,把<code>/usr/local/lib</code>加入到<code>/etc/ld.so.conf</code>里,再执行一次<code>ldconfig</code>就可以链接这个库了.2,使用<code>LD_LIBRARY_PATH</code>环境变量指位置,这样运行:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ LD_LIBRARY_PATH=/usr/<span class="built_in">local</span>/lib  rtl_tcp</span><br><span class="line">Found 1 device(s).</span><br><span class="line">Found Rafael Micro R820T tuner</span><br><span class="line">Using ezcap USB 2.0 DVB-T/DAB/FM dongle</span><br><span class="line">Tuned to 100000000 Hz.</span><br><span class="line">listening...</span><br><span class="line">Use the device argument <span class="string">'rtl_tcp=127.0.0.1:1234'</span> <span class="keyword">in</span> OsmoSDR (gr-osmosdr) <span class="built_in">source</span></span><br><span class="line">to receive samples <span class="keyword">in</span> GRC and control rtl_tcp parameters (frequency, gain, ...).</span><br></pre></td></tr></table></figure>
<h1 id="在内核树里编译单个模块"><a href="#在内核树里编译单个模块" class="headerlink" title="在内核树里编译单个模块"></a>在内核树里编译单个模块</h1><ul>
<li>比如,上面缺少一个<code>rfkill</code>的模块,现在可以在不重编整个内核的前提下,可以单独编译这个内核.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~$ cd /lib/modules/$(uname -r)/build/net/rfkill</span><br><span class="line">~$ sudo make -C /lib/modules/$(uname -r)/build M=`pwd` modules   # 要先在.config 把这一个模块选中为`编译`状态.</span><br><span class="line">make: Entering directory &apos;/usr/src/linux-4.14.77&apos;</span><br><span class="line">  CC [M]  /lib/modules/4.14.77-20181016-lcy-amd64/build/net/rfkill/core.o</span><br><span class="line">  LD [M]  /lib/modules/4.14.77-20181016-lcy-amd64/build/net/rfkill/rfkill.o</span><br><span class="line">  Building modules, stage 2.</span><br><span class="line">  MODPOST 1 modules</span><br><span class="line">  CC      /lib/modules/4.14.77-20181016-lcy-amd64/build/net/rfkill/rfkill.mod.o</span><br><span class="line">  LD [M]  /lib/modules/4.14.77-20181016-lcy-amd64/build/net/rfkill/rfkill.ko</span><br><span class="line">make: Leaving directory &apos;/usr/src/linux-4.14.77&apos;</span><br><span class="line">~$ sudo mkdir /lib/modules/$(uname -r)/kernel/net/rfkill</span><br><span class="line">~$ sudo cp rfkill.ko /lib/modules/$(uname -r)/kernel/net/rfkill/</span><br><span class="line">~$ sudo depmod -a   # 计算依赖关系</span><br><span class="line">~$ modprobe -v rfkill  # 加载模块.</span><br></pre></td></tr></table></figure>
<ul>
<li>如果每次重启，某一个网块或蓝牙都是<code>Soft Blocked</code>的话，尝试一下用命令<code>nmcli r wifi on</code>.</li>
</ul>
<h2 id="编译carl9170出错问题"><a href="#编译carl9170出错问题" class="headerlink" title="编译carl9170出错问题"></a>编译carl9170出错问题</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">michael@debian:/usr/src/linux-5.5.11/drivers/net/wireless/ath/carl9170$ sudo make -C /lib/modules/$(uname -r)/build  M=`<span class="built_in">pwd</span>`  modules</span><br><span class="line">make: Entering directory <span class="string">'/usr/src/linux-5.5.11'</span></span><br><span class="line">[....]</span><br><span class="line">  Building modules, stage 2.</span><br><span class="line">  MODPOST 1 modules</span><br><span class="line">ERROR: <span class="string">"ath_regd_init"</span> [/usr/src/linux-5.5.11/drivers/net/wireless/ath/carl9170/carl9170.ko] undefined!</span><br><span class="line">ERROR: <span class="string">"__ieee80211_get_assoc_led_name"</span> [/usr/src/linux-5.5.11/drivers/net/wireless/ath/carl9170/carl9170.ko] undefined!</span><br><span class="line">ERROR: <span class="string">"led_classdev_register_ext"</span> [/usr/src/linux-5.5.11/drivers/net/wireless/ath/carl9170/carl9170.ko] undefined!</span><br><span class="line">ERROR: <span class="string">"ath_is_mybeacon"</span> [/usr/src/linux-5.5.11/drivers/net/wireless/ath/carl9170/carl9170.ko] undefined!</span><br><span class="line">ERROR: <span class="string">"ath_is_world_regd"</span> [/usr/src/linux-5.5.11/drivers/net/wireless/ath/carl9170/carl9170.ko] undefined!</span><br><span class="line">ERROR: <span class="string">"ath_reg_notifier_apply"</span> [/usr/src/linux-5.5.11/drivers/net/wireless/ath/carl9170/carl9170.ko] undefined!</span><br><span class="line">ERROR: <span class="string">"ath_regd_get_band_ctl"</span> [/usr/src/linux-5.5.11/drivers/net/wireless/ath/carl9170/carl9170.ko] undefined!</span><br><span class="line">ERROR: <span class="string">"__ieee80211_get_tx_led_name"</span> [/usr/src/linux-5.5.11/drivers/net/wireless/ath/carl9170/carl9170.ko] undefined!</span><br><span class="line">ERROR: <span class="string">"led_classdev_unregister"</span> [/usr/src/linux-5.5.11/drivers/net/wireless/ath/carl9170/carl9170.ko] undefined!</span><br><span class="line">make[1]: *** [scripts/Makefile.modpost:94: __modpost] Error 1</span><br><span class="line">make: *** [Makefile:1607: modules] Error 2</span><br><span class="line">make: Leaving directory <span class="string">'/usr/src/linux-5.5.11'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>像上面错误，后续不能在内核树编译驱动模块，因为选中该驱动中的子选项<code>SoftLED Support(ONFIG_CARL9170_LEDS)</code>是不支持单独编译成<code>.ko</code>或者包含在这个<code>.ko</code>里，它必须编译进内核。所以碰到这种问题，只能重新编译整个内核。</li>
</ul>
<hr>
<h1 id="创建大于-2TB-的分区"><a href="#创建大于-2TB-的分区" class="headerlink" title="创建大于 2TB 的分区"></a>创建大于 2TB 的分区</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">~<span class="variable">$parted</span> /dev/sda</span><br><span class="line">WARNING: You are not superuser.  Watch out <span class="keyword">for</span> permissions.</span><br><span class="line">GNU Parted 3.2</span><br><span class="line">Using /dev/sda</span><br><span class="line">Welcome to GNU Parted! Type <span class="string">'help'</span> to view a list of commands.</span><br><span class="line">(parted) <span class="built_in">print</span></span><br><span class="line">Model: ATA ST2000DM008-2FR1 (scsi)</span><br><span class="line">Disk /dev/sda: 2000GB</span><br><span class="line">Sector size (logical/physical): 512B/4096B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start  End  Size  File system  Name  Flags</span><br><span class="line">(parted) mklabel gpt</span><br><span class="line">(parted) <span class="built_in">print</span></span><br><span class="line">Model: ATA ST2000DM008-2FR1 (scsi)</span><br><span class="line">Disk /dev/sda: 2000GB</span><br><span class="line">Sector size (logical/physical): 512B/4096B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start  End  Size  File system  Name  Flags</span><br><span class="line"></span><br><span class="line">(parted) mkpart primary 0GB 2000GB</span><br><span class="line"></span><br><span class="line">(parted) <span class="built_in">print</span></span><br><span class="line">Model: ATA ST2000DM008-2FR1 (scsi)</span><br><span class="line">Disk /dev/sda: 2000GB</span><br><span class="line">Sector size (logical/physical): 512B/4096B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    File system  Name     Flags</span><br><span class="line"> 1      1049kB  2000GB  2000GB               primary</span><br><span class="line">(parted) quit</span><br><span class="line">~$ sudo fdisk -l /dev/sda</span><br><span class="line">Disk /dev/sda: 1.8 TiB, 2000398934016 bytes, 3907029168 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 4096 bytes</span><br><span class="line">I/O size (minimum/optimal): 4096 bytes / 4096 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: gpt</span><br><span class="line">Disk identifier: 224F4012-9C49-4331-87F5-77B5CF6C28F5</span><br><span class="line"></span><br><span class="line">Device     Start        End    Sectors  Size Type</span><br><span class="line">/dev/sda1   2048 3907028991 3907026944  1.8T Linux filesystem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">~$ sudo mkfs.ext4 /dev/sda1</span><br><span class="line">mke2fs 1.43.4 (31-Jan-2017)</span><br><span class="line">/dev/sda1 contains a ext3 file system</span><br><span class="line">    created on Thu Aug 30 09:33:27 2018</span><br><span class="line">Proceed anyway? (y,N) y</span><br><span class="line"></span><br><span class="line">~$ sudo blkid</span><br><span class="line">/dev/sda1: UUID=<span class="string">"3d6c0885-cacf-41f8-911d-cdf4bd666a49"</span> TYPE=<span class="string">"ext4"</span> PARTLABEL=<span class="string">"primary"</span> PARTUUID=<span class="string">"daeb01c4-ceb5-4227-80d8-d70bfc266317"</span></span><br><span class="line">~$ cat /etc/fstab</span><br><span class="line"><span class="comment"># /etc/fstab: static file system information.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Use 'blkid' to print the universally unique identifier for a</span></span><br><span class="line"><span class="comment"># device; this may be used with UUID= as a more robust way to name devices</span></span><br><span class="line"><span class="comment"># that works even if disks are added and removed. See fstab(5).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;</span></span><br><span class="line">UUID=3d6c0885-cacf-41f8-911d-cdf4bd666a49 /data       ext4    defaults  0   2</span><br></pre></td></tr></table></figure>
<h1 id="Linux-下修复-屏蔽-磁盘坏块"><a href="#Linux-下修复-屏蔽-磁盘坏块" class="headerlink" title="Linux 下修复(屏蔽)磁盘坏块"></a>Linux 下修复(屏蔽)磁盘坏块</h1><ul>
<li><a href="https://www.tecmint.com/check-linux-hard-disk-bad-sectors-bad-blocks/" target="_blank" rel="noopener">How to Check Bad Sectors or Bad Blocks on Hard Disk in Linux</a></li>
<li><a href="https://mintguide.org/system/283-how-to-check-and-fix-the-disk-for-errors-and-bad-sectors-in-linux-mint.html" target="_blank" rel="noopener">How to check and fix the disk for errors and bad sectors </a></li>
<li><a href="https://hiddenc0de.wordpress.com/2015/06/12/how-to-fix-bad-sectors-or-bad-blocks-on-hard-disk/" target="_blank" rel="noopener">How to fix bad sectors or bad blocks on Hard Disk</a></li>
<li>查找坏块</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo badblocks -v /dev/sdaX &gt; badsectors.txt</span><br></pre></td></tr></table></figure>
<ul>
<li>修复</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">------------ Specifically <span class="keyword">for</span> ext2/ext3/ext4 file-systems ------------</span><br><span class="line">~$ sudo e2fsck -l badsectors.txt /dev/sdaX</span><br><span class="line"></span><br><span class="line">OR</span><br><span class="line"></span><br><span class="line">------------ For other file-systems ------------</span><br><span class="line">~$ sudo fsck -l badsectors.txt /dev/sdaX</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">~$ sudo fsck -t -y -f -c /dev/sdaX</span><br></pre></td></tr></table></figure>
<h2 id="SmartCtl"><a href="#SmartCtl" class="headerlink" title="SmartCtl"></a>SmartCtl</h2><ul>
<li><a href="https://www.ixsystems.com/community/threads/do-these-drives-have-life-left-in-them-smart-errors-need-an-eye-to-check-interpretation.60893/" target="_blank" rel="noopener">Do these drives have life left in them? (SMART errors, need an eye to check interpretation)</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo  smartctl -H /dev/sdaX</span><br><span class="line">=== START OF READ SMART DATA SECTION ===</span><br><span class="line">SMART overall-health self-assessment test result: PASSED</span><br><span class="line"></span><br><span class="line">~$ ~$ sudo smartctl -a /dev/sda | grep &apos;^ID#&apos; -A 27</span><br><span class="line">ID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE</span><br><span class="line">  1 Raw_Read_Error_Rate     0x000f   077   049   006    Pre-fail  Always       -       55337314</span><br><span class="line">  3 Spin_Up_Time            0x0003   098   096   000    Pre-fail  Always       -       0</span><br><span class="line">  4 Start_Stop_Count        0x0032   099   099   020    Old_age   Always       -       1081</span><br><span class="line">  5 Reallocated_Sector_Ct   0x0033   100   100   010    Pre-fail  Always       -       0</span><br><span class="line">  7 Seek_Error_Rate         0x000f   084   060   045    Pre-fail  Always       -       248843209</span><br><span class="line">  9 Power_On_Hours          0x0032   092   092   000    Old_age   Always       -       7744 (71 178 0)</span><br><span class="line"> 10 Spin_Retry_Count        0x0013   100   100   097    Pre-fail  Always       -       0</span><br><span class="line"> 12 Power_Cycle_Count       0x0032   099   099   020    Old_age   Always       -       1081</span><br><span class="line">183 Runtime_Bad_Block       0x0032   100   100   000    Old_age   Always       -       0</span><br><span class="line">184 End-to-End_Error        0x0032   100   100   099    Old_age   Always       -       0</span><br><span class="line">187 Reported_Uncorrect      0x0032   084   084   000    Old_age   Always       -       16</span><br><span class="line">188 Command_Timeout         0x0032   099   099   000    Old_age   Always       -       5 5 14</span><br><span class="line">189 High_Fly_Writes         0x003a   100   100   000    Old_age   Always       -       0</span><br><span class="line">190 Airflow_Temperature_Cel 0x0022   062   053   040    Old_age   Always       -       38 (Min/Max 30/39)</span><br><span class="line">191 G-Sense_Error_Rate      0x0032   100   100   000    Old_age   Always       -       0</span><br><span class="line">192 Power-Off_Retract_Count 0x0032   100   100   000    Old_age   Always       -       75</span><br><span class="line">193 Load_Cycle_Count        0x0032   099   099   000    Old_age   Always       -       3229</span><br><span class="line">194 Temperature_Celsius     0x0022   038   047   000    Old_age   Always       -       38 (0 13 0 0 0)</span><br><span class="line">195 Hardware_ECC_Recovered  0x001a   077   064   000    Old_age   Always       -       55337314</span><br><span class="line">197 Current_Pending_Sector  0x0012   100   100   000    Old_age   Always       -       8</span><br><span class="line">198 Offline_Uncorrectable   0x0010   100   100   000    Old_age   Offline      -       8</span><br><span class="line">199 UDMA_CRC_Error_Count    0x003e   200   200   000    Old_age   Always       -       0</span><br><span class="line">240 Head_Flying_Hours       0x0000   100   253   000    Old_age   Offline      -       6259h+10m+59.473s</span><br><span class="line">241 Total_LBAs_Written      0x0000   100   253   000    Old_age   Offline      -       15449989789</span><br><span class="line">242 Total_LBAs_Read         0x0000   100   253   000    Old_age   Offline      -       33054634173</span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line"># 我这边是希捷硬盘ST4000DM000</span><br><span class="line"></span><br><span class="line">SMART Error Log Version: 1</span><br><span class="line">ATA Error Count: 16 (device log contains only the most recent five errors)</span><br><span class="line">	CR = Command Register [HEX]</span><br><span class="line">	FR = Features Register [HEX]</span><br><span class="line">	SC = Sector Count Register [HEX]</span><br><span class="line">	SN = Sector Number Register [HEX]</span><br><span class="line">	CL = Cylinder Low Register [HEX]</span><br><span class="line">	CH = Cylinder High Register [HEX]</span><br><span class="line">	DH = Device/Head Register [HEX]</span><br><span class="line">	DC = Device Command Register [HEX]</span><br><span class="line">	ER = Error register [HEX]</span><br><span class="line">	ST = Status register [HEX]</span><br><span class="line">Powered_Up_Time is measured from power on, and printed as</span><br><span class="line">DDd+hh:mm:SS.sss where DD=days, hh=hours, mm=minutes,</span><br><span class="line">SS=sec, and sss=millisec. It &quot;wraps&quot; after 49.710 days.</span><br><span class="line"></span><br><span class="line">Error 16 occurred at disk power-on lifetime: 7630 hours (317 days + 22 hours)</span><br><span class="line">  When the command that caused the error occurred, the device was active or idle.</span><br><span class="line"></span><br><span class="line">  After command completion occurred, registers were:</span><br><span class="line">  ER ST SC SN CL CH DH</span><br><span class="line">  -- -- -- -- -- -- --</span><br><span class="line">  40 51 00 ff ff ff 0f  Error: UNC at LBA = 0x0fffffff = 268435455</span><br><span class="line"></span><br><span class="line">  Commands leading to the command that caused the error were:</span><br><span class="line">  CR FR SC SN CL CH DH DC   Powered_Up_Time  Command/Feature_Name</span><br><span class="line">  -- -- -- -- -- -- -- --  ----------------  --------------------</span><br><span class="line">  25 d5 08 ff ff ff 4f 00   5d+06:43:53.155  READ DMA EXT</span><br><span class="line">  25 d5 08 ff ff ff 4f 00   5d+06:43:53.114  READ DMA EXT</span><br><span class="line">  b0 d5 01 01 4f c2 00 00   5d+06:40:32.613  SMART READ LOG</span><br><span class="line">  b0 d5 01 06 4f c2 00 00   5d+06:40:32.545  SMART READ LOG</span><br><span class="line">  b0 d0 01 00 4f c2 00 00   5d+06:40:32.455  SMART READ DATA</span><br></pre></td></tr></table></figure>
<ul>
<li>上面分析结果<code>Current_Pending_Sector</code>显示代表有8处坏块。</li>
</ul>
<h3 id="使用Short-Test"><a href="#使用Short-Test" class="headerlink" title="使用Short Test"></a>使用Short Test</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ smartctl -t short /dev/sda</span><br><span class="line"><span class="comment"># 查看测试结果</span></span><br><span class="line">~$ smartctl -l selftest /dev/sda</span><br></pre></td></tr></table></figure>
<h3 id="使用Long-Test"><a href="#使用Long-Test" class="headerlink" title="使用Long Test"></a>使用Long Test</h3><ul>
<li>如果短测试没有发现问题，可能要使用长测试，耗时根据硬盘容量决定，<code>ST4000DM000</code>使用了大概480分钟。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$ smartctl -t long /dev/sda</span><br><span class="line"><span class="comment"># 查看测试结果</span></span><br><span class="line">~$ smartctl -x /dev/sda</span><br><span class="line">[...]</span><br><span class="line">SMART Extended Self-test Log Version: 1 (1 sectors)</span><br><span class="line">Num  Test_Description    Status                  Remaining  LifeTime(hours)  LBA_of_first_error</span><br><span class="line"><span class="comment"># 1  Short offline       Completed without error       00%      7757         -</span></span><br><span class="line"><span class="comment"># 2  Short offline       Completed without error       00%      7757         -</span></span><br><span class="line"><span class="comment"># 3  Extended offline    Completed without error       00%      7752         -</span></span><br><span class="line"><span class="comment"># 4  Short offline       Completed without error       00%      7744         -</span></span><br><span class="line"><span class="comment"># 5  Short offline       Completed: read failure       90%      7744         5341719016</span></span><br><span class="line"><span class="comment"># 6  Short offline       Completed without error       00%      7744         -</span></span><br><span class="line"><span class="comment"># 7  Extended offline    Completed without error       00%      3769         -</span></span><br><span class="line"><span class="comment"># 8  Extended offline    Completed without error       00%      3746         -</span></span><br><span class="line">1 of 1 failed self-tests are outdated by newer successful extended offline self-test <span class="comment"># 3</span></span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<h1 id="防止-etc-resolve-conf-被-DHCP-自动修改"><a href="#防止-etc-resolve-conf-被-DHCP-自动修改" class="headerlink" title="防止/etc/resolve.conf 被 DHCP 自动修改"></a>防止/etc/resolve.conf 被 DHCP 自动修改</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~# cat /etc/NetworkManager/NetworkManager.conf</span><br><span class="line">[main]</span><br><span class="line">plugins=ifupdown,keyfile</span><br><span class="line">dns=none</span><br><span class="line"></span><br><span class="line">[ifupdown]</span><br><span class="line">managed=true</span><br></pre></td></tr></table></figure>
<ul>
<li>或者用<code>chattr +i /etc/resolve.conf</code>锁定修改它。</li>
</ul>
<h1 id="apt-get使用-Socks5代理"><a href="#apt-get使用-Socks5代理" class="headerlink" title="apt-get使用 Socks5代理"></a>apt-get使用 Socks5代理</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get install proxychains</span><br><span class="line"></span><br><span class="line">~$ cat /etc/proxychains.conf</span><br><span class="line">socks5 127.0.0.1 1080</span><br><span class="line"></span><br><span class="line">~$ sudo proxychains apt-get update</span><br><span class="line">~$ sudo proxychains apt-get dist-upgrade -y</span><br></pre></td></tr></table></figure>
<h1 id="Git使用问题"><a href="#Git使用问题" class="headerlink" title="Git使用问题"></a>Git使用问题</h1><ul>
<li>统计工程代码数量。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">log</span> --since=<span class="string">"2018-03-01"</span> --before=<span class="string">"2019-01-09"</span> --author=<span class="string">"username"</span> --pretty=tformat: --numstat | awk <span class="string">'&#123; add += $1; subs += $2; loc += $1 - $2 &#125; END &#123; printf "added lines: %s, removed lines: %s, total lines: %s\n", add, subs, loc &#125;'</span></span><br></pre></td></tr></table></figure>
<h2 id="脚本配置git-Socks5代理"><a href="#脚本配置git-Socks5代理" class="headerlink" title="脚本配置git Socks5代理"></a>脚本配置git Socks5代理</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /usr/<span class="built_in">local</span>/bin/gitproxy</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">on)</span><br><span class="line">git config --global http.proxy <span class="string">'socks5://127.0.0.1:1080'</span></span><br><span class="line">git config --global https.proxy <span class="string">'socks5://127.0.0.1:1080'</span></span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line">off)</span><br><span class="line">git config --global --<span class="built_in">unset</span> http.proxy</span><br><span class="line">git config --global --<span class="built_in">unset</span> https.proxy</span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line">status)</span><br><span class="line">git config --get http.proxy</span><br><span class="line">git config --get https.proxy</span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开</span></span><br><span class="line">~$ gitproxy on</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭</span></span><br><span class="line">~$ gitproxy off</span><br></pre></td></tr></table></figure>
<h2 id="Git-错误-error-refs-remotes-origin-rpi-4-19-y-does-not-point-to-a-valid-object"><a href="#Git-错误-error-refs-remotes-origin-rpi-4-19-y-does-not-point-to-a-valid-object" class="headerlink" title="Git 错误 error: refs/remotes/origin/rpi-4.19.y does not point to a valid object!"></a>Git 错误 <code>error: refs/remotes/origin/rpi-4.19.y does not point to a valid object!</code></h2><ul>
<li><a href="https://stackoverflow.com/questions/13881609/git-refs-remotes-origin-master-does-not-point-to-a-valid-object" target="_blank" rel="noopener">参考这里</a></li>
</ul>
<h1 id="使用Intel-AX200-网卡"><a href="#使用Intel-AX200-网卡" class="headerlink" title="使用Intel AX200  网卡"></a>使用Intel AX200  网卡</h1><ul>
<li><a href="https://wiki.gentoo.org/wiki/Iwlwifi" target="_blank" rel="noopener">IWLwifi</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">~$ hwinfo --netcard --bluetooth | grep -v <span class="string">"Config S"</span></span><br><span class="line">06: PCI 300.0: 0282 WLAN controller</span><br><span class="line">  [Created at pci.386]</span><br><span class="line">  Unique ID: y9sn.yLXDVFQHSM7</span><br><span class="line">  Parent ID: W_nd.YYC8aCLnN82</span><br><span class="line">  SysFS ID: /devices/pci0000:00/0000:00:03.4/0000:03:00.0</span><br><span class="line">  SysFS BusID: 0000:03:00.0</span><br><span class="line">  Hardware Class: network</span><br><span class="line">  Model: <span class="string">"Intel WLAN controller"</span></span><br><span class="line">  Vendor: pci 0x8086 <span class="string">"Intel Corporation"</span></span><br><span class="line">  Device: pci 0x2723</span><br><span class="line">  SubVendor: pci 0x8086 <span class="string">"Intel Corporation"</span></span><br><span class="line">  SubDevice: pci 0x008c</span><br><span class="line">  Revision: 0x1a</span><br><span class="line">  Driver: <span class="string">"iwlwifi"</span></span><br><span class="line">  Driver Modules: <span class="string">"iwlwifi"</span></span><br><span class="line">  Device File: wlan0</span><br><span class="line">  Features: WLAN</span><br><span class="line">  Memory Range: 0xfe800000-0xfe803fff (rw,non-prefetchable)</span><br><span class="line">  IRQ: 50 (no events)</span><br><span class="line">  HW Address: 34:13:e8:b7:1d:76</span><br><span class="line">  Permanent HW Address: 34:13:e8:b7:1d:76</span><br><span class="line">  Link detected: yes</span><br><span class="line">  WLAN channels: 1 2 3 4 5 6 7 8 9 10 11 12 13 36 40 44 48 52 56 60 64 100 104 108 112 116 120 124 128 132 136 140</span><br><span class="line">  WLAN frequencies: 2.412 2.417 2.422 2.427 2.432 2.437 2.442 2.447 2.452 2.457 2.462 2.467 2.472 5.18 5.2 5.22 5.24 5.26 5.28 5.3 5.32 5.5 5.52 5.54 5.56 5.58 5.6 5.62 5.64 5.66 5.68 5.7</span><br><span class="line">  WLAN encryption modes: WEP40 WEP104 TKIP CCMP</span><br><span class="line">  WLAN authentication modes: open sharedkey wpa-psk wpa-eap</span><br><span class="line">  Module Alias: <span class="string">"pci:v00008086d00002723sv00008086sd0000008Cbc02sc80i00"</span></span><br><span class="line">  Driver Info <span class="comment">#0:</span></span><br><span class="line">    Driver Status: iwlwifi is active</span><br><span class="line">    Driver Activation Cmd: <span class="string">"modprobe iwlwifi"</span></span><br><span class="line">  Attached to: <span class="comment">#19 (PCI bridge)</span></span><br><span class="line"></span><br><span class="line">44: USB 00.1: 11500 Bluetooth Device</span><br><span class="line">  [Created at usb.122]</span><br><span class="line">  Unique ID: Ue9G.qmlouffvxgF</span><br><span class="line">  Parent ID: 9Cfs.erpEvbsFWX1</span><br><span class="line">  SysFS ID: /devices/pci0000:00/0000:00:13.0/usb10/10-2/10-2:1.1</span><br><span class="line">  SysFS BusID: 10-2:1.1</span><br><span class="line">  Hardware Class: bluetooth</span><br><span class="line">  Model: <span class="string">"Intel Bluetooth Device"</span></span><br><span class="line">  Hotplug: USB</span><br><span class="line">  Vendor: usb 0x8087 <span class="string">"Intel Corp."</span></span><br><span class="line">  Device: usb 0x0029</span><br><span class="line">  Revision: <span class="string">"0.01"</span></span><br><span class="line">  Driver: <span class="string">"btusb"</span></span><br><span class="line">  Driver Modules: <span class="string">"btusb"</span></span><br><span class="line">  Speed: 12 Mbps</span><br><span class="line">  Module Alias: <span class="string">"usb:v8087p0029d0001dcE0dsc01dp01icE0isc01ip01in01"</span></span><br><span class="line">  Driver Info <span class="comment">#0:</span></span><br><span class="line">    Driver Status: btusb is active</span><br><span class="line">    Driver Activation Cmd: <span class="string">"modprobe btusb"</span></span><br><span class="line">  Attached to: <span class="comment">#45 (Hub)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">~<span class="comment"># modinfo -p iwlwifi</span></span><br><span class="line">debug:debug output mask (uint)</span><br><span class="line">swcrypto:using crypto <span class="keyword">in</span> software (default 0 [hardware]) (int)</span><br><span class="line">11n_disable:<span class="built_in">disable</span> 11n functionality, bitmap: 1: full, 2: <span class="built_in">disable</span> agg TX, 4: <span class="built_in">disable</span> agg RX, 8 <span class="built_in">enable</span> agg TX (uint)</span><br><span class="line">amsdu_size:amsdu size 0: 12K <span class="keyword">for</span> multi Rx queue devices, 2K <span class="keyword">for</span> AX210 devices, 4K <span class="keyword">for</span> other devices 1:4K 2:8K 3:12K 4: 2K (default 0) (int)</span><br><span class="line">fw_restart:restart firmware <span class="keyword">in</span> <span class="keyword">case</span> of error (default <span class="literal">true</span>) (bool)</span><br><span class="line">antenna_coupling:specify antenna coupling <span class="keyword">in</span> dB (default: 0 dB) (int)</span><br><span class="line">nvm_file:NVM file name (charp)</span><br><span class="line">uapsd_disable:<span class="built_in">disable</span> U-APSD functionality bitmap 1: BSS 2: P2P Client (default: 3) (uint)</span><br><span class="line">enable_ini:Enable debug INI TLV FW debug infrastructure (default: 0 (bool)</span><br><span class="line">bt_coex_active:<span class="built_in">enable</span> wifi/bt co-exist (default: <span class="built_in">enable</span>) (bool)</span><br><span class="line">led_mode:0=system default, 1=On(RF On)/Off(RF Off), 2=blinking, 3=Off (default: 0) (int)</span><br><span class="line">power_save:<span class="built_in">enable</span> WiFi power management (default: <span class="built_in">disable</span>) (bool)</span><br><span class="line">power_level:default power save level (range from 1 - 5, default: 1) (int)</span><br><span class="line">fw_monitor:firmware monitor - to debug FW (default: <span class="literal">false</span> - needs lots of memory) (bool)</span><br><span class="line">disable_11ac:Disable VHT capabilities (default: <span class="literal">false</span>) (bool)</span><br><span class="line">remove_when_gone:Remove dev from PCIe bus <span class="keyword">if</span> it is deemed inaccessible (default: <span class="literal">false</span>) (bool)</span><br><span class="line">disable_11ax:Disable HE capabilities (default: <span class="literal">false</span>) (bool)</span><br><span class="line"></span><br><span class="line">~$ modinfo  iwlwifi  | grep <span class="string">"firmware"</span></span><br><span class="line">[....]</span><br><span class="line">firmware:       iwlwifi-8000C-36.ucode</span><br><span class="line">firmware:       iwlwifi-9260-th-b0-jf-b0-46.ucode</span><br><span class="line">firmware:       iwlwifi-9000-pu-b0-jf-b0-46.ucode</span><br><span class="line">firmware:       iwlwifi-ty-a0-gf-a0-52.ucode</span><br><span class="line">firmware:       iwlwifi-so-a0-gf-a0-52.ucode</span><br><span class="line">firmware:       iwlwifi-so-a0-hr-b0-52.ucode</span><br><span class="line">firmware:       iwlwifi-so-a0-jf-b0-52.ucode</span><br><span class="line">firmware:       iwlwifi-cc-a0-52.ucode</span><br><span class="line">firmware:       iwlwifi-QuQnj-b0-jf-b0-52.ucode</span><br><span class="line">firmware:       iwlwifi-QuZ-a0-jf-b0-52.ucode</span><br><span class="line">firmware:       iwlwifi-QuZ-a0-hr-b0-52.ucode</span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line">~$ tree /sys/class/net</span><br><span class="line">/sys/class/net</span><br><span class="line">├── eth0 -&gt; ../../devices/pci0000:00/0000:00:03.3/0000:02:00.0/net/eth0</span><br><span class="line">├── lo -&gt; ../../devices/virtual/net/lo</span><br><span class="line">└── wlan0 -&gt; ../../devices/pci0000:00/0000:00:03.4/0000:03:00.0/net/wlan0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">thermal thermal_zone0: failed to <span class="built_in">read</span> out thermal zone (-61)</span><br></pre></td></tr></table></figure>
<ul>
<li>测试不同的加载参数, 下面参数等于<code>echo &quot;options iwlwifi 11n_disable=8&quot; &gt; /etc/modprobe.d/iwlwifi.conf</code>.只是要重启生效。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo rmmod iwlmvm</span><br><span class="line">~$ sudo rmmod iwlwifi</span><br><span class="line">~$ sudo modprobe iwlwifi 11n_disable=8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应的参数说明是</span></span><br><span class="line"></span><br><span class="line">~$ modinfo iwlwifi</span><br><span class="line">[...]</span><br><span class="line">parm:           swcrypto:using crypto <span class="keyword">in</span> software (default 0 [hardware]) (int)</span><br><span class="line">parm:           11n_disable:<span class="built_in">disable</span> 11n functionality, bitmap: 1: full, 2: <span class="built_in">disable</span> agg TX, 4: <span class="built_in">disable</span> agg RX, 8 <span class="built_in">enable</span> agg TX (uint)</span><br><span class="line">parm:           amsdu_size:amsdu size 0: 12K <span class="keyword">for</span> multi Rx queue devices, 2K <span class="keyword">for</span> AX210 devices, 4K <span class="keyword">for</span> other devices 1:4K 2:8K 3:12K 4: 2K (default 0) (int)</span><br><span class="line">parm:           fw_restart:restart firmware <span class="keyword">in</span> <span class="keyword">case</span> of error (default <span class="literal">true</span>) (bool)</span><br><span class="line">parm:           antenna_coupling:specify antenna coupling <span class="keyword">in</span> dB (default: 0 dB) (int)</span><br><span class="line">parm:           nvm_file:NVM file name (charp)</span><br><span class="line">parm:           uapsd_disable:<span class="built_in">disable</span> U-APSD functionality bitmap 1: BSS 2: P2P Client (default: 3) (uint)</span><br><span class="line">parm:           enable_ini:Enable debug INI TLV FW debug infrastructure (default: 0 (bool)</span><br><span class="line">parm:           bt_coex_active:<span class="built_in">enable</span> wifi/bt co-exist (default: <span class="built_in">enable</span>) (bool)</span><br><span class="line">parm:           led_mode:0=system default, 1=On(RF On)/Off(RF Off), 2=blinking, 3=Off (default: 0) (int)</span><br><span class="line">parm:           power_save:<span class="built_in">enable</span> WiFi power management (default: <span class="built_in">disable</span>) (bool)</span><br><span class="line">parm:           power_level:default power save level (range from 1 - 5, default: 1) (int)</span><br><span class="line">parm:           fw_monitor:firmware monitor - to debug FW (default: <span class="literal">false</span> - needs lots of memory) (bool)</span><br><span class="line">parm:           disable_11ac:Disable VHT capabilities (default: <span class="literal">false</span>) (bool)</span><br><span class="line">parm:           remove_when_gone:Remove dev from PCIe bus <span class="keyword">if</span> it is deemed inaccessible (default: <span class="literal">false</span>) (bool)</span><br><span class="line">parm:           disable_11ax:Disable HE capabilities (default: <span class="literal">false</span>) (bool)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前驱动的参数</span></span><br><span class="line">~<span class="comment"># systool -m iwlwifi -av</span></span><br><span class="line">Module = <span class="string">"iwlwifi"</span></span><br><span class="line"></span><br><span class="line">  Attributes:</span><br><span class="line">    coresize            = <span class="string">"282624"</span></span><br><span class="line">    initsize            = <span class="string">"0"</span></span><br><span class="line">    initstate           = <span class="string">"live"</span></span><br><span class="line">    refcnt              = <span class="string">"1"</span></span><br><span class="line">    srcversion          = <span class="string">"4E773ECBB9682B55D952A3C"</span></span><br><span class="line">    taint               = <span class="string">""</span></span><br><span class="line">    uevent              = &lt;store method only&gt;</span><br><span class="line"></span><br><span class="line">  Parameters:</span><br><span class="line">    11n_disable         = <span class="string">"0"</span></span><br><span class="line">    amsdu_size          = <span class="string">"0"</span></span><br><span class="line">    antenna_coupling    = <span class="string">"0"</span></span><br><span class="line">    bt_coex_active      = <span class="string">"Y"</span></span><br><span class="line">    debug               = <span class="string">"0"</span></span><br><span class="line">    disable_11ac        = <span class="string">"N"</span></span><br><span class="line">    disable_11ax        = <span class="string">"N"</span></span><br><span class="line">    enable_ini          = <span class="string">"N"</span></span><br><span class="line">    fw_monitor          = <span class="string">"N"</span></span><br><span class="line">    fw_restart          = <span class="string">"Y"</span></span><br><span class="line">    led_mode            = <span class="string">"0"</span></span><br><span class="line">    nvm_file            = <span class="string">"(null)"</span></span><br><span class="line">    power_level         = <span class="string">"0"</span></span><br><span class="line">    power_save          = <span class="string">"N"</span></span><br><span class="line">    remove_when_gone    = <span class="string">"N"</span></span><br><span class="line">    swcrypto            = <span class="string">"0"</span></span><br><span class="line">    uapsd_disable       = <span class="string">"3"</span></span><br><span class="line">	[....]</span><br><span class="line"><span class="comment"># 对应映射到系统的位置。</span></span><br><span class="line">~$ ls /sys/module/iwlwifi/parameters/</span><br><span class="line">11n_disable  antenna_coupling  disable_11ac  enable_ini  fw_restart  nvm_file     power_save        swcrypto</span><br><span class="line">amsdu_size   bt_coex_active    disable_11ax  fw_monitor  led_mode    power_level  remove_when_gone  uapsd_disable</span><br></pre></td></tr></table></figure>
<ul>
<li>hcitool 连接蓝牙</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ hcitool scan</span><br><span class="line">Scanning ...</span><br><span class="line">	00:14:01:22:14:49	lcy</span><br><span class="line">	B8:AD:3E:91:70:02	LG HBS500</span><br><span class="line">	98:D3:36:00:CC:BF	lcy_HC-05</span><br><span class="line"></span><br><span class="line">~$ hcitool cc B8:AD:3E:91:70:02</span><br><span class="line">Can<span class="string">'t create connection: Operation not permitted</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">~$ sudo setcap cap_net_raw+eip `which hcitool`</span></span><br></pre></td></tr></table></figure>
<h2 id="查看WIFI的地区代码。"><a href="#查看WIFI的地区代码。" class="headerlink" title="查看WIFI的地区代码。"></a>查看WIFI的地区代码。</h2><ul>
<li><a href="https://askubuntu.com/questions/597546/iwconfig-wlan0-txpower-30mw-not-working" target="_blank" rel="noopener">iwconfig wlan0 txpower 30mW - not working</a></li>
<li><a href="https://networkgeekstuff.com/networking/how-to-create-custom-linux-wi-fi-regulatory-database-to-unlock-30db1000mw/" target="_blank" rel="noopener">How to create custom Linux Wi-Fi regulatory database to unlock 30db/1000mW</a></li>
</ul>
<p><code>DFS</code>是为了使无线产品主动探测军方使用的频率，并主动选择另一个频率，以避开军方频率。所以上面那个链接说，在美国解除限制是违法。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">~$ regdbdump /lib/crda/regulatory.bin</span><br><span class="line"></span><br><span class="line">~$ iw reg get</span><br><span class="line">phy<span class="comment">#0 (self-managed)</span></span><br><span class="line">country CN: DFS-UNSET</span><br><span class="line">	(2402 - 2437 @ 40), (6, 22), (N/A), AUTO-BW, NO-HT40MINUS, NO-80MHZ, NO-160MHZ</span><br><span class="line">	(2422 - 2462 @ 40), (6, 22), (N/A), AUTO-BW, NO-80MHZ, NO-160MHZ</span><br><span class="line">	(2447 - 2482 @ 40), (6, 22), (N/A), AUTO-BW, NO-HT40PLUS, NO-80MHZ, NO-160MHZ</span><br><span class="line">	(5170 - 5190 @ 160), (6, 22), (N/A), NO-OUTDOOR, AUTO-BW, IR-CONCURRENT, NO-HT40MINUS, PASSIVE-SCAN</span><br><span class="line">	(5190 - 5210 @ 160), (6, 22), (N/A), NO-OUTDOOR, AUTO-BW, IR-CONCURRENT, NO-HT40PLUS, PASSIVE-SCAN</span><br><span class="line">	(5210 - 5230 @ 160), (6, 22), (N/A), NO-OUTDOOR, AUTO-BW, IR-CONCURRENT, NO-HT40MINUS, PASSIVE-SCAN</span><br><span class="line">	(5230 - 5250 @ 160), (6, 22), (N/A), NO-OUTDOOR, AUTO-BW, IR-CONCURRENT, NO-HT40PLUS, PASSIVE-SCAN</span><br><span class="line">	(5250 - 5270 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, PASSIVE-SCAN</span><br><span class="line">	(5270 - 5290 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, PASSIVE-SCAN</span><br><span class="line">	(5290 - 5310 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, PASSIVE-SCAN</span><br><span class="line">	(5310 - 5330 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, PASSIVE-SCAN</span><br><span class="line">	(5490 - 5510 @ 240), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, PASSIVE-SCAN</span><br><span class="line">	(5510 - 5530 @ 240), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, PASSIVE-SCAN</span><br><span class="line">	(5530 - 5550 @ 240), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, PASSIVE-SCAN</span><br><span class="line">	(5550 - 5570 @ 240), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, PASSIVE-SCAN</span><br><span class="line">	(5570 - 5590 @ 240), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, PASSIVE-SCAN</span><br><span class="line">	(5590 - 5610 @ 240), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, PASSIVE-SCAN</span><br><span class="line">	(5610 - 5630 @ 240), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, PASSIVE-SCAN</span><br><span class="line">	(5630 - 5650 @ 240), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, PASSIVE-SCAN</span><br><span class="line">	(5650 - 5670 @ 80), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, NO-160MHZ, PASSIVE-SCAN</span><br><span class="line">	(5670 - 5690 @ 80), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, NO-160MHZ, PASSIVE-SCAN</span><br><span class="line">	(5690 - 5710 @ 80), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, NO-160MHZ, PASSIVE-SCAN</span><br><span class="line">	(5710 - 5730 @ 80), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, NO-160MHZ, PASSIVE-SCAN</span><br><span class="line">	(5735 - 5755 @ 80), (6, 22), (N/A), AUTO-BW, IR-CONCURRENT, NO-HT40MINUS, NO-160MHZ, PASSIVE-SCAN</span><br><span class="line">	(5755 - 5775 @ 80), (6, 22), (N/A), AUTO-BW, IR-CONCURRENT, NO-HT40PLUS, NO-160MHZ, PASSIVE-SCAN</span><br><span class="line">	(5775 - 5795 @ 80), (6, 22), (N/A), AUTO-BW, IR-CONCURRENT, NO-HT40MINUS, NO-160MHZ, PASSIVE-SCAN</span><br><span class="line">	(5795 - 5815 @ 80), (6, 22), (N/A), AUTO-BW, IR-CONCURRENT, NO-HT40PLUS, NO-160MHZ, PASSIVE-SCAN</span><br><span class="line">	(5815 - 5835 @ 20), (6, 22), (N/A), AUTO-BW, IR-CONCURRENT, NO-HT40MINUS, NO-HT40PLUS, NO-80MHZ, NO-160MHZ, PASSIVE-SCAN</span><br></pre></td></tr></table></figure>
<ul>
<li>也可以在<code>/etc/default/crda</code>设置区域代码。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dmesg | grep <span class="string">"cfg80211"</span></span><br><span class="line">[    6.756930] platform regulatory.0: Direct firmware load <span class="keyword">for</span> regulatory.db failed with error -2</span><br><span class="line">[    6.756935] cfg80211: failed to load regulatory.db</span><br></pre></td></tr></table></figure>
<h3 id="编译wireless-regdb"><a href="#编译wireless-regdb" class="headerlink" title="编译wireless-regdb"></a>编译wireless-regdb</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python2 required</span></span><br><span class="line">~$ pip install M2Crypto</span><br><span class="line">~$ git <span class="built_in">clone</span> git://git.kernel.org/pub/scm/linux/kernel/git/sforshee/wireless-regdb.git</span><br><span class="line"></span><br><span class="line">~$ <span class="built_in">cd</span> wireless-regdb &amp;&amp; make</span><br><span class="line">~$ make install</span><br></pre></td></tr></table></figure>
<h3 id="编译crda"><a href="#编译crda" class="headerlink" title="编译crda"></a>编译crda</h3><p>*</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> git://git.kernel.org/pub/scm/linux/kernel/git/mcgrof/crda.git</span><br></pre></td></tr></table></figure>
<h1 id="创建Linux路由器-支持IPv6-PD"><a href="#创建Linux路由器-支持IPv6-PD" class="headerlink" title="创建Linux路由器(支持IPv6-PD)"></a>创建Linux路由器(支持IPv6-PD)</h1><ul>
<li><a href="https://dollarblogname.wordpress.com/2014/10/13/dynamic-prefix-delegation-can-be-easy/" target="_blank" rel="noopener">dynamic prefix delegation can be easy</a></li>
<li><a href="https://wiki.archlinux.org/index.php/IPv6#With_dhcpcd" target="_blank" rel="noopener">Ipv6</a></li>
<li><a href="https://taczanowski.net/linux-box-as-an-ipv6-router-with-slaac-and-dhcpv6-pd/" target="_blank" rel="noopener">Linux box as an IPv6 router with SLAAC and DHCPv6-PD</a></li>
<li><p><a href="https://blog.dorianbolivar.com/2018/09/going-full-ipv6-with-dd-wrt.html" target="_blank" rel="noopener">Going full IPv6 with DD-WRT</a></p>
</li>
<li><p>一般来说，可以使用Linux来做一个完全路由(OpentWrt),这里讲的是如何在自己工作的台式电脑内安装路由(含WiFi)功能。一般是台机是只有一个以太网卡，外接一个<code>USB Wifi</code>网卡来做无线路由，当然也可以有这些组合：eth0(WAN)–&gt;wlan0(LAN), eth0(WAN)–&gt;eth1(LAN),wlan0(WAN)–&gt;wlan1(lan). 一般卖的小家用路由器是：一个<code>WAN</code>口，外加4个交换机<code>LAN</code>口，可能还有一个<code>Wifi</code>功能。其实这些低成本的路由器只有一个物理网卡，使用<a href="https://openwrt.org/docs/guide-user/network/vlan/switch_configuration" target="_blank" rel="noopener"><code>VLAN</code></a>把它分成两个子网(WAN,LAN),其实也就是<code>单臂路由</code>。如： eth0.0(WAN)–&gt;br-lan(eth0.1,wlan)<br>使用桥接(bridge)功能把<code>wifi</code>与4个<code>LAN</code>口交换机绑定成一个内局域网内。</p>
</li>
<li><p>下面这里是把两个<code>wifi</code>组成一个无线路由，<code>wlan0(WAN)--wlan1(LAN)</code>,<code>wlan0</code>是从连接上层路由(外部ISP)相当于是<code>WAN</code>，<code>wlan1</code>是内部子网相当于是<code>LAN</code>。之前一般配置是，开启内核转发<code>net.ipv4.ip_forward = 1</code>，再配置一个<code>hostapd</code>,<code>dnsmasq</code>就能对外提供一个简单在IPv4的路由服务了。</p>
</li>
</ul>
<h2 id="系统配置"><a href="#系统配置" class="headerlink" title="系统配置"></a>系统配置</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /etc/sysctl.conf</span><br><span class="line"><span class="comment"># ipv4转发功能，必须开启，才能让本地ipv4地址上网</span></span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启接的路由广告功能</span></span><br><span class="line">net.ipv6.conf.all.accept_ra = 2</span><br><span class="line">net.ipv6.conf.default.accept_ra = 2</span><br><span class="line">net.ipv6.conf.wlan0.accept_ra = 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># IPv6转发，在IPv6时代，不需要NAT转发，全局地址可以直接访问到对方。</span></span><br><span class="line">net.ipv6.conf.wlan0.forwarding = 1</span><br><span class="line">net.ipv6.conf.all.forwarding = 1</span><br><span class="line">net.ipv6.conf.default.forwarding = 1</span><br></pre></td></tr></table></figure>
<h2 id="DHCP-amp-DNS服务器"><a href="#DHCP-amp-DNS服务器" class="headerlink" title="DHCP&amp;DNS服务器"></a>DHCP&amp;DNS服务器</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get instal dnsmasq</span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体配置说明可以使用 man dnsmasq查看。</span></span><br><span class="line">~$ cat /etc/dnsmasq.conf   <span class="comment">#  grep -v '^#\|^$' /etc/dnsmasq.conf</span></span><br><span class="line">domain-needed</span><br><span class="line">bogus-priv</span><br><span class="line">server=2606:4700:4700::1001</span><br><span class="line">server=8.8.8.8</span><br><span class="line">no-resolv</span><br><span class="line">server=192.168.1.1</span><br><span class="line">interface=wlan1</span><br><span class="line">except-interface=wlan0</span><br><span class="line">listen-address=192.168.2.1</span><br><span class="line">no-dhcp-interface=wlan0,lo</span><br><span class="line">dhcp-range=192.168.2.50,192.168.2.150,12h</span><br><span class="line"><span class="comment"># 下面两行很重要，开启ipv6路由广告，指定接口提供PD。</span></span><br><span class="line"><span class="built_in">enable</span>-ra</span><br><span class="line">dhcp-range=tag:wlan1,::1,ra-names,slaac,constructor:wlan1,64,12h</span><br><span class="line">dhcp-ignore-names=tag:dhcp_bogus_hostname</span><br><span class="line">dhcp-rapid-commit</span><br><span class="line">domain=lan</span><br><span class="line">server=/lan/</span><br><span class="line"><span class="comment">#log-facility=/var/log/dnsmasq.log</span></span><br></pre></td></tr></table></figure>
<h2 id="DHCP客户端"><a href="#DHCP客户端" class="headerlink" title="DHCP客户端"></a>DHCP客户端</h2><ul>
<li>如果只是<code>ipv4</code>路由服务，是不需安装下面这些<code>DHCP</code>客户端的。这里使用的是<a href="https://packages.debian.org/jessie/dhcpcd5" target="_blank" rel="noopener"><code>dhcpcd5</code></a>,功能：<code>DHCPv4, IPv6RA and DHCPv6 client with IPv4LL support</code>。还有如：<a href="https://linux.die.net/man/8/dhcp6c" target="_blank" rel="noopener"><code>wide-dhcpv6-client</code></a>,<code>dibbler-client</code>.这里是以<code>dhcpcd5</code>为示例，具体详细配置可以通过<code>man dhcpcd.conf</code>查看。</li>
</ul>
<h3 id="DHCPCD5"><a href="#DHCPCD5" class="headerlink" title="DHCPCD5"></a>DHCPCD5</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get instal dhcpcd5</span><br><span class="line"></span><br><span class="line">~$ cat /etc/dhcpcd.conf             <span class="comment"># 可以这样过滤注释 grep -v '^#\|^$' /etc/dhcpcd.conf</span></span><br><span class="line">hostname</span><br><span class="line"><span class="comment"># logfile /var/log/dhcpcd.log 不指定它，就输出到/var/log/syslog</span></span><br><span class="line">duid</span><br><span class="line">noipv6rs <span class="comment"># 先要全局禁止ipv6请求。</span></span><br><span class="line">waitip 6</span><br><span class="line">persistent</span><br><span class="line">option rapid_commit</span><br><span class="line">option domain_name_servers</span><br><span class="line">option classless_static_routes</span><br><span class="line">option interface_mtu</span><br><span class="line">require dhcp_server_identifier</span><br><span class="line"><span class="comment"># debug</span></span><br><span class="line">slaac private</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里开始，配置wlan0接口 WAN</span></span><br><span class="line">interface wlan0</span><br><span class="line">ipv6rs</span><br><span class="line"><span class="comment">#ia_na 1</span></span><br><span class="line">ia_pd 1 wlan1/0  <span class="comment"># 为 wlan1(LAN)请求 Prefix-delegated 地址。</span></span><br><span class="line"></span><br><span class="line">~$ systemctl start dhcpcd</span><br></pre></td></tr></table></figure>
<h3 id="Wide-dhcpv6-client"><a href="#Wide-dhcpv6-client" class="headerlink" title="Wide-dhcpv6-client"></a>Wide-dhcpv6-client</h3><ul>
<li>wide-dhcpv6-client与dhcpcd二者不能同时运行。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get install wide-dhcpv6-client</span><br><span class="line">~$ cat /etc/wide-dhcpv6/dhcp6c.conf</span><br><span class="line"><span class="comment"># Default dhpc6c configuration: it assumes the address is autoconfigured using</span></span><br><span class="line"><span class="comment"># router advertisements.</span></span><br><span class="line">interface wlan0 &#123;</span><br><span class="line">  send ia-pd 0;</span><br><span class="line">  send rapid-commit;</span><br><span class="line">  request domain-name-servers;</span><br><span class="line">  script <span class="string">"/sbin/dhcp6c-state"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">id-assoc pd 0 &#123;</span><br><span class="line">  prefix-interface wlan1 &#123;</span><br><span class="line">    sla-id 0;</span><br><span class="line">    sla-len 0;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">~$ sudo /etc/init.d/wide-dhcpv6-client start</span><br></pre></td></tr></table></figure>
<ul>
<li>启动<code>/etc/init.d/dhcpcd restart</code>,获取<code>PD</code>信息根据网络质量，可能会有不到十几秒的延时,现在查看接口会显示类似如下：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ ifconfig wlan1</span><br><span class="line">wlan1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.2.1  netmask 255.255.255.0  broadcast 192.168.2.255</span><br><span class="line">        inet6 2409:8a55:xxxx:xxxx::1  prefixlen 64  scopeid 0x0&lt;global&gt;  <span class="comment"># 这里是通过wlan1从上游ISP获取的PD.</span></span><br><span class="line">        inet6 fe80::705c:99ff:feda:9f46  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 72:5c:99:da:9f:46  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 174  bytes 21784 (21.2 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 401  bytes 76160 (74.3 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>
<h2 id="Wifi客户端"><a href="#Wifi客户端" class="headerlink" title="Wifi客户端"></a>Wifi客户端</h2><ul>
<li>创建一个<code>Wifi AP</code>热点，首先需要硬件设备(wifi网卡)支持<code>Soft AP</code>功能，最好要兼容<code>nl80211</code>的驱动. Linux下有两种工具可以支持AP功能：<a href="https://w1.fi/hostapd/" target="_blank" rel="noopener">hostapd: IEEE 802.11 AP, IEEE 802.1X/WPA/WPA2/EAP/RADIUS Authenticator</a>,<a href="https://w1.fi/wpa_supplicant/" target="_blank" rel="noopener">wpasupplicant: Linux WPA/WPA2/IEEE 802.1X Supplicant</a>.<code>hostapd</code>功能更多更复杂，<code>wpasupplicant</code>主要是用于客户端WPA请求认证。</li>
</ul>
<h3 id="HOSTAPD"><a href="#HOSTAPD" class="headerlink" title="HOSTAPD"></a>HOSTAPD</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get install hostapd</span><br><span class="line">~$ cat /etc/hostapd/hostapd.conf</span><br><span class="line">interface=wlan1</span><br><span class="line"><span class="comment"># bridge=br-lan</span></span><br><span class="line">driver=nl80211</span><br><span class="line">logger_syslog=-1</span><br><span class="line">logger_syslog_level=2</span><br><span class="line">logger_stdout=-1</span><br><span class="line">logger_stdout_level=2</span><br><span class="line">ctrl_interface=/var/run/hostapd</span><br><span class="line">ctrl_interface_group=0</span><br><span class="line">ssid=lcy</span><br><span class="line">country_code=US</span><br><span class="line">hw_mode=g   <span class="comment"># b,g,a三种模式，5G 是ac模式</span></span><br><span class="line">channel=1</span><br><span class="line">beacon_int=100</span><br><span class="line">dtim_period=2</span><br><span class="line">macaddr_acl=0</span><br><span class="line">auth_algs=1</span><br><span class="line">wmm_enabled=1</span><br><span class="line">wmm_ac_bk_cwmin=4</span><br><span class="line">wmm_ac_bk_cwmax=10</span><br><span class="line">wmm_ac_bk_aifs=7</span><br><span class="line">wmm_ac_bk_txop_limit=0</span><br><span class="line">wmm_ac_bk_acm=0</span><br><span class="line">wmm_ac_be_aifs=3</span><br><span class="line">wmm_ac_be_cwmin=4</span><br><span class="line">wmm_ac_be_cwmax=10</span><br><span class="line">wmm_ac_be_txop_limit=0</span><br><span class="line">wmm_ac_be_acm=0</span><br><span class="line">wmm_ac_vi_aifs=2</span><br><span class="line">wmm_ac_vi_cwmin=3</span><br><span class="line">wmm_ac_vi_cwmax=4</span><br><span class="line">wmm_ac_vi_txop_limit=94</span><br><span class="line">wmm_ac_vi_acm=0</span><br><span class="line">wmm_ac_vo_aifs=2</span><br><span class="line">wmm_ac_vo_cwmin=2</span><br><span class="line">wmm_ac_vo_cwmax=3</span><br><span class="line">wmm_ac_vo_txop_limit=47</span><br><span class="line">wmm_ac_vo_acm=0</span><br><span class="line"><span class="comment"># ieee80211n=1  # 开启11N模式</span></span><br><span class="line"><span class="comment"># ht_capab=[HT40+][SHORT-GI-20][SHORT-GI-40]</span></span><br><span class="line">wpa=2</span><br><span class="line">wpa_psk_file=/etc/hostapd/hostapd.wpa_psk</span><br><span class="line">wpa_key_mgmt=WPA-PSK</span><br><span class="line">wpa_pairwise=TKIP</span><br><span class="line">rsn_pairwise=CCMP</span><br><span class="line">wpa_group_rekey=600</span><br><span class="line"></span><br><span class="line">~$ systemctl start hostapd</span><br></pre></td></tr></table></figure>
<h3 id="WPASUPPLICANT"><a href="#WPASUPPLICANT" class="headerlink" title="WPASUPPLICANT"></a>WPASUPPLICANT</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get install wpasupplicant</span><br><span class="line">~$ cat /etc/wpa_supplicant/lcy_wifi.conf</span><br><span class="line">network=&#123;</span><br><span class="line">	ssid=<span class="string">"lcy"</span></span><br><span class="line">    mode=2   <span class="comment"># 2为AP模式。</span></span><br><span class="line">	<span class="comment">#psk="xxxxxx"</span></span><br><span class="line">	psk=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">~$ wpa_supplicant -B -Dnl80211 -iwlan1 -c/etc/wpa_supplicant/lcy_wifi.conf</span><br></pre></td></tr></table></figure>
<ul>
<li>上面这这些工具，都可以是运行为独立的服务，可以像要下面一样，通过网卡事件脚本来控制。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /etc/network/interfaces</span><br><span class="line"></span><br><span class="line">auto  wlan1</span><br><span class="line">allow-hotplug wlan1</span><br><span class="line">iface wlan1 inet static</span><br><span class="line">	address 192.168.2.1</span><br><span class="line">	netmask 255.255.255.0</span><br><span class="line">	network 192.168.2.0</span><br><span class="line">	<span class="comment">#up ifconfig ovsbr0 down</span></span><br><span class="line">	<span class="comment"># 使用wpa_supplicant 开启AP模式，提供wifi访问。</span></span><br><span class="line">	pre-up wpa_supplicant -B -Dnl80211 -i<span class="variable">$IFACE</span> -c/etc/wpa_supplicant/lcy_wifi.conf \</span><br><span class="line">		-P/var/run/wpa_supplicant.<span class="variable">$IFACE</span>.pid</span><br><span class="line">	<span class="comment"># 在这里 hostapd与wpa_supplicant二选一提供AP认证服务</span></span><br><span class="line">	<span class="comment">#post-up /usr/sbin/hostapd -B -P/var/run/hostapd.$IFACE.pid /etc/hostapd/hostapd.conf</span></span><br><span class="line">	post-up /usr/sbin/dnsmasq --conf-file=/etc/dnsmasq.conf \</span><br><span class="line">		--pid-file=/var/run/dnsmasq.<span class="variable">$IFACE</span>.pid</span><br><span class="line">	post-up /etc/init.d/dhcpcd restart</span><br><span class="line">	<span class="built_in">wait</span>-delay 15</span><br><span class="line">	pre-down cat /var/run/dnsmasq.<span class="variable">$IFACE</span>.pid | xargs <span class="built_in">kill</span></span><br><span class="line">	pre-down cat /var/run/wpa_supplicant.<span class="variable">$IFACE</span>.pid | xargs <span class="built_in">kill</span></span><br><span class="line">	<span class="comment">#pre-down cat /var/run/hostapd.$IFACE.pid | xargs kill</span></span><br><span class="line"></span><br><span class="line">auto  wlan0</span><br><span class="line">iface wlan0 inet static</span><br><span class="line">    <span class="comment">#up ip link set dev ovsbr0 down</span></span><br><span class="line">	<span class="comment">#up ifconfig ovs-system down</span></span><br><span class="line">	<span class="comment">#up ifconfig ovsbr0 down</span></span><br><span class="line">	address 192.168.1.100</span><br><span class="line">	netmask 255.255.255.0</span><br><span class="line">	network 192.168.1.0</span><br><span class="line">	gateway 192.168.1.1</span><br><span class="line">	<span class="comment">#  这里也很重要，WAN口需要固定一个MAC地址，</span></span><br><span class="line">	<span class="comment"># pre-up ip link set dev $IFACE addr 34:13:xx:xx:xx:76</span></span><br><span class="line">	<span class="comment"># 使用wpa_supplicant去连接上游的wifi.</span></span><br><span class="line">	pre-up wpa_supplicant -B -Dnl80211 -i<span class="variable">$IFACE</span> -c/etc/wpa_supplicant/wpa_supplicant.conf \</span><br><span class="line">		-P/var/run/wpa_supplicant.<span class="variable">$IFACE</span>.pid</span><br><span class="line">	post-up  /etc/init.d/dhcpcd start  <span class="comment"># 简单可以直接 dhcpcd $IFACE</span></span><br><span class="line">	<span class="built_in">wait</span>-delay 15</span><br><span class="line">	post-down /etc/init.d/dhcpcd stop</span><br><span class="line">	pre-down cat /var/run/wpa_supplicant.<span class="variable">$IFACE</span>.pid | xargs <span class="built_in">kill</span></span><br></pre></td></tr></table></figure>
<ul>
<li>也可以使用下面<code>wpa_supplicant</code>方式连接认证<code>wifi</code>。用<code>wpa_passphrase</code>生成要连接的<code>ssid</code>与密钥。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ wpa_passphrase my_ssid 12345678</span><br><span class="line">network=&#123;</span><br><span class="line">	ssid=<span class="string">"my_ssid"</span></span><br><span class="line">	<span class="comment">#psk="12345678"</span></span><br><span class="line">	psk=b63bb73550b08933c709bbff538af08d29024cbf0790981c116a3210391fe2d0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>最终的生成的数据如下：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /etc/wpa_supplicant/wpa_supplicant.conf</span><br><span class="line">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev</span><br><span class="line">update_config=1</span><br><span class="line">p2p_disabled=1</span><br><span class="line">network=&#123;</span><br><span class="line">	ssid=<span class="string">"my_ssid"</span></span><br><span class="line">	<span class="comment">#psk="12345678"</span></span><br><span class="line">	psk=b63bb73550b08933c709bbff538af08d29024cbf0790981c116a3210391fe2d0</span><br><span class="line">	<span class="comment">#COUNTRY=US</span></span><br><span class="line">  	proto=RSN</span><br><span class="line">    key_mgmt=WPA-PSK</span><br><span class="line">    pairwise=CCMP TKIP</span><br><span class="line">    group=CCMP TKIP</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>如上所示，在<code>/etc/network/interfaces</code>的接口内加入<code>pre-up wpa_supplicant -B -Dnl80211 -i$IFACE -c/etc/wpa_supplicant/wpa_supplicant.conf</code>方式连接。如果要查看一些调试信息，加上<code>-dd</code>命令行中。</p>
</li>
<li><p>查看状态</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">~$ wpa_cli  status</span><br><span class="line">Selected interface <span class="string">'wlan0'</span></span><br><span class="line">bssid=22:76:93:00:xx:xx</span><br><span class="line">freq=5200</span><br><span class="line">ssid=my_ssid</span><br><span class="line">id=0</span><br><span class="line">mode=station</span><br><span class="line">pairwise_cipher=CCMP</span><br><span class="line">group_cipher=CCMP</span><br><span class="line">key_mgmt=WPA2-PSK</span><br><span class="line">wpa_state=COMPLETED</span><br><span class="line">ip_address=192.168.1.100</span><br><span class="line">address=44:af:28:32:xx:xx</span><br><span class="line">uuid=d52e74ae-991c-5d82-ab4f-80a9f2417de5</span><br><span class="line">ieee80211ac=1</span><br></pre></td></tr></table></figure>
<ul>
<li>使用手机连接到该<code>wifi</code>热点上，从手机信息的菜单项查看，是否获取一个<code>240x</code>开头的IPv6地址。如果有，说明可以使用<code>IPv6</code>访问网络了,打开<code>test-ipv6.com</code>测试一下。</li>
<li>如果<code>LAN</code>的客户端能够正常获取一个<code>PD+MAC</code>全局地址，但是不能访问<code>IPv6</code>网络.这就要仔细查看与调试各级路由了。我在此因为设置了动态<code>MAC</code>，所以造成的路由问题。一般这里上游路由表如下：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ ip -6 route</span><br><span class="line"><span class="comment"># 上游路由取得的PD是 2409:xxxx:xxxx:4fc0::/60</span></span><br><span class="line">default from 2409:xxxx:xxxx:4fc0::/60 via fe80::e681:84ff:fe44:a40f dev pppoe-wan proto static metric 512 pref medium</span><br><span class="line">2409:8a55:2416:4fc0::/64 dev br-lan proto static metric 1024 pref medium</span><br><span class="line"><span class="comment"># 这里有一条静态的路由，去到这一级的WAN(wlan0)口的链路地址 fe80::xxxx:xxxx:21ba:6d93，这一条路由可以修改，但是这个客户端断开后，它又会重写回去。</span></span><br><span class="line">2409:8a55:xxxx:xxxx::/64 via fe80::xxxx:xxxx:21ba:6d93 dev br-lan proto static metric 1024 pref medium</span><br></pre></td></tr></table></figure>
<ul>
<li>刚好我又在这个Linux内安装了<code>macchanger</code>这个工具脚本,它链接网卡的启停脚本。所以本机系统每个网卡<code>MAC</code>会因为每次<code>up|down</code>后随机产生一个新的地址，所以依赖于<code>MAC</code>计算出来的本地链路地址也变了，对于<code>LAN口(wlan1)</code>的地址改变其实没有什么影响，但是<code>WAN口(wlan0)</code>的地址改变就会影响到上游路由表无法到更新后的链路地址。或者说：本地<code>WAN(wlan0)</code>的链路地址改变，需同步更改上游路由表，否则本级路由下<code>LAN(wlan)</code>不能正常访问网络。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/etc/network$ tree <span class="keyword">if</span>-pre-up.d/</span><br><span class="line"><span class="keyword">if</span>-pre-up.d/</span><br><span class="line">├── bridge -&gt; /lib/bridge-utils/ifupdown.sh</span><br><span class="line">├── ethtool</span><br><span class="line">├── hostapd -&gt; ../../hostapd/ifupdown.sh</span><br><span class="line">├── macchanger -&gt; ../../macchanger/ifupdown.sh</span><br><span class="line">├── openvswitch -&gt; /usr/share/openvswitch/scripts/ifupdown.sh</span><br><span class="line">├── uml-utilities</span><br><span class="line">├── vlan</span><br><span class="line">├── wireless-tools</span><br><span class="line">└── wpasupplicant -&gt; ../../wpa_supplicant/ifupdown.sh</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>macchanger</code>可以查看硬件真实的<code>MAC</code>，也可生成随机<code>MAC</code>并修改它。这里需要在<code>WAN口(wlan0)</code>固定硬件地址的随机更改。如果要防止它每次重启后随机变动。一种方法确保有下面配置：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /etc/NetworkManager/NetworkManager.conf</span><br><span class="line">[....]</span><br><span class="line">[device]</span><br><span class="line">wifi.scan-rand-mac-address=no</span><br></pre></td></tr></table></figure>
</li>
<li><p>或者使用<code>macchanger,ip</code>在<code>/etc/network/interfaces</code>的里脚本里固定它。修改硬件地址先要关闭硬件功能，有时运行了如：<code>ifdown wlan0 或者 ifconfig wlan0 down</code>,还是没有关闭硬件，导致无法修改<code>MAC</code>，此时肯定还有其守护程序在运行，如：<code>wicd</code>,可以运行<code>systemctl stop wicd</code>再尝试修改。</p>
</li>
</ul>
<h3 id="Wifi-Direct-p2p-mode"><a href="#Wifi-Direct-p2p-mode" class="headerlink" title="Wifi Direct(p2p mode)"></a>Wifi Direct(p2p mode)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /etc/wpa_supplicant/wpa_supplicant.conf</span><br><span class="line">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev</span><br><span class="line">update_config=1</span><br><span class="line">device_name=debian</span><br><span class="line">device_type=2-0050F204-1</span><br><span class="line">p2p_go_intent=15</span><br><span class="line">p2p_go_ht40=1</span><br><span class="line"><span class="comment">#p2p_disabled=1</span></span><br><span class="line">network=&#123;</span><br><span class="line">	ssid=<span class="string">"OpenWrt-5G"</span></span><br><span class="line">	<span class="comment">#psk="xxxxxxxxxxxxxxxxxx"</span></span><br><span class="line">	psk=d5c46754b57b318f213eae32eefa61a602f28df87af6f5fd83c5297b775b6b82</span><br><span class="line"></span><br><span class="line">	<span class="comment">#COUNTRY=US</span></span><br><span class="line">  	proto=RSN</span><br><span class="line">    key_mgmt=WPA-PSK</span><br><span class="line">    pairwise=CCMP TKIP</span><br><span class="line">    group=CCMP TKIP</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">~$ wpa_supplicant -B -Dnl80211 -i<span class="variable">$IFACE</span> -dd -c/etc/wpa_supplicant/wpa_supplicant.conf</span><br><span class="line">[....]</span><br><span class="line">Using existing control interface directory.</span><br><span class="line">ctrl_interface_group=113 (from group name <span class="string">'netdev'</span>)</span><br><span class="line">P2P: Add operating class 81</span><br><span class="line">P2P: Channels - hexdump(len=13): 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d</span><br><span class="line">P2P: Own listen channel: 81:6</span><br><span class="line">P2P: Random operating channel: 81:1</span><br><span class="line">P2P: initialized</span><br><span class="line">P2P: channels: 81:1,2,3,4,5,6,7,8,9,10,11,12,13</span><br><span class="line">P2P: cli_channels:</span><br><span class="line">p2p-dev-wlan0: Added interface p2p-dev-wlan0</span><br><span class="line">p2p-dev-wlan0: State: INACTIVE -&gt; DISCONNECTED</span><br><span class="line">nl80211: Set p2p-dev-wlan0 operstate 0-&gt;0 (DORMANT)</span><br><span class="line">netlink: Operstate: ifindex=0 linkmode=-1 (no change), operstate=5 (IF_OPER_DORMANT)</span><br><span class="line">p2p-dev-wlan0: Determining shared radio frequencies (max len 2)</span><br><span class="line">p2p-dev-wlan0: Shared frequencies (len=0): completed iteration</span><br><span class="line">P2P: Add operating class 81</span><br><span class="line">P2P: Channels - hexdump(len=13): 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d</span><br><span class="line">P2P: Update channel list</span><br><span class="line">P2P: channels: 81:1,2,3,4,5,6,7,8,9,10,11,12,13</span><br><span class="line">P2P: cli_channels:</span><br><span class="line">Daemonize..</span><br><span class="line">sending commands to master dhcpcd process</span><br><span class="line">sending commands to master dhcpcd process</span><br><span class="line"></span><br><span class="line">~$ sudo wpa_cli -i p2p-dev-wlan0</span><br><span class="line"></span><br><span class="line">&gt; p2p_find 10</span><br><span class="line">OK</span><br><span class="line">&lt;3&gt;CTRL-EVENT-SCAN-STARTED</span><br><span class="line">&lt;3&gt;CTRL-EVENT-SCAN-STARTED</span><br><span class="line">&lt;3&gt;CTRL-EVENT-SCAN-STARTED</span><br><span class="line">&lt;3&gt;CTRL-EVENT-SCAN-STARTED</span><br><span class="line">&lt;3&gt;P2P-DEVICE-FOUND be:30:xx:xx:19:a1 p2p_dev_addr=be:30:xx:xx:19:a1 pri_dev_type=7-0050F204-1 name=<span class="string">'客厅的小米电视'</span> config_methods=0x188 dev_capab=0x24 group_capab=0x0 wfd_dev_info=0x00112b441132 vendor_elems=1 new=0</span><br><span class="line">&lt;3&gt;CTRL-EVENT-SCAN-STARTED</span><br><span class="line">&lt;3&gt;CTRL-EVENT-SCAN-STARTED</span><br><span class="line">&lt;3&gt;CTRL-EVENT-SCAN-STARTED</span><br><span class="line">&lt;3&gt;P2P-FIND-STOPPED</span><br><span class="line">&lt;3&gt;P2P-DEVICE-LOST p2p_dev_addr=be:30:xx:xx:19:a1</span><br><span class="line">p2p_peers</span><br><span class="line">be:30:xx:xx:19:a1</span><br><span class="line">&gt; p2p_connect be:30:xx:xx:19:a1 pin intent 15</span><br><span class="line">55577670</span><br><span class="line">&lt;3&gt;P2P-GO-NEG-SUCCESS role=GO freq=2412 ht40=1 peer_dev=be:30:xx:xx:19:a1 peer_iface=be:30:xx:xx:99:a1 wps_method=Display</span><br><span class="line">&lt;3&gt;P2P-GROUP-FORMATION-SUCCESS</span><br><span class="line">&lt;3&gt;P2P-GROUP-STARTED p2p-wlan0-0 GO ssid=<span class="string">"DIRECT-vV"</span> freq=2412 passphrase=<span class="string">"BqbrqD4l"</span> go_dev_addr=44:af:28:32:4f:de</span><br><span class="line">&lt;3&gt;AP-STA-CONNECTED be:30:xx:xx:99:a1 p2p_dev_addr=be:30:xx:xx:19:a1</span><br></pre></td></tr></table></figure>
<h1 id="VirtualBox虚拟机与主机的复制与粘贴"><a href="#VirtualBox虚拟机与主机的复制与粘贴" class="headerlink" title="VirtualBox虚拟机与主机的复制与粘贴"></a>VirtualBox虚拟机与主机的复制与粘贴</h1><ul>
<li>一般来说，如果虚拟机(Guest)安装的是<code>Windows</code>系统，只要安装<code>VBoxGuestAddions.iso</code>里的驱动，再在菜单里选择<code>Devices--&gt;Shared Clipboard</code>方式，就可以与主机(Host)之前的共享复制粘贴了。如果<code>Guest</code>是<code>Linux</code>系统，安装完成<code>VBoxGuestAddions.iso</code>且设置了<code>Shared Clipboard</code>，然而不能复制的话，可以在<code>Guest</code>里，运行<code>sudo VBoxClient --clipboard</code>之后，再尝试上述操作。</li>
</ul>
<h1 id="Android连接USB时，MTP挂载错误。"><a href="#Android连接USB时，MTP挂载错误。" class="headerlink" title="Android连接USB时，MTP挂载错误。"></a>Android连接USB时，MTP挂载错误。</h1><ul>
<li>有时会出现如：<code>error no such interface &#39;org.gtk.vfs.mount&#39; on object at path /org/gtk/vfs/mount/1</code>,可以重启系统，也可以尝试如下：<ul>
<li>GNOME: killall nautilus</li>
<li>MATE: killall caja</li>
<li>Cinnamon: killall nemo</li>
</ul>
</li>
</ul>
<h1 id="Debian支持多架构"><a href="#Debian支持多架构" class="headerlink" title="Debian支持多架构"></a>Debian支持多架构</h1><ul>
<li><p><a href="https://wiki.debian.org/Multiarch/HOWTO" target="_blank" rel="noopener">Multiarch</a></p>
</li>
<li><p>添架一个架构</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo dpkg --add-architecture arm64</span><br></pre></td></tr></table></figure>
<ul>
<li>列出一个架构</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo dpkg --<span class="built_in">print</span>-foreign-architectures</span><br></pre></td></tr></table></figure>
<ul>
<li>设置<code>apt sources</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">grep -v <span class="string">'^#\|^$'</span> /etc/apt/sources.list</span><br><span class="line">deb [arch=amd64,i386,arm64] http://security.debian.org/ buster/updates contrib main</span><br><span class="line">deb-src http://security.debian.org/ buster/updates contrib main</span><br><span class="line">deb [arch=amd64,i386,arm64] https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free</span><br><span class="line">deb [arch=amd64,i386,arm64] https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free</span><br><span class="line">deb [arch=amd64,i386,arm64] https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free</span><br><span class="line">deb [arch=amd64,i386,arm64] https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free</span><br><span class="line">deb [arch=amd64] https://download.docker.com/linux/debian buster stable</span><br></pre></td></tr></table></figure>
<h1 id="Samba4-共享问题（SMB-CIFS）"><a href="#Samba4-共享问题（SMB-CIFS）" class="headerlink" title="Samba4 共享问题（SMB/CIFS）"></a>Samba4 共享问题（SMB/CIFS）</h1><ul>
<li><p><a href="https://wiki.archlinux.org/index.php/samba" target="_blank" rel="noopener">Samaba</a></p>
</li>
<li><p>SMB4与前面的版本有一些改动，如：原<code>security = share</code>改成了<code>security = user ; map to guest = Bad User</code>的组合。服务端与客户端的<br>协议版本如果不匹配，也会无法握手连接。可以通过<code>min protocol，client min|max protocol</code>等参数定制。</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">grep -v <span class="string">'^#\|^$\|^;\|.*;'</span> /etc/samba/smb.conf</span><br><span class="line">[global]</span><br><span class="line">   workgroup = WORKGROUP</span><br><span class="line">   netbios name = debian(buster)</span><br><span class="line">   <span class="comment"># Or set min protocol to NT1, SMB2/3</span></span><br><span class="line">   min protocol = LANMAN2</span><br><span class="line">   ea support = yes</span><br><span class="line">   interfaces = 127.0.0.0/8 192.168.1.0/24</span><br><span class="line">   hosts allow = 127.0.0.1/8 192.168.0.0/16</span><br><span class="line">   <span class="built_in">log</span> file = /var/<span class="built_in">log</span>/samba/<span class="built_in">log</span>.%m</span><br><span class="line">   <span class="built_in">log</span> level = 10</span><br><span class="line">   max <span class="built_in">log</span> size = 1000</span><br><span class="line">   logging = file</span><br><span class="line">   <span class="comment">#server role = standalone server</span></span><br><span class="line">   security = user</span><br><span class="line">   map to guest = Bad User</span><br><span class="line">[Movies]</span><br><span class="line">   comment = Home Directories</span><br><span class="line">   path = /home/michael/3TB-DISK/AmuleDir/Incoming/</span><br><span class="line">   browseable = yes</span><br><span class="line">   available = yes</span><br><span class="line">   guest ok = yes</span><br><span class="line">   guest only = yes</span><br><span class="line">   public = yes</span><br><span class="line">   <span class="built_in">read</span> only = yes</span><br></pre></td></tr></table></figure>
<ul>
<li>重启,查看服务。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart smbd nmbd</span><br><span class="line">systemctl status smbd nmbd</span><br></pre></td></tr></table></figure>
<ul>
<li><code>testparm</code>查验配置文件。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ testparm</span><br><span class="line">Registered MSG_REQ_POOL_USAGE</span><br><span class="line">Registered MSG_REQ_DMALLOC_MARK and LOG_CHANGED</span><br><span class="line">Load smb config files from /etc/samba/smb.conf</span><br><span class="line">Processing section <span class="string">"[Movies]"</span></span><br><span class="line">Loaded services file OK.</span><br><span class="line">Server role: ROLE_STANDALONE</span><br><span class="line"></span><br><span class="line">Press enter to see a dump of your service definitions</span><br></pre></td></tr></table></figure>
<ul>
<li>使用<code>smbclient</code>查看,可以加入<code>-d&lt;number 0-10&gt;</code>调试输出。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">smbclient -m SMB3 -N  -L 192.168.1.100</span><br><span class="line">Unable to initialize messaging context</span><br><span class="line">Anonymous login successful</span><br><span class="line"></span><br><span class="line">	Sharename       Type      Comment</span><br><span class="line">	---------       ----      -------</span><br><span class="line">	Movies          Disk      Home Directories</span><br><span class="line">	IPC$            IPC       IPC Service (Samba 4.9.5-Debian)</span><br><span class="line">Reconnecting with SMB1 <span class="keyword">for</span> workgroup listing.</span><br><span class="line">Anonymous login successful</span><br><span class="line"></span><br><span class="line">	Server               Comment</span><br><span class="line">	---------            -------</span><br><span class="line"></span><br><span class="line">	Workgroup            Master</span><br><span class="line">	---------            -------</span><br><span class="line">	WORKGROUP            DEBIAN(BUSTER)</span><br></pre></td></tr></table></figure>
<ul>
<li>调式<code>smbd,nmbd</code>输出，可以配置<code>smb.conf</code>里面的<code>log level = &lt;0-100&gt;</code>详细级别。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ smbd  -i -l -S</span><br><span class="line">~$ nmbd  -i -l -S</span><br></pre></td></tr></table></figure>
<ul>
<li>错误<code>Error NT_STATUS_IO_TIMEOUT</code>，这个错误最终发现是因服务端系统设置造成的，<code>Samba</code>的配置并在服务端使用<code>smbclient</code>测试都OK，而且<br>在<code>Android</code>手机端是可以查看共享，但是在<code>Win10</code>端与<code>IPad</code>不能连接。最后发现是服务端禁止了<code>ping</code>入造成的。<br>修改成<code>net.ipv4.icmp_echo_ignore_all = 0</code>就可以连接了。</li>
</ul>
<h1 id="无法进虚拟终端的问题（Ctrl-Alt-f-1-6"><a href="#无法进虚拟终端的问题（Ctrl-Alt-f-1-6" class="headerlink" title="无法进虚拟终端的问题（Ctrl-Alt-f[1-6])"></a>无法进虚拟终端的问题（Ctrl-Alt-f[1-6])</h1><ul>
<li><a href="https://wiki.archlinux.org/index.php/NVIDIA#DRM_kernel_mode_setting" target="_blank" rel="noopener">NVIDIA</a></li>
<li><a href="https://wiki.archlinux.org/index.php/NVIDIA/Tips_and_tricks#Fixing_terminal_resolution" target="_blank" rel="noopener">NVIDIA/Tips and tricks</a></li>
<li><a href="https://wiki.archlinux.org/index.php/kernel_mode_setting" target="_blank" rel="noopener">Kernel mode setting</a></li>
<li><p><a href="https://www.kernel.org/doc/html/latest/fb/fbcon.html" target="_blank" rel="noopener">The Framebuffer Console</a></p>
</li>
<li><p>有时新安装了新的(Nvidia)显卡驱动后，发现无法切换到虚拟的终端里，只能使用<code>Ctrl-Alt-F7</code>的终端。确认一下<code>/etc/default/grub</code>内有如<br>内容：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">grep -v <span class="string">'^#\|^$'</span> /etc/default/grub</span><br><span class="line">GRUB_DEFAULT=0</span><br><span class="line">GRUB_TIMEOUT=5</span><br><span class="line">GRUB_DISTRIBUTOR=`lsb_release -i -s 2&gt; /dev/null || <span class="built_in">echo</span> Debian`</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=<span class="string">"splash"</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">"resume=UUID=ae170b9d-832a-46a7-beca-5fb7c9329b1b nomodeset"</span></span><br><span class="line">GRUB_GFXPAYLOAD_LINUX=keep</span><br></pre></td></tr></table></figure>
</li>
<li><p>加入<code>nomodeset</code>，开启<code>GRUB_GFXPAYLOAD_LINUX=keep</code>后运行<code>update-grub</code>，重启系统可能会解决此问题。</p>
</li>
</ul>
<h1 id="一起无法重启networking服务的问题"><a href="#一起无法重启networking服务的问题" class="headerlink" title="一起无法重启networking服务的问题"></a>一起无法重启<code>networking</code>服务的问题</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo systemctl restart networking.service</span><br><span class="line">Job <span class="keyword">for</span> networking.service failed because the control process exited with error code.</span><br><span class="line">See <span class="string">"systemctl status networking.service"</span> and <span class="string">"journalctl -xe"</span> <span class="keyword">for</span> details.</span><br></pre></td></tr></table></figure>
<ul>
<li>status</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo systemctl status networking.service</span><br><span class="line">● networking.service - Raise network interfaces</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/networking.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: failed (Result: <span class="built_in">exit</span>-code) since Wed 2021-04-14 22:42:17 CST; 48s ago</span><br><span class="line">     Docs: man:interfaces(5)</span><br><span class="line">  Process: 10535 ExecStart=/sbin/ifup -a --<span class="built_in">read</span>-environment (code=exited, status=1/FAILURE)</span><br><span class="line"> Main PID: 10535 (code=exited, status=1/FAILURE)</span><br><span class="line"></span><br><span class="line">Apr 14 22:42:17 debian ifup[10535]: run-parts: executing /etc/network/<span class="keyword">if</span>-up.d/avahi-autoipd</span><br><span class="line">Apr 14 22:42:17 debian ifup[10535]: run-parts: executing /etc/network/<span class="keyword">if</span>-up.d/dhcpcd</span><br><span class="line">Apr 14 22:42:17 debian ifup[10535]: run-parts: executing /etc/network/<span class="keyword">if</span>-up.d/ethtool</span><br><span class="line">Apr 14 22:42:17 debian ifup[10535]: run-parts: executing /etc/network/<span class="keyword">if</span>-up.d/ip</span><br><span class="line">Apr 14 22:42:17 debian ifup[10535]: run-parts: executing /etc/network/<span class="keyword">if</span>-up.d/mountnfs</span><br><span class="line">Apr 14 22:42:17 debian ifup[10535]: run-parts: executing /etc/network/<span class="keyword">if</span>-up.d/uml-utilities</span><br><span class="line">Apr 14 22:42:17 debian ifup[10535]: run-parts: executing /etc/network/<span class="keyword">if</span>-up.d/wpasupplicant</span><br><span class="line">Apr 14 22:42:17 debian systemd[1]: networking.service: Main process exited, code=exited, status=1/FAILURE</span><br><span class="line">Apr 14 22:42:17 debian systemd[1]: networking.service: Failed with result <span class="string">'exit-code'</span>.</span><br><span class="line">Apr 14 22:42:17 debian systemd[1]: Failed to start Raise network interfaces.</span><br></pre></td></tr></table></figure>
<ul>
<li>journatctl</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sudo journalctl -u networking.service</span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line">Apr 14 19:26:20 debian ifup[916]: dnsmasq: failed to create listening socket <span class="keyword">for</span> port 53: Address already <span class="keyword">in</span> use</span><br><span class="line">Apr 14 19:26:20 debian dnsmasq[7338]: failed to create listening socket <span class="keyword">for</span> port 53: Address already <span class="keyword">in</span> use</span><br><span class="line">Apr 14 19:26:20 debian dnsmasq[7338]: FAILED to start up</span><br><span class="line">Apr 14 19:26:20 debian ifup[916]: ifup: failed to bring up wlan1</span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line">Apr 14 19:26:20 debian ifup[916]: run-parts: executing /etc/network/<span class="keyword">if</span>-pre-up.d/wpasupplicant</span><br><span class="line">Apr 14 19:26:20 debian ifup[916]: /sbin/ip addr add 192.168.3.1/255.255.255.0 broadcast 192.168.3.255           dev wlan2 label wlan2</span><br><span class="line">Apr 14 19:26:20 debian ifup[916]: Cannot find device <span class="string">"wlan2"</span></span><br><span class="line">Apr 14 19:26:20 debian ifup[916]: ifup: failed to bring up wlan2</span><br><span class="line">Apr 14 19:26:20 debian ifup[916]: ifup: configuring interface br-lan=br-lan (inet)</span><br><span class="line">Apr 14 19:26:20 debian ifup[916]: ifup: missing required variable: address</span><br><span class="line">Apr 14 19:26:20 debian ifup[916]: ifup: missing required configuration variables <span class="keyword">for</span> interface br-lan/inet</span><br><span class="line">Apr 14 19:26:20 debian ifup[916]: ifup: failed to bring up br-lan</span><br><span class="line">Apr 14 19:26:20 debian ifup[916]: ifup: configuring interface wlan0=wlan0 (inet)</span><br></pre></td></tr></table></figure>
<ul>
<li>search <code>53</code> service</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo netstat -unlp | grep <span class="string">"53"</span></span><br><span class="line">udp        0      0 224.0.0.251:5353        0.0.0.0:*                           27555/brave --<span class="built_in">type</span>=</span><br><span class="line">udp        0      0 224.0.0.251:5353        0.0.0.0:*                           27555/brave --<span class="built_in">type</span>=</span><br><span class="line">udp        0      0 127.0.0.1:53            0.0.0.0:*                           1/init</span><br><span class="line">udp6       0      0 ::1:53                  :::*                                1/init</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> systemctl list-sockets | grep <span class="string">"53"</span></span><br><span class="line">127.0.0.1:53                               kresd.socket                    kresd@1.service</span><br><span class="line">127.0.0.1:53                               kresd.socket                    kresd@1.service</span><br><span class="line">127.0.0.1:853                              kresd-tls.socket                kresd@1.service</span><br><span class="line">[::1]:53                                   kresd.socket                    kresd@1.service</span><br><span class="line">[::1]:53                                   kresd.socket                    kresd@1.service</span><br><span class="line">[::1]:853                                  kresd-tls.socket                kresd@1.service</span><br></pre></td></tr></table></figure>
<ul>
<li>查看系统启动时的所有错误</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~$ systemctl --no-pager --all --state=failed</span><br><span class="line">  UNIT                         LOAD   ACTIVE SUB    DESCRIPTION</span><br><span class="line">● dokku-retire.service         loaded failed failed Dokku retire service</span><br><span class="line">● networking.service           loaded failed failed Raise network interfaces</span><br><span class="line">● rc-local.service             loaded failed failed /etc/rc.local Compatibility</span><br><span class="line">● systemd-modules-load.service loaded failed failed Load Kernel Modules</span><br><span class="line"></span><br><span class="line">LOAD   = Reflects whether the unit definition was properly loaded.</span><br><span class="line">ACTIVE = The high-level unit activation state, i.e. generalization of SUB.</span><br><span class="line">SUB    = The low-level unit activation state, values depend on unit <span class="built_in">type</span>.</span><br><span class="line"></span><br><span class="line">4 loaded units listed.</span><br><span class="line">To show all installed unit files use <span class="string">'systemctl list-unit-files'</span>.</span><br></pre></td></tr></table></figure>
<h1 id="让远端的GUI运行到本机界面"><a href="#让远端的GUI运行到本机界面" class="headerlink" title="让远端的GUI运行到本机界面"></a>让远端的GUI运行到本机界面</h1><h2 id="SSH-X-Forwarding"><a href="#SSH-X-Forwarding" class="headerlink" title="SSH X Forwarding"></a>SSH X Forwarding</h2><ul>
<li>这个比较简单，在<code>/etc/ssh/sshd_config</code>要有如下设置,再用要<code>ssh -X user@&lt;remote_host&gt;</code>登录，运行一个类<code>X</code>的程序，就会出现在本机。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AllowTcpForwarding yes</span><br><span class="line">X11Forwarding yes</span><br><span class="line">X11UseLocalhost yes</span><br></pre></td></tr></table></figure>
<ul>
<li>一般以查看<code>&lt;remote_host&gt;</code>里的<code>echo $DISPLAY</code>变量是<code>localhost:10.0</code>。</li>
</ul>
<h2 id="X-Server-tcp"><a href="#X-Server-tcp" class="headerlink" title="X Server tcp"></a>X Server tcp</h2><ul>
<li>这里以<code>lightdm</code>为例，其它:<code>GDM，XDM</code>类似。确保<code>/etc/lightdm/lightdm.conf</code>里有以下行</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ grep -v <span class="string">'^#\|^$'</span> /etc/lightdm/lightdm.conf</span><br><span class="line">[LightDM]</span><br><span class="line">[Seat:*]</span><br><span class="line">xserver-allow-tcp=<span class="literal">true</span></span><br><span class="line">[XDMCPServer]</span><br><span class="line">enabled=<span class="literal">true</span></span><br><span class="line">port=177</span><br><span class="line">[VNCServer]</span><br></pre></td></tr></table></figure>
<ul>
<li>重启本机的<code>lightdm</code>服务。就会有发现<code>Xserver</code>的<code>tcp listen</code>. 一般来说使用<code>SSH X Fowarding</code>就可以满足很多场景需求。下面这个例就必<br>须使用<code>Xserver tcp</code>,如果使用<code>SSH X Forwarding</code>就出现<code>gtk initialization failed</code>。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run  --device /dev/kvm    -e RAM=6 -p 50922:10022 -v <span class="variable">$XAUTH</span>:/root/.Xauthority -e DISPLAY=&lt;remote_host&gt;:0.0 docker-osx:latest</span><br></pre></td></tr></table></figure>
<ul>
<li>上面两个方式还是提示无权连接时，在本机运行<code>xhost +</code>再测试。</li>
</ul>
<h1 id="Glibc-兼容问题"><a href="#Glibc-兼容问题" class="headerlink" title="Glibc 兼容问题"></a>Glibc 兼容问题</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~* https://developers.redhat.com/blog/2019/08/01/how-the-gnu-c-library-handles-backward-compatibility/</span><br></pre></td></tr></table></figure>
<h1 id="Linux下IPv6路由丢失"><a href="#Linux下IPv6路由丢失" class="headerlink" title="Linux下IPv6路由丢失"></a>Linux下<code>IPv6</code>路由丢失</h1><ul>
<li>在<code>Debian</code>下面遇到过种，不知道过了多久，系统内<code>wlan0</code>网卡的<code>IPv6</code>路由不见，但是<code>IPv6</code>的地址还在。后来发现是<code>sysctl</code>配置的问题，配置成下面就解决了：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.ipv6.conf.default.autoconf = 0</span><br><span class="line">net.ipv6.conf.wlan0.autoconf = 0</span><br></pre></td></tr></table></figure>
<h1 id="Knot-DNS缓存问题"><a href="#Knot-DNS缓存问题" class="headerlink" title="Knot DNS缓存问题"></a>Knot DNS缓存问题</h1><ul>
<li>之前使用<code>dnsmasq</code>做<code>dhcp+dns</code>同时还支持<code>IPv6</code>,不知何时<code>dnsmasq</code>启动时，提示53端口被占，检查发现还是被<code>1/init</code>进程占住。这里无法通过<code>/proc/1/cmdline</code>查找。<br>通过<code>find /usr/lib/systemd/system -exec grep -nH &quot;127.0.0.1:53&quot; {} \;</code>发现在<code>kresd.socket</code>文件内有如下设置。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tcp        0      0 127.0.0.1:53            0.0.0.0:*               LISTEN      1/init</span><br><span class="line">tcp        0      0 127.0.0.1:853           0.0.0.0:*               LISTEN      1/init</span><br></pre></td></tr></table></figure>
<h1 id="在Debian-10使用systemed运行-etc-rc-local开机自启命令"><a href="#在Debian-10使用systemed运行-etc-rc-local开机自启命令" class="headerlink" title="在Debian 10使用systemed运行/etc/rc.local开机自启命令"></a>在<code>Debian 10</code>使用<code>systemed</code>运行<code>/etc/rc.local</code>开机自启命令</h1><ul>
<li>创建<code>systemed</code>服务描述文件。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$ cat&gt;/etc/systemd/system/rc-local.service&lt;&lt;EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description=/etc/rc.local Compatibility</span><br><span class="line">Documentation=man:systemd-rc-local-generator(8)</span><br><span class="line">ConditionFileIsExecutable=/etc/rc.local</span><br><span class="line">ConditionPathExists=/etc/rc.local</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/etc/rc.local start</span><br><span class="line">TimeoutSec=0</span><br><span class="line">RemainAfterExit=yes</span><br><span class="line">StandardOutput=tty</span><br><span class="line">SysVStartPriority=99</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ul>
<li>创建运行脚本文件，可以把需要运行的命令加入到<code>exit 0</code>之前。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~<span class="variable">$cat</span>&gt;/etc/rc.local&lt;&lt;EOF</span><br><span class="line"><span class="comment">#!/bin/sh -e</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># rc.local</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This script is executed at the end of each multiuser runlevel.</span></span><br><span class="line"><span class="comment"># Make sure that the script will "exit 0" on success or any other</span></span><br><span class="line"><span class="comment"># value on error.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In order to enable or disable this script just change the execution</span></span><br><span class="line"><span class="comment"># bits.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># By default this script does nothing.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ul>
<li>分配运行权限，与开机自运行命令</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ chmod +x /etc/rc.local</span><br><span class="line">~$ systemctl <span class="built_in">enable</span> rc-local</span><br><span class="line">~$ systemctl start rc-local</span><br></pre></td></tr></table></figure>
<h1 id="Linux下安装Xrdp服务"><a href="#Linux下安装Xrdp服务" class="headerlink" title="Linux下安装Xrdp服务"></a>Linux下安装Xrdp服务</h1><ul>
<li><a href="https://www.hiroom2.com/2018/05/07/ubuntu-1804-xrdp-mate-en/" target="_blank" rel="noopener">Ubuntu 18.04: Connect to MATE desktop environment via XRDP</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ apt-get install xrdp</span><br></pre></td></tr></table></figure>
<ul>
<li>xRDP uses the /etc/ssl/private/ssl-cert-snakeoil.key<br>file which belongs to the ssl-cert group. As such we need to add the xRDP user to that group:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo adduser xrdp ssl-cert</span><br></pre></td></tr></table></figure>
<ul>
<li>如果出现<code>Could not acquire name on session bus</code>. 需要如下设置:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF&gt; ~/.xsession</span><br><span class="line"><span class="built_in">unset</span> DBUS_SESSION_BUS_ADDRESS</span><br><span class="line">mate-session</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h1 id="Linux下运行x11vnc"><a href="#Linux下运行x11vnc" class="headerlink" title="Linux下运行x11vnc"></a>Linux下运行x11vnc</h1><ul>
<li><p><a href="https://wiki.archlinux.org/title/X11vnc" target="_blank" rel="noopener">X11vnc</a></p>
</li>
<li><p>x11vnc可以支持共享与控制的功能。简单运行如下</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -t -L 5900:localhost:5900 remote_vnchost <span class="string">'VNC_PASSWORD=123456 x11vnc -localhost -display :0'</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>如遇到下面的错误。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">27/09/2021 20:47:05 Xinerama: no blackouts needed (screen fills rectangle)</span><br><span class="line">27/09/2021 20:47:05</span><br><span class="line">27/09/2021 20:47:05 shmget(fullscreen) failed.</span><br><span class="line">27/09/2021 20:47:05 shmget: No space left on device</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看内核设置</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -a | grep <span class="string">"shm"</span></span><br><span class="line">kernel.shm_next_id = -1</span><br><span class="line">kernel.shm_rmid_forced = 0</span><br><span class="line">kernel.shmall = 18446744073692774399</span><br><span class="line">kernel.shmmax = 18446744073692774399</span><br><span class="line">kernel.shmmni = 4096</span><br><span class="line">vm.hugetlb_shm_group = 0</span><br></pre></td></tr></table></figure>
<ul>
<li>需要把<code>kernel.shmmni</code>增加到<code>8192</code>.</li>
</ul>
<h1 id="rime同文输入法"><a href="#rime同文输入法" class="headerlink" title="rime同文输入法"></a><code>rime</code>同文输入法</h1><ul>
<li><p>Rime 是一个跨平台的输入框架。它的核心（或者说「后端」）是 librime 引擎，不同平台的前端实现共用这个后端。目前在 GitHub RIME 组织中维护的前端实现有三个：</p>
<p>  用于 Windows 的 Weasel 「小狼毫」；<br>  用于 macOS 的 Squirrel 「鼠须管」；<br>  用于 Linux 的 ibus-rime 「中州韵」——Rime 本身的中文名字也叫「中州韵输入法引擎」。</p>
</li>
<li><p>同步之后可以看到文件夹下的相关配置，基本上和桌面版的 RIME 是一致的：</p>
<p>  default.yaml，各输入方案共享的全局配置<br>  default.custom.yaml，（可选）对 default.yaml 的修改，不会随着客户端的更新而被覆盖，所以对 default 的修改可以通过 patch 的方式放入该配置文件<br>  xxx.schema.yaml，xxx 输入方案的配置<br>  xxx.custom.yaml，（可选）对 xxx.schema.yaml 的自定义修改<br>  xxx.dict.yaml, xxx 输入方案的词库（字典）</p>
</li>
</ul>
<ul>
<li>这里主要是记录网上链接，各种配置与词库都是热心网友供献，你可以稍作修改，或者不作修改都能有很好的体验。如果自已有空也可以定制出自已的风格，且可以<br>同步各种平台上使用。</li>
</ul>
<ul>
<li><a href="https://einverne.github.io/post/2021/04/use-trime-input-method-rime-on-android.html" target="_blank" rel="noopener">Android 上的 RIME 输入法 trime 同文输入法使用 </a></li>
<li><a href="https://wzyboy.im/post/1251.html" target="_blank" rel="noopener">使用 Trime 在 Android 上输入五笔</a></li>
<li><a href="https://github.com/osfans/trime" target="_blank" rel="noopener">同文安卓輸入法平臺/Trime: Rime IME for Android</a></li>
<li><a href="https://rime.im/" target="_blank" rel="noopener">RIME | 中州韻輸入法引擎</a></li>
<li><a href="https://github.com/rime/home/wiki/CustomizationGuide" target="_blank" rel="noopener">Rime 定製指南</a></li>
<li><a href="https://jiz4oh.com/2020/10/how-to-use-rime/" target="_blank" rel="noopener">Rime 输入法指北</a></li>
</ul>
<hr>
<h1 id="谢谢支持"><a href="#谢谢支持" class="headerlink" title="谢谢支持"></a>谢谢支持</h1><ul>
<li>微信二维码:</li>
<li><a href="mailto:yjdwbj@gmail.com" target="_blank" rel="noopener">联系作者: yjdwbj@gmail.com</a></li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"><br>```</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Debian-Linux-Shell-Ardunio/" rel="tag"># Debian,Linux,Shell,Ardunio</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2016/08/06/为Radeon驱动编译Mesa-GLX支持/" rel="prev" title="为Radeon驱动编译Mesa-GLX支持">
      <i class="fa fa-chevron-left"></i> 为Radeon驱动编译Mesa-GLX支持
    </a></div>
      <div class="post-nav-item">
    <a href="/2016/08/26/常见编译问题-不定期更新/" rel="next" title="常见编译问题,不定期更新.">
      常见编译问题,不定期更新. <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#PulseAudio-设置与应用"><span class="nav-number">1.</span> <span class="nav-text">PulseAudio 设置与应用</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#minicom-使用"><span class="nav-number">2.</span> <span class="nav-text">minicom 使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#AT-命令"><span class="nav-number">2.1.</span> <span class="nav-text">AT 命令</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#esptool-升级固件"><span class="nav-number">3.</span> <span class="nav-text">esptool 升级固件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#下面是更新部分"><span class="nav-number">3.1.</span> <span class="nav-text">下面是更新部分</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#转换-GBK-文本文件的问题"><span class="nav-number">4.</span> <span class="nav-text">转换 GBK 文本文件的问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#批量清除文件名中的特定字符串"><span class="nav-number">5.</span> <span class="nav-text">批量清除文件名中的特定字符串</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux-下-wireless-WPA-加密连接"><span class="nav-number">6.</span> <span class="nav-text">Linux 下 wireless WPA 加密连接</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MT7601U-开启软件AP功能（非hostapd"><span class="nav-number">7.</span> <span class="nav-text">MT7601U 开启软件AP功能（非hostapd)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RTL8812AU驱动-0bda-0811"><span class="nav-number">8.</span> <span class="nav-text">RTL8812AU驱动(0bda:0811)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用wpa-supplicant"><span class="nav-number">8.1.</span> <span class="nav-text">使用wpa_supplicant</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AP模式"><span class="nav-number">8.1.1.</span> <span class="nav-text">AP模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RPi交叉编译"><span class="nav-number">8.2.</span> <span class="nav-text">RPi交叉编译</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RTL8169-驱动"><span class="nav-number">9.</span> <span class="nav-text">RTL8169 驱动</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用-hostapd-配置-WIFI-热点"><span class="nav-number">10.</span> <span class="nav-text">使用 hostapd 配置 WIFI 热点</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#查看网卡配置"><span class="nav-number">10.1.</span> <span class="nav-text">查看网卡配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装"><span class="nav-number">10.2.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#调试配置文件错误"><span class="nav-number">10.3.</span> <span class="nav-text">调试配置文件错误</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置实例"><span class="nav-number">10.4.</span> <span class="nav-text">配置实例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置主机路由"><span class="nav-number">10.5.</span> <span class="nav-text">配置主机路由</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux-下是使用蓝牙串口通信"><span class="nav-number">11.</span> <span class="nav-text">Linux 下是使用蓝牙串口通信</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配对蓝牙"><span class="nav-number">11.1.</span> <span class="nav-text">配对蓝牙</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#手动边接-RFCOMM-串口"><span class="nav-number">11.2.</span> <span class="nav-text">手动边接 RFCOMM 串口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#蓝牙错误"><span class="nav-number">11.3.</span> <span class="nav-text">蓝牙错误</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux-Systemctl-启动服务超时设置"><span class="nav-number">12.</span> <span class="nav-text">Linux Systemctl 启动服务超时设置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装-IBus-输入法框架"><span class="nav-number">13.</span> <span class="nav-text">安装 IBus 输入法框架</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BOSSAC-烧写-Arduino-DUE-无法找到设备"><span class="nav-number">14.</span> <span class="nav-text">BOSSAC 烧写 Arduino-DUE 无法找到设备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#处理方法"><span class="nav-number">14.1.</span> <span class="nav-text">处理方法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Virt-Manager-虚拟机无法启动"><span class="nav-number">15.</span> <span class="nav-text">Virt-Manager 虚拟机无法启动</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Virt-Manager-使用-OpenvSwitch-交换机"><span class="nav-number">15.1.</span> <span class="nav-text">Virt-Manager 使用 OpenvSwitch 交换机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装-OpenvSwitch"><span class="nav-number">15.2.</span> <span class="nav-text">安装 OpenvSwitch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建桥接端口"><span class="nav-number">15.3.</span> <span class="nav-text">创建桥接端口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改网卡启动配置"><span class="nav-number">15.4.</span> <span class="nav-text">修改网卡启动配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建-Virt-Manager-桥接网络"><span class="nav-number">15.5.</span> <span class="nav-text">创建 Virt-Manager 桥接网络</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置虚拟机的网络"><span class="nav-number">15.6.</span> <span class="nav-text">设置虚拟机的网络</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建-Debian-Live-USB-系统盘"><span class="nav-number">16.</span> <span class="nav-text">创建 Debian Live USB 系统盘</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#开启-Debian-Hibernate-功能"><span class="nav-number">17.</span> <span class="nav-text">开启 Debian Hibernate 功能</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#程序找不到链接库位置"><span class="nav-number">18.</span> <span class="nav-text">程序找不到链接库位置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#在内核树里编译单个模块"><span class="nav-number">19.</span> <span class="nav-text">在内核树里编译单个模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#编译carl9170出错问题"><span class="nav-number">19.1.</span> <span class="nav-text">编译carl9170出错问题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建大于-2TB-的分区"><span class="nav-number">20.</span> <span class="nav-text">创建大于 2TB 的分区</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux-下修复-屏蔽-磁盘坏块"><span class="nav-number">21.</span> <span class="nav-text">Linux 下修复(屏蔽)磁盘坏块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SmartCtl"><span class="nav-number">21.1.</span> <span class="nav-text">SmartCtl</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Short-Test"><span class="nav-number">21.1.1.</span> <span class="nav-text">使用Short Test</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Long-Test"><span class="nav-number">21.1.2.</span> <span class="nav-text">使用Long Test</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#防止-etc-resolve-conf-被-DHCP-自动修改"><span class="nav-number">22.</span> <span class="nav-text">防止/etc/resolve.conf 被 DHCP 自动修改</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#apt-get使用-Socks5代理"><span class="nav-number">23.</span> <span class="nav-text">apt-get使用 Socks5代理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Git使用问题"><span class="nav-number">24.</span> <span class="nav-text">Git使用问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#脚本配置git-Socks5代理"><span class="nav-number">24.1.</span> <span class="nav-text">脚本配置git Socks5代理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Git-错误-error-refs-remotes-origin-rpi-4-19-y-does-not-point-to-a-valid-object"><span class="nav-number">24.2.</span> <span class="nav-text">Git 错误 error: refs/remotes/origin/rpi-4.19.y does not point to a valid object!</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用Intel-AX200-网卡"><span class="nav-number">25.</span> <span class="nav-text">使用Intel AX200  网卡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#查看WIFI的地区代码。"><span class="nav-number">25.1.</span> <span class="nav-text">查看WIFI的地区代码。</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#编译wireless-regdb"><span class="nav-number">25.1.1.</span> <span class="nav-text">编译wireless-regdb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编译crda"><span class="nav-number">25.1.2.</span> <span class="nav-text">编译crda</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建Linux路由器-支持IPv6-PD"><span class="nav-number">26.</span> <span class="nav-text">创建Linux路由器(支持IPv6-PD)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#系统配置"><span class="nav-number">26.1.</span> <span class="nav-text">系统配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DHCP-amp-DNS服务器"><span class="nav-number">26.2.</span> <span class="nav-text">DHCP&amp;DNS服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DHCP客户端"><span class="nav-number">26.3.</span> <span class="nav-text">DHCP客户端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DHCPCD5"><span class="nav-number">26.3.1.</span> <span class="nav-text">DHCPCD5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Wide-dhcpv6-client"><span class="nav-number">26.3.2.</span> <span class="nav-text">Wide-dhcpv6-client</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Wifi客户端"><span class="nav-number">26.4.</span> <span class="nav-text">Wifi客户端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HOSTAPD"><span class="nav-number">26.4.1.</span> <span class="nav-text">HOSTAPD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WPASUPPLICANT"><span class="nav-number">26.4.2.</span> <span class="nav-text">WPASUPPLICANT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Wifi-Direct-p2p-mode"><span class="nav-number">26.4.3.</span> <span class="nav-text">Wifi Direct(p2p mode)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#VirtualBox虚拟机与主机的复制与粘贴"><span class="nav-number">27.</span> <span class="nav-text">VirtualBox虚拟机与主机的复制与粘贴</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Android连接USB时，MTP挂载错误。"><span class="nav-number">28.</span> <span class="nav-text">Android连接USB时，MTP挂载错误。</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Debian支持多架构"><span class="nav-number">29.</span> <span class="nav-text">Debian支持多架构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Samba4-共享问题（SMB-CIFS）"><span class="nav-number">30.</span> <span class="nav-text">Samba4 共享问题（SMB/CIFS）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#无法进虚拟终端的问题（Ctrl-Alt-f-1-6"><span class="nav-number">31.</span> <span class="nav-text">无法进虚拟终端的问题（Ctrl-Alt-f[1-6])</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#一起无法重启networking服务的问题"><span class="nav-number">32.</span> <span class="nav-text">一起无法重启networking服务的问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#让远端的GUI运行到本机界面"><span class="nav-number">33.</span> <span class="nav-text">让远端的GUI运行到本机界面</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SSH-X-Forwarding"><span class="nav-number">33.1.</span> <span class="nav-text">SSH X Forwarding</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#X-Server-tcp"><span class="nav-number">33.2.</span> <span class="nav-text">X Server tcp</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Glibc-兼容问题"><span class="nav-number">34.</span> <span class="nav-text">Glibc 兼容问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux下IPv6路由丢失"><span class="nav-number">35.</span> <span class="nav-text">Linux下IPv6路由丢失</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Knot-DNS缓存问题"><span class="nav-number">36.</span> <span class="nav-text">Knot DNS缓存问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#在Debian-10使用systemed运行-etc-rc-local开机自启命令"><span class="nav-number">37.</span> <span class="nav-text">在Debian 10使用systemed运行/etc/rc.local开机自启命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux下安装Xrdp服务"><span class="nav-number">38.</span> <span class="nav-text">Linux下安装Xrdp服务</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux下运行x11vnc"><span class="nav-number">39.</span> <span class="nav-text">Linux下运行x11vnc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#rime同文输入法"><span class="nav-number">40.</span> <span class="nav-text">rime同文输入法</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#谢谢支持"><span class="nav-number">41.</span> <span class="nav-text">谢谢支持</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">yjdwbj</p>
  <div class="site-description" itemprop="description">最是人间留不住,朱颜辞镜花辞树</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yjdwbj</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>

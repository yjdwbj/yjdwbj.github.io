<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘">
<meta property="og:type" content="website">
<meta property="og:title" content="Sunrise åšå®¢">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Sunrise åšå®¢">
<meta property="og:description" content="æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sunrise åšå®¢">
<meta name="twitter:description" content="æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘">

<link rel="canonical" href="http://yoursite.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Sunrise åšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sunrise åšå®¢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/13/Kubernetesä½¿ç”¨æŒ‡å—/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/13/Kubernetesä½¿ç”¨æŒ‡å—/" class="post-title-link" itemprop="url">Kubernetesä½¿ç”¨æŒ‡å—</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-02-13 12:44:32" itemprop="dateCreated datePublished" datetime="2021-02-13T12:44:32+08:00">2021-02-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-02-26 23:52:54" itemprop="dateModified" datetime="2022-02-26T23:52:54+08:00">2022-02-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="PaaSæ¦‚è¿°"><a href="#PaaSæ¦‚è¿°" class="headerlink" title="PaaSæ¦‚è¿°"></a><code>PaaS</code>æ¦‚è¿°</h1><ul>
<li><code>PaaS(Platform as a service)</code>,å¹³å°å³æœåŠ¡,æŒ‡å°†è½¯ä»¶ç ”å‘çš„å¹³å°(æˆ–ä¸šåŠ¡åŸºç¡€å¹³å°)ä½œä¸ºä¸€ç§æœåŠ¡,ä»¥<code>SaaS</code>çš„æ¨¡å¼æäº¤ç»™ç”¨æˆ·.<code>PaaS</code>æ˜¯äº‘è®¡ç®—æœåŠ¡çš„å…¶ä¸­ä¸€ç§æ¨¡å¼,äº‘è®¡ç®—æ˜¯ä¸€ç§æŒ‰ä½¿ç”¨é‡ä»˜è´¹çš„æ¨¡å¼çš„æœåŠ¡,ç±»ä¼¼ä¸€ç§ç§ŸèµæœåŠ¡,æœåŠ¡å¯ä»¥æ˜¯åŸºç¡€è®¾æ–½è®¡ç®—èµ„æº(IaaS),å¹³å°(PaaS),è½¯ä»¶(SaaS).ç§Ÿç”¨ITèµ„æºçš„æ–¹å¼æ¥å®ç°ä¸šåŠ¡éœ€è¦,å¦‚åŒæ°´åŠ›ã€ç”µåŠ›èµ„æºä¸€æ ·,è®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œå°†æˆä¸ºä¼ä¸šITè¿è¡Œçš„ä¸€ç§è¢«ä½¿ç”¨çš„èµ„æº,æ— éœ€è‡ªå·±å»ºè®¾,å¯æŒ‰éœ€è·å¾—.<code>PaaS</code>çš„å®è´¨æ˜¯å°†äº’è”ç½‘çš„èµ„æºæœåŠ¡åŒ–ä¸ºå¯ç¼–ç¨‹æ¥å£,ä¸ºç¬¬ä¸‰æ–¹å¼€å‘è€…æä¾›æœ‰å•†ä¸šä»·å€¼çš„èµ„æºå’ŒæœåŠ¡å¹³å°.ç®€è€Œè¨€ä¹‹,<code>IaaS</code>å°±æ˜¯å–ç¡¬ä»¶åŠè®¡ç®—èµ„æº,<code>PaaS</code>å°±æ˜¯å–å¼€å‘ã€è¿è¡Œç¯å¢ƒ,<code>SaaS</code>å°±æ˜¯å–è½¯ä»¶.</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">ç±»å‹</th>
<th>è¯´æ˜</th>
<th>æ¯”å–»</th>
<th>ä¾‹å­</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IaaS:Infrastructure-as-a-Service(åŸºç¡€è®¾æ–½å³æœåŠ¡)</td>
<td>æä¾›çš„æœåŠ¡æ˜¯è®¡ç®—åŸºç¡€è®¾æ–½</td>
<td>åœ°çš®,éœ€è¦è‡ªå·±ç›–æˆ¿å­</td>
<td>Amazon EC2(äºšé©¬é€Šå¼¹æ€§äº‘è®¡ç®—),é˜¿é‡Œäº‘</td>
</tr>
<tr>
<td style="text-align:center">PaaS: Platform-as-a-Service(å¹³å°å³æœåŠ¡)</td>
<td>æä¾›çš„æœåŠ¡æ˜¯è½¯ä»¶ç ”å‘çš„å¹³å°æˆ–ä¸šåŠ¡åŸºç¡€å¹³å°</td>
<td>å•†å“æˆ¿,éœ€è¦è‡ªå·±è£…ä¿®</td>
<td>GAE(è°·æ­Œå¼€å‘è€…å¹³å°),heroku</td>
</tr>
<tr>
<td style="text-align:center">SaaS: Software-as-a-Service(è½¯ä»¶å³æœåŠ¡)</td>
<td>æä¾›çš„æœåŠ¡æ˜¯è¿è¡Œåœ¨äº‘è®¡ç®—åŸºç¡€è®¾æ–½ä¸Šçš„åº”ç”¨ç¨‹åº</td>
<td>é…’åº—å¥—æˆ¿,å¯ä»¥ç›´æ¥å…¥ä½</td>
<td>è°·æ­Œçš„ Gmail é‚®ç®±</td>
</tr>
</tbody>
</table>
<h2 id="Kubernetesæ¦‚è¿°"><a href="#Kubernetesæ¦‚è¿°" class="headerlink" title="Kubernetesæ¦‚è¿°"></a><code>Kubernetes</code>æ¦‚è¿°</h2><ul>
<li><a href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/" target="_blank" rel="noopener">What is Kubernetes?</a></li>
<li><code>Kubernetes</code>æ˜¯<code>Google</code>å¼€æºçš„å®¹å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿ.å®ƒæ„å»º<code>Docker</code>æŠ€æœ¯ä¹‹ä¸Š,ä¸ºå®¹å™¨åŒ–çš„åº”ç”¨æä¾›èµ„æºè°ƒåº¦ã€éƒ¨ç½²è¿è¡Œã€æœåŠ¡å‘ç°ã€æ‰©å®¹ç¼©å®¹ç­‰æ•´ä¸€å¥—åŠŸèƒ½,æœ¬è´¨ä¸Šå¯çœ‹ä½œæ˜¯åŸºäºå®¹å™¨æŠ€æœ¯çš„<code>Micro-PaaS</code>å¹³å°,å³ç¬¬ä¸‰ä»£<code>PaaS</code>çš„ä»£è¡¨æ€§é¡¹ç›®.</li>
<li>Kubernetesæ¶æ„å›¾<br><img src="https://d33wubrfki0l68.cloudfront.net/518e18713c865fe67a5f23fc64260806d72b38f5/61d75/images/docs/post-ccm-arch.png" alt="Kubernetes"></li>
</ul>
<h3 id="Kubernetesçš„åŸºæœ¬æ¦‚å¿µ"><a href="#Kubernetesçš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="Kubernetesçš„åŸºæœ¬æ¦‚å¿µ"></a><code>Kubernetes</code>çš„åŸºæœ¬æ¦‚å¿µ</h3><h4 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a><code>Pod</code></h4><ul>
<li><code>Pod</code>æ˜¯è‹¥å¹²ä¸ªç›¸å…³å®¹å™¨çš„ç»„åˆ,æ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µ,<code>Pod</code>åŒ…å«çš„å®¹å™¨è¿è¡Œåœ¨åŒä¸€ä¸ªå®¿ä¸»æœºä¸Š,è¿™äº›å®¹å™¨ä½¿ç”¨ç›¸åŒçš„ç½‘ç»œå‘½åç©ºé—´,IPåœ°å€å’Œç«¯å£,ç›¸äº’ä¹‹é—´èƒ½é€šè¿‡<code>localhost</code>æ¥å‘ç°å’Œé€šä¿¡,å…±äº«ä¸€å—å­˜å‚¨å·ç©ºé—´.åœ¨<code>Kubernetes</code>ä¸­åˆ›å»ºã€è°ƒåº¦å’Œç®¡ç†çš„æœ€å°å•ä½æ˜¯<code>Pod</code>.ä¸€ä¸ª<code>Pod</code>ä¸€èˆ¬åªæ”¾ä¸€ä¸ªä¸šåŠ¡å®¹å™¨å’Œä¸€ä¸ªç”¨äºç»Ÿä¸€ç½‘ç»œç®¡ç†çš„ç½‘ç»œå®¹å™¨.</li>
</ul>
<h4 id="Replication-Controller"><a href="#Replication-Controller" class="headerlink" title="Replication Controller"></a><code>Replication Controller</code></h4><ul>
<li><code>Replication Controller</code>æ˜¯ç”¨æ¥æ§åˆ¶ç®¡ç†<code>Pod</code>å‰¯æœ¬(Replica,æˆ–è€…ç§°å®ä¾‹),<code>Replication Controller</code>ç¡®ä¿ä»»ä½•æ—¶å€™<code>Kubernetes</code>é›†ç¾¤ä¸­æœ‰æŒ‡å®šæ•°é‡çš„<code>Pod</code>å‰¯æœ¬åœ¨è¿è¡Œ,å¦‚æœå°‘äºæŒ‡å®šæ•°é‡çš„<code>Pod</code>å‰¯æœ¬,<code>Replication Controller</code>ä¼šå¯åŠ¨æ–°çš„<code>Pod</code>å‰¯æœ¬,åä¹‹ä¼šæ€æ­»å¤šä½™çš„ä»¥ä¿è¯æ•°é‡ä¸å˜.å¦å¤–<code>Replication Controller</code>æ˜¯å¼¹æ€§ä¼¸ç¼©ã€æ»šåŠ¨å‡çº§çš„å®ç°æ ¸å¿ƒ.</li>
</ul>
<h4 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a><code>Deployment</code></h4><ul>
<li><code>Deployment</code>æ˜¯ä¸€ç§æ›´åŠ ç®€å•çš„æ›´æ–°<code>RC</code>å’Œ<code>Pod</code>çš„æœºåˆ¶.é€šè¿‡åœ¨<code>Deployment</code>ä¸­æè¿°æœŸæœ›çš„é›†ç¾¤çŠ¶æ€,<code>Deployment Controller</code>ä¼šå°†ç°åœ¨çš„é›†ç¾¤çŠ¶æ€åœ¨ä¸€ä¸ªå¯æ§çš„é€Ÿåº¦ä¸‹æ¸æ¸æ›´æ–°æˆæœŸæœ›çš„é›†ç¾¤çŠ¶æ€.<code>Deployment</code>çš„ä¸»è¦çš„èŒè´£åŒæ ·æ˜¯ä¸ºäº†ä¿è¯<code>Pod</code>çš„æ•°é‡å’Œå¥åº·,è€Œä¸”ç»å¤§å¤šæ•°çš„åŠŸèƒ½ä¸<code>Replication Controller</code>å®Œå…¨ä¸€æ ·,å› äº›å¯ä»¥è¢«çœ‹ä½œæ–°ä¸€ä»£çš„<code>RC</code>çš„è¶…é›†.å®ƒçš„ç‰¹æ€§æœ‰:äº‹ä»¶å’ŒçŠ¶æ€æŸ¥çœ‹,å›æ»š,ç‰ˆæœ¬è®°å½•,æš‚åœå’Œå¯åŠ¨,å¤šç§å‡çº§æ–¹æ¡ˆ:<code>Recreate,RollingUpdate</code>.</li>
</ul>
<h4 id="Job"><a href="#Job" class="headerlink" title="Job"></a><code>Job</code></h4><ul>
<li>ä»ç¨‹åºçš„è¿è¡Œå½¢æ€ä¸Šæ¥åŒºåˆ†,æˆ‘ä»¬å¯ä»¥å°†<code>Pod</code>åˆ†æˆä¸¤ç±»:é•¿æœŸè¿è¡ŒæœåŠ¡(jboss,mysql,nginxç­‰)å’Œä¸€æ¬¡æ€§ä»»åŠ¡(å¦‚å¹¶è¡Œæ•°æ®è®¡ç®—,æµ‹è¯•).<code>RC</code>åˆ›å»ºçš„<code>Pod</code>æ˜¯é•¿æ—¶è¿è¡Œçš„æœåŠ¡,è€Œ<code>Job</code>åˆ›å»ºçš„<code>Pod</code>çš„éƒ½æ˜¯ä¸€æ¬¡æ€§ä»»åŠ¡.</li>
</ul>
<h4 id="StatefulSet"><a href="#StatefulSet" class="headerlink" title="StatefulSet"></a><code>StatefulSet</code></h4><ul>
<li><code>StatefulSet</code>æ˜¯åœ¨ä¸æœ‰çŠ¶æ€çš„åº”ç”¨åŠåˆ†å¸ƒå¼ç³»ç»Ÿä¸€èµ·ä½¿ç”¨çš„.<code>StatefulSet</code>ä½¿ç”¨èµ·æ¥ç›¸å¯¹å¤æ‚,å½“åº”ç”¨å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹æ—¶æ‰ä½¿ç”¨å®ƒ.<ul>
<li>æœ‰å”¯ä¸€çš„ç¨³å®šç½‘ç»œæ ‡è¯†ç¬¦éœ€æ±‚.</li>
<li>æœ‰ç¨³å®šæ€§,æŒä¹…åŒ–æ•°æ®å­˜å‚¨éœ€æ±‚.</li>
<li>æœ‰åºçš„éƒ¨ç½²å’Œæ‰©å±•éœ€æ±‚.</li>
<li>æœ‰åºçš„åˆ é™¤å’Œç»ˆæ­¢éœ€æ±‚.</li>
<li>æœ‰åºçš„è‡ªåŠ¨æ»šåŠ¨æ›´æ–°éœ€æ±‚.</li>
</ul>
</li>
</ul>
<h4 id="Service"><a href="#Service" class="headerlink" title="Service"></a><code>Service</code></h4><ul>
<li><a href="https://kubernetes.io/docs/concepts/services-networking/service/" target="_blank" rel="noopener">Kubernetes Serviceæ–‡æ¡£</a></li>
<li><code>Service</code>æ˜¯çœŸå®åº”ç”¨æœåŠ¡çš„æŠ½è±¡,å®šä¹‰äº†<code>Pod</code>çš„é€»è¾‘é›†åˆå’Œè®¿é—®è¿™ä¸ª<code>Pod</code>é›†åˆçš„ç­–ç•¥,<code>Service</code>å°†ä»£ç†<code>Pod</code>å¯¹å¤–è¡¨ç°ä¸ºä¸€ä¸ªå•ä¸€è®¿é—®æ¥å£,å¤–éƒ¨ä¸éœ€è¦äº†è§£åç«¯<code>Pod</code>å¦‚ä½•è¿è¡Œ,è¿™ç»™æ‰©å±•æˆ–ç»´æŠ¤å¸¦æ¥å¾ˆå¤§çš„å¥½å¤„,æä¾›äº†ä¸€å¥—ç®€åŒ–çš„æœåŠ¡ä»£ç†å’Œå‘ç°æœºåˆ¶.<code>Service</code>å…±æœ‰å››ç§ç±»å‹:<ul>
<li><code>ClusterIP</code>: é€šè¿‡é›†ç¾¤å†…éƒ¨çš„IPåœ°å€æš´éœ²æœåŠ¡,æ­¤åœ°å€ä»…åœ¨é›†ç¾¤å†…éƒ¨å¯è¾¾,è€Œæ— æ³•è¢«é›†ç¾¤å¤–éƒ¨çš„å®¢æˆ·ç«¯è®¿é—®,æ­¤ä¸ºé»˜è®¤çš„<code>Service</code>ç±»å‹.</li>
<li><code>NodePort</code>: è¿™ç§ç±»å‹å»ºç«‹åœ¨<code>ClusterIP</code>ç±»å‹ä¹‹æ­¢,å…¶åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„IPåœ°å€çš„æŸé™æ€ç«¯å£(NodePort)æš´éœ²æœåŠ¡,å› æ­¤,å®ƒä¾ç„¶ä¼šä¸º<code>Service</code>åˆ†é…é›†ç¾¤IPåœ°å€,å¹¶å°†æ­¤ä½œä¸º<code>NodePort</code>çš„è·¯ç”±ç›®æ ‡.</li>
<li><code>LoadBalancer</code>: è¿™ç§ç±»å‹å»ºæ„åœ¨<code>NodePort</code>ç±»å‹ä¹‹ä¸Š,å…¶é€šè¿‡<code>cloud provider</code>æä¾›çš„è´Ÿè½½å‡è¡¡å™¨å°†æœåŠ¡æš´éœ²åˆ°é›†ç¾¤å¤–éƒ¨.å› æ­¤<code>LoadBalancer</code>ä¸€æ ·å…·æœ‰<code>NodePort</code>å’Œ<code>ClusterIP</code>.(ç›®å‰åªæœ‰äº‘æœåŠ¡å•†æ‰å¯æ”¯æŒ,å¦‚æœæ˜¯ç”¨<code>VirtualBox</code>åšå®éªŒ,åªèƒ½æ˜¯<code>ClusterIP</code>æˆ–<code>NodePort</code>)</li>
<li><code>ExternalName</code>: å…¶é€šè¿‡å°†<code>Service</code>æ˜ å°„åˆ°ç”±<code>externalName</code>å­—æ®µçš„å†…å®¹æŒ‡å®šçš„ä¸»æœºåæ¥æš´éœ²æœåŠ¡,æ­¤ä¸»æœºåéœ€è¦è¢«<code>DNS</code>æœåŠ¡è§£æåˆ°<code>CNAME</code>ç±»å‹çš„è®°å½•.</li>
</ul>
</li>
</ul>
<h4 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a><code>Ingress</code></h4><ul>
<li><code>Ingrees</code>èµ„æº,å®ƒå®ç°çš„æ˜¯â€<code>HTTP(S)è´Ÿè½½å‡è¡¡å™¨</code>â€œ,å®ƒæ˜¯<code>k8s API</code>çš„æ ‡å‡†èµ„æºç±»å‹ä¹‹ä¸€,å®ƒå…¶å®å°±æ˜¯åŸºäºDNSåç§°æˆ–URLè·¯å¾„æŠŠè¯·æ±‚è½¬å‘åˆ°æŒ‡å®šçš„<code>Service</code>èµ„æºçš„è§„åˆ™,ç”¨äºå°†é›†ç¾¤å¤–éƒ¨çš„è¯·æ±‚æµé‡è½¬å‘åˆ°é›†ç¾¤å†…éƒ¨å®ŒæˆæœåŠ¡å‘å¸ƒ,<code>Ingress</code>èµ„æºè‡ªèº«å¹¶ä¸èƒ½è¿›è¡Œæµé‡ç©¿é€,å®ƒä»…æ˜¯ä¸€ç»„è·¯ç”±è§„åˆ™çš„é›†åˆ. ä¸åŒäº<code>Deployment</code>æ§åˆ¶å™¨ç­‰,<code>Ingress</code>æ§åˆ¶å™¨å¹¶ä¸ç›´æ¥è¿è¡Œä¸º<code>kube-controller-manager</code>çš„ä¸€éƒ¨åˆ†,å®ƒæ˜¯<code>k8s</code>é›†ç¾¤çš„ä¸€ä¸ªé‡è¦é™„ä»¶,ç±»ä¼¼äº<code>CoreDNS</code>,éœ€è¦åœ¨é›†ç¾¤ä¸Šå•ç‹¬éƒ¨ç½².</li>
</ul>
<h4 id="Label"><a href="#Label" class="headerlink" title="Label"></a><code>Label</code></h4><ul>
<li><code>Label</code>æ˜¯ç”¨äºåŒºåˆ†<code>Podã€Serviceã€Replication Controller</code>çš„<code>Key/Value</code>é”®å€¼å¯¹,å®é™…ä¸Š<code>Kubernetes</code>ä¸­çš„ä»»æ„<code>API</code>å¯¹è±¡éƒ½å¯ä»¥é€šè¿‡<code>Label</code>è¿›è¡Œæ ‡è¯†.æ¯ä¸ª<code>API</code>å¯¹è±¡å¯ä»¥æœ‰å¤šä¸ª<code>Label</code>,ä½†æ˜¯æ¯ä¸ª<code>Label</code>çš„<code>Key</code>åªèƒ½å¯¹åº”ä¸€ä¸ª<code>Value</code>.<code>Label</code>æ˜¯<code>Service</code>å’Œ<code>Replication Controller</code>è¿è¡Œçš„åŸºç¡€,å®ƒä»¬éƒ½é€šè¿‡<code>Label</code>æ¥å…³è”<code>Pod</code>,ç›¸æ¯”äºå¼ºç»‘å®šæ¨¡å‹,è¿™æ˜¯ä¸€ç§éå¸¸å¥½çš„æ¾è€¦åˆå…³ç³».</li>
</ul>
<h4 id="Node"><a href="#Node" class="headerlink" title="Node"></a><code>Node</code></h4><ul>
<li><code>Kubernets</code>å±äºä¸»ä»çš„åˆ†å¸ƒå¼é›†ç¾¤æ¶æ„,<code>Kubernets Node</code>(ç®€ç§°ä¸º<code>Node</code>,æ—©æœŸç‰ˆæœ¬å«åš<code>Minion</code>)è¿è¡Œå¹¶ç®¡ç†å®¹å™¨.<code>Node</code>ä½œä¸º<code>Kubernetes</code>çš„æ“ä½œå•å…ƒ,å°†ç”¨æ¥åˆ†é…ç»™<code>Pod</code>(æˆ–è€…è¯´å®¹å™¨)è¿›è¡Œç»‘å®š,<code>Pod</code>æœ€ç»ˆè¿è¡Œåœ¨<code>Node</code>ä¸Š,<code>Node</code>å¯ä»¥è®¤ä¸ºæ˜¯<code>Pod</code>çš„å®¿ä¸»æœº.</li>
</ul>
<h3 id="Kubernetesæ¶æ„"><a href="#Kubernetesæ¶æ„" class="headerlink" title="Kubernetesæ¶æ„"></a><code>Kubernetes</code>æ¶æ„</h3><h4 id="MasterèŠ‚ç‚¹"><a href="#MasterèŠ‚ç‚¹" class="headerlink" title="MasterèŠ‚ç‚¹"></a><code>Master</code>èŠ‚ç‚¹</h4><ul>
<li><code>Master</code>æ˜¯<code>k8s</code>é›†ç¾¤çš„å¤§è„‘,è¿è¡ŒæœåŠ¡æœ‰:<ul>
<li>kube-apiserver</li>
<li>kube-scheduler</li>
<li>kube-controller-manager</li>
<li>etcd,Pod ç½‘ç»œ(å¦‚ Flannel,Canal)</li>
</ul>
</li>
</ul>
<h5 id="API-Server-kube-apiserver"><a href="#API-Server-kube-apiserver" class="headerlink" title="API Server(kube-apiserver)"></a><code>API Server(kube-apiserver)</code></h5><ul>
<li><code>Api Server</code>æ˜¯<code>k8s</code>é›†ç¾¤çš„å‰ç«¯æ¥å£,å„ç§å·¥å…·å¯ä»¥é€šè¿‡å®ƒç®¡ç†<code>Cluster</code>çš„å„ç§èµ„æº.</li>
</ul>
<h5 id="Scheduler-kube-scheduler"><a href="#Scheduler-kube-scheduler" class="headerlink" title="Scheduler(kube-scheduler)"></a><code>Scheduler(kube-scheduler)</code></h5><ul>
<li><code>Scheduler</code>è´Ÿè´£å†³å®šå°†<code>Pod</code>æ”¾åœ¨é‚£ä¸ª<code>Node</code>ä¸Šè¿è¡Œ.å®ƒè°ƒè¯•æ—¶ä¼šå……åˆ†è€ƒè™‘<code>Cluster</code>çš„æ‹“æ‰‘ç»“æ„,æ‰¾åˆ°ä¸€ä¸ªæœ€ä¼˜æ–¹æ¡ˆ.</li>
</ul>
<h5 id="Controller-Manager-kube-controller-manager"><a href="#Controller-Manager-kube-controller-manager" class="headerlink" title="Controller Manager(kube-controller-manager)"></a><code>Controller Manager(kube-controller-manager)</code></h5><ul>
<li><code>Controller Manager</code>è´Ÿè´£ç®¡ç†<code>Cluster</code>å„ç§èµ„æº.ä¿è¯èµ„æºçš„å¤„äºé¢„æœŸçš„çŠ¶æ€.å®ƒæ˜¯ç”±å¤šç§<code>controller</code> ç»„æˆçš„.</li>
</ul>
<h5 id="etcd"><a href="#etcd" class="headerlink" title="etcd"></a><code>etcd</code></h5><ul>
<li><code>etcd</code>è´Ÿè´£ä¿å­˜<code>k8s</code>çš„é…ç½®ä¿¡æ¯å’Œå„ç§èµ„æºçš„çŠ¶æ€ä¿¡æ¯.å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶,<code>etcd</code>ä¼šå¿«é€Ÿåœ°é€šçŸ¥<code>k8s</code>ç›¸å…³ç»„ä»¶.</li>
</ul>
<h5 id="Podç½‘ç»œ"><a href="#Podç½‘ç»œ" class="headerlink" title="Podç½‘ç»œ"></a><code>Pod</code>ç½‘ç»œ</h5><p>-<code>Pod</code>è¦èƒ½å¤Ÿç›¸äº’é€šä¿¡,<code>k8s</code>å¿…é¡»éƒ¨ç½²<code>Pod</code>ç½‘ç»œ,<code>flannel</code> æ˜¯å…¶ä¸­ä¸€ä¸ªå¯é€‰çš„æ–¹æ¡ˆ.</p>
<h4 id="NodeèŠ‚ç‚¹"><a href="#NodeèŠ‚ç‚¹" class="headerlink" title="NodeèŠ‚ç‚¹"></a><code>Node</code>èŠ‚ç‚¹</h4><ul>
<li><code>Node</code>æ˜¯<code>Pod</code>è¿è¡Œçš„åœ°æ–¹,<code>k8s</code> æ”¯æŒ<code>Docker,rkt</code>ç­‰å®¹å™¨çš„<code>Runtime</code>.å®ƒä¸Šé¢è¿è¡Œçš„ç»„ä»¶æœ‰<code>kubelet,kube-proxy,Pod</code>ç½‘ç»œ.</li>
</ul>
<h5 id="kubelet"><a href="#kubelet" class="headerlink" title="kubelet"></a><code>kubelet</code></h5><ul>
<li><code>kubelet</code>æ˜¯<code>Node</code>çš„<code>agent</code>,å½“<code>Scheduler</code>ç¡®å®šåœ¨æŸä¸ª<code>Node</code>ä¸Šè¿è¡Œ<code>Pod</code>å,ä¼šå°†<code>Pod</code>çš„å…·ä½“é…ç½®ä¿¡æ¯(image,volume)å‘ç»™è¯¥èŠ‚ç‚¹çš„<code>kubelet</code>.<code>kubelet</code>æ ¹æ®è¿™è¯¥ä¿¡æ¯åˆ›å»ºå„è¿è¡Œå®¹å™¨,å¹¶å‘<code>master</code>æŠ¥å‘ŠçŠ¶æ€.</li>
</ul>
<h5 id="kube-proxy"><a href="#kube-proxy" class="headerlink" title="kube-proxy"></a><code>kube-proxy</code></h5><ul>
<li><code>service</code>åœ¨é€»è¾‘ä¸Šä»£è¡¨äº†åç«¯çš„å¤šä¸ª<code>Pod</code>,å¤–ç•Œé€šè¿‡<code>service</code>è®¿é—®<code>Pod</code>.service æ¥æ”¶åˆ°çš„è¯·æ±‚æ˜¯å¦‚ä½•è½¬å‘åˆ°ç›¸åº”çš„<code>Pod</code>.å¦‚æœ‰å¤šä¸ªå‰¯æœ¬,<code>kube-proxy</code>ä¼šå®ç°è´Ÿè½½å‡è¡¡.</li>
</ul>
<h5 id="Secret-amp-ConfigMap"><a href="#Secret-amp-ConfigMap" class="headerlink" title="Secret &amp; ConfigMap"></a><code>Secret &amp; ConfigMap</code></h5><ul>
<li><code>Secret</code>å¯ä»¥ä¸º<code>Pod</code>æä¾›å¯†ç ,<code>Token</code>,ç§é’¥ç­‰æ•æ„Ÿæ•°æ®;å¯¹äºä¸€äº›éæ•æ„Ÿçš„æ•°æ®,æ¯”å¦‚åº”ç”¨çš„é…ç½®ä¿¡æ¯,å¯ä»¥ä½¿ç”¨<code>ConfigMap</code>.</li>
</ul>
<h4 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h4><h5 id="ç½‘ç»œç›¸å…³"><a href="#ç½‘ç»œç›¸å…³" class="headerlink" title="ç½‘ç»œç›¸å…³"></a>ç½‘ç»œç›¸å…³</h5><ul>
<li><strong>ACI</strong> provides integrated container networking and network security with Cisco ACI.</li>
<li><strong>Calico</strong> is a secure L3 networking and network policy provider.</li>
<li><strong>Canal</strong> unites Flannel and Calico, providing networking and network policy.</li>
<li><strong>Cilium</strong> is a L3 network and network policy plugin that can enforce HTTP/API/L7 policies transparently. Both routing and overlay/encapsulation mode are supported.</li>
<li><strong>CNI-Genie</strong> enables Kubernetes to seamlessly connect to a choice of CNI plugins, such as Calico, Canal, Flannel, Romana, or Weave.</li>
<li><strong>Contiv</strong> provides configurable networking (native L3 using BGP, overlay using vxlan, classic L2, and Cisco-SDN/ACI) for various use cases and a rich policy framework.  Contiv project is fully open sourced. The installer provides both kubeadm and non-kubeadm based installation options.</li>
<li><strong>Contrail</strong>, based on Tungsten Fabric, is a open source, multi-cloud network virtualization and policy management platform. Contrail and Tungsten Fabric are integrated with  orchestration systems such as Kubernetes, OpenShift, OpenStack and Mesos, and provide isolation modes for virtual machines, containers/pods and bare metal workloads.</li>
<li><strong>Flannel</strong> is an overlay network provider that can be used with Kubernetes.</li>
<li><strong>Knitter</strong> is a network solution supporting multiple networking in Kubernetes.</li>
<li><strong>Multus</strong> is a Multi plugin for multiple network support in Kubernetes to support all CNI plugins (e.g. Calico, Cilium, Contiv, Flannel), in addition to SRIOV, DPDK, OVS-DPDK and VPP based workloads in Kubernetes.</li>
<li><strong>NSX-T</strong> Container Plug-in (NCP) provides integration between VMware NSX-T and container orchestrators such as Kubernetes, as well as integration between NSX-T and \     container-based CaaS/PaaS platforms such as Pivotal Container Service (PKS) and OpenShift.</li>
<li><strong>Nuage</strong> is an SDN platform that provides policy-based networking between Kubernetes Pods and non-Kubernetes environments with visibility and security monitoring.</li>
<li><strong>Romana</strong> is a Layer 3 networking solution for<code>Pod</code>networks that also supports the NetworkPolicy API. Kubeadm add-on installation details available here.</li>
<li><strong>Weave Net</strong> provides networking and network policy, will carry on working on both sides of a network partition, and does not require an external database.</li>
</ul>
<h5 id="æœåŠ¡å‘ç°"><a href="#æœåŠ¡å‘ç°" class="headerlink" title="æœåŠ¡å‘ç°"></a>æœåŠ¡å‘ç°</h5><ul>
<li><strong>CoreDNS</strong> is a flexible, extensible DNS server which can be installed as the in-cluster DNS for pods.</li>
</ul>
<h5 id="å¯è§†åŒ–é¢æ¿"><a href="#å¯è§†åŒ–é¢æ¿" class="headerlink" title="å¯è§†åŒ–é¢æ¿"></a>å¯è§†åŒ–é¢æ¿</h5><ul>
<li><strong>Dashboard</strong> is a dashboard web interface for Kubernetes.</li>
<li><strong>Weave Scope</strong> is a tool for graphically visualizing your containers, pods, services etc. Use it in conjunction with a Weave Cloud account or host the UI yourself.</li>
</ul>
<h2 id="å®‰è£…Minikube"><a href="#å®‰è£…Minikube" class="headerlink" title="å®‰è£…Minikube"></a>å®‰è£…<code>Minikube</code></h2><ul>
<li>é“¾æ¥:<ul>
<li><a href="https://github.com/kubernetes/minikube" target="_blank" rel="noopener">Github - minikube</a></li>
<li><a href="https://github.com/kubernetes/kubectl" target="_blank" rel="noopener">Github - kubectl</a></li>
<li><a href="https://kubernetes.io/docs/setup/minikube/" target="_blank" rel="noopener">Running Kubernetes Locally via Minikube</a></li>
<li><a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/" target="_blank" rel="noopener">Creating a single master cluster with kubeadm</a></li>
<li><a href="https://jimmysong.io/kubernetes-handbook/" target="_blank" rel="noopener">Kubernetes ä¸­æ–‡æŒ‡å—/äº‘åŸç”Ÿåº”ç”¨æ¶æ„å®è·µæ‰‹å†Œ</a></li>
<li><a href="https://kubevirt.io/2018/Hello-KubeVirt-on-Minikube.html" target="_blank" rel="noopener">Hello Kubevirt On Minikube</a></li>
<li><a href="https://computingforgeeks.com/how-to-run-minikube-on-kvm/" target="_blank" rel="noopener">How to run Minikube on KVM</a></li>
<li><a href="https://medium.com/linagora-engineering/install-k8s-minikube-on-top-of-kvm-on-debian-9-9cd5b646063c" target="_blank" rel="noopener">Install k8s Minikube on top of KVM on Debian 9</a></li>
<li><a href="https://docs.okd.io/latest/install_config/storage_examples/shared_storage.html" target="_blank" rel="noopener">Sharing an NFS Persistent Volume (PV) Across Two Pods</a></li>
</ul>
</li>
</ul>
<ul>
<li>ä½¿ç”¨<code>Minikube</code> æ˜¯è¿è¡Œ <code>Kubernetes</code> é›†ç¾¤æœ€ç®€å•,æœ€å¿«æ·çš„é€”è·¯å¾„.<code>Minikube</code>æ˜¯ä¸€ä¸ªæ„å»ºå•èŠ‚ç‚¹é›†ç¾¤çš„å·¥å…·,å¯¹äºæµ‹è¯•<code>Kubernetes</code>å’Œæœ¬åœ°å¼€å‘åº”ç”¨éƒ½éå¸¸æœ‰ç”¨,è¿™é‡Œåœ¨<code>Debian</code>ä¸‹å®‰è£…,å®ƒé»˜è®¤ä¼šè¦ä½¿ç”¨åˆ°<code>VirtualBox</code>è™šæ‹Ÿæœºä¸ºé©±åŠ¨,ä¹Ÿå¯ä»¥å®‰è£…<code>kvm2</code>ä¸ºé©±åŠ¨.<code>Minikube</code>çš„å‚è€ƒæ–‡æ¡£<a href="https://docs.docker.com/machine/" target="_blank" rel="noopener">docker-machine</a>çš„å‚æ•°.</li>
<li>ç¬¬ä¸€æ¬¡ä½¿ç”¨<code>minikube start</code>,å®ƒä¼šåœ¨åˆ›å»ºä¸€ä¸ª<code>~/.minikube</code>ç›®å½•,ä¼šä¸‹è½½<a href="https://storage.googleapis.com/minikube/iso/minikube-v0.35.0.iso" target="_blank" rel="noopener">minikube-vxxx.iso</a>åˆ°<code>~/.minikube/cache/</code>ä¸‹é¢,å¦‚æœä¸‹è½½ååˆ†ç¼“æ…¢,å¯ä»¥æ‰‹åŠ¨<code>https://storage.googleapis.com/minikube/iso/minikube-v0.35.0.iso</code>ä¸‹è½½å¤åˆ¶åˆ°ç›®å½•ä¸‹.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.35.0/minikube-linux-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo cp minikube /usr/<span class="built_in">local</span>/bin/ &amp;&amp; rm minikube</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ä»è¿™é‡Œhttps://storage.googleapis.com/minikube/releases/v0.35.0/minikube-linux-amd64ä¸‹è½½.</span></span><br><span class="line"><span class="comment"># ä¸‹è½½kvm2é©±åŠ¨</span></span><br><span class="line">~$ wget https://github.com/kubernetes/minikube/releases/download/v0.35.0/docker-machine-driver-kvm2</span><br><span class="line">~$ chmod +x docker-machine-driver-kvm2 &amp;&amp; mv docker-machine-driver-kvm2 /usr/<span class="built_in">local</span>/bin &amp;&amp; rm minikube</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯åŠ¨ä¸€ä¸ª<code>Minikube</code>è™šæ‹Ÿæœº,å¦‚æœç›´æ¥<code>minikube start</code>å°±ä¼šé»˜è®¤ä½¿ç”¨<code>VirtualBox</code>å¯åŠ¨.ç½‘ç»œéƒ¨åˆ†ä½¿ç”¨<code>default</code>.<code>--kvm-network</code>çš„å‚æ•°,æ¥æºäº<code>virsh net-list</code>.<code>minikube-net</code>æ˜¯ä¸€ä¸ªéš”ç¦»çš„ç½‘ç»œ,ä¹Ÿä¸æ˜¯è¯´ä¸èƒ½è”ç½‘çš„,å¦‚æœéœ€è¦è¿ç½‘,è¦ä¸æœ¬æœºçš„ç½‘å¡æˆ–è€…ç½‘ç»œåšæ¡¥æ¥æˆ–<code>NAT</code>.</li>
<li><p><code>k8s.gcr.io</code>åœ¨å›½å†…æ˜¯æ— æ³•ç›´æ¥è®¿é—®çš„,æ‰€ä»¥ä¼šé€ æˆ<code>minikube</code>æ— æ³•æ‹–å–ç›¸å…³çš„é•œåƒ,æœ€ç»ˆå¯¼è‡´<code>minikube</code>æ— æ³•æ­£å¸¸ä½¿ç”¨.åœ¨æ­¤æœ‰å‡ ä¸ªæ–¹æ³•å¯ä»¥å˜é€šä¸€ä¸‹,æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä»£ç†:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--docker-env HTTP_PROXY=&lt;ip:port&gt; --docker-env HTTPS_PROXY=&lt;ip:port&gt; --docker-env NO_PROXY=127.0.0.1,localhost`</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœæœåŠ¡å™¨å¯ä»¥è®¿é—®å¤–ç½‘,åˆ™å¯åœ¨<code>docker daemon</code>çš„å¯åŠ¨å‚æ•°(<code>/etc/sysconfig/docker</code>)ä¸­<code>OPTIONS</code><br>åŠ ä¸Š<code>--insecure-registry k8s.gcr.io</code></p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">~$  minikube start --vm-driver=kvm2 --kvm-network minikube-net --registry-mirror=https://registry.docker-cn.com --kubernetes-version v1.14.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»é˜¿é‡Œä¸‹è½½è¿‡æ¥,æœ€å¥½æ˜¯å¯ä»¥ä½¿ç”¨ä»£ç†ç›´æ¥ä»k8s.gcr.ioä¸‹è½½.</span></span><br><span class="line">~$ docker pull  registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.14.0</span><br><span class="line">~$ docker pull  registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.14.0</span><br><span class="line">~$ docker pull  registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.14.0</span><br><span class="line">~$ docker pull  registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.14.0</span><br><span class="line">~$ docker pull  registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.3.1</span><br><span class="line">~$ docker pull  registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.3.10</span><br><span class="line">~$ docker pull  registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨è„šæœ¬æ‰¹é‡æŠŠå®ƒä»¬æ¢tag,ä¹Ÿå¯ä»¥æŠŠå®ƒæ¨é€åˆ°è‡ªå·±å…¬å¸çš„ç§æœ‰ä»“åº“ä¸­å»,æµ‹è¯•ä½¿ç”¨é‡å†™TAGçš„æ–¹æ³•å¥½åƒä¸è¡Œ,è¿˜æ˜¯è¦ç”¨ä»£ç†æ‰èƒ½æ­£å¸¸ä¸‹è½½.</span></span><br><span class="line">~$ docker images | grep <span class="string">"aliyuncs.com"</span> | awk <span class="string">'&#123;split($1,a,"/"); print "docker tag " $1":"$2 " k8s.gcr.io/"a[3]":"$2&#125;'</span></span><br><span class="line">~$ docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.14.0 k8s.gcr.io/kube-proxy:v1.14.0</span><br><span class="line">~$ docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.14.0 k8s.gcr.io/kube-apiserver:v1.14.0</span><br><span class="line">~$ docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.14.0 k8s.gcr.io/kube-scheduler:v1.14.0</span><br><span class="line">~$ docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.14.0 k8s.gcr.io/kube-controller-manager:v1.14.0</span><br><span class="line">~$ docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.3.1 k8s.gcr.io/coredns:1.3.1</span><br><span class="line">~$ docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.3.10 k8s.gcr.io/etcd:3.3.10</span><br><span class="line">~$ docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1 k8s.gcr.io/pause:3.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†ç”¨æ‰‹åŠ¨åˆå§‹åŒ–è¿™äº›imageåˆ°å®¹å™¨</span></span><br><span class="line">~$ sudo kubeadm init --kubernetes-version=v1.14.0</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ç»è¿‡æµ‹è¯•ç›´æ¥ä½¿ç”¨<code>kubeadm</code>ä¹Ÿå¯ä»¥ç›´æ¥æ‹‰å–å…¶å®ƒçš„å›½å†…é•œåƒè¿›è¡Œå®‰è£…,ä½¿ç”¨ä»£ç†ä¹Ÿå¯ä»¥å®‰è£…,è€ƒè™‘åˆ°æ‰¾åˆ°ä¸€ä¸ªç¨³å®šå¯é çš„ä»£ç†è¿˜æ˜¯æœ‰ä¸€äº›éš¾åº¦.å› ä¸º<code>minikube start --vm-driver=kvm2</code>æ˜¯ç›´æ¥åœ¨åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœº,å¹¶é€šè¿‡<code>sudo kubeadm config images pull --config /var/lib/kubeadm.yaml</code>åœ¨è™šæ‹Ÿæœºæ‹‰å–ç›¸åº”çš„<code>docker</code>é•œåƒç»„ä»¶åˆ°æœ¬åœ°éƒ¨ç½²å„ç§<code>k8s</code>çš„æœåŠ¡.å®ƒé»˜è®¤æ˜¯ä½¿ç”¨<code>https://k8s.gcr.io/v2/</code>è¿™åŸŸåå»æ‹‰å–é•œåƒ,</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ minikube start --vm-driver=kvm2 --kvm-network minikube-net --registry-mirror=https://registry.docker-cn.com</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‘ç°å‚æ•°<code>--registry-mirror</code>å¹¶æ²¡æœ‰èµ·ä½œç”¨,è¿˜æ˜¯ä¼šæŠ¥é”™å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> Unable to pull images, <span class="built_in">which</span> may be OK: running cmd: sudo kubeadm config images pull --config /var/lib/kubeadm.yaml: <span class="built_in">command</span> failed: sudo kubeadm config images pull --config /var/lib/kubeadm.yaml</span><br><span class="line">stdout:</span><br><span class="line">stderr: failed to pull image <span class="string">"k8s.gcr.io/kube-apiserver:v1.14.0"</span>: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="keyword">while</span> waiting <span class="keyword">for</span> connection (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸‹è½½<code>kubectl</code>åˆ°æœ¬åœ°å¼€å‘æœºå™¨(æ§åˆ¶ç«¯)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl</span><br><span class="line">~$ chmod +x kubectl &amp;&amp; sudo mv kubectl /usr/<span class="built_in">local</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å…¥è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</span></span><br><span class="line">~$ <span class="built_in">echo</span> <span class="string">"source &lt;(kubectl completion bash)"</span> &gt;&gt; ~/.bashrc</span><br><span class="line">~$ kubectl get nodes</span><br><span class="line">NAME       STATUS   ROLES    AGE   VERSION</span><br><span class="line">minikube   Ready    &lt;none&gt;   94m   v1.13.4</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="æºç ç¼–è¯‘Minikube"><a href="#æºç ç¼–è¯‘Minikube" class="headerlink" title="æºç ç¼–è¯‘Minikube"></a>æºç ç¼–è¯‘<code>Minikube</code></h1><ul>
<li><p>ä¸‹è½½æœ€æ–°GOè¯­è¨€ç¼–è¯‘å™¨</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ wget -c https://golang.google.cn/doc/install?download=go1.12.4.linux-amd64.tar.gz</span><br><span class="line">~$ sudo tar xvf go1.12.4.linux-amd64.tar.gz -C /opt/</span><br><span class="line">~$ <span class="built_in">export</span> PATH=/opt/go/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸‹è½½æºç ,è¦å…ˆåˆ›å»º<code>/opt/go/src/k8s.io</code>ç›®å½•,åœ¨è¯¥ç›®å½•ä¸‹å…‹éš†ä»£ç .å¹¶ä¸”ä¿®æ”¹é•œåƒåœ°å€</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo mkdir /opt/go/src/k8s.io &amp;&amp; <span class="built_in">cd</span> /opt/go/src/k8s.io &amp;&amp;   git <span class="built_in">clone</span> https://github.com/kubernetes/minikube.git</span><br><span class="line">~$ <span class="built_in">cd</span> minikube &amp;&amp; <span class="keyword">for</span> item <span class="keyword">in</span> `grep  -l <span class="string">"k8s.gcr.io"</span> -r *`;<span class="keyword">do</span> sed -i <span class="string">"s#k8s.gcr.io#registry.cn-hangzhou.aliyuncs.com/google_containers#g"</span> <span class="variable">$item</span>  ;<span class="keyword">done</span></span><br><span class="line">~$ make</span><br><span class="line">~$ sudo cp out/minikube-linux-amd64 /usr/<span class="built_in">local</span>/bin/minikube</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç»¼ä¸Šæ‰€è¿°,å› ä¸ºä½¿ç”¨<code>docker tag</code>è¿˜æ˜¯æœ‰é—®é¢˜,æºç æ„å»ºçš„<code>Minikube</code>å¯ä»¥å®Œç¾è§£å†³å¢™çš„é—®é¢˜,å¦‚æœå»ç½‘ä¸Šä¸‹è½½ç¬¬ä¸‰æ–¹çš„<code>Minikube</code>äºŒè¿›åˆ¶æ€•æœ‰å¤¹å¸¦ç§è´§çš„é—®é¢˜.</p>
</li>
</ul>
<h2 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âŒ›  Waiting <span class="keyword">for</span> pods: apiserver proxyğŸ’£  Error restarting cluster: <span class="built_in">wait</span>: waiting <span class="keyword">for</span> k8s-app=kube-proxy: timed out waiting <span class="keyword">for</span> the condition</span><br><span class="line"></span><br><span class="line">ğŸ˜¿  Sorry that minikube crashed. If this was unexpected, we would love to hear from you:</span><br><span class="line">ğŸ‘‰  https://github.com/kubernetes/minikube/issues/new</span><br></pre></td></tr></table></figure>
<h1 id="æ‰‹åŠ¨å¸ƒç½²å®‰è£…Kubernetesç»„ä»¶"><a href="#æ‰‹åŠ¨å¸ƒç½²å®‰è£…Kubernetesç»„ä»¶" class="headerlink" title="æ‰‹åŠ¨å¸ƒç½²å®‰è£…Kubernetesç»„ä»¶"></a>æ‰‹åŠ¨å¸ƒç½²å®‰è£…<code>Kubernetes</code>ç»„ä»¶</h1><ul>
<li>Links:<ul>
<li><a href="https://kubernetes.io/docs/setup/independent/install-kubeadm/" target="_blank" rel="noopener">Installing kubeadm</a></li>
<li><a href="https://yq.aliyun.com/teams/11/type_blog-cid_200-page_1" target="_blank" rel="noopener">é˜¿é‡Œäº‘â€“å®¹å™¨æœåŠ¡ Docker&amp;Kubernetes å®¹å™¨æœåŠ¡ Docker&amp;Kubernetes</a></li>
<li><a href="https://ieevee.com/tech/2018/09/01/kubeadm.html" target="_blank" rel="noopener">å¢™å†…å®‰è£… kubernetes æ•™ç¨‹</a></li>
<li><a href="http://mirrors.ustc.edu.cn/" target="_blank" rel="noopener">ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å¼€æºè½¯ä»¶é•œåƒ</a></li>
</ul>
</li>
</ul>
<h2 id="Debian-Ubuntuå‘è¡Œç‰ˆå®‰è£…kubeadm"><a href="#Debian-Ubuntuå‘è¡Œç‰ˆå®‰è£…kubeadm" class="headerlink" title="Debian,Ubuntuå‘è¡Œç‰ˆå®‰è£…kubeadm"></a><code>Debian,Ubuntu</code>å‘è¡Œç‰ˆå®‰è£…<code>kubeadm</code></h2><ul>
<li>kubeadm: the command to bootstrap the cluster.</li>
<li>kubelet: the component that runs on all of the machines in your cluster and does things like starting pods and containers.</li>
<li>kubectl: the command line util to talk to your cluster.</li>
<li>ä¸­æ–‡<ul>
<li><code>kubeadm</code>: ç”¨æ¥åˆå§‹åŒ–é›†ç¾¤çš„æŒ‡ä»¤.</li>
<li><code>kubelet</code>: åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨<code>Pod</code>å’Œ<code>container</code>ç­‰.</li>
<li><code>kubectl</code>: ç”¨æ¥ä¸é›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·.</li>
</ul>
</li>
<li>è¿™ä¸‰ä¸ªç»„ä»¶çš„å®‰è£…æ—¶å€™è¦æ³¨æ„å®ƒä»¬ä¹‹é—´çš„ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜.</li>
</ul>
<h3 id="å®˜æ–¹è½¯ä»¶ä»“åº“-åœ¨å›½å†…ä¸èƒ½ä½¿ç”¨"><a href="#å®˜æ–¹è½¯ä»¶ä»“åº“-åœ¨å›½å†…ä¸èƒ½ä½¿ç”¨" class="headerlink" title="å®˜æ–¹è½¯ä»¶ä»“åº“,åœ¨å›½å†…ä¸èƒ½ä½¿ç”¨"></a>å®˜æ–¹è½¯ä»¶ä»“åº“,åœ¨å›½å†…ä¸èƒ½ä½¿ç”¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~$ apt-get update &amp;&amp; apt-get install -y apt-transport-https curl dirmngr</span><br><span class="line">~$ curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -</span><br><span class="line"><span class="comment"># æˆ–è€…ç”¨å¦‚ä¸‹çš„æ–¹å¼å®‰è£…å…¬é’¥,éœ€è¦ä¾èµ–å®‰è£…dirmngr</span></span><br><span class="line">~$ sudo apt-key  adv --keyserver  keyserver.ubuntu.com --recv-keys  6A030B21BA07F4FB</span><br><span class="line">~$ sudo bash -c <span class="string">"cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span></span><br><span class="line"><span class="string">    deb https://apt.kubernetes.io/ kubernetes-xenial main</span></span><br><span class="line"><span class="string">    EOF"</span></span><br><span class="line"><span class="comment"># ç»æµ‹è¯• apt.kubernetes.io é‡å®šå‘åˆ°k8s.ioä¸èƒ½è®¿é—®,å¯ä»¥ä½¿ç”¨å›½å†…é•œåƒ http://mirrors.ustc.edu.cn/kubernetes/</span></span><br><span class="line">~$ apt-get update</span><br><span class="line">~$ apt-get install -y kubelet kubeadm kubectl</span><br><span class="line">~$ apt-mark hold kubelet kubeadm kubectl</span><br></pre></td></tr></table></figure>
<h3 id="é˜¿é‡Œäº‘é•œåƒä»“åº“"><a href="#é˜¿é‡Œäº‘é•œåƒä»“åº“" class="headerlink" title="é˜¿é‡Œäº‘é•œåƒä»“åº“"></a>é˜¿é‡Œäº‘é•œåƒä»“åº“</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ apt-get update &amp;&amp; apt-get install -y apt-transport-https</span><br><span class="line">~$ curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add -</span><br><span class="line">~$ sudo bash -c <span class="string">"cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span></span><br><span class="line"><span class="string">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main</span></span><br><span class="line"><span class="string">EOF"</span></span><br><span class="line">~$ sudo apt-get update &amp;&amp; sudo apt-get install kubelet kubeadm kubectl -y</span><br><span class="line">~$ sudo apt-mark hold kubelet kubeadm kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨curlä¸‹è½½äºŒè¿›åˆ¶ ,è¦ç”¨ä»£ç†.</span></span><br><span class="line">~$ curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/darwin/amd64/kubectl</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥è¯¢å½“å‰ç‰ˆæœ¬éœ€è¦é‚£äº›<code>docker image</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ kubeadm config images list --kubernetes-version v1.14.0</span><br><span class="line">k8s.gcr.io/kube-apiserver:v1.14.0</span><br><span class="line">k8s.gcr.io/kube-controller-manager:v1.14.0</span><br><span class="line">k8s.gcr.io/kube-scheduler:v1.14.0</span><br><span class="line">k8s.gcr.io/kube-proxy:v1.14.0</span><br><span class="line">k8s.gcr.io/pause:3.1</span><br><span class="line">k8s.gcr.io/etcd:3.3.10</span><br><span class="line">k8s.gcr.io/coredns:1.3.1</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…MasterèŠ‚ç‚¹"><a href="#å®‰è£…MasterèŠ‚ç‚¹" class="headerlink" title="å®‰è£…MasterèŠ‚ç‚¹"></a>å®‰è£…<code>Master</code>èŠ‚ç‚¹</h3><h4 id="ç½‘ç»œæ¨¡å‹"><a href="#ç½‘ç»œæ¨¡å‹" class="headerlink" title="ç½‘ç»œæ¨¡å‹"></a>ç½‘ç»œæ¨¡å‹</h4><ul>
<li>ç›®å‰<code>Kubernetes</code>æ”¯æŒå¤šç§ç½‘ç»œæ–¹æ¡ˆ,å¦‚: <code>Flannel,Canal,Weave Net,Calico</code>ç­‰.å®ƒéƒ½æ˜¯å®ç°äº†<code>CNI</code>çš„è§„èŒƒ.<br>ä¸‹é¢ä»¥å®‰è£…<a href="https://docs.projectcalico.org/v3.6/getting-started/kubernetes/" target="_blank" rel="noopener"><code>Canal</code></a>ä¸ºç¤ºä¾‹.å…¶å®ƒå„å®‰è£…<a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/" target="_blank" rel="noopener">å‚è€ƒè¿™é‡Œçš„ Installing a<code>Pod</code>network add-on éƒ¨åˆ†</a>,<a href="https://kubernetes.io/zh/docs/setup/independent/create-cluster-kubeadm/" target="_blank" rel="noopener">ä¸­æ–‡æ–‡æ¡£</a>,åœ¨<code>kubeadm init</code>æ˜¯å¿…é¡»è¦æŒ‡å®šä¸€ä¸ªç½‘ç»œ,ä¸ç„¶ä¼šå‡ºç°å…¶å®ƒé—®é¢˜.æ ¹æ®ä¸Šè¿°é“¾æ¥æŒ‡å¯¼å¦‚:<ul>
<li><code>Calico ç½‘ç»œæ¨¡å‹</code>:<code>kubeadm init --pod-network-cidr=192.168.0.0/16</code>,å®ƒåªå·¥åœ¨<code>amd64</code>,<code>arm64</code>,<code>ppc64le</code>ä¸‰ä¸ªå¹³å°.</li>
<li><code>Flannel ç½‘ç»œæ¨¡å‹</code>:<code>kubeadm init --pod-network-cidr=10.244.0.0/16</code>,å¹¶ä¿®æ”¹å†…æ ¸å‚æ•°<br><code>sysctl net.bridge.bridge-nf-call-iptables=1</code>,å·¥ä½œåœ¨Linuxçš„<code>amd64,arm,arm64,ppc64le,s390x</code></li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl apply -f \</span><br><span class="line">https://docs.projectcalico.org/v3.6/getting-started/kubernetes/installation/hosted/kubernetes-datastore/calico-networking/1.7/calico.yaml</span><br><span class="line">configmap/calico-config created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org created</span><br><span class="line">[...]</span><br><span class="line">serviceaccount/calico-kube-controllers created</span><br></pre></td></tr></table></figure>
<ul>
<li>å®‰è£…<code>Master</code>èŠ‚ç‚¹,æ³¨æ„åœ¨å›½å†…å¿…é¡»æŒ‡å®š<code>--image-repository</code>,é»˜è®¤çš„<code>k8s.gcr.io</code>æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®çš„,è¿˜æœ‰<code>--kubernetes-version</code>å¿…é¡»ä¸<code>kubelet</code>çš„ç»„ä»¶ç‰ˆæœ¬åŒ¹é….</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo kubeadm init --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers  --kubernetes-version v1.14.0 --pod-network-cidr=10.244.0.0/16</span><br><span class="line">[init] Using Kubernetes version: v1.14.0</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">	[WARNING IsDockerSystemdCheck]: detected <span class="string">"cgroupfs"</span> as the Docker cgroup driver. The recommended driver is <span class="string">"systemd"</span>. Please follow the guide at https://kubernetes.io/docs/setup/cri/</span><br><span class="line">[preflight] Pulling images required <span class="keyword">for</span> setting up a Kubernetes cluster</span><br><span class="line">[preflight] This might take a minute or two, depending on the speed of your internet connection</span><br><span class="line">[preflight] You can also perform this action <span class="keyword">in</span> beforehand using <span class="string">'kubeadm config images pull'</span></span><br><span class="line">[...]</span><br><span class="line"><span class="comment"># å®‰è£…æˆåŠŸå,æ³¨æ„ä¸‹é¢æç¤ºçš„æ“ä½œé¡¹æµç¨‹ä¾æ¬¡è¿›è¡Œ.</span></span><br><span class="line">[addons] Applied essential addon: CoreDNS</span><br><span class="line">[addons] Applied essential addon: kube-proxy</span><br><span class="line"></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a`Pod`network to the cluster.</span><br><span class="line">Run <span class="string">"kubectl apply -f [podnetwork].yaml"</span> with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm join 172.18.127.186:6443 --token z8r97j.3ovdfddb6df9lnq7 \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:07767a67fa6c38feda7471ee5e1a15a0a9c417cfdf6cf457ff577297f22d9415</span><br></pre></td></tr></table></figure>
<ul>
<li><p>æ ¹æ®<code>kubeadm init</code>çš„å‚æ•°,å®‰è£…<code>Flannelç½‘ç»œæ’ä»¶</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/a70459be0084506e4ec919aa1c114638878db11b/Documentation/kube-flannel.yml</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/flannel created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/flannel created</span><br><span class="line">serviceaccount/flannel created</span><br><span class="line">configmap/kube-flannel-cfg created</span><br><span class="line">daemonset.extensions/kube-flannel-ds-amd64 created</span><br><span class="line">daemonset.extensions/kube-flannel-ds-arm64 created</span><br><span class="line">daemonset.extensions/kube-flannel-ds-arm created</span><br><span class="line">daemonset.extensions/kube-flannel-ds-ppc64le created</span><br><span class="line">daemonset.extensions/kube-flannel-ds-s390x created</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŒ‰ç…§ä¸Šè¿°å®‰è£…æˆåŠŸåçš„æç¤º,é…ç½®<code>Master</code>èŠ‚ç‚¹ä¿¡æ¯.å¹¶å®‰è£…ç½‘ç»œæ’ä»¶è¯·<a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/" target="_blank" rel="noopener">å‚è€ƒè¿™é‡Œ</a>.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">~$ sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">~$ sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹token</span></span><br><span class="line">~$ kubeadm token list</span><br><span class="line">TOKEN                     TTL       EXPIRES                     USAGES                   DESCRIPTION                                                EXTRA GROUPS</span><br><span class="line">5smm64.9zpyhaqxghohh6b2   23h       2019-04-20T14:45:14+08:00   authentication,signing   The default bootstrap token generated by <span class="string">'kubeadm init'</span>.   system:bootstrappers:kubeadm:default-node-token</span><br></pre></td></tr></table></figure>
<h4 id="ä¿®æ”¹Kubeletçš„å¯åŠ¨å‚æ•°"><a href="#ä¿®æ”¹Kubeletçš„å¯åŠ¨å‚æ•°" class="headerlink" title="ä¿®æ”¹Kubeletçš„å¯åŠ¨å‚æ•°"></a>ä¿®æ”¹<code>Kubelet</code>çš„å¯åŠ¨å‚æ•°</h4><ul>
<li><code>kubelet</code>ç»„ä»¶æ˜¯é€šè¿‡<code>systemctl</code>æ¥ç®¡ç†çš„,å› æ­¤å¯ä»¥åœ¨æ¯ä¸ªèŠ‚ç‚¹é‡Œçš„<code>/etc/systemed/system</code>æ‰¾åˆ°å®ƒçš„é…ç½®æ–‡ä»¶.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~<span class="comment"># cat /etc/systemd/system/kubelet.service.d/10-kubeadm.conf</span></span><br><span class="line"><span class="comment"># Note: This dropin only works with kubeadm and kubelet v1.11+</span></span><br><span class="line">[Service]</span><br><span class="line">Environment=<span class="string">"KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf"</span></span><br><span class="line">Environment=<span class="string">"KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml"</span></span><br><span class="line"><span class="comment"># This is a file that "kubeadm init" and "kubeadm join" generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically</span></span><br><span class="line">EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env</span><br><span class="line"><span class="comment"># This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use</span></span><br><span class="line"><span class="comment"># the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.</span></span><br><span class="line">EnvironmentFile=-/etc/default/kubelet</span><br><span class="line">ExecStart=</span><br><span class="line">ExecStart=/usr/bin/kubelet <span class="variable">$KUBELET_KUBECONFIG_ARGS</span> <span class="variable">$KUBELET_CONFIG_ARGS</span> <span class="variable">$KUBELET_KUBEADM_ARGS</span> <span class="variable">$KUBELET_EXTRA_ARGS</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å®‰è£…é›†ç¾¤èŠ‚ç‚¹"><a href="#å®‰è£…é›†ç¾¤èŠ‚ç‚¹" class="headerlink" title="å®‰è£…é›†ç¾¤èŠ‚ç‚¹"></a>å®‰è£…é›†ç¾¤èŠ‚ç‚¹</h3><ul>
<li><p>åœ¨å¦ä¸€ä¸ªæœºå™¨é‡Œå®‰è£…ä¸Šè¿°çš„ä¸‰ä¸ªç»„ä»¶,å°±å¯ä»¥è¿è¡Œä¸‹é¢å‘½ä»¤åŠ å…¥<code>k8s</code>é›†ç¾¤ç®¡ç†äº†.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo kubeadm join 172.18.127.186:6443 --token z8r97j.3ovdfddb6df9lnq7     --discovery-token-ca-cert-hash sha256:07767a67fa6c38feda7471ee5e1a15a0a9c417cfdf6cf457ff577297f22d9415</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">	[WARNING IsDockerSystemdCheck]: detected <span class="string">"cgroupfs"</span> as the Docker cgroup driver. The recommended driver is <span class="string">"systemd"</span>. Please follow the guide at https://kubernetes.io/docs/setup/cri/</span><br><span class="line">[preflight] Reading configuration from the cluster...</span><br><span class="line">[preflight] FYI: You can look at this config file with <span class="string">'kubectl -n kube-system get cm kubeadm-config -oyaml'</span></span><br><span class="line">[kubelet-start] Downloading configuration <span class="keyword">for</span> the kubelet from the <span class="string">"kubelet-config-1.14"</span> ConfigMap <span class="keyword">in</span> the kube-system namespace</span><br><span class="line">[kubelet-start] Writing kubelet configuration to file <span class="string">"/var/lib/kubelet/config.yaml"</span></span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file <span class="string">"/var/lib/kubelet/kubeadm-flags.env"</span></span><br><span class="line">[kubelet-start] Activating the kubelet service</span><br><span class="line">[kubelet-start] Waiting <span class="keyword">for</span> the kubelet to perform the TLS Bootstrap...</span><br><span class="line"></span><br><span class="line">This node has joined the cluster:</span><br><span class="line">* Certificate signing request was sent to apiserver and a response was received.</span><br><span class="line">* The Kubelet was informed of the new secure connection details.</span><br><span class="line"></span><br><span class="line">Run <span class="string">'kubectl get nodes'</span> on the control-plane to see this node join the cluster.</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨ Master èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹æ•°.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl  get node</span><br><span class="line">NAME             STATUS   ROLES    AGE    VERSION</span><br><span class="line">aliyun-machine   Ready    master   110m   v1.14.0</span><br><span class="line">dig001           Ready    &lt;none&gt;   84m    v1.14.0</span><br><span class="line">fe001            Ready    &lt;none&gt;   2m8s   v1.14.0</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥çœ‹é›†ç¾¤çš„è¦å®Œæ•´æ¶æ„,Master ä¸Šä¹Ÿå¯ä»¥è¿è¡Œåº”ç”¨,å³ Master åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ª Node.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get pod --all-namespaces -o wide</span><br><span class="line">NAMESPACE     NAME                                 READY   STATUS    RESTARTS   AGE     IP               NODE         NOMINATED NODE   READINESS GATES</span><br><span class="line">kube-system   coredns-d5947d4b-sr5zt               1/1     Running   0          6m3s    10.244.0.6       k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   coredns-d5947d4b-tznh2               1/1     Running   0          6m3s    10.244.0.5       k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   etcd-k8s-master                      1/1     Running   0          5m11s   172.18.127.186   k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-apiserver-k8s-master            1/1     Running   0          5m15s   172.18.127.186   k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-controller-manager-k8s-master   1/1     Running   0          5m13s   172.18.127.186   k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-flannel-ds-amd64-9d965          1/1     Running   0          5m17s   172.18.127.186   k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-flannel-ds-amd64-c8dkh          1/1     Running   0          38s     172.18.192.76    dig001       &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-flannel-ds-amd64-kswj2          1/1     Running   0          52s     172.18.253.222   fe001        &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-proxy-5g9vp                     1/1     Running   0          38s     172.18.192.76    dig001       &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-proxy-cqzfl                     1/1     Running   0          52s     172.18.253.222   fe001        &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-proxy-pjbbg                     1/1     Running   0          6m3s    172.18.127.186   k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-scheduler-k8s-master            1/1     Running   0          5m19s   172.18.127.186   k8s-master   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>è·å–Podçš„å®Œæ•´ä¿¡æ¯<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get pod &lt;podname&gt; --output json   <span class="comment"># ç”¨JSONæ ¼å¼æ˜¾ç¤ºPodçš„å®Œæ•´ä¿¡æ¯</span></span><br><span class="line">~$ kubectl get pod &lt;podname&gt; --output yaml   <span class="comment"># ç”¨YAMLæ ¼å¼æ˜¾ç¤ºPodçš„å®Œæ•´ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="æ‹†é™¤k8sé›†ç¾¤"><a href="#æ‹†é™¤k8sé›†ç¾¤" class="headerlink" title="æ‹†é™¤k8sé›†ç¾¤"></a>æ‹†é™¤<code>k8s</code>é›†ç¾¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl drain &lt;node name&gt; --delete-local-data --force --ignore-daemonsets</span><br><span class="line">~$ kubectl delete node &lt;node name&gt;</span><br><span class="line">~$ kubeadm reset</span><br></pre></td></tr></table></figure>
<h1 id="å®‰è£…HelloWorldå…±äº«Podæ•°æ®"><a href="#å®‰è£…HelloWorldå…±äº«Podæ•°æ®" class="headerlink" title="å®‰è£…HelloWorldå…±äº«Podæ•°æ®"></a>å®‰è£…<code>HelloWorld</code>å…±äº«<code>Pod</code>æ•°æ®</h1><ul>
<li><a href="https://kubernetes.io/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/" target="_blank" rel="noopener">Communicate Between Containers in the Same Pod Using a Shared Volume</a></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> <span class="comment">#  for k8s versions before 1.9.0 use apps/v1beta2  and before 1.8.0 use extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hello-world</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">write</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">debian:latest</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">["bash","-c","echo</span> <span class="string">\"Hello</span> <span class="string">World\"</span> <span class="string">&gt;&gt;</span> <span class="string">/data/hello"]</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">read</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">debian:latest</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">["bash","-c","sleep</span> <span class="number">10</span><span class="string">;</span> <span class="string">cat</span> <span class="string">/data/hello"]</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/tmp</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl apply -f hello-world.yaml</span><br></pre></td></tr></table></figure>
<h2 id="é€šè¿‡Githubå®‰è£…Kubernetes"><a href="#é€šè¿‡Githubå®‰è£…Kubernetes" class="headerlink" title="é€šè¿‡Githubå®‰è£…Kubernetes"></a>é€šè¿‡<code>Github</code>å®‰è£…<code>Kubernetes</code></h2><h3 id="Etcd"><a href="#Etcd" class="headerlink" title="Etcd"></a><code>Etcd</code></h3><ul>
<li><a href="https://github.com/etcd-io/etcd" target="_blank" rel="noopener">CoreOS Etcd</a></li>
<li>ä»<a href="https://github.com/etcd-io/etcd/releases/download/v3.3.12/etcd-v3.3.12-linux-amd64.tar.gz" target="_blank" rel="noopener">Github ä¸‹è½½</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ wget -c https://github.com/etcd-io/etcd/releases/download/v3.3.12/etcd-v3.3.12-linux-amd64.tar.gz</span><br><span class="line">~$ tar zxvf etcd-v3.3.12-linux-amd64.tar.gz</span><br><span class="line">~$ <span class="built_in">cd</span> etcd-v3.3.12-linux-amd64 &amp;&amp; sudo cp &#123;etcd,etcdctl&#125; /usr/<span class="built_in">local</span>/bin</span><br></pre></td></tr></table></figure>
<ul>
<li><p>è¿è¡Œ<code>Etcd</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ etcd -name etcd --data-dir /var/lib/etcd -listen-client-urls http://0.0.0.0:2379,http://0.0.0.0:4001 \</span><br><span class="line">-advertise-client-urls http://0.0.0.0:2379,http://0.0.0.0:4001 &gt;&gt; /var/<span class="built_in">log</span>/etcd.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥è¯¢å®ƒçš„å»ºåº·çŠ¶æ€</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ etcdctl  -C http://127.0.0.1:4001 cluster-healthmember 8e9e05c52164694d is healthy: got healthy result from http://0.0.0.0:2379</span><br><span class="line">cluster is healthy</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Kuberneteså‘å¸ƒåŒ…å®‰è£…"><a href="#Kuberneteså‘å¸ƒåŒ…å®‰è£…" class="headerlink" title="Kuberneteså‘å¸ƒåŒ…å®‰è£…"></a><code>Kubernetes</code>å‘å¸ƒåŒ…å®‰è£…</h3><ul>
<li><a href="https://github.com/kubernetes/kubernetes/" target="_blank" rel="noopener">Kubernetes</a></li>
<li><p>é€šè¿‡<a href="https://github.com/kubernetes/kubernetes/releases/download/v1.14.0/kubernetes.tar.gz" target="_blank" rel="noopener">github ä¸‹è½½</a>æœ€æ–°çš„ç‰ˆæœ¬.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">~$ wget -c https://github.com/kubernetes/kubernetes/releases/download/v1.14.0/kubernetes.tar.gz</span><br><span class="line">~$ tar xvf kubernetes.tar.gz &amp;&amp; <span class="built_in">cd</span> kubernetes</span><br><span class="line">~$ tree -L 1</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ client</span><br><span class="line">â”œâ”€â”€ cluster</span><br><span class="line">â”œâ”€â”€ docs</span><br><span class="line">â”œâ”€â”€ hack</span><br><span class="line">â”œâ”€â”€ LICENSES</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ server</span><br><span class="line">â””â”€â”€ version</span><br><span class="line"></span><br><span class="line">$ cat server/README</span><br><span class="line">Server binary tarballs are no longer included <span class="keyword">in</span> the Kubernetes final tarball.</span><br><span class="line"></span><br><span class="line">Run cluster/get-kube-binaries.sh to download client and server binaries.</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ ¹æ®ä¸Šé¢çš„<code>README</code>æç¤º,æœåŠ¡ç«¯çš„ç»„ä»¶æ²¡æœ‰åŒ…å«åœ¨ä¸Šé¢çš„å‹ç¼©åŒ…,è€Œæ˜¯è¦é€šè¿‡è¿è¡Œ<code>cluster/get-kube-binaries.sh</code>ä»<code>https://dl.k8s.io/v1.14.0</code>ä¸‹è½½.ä½†æ˜¯<code>dl.k8s.io</code>åœ¨å›½å†…æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®çš„.</p>
</li>
</ul>
<h1 id="å®‰è£…MinioæœåŠ¡-å•èŠ‚ç‚¹æœåŠ¡"><a href="#å®‰è£…MinioæœåŠ¡-å•èŠ‚ç‚¹æœåŠ¡" class="headerlink" title="å®‰è£…MinioæœåŠ¡(å•èŠ‚ç‚¹æœåŠ¡)"></a>å®‰è£…<code>Minio</code>æœåŠ¡(å•èŠ‚ç‚¹æœåŠ¡)</h1><ul>
<li>é“¾æ¥:<ul>
<li><a href="https://github.com/minio/minio" target="_blank" rel="noopener">Github MinIO</a></li>
<li><a href="https://docs.min.io/cn/" target="_blank" rel="noopener">MinIO Quickstart Guideæ–‡æ¡£</a></li>
<li><a href="https://github.com/kubernetes/examples/tree/master/staging/storage/minio" target="_blank" rel="noopener">Cloud Native Deployment of Minio using Kubernetes</a></li>
<li><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/" target="_blank" rel="noopener">Configure a Pod to Use a PersistentVolume for Storage</a></li>
<li><a href="https://docs.min.io/cn/deploy-minio-on-kubernetes.html" target="_blank" rel="noopener">MinIOä¸­æ–‡æ‰‹å†Œ</a></li>
</ul>
</li>
<li><code>MinIO</code>æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„<code>Kubernetes</code>ä¸‹åŸç”Ÿçš„å¯¹åƒå­˜å‚¨,å®ƒçš„<code>API</code>åŒæ ·å…¼å®¹<code>Amazon S3</code>äº‘å­˜å‚¨æœåŠ¡.ä¸‹é¢ä½¿ç”¨<code>kubectl</code>ç›´æ¥æŒ‰è£…<code>Minio</code>æ˜¯å‚ç…§<a href="https://docs.min.io/docs/deploy-minio-on-kubernetes.html" target="_blank" rel="noopener"><code>Deploy MinIO on Kubernetes</code></a>,ä¸‹é¢ä¹Ÿå¯ä»¥ä½¿ç”¨<code>Helm</code>å®‰è£…å®ƒ.</li>
<li><p>å¿«é€Ÿè¿è¡Œå•èŠ‚ç‚¹æœåŠ¡, ä¸‹é¢è¿è¡ŒæˆåŠŸ,åå¯ä»¥æ‰“å¼€<code>http://127.0.0.1:9000</code>,ä½¿ç”¨<code>minioadmin:minioadmin</code>ç™»å½•åˆ°æ§åˆ¶å°.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ podman run -p 9000:9000 -p 9001:9001 \</span><br><span class="line">  quay.io/minio/minio server /data --console-address <span class="string">":9001"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æˆ–è€…ç»‘å®šä¸€ä¸ªæœ¬æœºç›®å½•<code>minio_data</code>åˆ°å®¹å™¨å†…å».</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ podman run -v `<span class="built_in">pwd</span>`/minio_data:/data -p 9000:9000 -p 9001:9001 \</span><br><span class="line">  quay.io/minio/minio server /data --console-address <span class="string">":9001"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="MinIOæœåŠ¡ç«¯"><a href="#MinIOæœåŠ¡ç«¯" class="headerlink" title="MinIOæœåŠ¡ç«¯"></a><code>MinIO</code>æœåŠ¡ç«¯</h2><h3 id="åˆ›å»ºPV-Persistent-Volume"><a href="#åˆ›å»ºPV-Persistent-Volume" class="headerlink" title="åˆ›å»ºPV (Persistent Volume)"></a>åˆ›å»º<code>PV (Persistent Volume)</code></h3><ul>
<li>åœ¨<code>Kubernetes</code>ç¯å¢ƒä¸­,å¯ä»¥ä½¿ç”¨<a href="https://github.com/minio/operator" target="_blank" rel="noopener">MinIO Kubernetes Operator</a></li>
<li>ä¸‹é¢æ˜¯ä¸€ä¸ªèµ„æºæè¿°æ–‡ä»¶,åˆ›å»ºä¸€ä¸ª10Gå¤§å°çš„,æœ¬åœ°ç±»å‹çš„<code>PV</code>. <code>PV</code>å¯ä»¥ç†è§£æˆ<code>k8s</code>é›†ç¾¤ä¸­çš„æŸä¸ªç½‘ç»œå­˜å‚¨ä¸­å¯¹åº”çš„ä¸€å—å­˜å‚¨,å®ƒä¸<code>Voleme</code>å¾ˆç±»ä¼¼.<code>PV</code>åªèƒ½æ˜¯ç½‘ç»œå­˜å‚¨,ä¸å±äºä»»ä½•çš„<code>Node</code>,ä½†å¯ä»¥åœ¨æ¯ä¸ª<code>Node</code>ä¸Šè®¿é—®å®ƒ.<code>PV</code>å¹¶ä¸æ˜¯å®šä¹‰åœ¨<code>Pod</code>ä¸Šçš„,è€Œæ˜¯ç‹¬ç«‹äº<code>Pod</code>ä¹‹å¤–çš„å®šä¹‰.<code>PV</code>ç›®å‰æ”¯æŒçš„ç±»å‹åŒ…æ‹¬:<ul>
<li>GCEPersistentDisk,</li>
<li>AWSElasticBlockStore,</li>
<li>AzureFile,FC(Fibre Channel),</li>
<li>NFS,</li>
<li>iSCSI,</li>
<li>RBD(Rados Block Device),</li>
<li>CephFS,</li>
<li>GlusterFS,</li>
<li>HostPath(ä»…ä¾›å•æœºæµ‹è¯•)ç­‰ç­‰.</li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~$ cat pv.yaml</span><br><span class="line"></span><br><span class="line">kind: PersistentVolume</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: task-pv-volume</span><br><span class="line">  labels:</span><br><span class="line">    <span class="built_in">type</span>: <span class="built_in">local</span></span><br><span class="line">spec:</span><br><span class="line">  storageClassName: standard</span><br><span class="line">  capacity:</span><br><span class="line">    storage: 10Gi</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  hostPath:</span><br><span class="line">    path: <span class="string">"/tmp/data"</span></span><br><span class="line"></span><br><span class="line">~$ kubectl create -f pv.yaml</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…Minio-PVC-Persistent-Volume-Claim"><a href="#å®‰è£…Minio-PVC-Persistent-Volume-Claim" class="headerlink" title="å®‰è£…Minio PVC (Persistent Volume Claim)"></a>å®‰è£…<code>Minio PVC (Persistent Volume Claim)</code></h3><ul>
<li><code>PVC</code>æŒ‡å®šæ‰€éœ€è¦çš„å­˜å‚¨å¤§å°,ç„¶å<code>k8s</code>ä¼šé€‰æ‹©æ»¡è¶³æ¡ä»¶çš„PVè¿›è¡Œç»‘å®š,å¦‚æœ<code>PVC</code>åˆ›å»ºä¹‹åæ²¡ç»‘å®šåˆ°PV,å°±ä¼šå‡ºç°<code>Pending</code>çš„é”™è¯¯,æ‰€ä»¥è¦æŒ‰ç…§<code>PV-&gt;PVC-&gt;Deployment-&gt;Service</code>è¿™ä¸ªé¡ºåºæ¥è¯•éªŒ.<code>PVC</code>çš„å‡ ç§çŠ¶æ€æœ‰:<ul>
<li>Available: ç©ºé—²çŠ¶æ€</li>
<li>Bound: å·²ç»ç»‘å®šåˆ°æŸä¸ªPVCä¸Š.</li>
<li>Released: å¯¹åº”çš„PVCå·²ç»åˆ é™¤,ä½†èµ„æºè¿˜æ²¡æœ‰è¢«é›†ç¾¤æ”¶å›.</li>
<li>Failed: PV è‡ªåŠ¨å›æ”¶å¤±è´¥.</li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl create -f https://github.com/minio/minio/blob/master/docs/orchestration/kubernetes/minio-standalone-pvc.yaml?raw=<span class="literal">true</span></span><br><span class="line">persistentvolumeclaim/minio-pv-claim created</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ä¹Ÿå¯ä»¥æŠŠä¸Šé¢è¿™ä¸ªé“¾æ¥çš„æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°,ä¿®æ”¹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$ cat minio-pvc.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  <span class="comment"># This name uniquely identifies the PVC. This is used in deployment.</span></span><br><span class="line">  name: minio-pv-claim</span><br><span class="line">spec:</span><br><span class="line">  <span class="comment"># Read more about access modes here: http://kubernetes.io/docs/user-guide/persistent-volumes/#access-modes</span></span><br><span class="line">  storageClassName: standard</span><br><span class="line">  accessModes:</span><br><span class="line">    <span class="comment"># The volume is mounted as read-write by a single node</span></span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  resources:</span><br><span class="line">    <span class="comment"># This is the request for storage. Should be available in the cluster.</span></span><br><span class="line">    requests:</span><br><span class="line">      storage: 10Gi</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹ç³»ç»Ÿä¸­çš„<code>PVC</code>çŠ¶æ€,ä¸‹é¢æ˜¾ç¤ºçŠ¶æ€æ˜¯<code>Pending</code>,ä½¿ç”¨<code>describe</code>æŸ¥çœ‹å®ƒçš„è¯¦æƒ….</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get pvc  --namespace default</span><br><span class="line">NAME             STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">minio-pv-claim   Pending</span><br><span class="line">~$ kubectl get pvc  --namespace default</span><br><span class="line">NAME             STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">minio-pv-claim   Pending                                                     2m22s</span><br><span class="line">lcy@k8s-master:~$ kubectl describe pvc minio-pv-claim</span><br><span class="line">Name:          minio-pv-claim</span><br><span class="line">Namespace:     default</span><br><span class="line">StorageClass:</span><br><span class="line">Status:        Pending</span><br><span class="line">Volume:</span><br><span class="line">Labels:        &lt;none&gt;</span><br><span class="line">Annotations:   &lt;none&gt;</span><br><span class="line">Finalizers:    [kubernetes.io/pvc-protection]</span><br><span class="line">Capacity:</span><br><span class="line">Access Modes:</span><br><span class="line">VolumeMode:    Filesystem</span><br><span class="line">Events:</span><br><span class="line">  Type       Reason         Age                 From                         Message</span><br><span class="line">  ----       ------         ----                ----                         -------</span><br><span class="line">  Normal     FailedBinding  4s (x14 over 3m2s)  persistentvolume-controller  no persistent volumes available <span class="keyword">for</span> this claim and no storage class is <span class="built_in">set</span></span><br><span class="line">Mounted By:  minio-6d4d48db87-wxr4d</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ ¹æ®ä¸Šé¢<code>Events</code>æ˜¾ç¤ºé”™è¯¯å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FailedBinding  4s (x14 over 3m2s)  persistentvolume-controller  no persistent volumes available <span class="keyword">for</span> this claim and no storage class is <span class="built_in">set</span>`</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿™å°±æ˜¯å®ƒä¸ºä»€ä¹ˆ<code>Pending</code>çš„åŸå› .ç»§ç»­ä¸‹ä¸€æ­¥,å¤„ç†è¿™äº›ä¾èµ–çš„é”™è¯¯.</p>
</li>
</ul>
<h3 id="å®‰è£…Minio-Deployment"><a href="#å®‰è£…Minio-Deployment" class="headerlink" title="å®‰è£…Minio Deployment"></a>å®‰è£…<code>Minio Deployment</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl create -f https://github.com/minio/minio/blob/master/docs/orchestration/kubernetes/minio-standalone-deployment.yaml?raw=<span class="literal">true</span></span><br><span class="line">deployment.extensions/minio created</span><br><span class="line"></span><br><span class="line">~$ cat minio-standalone-deployment.yaml</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  <span class="comment"># This name uniquely identifies the Deployment</span></span><br><span class="line">  name: minio</span><br><span class="line">spec:</span><br><span class="line">  strategy:</span><br><span class="line">    <span class="comment"># Specifies the strategy used to replace old Pods by new ones</span></span><br><span class="line">    <span class="comment"># Refer: https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy</span></span><br><span class="line">    <span class="built_in">type</span>: Recreate</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        <span class="comment"># This label is used as a selector in Service definition</span></span><br><span class="line">        app: minio</span><br><span class="line">    spec:</span><br><span class="line">      <span class="comment"># Volumes used by this deployment</span></span><br><span class="line">      volumes:</span><br><span class="line">      - name: data</span><br><span class="line">        <span class="comment"># This volume is based on PVC</span></span><br><span class="line">        persistentVolumeClaim:</span><br><span class="line">          <span class="comment"># Name of the PVC created earlier</span></span><br><span class="line">          claimName: minio-pv-claim</span><br><span class="line">      containers:</span><br><span class="line">      - name: minio</span><br><span class="line">        <span class="comment"># Volume mounts for this container</span></span><br><span class="line">        volumeMounts:</span><br><span class="line">        <span class="comment"># Volume 'data' is mounted to path '/data'</span></span><br><span class="line">        - name: data</span><br><span class="line">          mountPath: <span class="string">"/data"</span></span><br><span class="line">        <span class="comment"># Pulls the lastest Minio image from Docker Hub</span></span><br><span class="line">        image: minio/minio:RELEASE.2019-04-18T21-44-59Z</span><br><span class="line">        args:</span><br><span class="line">        - server</span><br><span class="line">        - /data</span><br><span class="line">        env:</span><br><span class="line">        <span class="comment"># MinIO access key and secret key</span></span><br><span class="line">        - name: MINIO_ACCESS_KEY</span><br><span class="line">          value: <span class="string">"minio"</span></span><br><span class="line">        - name: MINIO_SECRET_KEY</span><br><span class="line">          value: <span class="string">"minio123"</span></span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 9000</span><br><span class="line">        <span class="comment"># Readiness probe detects situations when MinIO server instance</span></span><br><span class="line">        <span class="comment"># is not ready to accept traffic. Kubernetes doesn't forward</span></span><br><span class="line">        <span class="comment"># traffic to the pod while readiness checks fail.</span></span><br><span class="line">        readinessProbe:</span><br><span class="line">          httpGet:</span><br><span class="line">            path: /minio/health/ready</span><br><span class="line">            port: 9000</span><br><span class="line">          initialDelaySeconds: 120</span><br><span class="line">          periodSeconds: 20</span><br><span class="line">        <span class="comment"># Liveness probe detects situations where MinIO server instance</span></span><br><span class="line">        <span class="comment"># is not working properly and needs restart. Kubernetes automatically</span></span><br><span class="line">        <span class="comment"># restarts the pods if liveness checks fail.</span></span><br><span class="line">        livenessProbe:</span><br><span class="line">          httpGet:</span><br><span class="line">            path: /minio/health/live</span><br><span class="line">            port: 9000</span><br><span class="line">          initialDelaySeconds: 120</span><br><span class="line">          periodSeconds: 20</span><br><span class="line">~$ kubectl get deployment  --namespace default</span><br><span class="line">NAME    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">minio   0/1     1            0           82s</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…Minio-Service"><a href="#å®‰è£…Minio-Service" class="headerlink" title="å®‰è£…Minio Service"></a>å®‰è£…<code>Minio Service</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl create -f https://github.com/minio/minio/blob/master/docs/orchestration/kubernetes/minio-standalone-service.yaml?raw=<span class="literal">true</span></span><br><span class="line">service/minio-service created</span><br><span class="line"></span><br><span class="line">~$ cat minio-standalone-service.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  <span class="comment"># This name uniquely identifies the service</span></span><br><span class="line">  name: minio-service</span><br><span class="line">spec:</span><br><span class="line">  <span class="built_in">type</span>: LoadBalancer</span><br><span class="line">  ports:</span><br><span class="line">    - port: 9000</span><br><span class="line">      targetPort: 9000</span><br><span class="line">      protocol: TCP</span><br><span class="line">  selector:</span><br><span class="line">    <span class="comment"># Looks for labels `app:minio` in the namespace and applies the spec</span></span><br><span class="line">    app: minio</span><br><span class="line"></span><br><span class="line">~$ kubectl get svc minio-service</span><br><span class="line">NAME            TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">minio-service   LoadBalancer   10.100.57.156   &lt;pending&gt;     9000:32552/TCP   10m</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ä¸ºä»€ä¹ˆä¼šPending</span></span><br><span class="line">~$ kubectl describe pod --namespace default -l app=minio</span><br><span class="line">Name:               minio-756cb7dff7-mcm6m</span><br><span class="line">Namespace:          default</span><br><span class="line">Priority:           0</span><br><span class="line">PriorityClassName:  &lt;none&gt;</span><br><span class="line">Node:               fe001/172.18.253.222</span><br><span class="line">Start Time:         Fri, 19 Apr 2019 15:20:30 +0800</span><br><span class="line">Labels:             app=minio</span><br><span class="line">                    pod-template-hash=756cb7dff7</span><br><span class="line">Annotations:        &lt;none&gt;</span><br><span class="line">Status:             Running</span><br><span class="line">IP:                 10.244.1.4</span><br><span class="line">Controlled By:      ReplicaSet/minio-756cb7dff7</span><br><span class="line">Containers:</span><br><span class="line">  minio:</span><br><span class="line">    Container ID:  docker://119535fa5ab172b5b2155c650dc51c2d12b3c02b1e28ab9e8301eb318ab969a7</span><br><span class="line">    Image:         minio/minio:RELEASE.2019-04-18T21-44-59Z</span><br><span class="line">    Image ID:      docker-pullable://minio/minio@sha256:a26e089732b85f8c312ff6346498acec763033b1ac85e74fc897f667939ea2aa</span><br><span class="line">    Port:          9000/TCP</span><br><span class="line">    Host Port:     0/TCP</span><br><span class="line">    Args:</span><br><span class="line">      server</span><br><span class="line">      /data</span><br><span class="line">    State:          Running</span><br><span class="line">      Started:      Fri, 19 Apr 2019 15:20:51 +0800</span><br><span class="line">    Ready:          True</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Liveness:       http-get http://:9000/minio/health/live delay=120s timeout=1s period=20s <span class="comment">#success=1 #failure=3</span></span><br><span class="line">    Readiness:      http-get http://:9000/minio/health/ready delay=120s timeout=1s period=20s <span class="comment">#success=1 #failure=3</span></span><br><span class="line">    Environment:</span><br><span class="line">      MINIO_ACCESS_KEY:  minio</span><br><span class="line">      MINIO_SECRET_KEY:  minio123</span><br><span class="line">    Mounts:</span><br><span class="line">      /data from data (rw)</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-2vsh9 (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type              Status</span><br><span class="line">  Initialized       True</span><br><span class="line">  Ready             True</span><br><span class="line">  ContainersReady   True</span><br><span class="line">  PodScheduled      True</span><br><span class="line">Volumes:</span><br><span class="line">  data:</span><br><span class="line">    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim <span class="keyword">in</span> the same namespace)</span><br><span class="line">    ClaimName:  minio-pv-claim</span><br><span class="line">    ReadOnly:   <span class="literal">false</span></span><br><span class="line">  default-token-2vsh9:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  default-token-2vsh9</span><br><span class="line">    Optional:    <span class="literal">false</span></span><br><span class="line">QoS Class:       BestEffort</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class="keyword">for</span> 300s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute <span class="keyword">for</span> 300s</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason            Age                  From               Message</span><br><span class="line">  ----     ------            ----                 ----               -------</span><br><span class="line">  Warning  FailedScheduling  5m10s (x7 over 12m)  default-scheduler  0/3 nodes are available: 3 node(s) had taints that the pod didn\<span class="string">'t tolerate.</span></span><br><span class="line"><span class="string">  Normal   Scheduled         5m8s                 default-scheduler  Successfully assigned default/minio-756cb7dff7-mcm6m to fe001</span></span><br><span class="line"><span class="string">  Normal   Pulling           5m7s                 kubelet, fe001     Pulling image "minio/minio:RELEASE.2019-04-18T21-44-59Z"</span></span><br><span class="line"><span class="string">  Normal   Pulled            4m47s                kubelet, fe001     Successfully pulled image "minio/minio:RELEASE.2019-04-18T21-44-59Z"</span></span><br><span class="line"><span class="string">  Normal   Created           4m47s                kubelet, fe001     Created container minio</span></span><br><span class="line"><span class="string">  Normal   Started           4m47s                kubelet, fe001     Started container minio</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚ä¸Šæ‰€ç¤º,<code>Pending</code>åŸå› æ˜¯å› ä¸º<code>Warning  FailedScheduling  5m10s (x7 over 12m)  default-scheduler  0/3 nodes are available: 3 node(s) had taints that the pod didn\&#39;t tolerate.</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get pod --namespace default -l app=minio</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">minio-756cb7dff7-k2sdk   1/1     Running   0          15m</span><br><span class="line"><span class="comment"># åœ¨è¿è¡Œçš„å®¹å™¨ä¸­è¿œç¨‹æ‰§è¡Œå‘½ä»¤.ä¸‹é¢çš„åŒæ¨ªæ ä»£è¡¨ç€kubectlå‘½ä»¤é¡¹çš„ç»“æŸ.</span></span><br><span class="line">~$ kubectl <span class="built_in">exec</span> minio-756cb7dff7-k2sdk -- ping 8.8.8.8</span><br><span class="line">PING 8.8.8.8 (8.8.8.8): 56 data bytes</span><br><span class="line">64 bytes from 8.8.8.8: seq=1 ttl=41 time=25.684 ms</span><br><span class="line"><span class="comment"># åœ¨å®¹å™¨ä¸­è¿è¡Œshell</span></span><br><span class="line">~$ kubectl <span class="built_in">exec</span> -it minio-756cb7dff7-k2sdk sh</span><br><span class="line">/ <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h2 id="é€šè¿‡Ingressæš´éœ²æœåŠ¡"><a href="#é€šè¿‡Ingressæš´éœ²æœåŠ¡" class="headerlink" title="é€šè¿‡Ingressæš´éœ²æœåŠ¡"></a>é€šè¿‡<code>Ingress</code>æš´éœ²æœåŠ¡</h2><ul>
<li>å‘é›†ç¾¤å¤–éƒ¨çš„å®¢æˆ·ç«¯å…¬å¼€æœåŠ¡çš„æœ‰ä½¿ç”¨<code>LoadBalancer</code>å’Œ<code>Ingress</code>ä¸¤ç§æ–¹æ³•.æ¯ä¸ª<code>LoadBalancer</code>æœåŠ¡éƒ½éœ€è¦è‡ªå·±çš„è´Ÿè½½å‡è¡¡å™¨,ä»¥åŠç‹¬æœ‰çš„å…¬æœ‰IPçš„åœ°å€,è€Œ<code>Ingress</code>åªéœ€è¦ä¸€ä¸ªå…¬ç½‘IPå°±èƒ½ä¸ºè®¸å¤šæœåŠ¡æä¾›è®¿é—®.å½“å®¢æˆ·ç«¯å‘<code>Ingress</code>å‘é€<code>Http</code>è¯·æ±‚æ—¶,<code>Ingress</code>ä¼šæ ¹æ®è¯·æ±‚çš„ä¸»æœºåå’Œè·¯å¾„å†³å®šè¯·æ±‚è½¬å‘åˆ°çš„æœåŠ¡.<code>Ingressåœ¨</code>ç½‘ç»œæ ˆçš„(HTTP)çš„åº”ç”¨å±‚æ“ä½œ,å¹¶ä¸”å¯ä»¥æä¾›ä¸€äº›æœåŠ¡ä¸èƒ½å®ç°çš„åŠŸèƒ½.å¦‚åŸºäº<code>cookie</code>çš„<code>session affinity</code>ç­‰åŠŸèƒ½.</li>
</ul>
<h1 id="Traefikåå‘ä»£ç†"><a href="#Traefikåå‘ä»£ç†" class="headerlink" title="Traefikåå‘ä»£ç†"></a><code>Traefik</code>åå‘ä»£ç†</h1><ul>
<li>å‚è€ƒé“¾æ¥:<ul>
<li><a href="https://github.com/traefik/traefik" target="_blank" rel="noopener">traefik</a></li>
<li><a href="https://dev.to/maymeow/static-sites-with-minio-and-s3www-3feh" target="_blank" rel="noopener">Static Sites With Minio and S3www</a></li>
<li><a href="https://blog.sethcorker.com/traefik-routing-for-web-apps/" target="_blank" rel="noopener">Using Traefik for routing paths to web apps</a></li>
</ul>
</li>
<li><code>Traefik</code>æ˜¯ä¸€æ¬¾äº‘åŸç”Ÿåå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡æœåŠ¡,ä½¿ç”¨<code>golang</code>å®ç°çš„.å’Œ<code>nginx</code>æœ€å¤§çš„ä¸åŒæ˜¯,å®ƒæ”¯æŒè‡ªåŠ¨åŒ–æ›´æ–°åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡é…ç½®.å¹¶ä¸”æ”¯æŒå¤šç§åç«¯:<ul>
<li>Docker / Swarm mode</li>
<li>Kubernetes</li>
<li>Marathon</li>
<li>Rancher (Metadata)</li>
<li>File</li>
</ul>
</li>
</ul>
<h2 id="å¿«é€Ÿå®‰è£…æµ‹è¯•"><a href="#å¿«é€Ÿå®‰è£…æµ‹è¯•" class="headerlink" title="å¿«é€Ÿå®‰è£…æµ‹è¯•"></a>å¿«é€Ÿå®‰è£…æµ‹è¯•</h2><ul>
<li><p>ä¸‹è½½ä¸€ä»½<code>Traefik</code>çš„é…ç½®,å¯ä»¥ä»è¿™é‡Œå¤åˆ¶ä¸€ä»½<a href="https://raw.githubusercontent.com/traefik/traefik/master/traefik.sample.toml" target="_blank" rel="noopener">ç®€å•é…ç½®</a>,æˆ–è€…å»åˆ°<a href="https://github.com/traefik/traefik/releases" target="_blank" rel="noopener">https://github.com/traefik/traefik/releases</a>ä¸‹è½½ä¸€ä¸ª<code>Traefik</code>çš„äºŒè¿›åˆ¶çš„ç¨‹åº,è¿è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæˆå®ƒ:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ ./traefik -c traefik.toml</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç›´æ¥<code>Docker</code>è¿è¡Œæµ‹è¯•,æµè§ˆå™¨æ‰“å¼€<code>http://127.0.0.1:8080/dashboard/#/</code>è¿›å…¥æ§åˆ¶å°æŸ¥çœ‹.å®ƒæœ‰å‡ ä¸ªé‡è¦çš„æ ¸å¿ƒç»„ä»¶:</p>
<ul>
<li>Providers</li>
<li>Entrypoints</li>
<li>Routers</li>
<li>Services</li>
<li>Middlewares<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ docker run -d -p 8080:8080 -p 80:80 -v <span class="variable">$PWD</span>/traefik.toml:/etc/traefik/traefik.toml traefik</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="docker-composeæµ‹è¯•è¯´æ˜"><a href="#docker-composeæµ‹è¯•è¯´æ˜" class="headerlink" title="docker-composeæµ‹è¯•è¯´æ˜"></a><code>docker-compose</code>æµ‹è¯•è¯´æ˜</h2><ul>
<li>ä¸‹é¢æ˜¯ç”¨ä¸€ä¸ªç®€å•çš„ç»„åˆé…ç½®æµ‹è¯•,æ¥ç›´è§‚ç†è§£è¯´æ˜<code>Traefik</code>çš„ç”¨é€”ä¸ä½¿ç”¨åœºæ™¯,è¿™é‡Œä½¿ç”¨<code>v2.5</code>çš„ç‰ˆæœ¬,ä¸æ—§çš„<code>v1.2</code>æ˜¯æœ‰å·®åˆ«çš„.æµ‹è¯•çš„ç›®å½•ç»“æ„å¦‚ä¸‹:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~$ tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ minio</span><br><span class="line">â”‚Â Â  â””â”€â”€ docker-compose.yml</span><br><span class="line">â”œâ”€â”€ traefik</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ docker-compose-v2.yml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ docker-compose.yml</span><br><span class="line">â”‚Â Â  â””â”€â”€ traefik.toml</span><br><span class="line">â””â”€â”€ whoami-app</span><br><span class="line">    â”œâ”€â”€ docker-compose-v2.yml</span><br><span class="line">    â””â”€â”€ docker-compose.yml</span><br></pre></td></tr></table></figure>
<ul>
<li><p>è¿è¡Œ<code>Traefik</code>å®ä¾‹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">traefik$ cat docker-compose-v2.yml</span><br><span class="line">version: <span class="string">'3'</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  reverse-proxy:</span><br><span class="line">    <span class="comment"># The official v2 Traefik docker image</span></span><br><span class="line">    image: traefik:v2.5</span><br><span class="line">    <span class="comment"># Enables the web UI and tells Traefik to listen to docker</span></span><br><span class="line">    <span class="built_in">command</span>: --api.insecure=<span class="literal">true</span> --providers.docker</span><br><span class="line">    ports:</span><br><span class="line">      <span class="comment"># The HTTP port</span></span><br><span class="line">      - <span class="string">"80:80"</span></span><br><span class="line">      <span class="comment"># The Web UI (enabled by --api.insecure=true)</span></span><br><span class="line">      - <span class="string">"8080:8080"</span></span><br><span class="line">    volumes:</span><br><span class="line">      <span class="comment"># So that Traefik can listen to the Docker events</span></span><br><span class="line">      - /var/run/docker.sock:/var/run/docker.sock</span><br><span class="line">traefik$ docker-compose -f docker-compose-v2.yml up -d</span><br><span class="line">Creating network <span class="string">"traefik_default"</span> with the default driver</span><br><span class="line">Creating traefik_reverse-proxy_1 ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿è¡Œ3ä¸ªæµ‹è¯•å®ä¾‹(traefik/whoami)</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">whoami-app$ cat docker-compose-v2.yml</span><br><span class="line">version: <span class="string">'3'</span></span><br><span class="line">services:</span><br><span class="line">  whoami:</span><br><span class="line">    <span class="comment"># A container that exposes an API to show its IP address</span></span><br><span class="line">    image: traefik/whoami</span><br><span class="line">    networks:</span><br><span class="line">      - traefik_default</span><br><span class="line">    labels:</span><br><span class="line">      - traefik.docker.network=traefik_default</span><br><span class="line">      - traefik.http.routers.whoami.rule=Host(`whoami.docker.localhost`)</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  traefik_default:</span><br><span class="line">    external: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">whoami-app$ docker-compose -f docker-compose-v2.yml up -d --scale whoami=3</span><br><span class="line">Starting whoami-app_whoami_1 ... <span class="keyword">done</span></span><br><span class="line">Creating whoami-app_whoami_2 ... <span class="keyword">done</span></span><br><span class="line">Creating whoami-app_whoami_3 ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>å¯ä»¥é€šè¿‡æµè§ˆå™¨çš„é¡µé¢<code>http://127.0.0.1:8080/dashboard/#/http/services</code>æŸ¥çœ‹æœåŠ¡çš„çŠ¶æ€,ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ curl  http://localhost:8080/api/rawdata | jq -c <span class="string">'.services'</span></span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100  1829  100  1829    0     0  1786k      0 --:--:-- --:--:-- --:--:-- 1786k</span><br><span class="line">&#123;<span class="string">"api@internal"</span>:&#123;<span class="string">"status"</span>:<span class="string">"enabled"</span>,<span class="string">"usedBy"</span>:[<span class="string">"api@internal"</span>]&#125;,<span class="string">"dashboard@internal"</span>:&#123;<span class="string">"status"</span>:<span class="string">"enabled"</span>,<span class="string">"usedBy"</span>:[<span class="string">"dashboard@internal"</span>]&#125;,<span class="string">"noop@internal"</span>:&#123;<span class="string">"status"</span>:<span class="string">"enabled"</span>&#125;,<span class="string">"reverse-proxy-traefik@docker"</span>:&#123;<span class="string">"loadBalancer"</span>:&#123;<span class="string">"servers"</span>:[&#123;<span class="string">"url"</span>:<span class="string">"http://172.30.0.2:80"</span>&#125;],<span class="string">"passHostHeader"</span>:<span class="literal">true</span>&#125;,<span class="string">"status"</span>:<span class="string">"enabled"</span>,<span class="string">"usedBy"</span>:[<span class="string">"reverse-proxy-traefik@docker"</span>],<span class="string">"serverStatus"</span>:&#123;<span class="string">"http://172.30.0.2:80"</span>:<span class="string">"UP"</span>&#125;&#125;,<span class="string">"whoami-whoami-app@docker"</span>:&#123;<span class="string">"loadBalancer"</span>:&#123;<span class="string">"servers"</span>:[&#123;<span class="string">"url"</span>:<span class="string">"http://172.31.0.4:80"</span>&#125;,&#123;<span class="string">"url"</span>:<span class="string">"http://172.31.0.2:80"</span>&#125;,&#123;<span class="string">"url"</span>:<span class="string">"http://172.31.0.3:80"</span>&#125;],<span class="string">"passHostHeader"</span>:<span class="literal">true</span>&#125;,<span class="string">"status"</span>:<span class="string">"enabled"</span>,<span class="string">"usedBy"</span>:[<span class="string">"whoami@docker"</span>],<span class="string">"serverStatus"</span>:&#123;<span class="string">"http://172.31.0.2:80"</span>:<span class="string">"UP"</span>,<span class="string">"http://172.31.0.3:80"</span>:<span class="string">"UP"</span>,<span class="string">"http://172.31.0.4:80"</span>:<span class="string">"UP"</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æˆ–è€…æ˜¯è¿™æ ·</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$ curl -H Host:whoami.docker.localhost http://127.0.0.1</span><br><span class="line">Hostname: 4c9f9a107136</span><br><span class="line">IP: 127.0.0.1</span><br><span class="line">IP: 172.19.0.6</span><br><span class="line">RemoteAddr: 172.19.0.1:46902</span><br><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: whoami.docker.localhost</span><br><span class="line">User-Agent: curl/7.74.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line">X-Forwarded-For: 172.19.0.1</span><br><span class="line">X-Forwarded-Host: whoami.docker.localhost</span><br><span class="line">X-Forwarded-Port: 80</span><br><span class="line">X-Forwarded-Proto: http</span><br><span class="line">X-Forwarded-Server: 8a986b075043</span><br><span class="line">X-Real-Ip: 172.19.0.1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="å¼€å¯è¯ä¹¦ä¸Basic-Auth"><a href="#å¼€å¯è¯ä¹¦ä¸Basic-Auth" class="headerlink" title="å¼€å¯è¯ä¹¦ä¸Basic Auth"></a>å¼€å¯è¯ä¹¦ä¸<code>Basic Auth</code></h2><ul>
<li><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¤æ‚çš„<code>docker-compose</code>,æ”¯æŒ<code>Let&#39;s Crypto</code>è‡ªåŠ¨ç”³è¯·è¯ä¹¦ã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3.3"</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  traefik:</span><br><span class="line">    image: <span class="string">"traefik:v2.5"</span></span><br><span class="line">    container_name: <span class="string">"traefik"</span></span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - <span class="string">"--api.insecure=false"</span></span><br><span class="line">      - <span class="string">"--providers.docker=true"</span></span><br><span class="line">      - <span class="string">"--providers.docker.exposedbydefault=false"</span></span><br><span class="line">      - <span class="string">"--providers.file.directory=/letsencrypt/"</span></span><br><span class="line">      - <span class="string">"--entrypoints.web.address=:80"</span></span><br><span class="line">      - <span class="string">"--entrypoints.websecure.address=:443"</span></span><br><span class="line">      - <span class="string">"--certificatesresolvers.myresolver.acme.httpchallenge=true"</span></span><br><span class="line">      - <span class="string">"--certificatesresolvers.myresolver.acme.httpchallenge.entrypoint=web"</span></span><br><span class="line">      <span class="comment">#- "--certificatesresolvers.myresolver.acme.caserver=https://acme-staging-v02.api.letsencrypt.org/directory"</span></span><br><span class="line">      - <span class="string">"--certificatesresolvers.myresolver.acme.email=&lt;your email&gt;@gmail.com"</span></span><br><span class="line">      - <span class="string">"--certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json"</span></span><br><span class="line">      <span class="comment"># Global HTTP -&gt; HTTPS</span></span><br><span class="line">      - <span class="string">"--entrypoints.web.http.redirections.entryPoint.to=websecure"</span></span><br><span class="line">      - <span class="string">"--entrypoints.web.http.redirections.entryPoint.scheme=https"</span></span><br><span class="line">      <span class="comment"># Enable dashboard</span></span><br><span class="line">      - <span class="string">"--api.dashboard=true"</span></span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">"80:80"</span></span><br><span class="line">      - <span class="string">"443:443"</span></span><br><span class="line">      - <span class="string">"8080:8080"</span></span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">"./certs:/letsencrypt"</span></span><br><span class="line">      - <span class="string">"/var/run/docker.sock:/var/run/docker.sock:ro"</span></span><br><span class="line">    labels:</span><br><span class="line">      - <span class="string">"traefik.enable=true"</span></span><br><span class="line">      - <span class="string">"traefik.http.services.api@internal.loadbalancer.server.port=8080"</span> <span class="comment"># required by swarm but not used.</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.traefik.rule=Host(`&lt;Your FQDN domain name&gt;`) &amp;&amp; (PathPrefix(`/dashboard`) || PathPrefix(`/api`))"</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.traefik.middlewares=traefik-https-redirect"</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.traefik.entrypoints=websecure"</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.traefik.tls.certresolver=myresolver"</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.traefik.tls=true"</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.traefik.tls.options=default"</span></span><br><span class="line">      - <span class="string">"traefik.http.middlewares.traefik-https-redirect.redirectscheme.scheme=https"</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.traefik.middlewares=traefik-auth"</span></span><br><span class="line">      - <span class="string">"traefik.http.middlewares.traefik-auth.basicauth.users=&lt;login name&gt;:$<span class="variable">$apr1</span>$<span class="variable">$Pf2MP</span>/Oy$$...."</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.traefik.service=api@internal"</span></span><br><span class="line">        <span class="comment">#- 'traefik.http.routers.traefik.middlewares=strip'</span></span><br><span class="line">        <span class="comment">#- 'traefik.http.middlewares.strip.stripprefix.prefixes=/dashboard'</span></span><br><span class="line"></span><br><span class="line">  whoami:</span><br><span class="line">    image: <span class="string">"traefik/whoami"</span></span><br><span class="line">    container_name: <span class="string">"simple-service"</span></span><br><span class="line">    labels:</span><br><span class="line">      - <span class="string">"traefik.enable=true"</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.whoami.rule=Host(`&lt;Your FQDN domain name&gt;`) &amp;&amp; Path(`/whoami`)"</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.whoami.entrypoints=websecure"</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.whoami.tls.certresolver=myresolver"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸Šé¢çš„ç”³è¯·çš„è¯ä¹¦æ˜¯é€šè¿‡<code>httpchallenge</code>,ä¹Ÿå¯ä»¥é€šè¿‡<code>dns</code>éªŒè¯çš„æ–¹å¼, å¹¶ä¸”å¼€å¯äº†<code>Traefik Dashboard</code>çš„<code>TLS+Basic Auth</code>è®¤è¯. ä¸Šé¢çš„<code>whoami</code>çš„æœåŠ¡,æ˜¯ç”¨åšç¤ºä¾‹è¯´æ˜,å°±æ­¤è¯´æ˜å¯ä»¥ä½¿ç”¨<code>Host(</code><your fqdn domain name><code>) &amp;&amp; Path(</code>/whoami<code>)</code>æ–¹å¼,å»åå‘ä»£ç†å¾ˆå¤šä¸åŒçš„å†…éƒ¨æœåŠ¡ã€‚</your></p>
</li>
<li><p>å¦‚ä¸Šé¢æ‰€ç¤º,ä½¿ç”¨äº†æœ¬åœ°<code>./certs:/letsencrypt</code>æŒ‚è½½,æ‰€ä»¥<code>certs</code>ç›®å½•å†…å®¹å¦‚ä¸‹ã€‚<code>acme.json</code>æ˜¯è¯ä¹¦ç›¸å…³çš„å†…å®¹ã€‚</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ tree ./certs/</span><br><span class="line">./certs/</span><br><span class="line">â”œâ”€â”€ acme.json</span><br><span class="line">â””â”€â”€ tls.yml</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ›å»º<code>tls.yml</code>æ˜¯ä¸ºäº†åŠ å¼º<code>TLS</code>çš„è®¾ç½®çº§åˆ«,å†…å®¹å¦‚ä¸‹.å¯ä»¥é€šè¿‡<code>https://www.ssllabs.com</code>å»æµ‹è¯•å½“å‰æœåŠ¡å™¨çš„<code>TLS</code>å®‰å…¨è¯„åˆ†,å¦‚æœèƒ½å¾—åˆ°<code>A+</code>è¯´æ˜éå¸¸å¥½.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~$ cat certs/tls.yml</span><br><span class="line">tls:</span><br><span class="line">  options:</span><br><span class="line">    default:</span><br><span class="line">      minVersion: <span class="string">"VersionTLS13"</span></span><br><span class="line">      sniStrict: <span class="literal">true</span></span><br><span class="line">      cipherSuites:</span><br><span class="line">        - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</span><br><span class="line">        - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</span><br><span class="line">        - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</span><br><span class="line">        - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><br><span class="line">        - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305</span><br><span class="line">        - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ›å»º<code>Basic Auth</code>çš„ç”¨æˆ·ä¸å¯†ç ,ä¸€èˆ¬éƒ½ä½¿ç”¨<code>apache-utils</code>å·¥å…·é‡Œçš„<code>htpasswd</code>å‘½ä»¤,ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼åˆ›å»º,<code>$</code>éœ€è¦è½¬ä¹‰æˆ<code>$$</code>.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -apr1  uses the apr1 algorithm (Apache variant of the BSD algorithm).</span></span><br><span class="line"></span><br><span class="line">~$ openssl passwd -apr1</span><br><span class="line">Password:</span><br><span class="line">Verifying - Password:</span><br><span class="line"><span class="variable">$apr1</span><span class="variable">$AzG7Y5HE</span><span class="variable">$dZoKWVCmxffAe1oakeHR40</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æˆ–è€…è¿™æ ·</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">printf</span> <span class="string">"&lt;Your User&gt;:<span class="variable">$(openssl passwd -apr1 &lt;Your password&gt; | sed -E "s:[\$]:\$\$:g")</span>\n"</span>  &gt;&gt; ~/.htpasswd</span><br><span class="line"></span><br><span class="line">~$ <span class="built_in">printf</span> <span class="string">"admin:<span class="variable">$(openssl passwd -apr1 admin | sed -E "s:[\$]:\$\$:g")</span>\n"</span></span><br><span class="line">admin:$<span class="variable">$apr1</span>$<span class="variable">$7eSlrnJD</span>$<span class="variable">$XGLpWARS</span>.YLxwYPoRtUdc.</span><br></pre></td></tr></table></figure>
<h3 id="docker-composeå®‰è£…MinIO"><a href="#docker-composeå®‰è£…MinIO" class="headerlink" title="docker-composeå®‰è£…MinIO"></a><code>docker-compose</code>å®‰è£…<code>MinIO</code></h3><ul>
<li><p>è¿è¡Œä¸€ä¸ªç¨å¾®å¤æ‚çš„<code>MinIO</code>çš„æœåŠ¡å®ä¾‹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3"</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  minio:</span><br><span class="line">    <span class="comment"># Please use fixed versions :D</span></span><br><span class="line">    image: minio/minio</span><br><span class="line">    hostname: minio</span><br><span class="line">    networks:</span><br><span class="line">      - traefik_default</span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="variable">$PWD</span>/minio-data:/data</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - server</span><br><span class="line">      - /data</span><br><span class="line">      - --console-address</span><br><span class="line">      - <span class="string">":9001"</span></span><br><span class="line">    expose:</span><br><span class="line">      - 9000</span><br><span class="line">      - 9001</span><br><span class="line">    environment:</span><br><span class="line">      - MINIO_ROOT_USER=minio</span><br><span class="line">      - MINIO_ROOT_PASSWORD=minio123</span><br><span class="line">      - APP_NAME=minio</span><br><span class="line">      <span class="comment"># Do NOT use MINIO_DOMAIN or MINIO_SERVER_URL with Traefik.</span></span><br><span class="line">      <span class="comment"># All Routing is done by Traefik, just tell minio where to redirect to.</span></span><br><span class="line">      - MINIO_BROWSER_REDIRECT_URL=http://minio-console.localhost</span><br><span class="line">    labels:</span><br><span class="line">      - traefik.enable=<span class="literal">true</span></span><br><span class="line">      - traefik.docker.network=traefik_default</span><br><span class="line">      - traefik.http.routers.minio.rule=Host(`minio.localhost`)</span><br><span class="line">      - traefik.http.routers.minio-console.rule=Host(`minio-console.localhost`)</span><br><span class="line">      - traefik.http.routers.minio.service=minio</span><br><span class="line">      - traefik.http.services.minio.loadbalancer.server.port=9000</span><br><span class="line">      - traefik.http.services.minio-console.loadbalancer.server.port=9001</span><br><span class="line">      - traefik.http.routers.minio-console.service=minio-console</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  traefik_default:</span><br><span class="line">    external: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">minio$ docker-compose up -d</span><br><span class="line">Creating minio_minio_1 ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿è¡Œä¸Šé¢å®ä¾‹å,å¯ä»¥é€šæµè§ˆå™¨æ‰“å¼€<code>http://minio-console.localhost</code>,è¾“å…¥<code>minio:minio123</code>ç™»å½•åˆ°<code>minIO</code>çš„æ§åˆ¶å°é¡µé¢.ä¸ºä»€ä¹ˆä¼šé€šè¿‡<code>minio-console.localhost</code>è¿™æ ·ä¸€ä¸ªåŸŸå,å°±å¯ä»¥åå‘ä»£ç†å†…éƒ¨çš„æœåŠ¡äº†.è¿™é‡Œå¯ä»¥æ‰“å¼€<code>http://localhost:8080/dashboard/#/http/routers</code>çœ‹åˆ°ç›¸åº”çš„è·¯ç”±,ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹æœ‰é‚£äº›è·¯ç”±:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ curl http://localhost:8080/api/rawdata | jq   <span class="string">'.routers[] | .service'</span></span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100  2509    0  2509    0     0  2450k      0 --:--:-- --:--:-- --:--:-- 2450k</span><br><span class="line"><span class="string">"api@internal"</span></span><br><span class="line"><span class="string">"dashboard@internal"</span></span><br><span class="line"><span class="string">"minio-console"</span></span><br><span class="line"><span class="string">"minio"</span></span><br><span class="line"><span class="string">"reverse-proxy-traefik"</span></span><br><span class="line"><span class="string">"whoami-whoami-app"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿™é‡Œæµ‹è¯•æ—¶éœ€è¦æ³¨æ„ä¸€ä¸ªç‚¹,å¦‚æœæŠŠ<code>minio</code>ä¸<code>traefik</code>ç­‰æœåŠ¡æè¿°,å†™åœ¨åŒä¸€ä¸ª<code>docker-compose.yml</code>æ–‡ä»¶é‡Œ,æ˜¯ä¸éœ€è¦<br>æŒ‡å®š<code>networks</code>æ®µçš„,å¦‚æœåˆ†å¼€å†™çš„,æ˜¯éœ€è¦å£°æ˜ä¸<code>traefik</code>çš„æœåŠ¡åœ¨åŒä¸€ä¸ªç½‘ç»œåŸŸå†…,ä¸Šé¢çš„æµ‹è¯•å®ä¾‹ä¸­,<br><code>docker-compose</code>å¯åŠ¨<code>traefik</code>æœåŠ¡æ—¶,ä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ªåä¸º<code>traefik_default</code>ç½‘ç»œåŸŸ.æ‰€ä»¥è¿™é‡Œåœ¨ä¸Šè¿°<br>å®ä¾‹ä¸­:<code>whoami,minio</code>ä¸­,éƒ½å£°æ˜å®šä¹‰äº†<code>networks</code>çš„å­—æ®µ,æœ¬æœº<code>Docker</code>ç½‘ç»œåˆ—è¡¨å¦‚ä¸‹:</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~$ docker network ls</span><br><span class="line">NETWORK ID     NAME                 DRIVER    SCOPE</span><br><span class="line">f8c2befaa42f   bridge               bridge    <span class="built_in">local</span></span><br><span class="line">f27beded9896   host                 host      <span class="built_in">local</span></span><br><span class="line">244ab53cbc48   none                 null      <span class="built_in">local</span></span><br><span class="line">18ddc4985478   traefik_default      bridge    <span class="built_in">local</span></span><br><span class="line">1c5f5a863ef9   whoami-app_default   bridge    <span class="built_in">local</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>Traefik</code>åˆ›å»ºè·¯ç”±è§„åˆ™æœ‰å¤šç§æ–¹å¼,æ¯”å¦‚:</p>
<ul>
<li>åŸç”Ÿ<code>Ingress</code>å†™æ³•</li>
<li>ä½¿ç”¨<code>CRD IngressRoute</code>æ–¹å¼</li>
<li>ä½¿ç”¨<code>GatewayAPI</code>çš„æ–¹å¼</li>
</ul>
</li>
<li><p>åœæ‰æµ‹è¯•å®ä¾‹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">whoami-app$ docker-compose -f docker-compose-v2.yml down</span><br><span class="line">Stopping whoami-app_whoami_1 ... <span class="keyword">done</span></span><br><span class="line">Stopping whoami-app_whoami_3 ... <span class="keyword">done</span></span><br><span class="line">Stopping whoami-app_whoami_2 ... <span class="keyword">done</span></span><br><span class="line">Removing whoami-app_whoami_1 ... <span class="keyword">done</span></span><br><span class="line">Removing whoami-app_whoami_3 ... <span class="keyword">done</span></span><br><span class="line">Removing whoami-app_whoami_2 ... <span class="keyword">done</span></span><br><span class="line">Removing network whoami-app_default</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="MCå®¢æˆ·ç«¯"><a href="#MCå®¢æˆ·ç«¯" class="headerlink" title="MCå®¢æˆ·ç«¯"></a><code>MC</code>å®¢æˆ·ç«¯</h3><ul>
<li><p><a href="https://docs.min.io/docs/minio-client-complete-guide.html" target="_blank" rel="noopener">MinIO Client Complete Guide Slack</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.min.io/client/mc/release/linux-amd64/mc</span><br><span class="line">chmod +x mc</span><br><span class="line">./mc --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>é…ç½®ä¸€ä¸ªS3æœåŠ¡ç«¯</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./mc config host add mystorage http://minio.localhost test1234access test1234secret --api s3v4</span><br><span class="line">mc: Configuration written to `/home/michael/.mc/config.json`. Please update your access credentials.</span><br><span class="line">mc: Successfully created `/home/michael/.mc/share`.</span><br><span class="line">mc: Initialized share uploads `/home/michael/.mc/share/uploads.json` file.</span><br><span class="line">mc: Initialized share downloads `/home/michael/.mc/share/downloads.json` file.</span><br><span class="line">Added `mystorage` successfully.</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹ä¿¡æ¯</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ ./mc admin info play/</span><br><span class="line">â—  play.min.io</span><br><span class="line">   Uptime: 2 days</span><br><span class="line">   Version: 2021-12-10T23:03:39Z</span><br><span class="line">   Network: 1/1 OK</span><br><span class="line">   Drives: 4/4 OK</span><br><span class="line"></span><br><span class="line">11 GiB Used, 392 Buckets, 8,989 Objects</span><br><span class="line">4 drives online, 0 drives offline</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="S3å®¢æˆ·ç«¯è¿æ¥æµ‹è¯•MinIO"><a href="#S3å®¢æˆ·ç«¯è¿æ¥æµ‹è¯•MinIO" class="headerlink" title="S3å®¢æˆ·ç«¯è¿æ¥æµ‹è¯•MinIO"></a><code>S3</code>å®¢æˆ·ç«¯è¿æ¥æµ‹è¯•<code>MinIO</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ pip3 install awscli</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">minio$ aws configure --profile minio</span><br><span class="line">AWS Access Key ID [None]: test1234minio</span><br><span class="line">AWS Secret Access Key [None]: test1234minio</span><br><span class="line">Default region name [None]: minio-lan</span><br><span class="line">Default output format [None]: json</span><br></pre></td></tr></table></figure>
<h1 id="HelmåŒ…ç®¡ç†å™¨"><a href="#HelmåŒ…ç®¡ç†å™¨" class="headerlink" title="HelmåŒ…ç®¡ç†å™¨"></a><code>Helm</code>åŒ…ç®¡ç†å™¨</h1><ul>
<li><a href="https://github.com/helm/helm" target="_blank" rel="noopener">Helm</a>æ˜¯<code>k8s</code>çš„åŒ…ç®¡ç†å™¨,å®ƒå¯ä»¥ç±»æ¯”ä¸º<code>Debian,Ubuntu</code>çš„<code>apt</code>.<code>Red Hat</code>çš„<code>yum</code>,<code>Python</code>ä¸­çš„<code>pip</code>.<code>Nodejs</code>çš„<code>npm</code>åŒ…ç®¡ç†å™¨.<code>Helm</code>å¯ä»¥ç†è§£ä¸º<code>Kubernetes</code>çš„åŒ…ç®¡ç†å·¥å…·,å¯ä»¥æ–¹ä¾¿åœ°å‘ç°ã€å…±äº«å’Œä½¿ç”¨ä¸º<code>Kubernetes</code>æ„å»ºçš„åº”ç”¨,å®ƒåŒ…å«å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ:<ul>
<li><code>.Chart</code>:ä¸€ä¸ª<code>Helm</code>åŒ…,å…¶ä¸­åŒ…å«äº†è¿è¡Œä¸€ä¸ªåº”ç”¨æ‰€éœ€è¦çš„é•œåƒã€ä¾èµ–å’Œèµ„æºå®šä¹‰ç­‰,è¿˜å¯èƒ½åŒ…å«<code>Kubernetes</code>é›†ç¾¤ä¸­çš„æœåŠ¡å®šä¹‰,ç±»ä¼¼<code>Homebrew</code>ä¸­çš„<code>formula</code>,<code>APT</code>çš„<code>dpkg</code>æˆ–è€…<code>Yum</code>çš„<code>rpm</code>æ–‡ä»¶.</li>
<li><code>.Release</code>:åœ¨<code>Kubernetes</code>é›†ç¾¤ä¸Šè¿è¡Œçš„<code>Chart</code>çš„ä¸€ä¸ªå®ä¾‹.åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸Š,ä¸€ä¸ª<code>Chart</code>å¯ä»¥å®‰è£…å¾ˆå¤šæ¬¡.æ¯æ¬¡å®‰è£…éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„<code>Release</code>. <code>MySQL Chart</code>,å¦‚æœæƒ³åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä¸¤ä¸ªæ•°æ®åº“,å°±å¯ä»¥æŠŠè¿™ä¸ª<code>Chart</code>å®‰è£…ä¸¤æ¬¡.æ¯æ¬¡å®‰è£…éƒ½ä¼šç”Ÿæˆè‡ªå·±çš„<code>Release</code>,ä¼šæœ‰è‡ªå·±çš„<code>Release</code>åç§°.</li>
<li><code>.Repository</code>:ç”¨äºå‘å¸ƒå’Œå­˜å‚¨<code>Chart</code>çš„ä»“åº“.</li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½ä¸€ä¸ªæœ€ç‰ˆæœ¬,æŠŠå®ƒè§£å‹åˆ°/usr/local/bin</span></span><br><span class="line">~$ wget -c https://storage.googleapis.com/kubernetes-helm/helm-v2.13.1-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">~$ helm version</span><br><span class="line">Client: &amp;version.Version&#123;SemVer:<span class="string">"v2.13.1"</span>, GitCommit:<span class="string">"618447cbf203d147601b4b9bd7f8c37a5d39fbb4"</span>, GitTreeState:<span class="string">"clean"</span>&#125;</span><br><span class="line">Error: could not find tiller</span><br><span class="line"></span><br><span class="line">~$ helm completion bash &gt; ~/.helmrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"source ~/.helmrc"</span> &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure>
<h2 id="å®‰è£…TilleræœåŠ¡å™¨"><a href="#å®‰è£…TilleræœåŠ¡å™¨" class="headerlink" title="å®‰è£…TilleræœåŠ¡å™¨"></a>å®‰è£…<code>Tiller</code>æœåŠ¡å™¨</h2><ul>
<li><p><a href="https://yq.aliyun.com/articles/159601" target="_blank" rel="noopener">åˆ©ç”¨Helmç®€åŒ–Kubernetesåº”ç”¨éƒ¨ç½²</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~$ helm init</span><br><span class="line">Creating /home/lcy/.helm</span><br><span class="line">Creating /home/lcy/.helm/repository</span><br><span class="line">Creating /home/lcy/.helm/repository/cache</span><br><span class="line">Creating /home/lcy/.helm/repository/<span class="built_in">local</span></span><br><span class="line">Creating /home/lcy/.helm/plugins</span><br><span class="line">Creating /home/lcy/.helm/starters</span><br><span class="line">Creating /home/lcy/.helm/cache/archive</span><br><span class="line">Creating /home/lcy/.helm/repository/repositories.yaml</span><br><span class="line">Adding stable repo with URL: https://kubernetes-charts.storage.googleapis.com</span><br><span class="line">Error: Looks like <span class="string">"https://kubernetes-charts.storage.googleapis.com"</span> is not a valid chart repository or cannot be reached: <span class="built_in">read</span> tcp 172.18.127.186:54980-&gt;216.58.199.16:443: <span class="built_in">read</span>: connection reset by peer</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚ä¸Šæ‰€ç¤º,æ— æ³•è¿æ¥åˆ°å®˜æ–¹çš„æœåŠ¡å™¨,å›½å†…åˆ©ç”¨é˜¿é‡Œäº‘æºæ¥å®‰è£…</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">~$ helm init --upgrade -i registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.13.1 --stable-repo-url https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="line">Creating /home/lcy/.helm/repository/repositories.yaml</span><br><span class="line">Adding stable repo with URL: https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="line">Adding <span class="built_in">local</span> repo with URL: http://127.0.0.1:8879/charts</span><br><span class="line"><span class="variable">$HELM_HOME</span> has been configured at /home/lcy/.helm.</span><br><span class="line"></span><br><span class="line">Tiller (the Helm server-side component) has been installed into your Kubernetes Cluster.</span><br><span class="line"></span><br><span class="line">Please note: by default, Tiller is deployed with an insecure <span class="string">'allow unauthenticated users'</span> policy.</span><br><span class="line">To prevent this, run `helm init` with the --tiller-tls-verify flag.</span><br><span class="line">For more information on securing your installation see: https://docs.helm.sh/using_helm/<span class="comment">#securing-your-helm-installation</span></span><br><span class="line">Happy Helming!</span><br><span class="line"></span><br><span class="line">~$ helm init --upgrade</span><br><span class="line"><span class="variable">$HELM_HOME</span> has been configured at /home/lcy/.helm.</span><br><span class="line"></span><br><span class="line">Tiller (the Helm server-side component) has been upgraded to the current version.</span><br><span class="line">Happy Helming!</span><br><span class="line"><span class="comment"># æŸ¥æ‰¾charts</span></span><br><span class="line">~$ helm search</span><br><span class="line">NAME                            CHART VERSION   APP VERSION     DESCRIPTION</span><br><span class="line">stable/acs-engine-autoscaler    2.1.3           2.1.1           Scales worker nodes within agent pools</span><br><span class="line">stable/aerospike                0.1.7           v3.14.1.2       A Helm chart <span class="keyword">for</span> Aerospike <span class="keyword">in</span> Kubernetes</span><br><span class="line">stable/anchore-engine           0.1.3           0.1.6           Anchore container analysis and policy evaluation engine s...</span><br><span class="line">stable/artifactory              7.0.3           5.8.4           Universal Repository Manager supporting all major packagi...</span><br><span class="line">stable/artifactory-ha           0.1.0           5.8.4           Universal Repository Manager supporting all major packagi...</span><br><span class="line">[...]</span><br><span class="line"><span class="comment"># æ›´æ–°ä»“åº“</span></span><br><span class="line">~$ helm repo update</span><br><span class="line">Hang tight <span class="keyword">while</span> we grab the latest from your chart repositories...</span><br><span class="line">...Skip <span class="built_in">local</span> chart repository</span><br><span class="line">...Successfully got an update from the <span class="string">"stable"</span> chart repository</span><br><span class="line">Update Complete. âˆ Happy Helming!âˆ</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»“åº“åœ°å€</span></span><br><span class="line">~$ helm repo list</span><br><span class="line">NAME  	URL</span><br><span class="line">stable	https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="line"><span class="built_in">local</span> 	http://127.0.0.1:8879/charts</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="ä½¿ç”¨Helm-Chartéƒ¨ç½²MinIO"><a href="#ä½¿ç”¨Helm-Chartéƒ¨ç½²MinIO" class="headerlink" title="ä½¿ç”¨Helm Chartéƒ¨ç½²MinIO"></a>ä½¿ç”¨<code>Helm Chart</code>éƒ¨ç½²<code>MinIO</code></h2><ul>
<li><a href="https://docs.min.io/cn/deploy-minio-on-kubernetes.html" target="_blank" rel="noopener">MinIOä¸­æ–‡æ‰‹å†Œ</a></li>
<li>é»˜è®¤<code>standaline</code>æ¨¡å¼ä¸‹,éœ€è¦å¼€å¯<code>Beta API</code>çš„<code>Kubernetes 1.4+</code>.å¦‚æœæ²¡æœ‰å‡ºé”™å°±ä¼šè¿è¡ŒæˆåŠŸ,å¦‚ä¸‹æ‰€ç¤º.<br>å¦‚æœå‡ºé”™,æŒ‰ç…§åé¢çš„é”™è¯¯å¤„ç†.<br><code>accessKey</code>é»˜è®¤<code>access key    AKIAIOSFODNN7EXAMPLE</code><br><code>secretKey</code>é»˜è®¤<code>secret key    wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">~$ helm install stable/minio</span><br><span class="line">NAME:   snug-elk</span><br><span class="line">LAST DEPLOYED: Mon Apr 15 14:07:10 2019</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: DEPLOYED</span><br><span class="line"></span><br><span class="line">RESOURCES:</span><br><span class="line">==&gt; v1/ConfigMap</span><br><span class="line">NAME                      DATA  AGE</span><br><span class="line">snug-elk-minio-config-cm  2     0s</span><br><span class="line"></span><br><span class="line">==&gt; v1/PersistentVolumeClaim</span><br><span class="line">NAME            STATUS   VOLUME  CAPACITY  ACCESS MODES  STORAGECLASS  AGE</span><br><span class="line">snug-elk-minio  Pending  0s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Pod(related)</span><br><span class="line">NAME                             READY  STATUS   RESTARTS  AGE</span><br><span class="line">snug-elk-minio-7b9878bb66-mmx9n  0/1    Pending  0         0s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Secret</span><br><span class="line">NAME                 TYPE    DATA  AGE</span><br><span class="line">snug-elk-minio-user  Opaque  2     0s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Service</span><br><span class="line">NAME                TYPE          CLUSTER-IP     EXTERNAL-IP  PORT(S)         AGE</span><br><span class="line">snug-elk-minio-svc  LoadBalancer  10.103.48.186  &lt;pending&gt;    9000:32076/TCP  0s</span><br><span class="line"></span><br><span class="line">==&gt; v1beta1/Deployment</span><br><span class="line">NAME            READY  UP-TO-DATE  AVAILABLE  AGE</span><br><span class="line">snug-elk-minio  0/1    1           0          0s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NOTES:</span><br><span class="line"></span><br><span class="line">Minio can be accessed via port 9000 on an external IP address. Get the service external IP address by:</span><br><span class="line">kubectl get svc --namespace default -l app=snug-elk-minio</span><br><span class="line"></span><br><span class="line">Note that the public IP may take a couple of minutes to be available.</span><br><span class="line"></span><br><span class="line">You can now access Minio server on http://&lt;External-IP&gt;:9000. Follow the below steps to connect to Minio server with mc client:</span><br><span class="line"></span><br><span class="line">  1. Download the Minio mc client - https://docs.minio.io/docs/minio-client-quickstart-guide</span><br><span class="line"></span><br><span class="line">  2. mc config host add snug-elk-minio-local http://&lt;External-IP&gt;:9000 AKIAIOSFODNN7EXAMPLE wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY S3v4</span><br><span class="line"></span><br><span class="line">  3. mc ls snug-elk-minio-local</span><br><span class="line"></span><br><span class="line">Alternately, you can use your browser or the Minio SDK to access the server - https://docs.minio.io/categories/17</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥çœ‹Releaseå¯¹è±¡</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get service snug-elk-minio-svc</span><br><span class="line">NAME                 TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">snug-elk-minio-svc   LoadBalancer   10.103.48.186   &lt;pending&gt;     9000:32076/TCP   3m7s</span><br><span class="line"></span><br><span class="line">~$ kubectl  get pods</span><br><span class="line">NAME                           READY   STATUS    RESTARTS   AGE</span><br><span class="line">store-minio-75bb89c596-74nz9   0/1     Pending   0          17m</span><br><span class="line"></span><br><span class="line">~$ kubectl   describe pod  store-minio-75bb89c596-74nz9</span><br><span class="line">Name:               store-minio-75bb89c596-74nz9</span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line">~$ helm list</span><br><span class="line">NAME            REVISION        UPDATED                         STATUS          CHART           APP VERSION     NAMESPACE</span><br><span class="line">snug-elk        1               Mon Apr 15 14:07:10 2019        DEPLOYED        minio-0.5.5                     default</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…MinIOå®¢æˆ·ç«¯"><a href="#å®‰è£…MinIOå®¢æˆ·ç«¯" class="headerlink" title="å®‰è£…MinIOå®¢æˆ·ç«¯"></a>å®‰è£…<code>MinIO</code>å®¢æˆ·ç«¯</h3><ul>
<li>æŒ‰ç…§ä¸Šé¢å®‰è£…æœåŠ¡å™¨çš„<code>NOTES</code>,å®‰è£…ä¸é…ç½®å®ƒçš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ wget https://dl.minio.io/client/mc/release/linux-amd64/mc</span><br><span class="line">~$ sudo mv mc /usr/<span class="built_in">local</span>/bin &amp;&amp; chmod +x /usr/<span class="built_in">local</span>/bin/mc</span><br><span class="line">~$ kubectl get svc --namespace default -l app=snug-elk-minio</span><br><span class="line">NAME                 TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">snug-elk-minio-svc   LoadBalancer   10.103.48.186   &lt;pending&gt;     9000:32076/TCP   25h</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="å®‰è£…é›†ç¾¤ç›‘æ§DashBoard"><a href="#å®‰è£…é›†ç¾¤ç›‘æ§DashBoard" class="headerlink" title="å®‰è£…é›†ç¾¤ç›‘æ§DashBoard"></a>å®‰è£…é›†ç¾¤ç›‘æ§<code>DashBoard</code></h2><ul>
<li><a href="https://github.com/kubernetes/dashboard/wiki/Installation" target="_blank" rel="noopener">DashBoard Installation</a></li>
<li><a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/" target="_blank" rel="noopener">Web UI (Dashboard)</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl create -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥çœ‹å®‰è£…æ˜¯å¦æˆåŠŸ.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl  --namespace=kube-system get pod -l k8s-app=kubernetes-dashboard</span><br><span class="line">NAME                                    READY   STATUS             RESTARTS   AGE</span><br><span class="line">kubernetes-dashboard-5f7b999d65-m2zmt   0/1     ImagePullBackOff   0          10m</span><br><span class="line"></span><br><span class="line">~$ kubectl  --namespace=kube-system describe  pod -l k8s-app=kubernetes-dashboard | grep <span class="string">"Events"</span> -A +10</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason     Age                  From               Message</span><br><span class="line">  ----     ------     ----                 ----               -------</span><br><span class="line">  Normal   Scheduled  14m                  default-scheduler  Successfully assigned kube-system/kubernetes-dashboard-5f7b999d65-m2zmt to dig001</span><br><span class="line">  Normal   Pulling    11m (x4 over 14m)    kubelet, dig001    Pulling image <span class="string">"k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1"</span></span><br><span class="line">  Warning  Failed     11m (x4 over 13m)    kubelet, dig001    Failed to pull image <span class="string">"k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1"</span>: rpc error: code = Unknown desc = Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="keyword">while</span> waiting <span class="keyword">for</span> connection (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">  Warning  Failed     11m (x4 over 13m)    kubelet, dig001    Error: ErrImagePull</span><br><span class="line">  Warning  Failed     11m (x6 over 13m)    kubelet, dig001    Error: ImagePullBackOff</span><br><span class="line">  Normal   BackOff    4m5s (x36 over 13m)  kubelet, dig001    Back-off pulling image <span class="string">"k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æ ¹<code>kubectl -n kube-system delete $(kubectl -n kube-system get pod -o name | grep dashboard)</code>ä¸‹é¢ä¿®æ”¹å®ƒçš„é•œåƒåœ°å€,æ›¿æ¢æˆå›½å†…çš„é˜¿é‡Œäº‘çš„åœ°å€.</li>
<li>ä½¿ç”¨<code>kubectl  edit deployment/kubernetes-dashboard -n kube-system</code>æ‰“å¼€ç¼–è¾‘,æŠŠ<code>k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1</code>æ›¿æ¢æˆ<code>registry.cn-hangzhou.aliyuncs.com/google_containers/kubernetes-dashboard-amd64:v1.10.1</code>,ä¿å­˜é€€å‡º.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹å,å®‰è£…æˆäº†.</span></span><br><span class="line">~$ kubectl  --namespace=kube-system get deployment -l k8s-app=kubernetes-dashboard</span><br><span class="line">NAME                   READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">kubernetes-dashboard   1/1     1            1           51m</span><br><span class="line">~$ kubectl  --namespace=kube-system get pod -l k8s-app=kubernetes-dashboard</span><br><span class="line">NAME                                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">kubernetes-dashboard-5d9599dc98-gj8w7   1/1     Running   0          99s</span><br><span class="line">~$ kubectl  --namespace=kube-system get svc -l k8s-app=kubernetes-dashboard</span><br><span class="line">NAME                   TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubernetes-dashboard   ClusterIP   10.107.85.75   &lt;none&gt;        443/TCP   49m</span><br></pre></td></tr></table></figure>
<h3 id="ProxyåŠ SSHè½¬å‘è®¿é—®æ–¹å¼"><a href="#ProxyåŠ SSHè½¬å‘è®¿é—®æ–¹å¼" class="headerlink" title="ProxyåŠ SSHè½¬å‘è®¿é—®æ–¹å¼"></a><code>Proxy</code>åŠ <code>SSH</code>è½¬å‘è®¿é—®æ–¹å¼</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># k8sçš„æœåŠ¡å™¨ä¸Š</span></span><br><span class="line">~$ kubectl  proxy</span><br><span class="line">Starting to serve on 127.0.0.1:8001</span><br><span class="line"><span class="comment"># æ§åˆ¶ä¸»æœºä¸Šè¿è¡Œä¸‹é¢å‘½ä»¤,å†ä»æµè§ˆå™¨é‡Œæ‰“å¼€http://127.0.0.1:8001/å°±èƒ½è®¿é—®åˆ°DashBoard</span></span><br><span class="line">~$ ssh 8001:localhost:8001 &lt;user@k8s-server&gt; -Nf</span><br></pre></td></tr></table></figure>
<h3 id="ä¿®æ”¹Serviceç«¯å£ç±»å‹"><a href="#ä¿®æ”¹Serviceç«¯å£ç±»å‹" class="headerlink" title="ä¿®æ”¹Serviceç«¯å£ç±»å‹"></a>ä¿®æ”¹<code>Service</code>ç«¯å£ç±»å‹</h3><ul>
<li><p>é€šè¿‡<code>kubectl --namespace=kube-system edit svc kubernetes-dashboard</code>æ‰“å¼€ç¼–è¾‘,æŠŠ<code>type: ClusterIP</code>æ›¿æ¢æˆ<code>type: NodePort</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl --namespace=kube-system edit svc kubernetes-dashboard</span><br><span class="line">~$ kubectl --namespace=kube-system get  svc kubernetes-dashboard</span><br><span class="line">NAME                   TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)         AGE</span><br><span class="line">kubernetes-dashboard   NodePort   10.107.85.75   &lt;none&gt;        443:31690/TCP   65m</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚ä¸Šæ‰€ç¤ºå¯ä»¥é€š<code>https://&lt;service-host&gt;:31690/</code>è®¿é—®åˆ°DashBoard.</p>
</li>
</ul>
<h3 id="è®¿é—®è®¤è¯"><a href="#è®¿é—®è®¤è¯" class="headerlink" title="è®¿é—®è®¤è¯"></a>è®¿é—®è®¤è¯</h3><ul>
<li><a href="https://github.com/kubernetes/dashboard/wiki/Creating-sample-user" target="_blank" rel="noopener">Creating sample user</a></li>
<li><a href="https://github.com/kubernetes/dashboard/wiki/Access-control#authorization-header" target="_blank" rel="noopener">Access control</a></li>
<li>ç¬¬ä¸€æ¬¡æ‰“å¼€<code>DashBoard</code>ä¼šæç¤ºä¸¤ç§ç™»å½•æ–¹å¼,<code>Kubeconfig</code>ä¸<code>Token</code>.ä¸‹é¢å‚ç…§<a href="https://github.com/kubernetes/dashboard/wiki/Creating-sample-user" target="_blank" rel="noopener">Creating sample user</a>å®‰è£…ä¸€ä¸‹.</li>
</ul>
<h4 id="åˆ›å»ºæœåŠ¡å¸å·"><a href="#åˆ›å»ºæœåŠ¡å¸å·" class="headerlink" title="åˆ›å»ºæœåŠ¡å¸å·"></a>åˆ›å»ºæœåŠ¡å¸å·</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">~$ cat admin-user.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: admin-user</span><br><span class="line">  namespace: kube-system</span><br><span class="line">~$ kubectl create -f admin-user.yaml</span><br><span class="line"></span><br><span class="line">~$ kubectl -n kube-system describe secret $(kubectl -n kube-system  get secret | grep admin | awk <span class="string">'&#123;print $1&#125;'</span>)</span><br><span class="line">Name:         admin-user-token-7dj2c</span><br><span class="line">Namespace:    kube-system</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  kubernetes.io/service-account.name: admin-user</span><br><span class="line">              kubernetes.io/service-account.uid: a65538aa-673b-11e9-b8a2-00163e027e39</span><br><span class="line"></span><br><span class="line">Type:  kubernetes.io/service-account-token</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">ca.crt:     1025 bytes</span><br><span class="line">namespace:  11 bytes</span><br><span class="line">token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLTdkajJjIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJhNjU1MzhhYS02NzNiLTExZTktYjhhMi0wMDE2M2UwMjdlMzkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06YWRtaW4tdXNlciJ9.eW_YSgn_kTIQDcbB51k8HaY9LABeFg5mFFPJykYgsoyxZH_b80WEcDZn4Z4Ix2BJvhK1sBESfSa_Qn1yN5pcIzUMROIYvBGZBSnMmw2VsSpQMUTJ1ha43ql-GKCz15ro1VrhyeWeCtiVTILA0Z0DwfgO2skjY2x1KO_76sDR7r66frZDjGmgYTm-b3E6RdcETB41Wjjuj-nt3b3ZblkBr3QDKP-tlvnW_nr7LcmgF7etjU8qK_W3fj-LB_BnWRpRiamQeXLNJuC-Dq42x00gAzQuVg17rDcEiKxJWmDYYsojvm7Xg0fSwXLCdBfgysYCz5PMR05dT0QU0iYO7z_Cow</span><br></pre></td></tr></table></figure>
<ul>
<li>æ‰“å¼€DashBoardé¦–é¡µ,å¡«å…¥ä¸Šé¢çš„<code>token</code>å€¼.</li>
</ul>
<h4 id="åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š"><a href="#åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š" class="headerlink" title="åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š"></a>åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">~$ cat dashboard-admin.yaml</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: kubernetes-dashboard</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: cluster-admin</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: kubernetes-dashboard</span><br><span class="line">  namespace: kube-system</span><br><span class="line"></span><br><span class="line">~$ kubectl create -f dashboard-admin.yaml</span><br><span class="line"></span><br><span class="line">~$ kubectl -n kube-system describe secret $(kubectl -n kube-system  get secret | grep <span class="string">"kubernetes-dashboard-token"</span> |awk <span class="string">'&#123;print $1&#125;'</span>)</span><br><span class="line">Name:         kubernetes-dashboard-token-ftk96</span><br><span class="line">Namespace:    kube-system</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  kubernetes.io/service-account.name: kubernetes-dashboard</span><br><span class="line">              kubernetes.io/service-account.uid: ba35db4d-672d-11e9-b8a2-00163e027e39</span><br><span class="line"></span><br><span class="line">Type:  kubernetes.io/service-account-token</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">ca.crt:     1025 bytes</span><br><span class="line">namespace:  11 bytes</span><br><span class="line">token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZC10b2tlbi1mdGs5NiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImJhMzVkYjRkLTY3MmQtMTFlOS1iOGEyLTAwMTYzZTAyN2UzOSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTprdWJlcm5ldGVzLWRhc2hib2FyZCJ9.gnspFBWcou3-EgMsSPPQqSt1fwWne6tLCNgHa0yrQLEH9DDRgDQh1mBDne4Z2M-s3FPlTV9DI77QneanA12jHrpLHRohQSlyiz8Pv3xa7JRb7Hfyj5PhbSlX2KtTbOlVvAdlFttFi3vw-fbUJWcALEmogwa7jnlR233slJLjZ8nAA9xsE-gr4_zYmZ2VhYGfH0dAs2H2aCklRl2Sy5VQpoDlGjKH82-FcCrLwGQyLpAA9tr0H7pivGIFqO46PWR0aBLiT1BBkmjoQJkDPy0qRxi90nG1WyFnDLHYK6BRDTZ4G-J3QhAiAK0su-7i6rJhMKm-FbnYXULIstW1LyO4tg</span><br></pre></td></tr></table></figure>
<h3 id="æ›´æ–°Dashboard"><a href="#æ›´æ–°Dashboard" class="headerlink" title="æ›´æ–°Dashboard"></a>æ›´æ–°<code>Dashboard</code></h3><ul>
<li>å®‰è£…<code>Dashboard</code>å®ƒä¸ä¼šè‡ªåŠ¨æ›´æ–°å¤ç›–æœ¬åœ°æ—§çš„ç‰ˆæœ¬,å¿…é¡»è¦æ‰‹åŠ¨æ¸…é™¤çš„æ—§çš„ç‰ˆæœ¬å†å®‰è£…æ–°çš„ç‰ˆæœ¬.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl -n kube-system delete $(kubectl -n kube-system get pod -o name | grep dashboard)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="å®˜æ–¹å¿«é€Ÿå…¥é—¨å®ä¾‹æ•™ç¨‹"><a href="#å®˜æ–¹å¿«é€Ÿå…¥é—¨å®ä¾‹æ•™ç¨‹" class="headerlink" title="å®˜æ–¹å¿«é€Ÿå…¥é—¨å®ä¾‹æ•™ç¨‹"></a>å®˜æ–¹å¿«é€Ÿå…¥é—¨å®ä¾‹æ•™ç¨‹</h1><ul>
<li><a href="https://github.com/kubernetes/examples" target="_blank" rel="noopener">https://github.com/kubernetes/examples</a></li>
</ul>
<h2 id="Guestbookå®ä¾‹"><a href="#Guestbookå®ä¾‹" class="headerlink" title="Guestbookå®ä¾‹"></a><code>Guestbook</code>å®ä¾‹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/kubernetes/examples</span><br><span class="line">~$ <span class="built_in">cd</span> exmaples</span><br><span class="line">~$ tree -L 1</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ cassandra</span><br><span class="line">â”œâ”€â”€ code-of-conduct.md</span><br><span class="line">â”œâ”€â”€ CONTRIBUTING.md</span><br><span class="line">â”œâ”€â”€ guestbook</span><br><span class="line">â”œâ”€â”€ guestbook-go</span><br><span class="line">â”œâ”€â”€ guidelines.md</span><br><span class="line">â”œâ”€â”€ LICENSE</span><br><span class="line">â”œâ”€â”€ mysql-wordpress-pd</span><br><span class="line">â”œâ”€â”€ OWNERS</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ SECURITY_CONTACTS</span><br><span class="line">â””â”€â”€ staging</span><br><span class="line"></span><br><span class="line">5 directories, 7 files</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…Redis-Master-Pod"><a href="#å®‰è£…Redis-Master-Pod" class="headerlink" title="å®‰è£…Redis Master Pod"></a>å®‰è£…<code>Redis Master Pod</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cd</span> examples/guestbook$ &amp;&amp; ls *.yaml</span><br><span class="line">frontend-deployment.yaml  redis-master-deployment.yaml  redis-slave-deployment.yaml</span><br><span class="line">frontend-service.yaml     redis-master-service.yaml     redis-slave-service.yaml</span><br><span class="line">~$ cat redis-master-deployment.yaml</span><br><span class="line">apiVersion: apps/v1 <span class="comment">#  for k8s versions before 1.9.0 use apps/v1beta2  and before 1.8.0 use extensions/v1beta1</span></span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: redis-master</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: redis</span><br><span class="line">      role: master</span><br><span class="line">      tier: backend</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: redis</span><br><span class="line">        role: master</span><br><span class="line">        tier: backend</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: master</span><br><span class="line">        <span class="comment"># image: k8s.gcr.io/redis:e2e  # or just image: redis</span></span><br><span class="line">        image: forestgun007/redis:e2e</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 100Mi</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 6379</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ³¨æ„</strong>ä¸Šé¢çš„<code>k8.gcr.io</code>åœ¨å›½å†…æ˜¯ä¸èƒ½è®¿é—®çš„,æ‰€ä»¥è¦ä¿®æ”¹<code>redis-master-deployment.yaml</code>é‡Œçš„<code>image</code>,<br>è¿™é‡Œé€šè¿‡<code>docker search redis:e2e</code>æŸ¥è¯¢åˆ°ä¸€äº›<code>mirror</code>çš„é•œåƒæ–‡ä»¶.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ docker search redis:e2e</span><br><span class="line">NAME                       DESCRIPTION                          STARS               OFFICIAL            AUTOMATED</span><br><span class="line">forestgun007/redis         gcr.io/google_containers/redis:e2e   1                                       [OK]</span><br><span class="line">will835559313/gcr_redis    gcr.io/google_containers/redis:e2e   0                                       [OK]</span><br><span class="line">smallguitar/redis-master   gcr.io/google_containers/redis:e2e   0                                       [OK]</span><br><span class="line"></span><br><span class="line">~$ kubectl apply -f redis-master-deployment.yaml</span><br><span class="line">~$ kubectl get pods</span><br><span class="line">redis-slave-555b8847c4-mttt9    1/1     Running   0          16h</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…Redis-Master-Service"><a href="#å®‰è£…Redis-Master-Service" class="headerlink" title="å®‰è£…Redis Master Service"></a>å®‰è£…<code>Redis Master Service</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~$ cat redis-master-service.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: redis-master</span><br><span class="line">  labels:</span><br><span class="line">    app: redis</span><br><span class="line">    role: master</span><br><span class="line">    tier: backend</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 6379</span><br><span class="line">    targetPort: 6379</span><br><span class="line">  selector:</span><br><span class="line">    app: redis</span><br><span class="line">    role: master</span><br><span class="line">    tier: backend</span><br><span class="line">~$ kubectl apply -f redis-master-service.yaml</span><br><span class="line">~$ kubectl get service redis-master</span><br><span class="line">NAME           TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">redis-master   ClusterIP   10.106.23.86   &lt;none&gt;        6379/TCP   17h</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…Redis-Slave-Pod"><a href="#å®‰è£…Redis-Slave-Pod" class="headerlink" title="å®‰è£…Redis Slave Pod"></a>å®‰è£…<code>Redis Slave Pod</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">$ cat redis-slave-deployment.yaml</span><br><span class="line">apiVersion: apps/v1 <span class="comment">#  for k8s versions before 1.9.0 use apps/v1beta2  and before 1.8.0 use extensions/v1beta1</span></span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: redis-slave</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: redis</span><br><span class="line">      role: slave</span><br><span class="line">      tier: backend</span><br><span class="line">  replicas: 2</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: redis</span><br><span class="line">        role: slave</span><br><span class="line">        tier: backend</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: slave</span><br><span class="line">        <span class="comment"># gcr.io/google_samples/gb-redisslave:v1 åŒæ ·éœ€è¦æ”¹æˆä¸‹é¢è¿™ä¸ªé•œåƒ</span></span><br><span class="line">        image: forestgun007/gb-redisslave:v1</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 100Mi</span><br><span class="line">        env:</span><br><span class="line">        - name: GET_HOSTS_FROM</span><br><span class="line">          value: dns</span><br><span class="line">          <span class="comment"># If your cluster config does not include a dns service, then to</span></span><br><span class="line">          <span class="comment"># instead access an environment variable to find the master</span></span><br><span class="line">          <span class="comment"># service's host, comment out the 'value: dns' line above, and</span></span><br><span class="line">          <span class="comment"># uncomment the line below:</span></span><br><span class="line">          <span class="comment"># value: env</span></span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 6379</span><br><span class="line"></span><br><span class="line">~$ kubectl apply -f redis-slave-deployment.yaml</span><br><span class="line">~$ kubectl get pods</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">redis-slave-555b8847c4-mttt9    1/1     Running   0          17h</span><br><span class="line">redis-slave-555b8847c4-r24xx    1/1     Running   0          17h</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…Redis-Slave-Service"><a href="#å®‰è£…Redis-Slave-Service" class="headerlink" title="å®‰è£…Redis Slave Service"></a>å®‰è£…<code>Redis Slave Service</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl apply -f  redis-slave-service.yaml</span><br><span class="line"></span><br><span class="line">~$ kubectl get svc redis-slave</span><br><span class="line">NAME          TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">redis-slave   ClusterIP   10.103.39.53   &lt;none&gt;        6379/TCP   17h</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…Frontend-Pod"><a href="#å®‰è£…Frontend-Pod" class="headerlink" title="å®‰è£…Frontend Pod"></a>å®‰è£…<code>Frontend Pod</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">~$ cat frontend-deployment.yaml</span><br><span class="line">apiVersion: apps/v1 <span class="comment">#  for k8s versions before 1.9.0 use apps/v1beta2  and before 1.8.0 use extensions/v1beta1</span></span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: frontend</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: guestbook</span><br><span class="line">      tier: frontend</span><br><span class="line">  replicas: 3</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: guestbook</span><br><span class="line">        tier: frontend</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: php-redis</span><br><span class="line">        <span class="comment"># image: gcr.io/google-samples/gb-frontend:v4</span></span><br><span class="line">        image: forestgun007/google-samples-gb-frontend:v4</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 100Mi</span><br><span class="line">        env:</span><br><span class="line">        - name: GET_HOSTS_FROM</span><br><span class="line">          value: dns</span><br><span class="line">          <span class="comment"># If your cluster config does not include a dns service, then to</span></span><br><span class="line">          <span class="comment"># instead access environment variables to find service host</span></span><br><span class="line">          <span class="comment"># info, comment out the 'value: dns' line above, and uncomment the</span></span><br><span class="line">          <span class="comment"># line below:</span></span><br><span class="line">          <span class="comment"># value: env</span></span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line"></span><br><span class="line">~$ kubectl apply -f frontend-deployment.yaml</span><br><span class="line"></span><br><span class="line">~$ kubectl get pod</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">frontend-6f4cc58c94-2wv5l       1/1     Running   0          17h</span><br><span class="line">frontend-6f4cc58c94-s6s8l       1/1     Running   0          17h</span><br><span class="line">frontend-6f4cc58c94-z9qmk       1/1     Running   0          17h</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…Frontend-Service"><a href="#å®‰è£…Frontend-Service" class="headerlink" title="å®‰è£…Frontend Service"></a>å®‰è£…<code>Frontend Service</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl apply -f  frontend-service.yaml</span><br><span class="line">~$ kubectl get service frontend</span><br><span class="line">NAME       TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">frontend   NodePort   10.106.20.24   &lt;none&gt;        80:30577/TCP   17h</span><br></pre></td></tr></table></figure>
<h1 id="é”™è¯¯å¤„ç†-1"><a href="#é”™è¯¯å¤„ç†-1" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h1><h2 id="è¿æ¥è¯ä¹¦é”™è¯¯"><a href="#è¿æ¥è¯ä¹¦é”™è¯¯" class="headerlink" title="è¿æ¥è¯ä¹¦é”™è¯¯"></a>è¿æ¥è¯ä¹¦é”™è¯¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get node</span><br><span class="line">Unable to connect to the server: x509: certificate signed by unknown authority (possibly because of <span class="string">"crypto/rsa: verification error"</span> <span class="keyword">while</span> trying to verify candidate authority certificate <span class="string">"kubernetes"</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸Šè¿°é”™è¯¯,ä¸€èˆ¬æ˜¯åœ¨<code>kubeadm reset</code>å,æ²¡æœ‰æ›´æ–°<code>~/.kube/config</code>çš„æ–‡ä»¶å‘ç”Ÿ.<code>cp /etc/kubernetes/admin.conf ~/.kube/conf</code>å°±å¯ä»¥è§£å†³.</li>
</ul>
<h2 id="åŠ å…¥èŠ‚ç‚¹é”™è¯¯"><a href="#åŠ å…¥èŠ‚ç‚¹é”™è¯¯" class="headerlink" title="åŠ å…¥èŠ‚ç‚¹é”™è¯¯"></a>åŠ å…¥èŠ‚ç‚¹é”™è¯¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo kubeadm join 172.18.127.186:6443 --token z8r97j.3ovdfddb6df9lnq7     --discovery-token-ca-cert-hash sha256:07767a67fa6c38feda7471ee5e1a15a0a9c417cfdf6cf457ff577297f22d9415</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">	[WARNING IsDockerSystemdCheck]: detected <span class="string">"cgroupfs"</span> as the Docker cgroup driver. The recommended driver is <span class="string">"systemd"</span>. Please follow the guide at https://kubernetes.io/docs/setup/cri/</span><br><span class="line">error execution phase preflight: couldn<span class="string">'t validate the identity of the API Server: abort connecting to API servers after timeout of 5m0s</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>å¦‚æœåŠ å…¥èŠ‚ç‚¹æ—¶é—´å¾ˆé•¿,ä¸”æœ€åè¿˜å‡ºé”™äº†,åŠ å‚æ•°<code>-v=6</code>,å°±ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo kubeadm join 172.18.127.186:6443 --token z8r97j.3ovdfddb6df9lnq7     --discovery-token-ca-cert-hash sha256:07767a67fa6c38feda7471ee5e1a15a0a9c417cfdf6cf457ff577297f22d9415 -v=6</span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line">I0414 16:23:00.398178   13202 token.go:200] [discovery] Trying to connect to API Server <span class="string">"172.18.127.186:6443"</span></span><br><span class="line">I0414 16:23:00.398724   13202 token.go:75] [discovery] Created cluster-info discovery client, requesting info from <span class="string">"https://172.18.127.186:6443"</span></span><br><span class="line">I0414 16:23:00.402234   13202 round_trippers.go:438] GET https://172.18.127.186:6443/api/v1/namespaces/kube-public/configmaps/cluster-info 200 OK <span class="keyword">in</span> 3 milliseconds</span><br><span class="line">I0414 16:23:00.402426   13202 token.go:203] [discovery] Failed to connect to API Server <span class="string">"172.18.127.186:6443"</span>: token id <span class="string">"z8r97j"</span> is invalid <span class="keyword">for</span> this cluster or it has expired. Use <span class="string">"kubeadm token create"</span> on the control-plane node to create a new valid token</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœå‡ºç°ä¸Šè¿°é”™è¯¯,åœ¨MasterèŠ‚ç‚¹è¾“å…¥ä¸‹é¢å‘½ä»¤,ç”¨å®ƒè¾“å‡ºçš„<code>kubeadm join</code>å‚æ•°,åœ¨éœ€è¦æ·»åŠ çš„èŠ‚ç‚¹ä¸ºä¸Šè¿è¡Œ.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ kubeadm  token create --<span class="built_in">print</span>-join-command</span><br><span class="line"><span class="comment"># ä½¿ç”¨ä¸‹è¿°è¾“å‡º,é‡æ–°æ·»åŠ .</span></span><br><span class="line">kubeadm join 172.18.127.186:6443 --token in1l6v.ue78pr5vvr55qcad     --discovery-token-ca-cert-hash sha256:a1f80db7a76e214dd529fc2aed660d71428994d9104c1b320bf5abb6cda4b165</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="å®‰è£…chartsé”™è¯¯"><a href="#å®‰è£…chartsé”™è¯¯" class="headerlink" title="å®‰è£…chartsé”™è¯¯"></a>å®‰è£…<code>charts</code>é”™è¯¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ helm install stable/minio</span><br><span class="line">Error: could not find a ready tiller pod</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ç¬¬ä¸€æ­¥,æ›´æ–°ä¸€ä¸‹ä»“åº“</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ helm init --upgrade</span><br><span class="line"><span class="variable">$HELM_HOME</span> has been configured at /home/lcy/.helm.</span><br><span class="line"></span><br><span class="line">Tiller (the Helm server-side component) has been upgraded to the current version.</span><br><span class="line">Happy Helming!</span><br><span class="line"></span><br><span class="line">~$ helm repo list</span><br><span class="line">NAME    URL</span><br><span class="line">stable  https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="line"><span class="built_in">local</span>   http://127.0.0.1:8879/charts</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹<code>k8s</code>çš„å­ç³»ç»Ÿ<code>Pod</code>çš„çŠ¶æ€,æŸ¥çœ‹<code>tiller-deploy</code>éƒ¨åˆ†.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl  -n kube-system get po</span><br><span class="line">NAME                                       READY   STATUS         RESTARTS   AGE</span><br><span class="line">calico-kube-controllers-5cbcccc885-krbzj   1/1     Running        0          17h</span><br><span class="line">[]...]</span><br><span class="line">kube-scheduler-k8s-master                  1/1     Running        0          18h</span><br><span class="line">tiller-deploy-c48485567-m7kj2              0/1     ErrImagePull   0          2m50s</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ ¹æ®ä¸Šè¿°è¾“å‡º,<code>tiller-deploy</code>æ‹‰å–é•œåƒå¤±è´¥,æ²¡æœ‰è¿è¡Œèµ·,ä¸‹é¢å†æŸ¥çœ‹è¯¦æƒ….</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl  describe pod tiller-deploy-c48485567-m7kj2   -n kube-system</span><br><span class="line">Name:               tiller-deploy-c48485567-m7kj2</span><br><span class="line">[...]</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason     Age                 From               Message</span><br><span class="line">  ----     ------     ----                ----               -------</span><br><span class="line">  Normal   Scheduled  16m                 default-scheduler  Successfully assigned kube-system/tiller-deploy-c48485567-m7kj2 to dig001</span><br><span class="line">  Normal   Pulling    14m (x4 over 16m)   kubelet, dig001    Pulling image <span class="string">"gcr.io/kubernetes-helm/tiller:v2.13.1"</span></span><br><span class="line">  Warning  Failed     13m (x4 over 16m)   kubelet, dig001    Failed to pull image <span class="string">"gcr.io/kubernetes-helm/tiller:v2.13.1"</span>: rpc error: code = Unknown desc = Error response from daemon: Get https://gcr.io/v2/: net/http: request canceled <span class="keyword">while</span> waiting <span class="keyword">for</span> connection (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">  Warning  Failed     13m (x4 over 16m)   kubelet, dig001    Error: ErrImagePull</span><br><span class="line">  Warning  Failed     13m (x7 over 16m)   kubelet, dig001    Error: ImagePullBackOff</span><br><span class="line">  Normal   BackOff    82s (x57 over 16m)  kubelet, dig001    Back-off pulling image <span class="string">"gcr.io/kubernetes-helm/tiller:v2.13.1"</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>å› ä¸ºä½¿ç”¨è¦<code>gcr.io</code>çš„ä»“åº“é€ æˆæ‹‰å–å¤±è´¥,ä¸‹é¢é€šè¿‡<code>docker search tiller | grep &quot;Mirror&quot;</code>é€‰å–ä¸€ä¸ª,å†é€šè¿‡ä¸‹é¢å‘½ä»¤ä¿®æ”¹å®ƒ.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl edit deploy tiller-deploy -n kube-system</span><br><span class="line">[....]</span><br></pre></td></tr></table></figure>
</li>
<li><p>å°†ä¸Šè¿°ä¸­çš„<code>image  gcr.io/kubernetes-helm/tiller:v2.13.1</code> æ›¿æ¢æˆ<code>image: sapcc/tiller:v2.13.1</code>,ä¸‹é¢å†è¿è¡Œå°±ä¼šæ˜¾ç¤º<code>tiller</code>æˆåŠŸè¿è¡Œ.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get pod -n kube-system | grep <span class="string">"tiller"</span></span><br><span class="line">tiller-deploy-b7bd9495c-bf777              1/1     Running   0          2m57s</span><br><span class="line">~$ helm version</span><br><span class="line">Client: &amp;version.Version&#123;SemVer:<span class="string">"v2.13.1"</span>, GitCommit:<span class="string">"618447cbf203d147601b4b9bd7f8c37a5d39fbb4"</span>, GitTreeState:<span class="string">"clean"</span>&#125;</span><br><span class="line">Server: &amp;version.Version&#123;SemVer:<span class="string">"v2.13.1"</span>, GitCommit:<span class="string">"618447cbf203d147601b4b9bd7f8c37a5d39fbb4"</span>, GitTreeState:<span class="string">"clean"</span>&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Error-no-available-release-name-found"><a href="#Error-no-available-release-name-found" class="headerlink" title="Error: no available release name found"></a>Error: no available release name found</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl create serviceaccount --namespace kube-system tiller</span><br><span class="line">~$ kubectl create clusterrolebinding tiller-cluster-rule --clusterrole=cluster-admin --serviceaccount=kube-system:tiller</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/tiller-cluster-rule created</span><br><span class="line">~$ kubectl patch deploy --namespace kube-system tiller-deploy -p \<span class="string">'&#123;"spec":&#123;"template":&#123;"spec":&#123;"serviceAccount":"tiller"&#125;&#125;&#125;&#125;\'</span></span><br><span class="line">deployment.extensions/tiller-deploy patched</span><br></pre></td></tr></table></figure>
<h2 id="kubeadmåˆå§‹åŒ–é”™è¯¯"><a href="#kubeadmåˆå§‹åŒ–é”™è¯¯" class="headerlink" title="kubeadmåˆå§‹åŒ–é”™è¯¯"></a><code>kubeadm</code>åˆå§‹åŒ–é”™è¯¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo kubeadm init --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers  --kubernetes-version v1.14.1 --pod-network-cidr=10.244.0.0/16</span><br><span class="line">[init] Using Kubernetes version: v1.14.1</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">[preflight] WARNING: Couldn\<span class="string">'t create the interface used for talking to the container runtime: docker is required for container runtime: exec: "docker": executable file not found in $PATH</span></span><br><span class="line"><span class="string">error execution phase preflight: [preflight] Some fatal errors occurred:</span></span><br><span class="line"><span class="string">	[ERROR NumCPU]: the number of available CPUs 1 is less than the required 2</span></span><br><span class="line"><span class="string">	[ERROR FileContent--proc-sys-net-bridge-bridge-nf-call-iptables]: /proc/sys/net/bridge/bridge-nf-call-iptables does not exist</span></span><br><span class="line"><span class="string">	[ERROR FileContent--proc-sys-net-ipv4-ip_forward]: /proc/sys/net/ipv4/ip_forward contents are not set to 1</span></span><br><span class="line"><span class="string">[preflight] If you know what you are doing, you can make a check non-fatal with  `--ignore-preflight-errors=...`</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>ERROR NumCPU</code>åŠ å…¥è¿è¡Œå‚æ•°<code>--ignore-preflight-errors=NumCPU</code>å°±å˜æˆè­¦å‘Šäº†.</li>
<li><p><code>FileContent--proc-sys-net-bridge-bridge-nf-call-iptables</code>é”™è¯¯å¤„ç†å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~$ apt-get install bridge-utils</span><br><span class="line"><span class="comment"># æœ‰å¯èƒ½è¦é‡å¯</span></span><br><span class="line">~$ modprobe bridge</span><br><span class="line">~$ modprobe br_netfilter</span><br><span class="line"></span><br><span class="line">~$ cat &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">~$ sysctl --system</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>kube-proxy</code>ä¸<code>iptables</code>çš„é—®é¢˜</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl -n kube-system logs  kube-proxy-xxx</span><br><span class="line">W0514 00:21:27.445425       1 server_others.go:267] Flag proxy-mode=<span class="string">""</span> unknown, assuming iptables proxy</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat mysql-pass.yaml</span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql-pass</span><br><span class="line"><span class="built_in">type</span>: Opaque</span><br><span class="line">data:</span><br><span class="line">  username: cm9vdA==</span><br><span class="line">  password: cGFzczEyMw==</span><br></pre></td></tr></table></figure>
<h1 id="è°¢è°¢æ”¯æŒ"><a href="#è°¢è°¢æ”¯æŒ" class="headerlink" title="è°¢è°¢æ”¯æŒ"></a>è°¢è°¢æ”¯æŒ</h1><ul>
<li>å¾®ä¿¡äºŒç»´ç :</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/02/ç©è½¬FPGA-DE0-Nano/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/02/ç©è½¬FPGA-DE0-Nano/" class="post-title-link" itemprop="url">ç©è½¬FPGA_DE0-Nano</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-02-02 19:01:27" itemprop="dateCreated datePublished" datetime="2021-02-02T19:01:27+08:00">2021-02-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-03-19 16:27:56" itemprop="dateModified" datetime="2022-03-19T16:27:56+08:00">2022-03-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>Links:<ul>
<li><a href="http://www.nxlab.fer.hr/fpgarduino/" target="_blank" rel="noopener">fpgarduino</a></li>
<li><a href="https://idlelogiclabs.com/2012/04/15/talking-to-the-de0-nano-using-the-virtual-jtag-interface/" target="_blank" rel="noopener">talking-to-the-de0-nano-using-the-virtual-jtag-interface</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Altera_Design_Software" target="_blank" rel="noopener">Altera_Design_Software</a></li>
</ul>
<ul>
<li>OpenRISC<ul>
<li><a href="https://www.kernel.org/doc/html/latest/openrisc/openrisc_port.html" target="_blank" rel="noopener">OpenRISC Linux</a></li>
<li><a href="https://github.com/olofk/fusesoc" target="_blank" rel="noopener">FuseSoC</a></li>
<li><a href="https://github.com/fusesoc/fusesoc-cores" target="_blank" rel="noopener">FuseSoC standard core library</a></li>
<li><a href="https://matbaj.github.io/2015/01/19/openrisc-on-de2-115/" target="_blank" rel="noopener">Getting started with OpenRISC on Altera Terasic de2-115 board</a></li>
<li><a href="https://kevinmehall.net/openrisc/guide/" target="_blank" rel="noopener">Getting Started with OpenRISC</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="å¼€æ¿æ¿ç®€ä»‹"><a href="#å¼€æ¿æ¿ç®€ä»‹" class="headerlink" title="å¼€æ¿æ¿ç®€ä»‹"></a>å¼€æ¿æ¿ç®€ä»‹</h1><h2 id="ç®¡è„šå®šä¹‰"><a href="#ç®¡è„šå®šä¹‰" class="headerlink" title="ç®¡è„šå®šä¹‰"></a>ç®¡è„šå®šä¹‰</h2><ul>
<li>ä¸‹é¢æ•°æ®æ¥æºäº<code>DE0_Nano_User_Manual.pdf</code>çš„<code>Chapter 3-3.5 Expansion headers</code>.</li>
</ul>
<h3 id="GPIO-0-Pin-Assignments"><a href="#GPIO-0-Pin-Assignments" class="headerlink" title="GPIO-0 Pin Assignments"></a>GPIO-0 Pin Assignments</h3><table>
<thead>
<tr>
<th>Signal Name</th>
<th>FPGA Pin No.</th>
<th>Descritption</th>
<th>I/O Standard</th>
</tr>
</thead>
<tbody>
<tr>
<td>GPIO_0_IN0</td>
<td>PIN_A8</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_00</td>
<td>PIN_D3</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_0_IN1</td>
<td>PIN_B8</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_01</td>
<td>PIN_C3</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_02</td>
<td>PIN_A2</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_03</td>
<td>PIN_A3</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_04</td>
<td>PIN_B3</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_05</td>
<td>PIN_B4</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_06</td>
<td>PIN_A4</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_07</td>
<td>PIN_B5</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_08</td>
<td>PIN_A5</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_09</td>
<td>PIN_D5</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_010</td>
<td>PIN_B6</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_011</td>
<td>PIN_A6</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_012</td>
<td>PIN_B7</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_013</td>
<td>PIN_D6</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_014</td>
<td>PIN_A7</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_015</td>
<td>PIN_C6</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_016</td>
<td>PIN_C8</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_017</td>
<td>PIN_E6</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_018</td>
<td>PIN_E7</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_019</td>
<td>PIN_D8</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_020</td>
<td>PIN_E8</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_021</td>
<td>PIN_F8</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_022</td>
<td>PIN_F9</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_023</td>
<td>PIN_E9</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_024</td>
<td>PIN_C9</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_025</td>
<td>PIN_D9</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_026</td>
<td>PIN_E11</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_027</td>
<td>PIN_E10</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_028</td>
<td>PIN_C11</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_029</td>
<td>PIN_B11</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_030</td>
<td>PIN_A12</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_031</td>
<td>PIN_D11</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_032</td>
<td>PIN_D12</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_033</td>
<td>PIN_B12</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
</tbody>
</table>
<h3 id="GPIO-1-Pin-Assignments"><a href="#GPIO-1-Pin-Assignments" class="headerlink" title="GPIO-1 Pin Assignments"></a>GPIO-1 Pin Assignments</h3><table>
<thead>
<tr>
<th>Signal Name</th>
<th>FPGA Pin No.</th>
<th>Descritption</th>
<th>I/O Standard</th>
</tr>
</thead>
<tbody>
<tr>
<td>GPIO_1_IN0</td>
<td>PIN_T9</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_10</td>
<td>PIN_F13</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_1_IN1</td>
<td>PIN_R9</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_11</td>
<td>PIN_T15</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_12</td>
<td>PIN_T14</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_13</td>
<td>PIN_T13</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_14</td>
<td>PIN_R13</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_15</td>
<td>PIN_T12</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_16</td>
<td>PIN_R12</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_17</td>
<td>PIN_T11</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_18</td>
<td>PIN_T10</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_19</td>
<td>PIN_R11</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_110</td>
<td>PIN_P11</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_111</td>
<td>PIN_R10</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_112</td>
<td>PIN_N12</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_113</td>
<td>PIN_P9</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_114</td>
<td>PIN_N9</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_115</td>
<td>PIN_N11</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_116</td>
<td>PIN_L16</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_117</td>
<td>PIN_K16</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_118</td>
<td>PIN_R16</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_119</td>
<td>PIN_L15</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_120</td>
<td>PIN_P15</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_121</td>
<td>PIN_P16</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_122</td>
<td>PIN_R14</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_123</td>
<td>PIN_N16</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_124</td>
<td>PIN_N15</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_125</td>
<td>PIN_P14</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_126</td>
<td>PIN_L14</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_127</td>
<td>PIN_N14</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_128</td>
<td>PIN_M10</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_129</td>
<td>PIN_L13</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_130</td>
<td>PIN_J16</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_131</td>
<td>PIN_K15</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_132</td>
<td>PIN_J13</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_133</td>
<td>PIN_J14</td>
<td>GPIO Connection DATA</td>
<td>3.3V</td>
</tr>
</tbody>
</table>
<h3 id="Table-3-8-Pin-Assignments-for-2x13-Header"><a href="#Table-3-8-Pin-Assignments-for-2x13-Header" class="headerlink" title="Table 3-8 Pin Assignments for 2x13 Header"></a>Table 3-8 Pin Assignments for 2x13 Header</h3><table>
<thead>
<tr>
<th>Signal Name</th>
<th>FPGA Pin No.</th>
<th>Descritption</th>
<th>I/O Standard</th>
</tr>
</thead>
<tbody>
<tr>
<td>GPIO_2[0]</td>
<td>PIN_A14</td>
<td>GPIO Connection DATA[0]</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_2[1]</td>
<td>PIN_B16</td>
<td>GPIO Connection DATA[1]</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_2[2]</td>
<td>PIN_C14</td>
<td>GPIO Connection DATA[2]</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_2[3]</td>
<td>PIN_C16</td>
<td>GPIO Connection DATA[3]</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_2[4]</td>
<td>PIN_C15</td>
<td>GPIO Connection DATA[4]</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_2[5]</td>
<td>PIN_D16</td>
<td>GPIO Connection DATA[5]</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_2[6]</td>
<td>PIN_D15</td>
<td>GPIO Connection DATA[6]</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_2[7]</td>
<td>PIN_D14</td>
<td>GPIO Connection DATA[7]</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_2[8]</td>
<td>PIN_F15</td>
<td>GPIO Connection DATA[8]</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_2[9]</td>
<td>PIN_F16</td>
<td>GPIO Connection DATA[9]</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_2[10]</td>
<td>PIN_F14</td>
<td>GPIO Connection DATA[10]</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_2[11]</td>
<td>PIN_G16</td>
<td>GPIO Connection DATA[11]</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_2[12]</td>
<td>PIN_G15</td>
<td>GPIO Connection DATA[12]</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_2_IN[0]</td>
<td>PIN_E15</td>
<td>GPIO Input</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_2_IN[1]</td>
<td>PIN_E16</td>
<td>GPIO Input</td>
<td>3.3V</td>
</tr>
<tr>
<td>GPIO_2_IN[2]</td>
<td>PIN_M16</td>
<td>GPIO Input</td>
<td>3.3V</td>
</tr>
</tbody>
</table>
<h3 id="Table-3-9-Pin-Assignments-for-ADC"><a href="#Table-3-9-Pin-Assignments-for-ADC" class="headerlink" title="Table 3-9 Pin Assignments for ADC"></a>Table 3-9 Pin Assignments for ADC</h3><table>
<thead>
<tr>
<th>Signal Name</th>
<th>FPGA Pin No.</th>
<th>Descritption</th>
<th>I/O Standard</th>
</tr>
</thead>
<tbody>
<tr>
<td>ADC_CS_N</td>
<td>PIN_A10</td>
<td>Chip select</td>
<td>3.3V</td>
</tr>
<tr>
<td>ADC_SADDR</td>
<td>PIN_B10</td>
<td>Digital data input</td>
<td>3.3V</td>
</tr>
<tr>
<td>ADC_SDAT</td>
<td>PIN_A9</td>
<td>Digital data output</td>
<td>3.3V</td>
</tr>
<tr>
<td>ADC_SCLK</td>
<td>PIN_B14</td>
<td>Digital clock input</td>
<td>3.3V</td>
</tr>
</tbody>
</table>
<h3 id="JTAG"><a href="#JTAG" class="headerlink" title="JTAG"></a>JTAG</h3><p><img src="/imgs/de0-nano-jtag-block.png" alt="de0-nano-jtag-block.png"></p>
<h1 id="OpenRisc"><a href="#OpenRisc" class="headerlink" title="OpenRisc"></a>OpenRisc</h1><h2 id="GCCå·¥å…·é“¾"><a href="#GCCå·¥å…·é“¾" class="headerlink" title="GCCå·¥å…·é“¾"></a>GCCå·¥å…·é“¾</h2><ul>
<li><a href="https://github.com/stffrdhrn/or1k-toolchain-build" target="_blank" rel="noopener">or1k-toolchain-build</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/stffrdhrn/or1k-toolchain-build</span><br><span class="line">~$ <span class="built_in">cd</span> or1k-toolchain-build</span><br><span class="line">~$ docker build -t or1k-toolchain-build or1k-toolchain-build/</span><br></pre></td></tr></table></figure>
<ul>
<li>è®¾ç½®æŒ‚è½½ç›®å½•å˜é‡,è¿è¡Œå®¹å™¨ç¼–è¯‘.å¦‚æœ<code>build-gcc.sh</code>å†…çš„èµ„æºé“¾æ¥å¤±æ•ˆäº†,éœ€è¦æ‰¾ä¸€ä¸ªæ›¿ä»£ä¿®æ”¹å®ƒ,å¦‚ï¼š<code>QEMU_URL=https://github.com/vamanea/qemu-or32/archive/v2.0.2.tar.gz</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The location where you have tarballs, so they dont need to be</span></span><br><span class="line"><span class="comment"># downloaded every time you build</span></span><br><span class="line">CACHEDIR=/home/user/work/docker/volumes/src</span><br><span class="line"><span class="comment"># The location where you want your output to go</span></span><br><span class="line">OUTPUTDIR=/home/user/work/docker/volumes/crosstool</span><br><span class="line"></span><br><span class="line">docker run -it --rm \</span><br><span class="line">  -e MUSL_ENABLED=1 \</span><br><span class="line">  -e NEWLIB_ENABLED=1 \</span><br><span class="line">  -e NOLIB_ENABLED=1 \</span><br><span class="line">  -e GCC_VERSION=9.0.1 \</span><br><span class="line">  -e BINUTILS_VERSION=2.32.51 \</span><br><span class="line">  -e LINUX_HEADERS_VERSION=4.19.1 \</span><br><span class="line">  -e MUSL_VERSION=1.1.20 \</span><br><span class="line">  -e GMP_VERSION=6.1.2 \</span><br><span class="line">  -v <span class="variable">$&#123;OUTPUTDIR&#125;</span>:/opt/crosstool:Z \</span><br><span class="line">  -v <span class="variable">$&#123;CACHEDIR&#125;</span>:/opt/crossbuild/cache:Z \</span><br><span class="line">    or1k-toolchain-build</span><br></pre></td></tr></table></figure>
<ul>
<li>ç¼–è¯‘æˆåŠŸå,å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ls</span><br><span class="line">or1k-elf-9.0.1-20210204.tar.xz</span><br><span class="line">or1k-elf-gcc-9.0.1-20210204.log.gz</span><br><span class="line">or1k-elf-gcc-9.0.1-20210204.sum</span><br><span class="line">or1k-elf-gxx-9.0.1-20210204.log.gz</span><br><span class="line">or1k-elf-gxx-9.0.1-20210204.sum</span><br><span class="line">or1k-linux-9.0.1-20210204.tar.xz</span><br><span class="line">or1k-linux-musl-9.0.1-20210204.tar.xz</span><br><span class="line">or1k-linux-musl-gcc-9.0.1-20210203.log.gz</span><br><span class="line">or1k-linux-musl-gcc-9.0.1-20210203.sum</span><br><span class="line">or1k-linux-musl-gcc-9.0.1-20210204.log.gz</span><br><span class="line">or1k-linux-musl-gcc-9.0.1-20210204.sum</span><br><span class="line">or1k-linux-musl-gxx-9.0.1-20210203.log.gz</span><br><span class="line">or1k-linux-musl-gxx-9.0.1-20210203.sum</span><br><span class="line">or1k-linux-musl-gxx-9.0.1-20210204.log.gz</span><br><span class="line">or1k-linux-musl-gxx-9.0.1-20210204.sum</span><br><span class="line">relnotes-9.0.1-20210204.md</span><br></pre></td></tr></table></figure>
<ul>
<li><p>è¿™é‡ŒæŠŠ<code>or1k-linux-9.0.1-20210204.tar.xz</code>è§£å‹å®‰è£…åˆ°æœ¬åœ°,å¹¶è®¾ç½®ç›¸åº”çš„ç¯å¢ƒå˜é‡å¦‚ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ALTERA_PATH=<span class="string">"/home/michael/3TB-DISK/intelFPGA_lite/20.1/"</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ALTERA_PATH</span>/quartus/bin</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> ARCH=openrisc</span><br><span class="line"><span class="built_in">export</span> CROSS_COMPILE=or1k-linux-</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:`<span class="built_in">pwd</span>`/toolchain-rootfs/or1k-linux/bin</span><br></pre></td></tr></table></figure>
</li>
<li><p>æˆ–è€…å•ç‹¬ç¼–è¯‘<code>or1k-gcc</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/openrisc/or1k-gcc</span><br><span class="line">~$ <span class="built_in">cd</span> or1k-gcc/</span><br><span class="line">~$ mkdir build-linux</span><br><span class="line">~$ <span class="built_in">cd</span> build-linux &amp;&amp; ../configure &amp;&amp; make -j4</span><br><span class="line">~$ make install DESTPATH=&lt;absolute  path&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="ç¼–è¯‘ORPSOC"><a href="#ç¼–è¯‘ORPSOC" class="headerlink" title="ç¼–è¯‘ORPSOC"></a>ç¼–è¯‘<code>ORPSOC</code></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/mczerski/orpsoc-de0_nano</span><br><span class="line">~$ <span class="built_in">export</span> ALTERA_PATH=<span class="string">"/home/fullpath/QuartusIIWebEdition13.0.0.156/quartus"</span></span><br><span class="line">~$ <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ALTERA_PATH</span>/bin</span><br><span class="line">~$ make OR32_TOOL_PREFIX=or1k-linux- all</span><br></pre></td></tr></table></figure>
<h2 id="ç¼–è¯‘Linux"><a href="#ç¼–è¯‘Linux" class="headerlink" title="ç¼–è¯‘Linux"></a>ç¼–è¯‘Linux</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ tar xvf linux-4.16.14.tar.xz</span><br><span class="line">~$ <span class="built_in">cd</span> linux-4.16.14</span><br><span class="line">~$ wget -c https://kevinmehall.net/openrisc/guide/de0_nano.dts.txt -O arch/openrisc/boot/dts/de0_nano.dts</span><br><span class="line"></span><br><span class="line">~$ make ARCH=openrisc CROSS_COMPILE=<span class="string">"or1k-linux-"</span> or1ksim_defconfig</span><br><span class="line">/** Select Processor <span class="built_in">type</span> and Features -&gt; Builtin DTB and <span class="built_in">type</span> de0_nano */</span><br><span class="line">~$ make ARCH=openrisc CROSS_COMPILE=<span class="string">"or1k-linux-"</span> menuconfig</span><br><span class="line">~$ make ARCH=openrisc CROSS_COMPILE=<span class="string">"or1k-linux-"</span></span><br></pre></td></tr></table></figure>
<h2 id="çƒ§å†™å…¥bitstream"><a href="#çƒ§å†™å…¥bitstream" class="headerlink" title="çƒ§å†™å…¥bitstream"></a>çƒ§å†™å…¥bitstream</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cd</span> orpsoc/boards/altera/de0_nano/syn/quartus/run</span><br><span class="line">~$ make OR32_TOOL_PREFIX=or1k-linux- all</span><br><span class="line">~$ make pgm</span><br></pre></td></tr></table></figure>
<h2 id="è¿æ¥ä¸²å·"><a href="#è¿æ¥ä¸²å·" class="headerlink" title="è¿æ¥ä¸²å·"></a>è¿æ¥ä¸²å·</h2><ul>
<li>æ ¹æ®ä¸Šé¢<code>GPIO</code>çš„ç®¡è„šå®šä¹‰,ä»¥åŠä¸‹é¢çš„ä¿¡æ¯,è¿æ¥æ­£ç¡®çš„<code>rx,tx</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat boards/altera/de0_nano/syn/quartus/tcl/UART0_pin_assignments.tcl</span><br><span class="line">set_location_assignment PIN_D8 -to uart0_srx_pad_i</span><br><span class="line">set_instance_assignment -name IO_STANDARD <span class="string">"3.3-V LVTTL"</span> -to uart0_srx_pad_i</span><br><span class="line">set_location_assignment PIN_F8 -to uart0_stx_pad_o</span><br><span class="line">set_instance_assignment -name IO_STANDARD <span class="string">"3.3-V LVTTL"</span> -to uart0_stx_pad_o</span><br></pre></td></tr></table></figure>
<h1 id="FuseSOC-è¯•ç”¨"><a href="#FuseSOC-è¯•ç”¨" class="headerlink" title="FuseSOC è¯•ç”¨"></a>FuseSOC è¯•ç”¨</h1><ul>
<li><a href="https://fusesoc.readthedocs.io/en/stable/user/index.html" target="_blank" rel="noopener">FuseSoC User Guide</a></li>
<li><a href="https://stffrdhrn.github.io/hardware/embedded/openrisc/2019/06/11/or1k_marocchino.html" target="_blank" rel="noopener">OR1K Marocchino in Action</a></li>
</ul>
<h2 id="å®‰è£…fuseSoc"><a href="#å®‰è£…fuseSoc" class="headerlink" title="å®‰è£…fuseSoc"></a>å®‰è£…fuseSoc</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">~$ git <span class="built_in">clone</span> https://github.com/olofk/fusesoc</span><br><span class="line"></span><br><span class="line">~$ <span class="built_in">cd</span> fusesoc &amp;&amp; pip install -e .</span><br><span class="line"></span><br><span class="line">OR</span><br><span class="line">~$ pip install fusesoc</span><br></pre></td></tr></table></figure>
<h2 id="å®‰è£…fusesoc-åº“"><a href="#å®‰è£…fusesoc-åº“" class="headerlink" title="å®‰è£…fusesoc åº“"></a>å®‰è£…fusesoc åº“</h2><ul>
<li>ä»ç½‘ç»œå®‰è£….</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ fusesoc library add intgen https://github.com/openrisc/intgen.git</span><br></pre></td></tr></table></figure>
<ul>
<li>ä»æœ¬åœ°å®‰è£…</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/openrisc/mor1kx-generic.git</span><br><span class="line">~$ git <span class="built_in">clone</span> https://github.com/openrisc/or1k_marocchino.git</span><br><span class="line"></span><br><span class="line">~$ fusesoc library add mor1kx-generic `<span class="built_in">pwd</span>`/mor1kx-generic</span><br><span class="line">~$ fusesoc library add or1k_marocchino `<span class="built_in">pwd</span>`/or1k_marocchino</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~$ fusesoc list-cores</span><br><span class="line">Available cores:</span><br><span class="line"></span><br><span class="line">Core                      Cache status  Description</span><br><span class="line">================================================================================</span><br><span class="line">::blinky:0               :      <span class="built_in">local</span> : &lt;No description&gt;</span><br><span class="line">::intgen:0               :      <span class="built_in">local</span> : Interrupt Generator For testing Processors</span><br><span class="line">::mor1kx-generic:1.1     :      <span class="built_in">local</span> : Minimal mor1kx simulation environment</span><br><span class="line">::or1k_marocchino:5.0-r3 :      <span class="built_in">local</span> : &lt;No description&gt;</span><br><span class="line">::plights:0              :      <span class="built_in">local</span> : &lt;No description&gt;</span><br><span class="line">::rv_sopc:0              :      <span class="built_in">local</span> : RISC V system on programmable chip example</span><br><span class="line">::wb_intercon_gen_ng:0   :      <span class="built_in">local</span> : CAPI=2 .core file description based Wishbone Interconnect generator</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥çœ‹<code>fusesoc.conf</code>é…ç½®.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">~$ cat fusesoc.conf</span><br><span class="line">[library.mor1kx-generic]</span><br><span class="line">location = /fullpath/FPGA-DE0-Nano/openrisc/mor1kx-generic</span><br><span class="line">sync-uri = /fullpath/FPGA-DE0-Nano/openrisc/mor1kx-generic</span><br><span class="line">sync-type = <span class="built_in">local</span></span><br><span class="line">auto-sync = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[library.or1k_marocchino]</span><br><span class="line">location = /fullpath/FPGA-DE0-Nano/openrisc/or1k_marocchino</span><br><span class="line">sync-uri = /fullpath/FPGA-DE0-Nano/openrisc/or1k_marocchino</span><br><span class="line">sync-type = <span class="built_in">local</span></span><br><span class="line">auto-sync = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[library.intgen]</span><br><span class="line">location = /fullpath/FPGA-DE0-Nano/openrisc/intgen</span><br><span class="line">sync-uri = /fullpath/FPGA-DE0-Nano/openrisc/intgen</span><br><span class="line">sync-type = <span class="built_in">local</span></span><br><span class="line">auto-sync = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[library.fusesoc-demos]</span><br><span class="line">location = fusesoc_libraries/fusesoc-demos</span><br><span class="line">sync-uri = https://github.com/Oxore/fusesoc-demos</span><br><span class="line">sync-type = git</span><br><span class="line">auto-sync = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h2 id="Fusesoc-demos"><a href="#Fusesoc-demos" class="headerlink" title="Fusesoc-demos"></a>Fusesoc-demos</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fusesoc library add  https://github.com/Oxore/fusesoc-demos</span><br></pre></td></tr></table></figure>
<h1 id="RISC-V"><a href="#RISC-V" class="headerlink" title="RISC-V"></a>RISC-V</h1><ul>
<li>links:<ul>
<li><a href="https://github.com/litex-hub/linux-on-litex-vexriscv" target="_blank" rel="noopener">linux-on-litex-vexriscv</a></li>
<li><a href="https://github.com/SpinalHDL/VexRiscv" target="_blank" rel="noopener">VexRiscv</a></li>
</ul>
</li>
</ul>
<h2 id="å®‰è£…Quartus20"><a href="#å®‰è£…Quartus20" class="headerlink" title="å®‰è£…Quartus20"></a>å®‰è£…<code>Quartus20</code></h2><ul>
<li>è¿™é‡Œåªæ˜¯å®‰è£…<a href="https://fpgasoftware.intel.com/20.1.1/?edition=lite&amp;platform=linux" target="_blank" rel="noopener">QuartusLiteSetup-20.1.1.720-linux.run</a>å†åŠ ä¸¤ä¸ªè®¾å¤‡æ–‡ä»¶,æ²¡ä¸‹è½½æ•´ä¸ªå®‰è£…<code>tar</code>åŒ…,æ€»åŒ…ä½“ç§¯åœ¨<code>6.5GB</code>å·¦å³.<br><img src="/imgs/quartus-20.1-installation.png" alt="quartus-20.1-installation.png"></li>
</ul>
<h2 id="litex-boardsæµ‹è¯•ç¼–è¯‘"><a href="#litex-boardsæµ‹è¯•ç¼–è¯‘" class="headerlink" title="litex-boardsæµ‹è¯•ç¼–è¯‘"></a>litex-boardsæµ‹è¯•ç¼–è¯‘</h2><ul>
<li>è¿™é‡Œä½¿ç”¨<code>litex-hub</code>é‡Œçš„é¡¹ç›®æµ‹è¯•,<code>Quartus</code>å®‰è£…åˆ°<code>~/intelFPGA_lite/20.1/quartus</code>ç›®å½•ä¸‹.æ³¨æ„,åŠ ä¸Š<code>--load</code>å‚æ•°é¡¹,å¿…é¡»å…ˆè¿è¡Œ<code>jtagd</code>æœåŠ¡,å¦åˆ™<code>quartus_pgm</code>æ— æ³•è¿›è¡Œ<code>jtag</code>çƒ§å†™.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">export</span> PATH=~/riscv64-toolchain/bin:~/intelFPGA_lite/20.1/quartus/bin:<span class="variable">$PATH</span></span><br><span class="line">~$ jtagd --foreground --debug</span><br><span class="line">~$ <span class="built_in">cd</span> litex-boards/litex_boards</span><br><span class="line">~$ targets/terasic_de0nano.py --uart-name=jtag_uart --build --load</span><br></pre></td></tr></table></figure>
<ul>
<li>å…¶å®æœ€ç»ˆçš„ç¼–è¯‘è„šæœ¬æ˜¯å¦‚ä¸‹å†…å®¹.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">linux-on-litex-vexriscv$ cat build/de0nano/gateware/build_de0nano.sh</span><br><span class="line"><span class="comment"># Autogenerated by LiteX / git: 55a79030</span></span><br><span class="line">quartus_map --read_settings_files=on  --write_settings_files=off de0nano -c de0nano</span><br><span class="line">quartus_fit --read_settings_files=off --write_settings_files=off de0nano -c de0nano</span><br><span class="line">quartus_asm --read_settings_files=off --write_settings_files=off de0nano -c de0nano</span><br><span class="line">quartus_sta de0nano -c de0nano</span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">"de0nano.sof"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    quartus_cpf -c de0nano.sof de0nano.rbf</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h2 id="linux-on-litex-vexriscvç¼–è¯‘æµ‹è¯•"><a href="#linux-on-litex-vexriscvç¼–è¯‘æµ‹è¯•" class="headerlink" title="linux-on-litex-vexriscvç¼–è¯‘æµ‹è¯•"></a>linux-on-litex-vexriscvç¼–è¯‘æµ‹è¯•</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cd</span> linux-on-litex-vexriscv</span><br><span class="line">~$ <span class="built_in">export</span> PATH=~/riscv64-toolchain/bin:~/intelFPGA_lite/20.1/quartus/bin:<span class="variable">$PATH</span></span><br><span class="line">~$ ./make.py --board=de0nano --build --load</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿è¡Œ<code>--load</code>å‚æ•°æ—¶,éœ€è¦ç¡®ä¿<code>jtagd</code>æ˜¯è¿è¡Œçš„,è¿™é‡Œå¦‚ä¸‹é¢æ‰€ç¤º,æœ€ç»ˆæ˜¯ä½¿ç”¨<code>quartus_pgm -m jtag -c USB-Blaster</code>åŠ è½½çš„.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line">Info: Command: quartus_pgm -m jtag -c USB-Blaster -o p;/home/michael/workspace-xilinx/RISC-V/litex-hub/litex/linux-on-litex-vexriscv/build/de0nano/gateware/de0nano.sof@1</span><br><span class="line">Info (213046): Using programming cable <span class="string">"USB-Blaster on 127.0.0.1 [3-3]"</span></span><br><span class="line">Info (213011): Using programming file /home/michael/workspace-xilinx/RISC-V/litex-hub/litex/linux-on-litex-vexriscv/build/de0nano/gateware/de0nano.sof with checksum 0x0085AEAF <span class="keyword">for</span> device EP4CE22F17@1</span><br><span class="line">Info (209060): Started Programmer operation at Sat Feb 26 11:35:48 2022</span><br><span class="line">Info (209016): Configuring device index 1</span><br><span class="line">Info (209017): Device 1 contains JTAG ID code 0x020F30DD</span><br><span class="line">Info (209007): Configuration succeeded -- 1 device(s) configured</span><br><span class="line">Info (209011): Successfully performed operation(s)</span><br><span class="line">Info (209061): Ended Programmer operation at Sat Feb 26 11:35:49 2022</span><br><span class="line">Info: Quartus Prime Programmer was successful. 0 errors, 0 warnings</span><br><span class="line">    Info: Peak virtual memory: 315 megabytes</span><br><span class="line">    Info: Processing ended: Sat Feb 26 11:35:49 2022</span><br><span class="line">    Info: Elapsed time: 00:00:32</span><br><span class="line">    Info: Total CPU time (on all processors): 00:00:00</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="é€šè¿‡JTAG-UARTæŸ¥çœ‹å¯åŠ¨ä¿¡æ¯"><a href="#é€šè¿‡JTAG-UARTæŸ¥çœ‹å¯åŠ¨ä¿¡æ¯" class="headerlink" title="é€šè¿‡JTAG-UARTæŸ¥çœ‹å¯åŠ¨ä¿¡æ¯"></a>é€šè¿‡<code>JTAG-UART</code>æŸ¥çœ‹å¯åŠ¨ä¿¡æ¯</h3><ul>
<li>è¿™é‡Œè„šæœ¬é»˜è®¤æ˜¯é€‰æ‹©<code>serial</code>è¿›è¡Œé€šä¿¡çš„,ä¸Šé¢æˆ‘åœ¨ç¼–è¯‘æ—¶é€‰æ‹©äº†<code>--uart-name=jtag_uart</code>,æƒ³æµ‹è¯•ä½¿ç”¨æ¿çš„ä¸Š<code>USB JTAG</code>çš„æ–¹å¼æ¥è¿›è¡Œ<code>uart</code>é€šä¿¡.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~$ ./targets/terasic_de0nano.py --<span class="built_in">help</span></span><br><span class="line"> [...]</span><br><span class="line"> --no-uart</span><br><span class="line">          Disable UART. (default: False)</span><br><span class="line">  --uart-name UART_NAME</span><br><span class="line">          UART <span class="built_in">type</span>/name. (default: serial)</span><br><span class="line">  --uart-baudrate UART_BAUDRATE</span><br><span class="line">          UART baudrate. (default: 115200)</span><br><span class="line">  --uart-fifo-depth UART_FIFO_DEPTH</span><br><span class="line">          UART FIFO depth. (default: 16)</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<ul>
<li>æ–°å»ºä¸€ä¸ª<code>openocd</code>çš„é…ç½®æ–‡ä»¶,é’ˆå¯¹<code>de0nano EP4CE22F17</code>çš„å‚æ•°è®¾ç½®,å¦‚ä¸‹:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">litex_boards$ cat prog/openocd_de0nano.cfg</span><br><span class="line">adapter driver usb_blaster</span><br><span class="line">usb_blaster lowlevel_driver ftdi</span><br><span class="line"><span class="built_in">set</span> _CHIPNAME EP4CE22F17</span><br><span class="line"><span class="built_in">set</span> FPGA_TAPID 0x020F30DD</span><br><span class="line">adapter speed 6000</span><br><span class="line">jtag newtap <span class="variable">$_CHIPNAME</span> tap -irlen 10 -expected-id <span class="variable">$FPGA_TAPID</span></span><br><span class="line"><span class="comment">#scan_chain</span></span><br><span class="line">gdb_port disabled</span><br><span class="line">tcl_port disabled</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿æ¥å¦‚ä¸‹</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> ~/.<span class="built_in">local</span>/bin/litex_term jtag --jtag-config=./prog/openocd_de0nano.cfg</span><br><span class="line">port is 20000</span><br><span class="line">got ir value 2</span><br><span class="line">Open On-Chip Debugger 0.11.0+dev-00562-g5ab74bde0-dirty (2022-02-07-19:44)</span><br><span class="line">Licensed under GNU GPL v2</span><br><span class="line">For bug reports, <span class="built_in">read</span></span><br><span class="line">	http://openocd.org/doc/doxygen/bugs.html</span><br><span class="line">Info : only one transport option; autoselect <span class="string">'jtag'</span></span><br><span class="line">jtagstream_serve</span><br><span class="line">Info : usb blaster interface using libftdi</span><br><span class="line">Info : This adapter doesn<span class="string">'t support configurable speed</span></span><br><span class="line"><span class="string">Info : JTAG tap: EP4CE22F17.tap tap/device found: 0x020f30dd (mfg: 0x06e (Altera), part: 0x20f3, ver: 0x0)</span></span><br><span class="line"><span class="string">Warn : gdb services need one or more targets defined</span></span><br></pre></td></tr></table></figure>
<ul>
<li>è¿æ¥åˆ°<code>jtag-uart</code>å°±ç›´æ¥æŒ‚ä½äº†,æ²¡æœ‰å‡ºæ¥ä¸²å£ç»ˆç«¯, è€Œé€šè¿‡<code>litex_term</code>è¿æ¥<code>jtag</code>çš„å‚æ•°æ˜¯åŒ…è£…äº†<code>openocd</code>çš„å‘½ä»¤è¡Œ,ç­‰ä»·ä¸å¦‚ä¸‹å‘½ä»¤ï¼š</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ openocd -f ./prog/openocd_de0nano.cfg -f stream.cfg -c &lt;....&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>å› ä¸º<code>--build</code>å®Œæˆåä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆ<code>stream.cfg</code>æ–‡ä»¶,å®ƒå°±æ˜¯ç”¨<code>TCL</code>è„šæœ¬å®šä¹‰çš„<code>openocd</code>çš„é…ç½®æ–‡ä»¶,å®ƒçš„è‡ªåŠ¨ç”Ÿæˆæ¥æºæ˜¯ä½äº:<code>litex/litex/build/openocd.py</code>é‡Œ, ç‰‡æ®µå¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">litex$ tail -n 20 litex/litex/build/openocd.py</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">proc jtagstream_serve &#123;tap port&#125; &#123;</span><br><span class="line">    <span class="built_in">set</span> sock [socket stream.server <span class="variable">$port</span>]</span><br><span class="line">    <span class="variable">$sock</span> readable [list jtagstream_client <span class="variable">$tap</span> <span class="variable">$sock</span>]</span><br><span class="line">    stdin readable [list jtagstream_exit <span class="variable">$sock</span>]</span><br><span class="line">    vwait forever</span><br><span class="line">    <span class="variable">$sock</span> close</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        write_to_file("</span>stream.cfg<span class="string">", cfg)</span></span><br><span class="line"><span class="string">        print("</span>port is &#123;:d&#125;<span class="string">".format(port))</span></span><br><span class="line"><span class="string">        print("</span>got ir value &#123;:d&#125;<span class="string">".format(self.get_ir(chain,config)))</span></span><br><span class="line"><span class="string">        script = "</span>; <span class="string">".join([</span></span><br><span class="line"><span class="string">            "</span>init<span class="string">",</span></span><br><span class="line"><span class="string">            "</span>irscan <span class="variable">$_CHIPNAME</span>.tap &#123;:d&#125;<span class="string">".format(self.get_ir(chain, config)),</span></span><br><span class="line"><span class="string">            "</span>jtagstream_serve <span class="variable">$_CHIPNAME</span>.tap &#123;:d&#125;<span class="string">".format(port),</span></span><br><span class="line"><span class="string">            "</span><span class="built_in">exit</span><span class="string">",</span></span><br><span class="line"><span class="string">        ])</span></span><br><span class="line"><span class="string">        self.call(["</span>openocd<span class="string">", "</span>-f<span class="string">", config, "</span>-f<span class="string">", "</span>stream.cfg<span class="string">", "</span>-c<span class="string">", script])</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æƒ³é€šè¿‡æ¿ä¸Šçš„<code>USB</code>æ¥å£,è¿æ¥<code>jtag_uart</code>çš„æ–¹å¼ä¸æˆåŠŸ.</li>
</ul>
<h3 id="é€šè¿‡ä¸²å£æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨ä¿¡æ¯"><a href="#é€šè¿‡ä¸²å£æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨ä¿¡æ¯" class="headerlink" title="é€šè¿‡ä¸²å£æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨ä¿¡æ¯"></a>é€šè¿‡ä¸²å£æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨ä¿¡æ¯</h3><ul>
<li>å› ä¸ºä½¿ç”¨<code>jtag_uart</code>æ–¹å¼è¿æ¥ä¸²å£ä¸æˆåŠŸ,è¿˜æ˜¯é€‰æ‹©é»˜è®¤çš„<code>serial</code>æ–¹å¼è¿æ¥,å› ä¸ºæ¿ä¸Šæ²¡æœ‰<code>USB to UART</code>çš„åŠŸèƒ½,çœ‹ç›¸å…³æ–‡æ¡£ä¹Ÿæ²¡è¯´æ˜å¦‚ä½•è¿æ¥åˆ°æ¿ä¸Šçš„<code>uart</code>,é€šè¿‡æœç´¢æºç å‘ç°å¦‚ä¸‹çš„å®šä¹‰:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">litex-boards$ cat litex_boards/platforms/terasic_de0nano.py</span><br><span class="line">[...]</span><br><span class="line"> <span class="comment"># Switches</span></span><br><span class="line">    (<span class="string">"sw"</span>, 0, Pins(<span class="string">"M1"</span>),  IOStandard(<span class="string">"3.3-V LVTTL"</span>)),</span><br><span class="line">    (<span class="string">"sw"</span>, 1, Pins(<span class="string">"T8"</span>),  IOStandard(<span class="string">"3.3-V LVTTL"</span>)),</span><br><span class="line">    (<span class="string">"sw"</span>, 2, Pins(<span class="string">"B9"</span>),  IOStandard(<span class="string">"3.3-V LVTTL"</span>)),</span><br><span class="line">    (<span class="string">"sw"</span>, 3, Pins(<span class="string">"M15"</span>), IOStandard(<span class="string">"3.3-V LVTTL"</span>)),</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Serial</span></span><br><span class="line">    (<span class="string">"serial"</span>, 0,</span><br><span class="line">        <span class="comment"># Compatible with cheap FT232 based cables (ex: Gaoominy 6Pin Ftdi Ft232Rl Ft232)</span></span><br><span class="line">        <span class="comment"># GND on JP1 Pin 12.</span></span><br><span class="line">        Subsignal(<span class="string">"tx"</span>, Pins(<span class="string">"JP1:10"</span>), IOStandard(<span class="string">"3.3-V LVTTL"</span>)),</span><br><span class="line">        Subsignal(<span class="string">"rx"</span>, Pins(<span class="string">"JP1:8"</span>),  IOStandard(<span class="string">"3.3-V LVTTL"</span>))</span><br><span class="line">    ),</span><br><span class="line"></span><br><span class="line">    <span class="comment"># SDR SDRAM</span></span><br><span class="line">    (<span class="string">"sdram_clock"</span>, 0, Pins(<span class="string">"R4"</span>), IOStandard(<span class="string">"3.3-V LVTTL"</span>)),</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿™é‡Œä½¿ç”¨<code>FTDI 2232H</code>è¿æ¥å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DE0-nano JP1                FT2232H</span><br><span class="line">GPIO_05 Pin8     &lt;-------&gt;  AD0 TXD</span><br><span class="line">GPIO_07 Pin10    &lt;-------&gt;  AD1 RXD</span><br><span class="line">GND     Pin12    &lt;-------&gt;  GND</span><br></pre></td></tr></table></figure>
<ul>
<li>åˆ°è¿™é‡Œå°±å¯ä»¥ä½¿ç”¨<code>litex_term</code>æˆ–è€…<code>minicom</code>æ¥è¿æ¥æ¿ä¸Šä¸²å£äº†,å¦‚æœå‡ºç°ä¹±ç ,å°±æ˜¯<code>UART baudrate</code>é—®é¢˜,è¿™é‡Œæ˜¯é»˜è®¤å…¶å®æ˜¯<code>1Mbps(1e6)</code>,è€Œä¸”å‘ç°åœ¨æŸå®ä¹°çš„å¾ˆå¤š<code>USB to UART</code>åœ¨è¿æ¥<code>1Mbps</code>è¿˜æ˜¯ä¼šå‡ºç°ä¹±ç ,ä¸èƒ½è¾“å…¥ç­‰é—®é¢˜,æˆ‘æ¢æˆ<code>FTDI 2232H</code>å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">litex-boards $ minicom -o -b 1000000 -D /dev/ttyUSB0</span><br><span class="line"></span><br><span class="line">        __   _ __      _  __</span><br><span class="line">       / /  (_) /____ | |/_/</span><br><span class="line">      / /__/ / __/ -_)&gt;  &lt;</span><br><span class="line">     /____/_/\__/\__/_/|_|</span><br><span class="line">   Build your hardware, easily!</span><br><span class="line"></span><br><span class="line"> (c) Copyright 2012-2022 Enjoy-Digital</span><br><span class="line"> (c) Copyright 2007-2015 M-Labs</span><br><span class="line"></span><br><span class="line"> BIOS CRC passed (1f65f3e6)</span><br><span class="line"></span><br><span class="line"> Migen git sha1: ac70301</span><br><span class="line"> LiteX git sha1: 7cc781f7</span><br><span class="line"></span><br><span class="line">--=============== SoC ==================--</span><br><span class="line">CPU:            VexRiscv SMP-LINUX @ 50MHz</span><br><span class="line">BUS:            WISHBONE 32-bit @ 4GiB</span><br><span class="line">CSR:            32-bit data</span><br><span class="line">ROM:            64KiB</span><br><span class="line">SRAM:           8KiB</span><br><span class="line">L2:             2KiB</span><br><span class="line">SDRAM:          32768KiB 16-bit @ 50MT/s (CL-2 CWL-2)</span><br><span class="line"></span><br><span class="line">--========== Initialization ============--</span><br><span class="line">Initializing SDRAM @0x40000000...</span><br><span class="line">Switching SDRAM to software control.</span><br><span class="line">Switching SDRAM to hardware control.</span><br><span class="line">Memtest at 0x40000000 (2.0MiB)...</span><br><span class="line">  Write: 0x40000000-0x40200000 2.0MiB</span><br><span class="line">   Read: 0x40000000-0x40200000 2.0MiB</span><br><span class="line">Memtest OK</span><br><span class="line">Memspeed at 0x40000000 (Sequential, 2.0MiB)...</span><br><span class="line">  Write speed: 15.8MiB/s</span><br><span class="line">   Read speed: 11.7MiB/s</span><br><span class="line"></span><br><span class="line">--============== Boot ==================--</span><br><span class="line">Booting from serial...</span><br><span class="line">Press Q or ESC to abort boot completely.</span><br><span class="line">sL5DdSMmkekro</span><br><span class="line">             Timeout</span><br><span class="line">No boot medium found</span><br><span class="line"></span><br><span class="line">--============= Console ================--</span><br><span class="line"></span><br><span class="line">litex&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥é€šè¿‡<code>help</code>æŸ¥çœ‹å¯ä»¥æ”¯æŒçš„å‘½ä»¤</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">litex&gt; <span class="built_in">help</span></span><br><span class="line">LiteX BIOS, available commands:</span><br><span class="line"></span><br><span class="line"><span class="built_in">help</span>                     - Print this <span class="built_in">help</span></span><br><span class="line">ident                    - Identifier of the system</span><br><span class="line">crc                      - Compute CRC32 of a part of the address space</span><br><span class="line">flush_cpu_dcache         - Flush CPU data cache</span><br><span class="line">flush_l2_cache           - Flush L2 cache</span><br><span class="line">leds                     - Set Leds value</span><br><span class="line"></span><br><span class="line">boot                     - Boot from Memory</span><br><span class="line">reboot                   - Reboot</span><br><span class="line">serialboot               - Boot from Serial (SFL)</span><br><span class="line"></span><br><span class="line">mem_list                 - List available memory regions</span><br><span class="line">mem_read                 - Read address space</span><br><span class="line">mem_write                - Write address space</span><br><span class="line">mem_copy                 - Copy address space</span><br><span class="line">mem_test                 - Test memory access</span><br><span class="line">mem_speed                - Test memory speed</span><br><span class="line">mem_cmp                  - Compare memory content</span><br><span class="line"></span><br><span class="line">sdram_test               - Test SDRAM</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">litex&gt; ident</span><br><span class="line"></span><br><span class="line">Ident: LiteX SoC on DE0-Nano</span><br></pre></td></tr></table></figure>
<ul>
<li><code>leds</code>å‘½ä»¤å¯ä»¥æ§åˆ¶æ¿ä¸Šçš„<code>led0~led7</code>çš„å¼€å…³,</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">litex&gt; leds 255  <span class="comment"># å…¨éƒ¨äº®ç¯</span></span><br><span class="line"></span><br><span class="line">Settings Leds to 0xff</span><br><span class="line">litex&gt; leds 1    <span class="comment"># led0 äº®</span></span><br><span class="line"></span><br><span class="line">Settings Leds to 0x1</span><br><span class="line"></span><br><span class="line">litex&gt;  leds 11  <span class="comment"># led0,led1,led3äº®, (1 &lt;&lt; 0) + (1 &lt;&lt; 1) + (1 &lt;&lt; 3)</span></span><br><span class="line"></span><br><span class="line">Settings Leds to 0xb</span><br></pre></td></tr></table></figure>
<h3 id="æ·»åŠ SPI-SDCardå¤–è®¾"><a href="#æ·»åŠ SPI-SDCardå¤–è®¾" class="headerlink" title="æ·»åŠ SPI-SDCardå¤–è®¾"></a>æ·»åŠ <code>SPI-SDCard</code>å¤–è®¾</h3><ul>
<li><code>de0-nano</code>æ¿å­ä¸Šæ²¡æœ‰æ¥<code>sdcard</code>çš„æ’æ§½,è¿™é‡Œç»™å®ƒåœ¨<code>JP1 Headers</code>ä¸Šè¿æ¥ä¸€ä¸ª<code>SPI-SDCard</code>æ’æ§½,å¹¶ä¸”è®©å®ƒèƒ½ä»<code>SDCard boot</code>æ–¹å¼,åŠ è½½<code>Linux</code>.æ‰€ä»¥éœ€ä¿®æ”¹ç›¸åº”çš„æºç ,å…ˆæ˜¯åœ¨<code>linux-on-litex-vexriscv/make.py</code>é‡Œçš„<code>De0Nano</code>ç±»ä¸‹é¢çš„å‚æ•°<code>soc_capabilities</code>æ·»åŠ <code>spisdcard</code>,å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">litex-hub/linux-on-litex-vexriscv$ cat make.py</span><br><span class="line">[...]</span><br><span class="line">class De0Nano(Board):</span><br><span class="line">    soc_kwargs = &#123;<span class="string">"l2_size"</span> : 2048&#125; <span class="comment"># Use Wishbone and L2 for memory accesses.</span></span><br><span class="line">    def __init__(self):</span><br><span class="line">        from litex_boards.targets import de0nano</span><br><span class="line">        Board.__init__(self, de0nano.BaseSoC, soc_capabilities=&#123;</span><br><span class="line">            <span class="comment"># Communication</span></span><br><span class="line">            <span class="string">"serial"</span>,</span><br><span class="line">            <span class="string">"spisdcard"</span></span><br><span class="line">        &#125;, bitstream_ext=<span class="string">".sof"</span>)</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<ul>
<li>å†å»åˆ°<code>litex-hub/litex-boards</code>çš„é¡¹ç›®ä¸‹,æ·»åŠ å¦‚ä¸‹è¡¥ä¸ä¿®æ”¹</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">litex-hub/litex-boards$ git diff litex_boards/platforms/terasic_de0nano.py</span><br><span class="line">diff --git a/litex_boards/platforms/terasic_de0nano.py b/litex_boards/platforms/terasic_de0nano.py</span><br><span class="line">index 3284ddc..7a810f7 100644</span><br><span class="line">--- a/litex_boards/platforms/terasic_de0nano.py</span><br><span class="line">+++ b/litex_boards/platforms/terasic_de0nano.py</span><br><span class="line">@@ -115,6 +115,14 @@ _io = [</span><br><span class="line">         <span class="string">"F15 F16 F14 G16 G15"</span>),</span><br><span class="line">         IOStandard(<span class="string">"3.3-V LVTTL"</span>)</span><br><span class="line">     ),</span><br><span class="line">+    <span class="comment"># SDCard</span></span><br><span class="line">+    (<span class="string">"spisdcard"</span>, 0,</span><br><span class="line">+        Subsignal(<span class="string">"clk"</span>,  Pins(<span class="string">"JP1:18"</span>)),</span><br><span class="line">+        Subsignal(<span class="string">"cs_n"</span>, Pins(<span class="string">"JP1:20"</span>)),</span><br><span class="line">+        Subsignal(<span class="string">"mosi"</span>, Pins(<span class="string">"JP1:14"</span>), Misc(<span class="string">"WEAK_PULL_UP_RESISTOR ON"</span>)),</span><br><span class="line">+        Subsignal(<span class="string">"miso"</span>, Pins(<span class="string">"JP1:16"</span>), Misc(<span class="string">"WEAK_PULL_UP_RESISTOR ON"</span>)),</span><br><span class="line">+        IOStandard(<span class="string">"3.3-V LVTTL"</span>)</span><br><span class="line">+    ),</span><br><span class="line"> ]</span><br><span class="line"></span><br><span class="line"> <span class="comment"># Connectors ---------------------------------------------------------------------------------------</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>ç¼–è¯‘<code>linux-on-litex-vexriscv</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linux-on-litex-vexriscv$ ./make.py --board=de0nano --build</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®Œæˆå,å…ˆæŠŠä¸€å¼ <code>SDå¡</code>æ ¼å¼æˆç”¨<code>fdisk</code>ä¿®æ”¹åˆ†åŒºç±»å‹ä¸º<code>W95 FAT32</code>,å†ç”¨<code>mkfs.fat</code>æ ¼åŒ–å®ƒ.å†æŠŠ<code>linux-on-litex-vexriscv/images</code>é‡Œé¢çš„æ–‡ä»¶å¤åˆ°<code>SDå¡</code>çš„æ ¹ç›®å½•é‡Œ.<code>SPI-SDCard</code>æ¨¡å—ä¸<code>JP1</code>æ¥çº¿å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SPI-Card Module              de0-nano JP1  FPGA Pin No</span><br><span class="line">    CS         &lt;----------&gt;    JP1:20      GPIO_015 C6</span><br><span class="line">    CLK        &lt;----------&gt;    JP1:18      GPIO_013 D6</span><br><span class="line">    SDO        &lt;----------&gt;    JP1:16      GPIO_011 A6</span><br><span class="line">    SDI        &lt;----------&gt;    JP1:14      GPIO_09  D5</span><br><span class="line">    GND        &lt;----------&gt;    GND</span><br><span class="line">    3V3        &lt;----------&gt;    3V3</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸Šé¢çš„æ¥çº¿å¯ä»¥å‚è€ƒ<code>litex_boards/platforms/terasic_de0nano.py</code>é‡Œçš„ä»£ç ä¸ä¸Šé¢ä»‹ç»é‡Œ<code>GPIO-0 Pin Assignments</code>çš„æè¿°å»ç†è§£ä¸å¼€å‘.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linux-on-litex-vexriscv$ ./make.py --board=de0nano --load</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ä¸²å£è¿æ¥,å¹¶ä»<code>SDCard booting</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">linux-on-litex-vexriscv$ minicom -o -b 1000000 -D /dev/ttyUSB0</span><br><span class="line"></span><br><span class="line">(c) Copyright 2012-2022 Enjoy-Digital</span><br><span class="line"> (c) Copyright 2007-2015 M-Labs</span><br><span class="line"></span><br><span class="line"> BIOS CRC passed (1038d38c)</span><br><span class="line"></span><br><span class="line"> Migen git sha1: ac70301</span><br><span class="line"> LiteX git sha1: 7f49c523</span><br><span class="line"></span><br><span class="line">--=============== SoC ==================--</span><br><span class="line">CPU:            VexRiscv SMP-LINUX @ 50MHz</span><br><span class="line">BUS:            WISHBONE 32-bit @ 4GiB</span><br><span class="line">CSR:            32-bit data</span><br><span class="line">ROM:            64KiB</span><br><span class="line">SRAM:           8KiB</span><br><span class="line">L2:             2KiB</span><br><span class="line">SDRAM:          32768KiB 16-bit @ 50MT/s (CL-2 CWL-2)</span><br><span class="line"></span><br><span class="line">--========== Initialization ============--</span><br><span class="line">Initializing SDRAM @0x40000000...</span><br><span class="line">Switching SDRAM to software control.</span><br><span class="line">Switching SDRAM to hardware control.</span><br><span class="line">Memtest at 0x40000000 (2.0MiB)...</span><br><span class="line">  Write: 0x40000000-0x40200000 2.0MiB</span><br><span class="line">   Read: 0x40000000-0x40200000 2.0MiB</span><br><span class="line">Memtest OK</span><br><span class="line">Memspeed at 0x40000000 (Sequential, 2.0MiB)...</span><br><span class="line">  Write speed: 16.7MiB/s</span><br><span class="line">   Read speed: 20.3MiB/s</span><br><span class="line"></span><br><span class="line">--============== Boot ==================--</span><br><span class="line">Booting from serial...</span><br><span class="line">Press Q or ESC to abort boot completely.</span><br><span class="line">sL5DdSMmkekro</span><br><span class="line">             Timeout</span><br><span class="line">Booting from SDCard <span class="keyword">in</span> SPI-Mode...</span><br><span class="line">Booting from boot.json...</span><br><span class="line">Copying Image to 0x40000000 (7531468 bytes)...</span><br><span class="line">[<span class="comment">########################################]</span></span><br><span class="line">Copying rv32.dtb to 0x40ef0000 (2621 bytes)...</span><br><span class="line">[<span class="comment">########################################]</span></span><br><span class="line">Copying rootfs.cpio to 0x41000000 (3786240 bytes)...</span><br><span class="line">[<span class="comment">########################################]</span></span><br><span class="line">Copying opensbi.bin to 0x40f00000 (53640 bytes)...</span><br><span class="line">[<span class="comment">########################################]</span></span><br><span class="line">Executing booted program at 0x40f00000</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœä»<code>SDCard</code>å¯åŠ¨å¤±è´¥,å…ˆç¡®ä¿å¡çš„åˆ†åŒºæ ¼å¼æ˜¯<code>W95 FAT32</code>,å†æ¢ä¸€å¼ å¡æµ‹è¯•ä¸€ä¸‹,å› ä¸ºæˆ‘è¿™è¾¹ä½¿ç”¨ä¸€å¼ <code>512MB</code>çš„æ—§å¡,å¦ä¸€å¼ æ˜¯<code>1GB</code>çš„æ—§å¡,éƒ½æ— æ³•æ£€æµ‹åˆ°,æ¢äº†ä¸€å¼ <code>32GB,128GB</code>å¡,éƒ½èƒ½æˆåŠŸåŠ è½½è¿è¡Œ.å¥½åƒ<code>enjoy-digital/litesdcard</code>å¯¹æ—§å¡å…¼å®¹æœ‰é—®é¢˜,æˆ–è€…æ˜¯å…¶å®ƒæœªçŸ¥çš„åŸå› .</p>
</li>
</ul>
<h3 id="quartus-cpfå‘½ä»¤"><a href="#quartus-cpfå‘½ä»¤" class="headerlink" title="quartus_cpfå‘½ä»¤"></a>quartus_cpfå‘½ä»¤</h3><ul>
<li>æŸ¥çœ‹å‚æ•°å¸®åŠ©è¯´æ˜,å¦‚ï¼š</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">~$ quartus_cpf --<span class="built_in">help</span>=rpd</span><br><span class="line"></span><br><span class="line">Topic: rpd</span><br><span class="line"></span><br><span class="line">To generate a Raw Programming Data File (.rpd), specify the input</span><br><span class="line">file name and output file name. Make sure the file extension</span><br><span class="line">of the output file is .rpd. The input file can be only a</span><br><span class="line">Programmer Object File (.pof).</span><br><span class="line"></span><br><span class="line">---------</span><br><span class="line">Examples:</span><br><span class="line">---------</span><br><span class="line"></span><br><span class="line"><span class="comment"># To convert .pof to .rpd</span></span><br><span class="line">quartus_cpf -c &lt;input_pof_file&gt; &lt;output_rpd_file&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># To use a Conversion Setup File (.cof) created with</span></span><br><span class="line"><span class="comment"># the Convert Programming Files dialog box in the UI</span></span><br><span class="line">quartus_cpf -c &lt;input_cof_file&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥çœ‹<code>sof</code>æ–‡ä»¶çš„ä¿¡æ¯</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ quartus_cpf --info de0nano.sof</span><br><span class="line">                File: de0nano.sof</span><br><span class="line">            File CRC: 0x24F3</span><br><span class="line">             Creator: Quartus Prime Compiler Version 20.1.1 Build 720 11/11/2020 SJ Lite Edition</span><br><span class="line">             Comment: Untitled</span><br><span class="line">              Device: EP4CE22F17</span><br><span class="line">       Data checksum: 0x008595BA</span><br><span class="line">       JTAG usercode: 0x008595BA</span><br><span class="line">        Project Hash: 0x</span><br></pre></td></tr></table></figure>
<ul>
<li>ç”Ÿæˆ<code>svf</code>æ–‡ä»¶</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ quartus_cpf -c -q 6.0MHz -g 3.3 -n p de0nano.sof de0nano.svf</span><br></pre></td></tr></table></figure>
<ul>
<li>ç”Ÿæˆ<code>rpd</code>æ–‡ä»¶</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ quartus_cpf -c -d EPCS64 de0nano.sof de0nano.pof</span><br><span class="line">~$ quartus_cpf -c -d EPCS64 -s EP4CE22F17 de0nano.pof de0nano.rpd</span><br></pre></td></tr></table></figure>
<ul>
<li>ç”Ÿæˆ<code>jic</code>æ–‡ä»¶,å¯ä»¥ä½¿ç”¨<code>Quartus Prime IDE -&gt; Tools -&gt; Programmer -&gt; Add File...</code>è¿›è¡Œçƒ§å†™,éœ€ç¡®ä¿<code>jtagd</code>æœåŠ¡æ˜¯è¿è¡Œçš„.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ quartus_cpf -c -d EPCS64 -s EP4CE22F17 de0nano.sof de0nano.jic</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="ç”¨openocdåŠ è½½svfæ–‡ä»¶"><a href="#ç”¨openocdåŠ è½½svfæ–‡ä»¶" class="headerlink" title="ç”¨openocdåŠ è½½svfæ–‡ä»¶."></a>ç”¨<code>openocd</code>åŠ è½½<code>svf</code>æ–‡ä»¶.</h2><ul>
<li><p>æ ¹æ®æ¿å­å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ª<code>openocd</code>çš„è¿æ¥é…ç½®æ–‡ä»¶.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~$ cat &gt; openocd_de0nano.cfg &lt;&lt;EOF</span><br><span class="line">adapter driver usb_blaster</span><br><span class="line">usb_blaster lowlevel_driver ftdi</span><br><span class="line"><span class="built_in">set</span> CHIPNAME EP4CE22F17</span><br><span class="line"><span class="built_in">set</span> FPGA_TAPID 0x020F30DD <span class="comment"># é€šè¿‡jtagconfigå–å¾—</span></span><br><span class="line">adapter speed 6000</span><br><span class="line">jtag newtap <span class="variable">$CHIPNAME</span> tap -irlen 10 -expected-id <span class="variable">$FPGA_TAPID</span></span><br><span class="line">init</span><br><span class="line">scan_chain</span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>åŠ è½½åˆ°<code>FPGA</code>.</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">~$ openocd -f ./openocd_de0nano.cfg -c &quot;svf  de0nano.svf progress&quot; -c exit</span><br><span class="line">Open On-Chip Debugger 0.11.0+dev-00562-g5ab74bde0-dirty (2022-02-07-19:44)</span><br><span class="line">Licensed under GNU GPL v2</span><br><span class="line">For bug reports, read</span><br><span class="line">	http://openocd.org/doc/doxygen/bugs.html</span><br><span class="line">Info : only one transport option; autoselect &apos;jtag&apos;</span><br><span class="line">Info : usb blaster interface using libftdi</span><br><span class="line">Info : This adapter doesn&apos;t support configurable speed</span><br><span class="line">Info : JTAG tap: EP4CE22F17.tap tap/device found: 0x020f30dd (mfg: 0x06e (Altera), part: 0x20f3, ver: 0x0)</span><br><span class="line">Warn : gdb services need one or more targets defined</span><br><span class="line">   TapName             Enabled  IdCode     Expected   IrLen IrCap IrMask</span><br><span class="line">-- ------------------- -------- ---------- ---------- ----- ----- ------</span><br><span class="line"> 0 EP4CE22F17.tap         Y     0x020f30dd 0x020f30dd    10 0x01  0x03</span><br><span class="line"></span><br><span class="line">svf processing file: &quot;de0nano.svf&quot;</span><br><span class="line">  0%  FREQUENCY 1.20E+07 HZ;</span><br><span class="line">Error: Translation from khz to adapter speed not implemented</span><br><span class="line"></span><br><span class="line">  0%  TRST ABSENT;</span><br><span class="line">  0%  ENDDR IDLE;</span><br><span class="line">  0%  ENDIR IRPAUSE;</span><br><span class="line">  0%  STATE IDLE;</span><br><span class="line">  0%  SIR 10 TDI (002);</span><br><span class="line">  0%  RUNTEST IDLE 12000 TCK ENDSTATE IDLE;</span><br><span class="line"> 95%  	FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF);</span><br><span class="line"> 95%  SIR 10 TDI (004);</span><br><span class="line"> 95%  RUNTEST 60 TCK;</span><br><span class="line"> 95%  	000000000000000000000000000000000000000000000000000000000000000000);</span><br><span class="line"> 95%  SIR 10 TDI (003);</span><br><span class="line"> 95%  RUNTEST 49152 TCK;</span><br><span class="line"> 95%  RUNTEST 512 TCK;</span><br><span class="line"> 95%  SIR 10 TDI (3FF);</span><br><span class="line"> 95%  RUNTEST 12000 TCK;</span><br><span class="line"> 95%  STATE IDLE;</span><br><span class="line"></span><br><span class="line">Time used: 0m1s439ms</span><br><span class="line">svf file programmed successfully for 17 commands with 0 errors</span><br></pre></td></tr></table></figure>
<h2 id="çƒ§å†™åˆ°SPI-FLASH"><a href="#çƒ§å†™åˆ°SPI-FLASH" class="headerlink" title="çƒ§å†™åˆ°SPI FLASH"></a>çƒ§å†™åˆ°<code>SPI FLASH</code></h2><ul>
<li><a href="https://trabucayre.github.io/openFPGALoader/vendors/intel.html" target="_blank" rel="noopener">openFPGALoader Intel/Altera</a></li>
<li>è¿™é‡Œä½¿ç”¨<code>openFPGALoader -b de0nano -f de0nano.rpd</code>æ˜¾ç¤ºçƒ§å†™é”™è¯¯:<code>flash stackflow</code>,åé¢ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥æ­£å¸¸çƒ§å†™åˆ°<code>Flash</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ openFPGALoader -c usb-blaster --fpga-part ep4ce2217 -f  de0nano.rbf</span><br></pre></td></tr></table></figure>
<h2 id="UrJtagä½¿ç”¨"><a href="#UrJtagä½¿ç”¨" class="headerlink" title="UrJtagä½¿ç”¨"></a>UrJtagä½¿ç”¨</h2><ul>
<li>ç›´æ¥ä½¿ç”¨<code>apt-get install urjtag</code>çš„ç‰ˆæœ¬è¾ƒè€,æ˜¯ä¸æ”¯æŒ<code>ep4c22</code>,æ˜¾ç¤ºå¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ jtag</span><br><span class="line">jtag&gt; cable UsbBlaster vid=0x09fb pid=0x6001 interface=0</span><br><span class="line">Connected to libftdi driver.</span><br><span class="line">jtag&gt; detect</span><br><span class="line">IR length: 10</span><br><span class="line">Chain length: 1</span><br><span class="line">Device Id: 00000010000011110011000011011101 (0x020F30DD)</span><br><span class="line">  Manufacturer: Altera (0x0DD)</span><br><span class="line">  Unknown part! (0010000011110011) (/usr/share/urjtag/altera/PARTS)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>é€šè¿‡å‚ç…§<a href="https://intelligenttoasters.blog/2014/07/28/urjtag-and-python-a-lightweight-hal/" target="_blank" rel="noopener">è¿™é‡Œ</a>,ä»æœ€æ–°(urjtag-2021.03)æºç å»ç¼–è¯‘å®ƒ,è¿™é‡Œè¿˜éœ€è¦å»<code>FTDI</code>çš„å®˜ç½‘å»<a href="https://ftdichip.com/wp-content/uploads/2021/09/libftd2xx-x86_64-1.4.24.tgz" target="_blank" rel="noopener">ä¸‹è½½D2XX Drivers</a></p>
</li>
<li><p>ä¸‹è½½<code>D2XX Drivers</code></p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ wget -c https://ftdichip.com/wp-content/uploads/2021/09/libftd2xx-x86_64-1.4.24.tgz</span><br><span class="line">~$ tar xvf libftd2xx-x86_64-1.4.24.tgz</span><br><span class="line">release/</span><br><span class="line">release/release-notes.txt</span><br><span class="line">release/WinTypes.h</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<ul>
<li>ç¼–è¯‘å®‰è£…<code>urjtag-2021.03</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">~$ wget -c https://sourceforge.net/projects/urjtag/files/urjtag/2021.03/urjtag-2021.03.tar.xz/download</span><br><span class="line">~$ tar xvf urjtag-2021.03.tar.xz</span><br><span class="line">~$ <span class="built_in">cd</span> urjtag-2021.03</span><br><span class="line">~4 CLFAGS=-I<span class="variable">$PWD</span>/../release LDFLAGS=<span class="string">"-L<span class="variable">$PWD</span>/../release/build -lftd2xx"</span> ./configure --with-libusb  --with-libftdi  --with-ftd2xx</span><br><span class="line">[...]</span><br><span class="line">  Libraries:</span><br><span class="line">    libusb     : 1.0</span><br><span class="line">    libftdi    : yes (have async mode)</span><br><span class="line">    libftd2xx  : yes</span><br><span class="line">    inpout32   : no</span><br><span class="line"></span><br><span class="line">  Subsystems:</span><br><span class="line">    SVF        : yes</span><br><span class="line">    BSDL       : yes</span><br><span class="line">    STAPL      : no</span><br><span class="line"></span><br><span class="line">  Drivers:</span><br><span class="line">    Bus        : ahbjtag arm9tdmi au1500 avr32 bcm1250 blackfin bscoach ejtag ejtag_dma fjmem ixp425 ixp435 ixp465 jopcyc h7202 lh7a400 mpc5200 mpc824x mpc8313 mpc837x ppc405ep ppc440gx_ebc8 prototype pxa2x0 pxa27x s3c4510 sa1110 sh7727 sh7750r sh7751r sharc_21065L sharc_21369_ezkit slsup3 tx4925 zefant_xs3</span><br><span class="line">    Cable      : arcom byteblaster dirtyjtag dlc5 ea253 ei012 ft2232 gpio ice100 igloo jlink keithkoep lattice mpcbdm triton usbblaster vsllink wiggler xpc</span><br><span class="line">    Lowlevel   : direct ftdi ftd2xx ppdev</span><br><span class="line"></span><br><span class="line">  Language bindings:</span><br><span class="line">    python     : yes</span><br><span class="line">~$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<ul>
<li>åº”ç”¨<code>ep4ce22</code>æè¿°æ–‡ä»¶çš„è¡¥ä¸</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/share/urjtag$</span><br><span class="line">~$ sudo patch -p1 &lt; ~/urjtag-descriptors.patch</span><br><span class="line">patching file altera/ep4ce22/ep4ce22</span><br><span class="line">patching file altera/ep4ce22/STEPPINGS</span><br><span class="line">patching file altera/PARTS</span><br><span class="line">Hunk <span class="comment">#1 succeeded at 28 (offset 2 lines).</span></span><br><span class="line">michael@debian:/usr/<span class="built_in">local</span>/share/urjtag$ /usr/<span class="built_in">local</span>/bin/jtag</span><br></pre></td></tr></table></figure>
<ul>
<li>è¡¥ä¸æ–‡ä»¶</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">~$ cat urjtag-descriptors.patch</span><br><span class="line">diff -Naur urjtag-orig/altera/ep4ce22/ep4ce22 urjtag/altera/ep4ce22/ep4ce22</span><br><span class="line">--- urjtag-orig/altera/ep4ce22/ep4ce22	1970-01-01 10:00:00.000000000 +1000</span><br><span class="line">+++ urjtag/altera/ep4ce22/ep4ce22	2014-07-30 21:48:09.652857260 +1000</span><br><span class="line">@@ -0,0 +1,12 @@</span><br><span class="line">+instruction length 10</span><br><span class="line">+register DIR 32</span><br><span class="line">+register USERCODE 32</span><br><span class="line">+register BSR 732</span><br><span class="line">+register BYPASS 1</span><br><span class="line">+instruction HIGHZ 0000001011 BYPASS</span><br><span class="line">+instruction CLAMP 0000001010 BYPASS</span><br><span class="line">+instruction USERCODE 0000000111 USERCODE</span><br><span class="line">+instruction IDCODE 0000000110 DIR</span><br><span class="line">+instruction SAMPLE/PRELOAD 0000000101 BSR</span><br><span class="line">+instruction EXTEST 0000001111 BSR</span><br><span class="line">+instruction BYPASS 1111111111 BYPASS</span><br><span class="line">diff -Naur urjtag-orig/altera/ep4ce22/STEPPINGS urjtag/altera/ep4ce22/STEPPINGS</span><br><span class="line">--- urjtag-orig/altera/ep4ce22/STEPPINGS	1970-01-01 10:00:00.000000000 +1000</span><br><span class="line">+++ urjtag/altera/ep4ce22/STEPPINGS	2014-07-30 21:48:09.644857260 +1000</span><br><span class="line">@@ -0,0 +1,23 @@</span><br><span class="line">+<span class="comment">#</span></span><br><span class="line">+<span class="comment"># $Id: STEPPINGS 897 2007-12-29 13:02:32Z arniml $</span></span><br><span class="line">+<span class="comment">#</span></span><br><span class="line">+<span class="comment"># This program is free software; you can redistribute it and/or</span></span><br><span class="line">+<span class="comment"># modify it under the terms of the GNU General Public License</span></span><br><span class="line">+<span class="comment"># as published by the Free Software Foundation; either version 2</span></span><br><span class="line">+<span class="comment"># of the License, or (at your option) any later version.</span></span><br><span class="line">+<span class="comment">#</span></span><br><span class="line">+<span class="comment"># This program is distributed in the hope that it will be useful,</span></span><br><span class="line">+<span class="comment"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class="line">+<span class="comment"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span><br><span class="line">+<span class="comment"># GNU General Public License for more details.</span></span><br><span class="line">+<span class="comment">#</span></span><br><span class="line">+<span class="comment"># You should have received a copy of the GNU General Public License</span></span><br><span class="line">+<span class="comment"># along with this program; if not, write to the Free Software</span></span><br><span class="line">+<span class="comment"># Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA</span></span><br><span class="line">+<span class="comment"># 02111-1307, USA.</span></span><br><span class="line">+<span class="comment">#</span></span><br><span class="line">+<span class="comment"># Written by H Hartley Sweeten &lt;hsweeten@visionengravers.com&gt;</span></span><br><span class="line">+<span class="comment">#</span></span><br><span class="line">+</span><br><span class="line">+<span class="comment"># bits 31-28 of the Device Identification Register</span></span><br><span class="line">+0000	ep4ce22		0</span><br><span class="line">diff -Naur urjtag-orig/altera/PARTS urjtag/altera/PARTS</span><br><span class="line">--- urjtag-orig/altera/PARTS	2014-07-28 22:19:56.968449502 +1000</span><br><span class="line">+++ urjtag/altera/PARTS	2014-07-30 21:48:08.464857263 +1000</span><br><span class="line">@@ -26,3 +26,4 @@</span><br><span class="line"> 0111000100101000	epm7128aetc100		EPM7128AETC100</span><br><span class="line"> 0111000001100100	epm3064a		EPM3064A</span><br><span class="line"> 0010000010110010	ep2c8			EP2C8</span><br><span class="line">+0010000011110011	ep4ce22			EP4CE22</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿è¡Œæ–°ç‰ˆ<code>UrJtag</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">~$ /usr/<span class="built_in">local</span>/bin/jtag</span><br><span class="line"></span><br><span class="line">UrJTAG 2021.03 <span class="comment">#</span></span><br><span class="line">Copyright (C) 2002, 2003 ETC s.r.o.</span><br><span class="line">Copyright (C) 2007, 2008, 2009 Kolja Waschk and the respective authors</span><br><span class="line"></span><br><span class="line">UrJTAG is free software, covered by the GNU General Public License, and you are</span><br><span class="line">welcome to change it and/or distribute copies of it under certain conditions.</span><br><span class="line">There is absolutely no warranty <span class="keyword">for</span> UrJTAG.</span><br><span class="line"></span><br><span class="line">warning: UrJTAG may damage your hardware!</span><br><span class="line">Type <span class="string">"quit"</span> to <span class="built_in">exit</span>, <span class="string">"help"</span> <span class="keyword">for</span> <span class="built_in">help</span>.</span><br><span class="line"></span><br><span class="line">jtag&gt; cable UsbBlaster vid=0x09fb pid=0x6001 interface=0</span><br><span class="line">Connected to libftdi driver.</span><br><span class="line">jtag&gt; detect</span><br><span class="line">IR length: 10</span><br><span class="line">Chain length: 1</span><br><span class="line">Device Id: 00000010000011110011000011011101 (0x020F30DD)</span><br><span class="line">  Manufacturer: Altera (0x0DD)</span><br><span class="line">  Part(0):      EP4CE22 (0x20F3)</span><br><span class="line">  Stepping:     0</span><br><span class="line">  Filename:     /usr/<span class="built_in">local</span>/share/urjtag/altera/ep4ce22/ep4ce22</span><br><span class="line">jtag&gt; cable usbblaster driver=ftdi</span><br><span class="line">Connected to libftdi driver.</span><br><span class="line">jtag&gt; detect</span><br><span class="line">IR length: 10</span><br><span class="line">Chain length: 1</span><br><span class="line">Device Id: 00000010000011110011000011011101 (0x020F30DD)</span><br><span class="line">  Manufacturer: Altera (0x0DD)</span><br><span class="line">  Part(0):      EP4CE22 (0x20F3)</span><br><span class="line">  Stepping:     0</span><br><span class="line">  Filename:     /usr/<span class="built_in">local</span>/share/urjtag/altera/ep4ce22/ep4ce22</span><br><span class="line">jtag&gt; <span class="built_in">print</span> chain</span><br><span class="line"> No. Manufacturer              Part                 Stepping Instruction          Register</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------</span><br><span class="line">*  0 Altera                    EP4CE22              0        BYPASS               BYPASS</span><br></pre></td></tr></table></figure>
<h1 id="å…¶å®ƒé¡¹ç›®"><a href="#å…¶å®ƒé¡¹ç›®" class="headerlink" title="å…¶å®ƒé¡¹ç›®"></a>å…¶å®ƒé¡¹ç›®</h1><ul>
<li><a href="https://github.com/open-design/riscv-soc-cores" target="_blank" rel="noopener">open-design/riscv-soc-cores</a></li>
<li><a href="https://github.com/ikwzm/FPGA-SoC-Linux" target="_blank" rel="noopener">ikwzm/FPGA-SoC-Linux</a>, ä¸‹ä¸€æ­¥å®è·µ.</li>
<li><a href="http://www.nxlab.fer.hr/fpgarduino/" target="_blank" rel="noopener">fpgarduino</a>éœ€è¦å®è·µä¸€ä¸‹.</li>
<li><a href="https://www.librecores.org/olofk/serv" target="_blank" rel="noopener">olofk/serv</a> SERV - the SErial RISC-V CPU by olofk</li>
<li><a href="https://github.com/Dmitriy0111/nanoFOX" target="_blank" rel="noopener">Dmitriy0111/nanoFOX</a></li>
<li><a href="https://githubhelp.com/dosoon883/openFPGALoader" target="_blank" rel="noopener">openFPGALoaderé€šç”¨çƒ§å†™å·¥å…·</a></li>
<li><a href="https://embeddedbits.org/2020-02-20-extracting-firmware-from-devices-using-jtag/" target="_blank" rel="noopener">Extracting firmware from devices using JTAG</a></li>
</ul>
<h1 id="USB-Blasterè¿æ¥é—®é¢˜"><a href="#USB-Blasterè¿æ¥é—®é¢˜" class="headerlink" title="USB Blasterè¿æ¥é—®é¢˜"></a><code>USB Blaster</code>è¿æ¥é—®é¢˜</h1><ul>
<li><a href="https://wiki.archlinux.org/index.php/Altera_Design_Software#Error_when_scanning_hardware_-_Server_error" target="_blank" rel="noopener">Altera Design Software</a></li>
</ul>
<ul>
<li>å› ä¸ºè¿™é‡Œåªæƒ³ä½¿ç”¨<code>quartus_pgm</code>å‘½ä»¤,å°±åªä¸‹è½½äº†<code>QuartusProgrammerSetup-16.1.0.196-linux.run</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ jtagd --foreground --debug</span><br><span class="line"></span><br><span class="line">~$ ./jtagd --user-start --foreground</span><br><span class="line">~$ ./jtagconfig</span><br><span class="line">Error (Server error) when scanning hardware</span><br></pre></td></tr></table></figure>
<ul>
<li>æµ‹çœ‹ç³»ç»Ÿæ—¥å¿—</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ dmesg</span><br><span class="line">[...]</span><br><span class="line">[25811.819181] usb 4-2: USB disconnect, device number 16</span><br><span class="line">[25814.375520] usb 4-2: new full-speed USB device number 17 using xhci_hcd</span><br><span class="line">[25814.550270] usb 4-2: New USB device found, idVendor=09fb, idProduct=6001, bcdDevice= 4.00</span><br><span class="line">[25814.550283] usb 4-2: New USB device strings: Mfr=1, Product=2, SerialNumber=3</span><br><span class="line">[25814.550289] usb 4-2: Product: USB-Blaster</span><br><span class="line">[25814.550293] usb 4-2: Manufacturer: Altera</span><br><span class="line">[25814.550297] usb 4-2: SerialNumber: 91d28408</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ç›´æ¥è¿è¡Œ<code>jtagconfig</code>å‘½ä»¤,å°±å‡ºç°ä¸‹é¢è¿™ä¸ªé”™.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ ./jtagconfig</span><br><span class="line">Error when scanning hardware - Server error</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç„¶åç”¨<code>strace</code>è¿è¡Œåªè¿‡æ»¤æŸ¥çœ‹<code>network</code>è¿è¡Œæƒ…å†µå¦‚ä¸‹ï¼š</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$ strace -e trace=network jtagconfig</span><br><span class="line">[...]</span><br><span class="line">si_stime=0&#125; ---</span><br><span class="line">socket(AF_INET, SOCK_STREAM, IPPROTO_IP) = 3</span><br><span class="line">setsockopt(3, SOL_TCP, TCP_NODELAY, [1], 4) = 0</span><br><span class="line">setsockopt(3, SOL_SOCKET, SO_LINGER, &#123;l_onoff=1, l_linger=10&#125;, 8) = 0</span><br><span class="line">connect(3, &#123;sa_family=AF_INET, sin_port=htons(1309), sin_addr=inet_addr(<span class="string">"127.0.0.1"</span>)&#125;, 16) = -1 EINPROGRESS (Operation now <span class="keyword">in</span> progress)</span><br><span class="line">socket(AF_INET, SOCK_STREAM, IPPROTO_IP) = 4</span><br><span class="line">setsockopt(4, SOL_TCP, TCP_NODELAY, [1], 4) = 0</span><br><span class="line">setsockopt(4, SOL_SOCKET, SO_LINGER, &#123;l_onoff=1, l_linger=10&#125;, 8) = 0</span><br><span class="line">connect(4, &#123;sa_family=AF_INET, sin_port=htons(1309), sin_addr=inet_addr(<span class="string">"127.0.0.1"</span>)&#125;, 16) = -1 EINPROGRESS (Operation now <span class="keyword">in</span> progress)</span><br><span class="line">getsockopt(3, SOL_SOCKET, SO_ERROR, [0], [4]) = 0</span><br><span class="line">recvfrom(3, <span class="string">""</span>, 2, 0, NULL, NULL)       = 0</span><br><span class="line">getsockopt(4, SOL_SOCKET, SO_ERROR, [0], [4]) = 0</span><br><span class="line">recvfrom(4, <span class="string">""</span>, 2, 0, NULL, NULL)       = 0</span><br><span class="line">recvfrom(-1, 0x1e4ca0c, 2, 0, NULL, NULL) = -1 EBADF (Bad file descriptor)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ä¸ºæ’é™¤ç¡¬ä»¶é—®é¢˜,åˆæ²¡æœ‰ç¬¬äºŒå°ç”µè„‘ç³»ç»Ÿå¯è¯•.ä½¿ç”¨<code>Virtualbox</code>å®‰è£…äº†ä¸€ä¸ªåŒç‰ˆæœ¬çš„ç³»ç»Ÿæµ‹è¯•,å‘ç°åœ¨è™šæ‹Ÿæœºé‡Œä¸åšä»»ä½•è®¾ç½®,å°±å¯ä»¥æ­£å¸¸å‘ç°è®¾å¤‡.å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ ./jtagconfig</span><br><span class="line">1) USB-Blaster [2-2]</span><br><span class="line">  Unable to <span class="built_in">read</span> device chain - JTAG chain broken</span><br></pre></td></tr></table></figure>
</li>
<li><p>å†æ¬¡æŒ‰è£…å®˜æ–¹æ–‡æ¡£,å®‰è£…æ·»åŠ <code>udev</code>ç›¸å…³è®¾ç½®,å†æŠŠ<code>jtagd</code>å¼€å¯è°ƒè¯•æ¨¡å¼å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~<span class="comment"># cat&gt;/etc/udev/rules.d/51-altera-usb-blaster.rules&lt;&lt;EOF</span></span><br><span class="line">SUBSYSTEM==<span class="string">"usb"</span>, ATTR&#123;idVendor&#125;==<span class="string">"09fb"</span>, ATTR&#123;idProduct&#125;==<span class="string">"6001"</span>, MODE=<span class="string">"0666"</span></span><br><span class="line">SUBSYSTEM==<span class="string">"usb"</span>, ATTR&#123;idVendor&#125;==<span class="string">"09fb"</span>, ATTR&#123;idProduct&#125;==<span class="string">"6002"</span>, MODE=<span class="string">"0666"</span></span><br><span class="line">SUBSYSTEM==<span class="string">"usb"</span>, ATTR&#123;idVendor&#125;==<span class="string">"09fb"</span>, ATTR&#123;idProduct&#125;==<span class="string">"6003"</span>, MODE=<span class="string">"0666"</span></span><br><span class="line">SUBSYSTEM==<span class="string">"usb"</span>, ATTR&#123;idVendor&#125;==<span class="string">"09fb"</span>, ATTR&#123;idProduct&#125;==<span class="string">"6010"</span>, MODE=<span class="string">"0666"</span></span><br><span class="line">SUBSYSTEM==<span class="string">"usb"</span>, ATTR&#123;idVendor&#125;==<span class="string">"09fb"</span>, ATTR&#123;idProduct&#125;==<span class="string">"6810"</span>, MODE=<span class="string">"0666"</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">~$ jtagd --foreground --debug</span><br><span class="line">JTAG daemon started</span><br><span class="line">Using config file /etc/jtagd/jtagd.conf</span><br><span class="line">Remote JTAG permitted when password <span class="built_in">set</span></span><br><span class="line">USB-Blaster <span class="string">"USB-Blaster"</span> firmware version 4.00</span><br><span class="line">USB-Blaster endpoints out=02(64), <span class="keyword">in</span>=81(64); urb size=1024</span><br><span class="line">USB-Blaster added <span class="string">"USB-Blaster [4-2]"</span></span><br><span class="line">USB-Blaster port (/dev/bus/usb/004/017) opened</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½†æ˜¯ç›´æ¥è¿è¡Œ<code>jtagconfig</code>è¿˜æ˜¯ä¼šæŠ¥<code>Error when scanning hardware - Server error</code>é”™è¯¯.åé¢æŒ‰ç…§ä¸Šè¿°æ–‡æ¡£è¿›è¡Œä¸‹é¢çš„è®¾ç½®å°±å¯ä»¥äº†.</li>
</ul>
<h2 id="jtagdæœåŠ¡ç«¯é…ç½®"><a href="#jtagdæœåŠ¡ç«¯é…ç½®" class="headerlink" title="jtagdæœåŠ¡ç«¯é…ç½®"></a><code>jtagd</code>æœåŠ¡ç«¯é…ç½®</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~<span class="comment"># cp /fullpath/intelFPGA_lite/16.1/qprogrammer/linux64/pgm_parts.txt /etc/jtagd/jtagd.pgm_parts</span></span><br><span class="line">~<span class="comment"># echo "Password = \"123456\";" &gt; /etc/jtagd/jtagd.conf</span></span><br><span class="line">~<span class="comment"># killall -9 jtagd</span></span><br><span class="line">~$ jtagd --foreground --debug</span><br><span class="line">JTAG daemon started</span><br><span class="line">Using config file /etc/jtagd/jtagd.conf</span><br><span class="line">Remote JTAG permitted when password <span class="built_in">set</span></span><br><span class="line">USB-Blaster <span class="string">"USB-Blaster"</span> firmware version 4.00</span><br><span class="line">USB-Blaster endpoints out=02(64), <span class="keyword">in</span>=81(64); urb size=1024</span><br><span class="line">USB-Blaster added <span class="string">"USB-Blaster [6-2]"</span></span><br><span class="line">USB-Blaster port (/dev/bus/usb/006/002) opened</span><br><span class="line">USB-Blaster <span class="string">"USB-Blaster"</span> firmware version 4.00</span><br><span class="line">USB-Blaster endpoints out=02(64), <span class="keyword">in</span>=81(64); urb size=1024</span><br><span class="line">USB-Blaster reports JTAG protocol version 0, using version 0</span><br></pre></td></tr></table></figure>
<h2 id="jtagconfigé…ç½®"><a href="#jtagconfigé…ç½®" class="headerlink" title="jtagconfigé…ç½®"></a><code>jtagconfig</code>é…ç½®</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ jtagconfig --addserver 127.0.0.1 123456</span><br><span class="line">~$ jtagconfig</span><br><span class="line">1) USB-Blaster on 127.0.0.1 [6-2]</span><br><span class="line">  020F30DD   EP3C25/EP4CE22</span><br></pre></td></tr></table></figure>
<h1 id="è°¢è°¢æ”¯æŒ"><a href="#è°¢è°¢æ”¯æŒ" class="headerlink" title="è°¢è°¢æ”¯æŒ"></a>è°¢è°¢æ”¯æŒ</h1><ul>
<li>å¾®ä¿¡äºŒç»´ç :</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/13/æœºå™¨å­¦ä¹ -ML-ç¯å¢ƒçš„æ­å»º/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/13/æœºå™¨å­¦ä¹ -ML-ç¯å¢ƒçš„æ­å»º/" class="post-title-link" itemprop="url">æœºå™¨å­¦ä¹ (ML)ç¯å¢ƒçš„æ­å»º</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-01-13 19:11:23" itemprop="dateCreated datePublished" datetime="2021-01-13T19:11:23+08:00">2021-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-05-15 17:23:40" itemprop="dateModified" datetime="2022-05-15T17:23:40+08:00">2022-05-15</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="æœºå™¨å­¦ä¹ æ¡†æ¶ä»‹ç»"><a href="#æœºå™¨å­¦ä¹ æ¡†æ¶ä»‹ç»" class="headerlink" title="æœºå™¨å­¦ä¹ æ¡†æ¶ä»‹ç»"></a>æœºå™¨å­¦ä¹ æ¡†æ¶ä»‹ç»</h1><ul>
<li><a href="https://www.jiqizhixin.com/articles/keras-or-pytorch" target="_blank" rel="noopener">Keras vs PyTorchï¼šè°æ˜¯ã€Œç¬¬ä¸€ã€æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Ÿ</a></li>
</ul>
<h1 id="CUDA"><a href="#CUDA" class="headerlink" title="CUDA"></a>CUDA</h1><p><a href="https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html" target="_blank" rel="noopener">NVIDIA CUDA Toolkit Release Notes</a><br><a href="https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html" target="_blank" rel="noopener">Linux å®‰è£…æŒ‡å¯¼</a></p>
<p>##ã€€æœ¬æœºç³»ç»Ÿ</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">~$ nvidia-debugdump -l</span><br><span class="line">Found 1 NVIDIA devices</span><br><span class="line">	Device ID:              0</span><br><span class="line">	Device name:            Quadro P600   (*PrimaryCard)</span><br><span class="line">	GPU internal ID:        0422018092726</span><br><span class="line"></span><br><span class="line">~$ cat /etc/*release</span><br><span class="line">PRETTY_NAME=<span class="string">"Debian GNU/Linux 9 (stretch)"</span></span><br><span class="line">NAME=<span class="string">"Debian GNU/Linux"</span></span><br><span class="line">VERSION_ID=<span class="string">"9"</span></span><br><span class="line">VERSION=<span class="string">"9 (stretch)"</span></span><br><span class="line">ID=debian</span><br><span class="line">HOME_URL=<span class="string">"https://www.debian.org/"</span></span><br><span class="line">SUPPORT_URL=<span class="string">"https://www.debian.org/support"</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">"https://bugs.debian.org/"</span></span><br><span class="line"></span><br><span class="line">~$ gcc -v</span><br><span class="line">Using built-in specs.</span><br><span class="line">COLLECT_GCC=gcc</span><br><span class="line">COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/6/lto-wrapper</span><br><span class="line">Target: x86_64-linux-gnu</span><br><span class="line">Configured with: ../src/configure -v --with-pkgversion=<span class="string">'Debian 6.3.0-18+deb9u1'</span> --with-bugurl=file:///usr/share/doc/gcc-6/README.Bugs --<span class="built_in">enable</span>-languages=c,ada,c++,java,go,d,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-6 --program-prefix=x86_64-linux-gnu- --<span class="built_in">enable</span>-shared --<span class="built_in">enable</span>-linker-build-id --libexecdir=/usr/lib --without-included-gettext --<span class="built_in">enable</span>-threads=posix --libdir=/usr/lib --<span class="built_in">enable</span>-nls --with-sysroot=/ --<span class="built_in">enable</span>-clocale=gnu --<span class="built_in">enable</span>-libstdcxx-debug --<span class="built_in">enable</span>-libstdcxx-time=yes --with-default-libstdcxx-abi=new --<span class="built_in">enable</span>-gnu-unique-object --<span class="built_in">disable</span>-vtable-verify --<span class="built_in">enable</span>-libmpx --<span class="built_in">enable</span>-plugin --<span class="built_in">enable</span>-default-pie --with-system-zlib --<span class="built_in">disable</span>-browser-plugin --<span class="built_in">enable</span>-java-awt=gtk --<span class="built_in">enable</span>-gtk-cairo --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-6-amd64/jre --<span class="built_in">enable</span>-java-home --with-jvm-root-dir=/usr/lib/jvm/java-1.5.0-gcj-6-amd64 --with-jvm-jar-dir=/usr/lib/jvm-exports/java-1.5.0-gcj-6-amd64 --with-arch-directory=amd64 --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --with-target-system-zlib --<span class="built_in">enable</span>-objc-gc=auto --<span class="built_in">enable</span>-multiarch --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --<span class="built_in">enable</span>-multilib --with-tune=generic --<span class="built_in">enable</span>-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu</span><br><span class="line">Thread model: posix</span><br><span class="line">gcc version 6.3.0 20170516 (Debian 6.3.0-18+deb9u1)</span><br></pre></td></tr></table></figure>
<h2 id="å®‰è£…CUDA"><a href="#å®‰è£…CUDA" class="headerlink" title="å®‰è£…CUDA"></a>å®‰è£…<code>CUDA</code></h2><ul>
<li>æ ¹æ®å®ƒå®˜æ–¹çš„æŒ‡å¯¼é€‰æ‹©å®‰è£…é€‚åˆç‰ˆæœ¬.</li>
</ul>
<p>Table 1. CUDA Toolkit and Compatible Driver Versions<br>|CUDA Toolkit ã€€| Linux x86_64 Driver Version |ã€€ Windows x86_64 Driver Version|<br>|:â€”:|:â€”-:|:â€”-:|<br>CUDA 10.0.130 |&gt;= 410.48 |&gt;= 411.31|<br>CUDA 9.2 (9.2.148 Update 1) |&gt;= 396.37| &gt;= 398.26|<br>CUDA 9.2 (9.2.88) |&gt;= 396.26 |&gt;= 397.44|<br>CUDA 9.1 (9.1.85) |&gt;= 390.46 |&gt;= 391.29|<br>CUDA 9.0 (9.0.76) |&gt;= 384.81 |&gt;= 385.54|<br>CUDA 8.0 (8.0.61 GA2) |&gt;= 375.26 |&gt;= 376.51|<br>CUDA 8.0 (8.0.44) |&gt;= 367.48 |&gt;= 369.30|<br>CUDA 7.5 (7.5.16) |&gt;= 352.31 |&gt;= 353.66|<br>CUDA 7.0 (7.0.28) |&gt;= 346.46 |&gt;= 347.62|</p>
<ul>
<li>ä¸‹è½½æœ€ä½è¦æ±‚ç‰ˆæœ¬çš„<code>Nvidia</code>å®˜æ–¹é©±åŠ¨.<a href="http://cn.download.nvidia.com/XFree86/Linux-x86_64/410.78/NVIDIA-Linux-x86_64-410.78.run" target="_blank" rel="noopener">NVIDIA-Linux-x86_64-410.78.run</a></li>
<li>å¸è½½ç³»ç»ŸåŸæ¥å®‰è£…çš„é©±åŠ¨.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ dpkg -l | grep <span class="string">"nvidia"</span> | awk <span class="string">'&#123;print $2&#125;'</span> | xargs sudo dpkg --purge</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„<code>CUDA</code>å·¥å…·åŒ….<a href="https://developer.download.nvidia.com/compute/cuda/10.0/secure/Prod/local_installers/cuda_10.0.130_410.48_linux.run?j0ZWXA-WVRqKfUBpEbr_PoKcZMFC4A_GF2tVIqikkd86eHzZ7a6JMzSLMW7QDNY4c31aZNCz4r8xr-mAll_HXTNTv38nBKeSXPfDWh5Om9TUQxeGn5-DUMWuLPBVyN7owCuzkqIg0cEj7Qy-ak6V4EVjQcTqJSQnvz46pMIwCCFkWjWldDkmBaY4ym4" target="_blank" rel="noopener">cuda_10.0.130_410.48_linux.run</a>,æˆ–è€…å®‰è£…<a href="https://developer.download.nvidia.com/compute/cuda/10.0/secure/Prod/local_installers/cuda-repo-ubuntu1804-10-0-local-10.0.130-410.48_1.0-1_amd64.deb?t5lvzn9mOt6TXU8k0EIHIpxsvPxTl625K5sYSjGJR1xuhM9RXs2_xKvLXCne1-HL94FvndxavqoSL-e1OB6SJKTSU0XuOinK9LkzgPDpRUm_u0Sz5-snuL6iOowDYqlj8Zjhia80gBKO2HZtszRN5XUZtaZdJ3Yfdix-0oEFbeTMX6kSoZ54Bx2ou8D7f3UehVwqJHHF9v_x4Qj1uzl736rLOpFCMDeqP97wvXw" target="_blank" rel="noopener">cuda-repo-ubuntu1804-10-0-local-10.0.130-410.48_1.0-1_amd64.deb</a></li>
<li>å®‰è£…æ­¥éª¤,å…ˆå®‰è£…æ˜¾å¡é©±åŠ¨,å†å®‰è£…<code>NVIDIA CUDA Toolkit</code>,å¦‚æœæ˜¯å®‰è£…<code>cuda_10.0.130_410.48_linux.run</code>,å®‰è£…è¿‡ç¨‹ä¸­æ³¨æ„äº¤äº’é€‰é¡¹.</li>
</ul>
<ul>
<li>æµ‹è¯•å®‰è£…</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">~$ nvidia-smi</span><br><span class="line">Fri Nov 23 11:00:29 2018</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 410.48                 Driver Version: 410.48                    |</span><br><span class="line">|-------------------------------+----------------------+----------------------+</span><br><span class="line">| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|===============================+======================+======================|</span><br><span class="line">|   0  Quadro P600         Off  | 00000000:01:00.0  On |                  N/A |</span><br><span class="line">| 34%   31C    P8    N/A /  N/A |    401MiB /  1999MiB |      4%      Default |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line"></span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| Processes:                                                       GPU Memory |</span><br><span class="line">|  GPU       PID   Type   Process name                             Usage      |</span><br><span class="line">|=============================================================================|</span><br><span class="line">|    0       898      G   /usr/lib/xorg/Xorg                           156MiB |</span><br><span class="line">|    0     13787      G   ...uest-channel-token=15869920746181936845    96MiB |</span><br><span class="line">|    0     16550      G   ...-token=D890EF91A7BB8E03F6D8D7795CC12E48   145MiB |</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<ul>
<li>å®‰è£…ç›¸åº”ç‰ˆæœ¬çš„<code>cuDNN</code>åº“,<a href="https://developer.download.nvidia.com/compute/machine-learning/cudnn/secure/v7.4.1.5/prod/10.0_20181108/cudnn-10.0-linux-x64-v7.4.1.5.tgz?yy5bIMR_T6teT802n-6Q1N7XOLT_IUZSyGPnOriJWgNToZqQHrWJ7icJRMWzM-t-i6cstubN8zgjNM47iWexqg5a_g58BNZCwtYCjOBybcDzssG0sBpYF-yDeadCmHy6dFaYLSyj-7aVJBFYNRqHm-9UAP03TsBDCBH7xdztNFZOYLmHVIw271t5fTy1yYDTtCSf8Qs32lbYoNNaJnaXPe8p" target="_blank" rel="noopener">cudnn-10.0-linux-x64-v7.4.1.5.tgz</a></li>
</ul>
<ul>
<li>å®‰è£…ç›¸åº”ç‰ˆæœ¬çš„<a href="https://developer.nvidia.com/nccl" target="_blank" rel="noopener"><code>NCCL</code></a>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ tar xvf cudnn-10.0-linux-x64-v7.4.1.5.tgz -C /usr/<span class="built_in">local</span></span><br></pre></td></tr></table></figure>
<h2 id="Debian-Busterä¸‹å®‰è£…Nvidia-teslaé©±åŠ¨"><a href="#Debian-Busterä¸‹å®‰è£…Nvidia-teslaé©±åŠ¨" class="headerlink" title="Debian Busterä¸‹å®‰è£…Nvidia-teslaé©±åŠ¨"></a>Debian Busterä¸‹å®‰è£…<code>Nvidia-tesla</code>é©±åŠ¨</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">~$ apt-get install nvidia-tesla-460-kernel-dkms nvidia-tesla-460-driver libnvidia-tesla-460-cuda1 nvidia-xconfig nvidia-tesla-460-smi</span><br><span class="line">~$ nvidia-smi</span><br><span class="line">Sat Mar 27 21:01:55 2021</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 460.32.03    Driver Version: 460.32.03    CUDA Version: 11.2     |</span><br><span class="line">|-------------------------------+----------------------+----------------------+</span><br><span class="line">| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|                               |                      |               MIG M. |</span><br><span class="line">|===============================+======================+======================|</span><br><span class="line">|   0  GeForce GT 1030     On   | 00000000:05:00.0  On |                  N/A |</span><br><span class="line">| N/A   38C    P5    N/A /  30W |    449MiB /  2000MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N/A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line"></span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| Processes:                                                                  |</span><br><span class="line">|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |</span><br><span class="line">|        ID   ID                                                   Usage      |</span><br><span class="line">|=============================================================================|</span><br><span class="line">|    0   N/A  N/A      3365      G   /usr/lib/xorg/Xorg                326MiB |</span><br><span class="line">|    0   N/A  N/A     10847      G   ...AAAAAAAAA= --shared-files       22MiB |</span><br><span class="line">|    0   N/A  N/A     15542      G   ...chael/firefox/firefox-bin        0MiB |</span><br><span class="line">|    0   N/A  N/A     16429      G   ...AAAAAAAA== --shared-files       97MiB |</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…dkmsé©±åŠ¨å‡ºé”™"><a href="#å®‰è£…dkmsé©±åŠ¨å‡ºé”™" class="headerlink" title="å®‰è£…dkmsé©±åŠ¨å‡ºé”™"></a>å®‰è£…<code>dkms</code>é©±åŠ¨å‡ºé”™</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/dkms/nvidia-tesla-460/460.91.03/build/common/inc/nv-misc.h:20:12: fatal error: stddef.h: No such file or directory</span><br><span class="line">514    20 |   <span class="comment">#include &lt;stddef.h&gt;     // NULL</span></span><br><span class="line">515       |            ^~~~~~~~~~</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸Šé¢é”™è¯¯,æ˜¯æ²¡æœ‰åŒ…å«<code>/usr/src/&lt;linux-5.17-SRC&gt;/include/linux</code>çš„å¤´æ–‡ä»¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªé©±åŠ¨çš„<code>patch</code>é›†åˆ,éœ€è¦æŠŠä¸‹é¢è¿™ä¸ªæ–‡ä»¶åŠ å…¥åˆ°<code>/usr/src/nvidia-tesla-460-460.91.03/dkms.conf</code>å†…ã€‚</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">~$ cat nvidia-tesla-460-460.91.03/patches/nvidia-tesla-460-linux-5.17-combind.patch</span><br><span class="line">diff -u a/Kbuild  b/Kbuild</span><br><span class="line">--- a/Kbuild	2021-07-02 14:04:57.000000000 +0800</span><br><span class="line">+++ a/Kbuild	2022-05-15 12:38:09.968486119 +0800</span><br><span class="line">@@ -68,7 +68,7 @@</span><br><span class="line"></span><br><span class="line"> EXTRA_CFLAGS += -I$(src)/common/inc</span><br><span class="line"> EXTRA_CFLAGS += -I$(src)</span><br><span class="line">-EXTRA_CFLAGS += -Wall -MD $(DEFINES) $(INCLUDES) -Wno-cast-qual -Wno-error -Wno-format-extra-args</span><br><span class="line">+EXTRA_CFLAGS += -Wall -MD $(DEFINES) $(INCLUDES) -Wno-cast-qual -Wno-error -Wno-format-extra-args -I./include/linux</span><br><span class="line"> EXTRA_CFLAGS += -D__KERNEL__ -DMODULE -DNVRM -DNV_VERSION_STRING=\"460.91.03\" -Wno-unused-function -Wuninitialized -fno-strict-aliasing -mno-red-zone -mcmodel=kernel -DNV_UVM_ENABLE</span><br><span class="line"> EXTRA_CFLAGS += $(call cc-option,-Werror=undef,)</span><br><span class="line"> EXTRA_CFLAGS += -DNV_SPECTRE_V2=$(NV_SPECTRE_V2)</span><br><span class="line"></span><br><span class="line">diff -ruN a/nvidia-uvm/uvm_linux.h b/nvidia-uvm/uvm_linux.h</span><br><span class="line">--- a/nvidia-uvm/uvm_linux.h	2021-07-02 14:07:31.000000000 +0800</span><br><span class="line">+++ b/nvidia-uvm/uvm_linux.h	2021-09-04 00:24:32.426673346 +0800</span><br><span class="line">@@ -485,7 +485,7 @@</span><br><span class="line"> <span class="comment">#elif (NV_WAIT_ON_BIT_LOCK_ARGUMENT_COUNT == 4)</span></span><br><span class="line">     static __sched int uvm_bit_wait(void *word)</span><br><span class="line">     &#123;</span><br><span class="line">-        <span class="keyword">if</span> (signal_pending_state(current-&gt;state, current))</span><br><span class="line">+        <span class="keyword">if</span> (signal_pending_state(current-&gt;__state, current))</span><br><span class="line">             <span class="built_in">return</span> 1;</span><br><span class="line">         schedule();</span><br><span class="line">         <span class="built_in">return</span> 0;</span><br><span class="line"></span><br><span class="line">diff -u nvidia-tesla-460-460.91.03&#123;,.old&#125;/nvidia-drm/nvidia-drm-format.c</span><br><span class="line">--- nvidia-tesla-460-460.91.03/nvidia-drm/nvidia-drm-format.c	2021-07-02 14:07:31.000000000 +0800</span><br><span class="line">+++ nvidia-tesla-460-460.91.03.old/nvidia-drm/nvidia-drm-format.c	2022-05-15 15:17:23.498152286 +0800</span><br><span class="line">@@ -29,6 +29,7 @@</span><br><span class="line"> <span class="comment">#endif</span></span><br><span class="line"> <span class="comment">#include &lt;linux/kernel.h&gt;</span></span><br><span class="line"></span><br><span class="line">+<span class="comment">#include "nvidia-uvm/uvm_linux.h"</span></span><br><span class="line"> <span class="comment">#include "nvidia-drm-format.h"</span></span><br><span class="line"> <span class="comment">#include "nvidia-drm-os-interface.h"</span></span><br><span class="line"></span><br><span class="line">diff -u nvidia-tesla-460-460.91.03/common/inc/nv-procfs.h nvidia-tesla-460-460.91.03.old/common/inc/nv-procfs.h</span><br><span class="line">--- nvidia-tesla-460-460.91.03/common/inc/nv-procfs.h	2021-07-02 14:07:32.000000000 +0800</span><br><span class="line">+++ nvidia-tesla-460-460.91.03.old/common/inc/nv-procfs.h	2022-05-15 15:52:20.475063183 +0800</span><br><span class="line">@@ -11,6 +11,11 @@</span><br><span class="line"> <span class="comment">#define _NV_PROCFS_H</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">#include "conftest.h"</span></span><br><span class="line">+<span class="comment">#include &lt;linux/version.h&gt;</span></span><br><span class="line">+<span class="comment">#if (LINUX_VERSION_CODE &gt; KERNEL_VERSION(5,17,0))</span></span><br><span class="line">+<span class="comment">#define NV_PDE_DATA_PRESENT</span></span><br><span class="line">+<span class="comment">#define PDE_DATA(inode) pde_data(inode)</span></span><br><span class="line">+<span class="comment">#endif</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">#ifdef CONFIG_PROC_FS</span></span><br><span class="line"> <span class="comment">#include &lt;linux/proc_fs.h&gt;</span></span><br><span class="line">diff --git a/common/inc/nv-time.h b/common/inc/nv-time.h</span><br><span class="line">index dc80806..cc343a5 100644</span><br><span class="line">--- a/common/inc/nv-time.h</span><br><span class="line">+++ b/common/inc/nv-time.h</span><br><span class="line">@@ -23,6 +23,7 @@</span><br><span class="line"> <span class="comment">#ifndef __NV_TIME_H__</span></span><br><span class="line"> <span class="comment">#define __NV_TIME_H__</span></span><br><span class="line"></span><br><span class="line">+<span class="comment">#include &lt;linux/version.h&gt;</span></span><br><span class="line"> <span class="comment">#include "conftest.h"</span></span><br><span class="line"> <span class="comment">#include &lt;linux/sched.h&gt;</span></span><br><span class="line"> <span class="comment">#include &lt;linux/delay.h&gt;</span></span><br><span class="line">@@ -205,7 +206,12 @@ static inline NV_STATUS nv_sleep_ms(unsigned int ms)</span><br><span class="line">         // the requested timeout has expired, loop until less</span><br><span class="line">         // than a jiffie of the desired delay remains.</span><br><span class="line">         //</span><br><span class="line">+<span class="comment">#if (LINUX_VERSION_CODE &lt; KERNEL_VERSION(5, 14, 0))</span></span><br><span class="line">         current-&gt;state = TASK_INTERRUPTIBLE;</span><br><span class="line">+<span class="comment">#else</span></span><br><span class="line">+        // Rel. commit <span class="string">"sched: Change task_struct::state"</span> (Peter Zijlstra, Jun 11 2021)</span><br><span class="line">+        WRITE_ONCE(current-&gt;__state, TASK_INTERRUPTIBLE);</span><br><span class="line">+<span class="comment">#endif</span></span><br><span class="line">         <span class="keyword">do</span></span><br><span class="line">         &#123;</span><br><span class="line">             schedule_timeout(jiffies);</span><br><span class="line"></span><br><span class="line">diff --git a/nvidia-drm/nvidia-drm-drv.c b/nvidia-drm/nvidia-drm-drv.c</span><br><span class="line">index 84d4479..99ea552 100644</span><br><span class="line">--- a/nvidia-drm/nvidia-drm-drv.c</span><br><span class="line">+++ b/nvidia-drm/nvidia-drm-drv.c</span><br><span class="line">@@ -20,6 +20,7 @@</span><br><span class="line">  * DEALINGS IN THE SOFTWARE.</span><br><span class="line">  */</span><br><span class="line"></span><br><span class="line">+<span class="comment">#include &lt;linux/version.h&gt;</span></span><br><span class="line"> <span class="comment">#include "nvidia-drm-conftest.h" /* NV_DRM_AVAILABLE and NV_DRM_DRM_GEM_H_PRESENT */</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">#include "nvidia-drm-priv.h"</span></span><br><span class="line">@@ -903,9 +904,12 @@ static void nv_drm_register_drm_device(const nv_gpu_info_t *gpu_info)</span><br><span class="line"></span><br><span class="line">     dev-&gt;dev_private = nv_dev;</span><br><span class="line">     nv_dev-&gt;dev = dev;</span><br><span class="line">+<span class="comment">#if (LINUX_VERSION_CODE &lt; KERNEL_VERSION(5, 14, 0))</span></span><br><span class="line">+    // Rel. commit <span class="string">"drm: Remove pdev field from struct drm_device"</span> (Thomas Zimmermann, 3 May 2021)</span><br><span class="line">     <span class="keyword">if</span> (device-&gt;bus == &amp;pci_bus_type) &#123;</span><br><span class="line">         dev-&gt;pdev = to_pci_dev(device);</span><br><span class="line">     &#125;</span><br><span class="line">+<span class="comment">#endif</span></span><br><span class="line"></span><br><span class="line">     /* Register DRM device to DRM sub-system */</span><br></pre></td></tr></table></figure>
<h2 id="å®‰è£…-PyCuda"><a href="#å®‰è£…-PyCuda" class="headerlink" title="å®‰è£… PyCuda"></a>å®‰è£… PyCuda</h2><ul>
<li><a href="https://codeyarns.com/2015/07/31/pip-install-error-with-pycuda/" target="_blank" rel="noopener">Pip install error with PyCUDA</a><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/cuda-10.0/bin:<span class="variable">$PATH</span></span><br><span class="line">~$ pip install pycuda</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Nvidia-Dockerå®‰è£…"><a href="#Nvidia-Dockerå®‰è£…" class="headerlink" title="Nvidia Dockerå®‰è£…"></a><code>Nvidia Docker</code>å®‰è£…</h2><p><a href="https://github.com/NVIDIA/nvidia-docker" target="_blank" rel="noopener">nvidia-docker</a></p>
<ul>
<li>è¿™é‡ŒæŒ‰ç…§ä¸Šé¢é“¾æ¥çš„æ–‡æ¡£å®‰è£…å¦‚ä¸‹.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If you have nvidia-docker 1.0 installed: we need to remove it and all existing GPU containers</span></span><br><span class="line">docker volume ls -q -f driver=nvidia-docker | xargs -r -I&#123;&#125; -n1 docker ps -q -a -f volume=&#123;&#125; | xargs -r docker rm -f</span><br><span class="line">sudo apt-get purge -y nvidia-docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add the package repositories</span></span><br><span class="line">curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | \</span><br><span class="line">  sudo apt-key add -</span><br><span class="line">distribution=$(. /etc/os-release;<span class="built_in">echo</span> <span class="variable">$ID</span><span class="variable">$VERSION_ID</span>)</span><br><span class="line">curl -s -L https://nvidia.github.io/nvidia-docker/<span class="variable">$distribution</span>/nvidia-docker.list | \</span><br><span class="line">  sudo tee /etc/apt/sources.list.d/nvidia-docker.list</span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install nvidia-docker2 and reload the Docker daemon configuration</span></span><br><span class="line">sudo apt-get install -y nvidia-docker2</span><br><span class="line">sudo pkill -SIGHUP dockerd <span class="comment">#ã€€å¦‚æœä¹‹å‰æœ‰å®‰è£…è¿‡Docker,è¿™ä¸€æ­¥å¾ˆé‡è¦,åœæ‰ä¹‹å‰çš„è¿›ç¨‹.</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="ç”¨Dockerå®‰è£…Tensorflow-GPU"><a href="#ç”¨Dockerå®‰è£…Tensorflow-GPU" class="headerlink" title="ç”¨Dockerå®‰è£…Tensorflow GPU"></a>ç”¨<code>Docker</code>å®‰è£…<code>Tensorflow GPU</code></h3><ul>
<li><a href="https://www.tensorflow.org/install/gpu" target="_blank" rel="noopener">TensorFlow gpu</a></li>
<li><a href="https://github.com/nlintz/TensorFlow-Tutorials" target="_blank" rel="noopener">TensorFlow-Tutorials</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ docker pull tensorflow/tensorflow:latest-gpu \</span><br><span class="line">~$ nvidia-docker run -it --rm tensorflow/tensorflow:latest-gpu    python -c <span class="string">"import tensorflow as tf; tf.enable_eager_execution(); print(tf.reduce_sum(tf.random_normal([1000, 1000])))"</span></span><br><span class="line">2018-11-23 03:45:33.118841: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA</span><br><span class="line">2018-11-23 03:45:33.196995: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:964] successful NUMA node <span class="built_in">read</span> from SysFS had negative value (-1), but there must be at least one NUMA node,so returning NUMA node zero</span><br><span class="line">2018-11-23 03:45:33.197568: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1432] Found device 0 with properties:</span><br><span class="line">name: Quadro P600 major: 6 minor: 1 memoryClockRate(GHz): 1.5565</span><br><span class="line">pciBusID: 0000:01:00.0</span><br><span class="line">totalMemory: 1.95GiB freeMemory: 1.57GiB</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<h2 id="Nvidia-GPU-CLOUDå®¹å™¨äº‘"><a href="#Nvidia-GPU-CLOUDå®¹å™¨äº‘" class="headerlink" title="Nvidia GPU CLOUDå®¹å™¨äº‘"></a><code>Nvidia GPU CLOUD</code>å®¹å™¨äº‘</h2><h3 id="å®‰è£…ä¸è¿è¡ŒCaffe2å®¹å™¨"><a href="#å®‰è£…ä¸è¿è¡ŒCaffe2å®¹å™¨" class="headerlink" title="å®‰è£…ä¸è¿è¡ŒCaffe2å®¹å™¨,"></a>å®‰è£…ä¸è¿è¡Œ<code>Caffe2</code>å®¹å™¨,</h3><ul>
<li><a href="https://caffe2.ai/docs/getting-started.html?platform=ubuntu&amp;configuration=docker" target="_blank" rel="noopener">ä» caffe2.ai å®‰è£…æŒ‡å—</a>,</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ docker run --runtime=nvidia -it caffe2ai/caffe2:latest python -m caffe2.python.operator_test.relu_op_test</span><br><span class="line">Trying example: test_relu(self=&lt;__main__.TestRelu testMethod=test_relu&gt;, X=array([[[-0.42894608],</span><br><span class="line">        [-0.65820682],</span><br><span class="line">        [ 0.39978197],</span><br><span class="line">		[...]</span><br></pre></td></tr></table></figure>
<ul>
<li><p><a href="https://ngc.nvidia.com/catalog/containers/nvidia%2Fcaffe2" target="_blank" rel="noopener">ä» Nvidia GPU CLOUD (NGC) ä¸Šå®‰è£…</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ docker pull nvcr.io/nvidia/caffe2:18.08-py3</span><br><span class="line"><span class="comment"># è¿è¡Œæµ‹è¯•.</span></span><br><span class="line">~$ nvidia-docker run --runtime=nvidia -it nvcr.io/nvidia/caffe2:18.08-py3  python -m caffe2.python.operator_test.relu_op_test</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸‹é¢åœ¨<code>Docker</code>é‡Œè¿è¡Œ<code>jupyter notebook</code>çš„å®ä¾‹,æŠŠå®ƒåœ¨<code>docker</code>é‡Œçš„<strong>8888</strong>ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„<strong>9999</strong>ç«¯å£,é€šè¿‡å®¿ä¸»æœºçš„æµè§ˆå™¨,è¾“å…¥<code>http://127.0.0.1:9999/</code>å¯ä»¥è®¿é—®åˆ°å®ƒ.</p>
</li>
<li><code>--rm</code> å½“å®¹å™¨å…³é—­ååˆ é™¤å®ƒ</li>
<li><code>--it</code> ä»¥äº¤äº’æ¨¡å¼è¿è¡Œ</li>
<li><code>-v</code>ã€€æ˜ å°„å®¿ä¸»æœºçš„ç›®å½•åˆ°å®¹å™¨é‡Œ.å¦‚ä¸Šæ–‡å°±æ˜¯æŠŠå®¿ä¸»æœºçš„<code>/data/AI-DIR/TensorFlow/jupyter-notebook</code>,æ˜ å°„åˆ°å®¹å™¨é‡Œçš„<code>/data/jupyter</code>ç›®å½•.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ nvidia-docker run --rm  --shm-size=1g --<span class="built_in">ulimit</span> memlock=-1 --<span class="built_in">ulimit</span> stack=67108864 -v /data/AI-DIR/TensorFlow/jupyter-notebook:/data/jupyter  -it-p 9999:8888 nvcr.io/nvidia/caffe2:18.08-py3  sh -c <span class="string">"jupyter notebook --no-browser --allow-root --ip 0.0.0.0 /data/jupyter"</span></span><br><span class="line"></span><br><span class="line">============</span><br><span class="line">== Caffe2 ==</span><br><span class="line">============</span><br><span class="line"></span><br><span class="line">NVIDIA Release 18.08 (build 599137)</span><br><span class="line"></span><br><span class="line">Container image Copyright (c) 2018, NVIDIA CORPORATION. All rights reserved.</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<h1 id="å®‰è£…PyTorch"><a href="#å®‰è£…PyTorch" class="headerlink" title="å®‰è£…PyTorch"></a>å®‰è£…<code>PyTorch</code></h1><ul>
<li><a href="https://github.com/pytorch/pytorch/#from-source" target="_blank" rel="noopener">PyTorch å®‰è£…</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ docker pull nvcr.io/nvidia/pytorch:18.11-py3</span><br></pre></td></tr></table></figure>
<h2 id="ä»æºç å®‰è£…PyTorch"><a href="#ä»æºç å®‰è£…PyTorch" class="headerlink" title="ä»æºç å®‰è£…PyTorch"></a>ä»æºç å®‰è£…<code>PyTorch</code></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ pyenv activate  py3dev  <span class="comment"># é€šè¿‡ã€€pyenvã€€è¿›å…¥ã€€Python 3.6çš„è™šæ‹Ÿç¯å¢ƒ.</span></span><br><span class="line">~$ pip install numpy pyyaml mkl mkl-include setuptools cmake cffi typing <span class="comment"># py3devã€€ç¯å¢ƒä¸­å®‰è£…ä¾èµ–åº“.</span></span><br><span class="line">~$ <span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/cuda-10.0/bin:<span class="variable">$PATH</span></span><br><span class="line">~$ <span class="built_in">export</span> CUDA=1</span><br><span class="line">~$ pip install pycuda</span><br><span class="line">~$ git <span class="built_in">clone</span> --recursive https://github.com/pytorch/pytorch</span><br><span class="line">~$ <span class="built_in">cd</span> pytorch</span><br><span class="line">~$ python setup.py install</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœåœ¨ä½¿ç”¨<code>numpy</code>ä¸­å‡ºç°<code>libmkl_rt.so: cannot open shared object file: No such file or directory</code>é”™è¯¯,è¦å®‰è£…<code>libmkl_rt</code>å†é‡æ–°å®‰è£…<code>numpy</code>çš„åº“.</li>
<li>ç°åœ¨<code>caffe2</code>å·²ç»è¿›å…¥åˆ°<code>PyTorch</code>æºç é‡Œå¦‚æœå¯¼å…¥ä¸‹é¢æ¨¡å—æ—¶,å‡ºç°<strong>ModuleNotFoundError: No module named â€˜pastâ€™</strong>é”™è¯¯,è¦å…ˆå®‰è£…ä¾èµ–<code>pip install future</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> caffe2.python.predictor.predictor_exporter <span class="keyword">as</span> pe</span><br><span class="line"><span class="keyword">from</span> caffe2.python <span class="keyword">import</span> core,model_helper,net_drawer,workspace,visualize,brew</span><br><span class="line">ModuleNotFoundError: No module named <span class="string">'past'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>è­¦å‘Š<code>net_drawer will not run correctly. Please install the correct dependencies.</code>,è¯¥è­¦å‘Šæ˜¯å› æ²¡æœ‰å®‰è£…<code>pydot</code>.å®‰è£…<code>pip install pydot</code>.</li>
</ul>
<h1 id="æºç å®‰è£…TensorFlow-æ”¯æŒ-CUDA-10"><a href="#æºç å®‰è£…TensorFlow-æ”¯æŒ-CUDA-10" class="headerlink" title="æºç å®‰è£…TensorFlow (æ”¯æŒ CUDA 10)"></a>æºç å®‰è£…<code>TensorFlow (æ”¯æŒ CUDA 10)</code></h1><ul>
<li><a href="https://medium.com/@o.kroeger/tensorflow-mnist-and-your-own-handwritten-digits-4d1cd32bbab4" target="_blank" rel="noopener">Tensorflow, MNIST and your own handwritten digits</a></li>
<li><a href="https://github.com/caicloud/tensorflow-tutorial" target="_blank" rel="noopener">Tensorflow å®æˆ˜ Google æ·±åº¦å­¦ä¹ æ¡†æ¶æºä»£ç </a></li>
</ul>
<h2 id="å®‰è£…Bazel"><a href="#å®‰è£…Bazel" class="headerlink" title="å®‰è£…Bazel"></a>å®‰è£…<code>Bazel</code></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">echo</span> <span class="string">'deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8'</span> | sudo tee /etc/apt/sources.list.d/bazel.list</span><br><span class="line">~$ curl https://bazel.build/bazel-release.pub.gpg | sudo apt-key add -</span><br><span class="line">~$ sudo apt-get update</span><br><span class="line">~$ sudo apt-get install bazel</span><br></pre></td></tr></table></figure>
<ul>
<li>å› ä¸ºå¢™çš„åŸå› ,å¯èƒ½ä¸Šè¿°å®‰è£…ä¼šå¾ˆæ…¢,å¯ä»¥ç›´æ¥ä»<a href="https://github.com/bazelbuild/bazel/releases" target="_blank" rel="noopener">https://github.com/bazelbuild/bazel/releases</a>ä¸€ä¸ªå®‰è£…è„šæœ¬.ç°åœ¨å¦‚æœä½¿ç”¨<code>apt-get install bazel</code>ä¼šå®‰è£…æœ€æ–°çš„<code>0.20.0</code>ç‰ˆæœ¬,ä½†æ˜¯ç°åœ¨çš„<code>TensorFlow 1.12.0</code>åªæ”¯æŒ<code>bazel 0.19.2</code>çš„ç‰ˆæœ¬ç¼–è¯‘.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ bazel version</span><br><span class="line">WARNING: --batch mode is deprecated. Please instead explicitly shut down your Bazel server using the <span class="built_in">command</span> <span class="string">"bazel shutdown"</span>.</span><br><span class="line">Build label: 0.19.2</span><br><span class="line">Build target: bazel-out/k8-opt/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar</span><br><span class="line">Build time: Mon Nov 19 16:25:09 2018 (1542644709)</span><br><span class="line">Build timestamp: 1542644709</span><br><span class="line">Build timestamp as int: 1542644709</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‹è½½TensorFlowæºç "><a href="#ä¸‹è½½TensorFlowæºç " class="headerlink" title="ä¸‹è½½TensorFlowæºç "></a>ä¸‹è½½<code>TensorFlow</code>æºç </h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/cuda/bin:<span class="variable">$PATH</span></span><br><span class="line">~$ <span class="built_in">export</span> LD_LIBRARY_PATH=/usr/<span class="built_in">local</span>/cuda-10.0/lib64:/usr/<span class="built_in">local</span>/cuda-10.0/extras/CUPTI/lib64:<span class="variable">$LD_LIBRARY_PATH</span></span><br><span class="line">~$ git <span class="built_in">clone</span> https://github.com/tensorflow/tensorflow.git</span><br><span class="line">~$ pyenv activate py3dev</span><br><span class="line">~$ pip install wheel</span><br><span class="line">~$ ./configure</span><br><span class="line">WARNING: --batch mode is deprecated. Please instead explicitly shut down your Bazel server using the <span class="built_in">command</span> <span class="string">"bazel shutdown"</span>.</span><br><span class="line">You have bazel 0.19.2 installed.</span><br><span class="line">Please specify the location of python. [Default is fullpath/.pyenv/versions/py3dev/bin/python]:</span><br><span class="line"></span><br><span class="line">Found possible Python library paths:</span><br><span class="line">  /fullpath/.pyenv/versions/py3dev/lib/python3.6/site-packages</span><br><span class="line">Please input the desired Python library path to use.  Default is [/fullpath/.pyenv/versions/py3dev/lib/python3.6/site-packages]</span><br><span class="line">Do you wish to build TensorFlow with XLA JIT support? [Y/n]: Y</span><br><span class="line">XLA JIT support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line">Do you wish to build TensorFlow with OpenCL SYCL support? [y/N]: N</span><br><span class="line">No OpenCL SYCL support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line">Do you wish to build TensorFlow with ROCm support? [y/N]: N</span><br><span class="line">No ROCm support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line">Do you wish to build TensorFlow with CUDA support? [y/N]: y</span><br><span class="line">CUDA support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line">Please specify the CUDA SDK version you want to use. [Leave empty to default to CUDA 9.0]: 10.0</span><br><span class="line">Please specify the location <span class="built_in">where</span> CUDA 10.0 toolkit is installed. Refer to README.md <span class="keyword">for</span> more details. [Default is /usr/<span class="built_in">local</span>/cuda]:</span><br><span class="line">Please specify the cuDNN version you want to use. [Leave empty to default to cuDNN 7]:</span><br><span class="line">Please specify the location <span class="built_in">where</span> cuDNN 7 library is installed. Refer to README.md <span class="keyword">for</span> more details. [Default is /usr/<span class="built_in">local</span>/cuda]:</span><br><span class="line"></span><br><span class="line">Do you wish to build TensorFlow with TensorRT support? [y/N]: N</span><br><span class="line">No TensorRT support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line"></span><br><span class="line">Please specify the locally installed NCCL version you want to use. [Default is to use https://github.com/nvidia/nccl]:</span><br><span class="line"></span><br><span class="line">Please specify a list of comma-separated Cuda compute capabilities you want to build with.</span><br><span class="line">You can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.</span><br><span class="line">Please note that each additional compute capability significantly increases your build time and binary size. [Default is: 3.5,7.0]:</span><br><span class="line"></span><br><span class="line">Do you want to use clang as CUDA compiler? [y/N]: N</span><br><span class="line">nvcc will be used as CUDA compiler.</span><br><span class="line">Please specify <span class="built_in">which</span> gcc should be used by nvcc as the host compiler. [Default is /usr/bin/gcc]:</span><br><span class="line">Do you wish to build TensorFlow with MPI support? [y/N]: N</span><br><span class="line">No MPI support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line"></span><br><span class="line">Please specify optimization flags to use during compilation when bazel option <span class="string">"--config=opt"</span> is specified [Default is -march=native -Wno-sign-compare]:</span><br><span class="line">Would you like to interactively configure ./WORKSPACE <span class="keyword">for</span> Android builds? [y/N]: y</span><br><span class="line">Please specify the home path of the Android NDK to use. [Default is /fullpath/Android/Sdk/ndk-bundle]:</span><br><span class="line">Please specify the home path of the Android SDK to use. [Default is /fullpath/Android/Sdk]:</span><br><span class="line">Please specify the Android SDK API level to use. [Available levels: [<span class="string">'13'</span>, <span class="string">'14'</span>, <span class="string">'15'</span>, <span class="string">'16'</span>, <span class="string">'17'</span>, <span class="string">'18'</span>, <span class="string">'19'</span>, <span class="string">'20'</span>, <span class="string">'21'</span>, <span class="string">'22'</span>, <span class="string">'23'</span>, <span class="string">'24'</span>, <span class="string">'25'</span>, <span class="string">'26'</span>, <span class="string">'27'</span>, <span class="string">'28'</span>]] [Default is 28]:</span><br><span class="line"></span><br><span class="line">Please specify an Android build tools version to use. [Available versions: [<span class="string">'21.1.2'</span>, <span class="string">'23.0.3'</span>, <span class="string">'24.0.3'</span>, <span class="string">'25.0.0'</span>, <span class="string">'25.0.2'</span>, <span class="string">'25.0.3'</span>, <span class="string">'26.0.2'</span>, <span class="string">'27.0.0'</span>, <span class="string">'27.0.3'</span>, <span class="string">'28.0.0-rc2'</span>, <span class="string">'28.0.2'</span>, <span class="string">'28.0.3'</span>]] [Default is 28.0.3]:</span><br><span class="line"></span><br><span class="line">Preconfigured Bazel build configs. You can use any of the below by adding <span class="string">"--config=&lt;&gt;"</span> to your build <span class="built_in">command</span>. See .bazelrc <span class="keyword">for</span> more details.</span><br><span class="line">        --config=mkl            <span class="comment"># Build with MKL support.</span></span><br><span class="line">        --config=monolithic     <span class="comment"># Config for mostly static monolithic build.</span></span><br><span class="line">        --config=gdr            <span class="comment"># Build with GDR support.</span></span><br><span class="line">        --config=verbs          <span class="comment"># Build with libverbs support.</span></span><br><span class="line">        --config=ngraph         <span class="comment"># Build with Intel nGraph support.</span></span><br><span class="line">        --config=dynamic_kernels        <span class="comment"># (Experimental) Build kernels into separate shared objects.</span></span><br><span class="line">Preconfigured Bazel build configs to DISABLE default on features:</span><br><span class="line">        --config=noaws          <span class="comment"># Disable AWS S3 filesystem support.</span></span><br><span class="line">        --config=nogcp          <span class="comment"># Disable GCP support.</span></span><br><span class="line">        --config=nohdfs         <span class="comment"># Disable HDFS support.</span></span><br><span class="line">        --config=noignite       <span class="comment"># Disable Apacha Ignite support.</span></span><br><span class="line">        --config=nokafka        <span class="comment"># Disable Apache Kafka support.</span></span><br><span class="line">        --config=nonccl         <span class="comment"># Disable NVIDIA NCCL support.</span></span><br><span class="line">Configuration finished</span><br><span class="line"></span><br><span class="line">~$ bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package</span><br><span class="line"></span><br><span class="line">~$ ./bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg <span class="comment"># ç¼–è¯‘Pythonå®‰è£…åŒ….</span></span><br><span class="line">Wed Dec 5 10:54:27 CST 2018 : === Preparing sources <span class="keyword">in</span> dir: /tmp/tmp.OZdwkuc2YO</span><br><span class="line">~/github/tensorflow ~/github/tensorflow</span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line">~$ pip install /tmp/tensorflow_pkg/tensorflow-1.12.0rc0-cp36-cp36m-linux_x86_64.whl <span class="comment"># å®‰è£…Python</span></span><br><span class="line">~$ LD_LIBRARY_PATH=/usr/<span class="built_in">local</span>/cuda/lib64:/usr/<span class="built_in">local</span>/cuda-10.0/extras/CUPTI/lib64:<span class="variable">$LD_LIBRARY_PATH</span> jupyter notebook <span class="comment"># åœ¨notebooké‡Œæµ‹è¯•è¿è¡Œtensorflow</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœå‡ºç°ä¸‹é¢<strong>failed call to cuInit: CUDA_ERROR_UNKNOWN: unknown error</strong>è¿™ä¸ªé”™è¯¯,è¦åœ¨ç»ˆç«¯é‡Œå…ˆè¿è¡Œ<code>apt-get install nvidia-modprobe</code>è¿™ä¸ªå‘½ä»¤,å¹¶ä¸”é‡å¯ç³»ç»Ÿ.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">In [<span class="number">2</span>]: tf.test.is_built_with_cuda()</span><br><span class="line">Out[<span class="number">2</span>]: <span class="literal">True</span></span><br><span class="line">In [<span class="number">3</span>]: tf.test.is_gpu_available(cuda_only=<span class="literal">False</span>,min_cuda_compute_capability=<span class="literal">None</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">12</span>:<span class="number">03</span>:<span class="number">06.128401</span>: E tensorflow/stream_executor/cuda/cuda_driver.cc:<span class="number">300</span>] failed call to cuInit: CUDA_ERROR_UNKNOWN: unknown error</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">12</span>:<span class="number">03</span>:<span class="number">06.128442</span>: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:<span class="number">161</span>] retrieving CUDA diagnostic information <span class="keyword">for</span> host: debian</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">12</span>:<span class="number">03</span>:<span class="number">06.128448</span>: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:<span class="number">168</span>] hostname: debian</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">12</span>:<span class="number">03</span>:<span class="number">06.128470</span>: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:<span class="number">192</span>] libcuda reported version <span class="keyword">is</span>: <span class="number">410.48</span><span class="number">.0</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">12</span>:<span class="number">03</span>:<span class="number">06.128488</span>: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:<span class="number">196</span>] kernel reported version <span class="keyword">is</span>: <span class="number">410.48</span><span class="number">.0</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">12</span>:<span class="number">03</span>:<span class="number">06.128493</span>: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:<span class="number">303</span>] kernel version seems to match DSO: <span class="number">410.48</span><span class="number">.0</span></span><br><span class="line">Out[<span class="number">3</span>]: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]:  tf.test.is_gpu_available(cuda_only=<span class="literal">False</span>,min_cuda_compute_capability=<span class="literal">None</span>)</span><br><span class="line">Out[<span class="number">4</span>]: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ã€€é‡å¯ç³»ç»Ÿä¹‹å,å¯ä»¥æ­£å¸¸ä½¿ç”¨GPUäº†.</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: tf.Session().list_devices()</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.981018</span>: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:<span class="number">998</span>] successful NUMA node read <span class="keyword">from</span> SysFS had negative value (<span class="number">-1</span>), but there must be at least one NUMA node, so returning NUMA node zero</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.982813</span>: I tensorflow/compiler/xla/service/service.cc:<span class="number">150</span>] XLA service <span class="number">0x55d255632230</span> executing computations on platform CUDA. Devices:</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.982835</span>: I tensorflow/compiler/xla/service/service.cc:<span class="number">158</span>]   StreamExecutor device (<span class="number">0</span>): Quadro P600, Compute Capability <span class="number">6.1</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.983889</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">1431</span>] Found device <span class="number">0</span> <span class="keyword">with</span> properties:</span><br><span class="line">name: Quadro P600 major: <span class="number">6</span> minor: <span class="number">1</span> memoryClockRate(GHz): <span class="number">1.5565</span></span><br><span class="line">pciBusID: <span class="number">0000</span>:<span class="number">01</span>:<span class="number">00.0</span></span><br><span class="line">totalMemory: <span class="number">1.95</span>GiB freeMemory: <span class="number">1.74</span>GiB</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.983931</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">1510</span>] Adding visible gpu devices: <span class="number">0</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.986678</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">982</span>] Device interconnect StreamExecutor <span class="keyword">with</span> strength <span class="number">1</span> edge matrix:</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.986711</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">988</span>]      <span class="number">0</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.986726</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">1001</span>] <span class="number">0</span>:   N</span><br><span class="line">2018-12-05 15:02:22.986953: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1113] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 1560 MB memory) -&gt; physical GPU (device: 0, name: Quadro P600, pci bus id: 0000:01:00.0, compute capability: 6.1)</span><br><span class="line">Out[<span class="number">2</span>]:</span><br><span class="line">[_DeviceAttributes(/job:localhost/replica:<span class="number">0</span>/task:<span class="number">0</span>/device:CPU:<span class="number">0</span>, CPU, <span class="number">268435456</span>, <span class="number">4411150611837152607</span>),</span><br><span class="line"> _DeviceAttributes(/job:localhost/replica:<span class="number">0</span>/task:<span class="number">0</span>/device:XLA_CPU:<span class="number">0</span>, XLA_CPU, <span class="number">17179869184</span>, <span class="number">8331037032149977949</span>),</span><br><span class="line"> _DeviceAttributes(/job:localhost/replica:<span class="number">0</span>/task:<span class="number">0</span>/device:XLA_GPU:<span class="number">0</span>, XLA_GPU, <span class="number">17179869184</span>, <span class="number">1279689307458374322</span>),</span><br><span class="line"> _DeviceAttributes(/job:localhost/replica:<span class="number">0</span>/task:<span class="number">0</span>/device:GPU:<span class="number">0</span>, GPU, <span class="number">1636106240</span>, <span class="number">7170667474598106347</span>)]</span><br><span class="line"></span><br><span class="line">Out[<span class="number">3</span>]: tf.test.is_gpu_available(cuda_only=<span class="literal">False</span>,min_cuda_compute_capability=<span class="literal">None</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">52.037618</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">1510</span>] Adding visible gpu devices: <span class="number">0</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">52.037647</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">982</span>] Device interconnect StreamExecutor <span class="keyword">with</span> strength <span class="number">1</span> edge matrix:</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">52.037652</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">988</span>]      <span class="number">0</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">52.037656</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">1001</span>] <span class="number">0</span>:   N</span><br><span class="line">2018-12-05 15:05:52.037737: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1113] Created TensorFlow device (/device:GPU:0 with 1560 MB memory) -&gt; physical GPU (device: 0, name: Quadro P600, pci bus id: 0000:01:00.0, compute capability: 6.1)</span><br><span class="line">Out[<span class="number">4</span>]: <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h2 id="è¿è¡ŒTensorBoardå¯è§†åŒ–å‰ç«¯"><a href="#è¿è¡ŒTensorBoardå¯è§†åŒ–å‰ç«¯" class="headerlink" title="è¿è¡ŒTensorBoardå¯è§†åŒ–å‰ç«¯"></a>è¿è¡Œ<code>TensorBoard</code>å¯è§†åŒ–å‰ç«¯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">input1 = tf.constant([<span class="number">1.0</span>,<span class="number">2.0</span>,<span class="number">3.0</span>],name=<span class="string">'input1'</span>)</span><br><span class="line">input2 = tf.constant([<span class="number">2.0</span>,<span class="number">3.0</span>,<span class="number">4.0</span>],name=<span class="string">'input2'</span>)</span><br><span class="line">output = tf.add_n([input1,input2],name=<span class="string">'add'</span>)</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    writer = tf.summary.FileWriter(graph=sess.graph,logdir=<span class="string">'./graph'</span>)</span><br><span class="line">    sess.run(output)</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿è¡Œä¸Šé¢ç¤ºä¾‹ä»£ç ç‰‡æ–­,æ‰“å¼€ç»ˆç«¯è¿è¡Œ<code>tensorboard --logdir=&#39;./graph&#39; --port=6006</code>,å®ƒçš„ WEB æœåŠ¡å™¨è¿è¡Œä¹‹å,å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®å¯è§†ç«¯äº†.</li>
</ul>
<h2 id="Tensorflowä½¿ç”¨ç¬”è®°"><a href="#Tensorflowä½¿ç”¨ç¬”è®°" class="headerlink" title="Tensorflowä½¿ç”¨ç¬”è®°"></a><code>Tensorflow</code>ä½¿ç”¨ç¬”è®°</h2><h3 id="TFRecordè¯»å†™"><a href="#TFRecordè¯»å†™" class="headerlink" title="TFRecordè¯»å†™"></a><code>TFRecord</code>è¯»å†™</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.examples.tutorials.mnist <span class="keyword">import</span> input_data</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰å‡½æ•°è½¬åŒ–å˜é‡ç±»å‹.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_int64_feature</span><span class="params">(value)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> tf.train.Feature(int64_list=tf.train.Int64List(value=[value]))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_bytes_feature</span><span class="params">(value)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> tf.train.Feature(bytes_list=tf.train.BytesList(value=[value]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># mnist/data æ˜¯å­˜æ”¾ä»ç½‘ä¸Šä¸‹è½½çš„mnistæ•°æ®ä½ç½®</span></span><br><span class="line">mnist = input_data.read_data_sets(<span class="string">'./mnist/data'</span>,dtype=tf.uint8,one_hot=<span class="literal">True</span>)</span><br><span class="line">images = mnist.train.images</span><br><span class="line">labels = mnist.train.labels</span><br><span class="line"></span><br><span class="line">pixels = images.shape[<span class="number">1</span>]</span><br><span class="line">num_examples = mnist.train.num_examples</span><br><span class="line"></span><br><span class="line">filename = <span class="string">'./mnist/output.tfrecords'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®è½¬åŒ–ä¸ºtf.train.Exampleæ ¼å¼.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_make_example</span><span class="params">(pixels, label, image)</span>:</span></span><br><span class="line">    image_raw = image.tostring()</span><br><span class="line">    example = tf.train.Example(features=tf.train.Features(feature=&#123;</span><br><span class="line">        <span class="string">'pixels'</span>: _int64_feature(pixels),</span><br><span class="line">        <span class="string">'label'</span>: _int64_feature(np.argmax(label)),</span><br><span class="line">        <span class="string">'image_raw'</span>: _bytes_feature(image_raw)</span><br><span class="line">    &#125;))</span><br><span class="line">    <span class="keyword">return</span> example</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.python_io.TFRecordWriter(filename) <span class="keyword">as</span> writer:</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> range(num_examples):</span><br><span class="line">        example = _make_example(pixels,labels[index],images[index])</span><br><span class="line">        writer.write(example.SerializeToString())</span><br><span class="line">print(<span class="string">'å†™å…¥TFRecordæµ‹è¯•æ–‡ä»¶'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>ç”¨åŒæ ·çš„æ ¼å¼è¯»å–<code>TFRecord</code>æ–‡ä»¶è®°å½•.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">reader = tf.TFRecordReader()</span><br><span class="line">filename_queue = tf.train.string_input_producer([<span class="string">'./mnist/output.tfrecords'</span>])</span><br><span class="line">_,serialized_example = reader.read(filename_queue)</span><br><span class="line">features = tf.parse_single_example(</span><br><span class="line">    serialized_example,</span><br><span class="line">    features=&#123;</span><br><span class="line">        <span class="string">'pixels'</span>: tf.FixedLenFeature([],tf.int64),</span><br><span class="line">        <span class="string">'label'</span>:tf.FixedLenFeature([],tf.int64),</span><br><span class="line">        <span class="string">'image_raw'</span>: tf.FixedLenFeature([],tf.string),</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">images = tf.decode_raw(features[<span class="string">'image_raw'</span>],tf.uint8)</span><br><span class="line">labels = tf.cast(features[<span class="string">'label'</span>],tf.int32)</span><br><span class="line">pixels = tf.cast(features[<span class="string">'pixels'</span>],tf.int32)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    coord = tf.train.Coordinator()</span><br><span class="line">    threads = tf.train.start_queue_runners(coord=coord)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        image,label,pixel = sess.run([images,labels,pixels])</span><br><span class="line">    coord.request_stop()</span><br><span class="line">    coord.join(threads)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="è¯»å–åŸå§‹å›¾ç‰‡"><a href="#è¯»å–åŸå§‹å›¾ç‰‡" class="headerlink" title="è¯»å–åŸå§‹å›¾ç‰‡"></a>è¯»å–åŸå§‹å›¾ç‰‡</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">image_raw_data = tf.gfile.FastGFile(<span class="string">'../img3.png'</span>,<span class="string">'rb'</span>).read()</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    img_data = tf.image.decode_png(image_raw_data)</span><br><span class="line">    <span class="comment"># è¾“å‡ºè§£ç ä¹‹åçš„ä¸‰ç»´çŸ©é˜µ.</span></span><br><span class="line">    print(img_data.eval())</span><br><span class="line">    plt.imshow(img_data.eval())</span><br><span class="line">    plt.show()</span><br><span class="line">    img_data.set_shape([<span class="number">420</span>,<span class="number">420</span>,<span class="number">3</span>])</span><br><span class="line">    print(img_data.get_shape())</span><br></pre></td></tr></table></figure>
<ul>
<li>è°ƒæ•´å›¾ç‰‡çš„å°ºå¯¸<br>| Method å–å€¼ | è°ƒæ•´ç®—æ³•                                   |<br>| :â€”â€”â€”: | :â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ |<br>|      0      | åŒçº¿æ€§æ’å€¼æ³•(Bilinear interploation)       |<br>|      1      | æœ€è¿‘é‚»å±…æ³•(Nearest neighbor interpolation) |<br>|      2      | åŒä¸‰æ¬¡æ’å€¼æ³•(Bicubic interpolation)        |<br>|      3      | é¢ç§¯æ’å€¼æ³•(Area interpolation)             |</li>
</ul>
<figure class="highlight ipython"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    <span class="comment"># å¦‚æœç›´æ¥ä»¥0-255èŒƒå›´çš„æ•´æ•°æ•°æ®è¾“å…¥resize_imagesï¼Œé‚£ä¹ˆè¾“å‡ºå°†æ˜¯0-255ä¹‹é—´çš„å®æ•°ï¼Œ</span></span><br><span class="line">    <span class="comment"># ä¸åˆ©äºåç»­å¤„ç†.æœ¬ä¹¦å»ºè®®åœ¨è°ƒæ•´å›¾ç‰‡å¤§å°å‰ï¼Œå…ˆå°†å›¾ç‰‡è½¬ä¸º0-1èŒƒå›´çš„å®æ•°.</span></span><br><span class="line">    image_float = tf.image.convert_image_dtype(img_data,tf.float32)</span><br><span class="line">    resized = tf.image.resize_images(image_float,[<span class="number">400</span>,<span class="number">400</span>],method=<span class="number">0</span>)</span><br><span class="line">    plt.imshow(resized.eval())</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
<ul>
<li><p>è£å‰ªä¸å¡«å……å›¾ç‰‡</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    croped = tf.image.resize_image_with_crop_or_pad(img_data,<span class="number">300</span>,<span class="number">300</span>)</span><br><span class="line">    padded = tf.image.resize_image_with_crop_or_pad(img_data,<span class="number">520</span>,<span class="number">520</span>)</span><br><span class="line">    plt.imshow(croped.eval())</span><br><span class="line">    plt.show()</span><br><span class="line">    plt.imshow(padded.eval())</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
</li>
<li><p>æˆªå–ä¸­å¿ƒ<code>%50</code>åŒºåŸŸ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">  central_cropped = tf.image.central_crop(img_data, <span class="number">0.5</span>)</span><br><span class="line">  plt.imshow(central_cropped.eval())</span><br><span class="line">  plt.show()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="å®‰è£…ä½¿ç”¨Keras"><a href="#å®‰è£…ä½¿ç”¨Keras" class="headerlink" title="å®‰è£…ä½¿ç”¨Keras"></a>å®‰è£…ä½¿ç”¨<code>Keras</code></h1><ul>
<li>é“¾æ¥ï¼š<ul>
<li><a href="https://blog.keras.io/building-autoencoders-in-keras.html" target="_blank" rel="noopener">Building Autoencoders in Keras</a></li>
<li><a href="https://gitbook.cn/books/5994670facae7150950eb8b0/index.html" target="_blank" rel="noopener">å¦‚ä½•é›¶åŸºç¡€ç”¨ Keras å¿«é€Ÿæ­å»ºå®ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹</a></li>
<li><a href="https://towardsdatascience.com/image-classification-in-10-minutes-with-mnist-dataset-54c35b77a38d" target="_blank" rel="noopener">Image Classification in 10 Minutes with MNIST Dataset</a></li>
<li><a href="https://towardsdatascience.com/basics-of-image-classification-with-keras-43779a299c8b" target="_blank" rel="noopener">Basics of image classification with Keras</a></li>
<li><a href="https://blog.keras.io/building-a-simple-keras-deep-learning-rest-api.html" target="_blank" rel="noopener">Building a simple Keras + deep learning REST API</a></li>
<li><a href="https://nextjournal.com/gkoehler/digit-recognition-with-keras" target="_blank" rel="noopener">MNIST Handwritten Digit Recognition in Keras</a></li>
</ul>
</li>
</ul>
<ul>
<li><code>Keras</code>æ˜¯æä¾›ä¸€äº›é«˜å¯ç”¨çš„<code>Python API</code>,èƒ½å¸®åŠ©ä½ å¿«é€Ÿçš„æ„å»ºå’Œè®­ç»ƒè‡ªå·±çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå®ƒçš„åç«¯æ˜¯<code>TensorFlow</code>æˆ–è€…<code>Theano</code>.å®ƒå¾ˆç®€çº¦, æ¨¡å—åŒ–çš„æ–¹æ³•ä½¿å»ºç«‹å¹¶è¿è¡Œç¥ç»ç½‘ç»œå˜å¾—è½»å·§.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [1]: import keras</span><br><span class="line">Using TensorFlow backend.</span><br><span class="line"></span><br><span class="line">In [2]: keras.__version__</span><br><span class="line">Out[2]: <span class="string">'2.2.4'</span></span><br><span class="line"></span><br><span class="line">In [3]: !cat /home/lcy/.keras/keras.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"floatx"</span>: <span class="string">"float32"</span>,</span><br><span class="line">    <span class="string">"epsilon"</span>: 1e-07,</span><br><span class="line">    <span class="string">"backend"</span>: <span class="string">"tensorflow"</span>,</span><br><span class="line">    <span class="string">"image_data_format"</span>: <span class="string">"channels_last"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Keras-MNISTæ‰‹å†™æ•°æ®æµ‹è¯•"><a href="#Keras-MNISTæ‰‹å†™æ•°æ®æµ‹è¯•" class="headerlink" title="Keras MNISTæ‰‹å†™æ•°æ®æµ‹è¯•"></a><code>Keras MNIST</code>æ‰‹å†™æ•°æ®æµ‹è¯•</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Sequential,load_model</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense,Dropout,Conv2D,Flatten,MaxPooling2D,Activation</span><br><span class="line"><span class="keyword">from</span> keras.datasets.mnist <span class="keyword">import</span> load_data</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># æ¸…é™¤GPUçš„ä¼šè¯æ•°æ®</span></span><br><span class="line">keras.backend.clear_session()</span><br><span class="line">(X_train,Y_train),(x_test,y_test) = load_data()</span><br><span class="line">X_train = X_train.reshape(X_train.shape[<span class="number">0</span>],<span class="number">28</span>,<span class="number">28</span>,<span class="number">1</span>)</span><br><span class="line">x_test = x_test.reshape(x_test.shape[<span class="number">0</span>],<span class="number">28</span>,<span class="number">28</span>,<span class="number">1</span>)</span><br><span class="line">input_shape=(<span class="number">28</span>,<span class="number">28</span>,<span class="number">1</span>)</span><br><span class="line">X_train = X_train.astype(<span class="string">'float32'</span>)</span><br><span class="line">x_test = x_test.astype(<span class="string">'float32'</span>)</span><br><span class="line">X_train /= <span class="number">255</span></span><br><span class="line">x_test /= <span class="number">255</span></span><br><span class="line">print(<span class="string">'x_train shape:'</span>,X_train.shape)</span><br><span class="line">print(<span class="string">'Number of images in x_train'</span>,X_train.shape[<span class="number">0</span>])</span><br><span class="line">print(<span class="string">'Number of images in x_test'</span>,x_test.shape[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># å·ç§¯ç½‘ç»œ</span></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Conv2D(<span class="number">28</span>,kernel_size=(<span class="number">3</span>,<span class="number">3</span>),input_shape=input_shape))</span><br><span class="line">model.add(MaxPooling2D(pool_size=(<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line">model.add(Flatten())</span><br><span class="line">model.add(Dense(<span class="number">128</span>))</span><br><span class="line">model.add(Activation(<span class="string">'relu'</span>))</span><br><span class="line">model.add(Dropout(<span class="number">0.02</span>))</span><br><span class="line">model.add(Dense(<span class="number">10</span>))</span><br><span class="line">model.add(Activation(<span class="string">'softmax'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#ã€€ç¼–è¯‘å¤šåˆ†ç±»å‡½æ•°åˆ†ç±»å™¨</span></span><br><span class="line">model.compile(optimizer=<span class="string">'adam'</span>,loss=<span class="string">'sparse_categorical_crossentropy'</span>,metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">model.fit(x=X_train,y=Y_train,epochs=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ã€€ä¿å­˜è®­ç»ƒæ¨¡å‹åˆ°HDF5æ–‡ä»¶é‡Œ</span></span><br><span class="line">history = model.fit(X_train,Y_train,batch_size=<span class="number">128</span>,epochs=<span class="number">20</span>,verbose=<span class="number">2</span>,validation_data=(x_test,y_test))</span><br><span class="line">save_dir = <span class="string">'./results/'</span></span><br><span class="line">mode_name=<span class="string">'keras_mnist.h5'</span></span><br><span class="line">mode_path = os.path.join(save_dir,mode_name)</span><br><span class="line">model.save(mode_path)</span><br><span class="line">print(<span class="string">'Saved trained model at %s'</span> % mode_path)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ã€€æ‰“å°å®ƒçš„è®­ç»ƒå›¾å½¢</span></span><br><span class="line">fig = plt.figure()</span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">plt.plot(history.history[<span class="string">'acc'</span>])</span><br><span class="line">plt.plot(history.history[<span class="string">'val_acc'</span>])</span><br><span class="line">plt.title(<span class="string">'model accuracy'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'accuracy'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'epoch'</span>)</span><br><span class="line">plt.legend([<span class="string">'train'</span>, <span class="string">'test'</span>], loc=<span class="string">'lower right'</span>)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">plt.plot(history.history[<span class="string">'loss'</span>])</span><br><span class="line">plt.plot(history.history[<span class="string">'val_loss'</span>])</span><br><span class="line">plt.title(<span class="string">'model loss'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'loss'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'epoch'</span>)</span><br><span class="line">plt.legend([<span class="string">'train'</span>, <span class="string">'test'</span>], loc=<span class="string">'upper right'</span>)</span><br><span class="line"></span><br><span class="line">plt.tight_layout()</span><br><span class="line">fig</span><br><span class="line"></span><br><span class="line"><span class="comment">#ã€€ä½¿ç”¨ä¸€éƒ¨åˆ†æµ‹è¯•å›¾ç‰‡éªŒè¯æ¨¡å‹</span></span><br><span class="line">mnist_model = load_model(<span class="string">'./results/keras_mnist.h5'</span>)</span><br><span class="line">loss_and_metrics = mnist_model.evaluate(x_test,y_test,verbose=<span class="number">2</span>)</span><br><span class="line">print(<span class="string">'Test Loss'</span>,loss_and_metrics[<span class="number">0</span>])</span><br><span class="line">print(<span class="string">'Test Accuracy'</span>,loss_and_metrics[<span class="number">1</span>])</span><br><span class="line">predicted_classes =mnist_model.predict_classes(x_test)</span><br><span class="line">corrent_indices = np.nonzero(predicted_classes == y_test)[<span class="number">0</span>]</span><br><span class="line">incorrent_indices = np.nonzero(predicted_classes != y_test)[<span class="number">0</span>]</span><br><span class="line">print()</span><br><span class="line">print(len(corrent_indices),<span class="string">' classifed correctly'</span>)</span><br><span class="line">print(len(incorrent_indices),<span class="string">' classified incorrectly'</span>)</span><br><span class="line"></span><br><span class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">7</span>,<span class="number">14</span>)</span><br><span class="line">figure_evaluation = plt.figure()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°ï¼™ä¸ªæ­£ç¡®é¢„æµ‹çš„å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">for</span> i ,correct <span class="keyword">in</span> enumerate(corrent_indices[:<span class="number">9</span>]):</span><br><span class="line">    plt.subplot(<span class="number">6</span>,<span class="number">3</span>,i+<span class="number">1</span>)</span><br><span class="line">    plt.imshow(x_test[correct].reshape(<span class="number">28</span>,<span class="number">28</span>),cmap=<span class="string">'gray'</span>,interpolation=<span class="string">'none'</span>)</span><br><span class="line">    plt.title(<span class="string">'Predicted: &#123;&#125;,Trutch: &#123;&#125;'</span>.format(predicted_classes[correct],y_test[correct]))</span><br><span class="line">    plt.xticks([])</span><br><span class="line">    plt.yticks([])</span><br><span class="line"><span class="comment"># æ‰“å°ï¼™ä¸ªé”™è¯¯é¢„æµ‹çš„å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">for</span> i ,correct <span class="keyword">in</span> enumerate(incorrent_indices[:<span class="number">9</span>]):</span><br><span class="line">    plt.subplot(<span class="number">6</span>,<span class="number">3</span>,i+<span class="number">1</span>)</span><br><span class="line">    plt.imshow(x_test[correct].reshape(<span class="number">28</span>,<span class="number">28</span>),cmap=<span class="string">'gray'</span>,interpolation=<span class="string">'none'</span>)</span><br><span class="line">    plt.title(<span class="string">'Predicted: &#123;&#125;,Truth: &#123;&#125;'</span>.format(predicted_classes[correct],y_test[correct]))</span><br><span class="line">    plt.xticks([])</span><br><span class="line">    plt.yticks([])</span><br><span class="line">figure_evaluation</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ã€€è¯»å…¥è‡ªå·±çš„æ‰‹åŠ¨ç”Ÿæˆçš„å›¾ç‰‡åšæµ‹è¯•</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> keras_preprocessing.image <span class="keyword">import</span> img_to_array</span><br><span class="line"><span class="keyword">from</span> keras_applications <span class="keyword">import</span> imagenet_utils</span><br><span class="line">data_dir = <span class="string">'/data/AI-DIR/TensorFlow/mnist/test-data/'</span></span><br><span class="line">list_dir = os.listdir(data_dir)</span><br><span class="line">print(len(list_dir))</span><br><span class="line">image_height = <span class="number">28</span></span><br><span class="line">image_width = <span class="number">28</span></span><br><span class="line">channels = <span class="number">1</span></span><br><span class="line">img_data = np.ndarray(shape=(len(list_dir),image_height,image_width,channels))</span><br><span class="line">label_data = np.zeros(len(list_dir),dtype=<span class="string">'uint8'</span>)</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> list_dir:</span><br><span class="line">    <span class="comment">#ã€€è¯»å–ç›®å½•ä¸‹çš„å›¾ç‰‡,å¹¶æŠŠå®ƒè½¬æ¢æˆç°åº¦å›¾ç‰‡.</span></span><br><span class="line">    png = Image.open(os.path.join(data_dir,file),<span class="string">'r'</span>).convert(<span class="string">'L'</span>)</span><br><span class="line">    gray = png.point(<span class="keyword">lambda</span> x: <span class="number">0</span> <span class="keyword">if</span> x == <span class="number">255</span> <span class="keyword">else</span> <span class="number">255</span>)</span><br><span class="line">    image = img_to_array(gray)</span><br><span class="line">    img_data[i] = image</span><br><span class="line">    label_data[i] = int(file[<span class="number">4</span>])</span><br><span class="line"><span class="comment">#     print('png file: ',file)</span></span><br><span class="line">    i+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'test_data len'</span>,len(img_data))</span><br><span class="line">print(<span class="string">'test_data shape'</span>,img_data.shape)</span><br><span class="line">print(<span class="string">'test label '</span>,label_data)</span><br><span class="line"></span><br><span class="line">loss_and_metrics = mnist_model.evaluate(img_data,label_data,verbose=<span class="number">2</span>)</span><br><span class="line">print(<span class="string">'Test Loss'</span>,loss_and_metrics[<span class="number">0</span>])</span><br><span class="line">print(<span class="string">'Test Accuracy'</span>,loss_and_metrics[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">predicted_classes =mnist_model.predict_classes(img_data)</span><br><span class="line">corrent_indices = np.nonzero(predicted_classes == label_data)[<span class="number">0</span>]</span><br><span class="line">incorrent_indices = np.nonzero(predicted_classes != label_data)[<span class="number">0</span>]</span><br><span class="line">print()</span><br><span class="line">print(len(corrent_indices),<span class="string">' classifed correctly'</span>)</span><br><span class="line">print(len(incorrent_indices),<span class="string">' classified incorrectly'</span>)</span><br><span class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">7</span>,<span class="number">14</span>)</span><br><span class="line">figure_evaluation = plt.figure()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°ï¼™ä¸ªé”™è¯¯é¢„æµ‹çš„å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">for</span> i ,correct <span class="keyword">in</span> enumerate(incorrent_indices[:<span class="number">9</span>]):</span><br><span class="line">    plt.subplot(<span class="number">6</span>,<span class="number">3</span>,i+<span class="number">1</span>)</span><br><span class="line">    plt.imshow(img_data[correct].reshape(<span class="number">28</span>,<span class="number">28</span>),cmap=<span class="string">'gray'</span>,interpolation=<span class="string">'none'</span>)</span><br><span class="line">    plt.title(<span class="string">'Predicted: &#123;&#125;,Truth: &#123;&#125;'</span>.format(predicted_classes[correct],label_data[correct]))</span><br><span class="line">    plt.xticks([])</span><br><span class="line">    plt.yticks([])</span><br><span class="line"></span><br><span class="line">figure_evaluation</span><br></pre></td></tr></table></figure>
<h2 id="é”™è¯¯"><a href="#é”™è¯¯" class="headerlink" title="é”™è¯¯"></a>é”™è¯¯</h2><h3 id="å¯¼å…¥tkinteræ¨¡å—"><a href="#å¯¼å…¥tkinteræ¨¡å—" class="headerlink" title="å¯¼å…¥tkinteræ¨¡å—"></a>å¯¼å…¥<code>tkinter</code>æ¨¡å—</h3><ul>
<li><p>æç¤ºæ— æ³•å¯¼å…¥<code>tkinter</code>æ¨¡å—,è¿™é‡Œå®‰è£…å¯èƒ½å°±æ¯”è¾ƒéº»çƒ¦.é”™è¯¯å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">In [4]: import matplotlib.pyplot as plt</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">ModuleNotFoundError                       Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-4-a0d2faabd9e9&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 import matplotlib.pyplot as plt</span><br><span class="line">[...]</span><br><span class="line">ModuleNotFoundError: No module named <span class="string">'_tkinter'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è§£å—æ–¹æ³•å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ apt-get install tk-dev</span><br><span class="line">~$ pyenv uninstall 3.6.6</span><br><span class="line">~$ pyenv install 3.6.6</span><br><span class="line">~$ pyenv virtualenv py3dev</span><br><span class="line">~$ pyenv activate py3dev</span><br><span class="line">~$ python -m tkinter  <span class="comment"># æµ‹è¯•æ¨¡å—.</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å¯¼å…¥ggplotæ¨¡å—"><a href="#å¯¼å…¥ggplotæ¨¡å—" class="headerlink" title="å¯¼å…¥ggplotæ¨¡å—"></a>å¯¼å…¥<code>ggplot</code>æ¨¡å—</h3><ul>
<li><code>from ggplot import *</code>è¯­å¥å¯¼å…¥ ggplot åŒ…æ—¶æŠ¥é”™å¦‚ä¸‹:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~/.pyenv/versions/3.6.6/envs/py3dev/lib/python3.6/site-packages/ggplot/stats/smoothers.py <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">      2                         unicode_literals)</span><br><span class="line">      3 import numpy as np</span><br><span class="line">----&gt; 4 from pandas.lib import Timestamp</span><br><span class="line">      5 import pandas as pd</span><br><span class="line">      6 import statsmodels.api as sm</span><br><span class="line"></span><br><span class="line">ImportError: cannot import name <span class="string">'Timestamp'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>è§£å†³æ–¹æ³•:ç¼–è¾‘æ–‡ä»¶<code>.../site-packages/ggplot/stats/smoothers.py</code>.æŠŠåŸæ¥çš„<code>from pandas.lib import Timestamp</code>æ”¹æˆ<code>from pandas import Timestamp</code>,ä¿å­˜ OK.</li>
</ul>
<h1 id="å®‰è£…Kaggle-API"><a href="#å®‰è£…Kaggle-API" class="headerlink" title="å®‰è£…Kaggle API"></a>å®‰è£…<code>Kaggle API</code></h1><ul>
<li><a href="https://github.com/Kaggle/kaggle-api" target="_blank" rel="noopener">Kaggle API</a></li>
<li>åœ¨<code>www.kaggle.com</code>ä¸Šé¢æ³¨å†Œä¸€ä¸ªå¸å·,è¿›å…¥åˆ°å¸å·ç®¡ç†é¡µé¢,åœ¨<code>API</code>ä¸€æ ä¼šæœ‰ä¸¤ä¸ªæŒ‰é’®<code>Create New API Token</code>,<code>Expire API Token</code>,ç‚¹å‡»<code>Create New API Token</code>æµè§ˆå™¨å°±ä¼šè‡ªåŠ¨ä¸‹è½½ä¸€ä¸ªåä¸º<code>kaggle.json</code>çš„æ–‡ä»¶,å¹¶ä¸”ä¼šæœ‰ Toast æç¤º<code>Ensure kaggle.json is in the location ~/.kaggle/kaggle.json to use the API.</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ pip install kaggle</span><br><span class="line">~$ mkdir ~/.kaggle</span><br><span class="line">~$ mv ~/Download/kaggle.json ~/.kaggle/</span><br><span class="line">~$ chmod <span class="number">600</span> ~/.kaggle/kaggle.json</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‹è½½æ•°æ®"><a href="#ä¸‹è½½æ•°æ®" class="headerlink" title="ä¸‹è½½æ•°æ®"></a>ä¸‹è½½æ•°æ®</h2><ul>
<li>è¿›å…¥åˆ°<code>https://www.kaggle.com/competitions</code>é¡µé¢,é€‰æ‹©ä¸€è¡Œå…·ä½“çš„é¡¹ç›®è¿›å»,åœ¨é¡µé¢åº•éƒ¨æœ‰ä¸€ä¸ªå¿…é¡»<strong>æ¥å—</strong>çš„å¯¹è¯æ¡†,<code>I Understand and Accept</code>,å¦åˆ™ä¸èƒ½ä¸‹è½½è¯¥é¡¹ç›®çš„æ•°æ®.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ã€€ä¸‹è½½æ•°æ®åˆ°æŒ‡å®šç›®å½•.</span></span><br><span class="line">~$ kaggle competitions download -c traveling-santa-2018-prime-paths  -p /fullpath/Traveling-Santa-2018-Prime-Paths/</span><br><span class="line">~$ kaggle competitions  list</span><br><span class="line">ref                                            deadline             category            reward  teamCount  userHasEntered</span><br><span class="line">---------------------------------------------  -------------------  ---------------  ---------  ---------  --------------</span><br><span class="line">digit-recognizer                               2030-01-01 00:00:00  Getting Started  Knowledge       2708            True</span><br><span class="line">titanic                                        2030-01-01 00:00:00  Getting Started  Knowledge      10578           False</span><br><span class="line">house-prices-advanced-regression-techniques    2030-01-01 00:00:00  Getting Started  Knowledge       4519           False</span><br><span class="line">imagenet-object-localization-challenge         2029-12-31 07:00:00  Research         Knowledge         30           False</span><br><span class="line">competitive-data-science-predict-future-sales  2019-12-31 23:59:00  Playground           Kudos       1869           False</span><br><span class="line">histopathologic-cancer-detection               2019-03-31 23:59:00  Playground       Knowledge        140           False</span><br><span class="line">humpback-whale-identification                  2019-02-28 23:59:00  Featured           <span class="variable">$25</span>,000        144           False</span><br><span class="line">elo-merchant-category-recommendation           2019-02-26 23:59:00  Featured           <span class="variable">$50</span>,000        630           False</span><br><span class="line">ga-customer-revenue-prediction                 2019-02-15 23:59:00  Featured           <span class="variable">$45</span>,000       1104           False</span><br><span class="line">quora-insincere-questions-classification       2019-02-05 23:59:00  Featured           <span class="variable">$25</span>,000       1666           False</span><br><span class="line">pubg-finish-placement-prediction               2019-01-30 23:59:00  Playground            Swag        857           False</span><br><span class="line">human-protein-atlas-image-classification       2019-01-10 23:59:00  Featured           <span class="variable">$37</span>,000       1388           False</span><br><span class="line">traveling-santa-2018-prime-paths               2019-01-10 23:59:00  Featured           <span class="variable">$25</span>,000        958            True</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<h1 id="è°¢è°¢æ”¯æŒ"><a href="#è°¢è°¢æ”¯æŒ" class="headerlink" title="è°¢è°¢æ”¯æŒ"></a>è°¢è°¢æ”¯æŒ</h1><ul>
<li>å¾®ä¿¡äºŒç»´ç :</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/08/AVRå•ç‰‡æœºæŒ‡å—/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/08/AVRå•ç‰‡æœºæŒ‡å—/" class="post-title-link" itemprop="url">AVRå•ç‰‡æœºæŒ‡å—</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-01-08 22:27:27" itemprop="dateCreated datePublished" datetime="2021-01-08T22:27:27+08:00">2021-01-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-07-03 19:29:40" itemprop="dateModified" datetime="2022-07-03T19:29:40+08:00">2022-07-03</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><p>å‚è€ƒ:</p>
<ul>
<li><a href="https://zh.wikipedia.org/wiki/Atmel_AVR" target="_blank" rel="noopener">Atmel AVR</a></li>
</ul>
</li>
<li><p><code>Atmel AVR</code>ç³»åˆ—æ˜¯ä¸€ç§åŸºäºæ”¹è¿›çš„å“ˆä½›ç»“æ„ã€8ä½ï½32ä½ç²¾ç®€æŒ‡ä»¤é›†(Reduced Instruction Set Computing,RISC)çš„å¾®æ§åˆ¶å™¨,ç”±<code>Atmel</code>å…¬å¸äº1996å¹´ç ”å‘.AVRç³»åˆ—æ˜¯é¦–æ¬¡é‡‡ç”¨é—ªå­˜<code>(Flash Memory)</code>ä½œä¸ºæ•°æ®å­˜å‚¨ä»‹è´¨çš„å•èŠ¯ç‰‡å¾®æ§åˆ¶å™¨ä¹‹ä¸€,åŒæ—¶ä»£çš„å…¶å®ƒå¾®æ§åˆ¶å™¨å¤šé‡‡ç”¨ä¸€æ¬¡å†™å…¥å¯ç¼–ç¨‹<code>ROM</code>ã€<code>EPROM</code>æˆ–æ˜¯<code>EEPROM</code>.ç›®å‰AVRå¤„ç†å™¨å‘å±•äº†å…­ä¸ªç³»åˆ—,åˆ†åˆ«æ˜¯:<code>tinyAVR,ATtiny</code>ç³»åˆ—;<code>megaAVR,ATmega</code>ç³»åˆ—;<code>XMEGA,ATxmega</code>ç³»åˆ—;A<code>pplication-specific AVR</code>,é¢å‘ç‰¹æ®Šåº”ç”¨çš„AVRç³»åˆ—,å¢åŠ LCDæ§åˆ¶å™¨ã€USBæ§åˆ¶å™¨ã€PWMç­‰ç‰¹æ€§;<code>FPSLIC,FPGA</code>ä¸Šçš„AVRæ ¸;AVR32,32ä½AVRç³»åˆ—,åŒ…å«<code>SIMD</code>å’Œ<code>DSP</code>ä»¥åŠéŸ³è§†é¢‘å¤„ç†ç‰¹æ€§,ä¸<code>ARM</code>æ¶æ„å½¢æˆäº‰.</p>
</li>
</ul>
<h1 id="ATmega32U4-Arduino-pro-micro"><a href="#ATmega32U4-Arduino-pro-micro" class="headerlink" title="ATmega32U4(Arduino pro micro)"></a>ATmega32U4(Arduino pro micro)</h1><ul>
<li><a href="https://github.com/sparkfun/Arduino_Boards" target="_blank" rel="noopener">sparkfun/Arduino_Boards</a></li>
<li><a href="https://github.com/Synapseware/examples/tree/master/atmega-asm" target="_blank" rel="noopener">atmega-asm</a></li>
<li><a href="https://github.com/MCUdude/MiniCore" target="_blank" rel="noopener">MiniCore</a></li>
<li><a href="https://www.hackster.io/kutluhan-aktar/arduino-based-atmega32u4-mouse-and-keyboard-controller-0f75c5" target="_blank" rel="noopener">Arduino-Based (ATmega32U4) Mouse and Keyboard Controller</a></li>
<li><a href="http://www.catb.org/esr/structure-packing/" target="_blank" rel="noopener">The Lost Art of Structure Packing</a></li>
</ul>
<ul>
<li><p>è¿æ¥<code>ICSP</code>çƒ§å†™<code>bootloader</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">        (2232HIO)</span><br><span class="line">        FT232H              ATmega32U4</span><br><span class="line"></span><br><span class="line">    pin13 ADBUS0   &lt;------&gt;   SCK    pin15</span><br><span class="line">    pin14 ADBUS1   &lt;------&gt;   MOSI   pin16</span><br><span class="line">    pin15 ADBUS2   &lt;------&gt;   MISO   pin14</span><br><span class="line">    pin16 ADBUS3   &lt;------&gt;   Reset  RST</span><br><span class="line">            GND    &lt;------&gt;   GND</span><br><span class="line">          +3.3V    &lt;------&gt;   +3.3V</span><br><span class="line"></span><br><span class="line">~$ avrdude -C /etc/avrdude.conf -c UM232H -P /dev/ttyUSB0 -b 19200 -p atmega32u4  -U lfuse:r:-:i</span><br><span class="line"></span><br><span class="line">avrdude: AVR device initialized and ready to accept instructions</span><br><span class="line"></span><br><span class="line">Reading | <span class="comment">################################################## | 100% 0.01s</span></span><br><span class="line"></span><br><span class="line">avrdude: Device signature = 0x1e9587 (probably m32u4)</span><br><span class="line">avrdude: reading lfuse memory:</span><br><span class="line"></span><br><span class="line">Reading | <span class="comment">################################################## | 100% 0.00s</span></span><br><span class="line"></span><br><span class="line">avrdude: writing output file <span class="string">"&lt;stdout&gt;"</span></span><br><span class="line">:01000000FF00</span><br><span class="line">:00000001FF</span><br><span class="line"></span><br><span class="line">avrdude: safemode: Fuses OK (E:CB, H:D8, L:FF)</span><br><span class="line"></span><br><span class="line">avrdude <span class="keyword">done</span>.  Thank you.</span><br></pre></td></tr></table></figure>
</li>
<li><p>some of valid programmers for FTDI</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2232HIO          = FT2232H based generic programmer</span><br><span class="line">4232h            = FT4232H based generic programmer</span><br><span class="line">ft232r           = FT232R Synchronous BitBang</span><br><span class="line">ft245r           = FT245R Synchronous BitBang</span><br><span class="line">ttl232r          = FTDI TTL232R-5V with ICSP adapter</span><br><span class="line">UM232H           = FT232H based module from FTDI and Glyn.com.au</span><br></pre></td></tr></table></figure>
<ul>
<li>æ·»åŠ <a href="https://github.com/sparkfun/Arduino_Boards" target="_blank" rel="noopener">sparkfun/Arduino_Boards</a>,è®©<code>Arduino IDE</code>æ”¯æŒæ›´å¤šçš„ç§ç±»çš„æ¿å­,æ·»åŠ <code>URL</code>å,é€šè¿‡<code>Tools -&gt; Boards Manager</code> å®‰è£…<code>SparkFun AVR Boards</code>.çƒ§å†™<code>SparkFun bootloader</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">~$ avrdude -C /etc/avrdude.conf -c UM232H -P /dev/ttyUSB0 -b 19200 -p m32u4  -U flash:w:.arduino15/packages/SparkFun/hardware/avr/1.1.13/bootloaders/caterina/Caterina-promicro16.hex</span><br><span class="line"></span><br><span class="line">avrdude: AVR device initialized and ready to accept instructions</span><br><span class="line"></span><br><span class="line">Reading | <span class="comment">################################################## | 100% 0.01s</span></span><br><span class="line"></span><br><span class="line">avrdude: Device signature = 0x1e9587 (probably m32u4)</span><br><span class="line">avrdude: NOTE: <span class="string">"flash"</span> memory has been specified, an erase cycle will be performed</span><br><span class="line">         To <span class="built_in">disable</span> this feature, specify the -D option.</span><br><span class="line">avrdude: erasing chip</span><br><span class="line">avrdude: reading input file <span class="string">".arduino15/packages/SparkFun/hardware/avr/1.1.13/bootloaders/caterina/Caterina-promicro16.hex"</span></span><br><span class="line">avrdude: input file .arduino15/packages/SparkFun/hardware/avr/1.1.13/bootloaders/caterina/Caterina-promicro16.hex auto detected as Intel Hex</span><br><span class="line">avrdude: writing flash (32762 bytes):</span><br><span class="line"></span><br><span class="line">Writing | <span class="comment">################################################## | 100% 0.00s</span></span><br><span class="line"></span><br><span class="line">avrdude: 32762 bytes of flash written</span><br><span class="line">avrdude: verifying flash memory against .arduino15/packages/SparkFun/hardware/avr/1.1.13/bootloaders/caterina/Caterina-promicro16.hex:</span><br><span class="line">avrdude: load data flash data from input file .arduino15/packages/SparkFun/hardware/avr/1.1.13/bootloaders/caterina/Caterina-promicro16.hex:</span><br><span class="line">avrdude: input file .arduino15/packages/SparkFun/hardware/avr/1.1.13/bootloaders/caterina/Caterina-promicro16.hex auto detected as Intel Hex</span><br><span class="line">avrdude: input file .arduino15/packages/SparkFun/hardware/avr/1.1.13/bootloaders/caterina/Caterina-promicro16.hex contains 32762 bytes</span><br><span class="line">avrdude: reading on-chip flash data:</span><br><span class="line"></span><br><span class="line">Reading | <span class="comment">################################################## | 100% 0.00s</span></span><br><span class="line"></span><br><span class="line">avrdude: verifying ...</span><br><span class="line">avrdude: 32762 bytes of flash verified</span><br><span class="line"></span><br><span class="line">avrdude: safemode: Fuses OK (E:CB, H:D8, L:FF)</span><br><span class="line"></span><br><span class="line">avrdude <span class="keyword">done</span>.  Thank you.</span><br></pre></td></tr></table></figure>
<h1 id="ATmega328p-Arduino-Pro-mini-with-CH340"><a href="#ATmega328p-Arduino-Pro-mini-with-CH340" class="headerlink" title="ATmega328p (Arduino Pro mini with CH340)"></a>ATmega328p (Arduino Pro mini with CH340)</h1><ul>
<li>çƒ§å†™å¥½<code>bootloader</code>å°±å¯ä»¥ä½¿ç”¨<code>USB</code>åœ¨<code>Arduino IDE</code>ä¸Šè¿›è¡Œå¼€å‘.</li>
<li>é€‰æ‹©<code>Tools -&gt; Board -&gt; Arduino Pro or Pro Mini</code>, çƒ§å†™å™¨<code>AVRISP mkii</code>.</li>
</ul>
<h1 id="ATtiny85-CJMCU"><a href="#ATtiny85-CJMCU" class="headerlink" title="ATtiny85(CJMCU)"></a>ATtiny85(CJMCU)</h1><ul>
<li><a href="https://github.com/wholder/ATTiny10IDE" target="_blank" rel="noopener">ATTiny10IDE</a></li>
<li><a href="https://diyprojects.io/tutorial-program-cjmcu-attiny85-lilytiny-lilypad/" target="_blank" rel="noopener">Tutorial : How to program the CJMCU ATTiny85 (LilyTiny / LilyPad)</a></li>
<li><a href="https://www.instructables.com/Digispark-DIY-The-smallest-USB-Arduino/" target="_blank" rel="noopener">Digispark DIY: the Smallest USB Arduino</a></li>
<li><a href="https://learn.sparkfun.com/tutorials/tiny-avr-programmer-hookup-guide/all" target="_blank" rel="noopener"> Tiny AVR Programmer Hookup Guide </a></li>
<li><a href="https://semjonov.de/docs/tips/avr/" target="_blank" rel="noopener">Arduino / AVR #</a></li>
<li><a href="https://littlewire.github.io/index.html" target="_blank" rel="noopener">Little Wire</a></li>
<li><a href="https://www.gadgetronicx.com/attiny85-i2c-protocol-tutorial/" target="_blank" rel="noopener">ATtiny85 I2C protocol tutorial</a></li>
<li><a href="https://www.hackster.io/wiresauce/attiny85-snake-game-handheld-5498e7" target="_blank" rel="noopener">ATtiny85 Snake Game Handheld</a></li>
</ul>
<h2 id="Bootloader"><a href="#Bootloader" class="headerlink" title="Bootloader"></a>Bootloader</h2><ul>
<li><a href="https://www.embedded-creations.com/projects/attiny85-usb-bootloader-overview/details" target="_blank" rel="noopener">ATtiny85 USB Boot Loader: Details</a></li>
<li><p><a href="https://github.com/micronucleus/micronucleus" target="_blank" rel="noopener">micronucleus</a>æ˜¯ä¸€ä¸ªå¯ä»¥æ”¯æŒè·¨å¹³å°çš„<code>USB</code>ä¸Šä¼ çƒ§å†™çš„<code>bootloader</code>,ä½“ç§¯åœ¨2kbä»¥å†….</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">        FT232H              ATTiny85</span><br><span class="line"></span><br><span class="line">    pin13 ADBUS0   &lt;------&gt;   SCK    PB2</span><br><span class="line">    pin14 ADBUS1   &lt;------&gt;   MOSI   PB0</span><br><span class="line">    pin15 ADBUS2   &lt;------&gt;   MISO   PB1</span><br><span class="line">    pin16 ADBUS3   &lt;------&gt;   Reset  PB5</span><br><span class="line">            GND    &lt;------&gt;   GND</span><br><span class="line">            +5V    &lt;------&gt;   +5V</span><br><span class="line"></span><br><span class="line">~ micronucleus/firmware/releases$ avrdude -C /etc/avrdude.conf -c UM232H -P /dev/ttyUSB1 -b 19200 -p attiny85 -U flash:w:t85_default.hex -U lfuse:w:0xe2:m -U hfuse:w:0xdd:m -U efuse:w:0xfe:m</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ¥å…¥<code>USB</code>ä¼šå‘ç°å¦‚ä¸‹çš„è®¾å¤‡:</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ lsusb</span><br><span class="line">[...]</span><br><span class="line">Bus 004 Device 007: ID 16d0:0753 MCS Digistump DigiSpark</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<ul>
<li>å¤åˆ¶<code>micronucleus/commandline/49-micronucleus.rules</code>åˆ°ç³»ç»Ÿçš„<code>/etc/udev/rules.d/</code>ç›®å½•å†….</li>
</ul>
<h3 id="ç³»ç»Ÿæ§åˆ¶ä¸å¤ä½"><a href="#ç³»ç»Ÿæ§åˆ¶ä¸å¤ä½" class="headerlink" title="ç³»ç»Ÿæ§åˆ¶ä¸å¤ä½"></a>ç³»ç»Ÿæ§åˆ¶ä¸å¤ä½</h3><ul>
<li>è¿™é‡Œè¦è®²åˆ°å…³äº<code>ç†”ä¸ä½(fuse)</code>çš„æŠ€æœ¯.å…·ä½“çš„æŠ€æœ¯ç»†èŠ‚éœ€è¦æŸ¥çœ‹<code>Datasheet</code>çš„<code>20. Memory Programming</code>.å¯ä»¥æ ¹æ®æ–‡æ¡£å»é…ç½®ç¼–ç¨‹ä½¿èƒ½ç›¸åº”çš„å­—èŠ‚çš„ä½.ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ª<a href="https://www.engbedded.com/fusecalc/" target="_blank" rel="noopener">https://www.engbedded.com/fusecalc/</a>é…ç½®å¾—å‡ºä¸‰ä¸ªå­—èŠ‚å»é…ç½®<code>ç†”ä¸ä½</code>.<code>lfuse</code>è¡¨ç¤ºä½ä½,<code>hfuse</code>è¡¨ç¤ºé«˜ä½,<code>efuse</code>è¡¨ç¤ºæ‰©å±•ä½.</li>
<li>åœ¨é…ç½®ç¼–ç¨‹ç†”ä¸ä½æ—¶æœ‰å‡ ä¸ªé—®é¢˜è¦æ³¨æ„,æ¯”å¦‚:æŠŠ<code>SPIEN,JTAGEN</code>çš„ä½è®¾å®šä¸ºæœªç¼–ç¨‹çŠ¶æ€,è¿™å°†ä½¿èŠ¯ç‰‡å¤±å»äº†<code>JTAGä¸SPI</code>æ¥å£çš„åŠŸèƒ½,ä¸èƒ½é‡æ–°çƒ§å†™,ä»è€Œä»¥è‡´å•ç‰‡æœºé”æ­»,å‡ºç°è¿™ç§æƒ…å†µæ—¶å°±éœ€è¦é«˜å‹(12v)å¹¶è¡Œç¼–ç¨‹æ–¹å¼æ‰èƒ½å°†å•ç‰‡æœºçš„åŠŸèƒ½æ¢å¤.å¦ä¸€ä¸ªé—®é¢˜æ˜¯è¦å¯åŠ¨åœ°å€çš„é”™è¯¯,å¦‚æœæ²¡æœ‰å¼€å¯å•ç‰‡æœºçš„<code>BOOTLOADER</code>åŠŸèƒ½,å°±ä¸è¦è®¾ç½®<code>BOOTRST</code>çš„ç¼–ç¨‹ä½ä¸º<code>0(å·²ç¼–ç¨‹)</code>,å¦åˆ™å•ç‰‡æœºåœ¨ä¸Šç”µæ—¶ä¸æ˜¯ä»<code>Flash</code>çš„<code>0x0000</code>å¼€å§‹è¿è¡Œçš„,è€Œæ˜¯è½¬åˆ°<code>BOOT</code>åŒºæ‰§è¡Œ,ä»è€Œå¯¼è‡´å•ç‰‡æœºæ— æ³•æ­£ç¡®è¿è¡Œ.</li>
</ul>
<h2 id="ä½¿ç”¨Arduino-IDEæ”¯æŒ-ATTinyCore"><a href="#ä½¿ç”¨Arduino-IDEæ”¯æŒ-ATTinyCore" class="headerlink" title="ä½¿ç”¨Arduino IDEæ”¯æŒ(ATTinyCore)"></a>ä½¿ç”¨<code>Arduino IDE</code>æ”¯æŒ(ATTinyCore)</h2><ul>
<li><a href="https://github.com/SpenceKonde/ATTinyCore" target="_blank" rel="noopener">ATTinyCore</a>æ˜¯è®©æœ€æ–°çš„<code>Arduino IDE</code>æ”¯æŒ<code>ATTinyç³»åˆ—</code>çš„å•ç‰‡æœº,å®‰è£…æµç¨‹å½“ç„¶ä¹Ÿå°±æ˜¯æŒ‰ç…§<a href="https://github.com/SpenceKonde/ATTinyCore/blob/master/Installation.md" target="_blank" rel="noopener">https://github.com/SpenceKonde/ATTinyCore/blob/master/Installation.md</a>æ“ä½œ,åœ¨<code>Arduino IDE -&gt; File-&gt;Preferences</code>åŠ å…¥<code>http://drazzy.com/package_drazzy.com_index.json</code>,å¹¶ä¸”æ›´æ–°å®‰è£…<code>ATTinyCore</code>çš„åº“.ä¹‹ååœ¨<code>`Arduino IDE -&gt; Tools -&gt; Board -&gt; ATTinyCore</code>é‡Œé¢å¯ä»¥é€‰æ‹©ç›®æ ‡çš„å•ç‰‡æœº.</li>
<li>æœ‰å¯èƒ½<code>ATTinyCore</code>è‡ªå¸¦çš„<code>micronucleus</code>ç‰ˆæœ¬å¤ªä½ä¸<code>Attiny85</code>å†…çƒ§å†™ç‰ˆæœ¬çš„ä¸åŒ¹é…,å°±ä¼šå‡ºç°ä¸‹é¢çš„é”™è¯¯,å…·ä½“çš„ç‰ˆæœ¬å¯ä»¥æŸ¥çœ‹<code>~/.arduino15/packages/ATTinyCore/tools/micronucleus/2.0a4/</code>.å…³äº<code>ATTinyCore</code>æ‰€æ”¯æŒçš„ç¡¬ä»¶ä¸å›ºä»¶é…ç½®å¯ä»¥æŸ¥çœ‹<code>~/.arduino15/packages/ATTinyCore/hardware/avr/1.4.1/bootloaders</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Warning: device with unknown new version of Micronucleus detected.</span><br><span class="line">This tool doesn\<span class="string">'t know how to upload to this new device. Updates may be available.</span></span><br><span class="line"><span class="string">Device reports version as: 2.4</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å…³äºä¸Šé¢çš„è­¦å‘Šæç¤º,éœ€è¦æ›´æ–°<code>micronucleus</code>ç‰ˆæœ¬.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cd</span> micronucleus/commandline &amp;&amp; make</span><br><span class="line">~$ cp micronucleus  ~/.arduino15/packages/ATTinyCore/tools/micronucleus/2.0a4/</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="ä½¿ç”¨Arduinoä¸Šä¼ ç¬¬ä¸€ä¸ªç¨‹åº-blink"><a href="#ä½¿ç”¨Arduinoä¸Šä¼ ç¬¬ä¸€ä¸ªç¨‹åº-blink" class="headerlink" title="ä½¿ç”¨Arduinoä¸Šä¼ ç¬¬ä¸€ä¸ªç¨‹åº(blink)."></a>ä½¿ç”¨<code>Arduino</code>ä¸Šä¼ ç¬¬ä¸€ä¸ªç¨‹åº(blink).</h3><ul>
<li>é€‰æ‹©ä¸»æ¿:<code>Tools -&gt; Board -&gt; ATTinyCore -&gt; ATtiny85(Micronucleus/DigiSpark)</code></li>
<li>çƒ§å†™æ–¹å¼:<code>Tools -&gt; Burn Bootloader Method: &quot;Upgrade (via USB)&quot;</code></li>
<li><p>åŸºæœ¬ä¸Šé€‰æ‹©äº†æ­£ç¡®çš„ä¸»æ¿,å…¶å®ƒå‚æ•°é»˜è®¤å°±å¯ä»¥äº†,æµ‹è¯•å›¾å¦‚ä¸‹:<br><img src="/imgs/arduino-attinycore-t85.png" alt="arduino-attinycore-t85.png"></p>
</li>
<li><p>æµ‹å¼ç¨‹åºæ˜¯:<code>File -&gt; Examples -&gt; Built-in examples -&gt; 01.Basics -&gt; Blink</code>. åªæ˜¯é‡å®šä¹‰äº†<code>LED_BUILTIN</code>çš„IOå£,å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define LED_BUILTIN 1</span></span><br><span class="line"></span><br><span class="line">// the setup <span class="keyword">function</span> runs once when you press reset or power the board</span><br><span class="line">void <span class="function"><span class="title">setup</span></span>() &#123;</span><br><span class="line">  // initialize digital pin LED_BUILTIN as an output.</span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// the loop <span class="keyword">function</span> runs over and over again forever</span><br><span class="line">void <span class="function"><span class="title">loop</span></span>() &#123;</span><br><span class="line">  digitalWrite(LED_BUILTIN, HIGH);   // turn the LED on (HIGH is the voltage level)</span><br><span class="line">  delay(1000);                       // <span class="built_in">wait</span> <span class="keyword">for</span> a second</span><br><span class="line">  digitalWrite(LED_BUILTIN, LOW);    // turn the LED off by making the voltage LOW</span><br><span class="line">  delay(1000);                       // <span class="built_in">wait</span> <span class="keyword">for</span> a second</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>çƒ§å†™æç¤ºå¦‚ä¸‹:</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Plug <span class="keyword">in</span> device now... (will timeout <span class="keyword">in</span> 60 seconds)</span><br><span class="line">&gt; Please plug <span class="keyword">in</span> the device ...</span><br><span class="line">&gt; Press CTRL+C to terminate the program.</span><br><span class="line">&gt; Device is found!</span><br><span class="line">connecting: 16% complete</span><br><span class="line">connecting: 22% complete</span><br><span class="line">connecting: 28% complete</span><br><span class="line">connecting: 33% complete</span><br><span class="line">&gt; Device has firmware version 2.4</span><br><span class="line">&gt; Device signature: 0x1e930b</span><br><span class="line">&gt; Available space <span class="keyword">for</span> user applications: 6522 bytes</span><br><span class="line">&gt; Suggested sleep time between sending pages: 7ms</span><br><span class="line">&gt; Whole page count: 102  page size: 64</span><br><span class="line">&gt; Erase <span class="keyword">function</span> sleep duration: 714ms</span><br><span class="line">parsing: 50% complete</span><br><span class="line">&gt; Erasing the memory ...</span><br><span class="line">erasing: 55% complete</span><br><span class="line">erasing: 60% complete</span><br><span class="line">erasing: 65% complete</span><br><span class="line">&gt; Starting to upload ...</span><br><span class="line">writing: 70% complete</span><br><span class="line">writing: 75% complete</span><br><span class="line">writing: 80% complete</span><br><span class="line">&gt; Starting the user app ...</span><br><span class="line">running: 100% complete</span><br><span class="line">&gt;&gt; Micronucleus <span class="keyword">done</span>. Thank you!</span><br></pre></td></tr></table></figure>
<h3 id="æ–°å¢çƒ§å†™å™¨-UM232Hä¸ºä¾‹"><a href="#æ–°å¢çƒ§å†™å™¨-UM232Hä¸ºä¾‹" class="headerlink" title="æ–°å¢çƒ§å†™å™¨(UM232Hä¸ºä¾‹)"></a>æ–°å¢çƒ§å†™å™¨(UM232Hä¸ºä¾‹)</h3><ul>
<li><p><a href="https://arduino.github.io/arduino-cli/platform-specification/" target="_blank" rel="noopener">Platform specification</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~$ tree -L 2 ~/.arduino15/packages/</span><br><span class="line">/home/michael/.arduino15/packages/</span><br><span class="line">â”œâ”€â”€ arduino</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ hardware</span><br><span class="line">â”‚Â Â  â””â”€â”€ tools</span><br><span class="line">â”œâ”€â”€ atmel-avr-xminis</span><br><span class="line">â”‚Â Â  â””â”€â”€ hardware</span><br><span class="line">â”œâ”€â”€ ATTinyCore</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ hardware</span><br><span class="line">â”‚Â Â  â””â”€â”€ tools</span><br><span class="line">â”œâ”€â”€ esp32</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ hardware</span><br><span class="line">â”‚Â Â  â””â”€â”€ tools</span><br><span class="line">â”œâ”€â”€ SparkFun</span><br><span class="line">â”‚Â Â  â””â”€â”€ hardware</span><br><span class="line">â””â”€â”€ STM32</span><br><span class="line">    â”œâ”€â”€ hardware</span><br><span class="line">    â””â”€â”€ tools</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨<code>~/.arduino15/packages/</code>å†…çš„å„ç§åŒ…å†…ç»“æ„å¦‚ä¸‹,åŸºæœ¬æ¯ä¸€ä¸ªåŒ…(package: i.e: ardunion,ATTinyCore )ä¸‹é¢çš„<code>hardware\&lt;arch&gt;\&lt;version\</code>å†…éƒ½æœ‰<code>boards.txt,programmers.txt</code>æ–‡ä»¶.</p>
</li>
<li>è€Œåœ¨åŒ…ä¸‹é¢çš„<code>hardware\tools\</code>å†…åŒ…å†…,åŒ…å«è¿™ä¸ªåŒ…æ‰€æ”¯æŒçš„å·¥å…·é“¾,å¦‚:ç¼–è¯‘å™¨,çƒ§å†™å™¨,è¿˜æœ‰ä¸€äº›ç‰¹å®šçš„å·¥å…·ç­‰.è¿™é‡Œä»¥<code>avrdude</code>ä¸ºä¾‹,åœ¨<code>Arduino IDE</code>çƒ§å†™<code>AVR</code>çš„æ¿å­æ—¶å€™,å®ƒä¼šè°ƒç”¨åŒ…å†…çš„<code>avrdude</code>ä¸é…ç½®æ–‡ä»¶,å¦‚:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.arduino15/packages/arduino/tools/avrdude/6.3.0-arduino17/bin/avrdude \</span><br><span class="line">-c .arduino15/packages/arduino/tools/avrdude/6.3.0-arduino17/etc/avrdude.conf</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸‹é¢æ˜¯è®©<code>ATTinyCore</code>åŒ…å†…çš„<code>Attiny85</code>é€šè¿‡ä½¿ç”¨<code>UM232H</code>çƒ§å†™å™¨,åœ¨<code>Arduino IDE</code>å†…çƒ§å†™,æ— éœ€å…¶å®ƒçš„<code>bootloader</code>æ”¯æŒ.</li>
<li>é¦–å…ˆåœ¨<code>~/.arduino15/packages/ATTinyCore/hardware/avr/1.4.1/programmers.txt</code>å†…,åŠ å…¥ä»¥ä¸‹å†…å®¹:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">um232h.name=UM232H as ISP</span><br><span class="line">um232h.communication=serial</span><br><span class="line">um232h.protocol=UM232H</span><br><span class="line">um232h.speed=19200</span><br><span class="line">um232h.program.protocol=UM232H</span><br><span class="line">um232h.program.speed=19200</span><br><span class="line">um232h.program.tool=avrdude</span><br><span class="line">um232h.program.extra_params=-P&#123;serial.port&#125; -b&#123;program.speed&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>é‡å¯<code>Arduino IDE</code>ä¼šå‘ç°,é€‰æ‹©<code>ATTinyCore</code>åŒ…ç±»çš„æ¿å­,åœ¨çƒ§å†™å™¨ä¸€æ ,ä¼šçœ‹åˆ°<code>UM232H as ISP</code>. å¦‚æœåœ¨æŸä¸ªåŒ…ç±»æ²¡æœ‰åœ¨å®šä¹‰<code>programmers.txt</code>,å®ƒå°±ä¼šä½¿ç”¨ç›®æ ‡æ¿å­åœ¨<code>arduino</code>ä½“ç³»å†…æ‰€å¯¹åº”<code>~/.arduino15/packages/arduino/hardware/&lt;arch&gt;/&lt;version&gt;/programmers.txt</code></li>
<li><p>å¦‚:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ .arduino15/packages/arduino/tools/avrdude/6.3.0-arduino17/bin/avrdude -C .arduino15/packages/ATTinyCore/hardware/avr/1.4.1/avrdude.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœè¿™é‡Œçš„<code>.arduino15/packages/ATTinyCore/hardware/avr/1.4.1/avrdude.conf</code>æ–‡ä»¶å†…æ²¡æœ‰æ”¯æŒ<code>UM232H</code>é…ç½®,éœ€è¦åœ¨<code>avrdude.conf</code>åŠ å…¥ä¸‹é¢å†…å®¹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># UM232H module from FTDI and Glyn.com.au.</span></span><br><span class="line"><span class="comment"># See helix.air.net.au for detailed usage information.</span></span><br><span class="line"><span class="comment"># J1: Connect pin 2 and 3 for USB power.</span></span><br><span class="line"><span class="comment"># J2: Connect pin 2 and 3 for USB power.</span></span><br><span class="line"><span class="comment"># J2: Pin 7 is SCK</span></span><br><span class="line"><span class="comment">#   : Pin 8 is MOSI</span></span><br><span class="line"><span class="comment">#   : Pin 9 is MISO</span></span><br><span class="line"><span class="comment">#   : Pin 11 is RST</span></span><br><span class="line"><span class="comment">#   : Pin 6 is ground</span></span><br><span class="line"><span class="comment"># Use the -b flag to set the SPI clock rate eg -b 3750000 is the fastest I could get</span></span><br><span class="line"><span class="comment"># a 16MHz Atmega1280 to program reliably.  The 232H is conveniently 5V tolerant.</span></span><br><span class="line">programmer</span><br><span class="line">  id         = <span class="string">"UM232H"</span>;</span><br><span class="line">  desc       = <span class="string">"FT232H based module from FTDI and Glyn.com.au"</span>;</span><br><span class="line">  <span class="built_in">type</span>       = <span class="string">"avrftdi"</span>;</span><br><span class="line">  usbvid     = 0x0403;</span><br><span class="line"><span class="comment"># Note: This PID is reserved for generic 232H devices and</span></span><br><span class="line"><span class="comment"># should be programmed into the EEPROM</span></span><br><span class="line">  usbpid     = 0x6014;</span><br><span class="line">  usbdev     = <span class="string">"A"</span>;</span><br><span class="line">  usbvendor  = <span class="string">""</span>;</span><br><span class="line">  usbproduct = <span class="string">""</span>;</span><br><span class="line">  usbsn      = <span class="string">""</span>;</span><br><span class="line"><span class="comment">#ISP-signals</span></span><br><span class="line">  sck    = 0;</span><br><span class="line">  mosi   = 1;</span><br><span class="line">  miso   = 2;</span><br><span class="line">  reset  = 3;</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚åœ¨è¿è¡Œçƒ§å†™æ—¶å‡ºç°åœ¨ä¸‹é¢é”™è¯¯,ä¹Ÿå°±æ˜¯åœ¨ä¸€äº›<code>avrdude.conf</code>å†…æ²¡æœ‰æ”¯æŒ<code>UM232H</code>çš„åŸå› ä¹‹ä¸€.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">avrdude: Error: no libftdi or libusb support. Install libftdi1/libusb-1.0 or libftdi/libusb and run configure/make again.</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿™é‡Œæ¯”è¾ƒç®€å•è§£å†³åŠæ³•æ˜¯,ä½¿ç”¨ç³»ç»Ÿçš„<code>/usr/bin/avrdude</code>æ¥æ›¿æ¢<code>.arduino15/packages/arduino/tools/avrdude/6.3.0-arduino17/bin/avrdude</code></p>
</li>
<li><p>ä¸ºä»€ä¹ˆ<code>Arduino IDE</code>ä¸ºä¼šè°ƒç”¨åŒ…å†…çš„å·¥å…·(avrdude),å› ä¸ºå®ƒçš„è·¯å¾„å®šä¹‰å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ grep <span class="string">"avrdude.path"</span> ~/.arduino15/packages/arduino/hardware/avr/1.8.3/platform.txt</span><br><span class="line">tools.avrdude.path=&#123;runtime.tools.avrdude.path&#125;</span><br><span class="line"></span><br><span class="line">~$ grep <span class="string">"avrdude.path"</span> ~/.arduino15/packages/ATTinyCore/hardware/avr/1.4.1/platform.txt</span><br><span class="line">tools.avrdude.path=&#123;runtime.tools.avrdude.path&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æœ€å,æ–°å¢å…¶å®ƒçš„ç§ç±»çš„çƒ§å†™å™¨ä¹Ÿæ˜¯ç±»ä¼¼,å¦‚:<code>FT2232HL</code>ç­‰.è¿™ç§æ–¹å¼,å°±æ˜¯å¯ä»¥ä½¿ç”¨<code>Arduino IDE</code>ç”Ÿæ€å†…çš„è½¯ä»¶åº“,æ‰€å¸¦æ¥å¿«é€Ÿå¼€å‘ä¸æµ‹è¯•ç¡¬ä»¶çš„ä¼˜åŠ¿.ä¹Ÿå¯ä½¿ç”¨<code>Makefile</code>çš„æ–¹å¼ä½¿ç”¨<code>avrdude</code>æ¥çƒ§å†™.</p>
</li>
</ul>
<h3 id="æ·»åŠ 2232HL"><a href="#æ·»åŠ 2232HL" class="headerlink" title="æ·»åŠ 2232HL"></a>æ·»åŠ <code>2232HL</code></h3><ul>
<li>æ‰“å¼€<code>/etc/avrdude.conf</code>æ–‡ä»¶å‘ç°ï¼Œé‡Œé¢é»˜è®¤å®šä¹‰äº†<code>FT2232Hï¼ŒFT4232H</code>çš„é…ç½®å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /etc/avrdude.conf</span><br><span class="line">[...]</span><br><span class="line">programmer</span><br><span class="line">    id         = <span class="string">"2232HIO"</span>;</span><br><span class="line">    desc       = <span class="string">"FT2232H based generic programmer"</span>;</span><br><span class="line">    <span class="built_in">type</span>       = <span class="string">"avrftdi"</span>;</span><br><span class="line">    connection_type = usb;</span><br><span class="line">    usbvid     = 0x0403;</span><br><span class="line">  <span class="comment"># Note: This PID is reserved for generic H devices and</span></span><br><span class="line">  <span class="comment"># should be programmed into the EEPROM</span></span><br><span class="line">  <span class="comment">#  usbpid     = 0x8A48;</span></span><br><span class="line">    usbpid     = 0x6010;</span><br><span class="line">    usbdev     = <span class="string">"A"</span>;</span><br><span class="line">    usbvendor  = <span class="string">""</span>;</span><br><span class="line">    usbproduct = <span class="string">""</span>;</span><br><span class="line">    usbsn      = <span class="string">""</span>;</span><br><span class="line">  <span class="comment">#ISP-signals</span></span><br><span class="line">    reset  = 3;</span><br><span class="line">    sck    = 0;</span><br><span class="line">    mosi   = 1;</span><br><span class="line">    miso   = 2;</span><br><span class="line">    buff   = ~4;</span><br><span class="line">  <span class="comment">#LED SIGNALs</span></span><br><span class="line">    errled = ~ 11;</span><br><span class="line">    rdyled = ~ 14;</span><br><span class="line">    pgmled = ~ 13;</span><br><span class="line">    vfyled = ~ 12;</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#The FT4232H can be treated as FT2232H, but it has a different USB</span></span><br><span class="line">  <span class="comment">#device ID of 0x6011.</span></span><br><span class="line">  programmer parent <span class="string">"avrftdi"</span></span><br><span class="line">    id         = <span class="string">"4232h"</span>;</span><br><span class="line">    desc       = <span class="string">"FT4232H based generic programmer"</span>;</span><br><span class="line">    usbpid     = 0x6011;</span><br><span class="line">  ;</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚ä¸Šæ‰€ç¤º,åœ¨ç³»ç»Ÿçº§çš„<code>avrdude</code>å·²ç»æ”¯æŒ<code>FT2232H</code>,è¿™é‡Œåªéœ€è¦ç¡¬ä»¶åº“é‡Œ<code>programmers.txt</code>æ·»åŠ ä¸€ä¸ªå¯¹åº”åˆ°<code>FT2232H</code>çš„é¡¹å°±å¯ä»¥äº†ã€‚ä½†æ˜¯ä¸€èˆ¬åœ¨ç¡¬ä»¶åº“é‡Œï¼Œè¿˜æœ‰ä¸€ä»½<code>avrdude.conf</code>,æŒ‰é¡ºåºä¼šå…ˆæ˜¯æ£€æŸ¥ç¡¬ä»¶åº“é‡Œçš„ç›¸å…³é…ç½®ã€‚è¿™é‡Œè¿˜æ˜¯ä»¥<code>ATTinyCore</code>çš„ç¡¬ä»¶åº“ä¸ºä¾‹ï¼š</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~$ tail -n 10 ~/.arduino15/packages/ATTinyCore/hardware/avr/1.5.2/programmers.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ft2232h.name=2232HIO as ISP</span><br><span class="line">ft2232h.communication=serial</span><br><span class="line">ft2232h.protocol=avrftdi</span><br><span class="line">ft2232h.speed=19200</span><br><span class="line">ft2232h.program.protocol=avrftdi</span><br><span class="line">ft2232h.program.speed=19200</span><br><span class="line">ft2232h.program.tool=avrdude</span><br><span class="line">ft2232h.program.extra_params=-P&#123;serial.port&#125; -b&#123;program.speed&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>ft2232h</code>è¿æ¥<code>attiny85</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> FT2232H              ATTiny85</span><br><span class="line"></span><br><span class="line">ADBUS0   &lt;------&gt;   SCK    PB2</span><br><span class="line">ADBUS1   &lt;------&gt;   MOSI   PB0</span><br><span class="line">ADBUS2   &lt;------&gt;   MISO   PB1</span><br><span class="line">ADBUS3   &lt;------&gt;   Reset  PB5</span><br><span class="line">  GND    &lt;------&gt;   GND</span><br><span class="line">  +5V    &lt;------&gt;   +5V</span><br></pre></td></tr></table></figure>
<h2 id="AVRDudeçƒ§å†™"><a href="#AVRDudeçƒ§å†™" class="headerlink" title="AVRDudeçƒ§å†™"></a><code>AVRDude</code>çƒ§å†™</h2><ul>
<li>å‰é¢æ˜¯åœ¨<code>ATTiny85</code>Flashé‡Œçƒ§å†™ä¸€ä¸ª<code>bootloader</code>å¼€å¯<code>SELFPRGEN Self-Programming Enable</code>ä¸<strong>SPIEN Enable Serial Program and Data Downloading</strong>çš„åŠŸèƒ½,ä¼˜ç‚¹å°±æ˜¯è®©å®ƒèƒ½é€šè¿‡<code>USB(D-: PB3/AD3,D+: PB4/AD2)</code>å¯ä»¥çƒ§å†™ç¨‹åº,å¯ä»¥ç®€å•ä¸<code>Arduino IDE</code>é›†æˆä½¿ç”¨,ä¸éœ€è¦å¤–æ¥çƒ§å†™å™¨.ç¼ºç‚¹å°±æ˜¯è¦æ¶ˆè€—<code>2kb</code>çš„å­˜å‚¨ç©ºé—´,ä½†æ˜¯<code>Attiny85</code>æ€»ä¾›å°±åªæœ‰8kbçš„Flash.</li>
<li><p>ä¸‹é¢å°±æ˜¯é€šè¿‡ä½¿ç”¨<code>UM232H</code>åƒçƒ§å†™<code>bootloader</code>çš„æ–¹æ³•å»å¼€å‘ç¼–ç¨‹,å¯ä»¥å®Œå…¨ä½¿ç”¨8kbçš„ç©ºé—´.ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•<code>blink</code>ç¤ºä¾‹.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">~ blink$ cat main.c</span><br><span class="line"><span class="comment">// main.c</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// A simple blinky program for ATtiny85</span></span><br><span class="line"><span class="comment">// Connect red LED at pin 2 (PB1)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// electronut.in</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;avr/io.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;util/delay.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// set PB1 to be output</span></span><br><span class="line">	DDRB = <span class="number">0b00000010</span>;</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// flash# 1:</span></span><br><span class="line">    <span class="comment">// set PB1 high</span></span><br><span class="line">    PORTB = <span class="number">0b00000010</span>;</span><br><span class="line">    _delay_ms(<span class="number">20</span>);</span><br><span class="line">    <span class="comment">// set PB1 low</span></span><br><span class="line">    PORTB = <span class="number">0b00000000</span>;</span><br><span class="line">    _delay_ms(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// flash# 2:</span></span><br><span class="line">    <span class="comment">// set PB1 high</span></span><br><span class="line">    PORTB = <span class="number">0b00000010</span>;</span><br><span class="line">    _delay_ms(<span class="number">200</span>);</span><br><span class="line">    <span class="comment">// set PB1 low</span></span><br><span class="line">    PORTB = <span class="number">0b00000000</span>;</span><br><span class="line">    _delay_ms(<span class="number">200</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Makefile</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Makefile for programming the ATtiny85</span></span><br><span class="line"><span class="comment"># modified the one generated by CrossPack</span></span><br><span class="line"></span><br><span class="line">DEVICE      = attiny85</span><br><span class="line">CLOCK      = 8000000</span><br><span class="line">PROGRAMMER = -c UM232H</span><br><span class="line">OBJECTS    = main.o</span><br><span class="line"><span class="comment"># for ATTiny85</span></span><br><span class="line"><span class="comment"># see http://www.engbedded.com/fusecalc/</span></span><br><span class="line">FUSES       = -U lfuse:w:0x62:m -U hfuse:w:0xdf:m -U efuse:w:0xff:m</span><br><span class="line"></span><br><span class="line"><span class="comment"># Tune the lines below only if you know what you are doing:</span></span><br><span class="line">AVRDUDE = avrdude $(PROGRAMMER) -p $(DEVICE)</span><br><span class="line">COMPILE = avr-gcc -Wall -Os -DF_CPU=$(CLOCK) -mmcu=$(DEVICE)</span><br><span class="line"></span><br><span class="line"><span class="comment"># symbolic targets:</span></span><br><span class="line">all:	main.hex</span><br><span class="line"></span><br><span class="line">.c.o:</span><br><span class="line">	$(COMPILE) -c $&lt; -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line">.S.o:</span><br><span class="line">	$(COMPILE) -x assembler-with-cpp -c $&lt; -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line">.c.s:</span><br><span class="line">	$(COMPILE) -S $&lt; -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line">flash:	all</span><br><span class="line">	$(AVRDUDE) -U flash:w:main.hex:i</span><br><span class="line"></span><br><span class="line">fuse:</span><br><span class="line">	$(AVRDUDE) $(FUSES)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Xcode uses the Makefile targets "", "clean" and "install"</span></span><br><span class="line">install: flash fuse</span><br><span class="line"></span><br><span class="line"><span class="comment"># if you use a bootloader, change the command below appropriately:</span></span><br><span class="line">load: all</span><br><span class="line">	bootloadHID main.hex</span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">	rm -f main.hex main.elf $(OBJECTS)</span><br><span class="line"></span><br><span class="line"><span class="comment"># file targets:</span></span><br><span class="line">main.elf: $(OBJECTS)</span><br><span class="line">	$(COMPILE) -o main.elf $(OBJECTS)</span><br><span class="line"></span><br><span class="line">main.hex: main.elf</span><br><span class="line">	rm -f main.hex</span><br><span class="line">	avr-objcopy -j .text -j .data -O ihex main.elf main.hex</span><br><span class="line">	avr-size --format=avr --mcu=$(DEVICE) main.elf</span><br><span class="line"><span class="comment"># If you have an EEPROM section, you must also create a hex file for the</span></span><br><span class="line"><span class="comment"># EEPROM and add it to the "flash" target.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Targets for code debugging and analysis:</span></span><br><span class="line">disasm:	main.elf</span><br><span class="line">	avr-objdump -d main.elf</span><br><span class="line"></span><br><span class="line">cpp:</span><br><span class="line">	$(COMPILE) -E main.c</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ¥çº¿æŒ‰ç…§ä¸Šé¢æ–¹æ³•,å› ä¸ºè¿™é‡Œæ˜¯æ²¡æœ‰ç”¨ä½¿ç”¨<code>bootloader</code>,ç›´æ¥åœ¨<code>blink</code>ç›®å½•ä¸‹è¿è¡Œ<code>make flash</code>å°±é€šè¿‡ä½¿ç”¨<code>avrdude</code>çƒ§å†™åˆ°<code>flash</code>ä¸­.</p>
</li>
<li>ä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨ä¸‹é¢å‘½ä»¤çƒ§å†™.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ avrdude -C /etc/avrdude.conf -c UM232H -P /dev/ttyUSB1 -b 19200 -p attiny85 -U flash:w:main.hex:i</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="é«˜å‹ç¼–ç¨‹æ¢å¤ç†”ä¸ä½-fuse-é”æ­»"><a href="#é«˜å‹ç¼–ç¨‹æ¢å¤ç†”ä¸ä½-fuse-é”æ­»" class="headerlink" title="é«˜å‹ç¼–ç¨‹æ¢å¤ç†”ä¸ä½(fuse)é”æ­»"></a>é«˜å‹ç¼–ç¨‹æ¢å¤<code>ç†”ä¸ä½(fuse)</code>é”æ­»</h2><ul>
<li>Links<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=Alex079.vscode-avr-helper" target="_blank" rel="noopener">Alex079.vscode-avr-helper</a></li>
<li><a href="https://arduinodiy.wordpress.com/2015/05/16/high-voltage-programmingunbricking-for-attiny/" target="_blank" rel="noopener">High Voltage programming/Unbricking for Attiny</a></li>
<li><a href="https://github.com/RalphBacon/ATTiny85_Fuse_Resetter" target="_blank" rel="noopener">ATTiny85_Fuse_Resetter</a></li>
<li><a href="https://embedds.com/all-you-need-to-know-about-avr-fuses/" target="_blank" rel="noopener">All you need to know about AVR fuses</a></li>
</ul>
</li>
<li>æ¢å¤<code>ç†”ä¸ä½(fuse)</code>è¿˜æ˜¯æœ‰ä¸€ç‚¹éº»çƒ¦,æŒ‰ç…§åšæ–‡<a href="https://arduinodiy.wordpress.com/2015/05/16/high-voltage-programmingunbricking-for-attiny/" target="_blank" rel="noopener">High Voltage programming/Unbricking for Attiny</a>æŒ‡å¯¼,éœ€è¦æœ‰ä¸€ä¸ª<code>Arduino</code>è®¾å¤‡,æˆ–è€…è¯´è‡³å°‘è¦ä¸€ä¸ªæœ‰6ä¸ªIOå£çš„å•ç‰‡æœº.è¿˜éœ€è¦6ä¸ª1kçš„ç”µé˜»,ä¸€ä¸ª(npn)çš„ä¸‰æç®¡,ä¸€ä¸ª12Vçš„ç”µå‹æº.å¦‚å›¾ï¼š</li>
<li><img src="/imgs/high-voltage-programmer.png" alt="high-voltage-programmer.png"></li>
</ul>
<ul>
<li><p>è¯»å–<code>ç†”ä¸ä½(fuse)</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">~$ avrdude -C /etc/avrdude.conf -c UM232H -P /dev/ttyUSB1 -b 19200 -p attiny85  -U lfuse:r:-:i -v</span><br><span class="line"></span><br><span class="line">avrdude: Version 6.3-20171130</span><br><span class="line">         Copyright (c) 2000-2005 Brian Dean, http://www.bdmicro.com/</span><br><span class="line">         Copyright (c) 2007-2014 Joerg Wunsch</span><br><span class="line"></span><br><span class="line">         System wide configuration file is <span class="string">"/etc/avrdude.conf"</span></span><br><span class="line">         User configuration file is <span class="string">"/home/michael/.avrduderc"</span></span><br><span class="line">         User configuration file does not exist or is not a regular file, skipping</span><br><span class="line"></span><br><span class="line">         Using Port                    : /dev/ttyUSB1</span><br><span class="line">         Using Programmer              : UM232H</span><br><span class="line">         Overriding Baud Rate          : 19200</span><br><span class="line">         AVR Part                      : ATtiny85</span><br><span class="line">         Chip Erase delay              : 4500 us</span><br><span class="line">         PAGEL                         : P00</span><br><span class="line">         BS2                           : P00</span><br><span class="line">         RESET disposition             : possible i/o</span><br><span class="line">         RETRY pulse                   : SCK</span><br><span class="line">         serial program mode           : yes</span><br><span class="line">         parallel program mode         : yes</span><br><span class="line">         Timeout                       : 200</span><br><span class="line">         StabDelay                     : 100</span><br><span class="line">         CmdexeDelay                   : 25</span><br><span class="line">         SyncLoops                     : 32</span><br><span class="line">         ByteDelay                     : 0</span><br><span class="line">         PollIndex                     : 3</span><br><span class="line">         PollValue                     : 0x53</span><br><span class="line">         Memory Detail                 :</span><br><span class="line"></span><br><span class="line">                                  Block Poll               Page                       Polled</span><br><span class="line">           Memory Type Mode Delay Size  Indx Paged  Size   Size <span class="comment">#Pages MinW  MaxW   ReadBack</span></span><br><span class="line">           ----------- ---- ----- ----- ---- ------ ------ ---- ------ ----- ----- ---------</span><br><span class="line">           eeprom        65     6     4    0 no        512    4      0  4000  4500 0xff 0xff</span><br><span class="line">           flash         65     6    32    0 yes      8192   64    128  4500  4500 0xff 0xff</span><br><span class="line">           signature      0     0     0    0 no          3    0      0     0     0 0x00 0x00</span><br><span class="line">           lock           0     0     0    0 no          1    0      0  9000  9000 0x00 0x00</span><br><span class="line">           lfuse          0     0     0    0 no          1    0      0  9000  9000 0x00 0x00</span><br><span class="line">           hfuse          0     0     0    0 no          1    0      0  9000  9000 0x00 0x00</span><br><span class="line">           efuse          0     0     0    0 no          1    0      0  9000  9000 0x00 0x00</span><br><span class="line">           calibration    0     0     0    0 no          1    0      0     0     0 0x00 0x00</span><br><span class="line"></span><br><span class="line">         Programmer Type : avrftdi</span><br><span class="line">         Description     : FT232H based module from FTDI and Glyn.com.au</span><br><span class="line"></span><br><span class="line">avrdude: AVR device initialized and ready to accept instructions</span><br><span class="line"></span><br><span class="line">Reading | <span class="comment">################################################## | 100% 0.01s</span></span><br><span class="line"></span><br><span class="line">avrdude: Device signature = 0x1e930b (probably t85)</span><br><span class="line">avrdude: safemode: lfuse reads as 62</span><br><span class="line">avrdude: safemode: hfuse reads as DF</span><br><span class="line">avrdude: safemode: efuse reads as FE</span><br><span class="line">avrdude: reading lfuse memory:</span><br><span class="line"></span><br><span class="line">Reading | <span class="comment">################################################## | 100% 0.00s</span></span><br><span class="line"></span><br><span class="line">avrdude: writing output file <span class="string">"&lt;stdout&gt;"</span></span><br><span class="line">:01000000629D</span><br><span class="line">:00000001FF</span><br><span class="line"></span><br><span class="line">avrdude: safemode: lfuse reads as 62</span><br><span class="line">avrdude: safemode: hfuse reads as DF</span><br><span class="line">avrdude: safemode: efuse reads as FE</span><br><span class="line">avrdude: safemode: Fuses OK (E:FE, H:DF, L:62)</span><br><span class="line"></span><br><span class="line">avrdude <span class="keyword">done</span>.  Thank you.</span><br></pre></td></tr></table></figure>
</li>
<li><p>å†…å­˜çˆ†æ‰çš„é—®é¢˜,å®šä¹‰äº†ä¸€ä¸ª<code>1024</code>çš„æ•°ç»„.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">avr-size --format=avr --mcu=attiny85 main.elf</span><br><span class="line">AVR Memory Usage</span><br><span class="line">----------------</span><br><span class="line">Device: attiny85</span><br><span class="line"></span><br><span class="line">Program:    2454 bytes (30.0% Full)</span><br><span class="line">(.text + .data + .bootloader)</span><br><span class="line"></span><br><span class="line">Data:       1043 bytes (203.7% Full)</span><br><span class="line">(.data + .bss + .noinit)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="ATTiny85-Atmega328pæ—¶é’Ÿè®¡æ•°å™¨ç›¸å…³"><a href="#ATTiny85-Atmega328pæ—¶é’Ÿè®¡æ•°å™¨ç›¸å…³" class="headerlink" title="ATTiny85/Atmega328pæ—¶é’Ÿè®¡æ•°å™¨ç›¸å…³"></a><code>ATTiny85/Atmega328p</code>æ—¶é’Ÿè®¡æ•°å™¨ç›¸å…³</h2><ul>
<li>Links:<ul>
<li><a href="https://www.arduinoslovakia.eu/application/timer-calculator" target="_blank" rel="noopener">AVR Timer Interrupts Calculator</a></li>
<li><a href="https://maxembedded.wordpress.com/2011/06/22/introduction-to-avr-timers/" target="_blank" rel="noopener">Introduction to AVR Timers</a></li>
<li><a href="https://www.gadgetronicx.com/attiny85-timer-tutorial-generating-time-delay-interrupts/" target="_blank" rel="noopener">ATtiny85 timer tutorial: generating time delay using Interrupts</a></li>
<li><a href="https://www.randseq.org/2017/02/attiny85-timer-programming-using-timer1.html" target="_blank" rel="noopener">Attiny85 timer programming using Timer1 </a></li>
<li><a href="http://www.technoblogy.com/show?1ZIY" target="_blank" rel="noopener">ATtiny85 20MHz Internal Clock</a></li>
<li><a href="https://exploreembedded.com/wiki/NEC_IR_Remote_Control_Interface_with_8051" target="_blank" rel="noopener">NEC IR Remote Control Interface with 8051</a></li>
</ul>
</li>
</ul>
<h3 id="8ä½å®šæ—¶å™¨-timer0"><a href="#8ä½å®šæ—¶å™¨-timer0" class="headerlink" title="8ä½å®šæ—¶å™¨(timer0)"></a>8ä½å®šæ—¶å™¨(timer0)</h3><ul>
<li>å…ˆç¡®è®¤æ‰‹ä¸Šçš„<code>ATtiny85</code>çš„æ—¶é’Ÿé¢‘æ˜¯å¦åœ¨è¿è¡Œåœ¨<code>8MHz</code>,å¯ä»¥é€šè¿‡è¯»å–å®ƒçš„<code>fuse</code>ä½æ¥åˆ¤å®š,è¿™é‡Œä½¿ç”¨çš„æ˜¯<code>-U lfuse:w:0xe2:m -U hfuse:w:0xdf:m -U efuse:w:0xff:m</code>.è¿™é‡Œæµ‹è¯•ç”¨çš„<code>fuse</code>é…ç½®å¦‚å›¾</li>
</ul>
<p><img src="/imgs/attiny85_fuse.png" alt="attiny85_fuse.png"></p>
<ul>
<li><code>ATTiny85</code>é»˜è®¤æ—¶é’Ÿé¢‘ç‡æ˜¯<code>8MHz</code>,è¡¨ç¤ºå®ƒå¯ä»¥æ¯ç§’è¿›è¡Œ<code>8000000</code>æ¬¡å‘¨æœŸå¼€å…³(é«˜ç”µå¹³,ä½ç”µå¹³),æ¯ä¸€ä¸ªå‘¨æœŸçš„æ—¶é—´æ®µ(time period)æ˜¯<code>1/8000000s</code>ä¹Ÿå°±æ˜¯<code>0.000000125s</code>ï¼Œä¹Ÿå°±æ˜¯<code>125ns</code>,è€Œä¸€ä¸ª16ä½çš„å®šæ—¶å™¨(0-65535),åœ¨æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸåŠ ä¸€ï¼Œä»0åˆ°ä¸Š<code>65536</code>ä¸Šæº¢åªéœ€è¦<code>8.192ms</code>,8ä½çš„å®šæ—¶å™¨åªéœ€è¦<code>0.032ms</code>å°±ä¸Šæº¢äº†ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦æ›´é•¿æ—¶é—´çš„å®šæ—¶é—´éš”ï¼Œé‚£ä¹ˆå°±éœ€è¦é¢„åˆ†é¢‘å™¨å¯¹æ—¶é’Ÿè¿›è¡Œåˆ†é¢‘å¤„ç†,æ ¹æ®èŠ¯ç‰‡æ‰‹å†Œ<code>14.9.2 TCCR0B - Timer/Counter Control Register B</code>æè¿°ï¼Œé€šè¿‡è®¾ç½®<code>TCCRB0B</code>å¯„å­˜å™¨çš„<code>Bit2:0</code>ä½ï¼Œå¯ä»¥è¿›å¦‚ä¸‹é¢„åˆ†é¢‘</li>
</ul>
<table>
<thead>
<tr>
<th>CS02</th>
<th>CS01</th>
<th>CS00</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
<td>No clock source (Timer/Counter stopped)</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td>1</td>
<td>clk I/O /(no prescaling)</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0</td>
<td>clk I/O /8 (from prescaler)</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
<td>clk I/O /64 (from prescaler)</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
<td>clk I/O /256 (from prescaler)</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1</td>
<td>clk I/O /1024 (from prescaler)</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>0</td>
<td>External clock source on T0 pin. Clock on falling edge.</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
<td>External clock source on T0 pin. Clock on rising edge.</td>
</tr>
</tbody>
</table>
<ul>
<li>ä¸‹é¢è¿™ä¸ªç¨‹åºä½¿ç”¨8ä½å®šæ—¶å™¨æ¥å»¶æ—¶1ç§’ï¼Œæ¯ç§’ç¿»è½¬ä¸€æ¬¡çŠ¶æ€çš„<code>blink</code>ç¤ºä¾‹ã€‚<code>ATtiny85</code>é»˜è®¤æ˜¯<code>8MHz</code>,æ¯ä¸ªå‘¨æœŸæ˜¯<code>1/8MHz = 0.125us = 125ns</code>,æŒ‰<code>1024</code>é¢„é¢‘åå¾—åˆ°<code>7812.5Hz</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®šæ—¶å™¨æ¯éš”<code>7812.5Hz</code>åŠ 1ï¼Œæ¢ç®—æˆæ—¶é—´æ˜¯<code>1/7812.5 = 0.000128s</code>,8ä½å®šæ—¶å™¨åªèƒ½è®¡æ•°åˆ°<code>0.000128s * 255 = 0.032639999999999995</code>ã€‚</li>
<li><p>è®¾å®š<code>T/C0</code>çš„å·¥ä½œçŠ¶æ€ä¸º<code>CTC</code>æ¨¡å¼ï¼Œå¼€å¯<code>T/C0</code>è¾“å‡ºæ¯”è¾ƒåŒ¹é…ä¸­æ–­ä½¿èƒ½ä½ï¼Œä½¿ç”¨<code>OCR0A</code>æ¯”è¾ƒå¯„å­˜å™¨ä¿å­˜æ•°å€¼åšæ¯”è¾ƒã€‚è¿™é‡Œè®¾ç½®<code>OCR0A=250</code>,å½“<code>TCNT0</code>çš„å€¼è¾¾åˆ°<code>250</code>åå°±ä¼šäº§ç”Ÿæ¯”è¾ƒä¸­æ–­(250 &lt; 255&gt;).ä¸­æ–­<code>32</code>æ¬¡åï¼Œä¹Ÿæ˜¯å°±çº¦ç­‰äº1ç§’é’Ÿï¼Œå¹¶ä¸”å¯¹<code>PB1</code>çš„çŠ¶æ€è¿›è¡Œç¿»è½¬ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">~$ cat timer0.c</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;avr/io.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;avr/interrupt.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> intr_count = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setupTimer0</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  cli();</span><br><span class="line">  <span class="comment">// Clear registers</span></span><br><span class="line">  TCCR0A = <span class="number">0</span>;</span><br><span class="line">  TCCR0B = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 7812.5 Hz (8000000/((0+1)*1024))</span></span><br><span class="line">  OCR0A = <span class="number">250</span>; <span class="comment">//  0.000128s * 250 = 32ms</span></span><br><span class="line">  <span class="comment">// CTC æ¯”è¾ƒåŒ¹é…æ—¶æ¸…é›¶å®šæ—¶å™¨æ¨¡å¼</span></span><br><span class="line">  TCCR0A |= (<span class="number">1</span> &lt;&lt; WGM01);</span><br><span class="line">  <span class="comment">// Prescaler 1024</span></span><br><span class="line">  TCCR0B |= (<span class="number">1</span> &lt;&lt; CS02) | (<span class="number">1</span> &lt;&lt; CS00);</span><br><span class="line">  <span class="comment">// Output Compare Match A Interrupt Enable</span></span><br><span class="line">  TIMSK |= (<span class="number">1</span> &lt;&lt; OCIE0A);</span><br><span class="line">  sei(); <span class="comment">//enabling global interrupt, or  SREG |= 0x80</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ISR(TIMER0_COMPA_vect) &#123;</span><br><span class="line">  <span class="keyword">if</span>(intr_count == <span class="number">31</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    intr_count = <span class="number">0</span>;</span><br><span class="line">    PORTB^=(<span class="number">1</span>&lt;&lt;PB1); <span class="comment">//toggling the LED</span></span><br><span class="line">  &#125; <span class="keyword">else</span> intr_count++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  DDRB = <span class="number">0b00000010</span>; <span class="comment">// enable PB1</span></span><br><span class="line">  setupTimer0();</span><br><span class="line">  <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">  &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>ATtiny85</code>çš„<code>timer1</code>ä¹Ÿæ˜¯ä¸€ä¸ª<code>8bit</code>å®šæ—¶å™¨,ä½†æ˜¯æ”¯æŒæœ€å¤§<code>14-bit(MAX=16384)</code>çš„é¢„åˆ†é¢‘,ä¸‹é¢æ˜¯ä¸€ä¸ªæµ‹è¯•ã€‚è®¾ç½®æ¯”è¾ƒå¯„å­˜å™¨çš„å€¼ä¸º<code>248</code>ï¼Œä¸­æ–­ä¸¤æ¬¡é€»è¾‘é‡‡æ ·å¾—åˆ°<code>1.006s</code>çš„æ–¹æ³¢ã€‚<code>1/488.28125 = 0.002048s</code>,ä¹Ÿç­‰äº<code>0.000000125s * 16384 = 0.002048s</code>.</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">~$ cat timer1.c</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> intr_count = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setupTimer1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  noInterrupts();</span><br><span class="line">  <span class="comment">// Clear registers</span></span><br><span class="line">  TCNT1 = <span class="number">0</span>;</span><br><span class="line">  TCCR1 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 488.28125 Hz (8000000/((0+1)*16384))</span></span><br><span class="line">  OCR1C = <span class="number">248</span>;</span><br><span class="line">  <span class="comment">// interrupt COMPA</span></span><br><span class="line">  OCR1A = OCR1C;</span><br><span class="line">  <span class="comment">// CTC</span></span><br><span class="line">  TCCR1 |= (<span class="number">1</span> &lt;&lt; CTC1);</span><br><span class="line">  <span class="comment">// Prescaler 16384</span></span><br><span class="line">  TCCR1 |= (<span class="number">1</span> &lt;&lt; CS13) | (<span class="number">1</span> &lt;&lt; CS12) | (<span class="number">1</span> &lt;&lt; CS11) | (<span class="number">1</span> &lt;&lt; CS10);</span><br><span class="line">  <span class="comment">// Output Compare Match A Interrupt Enable</span></span><br><span class="line">  TIMSK |= (<span class="number">1</span> &lt;&lt; OCIE1A);</span><br><span class="line">  sei();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  DDRB = <span class="number">0b00000010</span>; <span class="comment">// enable PB1</span></span><br><span class="line">  setupTimer0();</span><br><span class="line">  <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">  &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ISR(TIMER0_COMPA_vect) &#123;</span><br><span class="line">  <span class="keyword">if</span>(intr_count == <span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    intr_count = <span class="number">0</span>;</span><br><span class="line">    PORTB^=(<span class="number">1</span>&lt;&lt;PB1); <span class="comment">//toggling the LED</span></span><br><span class="line">  &#125; <span class="keyword">else</span> intr_count++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="16ä½å®šæ—¶å™¨-timer1"><a href="#16ä½å®šæ—¶å™¨-timer1" class="headerlink" title="16ä½å®šæ—¶å™¨(timer1)"></a>16ä½å®šæ—¶å™¨(timer1)</h3><ul>
<li>ä¸‹é¢è¿™ä¸ªç¨‹åºä½¿ç”¨<code>ATmega328p</code>çš„16ä½å®šæ—¶å™¨1æ¥å»¶æ—¶1ç§’ï¼Œ<code>ATmega328p</code>é»˜è®¤æ˜¯<code>16MHz</code>,æ¯ä¸ªå‘¨æœŸæ˜¯<code>1/16MHz = 0.0625us</code>,æŠŠå®ƒ<code>1024</code>çš„é¢„åˆ†é¢‘åå¾—åˆ°<code>15625Hz</code>,è¿™é‡Œçš„è®¾ç½®ä¸ä¸Šé¢<code>ATtiny85</code>é›·åŒ,åªæ˜¯è¿™é‡Œä½¿ç”¨çš„æ˜¯16ä½å®šæ—¶å™¨(0-65535), ä¸‹é¢æŠŠæ¯”è¾ƒå™¨è®¾ç½®æˆ<code>15640</code>é€šè¿‡é€»è¾‘é‡‡æ ·å¾—åˆ°ä¸€ä¸ª1sçš„æ–¹æ³¢,è€Œä½¿ç”¨<code>15625</code>å¾—åˆ°æ˜¯<code>0.9993s</code>çš„æ–¹æ³¢ã€‚</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">~$ cat timer1.ino</span><br><span class="line"><span class="comment">// AVR Timer CTC Interrupts Calculator</span></span><br><span class="line"><span class="comment">// v. 8</span></span><br><span class="line"><span class="comment">// http://www.arduinoslovakia.eu/application/timer-calculator</span></span><br><span class="line"><span class="comment">// Microcontroller: ATmega328P</span></span><br><span class="line"><span class="comment">// Created: 2022-04-27T14:02:45.452Z</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ledPin 13</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setupTimer1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  noInterrupts();</span><br><span class="line">  <span class="comment">// Clear registers</span></span><br><span class="line">  TCCR1A = <span class="number">0</span>;</span><br><span class="line">  TCCR1B = <span class="number">0</span>;</span><br><span class="line">  TCNT1 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 15625 Hz (16000000/((0+1)*1024))</span></span><br><span class="line">  OCR1A = <span class="number">15640</span>;</span><br><span class="line">  <span class="comment">// CTC</span></span><br><span class="line">  TCCR1B |= (<span class="number">1</span> &lt;&lt; WGM12);</span><br><span class="line">  <span class="comment">// Prescaler 1024</span></span><br><span class="line">  TCCR1B |= (<span class="number">1</span> &lt;&lt; CS12) | (<span class="number">1</span> &lt;&lt; CS10);</span><br><span class="line">  <span class="comment">// Output Compare Match A Interrupt Enable</span></span><br><span class="line">  TIMSK1 |= (<span class="number">1</span> &lt;&lt; OCIE1A);</span><br><span class="line">  interrupts();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  pinMode(ledPin, OUTPUT);</span><br><span class="line">  setupTimer1();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ISR(TIMER1_COMPA_vect) &#123;</span><br><span class="line">  digitalWrite(ledPin, digitalRead(ledPin) ^ <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="ATmega8-16PU"><a href="#ATmega8-16PU" class="headerlink" title="ATmega8-16PU"></a>ATmega8-16PU</h1><ul>
<li><a href="https://create.arduino.cc/projecthub/hami/programming-atmega8-using-arduino-ide-90c2ad" target="_blank" rel="noopener">Programming ATmega8 Using Arduino IDE</a></li>
<li><a href="https://github.com/chiefdome/atmega8-16PU" target="_blank" rel="noopener">ATMEGA8-16PU</a></li>
<li><a href="https://www.micahcarrick.com/getting-started.html" target="_blank" rel="noopener">AVR Tutorial - Getting Started: Blinking an LED</a></li>
</ul>
<ul>
<li>ä¸‹é¢æ˜¯ä½¿ç”¨ä¸€å—<code>ATmega8-16PU</code>ä¸ä¸€å—é¢åŒ…æ¿ï¼Œæ­çš„ç®€å•æµ‹è¯•</li>
</ul>
<h2 id="æ·»åŠ Arduino-IDEæ”¯æŒ"><a href="#æ·»åŠ Arduino-IDEæ”¯æŒ" class="headerlink" title="æ·»åŠ Arduino IDEæ”¯æŒ"></a>æ·»åŠ <code>Arduino IDE</code>æ”¯æŒ</h2><ul>
<li><p>open <code>File</code> menu, click on <code>Preferences</code>.Now in <code>Additional Boards Manger URLs</code>, enter the following URL:<a href="https://mcudude.github.io/MiniCore/package_MCUdude_MiniCore_index.json" target="_blank" rel="noopener">https://mcudude.github.io/MiniCore/package_MCUdude_MiniCore_index.json</a></p>
</li>
<li><p>Go to Tools menu and then select <code>Board &gt; Boards Manager</code>,In Boards Manager window, search for <code>MiniCore</code> and then install the latest version.</p>
</li>
</ul>
<h3 id="ATmega8-16puè¿æ¥UM232H"><a href="#ATmega8-16puè¿æ¥UM232H" class="headerlink" title="ATmega8-16puè¿æ¥UM232H"></a><code>ATmega8-16pu</code>è¿æ¥<code>UM232H</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> UM232H              ATmega8-16pu       arduino pin out</span><br><span class="line">AD0 (CK)  &lt;-------&gt;  Pin19 PB5 (SCK)   digital pin 13</span><br><span class="line">AD1 (DO)  &lt;-------&gt;  Pin17 PB3 (MOSI)  digital pin 11</span><br><span class="line">AD2 (DI)  &lt;-------&gt;  Pin18 PB4 (MISO)  digital pin 12</span><br><span class="line">AD3 (CS)  &lt;-------&gt;  Pin1  PC6 (RESET)</span><br><span class="line">  GND     &lt;-------&gt;  Pin8  GND</span><br><span class="line">  +5v     &lt;-------&gt;  Pin7  VCC</span><br></pre></td></tr></table></figure>
<h2 id="è¯»å†™fuse"><a href="#è¯»å†™fuse" class="headerlink" title="è¯»å†™fuse"></a>è¯»å†™<code>fuse</code></h2><ul>
<li><p>ä¸‹é¢æ˜¯è¯»å–å®ƒçš„<code>fuse</code>è®¾ç½®ã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">~$ avrdude -c UM232H -P /dev/ttyUSB1 -b 19200 -p m8  -U lfuse:r:-:i -v</span><br><span class="line"></span><br><span class="line">avrdude: Version 6.3-20171130</span><br><span class="line">         Copyright (c) 2000-2005 Brian Dean, http://www.bdmicro.com/</span><br><span class="line">         Copyright (c) 2007-2014 Joerg Wunsch</span><br><span class="line"></span><br><span class="line">         System wide configuration file is <span class="string">"/etc/avrdude.conf"</span></span><br><span class="line">         User configuration file is <span class="string">"/home/michael/.avrduderc"</span></span><br><span class="line">         User configuration file does not exist or is not a regular file, skipping</span><br><span class="line"></span><br><span class="line">         Using Port                    : /dev/ttyUSB1</span><br><span class="line">         Using Programmer              : UM232H</span><br><span class="line">         Overriding Baud Rate          : 19200</span><br><span class="line">         AVR Part                      : ATmega8</span><br><span class="line">         Chip Erase delay              : 10000 us</span><br><span class="line">         PAGEL                         : PD7</span><br><span class="line">         BS2                           : PC2</span><br><span class="line">         RESET disposition             : dedicated</span><br><span class="line">         RETRY pulse                   : SCK</span><br><span class="line">         serial program mode           : yes</span><br><span class="line">         parallel program mode         : yes</span><br><span class="line">         Timeout                       : 200</span><br><span class="line">         StabDelay                     : 100</span><br><span class="line">         CmdexeDelay                   : 25</span><br><span class="line">         SyncLoops                     : 32</span><br><span class="line">         ByteDelay                     : 0</span><br><span class="line">         PollIndex                     : 3</span><br><span class="line">         PollValue                     : 0x53</span><br><span class="line">         Memory Detail                 :</span><br><span class="line"></span><br><span class="line">                                  Block Poll               Page                       Polled</span><br><span class="line">           Memory Type Mode Delay Size  Indx Paged  Size   Size <span class="comment">#Pages MinW  MaxW   ReadBack</span></span><br><span class="line">           ----------- ---- ----- ----- ---- ------ ------ ---- ------ ----- ----- ---------</span><br><span class="line">           eeprom         4    20   128    0 no        512    4      0  9000  9000 0xff 0xff</span><br><span class="line">           flash         33    10    64    0 yes      8192   64    128  4500  4500 0xff 0x00</span><br><span class="line">           lfuse          0     0     0    0 no          1    0      0  2000  2000 0x00 0x00</span><br><span class="line">           hfuse          0     0     0    0 no          1    0      0  2000  2000 0x00 0x00</span><br><span class="line">           lock           0     0     0    0 no          1    0      0  2000  2000 0x00 0x00</span><br><span class="line">           calibration    0     0     0    0 no          4    0      0     0     0 0x00 0x00</span><br><span class="line">           signature      0     0     0    0 no          3    0      0     0     0 0x00 0x00</span><br><span class="line"></span><br><span class="line">         Programmer Type : avrftdi</span><br><span class="line">         Description     : FT232H based module from FTDI and Glyn.com.au</span><br><span class="line"></span><br><span class="line">avrdude: AVR device initialized and ready to accept instructions</span><br><span class="line"></span><br><span class="line">Reading | <span class="comment">################################################## | 100% 0.01s</span></span><br><span class="line"></span><br><span class="line">avrdude: Device signature = 0x1e9307 (probably m8)</span><br><span class="line">avrdude: safemode: lfuse reads as 62</span><br><span class="line">avrdude: safemode: hfuse reads as DF</span><br><span class="line">avrdude: reading lfuse memory:</span><br><span class="line"></span><br><span class="line">Reading | <span class="comment">################################################## | 100% 0.00s</span></span><br><span class="line"></span><br><span class="line">avrdude: writing output file <span class="string">"&lt;stdout&gt;"</span></span><br><span class="line">:01000000629D</span><br><span class="line">:00000001FF</span><br><span class="line"></span><br><span class="line">avrdude: safemode: lfuse reads as 62</span><br><span class="line">avrdude: safemode: hfuse reads as DF</span><br><span class="line">avrdude: safemode: Fuses OK (E:FF, H:DF, L:62)</span><br><span class="line"></span><br><span class="line">avrdude <span class="keyword">done</span>.  Thank you.</span><br></pre></td></tr></table></figure>
</li>
<li><p>å†™å…¥<code>fuse</code>çš„é…ç½®ï¼Œè¿™é‡Œæ˜¯é€šè¿‡<a href="https://www.engbedded.com/fusecalc/" target="_blank" rel="noopener">AVRÂ® Fuse Calculator</a>é…ç½®è®¡ç®—å‡ºæ¥çš„ã€‚</p>
</li>
</ul>
<p><img src="/imgs/atmega8_16pu_fuse.png" alt="atmega8_16pu_fuse.png"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">~<span class="variable">$avrdude</span> -c UM232H -P /dev/ttyUSB1 -b 19200 -p m8   -U lfuse:w:0xd4:m -U hfuse:w:0xc9:m</span><br><span class="line"></span><br><span class="line">avrdude: AVR device initialized and ready to accept instructions</span><br><span class="line"></span><br><span class="line">Reading | <span class="comment">################################################## | 100% 0.01s</span></span><br><span class="line"></span><br><span class="line">avrdude: Device signature = 0x1e9307 (probably m8)</span><br><span class="line">avrdude: reading input file <span class="string">"0xd4"</span></span><br><span class="line">avrdude: writing lfuse (1 bytes):</span><br><span class="line"></span><br><span class="line">Writing | <span class="comment">################################################## | 100% 0.01s</span></span><br><span class="line"></span><br><span class="line">avrdude: 1 bytes of lfuse written</span><br><span class="line">avrdude: verifying lfuse memory against 0xd4:</span><br><span class="line">avrdude: load data lfuse data from input file 0xd4:</span><br><span class="line">avrdude: input file 0xd4 contains 1 bytes</span><br><span class="line">avrdude: reading on-chip lfuse data:</span><br><span class="line"></span><br><span class="line">Reading | <span class="comment">################################################## | 100% 0.00s</span></span><br><span class="line"></span><br><span class="line">avrdude: verifying ...</span><br><span class="line">avrdude: 1 bytes of lfuse verified</span><br><span class="line">avrdude: reading input file <span class="string">"0xc9"</span></span><br><span class="line">avrdude: writing hfuse (1 bytes):</span><br><span class="line"></span><br><span class="line">Writing | <span class="comment">################################################## | 100% 0.00s</span></span><br><span class="line"></span><br><span class="line">avrdude: 1 bytes of hfuse written</span><br><span class="line">avrdude: verifying hfuse memory against 0xc9:</span><br><span class="line">avrdude: load data hfuse data from input file 0xc9:</span><br><span class="line">avrdude: input file 0xc9 contains 1 bytes</span><br><span class="line">avrdude: reading on-chip hfuse data:</span><br><span class="line"></span><br><span class="line">Reading | <span class="comment">################################################## | 100% 0.00s</span></span><br><span class="line"></span><br><span class="line">avrdude: verifying ...</span><br><span class="line">avrdude: 1 bytes of hfuse verified</span><br><span class="line"></span><br><span class="line">avrdude: safemode: Fuses OK (E:FF, H:C9, L:D4)</span><br><span class="line"></span><br><span class="line">avrdude <span class="keyword">done</span>.  Thank you.</span><br></pre></td></tr></table></figure>
<h2 id="é©±åŠ¨NRF24l01"><a href="#é©±åŠ¨NRF24l01" class="headerlink" title="é©±åŠ¨NRF24l01"></a>é©±åŠ¨<code>NRF24l01</code></h2><ul>
<li><a href="https://nerdralph.blogspot.com/2014/01/nrf24l01-control-with-3-attiny85-pins.html" target="_blank" rel="noopener">nrf24l01+ control with 3 ATtiny85 pins</a></li>
<li><a href="https://nerdralph.blogspot.com/2015/05/nrf24l01-control-with-2-mcu-pins-using.html" target="_blank" rel="noopener">nRF24l01 control with 2 MCU pins using time-division duplexed SPI</a></li>
<li><a href="https://nerdralph.blogspot.com/2015/03/fastest-avr-software-spi-in-west.html" target="_blank" rel="noopener">Fastest AVR software SPI in the West</a></li>
<li><a href="https://github.com/nerdralph/nerdralph" target="_blank" rel="noopener">nerdralph</a></li>
<li><a href="https://www.instructables.com/ATtiny8485-SPI-Interface-Pin-Reuse/" target="_blank" rel="noopener">ATtiny84/85 SPI Interface Pin Reuse</a></li>
<li><a href="https://www.gadgetronicx.com/attiny85-spi-protocol-master-slave-mode-tutorial/" target="_blank" rel="noopener">ATtiny85 SPI protocol â€“ Master and Slave mode tutorial</a></li>
</ul>
<h2 id="é©±åŠ¨SSD1306"><a href="#é©±åŠ¨SSD1306" class="headerlink" title="é©±åŠ¨SSD1306"></a>é©±åŠ¨<code>SSD1306</code></h2><ul>
<li><a href="http://www.technoblogy.com/show?23OS" target="_blank" rel="noopener">Tiny Graphics Library</a></li>
<li><a href="http://www.technoblogy.com/list?1PM9" target="_blank" rel="noopener">ATtiny85 Graphics Display</a></li>
<li><a href="https://www.studiopieters.nl/attiny85-oled-i2c/" target="_blank" rel="noopener">ATTiny85 â€“ OLED (I2C)</a></li>
<li><a href="https://github.com/trongphuongpro/ATtiny-USI-I2C-Master" target="_blank" rel="noopener">ATtiny-USI-I2C-Master</a></li>
<li><a href="https://github.com/technoblogy/tiny-i2c" target="_blank" rel="noopener">TinyI2C Library</a></li>
<li><a href="https://github.com/lexus2k/ssd1306" target="_blank" rel="noopener">lexus2k/ssd1306</a></li>
<li><a href="https://electronics.stackexchange.com/questions/367105/send-a-single-pulse-low-high-pulse-then-stay-high" target="_blank" rel="noopener">Send a single pulse low/high pulse then stay high</a></li>
<li><a href="https://exploreembedded.com/wiki/OLED_Interface_With_8051" target="_blank" rel="noopener">OLED_Interface_With_8051</a></li>
<li><a href="https://iotexpert.com/debugging-ssd1306-display-problems/" target="_blank" rel="noopener">Debugging SSD1306 Display Problems</a></li>
</ul>
<h1 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h1><h2 id="GDB"><a href="#GDB" class="headerlink" title="GDB"></a>GDB</h2><ul>
<li><a href="https://blog.oddbit.com/post/2019-01-22-debugging-attiny-code-pt-2/" target="_blank" rel="noopener">Debugging attiny85 code, part 2: Automating GDB with scripts</a></li>
<li><a href="https://github.com/buserror/simavr" target="_blank" rel="noopener">buserror/simavr</a></li>
</ul>
<h2 id="é€»è¾‘åˆ†æä»ªçš„é—®é¢˜"><a href="#é€»è¾‘åˆ†æä»ªçš„é—®é¢˜" class="headerlink" title="é€»è¾‘åˆ†æä»ªçš„é—®é¢˜"></a>é€»è¾‘åˆ†æä»ªçš„é—®é¢˜</h2><ul>
<li><a href="https://sigrok.org/wiki/Fx2lafw" target="_blank" rel="noopener">Fx2lafw</a></li>
<li><a href="https://sigrok.org/wiki/PulseView" target="_blank" rel="noopener">PulseView</a></li>
<li><a href="https://github.com/pico-coder/sigrok-pico" target="_blank" rel="noopener">Use a raspberry pi pico (rp2040) as a logic </a></li>
<li>è¿æ¥é€»è¾‘åˆ†æä»ªæ—¶,ä¸çŸ¥ä¸ºä½•,æœ‰æ—¶ä¼šå‡ºç°å¹²æ‰°,è®©ç¨‹åºè·‘é£,è€Œæ–­å¼€åè¿è¡Œçš„å¾ˆæ­£å¸¸.</li>
</ul>
<h3 id="å­—ç¬¦ç›¸å…³"><a href="#å­—ç¬¦ç›¸å…³" class="headerlink" title="å­—ç¬¦ç›¸å…³"></a>å­—ç¬¦ç›¸å…³</h3><ul>
<li><a href="https://lvgl.io/tools/fontconverter" target="_blank" rel="noopener">fontconverter</a></li>
<li><a href="https://jared.geek.nz/2014/jan/custom-fonts-for-microcontrollers" target="_blank" rel="noopener">Custom Fonts for Microcontrollers</a></li>
<li><a href="https://github.com/vladimirgamalyan/fontbm" target="_blank" rel="noopener">fontbm</a></li>
<li><a href="https://m0agx.eu/2018/02/10/making-graphics-and-fonts-for-embedded-systems/" target="_blank" rel="noopener">Making graphics and fonts for embedded systems</a></li>
<li><a href="https://github.com/arturlangner/fontbuilder" target="_blank" rel="noopener">fontbuilder</a></li>
<li><a href="https://mil.ufl.edu/3744/docs/lcdmanual/characterset.html" target="_blank" rel="noopener">LCD Character Set</a><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">CONFIG:    0b</span><br><span class="line">EN_AA:     3e</span><br><span class="line">EN_RXADDR: 01</span><br><span class="line">SETUP_AW:  02</span><br><span class="line">SETUP_RETR:30</span><br><span class="line">RF_CH:     02</span><br><span class="line">RF_SETUP:  05</span><br><span class="line">STATUS:    0e</span><br><span class="line">OBS_TX:    00</span><br><span class="line">TX_ADDR:   71917d6b</span><br><span class="line">CD:        00</span><br><span class="line">RX_PW_P0:  20</span><br><span class="line">RX_PW_P1:  00</span><br><span class="line">RX_PW_P2:  00</span><br><span class="line">RX_PW_P3:  00</span><br><span class="line">RX_PW_P4:  00</span><br><span class="line">RX_PW_P5:  00</span><br><span class="line">FIFO_STAT: 11</span><br><span class="line">DYNPD:     00</span><br><span class="line">FEATURE:   05</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="AVR-GCCæ±‡ç¼–ç›¸å…³"><a href="#AVR-GCCæ±‡ç¼–ç›¸å…³" class="headerlink" title="AVR-GCCæ±‡ç¼–ç›¸å…³"></a>AVR-GCCæ±‡ç¼–ç›¸å…³</h1><ul>
<li><a href="https://hackaday.io/project/1475-avr-gcc-assembler-techniques/details" target="_blank" rel="noopener">AVR GCC assembler techniques</a></li>
<li><a href="https://www.nongnu.org/avr-libc/user-manual/inline_asm.html" target="_blank" rel="noopener">Inline Assembler Cookbook</a></li>
<li><a href="http://www.cs.northampton.ac.uk/~yinghui/csy1014/cs1_tut_16.htm" target="_blank" rel="noopener">Basic Assembly Language programming</a></li>
<li><a href="http://www.avr-asm-tutorial.net/avr_en/beginner/index.html" target="_blank" rel="noopener">Introduction to AVR assembler programming for beginners</a></li>
<li><a href="http://www.avr-asm-tutorial.net/avr_en/beginner/PDETAIL.html#MCUCR" target="_blank" rel="noopener">MCUCR Detial</a></li>
<li><a href="https://github.com/aagontuk/cheatsheets/blob/master/AVR_assembly_programming.md" target="_blank" rel="noopener"></a></li>
</ul>
<h2 id="GCC-asm-Statement"><a href="#GCC-asm-Statement" class="headerlink" title="GCC asm Statement"></a>GCC asm Statement</h2><ul>
<li>Letâ€™s start with a simple example of reading a value from port D:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asm(<span class="string">"in %0, %1"</span> : <span class="string">"=r"</span> (value) : <span class="string">"I"</span> (_SFR_IO_ADDR(PORTD)) );</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Each<code>asm</code>statement is devided by colons into (up to) four parts:</p>
<ol>
<li>The assembler instructions, defined as a single string constant: <code>&quot;in %0, %1&quot;</code></li>
<li>A list of output operands, separated by commas. Our example uses just one: <code>&quot;=r&quot; (value)</code></li>
<li>A comma separated list of input operands. Again our example uses one operand only:<br><code>&quot;I&quot; (_SFR_IO_ADDR(PORTD))</code></li>
<li>Clobbered registers, left empty in our example.</li>
</ol>
<ul>
<li>You can write assembler instructions in much the same way as you would write assembler programs. However, registers andconstants are used in a different way if they refer to expressions of your C program. The connection between registersand C operands is specified in the second and third part of the asm instruction, the list of input and output operands,respectively. The general form is</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asm(code : output operand list : input operand list [: clobber list]);</span><br></pre></td></tr></table></figure>
<ul>
<li>In the code section, operands are referenced by a percent sign followed by a single digit. <code>%0</code> refers to the first <code>%1</code> tothe second operand and so forth. From the above example:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%0 refers to <span class="string">"=r"</span> (value) and</span><br><span class="line">%1 refers to <span class="string">"I"</span> (_SFR_IO_ADDR(PORTD)).</span><br></pre></td></tr></table></figure>
<h3 id="Input-and-Output-Operands"><a href="#Input-and-Output-Operands" class="headerlink" title="Input and Output Operands"></a>Input and Output Operands</h3><ul>
<li>Each input and output operand is described by a constraint string followed by a C expression in parantheses. AVR-GCC 3.3knows the following constraint characters:</li>
<li>Note<ul>
<li>The most up-to-date and detailed information on contraints for the avr can be found in the gcc manual.</li>
<li>The <code>x</code> register is <code>r27:r26</code>, the <code>y</code> register is <code>r29:r28</code>, and the <code>z</code> register is <code>r31:r30</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Constraint</th>
<th>Used for</th>
<th>Range</th>
</tr>
</thead>
<tbody>
<tr>
<td>a</td>
<td>Simple upper registers</td>
<td>r16 to r23</td>
</tr>
<tr>
<td>b</td>
<td>Base pointer registers pairs</td>
<td>y, z</td>
</tr>
<tr>
<td>d</td>
<td>Upper register</td>
<td>r16 to r31</td>
</tr>
<tr>
<td>e</td>
<td>Pointer register pairs</td>
<td>x, y, z</td>
</tr>
<tr>
<td>q</td>
<td>Stack pointer register</td>
<td>SPH:SPL</td>
</tr>
<tr>
<td>r</td>
<td>Any register</td>
<td>r0 to r31</td>
</tr>
<tr>
<td>t</td>
<td>Temporary register</td>
<td>r0</td>
</tr>
<tr>
<td>w</td>
<td>Special upper register pairs</td>
<td>r24, r26, r28, r30</td>
</tr>
<tr>
<td>x</td>
<td>Pointer register pair X</td>
<td>x (r27:r26)</td>
</tr>
<tr>
<td>y</td>
<td>Pointer register pair Y</td>
<td>y (r29:r28)</td>
</tr>
<tr>
<td>z</td>
<td>Pointer register pair Z</td>
<td>z (r31:r30)</td>
</tr>
<tr>
<td>G</td>
<td>Floating point constant</td>
<td>0.0</td>
</tr>
<tr>
<td>I</td>
<td>6-bit positive integer constant</td>
<td>0 to 63</td>
</tr>
<tr>
<td>J</td>
<td>6-bit negative integer constant</td>
<td>-63 to 0</td>
</tr>
<tr>
<td>K</td>
<td>Integer constant</td>
<td>2</td>
</tr>
<tr>
<td>L</td>
<td>Integer constant</td>
<td>0</td>
</tr>
<tr>
<td>l</td>
<td>Lower registers</td>
<td>r0 to r15</td>
</tr>
<tr>
<td>M</td>
<td>8-bit integer constant</td>
<td>0 to 255</td>
</tr>
<tr>
<td>N</td>
<td>Integer constant</td>
<td>-1</td>
</tr>
<tr>
<td>O</td>
<td>Integer constant</td>
<td>8, 16, 24</td>
</tr>
<tr>
<td>P</td>
<td>Integer constant</td>
<td>1</td>
</tr>
<tr>
<td>Q</td>
<td>(GCC &gt;= 4.2.x) A memory address based on Y or Z pointer with displacementa.</td>
<td></td>
</tr>
<tr>
<td>R</td>
<td>(GCC &gt;= 4.3.x) Integer constant.</td>
<td>-6 to 5</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Mnemonic</th>
<th>Constraints</th>
<th>Mnemonic</th>
<th>Constraints</th>
</tr>
</thead>
<tbody>
<tr>
<td>adc</td>
<td>r,r</td>
<td>add</td>
<td>r,r</td>
</tr>
<tr>
<td>adiw</td>
<td>w,I</td>
<td>and</td>
<td>r,r</td>
</tr>
<tr>
<td>andi</td>
<td>d,M</td>
<td>asr</td>
<td>r</td>
</tr>
<tr>
<td>bclr</td>
<td>I</td>
<td>bld</td>
<td>r,I</td>
</tr>
<tr>
<td>brbc</td>
<td>I,label</td>
<td>brbs</td>
<td>I,label</td>
</tr>
<tr>
<td>bset</td>
<td>I</td>
<td>bst</td>
<td>r,I</td>
</tr>
<tr>
<td>cbi</td>
<td>I,I</td>
<td>cbr</td>
<td>d,I</td>
</tr>
<tr>
<td>com</td>
<td>r</td>
<td>cp</td>
<td>r,r</td>
</tr>
<tr>
<td>cpc</td>
<td>r,r</td>
<td>cpi</td>
<td>d,M</td>
</tr>
<tr>
<td>cpse</td>
<td>r,r</td>
<td>dec</td>
<td>r</td>
</tr>
<tr>
<td>elpm</td>
<td>t,z</td>
<td>eor</td>
<td>r,r</td>
</tr>
<tr>
<td>in</td>
<td>r,I</td>
<td>inc</td>
<td>r</td>
</tr>
<tr>
<td>ld</td>
<td>r,e</td>
<td>ldd</td>
<td>r,b</td>
</tr>
<tr>
<td>ldi</td>
<td>d,M</td>
<td>lds</td>
<td>r,label</td>
</tr>
<tr>
<td>lpm</td>
<td>t,z</td>
<td>lsl</td>
<td>r</td>
</tr>
<tr>
<td>lsr</td>
<td>r</td>
<td>mov</td>
<td>r,r</td>
</tr>
<tr>
<td>movw</td>
<td>r,r</td>
<td>mul</td>
<td>r,r</td>
</tr>
<tr>
<td>neg</td>
<td>r</td>
<td>or</td>
<td>r,r</td>
</tr>
<tr>
<td>ori</td>
<td>d,M</td>
<td>out</td>
<td>I,r</td>
</tr>
<tr>
<td>pop</td>
<td>r</td>
<td>push</td>
<td>r</td>
</tr>
<tr>
<td>rol</td>
<td>r</td>
<td>ror</td>
<td>r</td>
</tr>
<tr>
<td>sbc</td>
<td>r,r</td>
<td>sbci</td>
<td>d,M</td>
</tr>
<tr>
<td>sbi</td>
<td>I,I</td>
<td>sbic</td>
<td>I,I</td>
</tr>
<tr>
<td>sbiw</td>
<td>w,I</td>
<td>sbr</td>
<td>d,M</td>
</tr>
<tr>
<td>sbrc</td>
<td>r,I</td>
<td>sbrs</td>
<td>r,I</td>
</tr>
<tr>
<td>ser</td>
<td>d</td>
<td>st</td>
<td>e,r</td>
</tr>
<tr>
<td>std</td>
<td>b,r</td>
<td>sts</td>
<td>label,r</td>
</tr>
<tr>
<td>sub</td>
<td>r,r</td>
<td>subi</td>
<td>d,M</td>
</tr>
<tr>
<td>swap</td>
<td>r</td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li>Constraint characters may be prepended by a single constraint modifier. Contraints without a modifier specify read-only operands. Modifiers are:</li>
<li>Modifier     Specifies</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">= 	Write-only operand, usually used <span class="keyword">for</span> all output operands.</span><br><span class="line">+ 	Read-write operand</span><br><span class="line">&amp; 	Register should be used <span class="keyword">for</span> output only</span><br></pre></td></tr></table></figure>
<p><strong>comment</strong> In assembler programming, the term <code>clobbered registers</code> is used to denote any registers whose value may beoverwritten during the course of executing an instruction or procedure.</p>
<h1 id="è°¢è°¢æ”¯æŒ"><a href="#è°¢è°¢æ”¯æŒ" class="headerlink" title="è°¢è°¢æ”¯æŒ"></a>è°¢è°¢æ”¯æŒ</h1><ul>
<li>å¾®ä¿¡äºŒç»´ç :</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/13/DevOpsè¿ç»´å¼€å‘/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/13/DevOpsè¿ç»´å¼€å‘/" class="post-title-link" itemprop="url">DevOpsè¿ç»´å¼€å‘</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-12-13 11:26:41" itemprop="dateCreated datePublished" datetime="2020-12-13T11:26:41+08:00">2020-12-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-02-26 23:52:54" itemprop="dateModified" datetime="2022-02-26T23:52:54+08:00">2022-02-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Docker-Machine"><a href="#Docker-Machine" class="headerlink" title="Docker Machine"></a><code>Docker Machine</code></h1><ul>
<li>é“¾æ¥:<ul>
<li><a href="https://docs.docker.com/machine/install-machine/" target="_blank" rel="noopener">Install Docker Machine</a></li>
<li><a href="https://docs.docker.com/machine/" target="_blank" rel="noopener">Docker Machine</a></li>
<li><a href="https://github.com/docker/machine/" target="_blank" rel="noopener">Github Docker</a></li>
<li><a href="https://awesome-docker.netlify.com/" target="_blank" rel="noopener">Awesome-docker</a></li>
<li><a href="https://github.com/zealdocs/zeal" target="_blank" rel="noopener">zeal å„ç§æŠ€æœ¯ç¦»çº¿æ–‡æ¡£</a></li>
</ul>
</li>
</ul>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><ul>
<li><code>Docker Machine</code>æ˜¯<code>Docker</code>å®˜æ–¹ç¼–æ’ï¼ˆOrchestrationï¼‰é¡¹ç›®ä¹‹ä¸€,è´Ÿè´£åœ¨å¤šç§å¹³å°ä¸Šå¿«é€Ÿå®‰è£…<code>Docker</code>ç¯å¢ƒ<code>Docker Machine</code>é¡¹ç›®åŸºäº<code>Go</code>è¯­è¨€å®ç°,ç›®å‰åœ¨<code>Github</code>ä¸Šè¿›è¡Œç»´æŠ¤.ç”¨<code>Docker Machine</code>å¯ä»¥æ‰¹é‡å®‰è£…å’Œé…ç½®<code>docker host</code>,è¿™ä¸ª<code>host</code>å¯ä»¥æ˜¯æœ¬åœ°çš„è™šæ‹Ÿæœº,ç‰©ç†æœº,ä¹Ÿå¯ä»¥æ˜¯å…¬æœ‰äº‘ä¸­çš„äº‘ä¸»æœº.<code>Docker Machine</code>æ”¯æŒåœ¨ä¸åŒçš„ç¯å¢ƒä¸‹å®‰è£…é…ç½®<code>docker host</code>,åŒ…æ‹¬:<ul>
<li>(1) å¸¸è§„<code>Linux</code>æ“ä½œç³»ç»Ÿ.</li>
<li>(2) è™šæ‹ŸåŒ–å¹³å°â€”VirtualBox,VMWare,Hyper-V,OpenStack.</li>
<li>(3) å…¬æœ‰äº‘â€” <code>Amazon Web Services</code>,<code>Microsoft Azure</code>,<code>Google Compute Engine</code>,<code>Digital Ocean</code>ç­‰.</li>
</ul>
</li>
<li><code>Docker Machine</code>ä¸ºè¿™äº›ç¯å¢ƒèµ·äº†ä¸€ä¸ªç»Ÿä¸€çš„åå­—:<code>provider</code>.å¯¹äºæŸä¸ªç‰¹å®šçš„<code>provider</code>,<code>Docker Machine</code>ä½¿ç”¨ç›¸åº”çš„<code>driver</code>å®‰è£…å’Œé…ç½®<br><code>docker host</code>.</li>
</ul>
<h3 id="è„šæœ¬å®‰è£…"><a href="#è„šæœ¬å®‰è£…" class="headerlink" title="è„šæœ¬å®‰è£…"></a>è„šæœ¬å®‰è£…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ã€€å®‰è£…</span></span><br><span class="line">~$ base=https://github.com/docker/machine/releases/download/v0.16.0 &amp;&amp;</span><br><span class="line">  curl -L <span class="variable">$base</span>/docker-machine-$(uname -s)-$(uname -m) &gt;/tmp/docker-machine &amp;&amp;</span><br><span class="line">  sudo install /tmp/docker-machine /usr/<span class="built_in">local</span>/bin/docker-machine</span><br><span class="line"><span class="comment">#ã€€æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line">~$ docker-machine version</span><br><span class="line">docker-machine version 0.16.0, build 702c267f</span><br><span class="line"><span class="comment">#ã€€åˆ—å‡ºä¸»æœºåˆ—è¡¨</span></span><br><span class="line">~$ docker-machine ls</span><br><span class="line">NAME   ACTIVE   DRIVER   STATE   URL   SWARM   DOCKER   ERRORS</span><br></pre></td></tr></table></figure>
<h2 id="åˆ›å»ºMachine"><a href="#åˆ›å»ºMachine" class="headerlink" title="åˆ›å»ºMachine"></a>åˆ›å»º<code>Machine</code></h2><ul>
<li>ä¸‹é¢å‘½ä»¤å°±ä¼šåœ¨æœ¬æœºçš„<strong>VirtualBox</strong>é‡Œåˆ›å»ºä¸€ä¸ªåä¸º<code>default</code>çš„è™šæ‹Ÿæœº.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine  create -d virtualbox default</span><br><span class="line">Running pre-create checks...</span><br><span class="line">Creating machine...</span><br><span class="line">(default) Copying /home/lcy/.docker/machine/cache/boot2docker.iso to /home/lcy/.docker/machine/machines/default/boot2docker.iso...</span><br><span class="line">(default) Creating VirtualBox VM...</span><br><span class="line">(default) Creating SSH key...</span><br><span class="line">(default) Starting the VM...</span><br><span class="line">(default) Check network to re-create if needed...</span><br><span class="line">(default) Waiting for an IP...</span><br><span class="line">Waiting for machine to be running, this may take a few minutes...</span><br><span class="line">Detecting operating system of created instance...</span><br><span class="line">[...]</span><br><span class="line">Docker is up and running!</span><br><span class="line">To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker-machine env default</span><br><span class="line">~$ docker-machine create -d virtualbox manager1 &amp;&amp;</span><br><span class="line">&gt; docker-machine create -d virtualbox manager2 &amp;&amp;</span><br><span class="line">&gt; docker-machine create -d virtualbox worker1 &amp;&amp;</span><br><span class="line">&gt; docker-machine create -d virtualbox worker2</span><br><span class="line">~$ docker-machine ls</span><br><span class="line">NAME       ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER     ERRORS</span><br><span class="line">default    -        virtualbox   Running   tcp://192.168.99.100:2376           v18.09.1</span><br><span class="line">manager1   -        virtualbox   Running   tcp://192.168.99.101:2376           v18.09.1</span><br><span class="line">manager2   -        virtualbox   Running   tcp://192.168.99.102:2376           v18.09.1</span><br><span class="line">worker1    -        virtualbox   Running   tcp://192.168.99.103:2376           v18.09.1</span><br><span class="line">worker2    -        virtualbox   Running   tcp://192.168.99.104:2376           v18.09.1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Dockerç«¯çš„æ“ä½œ"><a href="#Dockerç«¯çš„æ“ä½œ" class="headerlink" title="Dockerç«¯çš„æ“ä½œ"></a><code>Docker</code>ç«¯çš„æ“ä½œ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æ›´æ–°worker1,worker2çš„dockeråˆ°æœ€æ–°ç‰ˆæœ¬,å¯ä»¥æŒ‡æ‰§è¡Œ.</span><br><span class="line">~$ docker-machine upgrade worker1 worker2</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸ºäº†æ”¯æŒ<code>ansible</code>ç®¡ç†æ“ä½œ,ä¸‹é¢å®‰è£…ä¸€äº›<code>python</code>ç¯å¢ƒç›¸å…³çš„è½¯ä»¶.<a href="https://dev.classmethod.jp/server-side/os/ansible-docker-connection-plugin/" target="_blank" rel="noopener">å‚è€ƒé“¾æ¥</a>.<code>tce</code>çš„å®‰è£…ç›®å½•æ˜¯<code>docker@manager1:/usr/local/tce.installed</code>,æ¯”å¦‚:è¦å…ˆåˆ é™¤<code>python</code>æ—§çš„å®‰è£…çš„å‘½ä»¤:<code>docker-machine ssh manager1 &quot;rm -rf /usr/local/tce.installed/python&quot;</code>,å†ç”¨ä¸‹é¢å‘½ä»¤é‡æ–°å®‰è£….è¿™é‡Œä½¿ç”¨çš„<code>bash</code>è„šæœ¬çš„<code>for</code>å¾ªç¯ä¸²è¡Œå¤„ç†,å¦‚æœè¦å¹¶è¡Œå¤„ç†,å¯ä»¥å‚è€ƒ<a href="https://www.gnu.org/software/parallel/man.html#EXAMPLE:-Use-a-table-as-input" target="_blank" rel="noopener">parallel</a>.</li>
</ul>
<h4 id="å®‰è£…pythonç¯å¢ƒåŒ…"><a href="#å®‰è£…pythonç¯å¢ƒåŒ…" class="headerlink" title="å®‰è£…pythonç¯å¢ƒåŒ…"></a>å®‰è£…<code>python</code>ç¯å¢ƒåŒ…</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$  for item in manager1 manager2 worker1 worker2; do docker-machine ssh $item &quot;tce-load -wi python &amp;&amp; curl https://bootstrap.pypa.io/get-pip.py | sudo python - &amp;&amp; sudo ln -s /usr/local/bin/python /usr/bin/python&quot;;done</span><br></pre></td></tr></table></figure>
<h4 id="Ansibleç®¡ç†è¿æ¥"><a href="#Ansibleç®¡ç†è¿æ¥" class="headerlink" title="Ansibleç®¡ç†è¿æ¥"></a><code>Ansible</code>ç®¡ç†è¿æ¥</h4><ul>
<li><p>åˆ›å»ºä¸»æœºæ–‡ä»¶,å› ä¸ºæ¯ä¸€ä¸ªä¸»æœºçš„ç§é’¥ä½ç½®ä¸åŒ.æ‰€ä»¥åœ¨<code>hosts.txt</code>ä¸­å…·ä½“æŒ‡å®šå¦‚ä¸‹.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~$ cat hosts.txt</span><br><span class="line">[swarm]</span><br><span class="line">192.168.99.100 ansible_ssh_private_key_file=/home/lcy/.docker/machine/machines/default/id_rsa ansible_python_interpreter=/usr/local/bin/python</span><br><span class="line">192.168.99.101 ansible_ssh_private_key_file=/home/lcy/.docker/machine/machines/manager1/id_rsa ansible_python_interpreter=/usr/local/bin/python</span><br><span class="line">192.168.99.102 ansible_ssh_private_key_file=/home/lcy/.docker/machine/machines/manager2/id_rsa ansible_python_interpreter=/usr/local/bin/python</span><br><span class="line">192.168.99.103 ansible_ssh_private_key_file=/home/lcy/.docker/machine/machines/worker1/id_rsa ansible_python_interpreter=/usr/local/bin/python</span><br><span class="line">192.168.99.104 ansible_ssh_private_key_file=/home/lcy/.docker/machine/machines/worker2/id_rsa ansible_python_interpreter=/usr/local/bin/python</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿æ¥æµ‹è¯•.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~$ ansible -i hosts.txt all -u docker -m ping</span><br><span class="line">192.168.99.102 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">192.168.99.100 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">192.168.99.103 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">192.168.99.104 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">192.168.99.101 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="é…ç½®Docker-Swarmé›†ç¾¤èŠ‚ç‚¹"><a href="#é…ç½®Docker-Swarmé›†ç¾¤èŠ‚ç‚¹" class="headerlink" title="é…ç½®Docker Swarmé›†ç¾¤èŠ‚ç‚¹"></a>é…ç½®<code>Docker Swarm</code>é›†ç¾¤èŠ‚ç‚¹</h2><h3 id="é…ç½®Swarmç®¡ç†èŠ‚ç‚¹"><a href="#é…ç½®Swarmç®¡ç†èŠ‚ç‚¹" class="headerlink" title="é…ç½®Swarmç®¡ç†èŠ‚ç‚¹"></a>é…ç½®<code>Swarm</code>ç®¡ç†èŠ‚ç‚¹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ docker-machine ssh manager1 &quot;docker swarm init --advertise-addr 192.168.99.101&quot;</span><br><span class="line">Swarm initialized: current node (slf4m19dsk0cvo6wcpxjwm10v) is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-4lwpkgvw8lqn68k20n89qy39uvhdx4u6cznak5zy3q6sp5nlp3-dsf3agxhdq6prycves2cxg16w 192.168.99.101:2377</span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run &apos;docker swarm join-token manager&apos; and follow the instructions.</span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®å·¥ä½œèŠ‚ç‚¹"><a href="#é…ç½®å·¥ä½œèŠ‚ç‚¹" class="headerlink" title="é…ç½®å·¥ä½œèŠ‚ç‚¹"></a>é…ç½®å·¥ä½œèŠ‚ç‚¹</h3><ul>
<li>æŠŠ<code>worker1</code>,<code>worker2</code>åˆ›å»ºæˆå·¥ä½œèŠ‚ç‚¹,å¹¶åŠ å…¥åˆ°é›†ç¾¤ä¸­.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ docker-machine ssh worker1 &quot;docker swarm join --token SWMTKN-1-4lwpkgvw8lqn68k20n89qy39uvhdx4u6cznak5zy3q6sp5nlp3-dsf3agxhdq6prycves2cxg16w 192.168.99.101:2377&quot;</span><br><span class="line">This node joined a swarm as a worker.</span><br><span class="line"></span><br><span class="line">~$ docker-machine ssh worker2 &quot;docker swarm join --token SWMTKN-1-4lwpkgvw8lqn68k20n89qy39uvhdx4u6cznak5zy3q6sp5nlp3-dsf3agxhdq6prycves2cxg16w 192.168.99.101:2377&quot;</span><br><span class="line">This node joined a swarm as a worker.</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="æ·»åŠ å¤‡ç”¨ç®¡ç†èŠ‚ç‚¹"><a href="#æ·»åŠ å¤‡ç”¨ç®¡ç†èŠ‚ç‚¹" class="headerlink" title="æ·»åŠ å¤‡ç”¨ç®¡ç†èŠ‚ç‚¹"></a>æ·»åŠ å¤‡ç”¨ç®¡ç†èŠ‚ç‚¹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹åŠ å…¥swarmé›†ç¾¤ç®¡ç†èŠ‚ç‚¹çš„token</span><br><span class="line">~$ docker-machine ssh manager1 &quot;docker swarm join-token manager&quot;</span><br><span class="line">To add a manager to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-4lwpkgvw8lqn68k20n89qy39uvhdx4u6cznak5zy3q6sp5nlp3-1pg2xuizss0074mw3xgf59b5t 192.168.99.101:2377</span><br><span class="line"># æŠŠmanager2åŠ å…¥swarmç®¡ç†èŠ‚ç‚¹,åšä¸ºå¤‡ç”¨å€™é€‰ç®¡ç†èŠ‚ç‚¹</span><br><span class="line">~$ docker-machine ssh manager2 &quot;docker swarm join --token SWMTKN-1-4lwpkgvw8lqn68k20n89qy39uvhdx4u6cznak5zy3q6sp5nlp3-1pg2xuizss0074mw3xgf59b5t 192.168.99.101:2377&quot;</span><br><span class="line">This node joined a swarm as a manager.</span><br><span class="line"># æŸ¥çœ‹swarmé›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯.</span><br><span class="line">~$ docker-machine ssh manager1 &quot;docker node ls&quot;</span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class="line">slf4m19dsk0cvo6wcpxjwm10v *   manager1            Ready               Active              Leader              18.09.1</span><br><span class="line">5navxdx9kkvph4elfb2dcuiee     manager2            Ready               Active              Reachable           18.09.1</span><br><span class="line">wsvs8cb6sbroj0wuz09z9vrdj     worker1             Ready               Active                                  18.09.1</span><br><span class="line">qkwz8akr2ef8oe5kddibmglfs     worker2             Ready               Active                                  18.09.1</span><br></pre></td></tr></table></figure>
<h2 id="åˆ›å»ºdockerç§æœ‰ä»“åº“"><a href="#åˆ›å»ºdockerç§æœ‰ä»“åº“" class="headerlink" title="åˆ›å»ºdockerç§æœ‰ä»“åº“"></a>åˆ›å»º<code>docker</code>ç§æœ‰ä»“åº“</h2><ul>
<li><p>é€šè¿‡ä¸‹å‘½ä»¤åœ¨æœ¬æœºåˆ›å»ºä¸€ä¸ªç§æœ‰çš„é•œåƒä»“åº“.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ docker run -d -v /data/docker-registry:/var/lib/registry -p 5000:5000 --restart=always --name registry registry</span><br><span class="line">Unable to find image &apos;registry:latest&apos; locally</span><br><span class="line">latest: Pulling from library/registry</span><br><span class="line">cd784148e348: Pull complete</span><br><span class="line">[...]</span><br><span class="line">Digest: sha256:a54bc9be148764891c44676ce8c44f1e53514c43b1bfbab87b896f4b9f0b5d99</span><br><span class="line">Status: Downloaded newer image for registry:latest</span><br><span class="line">242af2d15586d2d571c46c5edf821ce958cf22139d957e52a6f5d959726957bf</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ¥ä¸‹æ¥,å°†æœ¬åœ°å·²æœ‰çš„é•œåƒæ–‡ä»¶æ¨é€åˆ°åˆšæ‰æ–°å»ºçš„ä»“åº“ä¸­å».</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">~$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS                 PORTS                                           NAMES</span><br><span class="line">242af2d15586        registry            &quot;/entrypoint.sh /etcâ€¦&quot;   About a minute ago   Up About a minute      0.0.0.0:5000-&gt;5000/tcp                          registry</span><br><span class="line">8ee3d7fb435f        redis               &quot;docker-entrypoint.sâ€¦&quot;   4 months ago         Up 3 hours             0.0.0.0:6379-&gt;6379/tcp                          redis</span><br><span class="line">608b60a022e8        postgres:9.6        &quot;docker-entrypoint.sâ€¦&quot;   4 months ago         Up 3 hours             0.0.0.0:5432-&gt;5432/tcp                          pg96</span><br><span class="line"></span><br><span class="line"># æŠŠæœ¬åœ°çš„postgres:9.6ç‰ˆæœ¬çš„é•œåƒ,æ”¹æˆ192.168.99.1:5000/postgres:v3æ ‡ç­¾</span><br><span class="line">~$ docker tag postgres:9.6 192.168.99.1:5000/postgres:v3</span><br><span class="line">docker images</span><br><span class="line">REPOSITORY                   TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">registry                     latest              116995fd6624        5 days ago          25.8MB</span><br><span class="line">127.0.0.1:5000/postgres      9.6                 0178d5af9576        5 months ago        229MB</span><br><span class="line">192.168.99.1:5000/postgres   9.6                 0178d5af9576        5 months ago        229MB</span><br><span class="line">postgres                     9.6                 0178d5af9576        5 months ago        229MB</span><br><span class="line"># æ¨é€é•œåƒ.</span><br><span class="line">~$ docker push 192.168.99.1:5000/postgres:v3</span><br><span class="line">The push refers to repository [192.168.99.1:5000/postgres]</span><br><span class="line">10cb36af78fe: Pushed</span><br><span class="line">[...]</span><br><span class="line">v3: digest: sha256:86a7984760c1d36c7c9ebec73706f05d76e7615937a45ae0d110b2112fd5cbfa size: 3245</span><br><span class="line">~$ã€€curl http://192.168.99.1:5000/v2/_catalog</span><br><span class="line">&#123;&quot;repositories&quot;:[&quot;postgres&quot;]&#125;</span><br><span class="line">~$ curl http://192.168.99.1:5000/v2/postgres/tags/list</span><br><span class="line">&#123;&quot;name&quot;:&quot;postgres&quot;,&quot;tags&quot;:[&quot;v3&quot;]&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç®€å•çš„ä»å…¬ç½‘ä¸‹è½½é•œæ¨è¿›ç§æœ‰åº“ä¸­.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ docker pull dockersamples/visualizer</span><br><span class="line">~$ docker tag  dockersamples/visualizer 192.168.99.1:5000/visualizer:v4</span><br><span class="line">~$ docker push 192.168.99.1:5000/visualizer:v4</span><br><span class="line">~$ curl http://192.168.99.1:5000/v2/_catalog</span><br><span class="line">&#123;&quot;repositories&quot;:[&quot;postgres&quot;,&quot;visualizer&quot;]&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>-ã€€é€šè¿‡ ansible å‘½ä»¤,åœ¨ï¼”ä¸ª hosts èŠ‚ç‚¹ä¸­çš„ docker å¯åŠ¨å‚æ•°ä¸­åŠ å…¥å‰é¢åˆ›å»ºçš„ç§æœ‰ä»“åº“åœ°å€.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ ansible -i hosts.txt all -u docker -b  -m lineinfile -a &quot;path=/etc/docker/daemon.json line=&apos;&#123;\n\t\t\&quot;insecure-registries\&quot;:    [\&quot;192.168.99.1:5000\&quot;]\n&#125;&apos; create=yes&quot;</span><br><span class="line"># é‡å¯æ‰€æœ‰èŠ‚ç‚¹</span><br><span class="line">~$  docker-machine restart manager1 manager2 worker2 worker1</span><br></pre></td></tr></table></figure>
<h2 id="Docker-Serviceéƒ¨ç½²å•ä¸ªé›†ç¾¤æœåŠ¡"><a href="#Docker-Serviceéƒ¨ç½²å•ä¸ªé›†ç¾¤æœåŠ¡" class="headerlink" title="Docker Serviceéƒ¨ç½²å•ä¸ªé›†ç¾¤æœåŠ¡"></a><code>Docker Service</code>éƒ¨ç½²å•ä¸ªé›†ç¾¤æœåŠ¡</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~$ docker-machine ssh manager1 &quot;docker service create --replicas 4 -p 15432:5432 --name pgsql 192.168.99.1:5000/postgres:v3&quot;</span><br><span class="line">yt4u3vmyq3gp9pc2bgowti1lf</span><br><span class="line">overall progress: 0 out of 4 tasks</span><br><span class="line">[....]</span><br><span class="line">verify: Service converged</span><br><span class="line"></span><br><span class="line">~$ docker-machine ssh manager1 &quot;docker service ls&quot;</span><br><span class="line">ID                  NAME                MODE                REPLICAS            IMAGE                           PORTS</span><br><span class="line">yt4u3vmyq3gp        pgsql               replicated          4/4                 192.168.99.1:5000/postgres:v3   *:15432-&gt;5432/tcp</span><br><span class="line">~$ docker-machine ssh manager1 &quot;docker service  ps pgsql&quot;</span><br><span class="line">ID                  NAME                IMAGE                           NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS</span><br><span class="line">zj09wnhy4utz        pgsql.1             192.168.99.1:5000/postgres:v3   worker1             Running             Running 27 seconds ago</span><br><span class="line">l7feljripf38        pgsql.2             192.168.99.1:5000/postgres:v3   manager2            Running             Running 27 seconds ago</span><br><span class="line">omxdx1cw8c7x        pgsql.3             192.168.99.1:5000/postgres:v3   worker2             Running             Running 27 seconds ago</span><br><span class="line">tkghl3px2l08        pgsql.4             192.168.99.1:5000/postgres:v3   manager1            Running             Running 26 seconds ago</span><br><span class="line"></span><br><span class="line"># ç™»å½•æµ‹è¯•ä¸€ä¸‹</span><br><span class="line">~$ psql -h 192.168.99.101 -p 15432 -U postgres -W</span><br><span class="line">Password for user postgres:</span><br><span class="line">psql (10.6 (Debian 10.6-1.pgdg90+1), server 9.6.11)</span><br><span class="line">Type &quot;help&quot; for help.</span><br></pre></td></tr></table></figure>
<h2 id="Docker-Stackéƒ¨ç½²å¤šä¸ªé›†ç¾¤æœåŠ¡"><a href="#Docker-Stackéƒ¨ç½²å¤šä¸ªé›†ç¾¤æœåŠ¡" class="headerlink" title="Docker Stackéƒ¨ç½²å¤šä¸ªé›†ç¾¤æœåŠ¡"></a><code>Docker Stack</code>éƒ¨ç½²å¤šä¸ªé›†ç¾¤æœåŠ¡</h2><ul>
<li><p>ç¡®ä¿ä¸‹åˆ—çš„<code>image</code>æ˜¯åœ¨æœ¬çš„ä»“åº“ä¸­æ‰¾å¾—åˆ°çš„.ç¡®è®¤é•œåƒ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ docker images | awk &apos;$2 ~/v4/ &#123;print&#125;&apos;</span><br><span class="line">192.168.99.1:5000/nginx        v4                  42b4762643dc        34 hours ago        109MB</span><br><span class="line">192.168.99.1:5000/visualizer   v4                  f6411ebd974c        3 weeks ago         166MB</span><br><span class="line">192.168.99.1:5000/portainer    v4                  a01958db7424        6 weeks ago         72.2MB</span><br></pre></td></tr></table></figure>
</li>
<li><p>docker-compose.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">version: &apos;3&apos;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  nginx:</span><br><span class="line">    image: 192.168.99.1:5000/nginx:v4</span><br><span class="line">    ports:</span><br><span class="line">      - 8088:80</span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: 4</span><br><span class="line"></span><br><span class="line">  visualizer:</span><br><span class="line">    image: 192.168.99.1:5000/visualizer:v4</span><br><span class="line">    ports:</span><br><span class="line">      - &apos;8080:8080&apos;</span><br><span class="line">    volumes:</span><br><span class="line">      - &apos;/var/run/docker.sock:/var/run/docker.sock&apos;</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: 1</span><br><span class="line">      placement:</span><br><span class="line">        constraints: [node.role == manager]</span><br><span class="line"></span><br><span class="line">  portainer:</span><br><span class="line">    image: 192.168.99.1:5000/portainer:v4</span><br><span class="line">    ports:</span><br><span class="line">      - &apos;9000:9000&apos;</span><br><span class="line">    volumes:</span><br><span class="line">      - &apos;/var/run/docker.sock:/var/run/docker.sock&apos;</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: 1</span><br><span class="line">      placement:</span><br><span class="line">        constraints: [node.role == manager]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="åˆ›å»ºæœåŠ¡"><a href="#åˆ›å»ºæœåŠ¡" class="headerlink" title="åˆ›å»ºæœåŠ¡"></a>åˆ›å»ºæœåŠ¡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ docker-machine ssh manager1 &quot;docker stack deploy -c docker-compose.yml deploy-demo&quot;</span><br><span class="line">Creating network deploy-demo_default</span><br><span class="line">Creating service deploy-demo_visualizer</span><br><span class="line">Creating service deploy-demo_portainer</span><br><span class="line">Creating service deploy-demo_nginx</span><br></pre></td></tr></table></figure>
<ul>
<li>ç”¨æµè§ˆå™¨æµ‹è¯•æ‰“å¼€å¦‚ä¸‹ç½‘é¡µ:<ul>
<li><a href="http://192.168.99.101:9000/#/home" target="_blank" rel="noopener">portainer ç®¡ç†ç•Œé¢ http://192.168.99.101:9000/#/home</a></li>
<li><a href="http://192.168.99.101:8080/" target="_blank" rel="noopener">visualizer ç®¡ç†ç•Œé¢ http://192.168.99.101:8080</a>.<code>visualizer</code>çš„ç•Œé¢å¤ªç®€é™‹äº†,æ²¡æœ‰ä»€ä¹ˆä½¿ç”¨ä»·å€¼.</li>
<li><a href="http://192.168.99.104:8088/" target="_blank" rel="noopener">nginx çš„æœåŠ¡ç•Œé¢,http://192.168.99.101:8088,http://192.168.99.102:8088</a></li>
</ul>
</li>
</ul>
<h2 id="ç®¡ç†é˜¿é‡Œäº‘ECS"><a href="#ç®¡ç†é˜¿é‡Œäº‘ECS" class="headerlink" title="ç®¡ç†é˜¿é‡Œäº‘ECS"></a>ç®¡ç†é˜¿é‡Œäº‘<code>ECS</code></h2><h3 id="é˜¿é‡Œäº‘å®˜æ–¹é©±åŠ¨"><a href="#é˜¿é‡Œäº‘å®˜æ–¹é©±åŠ¨" class="headerlink" title="é˜¿é‡Œäº‘å®˜æ–¹é©±åŠ¨"></a>é˜¿é‡Œäº‘å®˜æ–¹é©±åŠ¨</h3><ul>
<li><a href="https://develop.aliyun.com/command/docker" target="_blank" rel="noopener">é˜¿é‡Œäº‘ Docker Machine é©±åŠ¨</a></li>
<li><a href="https://yq.aliyun.com/articles/6809" target="_blank" rel="noopener">é˜¿é‡Œäº‘ ECS Docker Machine Driver å…¥é—¨æŒ‡å—</a></li>
<li>æŒ‰ç…§ä¸Šè¿°åœ¨æœ¬åœ°çš„<code>VirtualBox</code>åˆ›å»ºä¸»æœºçš„ç±»æ¯”,ä½¿ç”¨é˜¿é‡Œäº‘å®˜æ–¹çš„é©±åŠ¨,éœ€è¦é˜¿é‡Œçš„çš„å®‰å…¨ç§˜é’¥ä»¥åŠå¯¹åº”çš„<code>Region</code>ä¿¡æ¯.å¦‚æœæƒ³åˆ›å»º<code>VPC</code>ç½‘ç»œ,è¿˜éœ€è¦æœ‰<br><code>VPC ID</code>å’Œ<code>VSwitch ID</code>.æ“ä½œèµ·ç¨æ˜¾éº»çƒ¦,è€Œä¸”<code>--aliyunecs-access-key-id</code>,<code>--aliyunecs-access-key-secret</code>è¿™ä¸¤ä¸ªå‚æ•°æƒé™æ˜¯ç›¸å½“é‡è¦,è¿™ä¸ªåªåœ¨ä»¥åå·¥ä½œçš„å…·ä½“åº”ç”¨ä¸­æœ‰ä½¿ç”¨éœ€è¦æ—¶,å†å»äº†è§£å®ƒçš„åŠŸèƒ½.</li>
</ul>
<h3 id="genericé©±åŠ¨"><a href="#genericé©±åŠ¨" class="headerlink" title="genericé©±åŠ¨"></a><code>generic</code>é©±åŠ¨</h3><ul>
<li>ä¸‹é¢è™½ç„¶æ²¡æœ‰é˜¿é‡Œäº‘<code>driver</code>ä½†æœ‰ä¸€ä¸ª<code>generic driver</code>,å¯é€šè¿‡<code>ssh</code>ç®¡ç†ç°æœ‰çš„æœºå™¨,åŸåˆ™ä¸Šæ‰€æœ‰çš„<code>Linux</code>æœºå™¨éƒ½æ”¯æŒ.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">~$ docker-machine create --driver generic --generic-ip-address DB001 --generic-ssh-user lcy  --generic-ssh-key $HOME/.ssh/id_rsa   aliyun-machine</span><br><span class="line">Running pre-create checks...</span><br><span class="line">Creating machine...</span><br><span class="line">(aliyun-machine) Importing SSH key...</span><br><span class="line">Waiting for machine to be running, this may take a few minutes...</span><br><span class="line">Detecting operating system of created instance...</span><br><span class="line">Waiting for SSH to be available...</span><br><span class="line">Detecting the provisioner...</span><br><span class="line">Provisioning with debian...</span><br><span class="line">Copying certs to the local machine directory...</span><br><span class="line">Copying certs to the remote machine...</span><br><span class="line">Setting Docker configuration on the remote daemon...</span><br><span class="line">Checking connection to Docker...</span><br><span class="line">Docker is up and running!</span><br><span class="line">To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker-machine env aliyun-machine</span><br><span class="line">~$ docker-machine env aliyun-machine</span><br><span class="line">export DOCKER_TLS_VERIFY=&quot;1&quot;</span><br><span class="line">export DOCKER_HOST=&quot;tcp://DB001:2376&quot;</span><br><span class="line">export DOCKER_CERT_PATH=&quot;/home/lcy/.docker/machine/machines/aliyun-machine&quot;</span><br><span class="line">export DOCKER_MACHINE_NAME=&quot;aliyun-machine&quot;</span><br><span class="line"># Run this command to configure your shell:</span><br><span class="line"># eval $(docker-machine env aliyun-machine)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="é”™è¯¯"><a href="#é”™è¯¯" class="headerlink" title="é”™è¯¯"></a>é”™è¯¯</h3><ul>
<li><p>è¦åœ¨<code>/etc/docker/daemon.json</code>åŠ å…¥<code>{ &quot;insecure-registries&quot;: [&quot;192.168.99.1:5000&quot;] }</code>è¿™ä¸€è¡Œ,ä¸ç„¶ä¼šå‡ºç°ä¸‹é¢çš„é”™è¯¯.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ docker pull 192.168.99.1:5000/postgres:9.6</span><br><span class="line">Error response from daemon: Get https://192.168.99.1:5000/v2/: http: server gave HTTP response to HTTPS client</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>ansible</code>è¿æ¥åˆ°<code>boot2docker</code>é•œåƒæ— <code>python</code>ç¯å¢ƒçš„é”™è¯¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">192.168.99.102 | FAILED! =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;module_stderr&quot;: &quot;Shared connection to 192.168.99.102 closed.\r\n&quot;,</span><br><span class="line">    &quot;module_stdout&quot;: &quot;/bin/sh: /usr/local/bin/python: not found\r\n&quot;,</span><br><span class="line">    &quot;msg&quot;: &quot;MODULE FAILURE\nSee stdout/stderr for the exact error&quot;,</span><br><span class="line">    &quot;rc&quot;: 127</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Ansible"><a href="#Ansible" class="headerlink" title="Ansible"></a><code>Ansible</code></h1><ul>
<li>å‚è€ƒé“¾æ¥:<ul>
<li><a href="https://docs.ansible.com/" target="_blank" rel="noopener">docs</a></li>
<li><a href="https://github.com/ansible/ansible" target="_blank" rel="noopener">github ansible</a></li>
<li><a href="http://www.ansible.com.cn/" target="_blank" rel="noopener">Ansible æƒå¨æŒ‡å—</a></li>
</ul>
</li>
<li>ç¯å¢ƒç®€ä»‹<ul>
<li>docker 18.09.0</li>
<li>ansible 2.7.5</li>
<li>debian stretch</li>
<li>postgresql 10.6</li>
<li>python 3.6.6</li>
</ul>
</li>
</ul>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ pip install ansible ansible-lint</span><br></pre></td></tr></table></figure>
<h2 id="å‘½ä»¤æ ¼å¼"><a href="#å‘½ä»¤æ ¼å¼" class="headerlink" title="å‘½ä»¤æ ¼å¼"></a>å‘½ä»¤æ ¼å¼</h2><ul>
<li><code>ansible &lt;host-pattern&gt; [options]</code>,<host-pattern>æ˜¯<code>Inventory</code>ä¸­å®šä¹‰çš„ä¸»æœºæˆ–ä¸»æœºç»„,å¯ä»¥ä¸º<code>ip,hostname,Inventory</code>ä¸­çš„<code>group</code>ç»„å,å…·æœ‰<code>&quot;.&quot;,&quot;\*&quot;.&quot;:&quot;</code>ç­‰ç‰¹æ®Šå­—ç¬¦çš„åŒ¹é…å‹å­—ç¬¦ä¸².<code>&lt;&gt;</code>;è¡¨ç¤ºä¸ºå¿…é¡»å‚æ•°,<code>\[\]</code>è¡¨ç¤ºä¸ºå¯é€‰å‚æ•°.</host-pattern></li>
<li><p>æ¯”å¦‚ä½¿ç”¨<code>apt</code>æ¨¡å—,<code>root</code>ç”¨æˆ·,æ›´æ–°ç³»ç»Ÿçš„å‘½ä»¤.åé¢ä¼šè®²åŸºäº<code>YMAL</code>æ ¼å¼çš„é…ç½®æ–‡ä»¶.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ ansible -i ~/.ansible/hosts all -u root -m apt -a &quot;upgrade=yes update_cache=yes cache_valid_time=86400&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸‹ä¾‹ä½¿ç”¨<code>authorized_key</code>æ¨¡å—ä¸ºç”¨æˆ·æ·»åŠ å…¬é’¥åŒ™,<code>exclusive=True</code>å°±ä¸ºæ›¿æ¢ç°æœ‰çš„ key.ä¸‹ä¾‹ä¸º:åœ¨åŸæœ‰çš„ key é™„åŠ æ–°çš„ key.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ ansible -i ~/.ansible/hosts all -u lcy -m authorized_key -a &quot;user=lcy state=present  key=&apos;ssh-rsa AAAAB3NzaC1yc...... user@gentoo&apos;&quot;</span><br><span class="line">#ã€€åœ¨ä¸»æœºçš„hostsæ·»åŠ </span><br><span class="line">~$ ansible -i ~/.ansible/hosts all -u lcy -b -m lineinfile -a &quot;path=/etc/hosts  create=yes line=&apos;127.0.0.1\tlocalhost\n172.18.127.186\tDB001\n172.18.192.77\tWeb001\n172.18.253.222\tFE001\n172.18.192.76\tDIG001&apos;&quot;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯"><a href="#æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯"></a>æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># è¿™é‡Œæ˜¯è°ƒç”¨commandè¿™ä¸ªæ¨¡å—,è¿è¡Œç³»ç»Ÿå‘½ä»¤.</span><br><span class="line">~$  ansible -i ~/.ansible/hosts Web001 -u root  -m command -a &apos;lsb_release -a&apos;</span><br><span class="line">120.77.xxx.xx | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">Distributor ID: Debian</span><br><span class="line">Description:    Debian GNU/Linux 9.6 (stretch)</span><br><span class="line">Release:        9.6</span><br><span class="line">Codename:       stretchNo LSB modules are available.</span><br></pre></td></tr></table></figure>
<h2 id="å‘½ä»¤å·¥å…·"><a href="#å‘½ä»¤å·¥å…·" class="headerlink" title="å‘½ä»¤å·¥å…·"></a>å‘½ä»¤å·¥å…·</h2><h3 id="ansible-doc"><a href="#ansible-doc" class="headerlink" title="ansible-doc"></a><code>ansible-doc</code></h3><ul>
<li>ä½¿ç”¨<code>ansible-doc</code>å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„æ¨¡å—æ–‡æ¡£,å› ä¸ºæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯<code>Debian</code>,è¿™é‡ŒæŠŠå®ƒç›¸å…³çš„åŒ…ç®¡ç†æ¨¡å—åˆ—å‡ºæ¥.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">~$ ansible-doc  -l | grep &quot;apt&quot;</span><br><span class="line">apt                                                  Manages apt-packages</span><br><span class="line">apt_key                                              Add or remove an apt key</span><br><span class="line">apt_repository                                       Add and remove APT repositories</span><br><span class="line">apt_rpm                                              apt_rpm package manager</span><br><span class="line">na_ontap_ucadapter                                   NetApp ONTAP UC adapter configuration</span><br><span class="line">nios_naptr_record                                    Configure Infoblox NIOS NAPTR records</span><br><span class="line"></span><br><span class="line"># å¯ä»¥æŸ¥è¯¥æ¨¡å—çš„å‚æ•°ä¸ä½¿ç”¨ç¤ºä¾‹.ä¹Ÿå¯ä»¥æ‰“å¼€ç½‘é¡µæ–‡æ¡£[apt_module](https://docs.ansible.com/ansible/latest/modules/apt_module.html)</span><br><span class="line">~$ ansible-doc apt</span><br><span class="line">&gt; APT    (/home/lcy/.pyenv/versions/3.6.6/envs/py3dev/lib/python3.6/site-packages/ansible/modules/packaging/os/apt.py)</span><br><span class="line"></span><br><span class="line">        Manages \`apt\&apos; packages (such as for Debian/Ubuntu).</span><br><span class="line"></span><br><span class="line">OPTIONS (= is mandatory):</span><br><span class="line"></span><br><span class="line">- allow_unauthenticated</span><br><span class="line">        Ignore if packages cannot be authenticated. This is useful for bootstrapping environments that manage their own apt-key setup.</span><br><span class="line">        \`allow_unauthenticated\&apos; is only supported with state: \`install\&apos;/\`present\&apos;</span><br><span class="line">        [Default: no]</span><br><span class="line">        type: bool</span><br><span class="line">        version_added: 2.1</span><br><span class="line">[....]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="ansible-playbook"><a href="#ansible-playbook" class="headerlink" title="ansible-playbook"></a><code>ansible-playbook</code></h3><ul>
<li><code>Ansiable</code>çš„ä»»åŠ¡é…ç½®æ–‡ä»¶è¢«ç§°ä¸º<code>Playbook</code>,å¯ä»¥ç§°ä¹‹ä¸ºâ€å‰§æœ¬â€,<code>Playbook</code>å…·æœ‰ç¼–å†™ç®€å•,å¯å®šåˆ¶æ€§é«˜,çµæ´»æ–¹ä¾¿,ä»¥åŠå¯å›ºåŒ–æ—¥å¸¸æ‰€æœ‰æ“ä½œçš„ç‰¹ç‚¹.åœ¨ä¸‹é¢çš„<a href="#docker-ce">docker å®‰è£…</a>ç”¨ä¸€ä¸ªçœŸå®çš„å®Œæ•´å®ä¾‹æ¼”ç¤º.</li>
</ul>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><ul>
<li>é»˜è®¤é…ç½®æ–‡ä»¶åä¸º<code>ansible.cfg</code>,å®ƒå¯ä»¥å­˜åœ¨äºå¾ˆå¤šåœ°æ–¹,é»˜è®¤æ˜¯<code>/etcï¼ansible.cfg</code>ä¸ç”¨æˆ·ç›®å½•ä¸‹çš„<code>~/.ansible/ansible.cfg</code>.<code>Ad-Hoc</code>,<code>Ansible-playbook</code>,å‰è€…æ˜¯ä¸´æ—¶å‘½ä»¤çš„æ‰§è¡Œ,åè€…æ˜¯<code>Ad-Hoc</code>çš„é›†åˆ,ç›¸å½“äºæ˜¯ä¸€ä¸ªè„šæœ¬.</li>
<li>ä¸‹é¢æ˜¯ä¸€ä¸ªç»å…¸çš„<code>hosts</code>æ–‡ä»¶,å®ƒé»˜è®¤æ‰¾çš„ä½ç½®æ˜¯<code>/etc/ansible/hosts</code>,è¿™é‡Œæ˜¯ç”¨æˆ·ç›®å½•.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">~$ cat ~/.ansible/hosts</span><br><span class="line">[Web001]</span><br><span class="line">120.77.xxx.xx</span><br><span class="line"></span><br><span class="line">[DB001]</span><br><span class="line">119.23.xx.xxx</span><br><span class="line"></span><br><span class="line">[DIG001]</span><br><span class="line">120.78.xx.xxx</span><br><span class="line"></span><br><span class="line">[FE001]</span><br><span class="line">112.74.xxx.xx</span><br><span class="line"></span><br><span class="line">~$ ansible -i ~/.ansible/hosts all -m ping  -u root</span><br><span class="line">120.77.xxx.xx | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">119.23.xx.xxx | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">112.74.xx.xxx | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">120.78.xxx.xx | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="ansible-vault"><a href="#ansible-vault" class="headerlink" title="ansible-vault"></a><code>ansible-vault</code></h3><ul>
<li><code>ansible-vault</code>ä¸»è¦ç”¨äºé…ç½®æ–‡ä»¶åŠ å¯†,å¦‚ç¼–å†™è¦çš„<code>Playbook</code>é…ç½®æ–‡ä»¶é‡ŒåŒ…å«æ•æ„Ÿä¿¡æ¯.<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_vault.html" target="_blank" rel="noopener">å‚è€ƒè¿™é‡Œ</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># åŠ å¯†åçš„a.yamlæ‰“å¼€å…¨æ˜¯ä¹±ç .</span><br><span class="line">~$ ansible-vault encrypt a.yaml</span><br><span class="line">New Vault password:</span><br><span class="line">Confirm New Vault password:</span><br><span class="line">Encryption successful</span><br><span class="line"># è§£å¯†a.yaml</span><br><span class="line">~$ ansible-vault decrypt a.yaml</span><br><span class="line">Vault password:</span><br><span class="line">Decryption successful</span><br></pre></td></tr></table></figure>
<h3 id="ansible-galaxy"><a href="#ansible-galaxy" class="headerlink" title="ansible-galaxy"></a><code>ansible-galaxy</code></h3><ul>
<li><a href="https://docs.ansible.com/ansible/latest/reference_appendices/galaxy.html" target="_blank" rel="noopener">Ansible Galaxy æ–‡æ¡£</a></li>
<li><p>è¿™ä¸ªè·Ÿä¸‰æ˜Ÿæ‰‹æœºæ²¡æœ‰ä»»ä½•å…³ç³» ,å¯ä»¥æŠŠå®ƒç®€å•åœ°ç†è§£ä¸º<code>github</code>æˆ–è€…<code>pip</code>çš„åŠŸèƒ½.ä¸»è¦æ˜¯ç”¨æ¥ç”Ÿæˆ,æŸ¥æ‰¾,å®‰è£…ä¸€äº›ä¼˜ç§€çš„<code>Roles</code>.ä¸€äº›ä¼˜è´¨çš„<code>Roles</code>å¯ä»¥åœ¨<a href="https://galaxy.ansible.com/" target="_blank" rel="noopener">è¿™é‡Œ</a>æ‰¾åˆ°.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$  ansible-galaxy --help</span><br><span class="line">Usage: ansible-galaxy [delete|import|info|init|install|list|login|remove|search|setup] [--help] [options] ...</span><br><span class="line"></span><br><span class="line">Perform various Role related operations.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line">  -c, --ignore-certs    Ignore SSL certificate validation errors.</span><br><span class="line">  -s API_SERVER, --server=API_SERVER</span><br><span class="line">                        The API server destination</span><br><span class="line">  -v, --verbose         verbose mode (-vvv for more, -vvvv to enable</span><br><span class="line">                        connection debugging)</span><br><span class="line">  --version             show program&apos;s version number and exit</span><br><span class="line"></span><br><span class="line"> See &apos;ansible-galaxy &lt;command&gt; --help&apos; for more information on a specific</span><br><span class="line">command.</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®‰è£…<code>postgresql Roles</code>,ä»¥åŠå®ƒçš„ç›®å½•ç»“æ„.å¦‚æœè¦åˆ›å»ºè‡ªå®šä¹‰çš„<code>Roles</code>,å¯ä»¥å‚è€ƒè¿™äº›ç»“æ„.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">~$ ansible-galaxy install geerlingguy.postgresql</span><br><span class="line">- downloading role &apos;postgresql&apos;, owned by geerlingguy</span><br><span class="line">- downloading role from https://github.com/geerlingguy/ansible-role-postgresql/archive/1.4.5.tar.gz</span><br><span class="line">- extracting geerlingguy.postgresql to /home/lcy/.ansible/roles/geerlingguy.postgresql</span><br><span class="line">- geerlingguy.postgresql (1.4.5) was installed successfully</span><br><span class="line">~$ tree /home/lcy/.ansible/roles/geerlingguy.postgresql/</span><br><span class="line">/home/lcy/.ansible/roles/geerlingguy.postgresql/</span><br><span class="line">â”œâ”€â”€ defaults</span><br><span class="line">â”‚   â””â”€â”€ main.yml</span><br><span class="line">â”œâ”€â”€ handlers</span><br><span class="line">â”‚   â””â”€â”€ main.yml</span><br><span class="line">â”œâ”€â”€ LICENSE</span><br><span class="line">â”œâ”€â”€ meta</span><br><span class="line">â”‚   â””â”€â”€ main.yml</span><br><span class="line">â”œâ”€â”€ molecule</span><br><span class="line">â”‚   â””â”€â”€ default</span><br><span class="line">â”‚       â”œâ”€â”€ molecule.yml</span><br><span class="line">â”‚       â”œâ”€â”€ playbook.yml</span><br><span class="line">â”‚       â”œâ”€â”€ tests</span><br><span class="line">â”‚       â”‚   â””â”€â”€ test_default.py</span><br><span class="line">â”‚       â””â”€â”€ yaml-lint.yml</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ tasks</span><br><span class="line">â”‚   â”œâ”€â”€ configure.yml</span><br><span class="line">â”‚   â”œâ”€â”€ databases.yml</span><br><span class="line">â”‚   â”œâ”€â”€ initialize.yml</span><br><span class="line">â”‚   â”œâ”€â”€ main.yml</span><br><span class="line">â”‚   â”œâ”€â”€ setup-Debian.yml</span><br><span class="line">â”‚   â”œâ”€â”€ setup-RedHat.yml</span><br><span class="line">â”‚   â”œâ”€â”€ users.yml</span><br><span class="line">â”‚   â””â”€â”€ variables.yml</span><br><span class="line">â”œâ”€â”€ templates</span><br><span class="line">â”‚   â”œâ”€â”€ pg_hba.conf.j2</span><br><span class="line">â”‚   â””â”€â”€ postgres.sh.j2</span><br><span class="line">â””â”€â”€ vars</span><br><span class="line">    â”œâ”€â”€ Debian-7.yml</span><br><span class="line">    â”œâ”€â”€ Debian-8.yml</span><br><span class="line">    â”œâ”€â”€ Debian-9.yml</span><br><span class="line">    â”œâ”€â”€ RedHat-6.yml</span><br><span class="line">    â”œâ”€â”€ RedHat-7.yml</span><br><span class="line">    â”œâ”€â”€ Ubuntu-14.yml</span><br><span class="line">    â”œâ”€â”€ Ubuntu-16.yml</span><br><span class="line">    â””â”€â”€ Ubuntu-18.yml</span><br><span class="line"></span><br><span class="line">9 directories, 27 files</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="é€šè¿‡Ansiableå®‰è£…docker"><a href="#é€šè¿‡Ansiableå®‰è£…docker" class="headerlink" title="é€šè¿‡Ansiableå®‰è£…docker"></a>é€šè¿‡<code>Ansiable</code>å®‰è£…<code>docker</code></h2><ul>
<li><p><a href="https://ruddra.com/posts/serve-static-files-by-nginx-from-django-using-docker/" target="_blank" rel="noopener">Serve Static Files by Nginx from Django using Docker</a><br><span id="docker-ce"> - <a href="https://docs.ansible.com/ansible/latest/modules/apt_module.html" target="_blank" rel="noopener">apt - Manages apt-packages</a> - <a href="https://docs.docker.com/install/linux/docker-ce/debian/#install-docker-ce-1" target="_blank" rel="noopener">Get Docker CE for Debian</a> - è¿™é‡Œå‚ç…§<a href="https://docs.docker.com/install/linux/docker-ce/debian/#install-docker-ce-1" target="_blank" rel="noopener">Get Docker CE for Debian</a>,æŠŠå®ƒçš„å®‰è£…æµç¨‹è½¬æ¢æˆä¸€ä¸ª<code>Playbook</code>æ–‡ä»¶æ¥æ‰§è¡Œ.è¿™ç§å®‰è£…æ–¹å¼,å„ä¸ªè¢«å®‰è£…çš„ç›®æ ‡ä¸»æœºé—´çš„ docker æ˜¯ç›¸äº’ç‹¬ç«‹çš„,å¦‚æœè¦æŠŠå®ƒä»¬é›†åˆèµ·æ¥åšç¼–æ’,è¦ä½¿ç”¨<a href="https://github.com/docker/machine/" target="_blank" rel="noopener">Docker Machine</a>.</span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- name: å®‰è£…åŸºç¡€è½¯ä»¶</span><br><span class="line">  hosts: all</span><br><span class="line">  become: yes</span><br><span class="line">  # user: root è¿™é‡Œå¯ä»¥ç›´æ¥ç”¨root,ä½†æ˜¯å…³é—­rootè¿œç¨‹ç™»å½•åè¦ä½¿ç”¨sudo.</span><br><span class="line">  tasks:</span><br><span class="line">    # å‚ç…§æ–‡æ¡£ https://docs.ansible.com/ansible/latest/modules/apt_module.html</span><br><span class="line">    - name: æ›´æ–°å¹¶å®‰è£…</span><br><span class="line">      apt:</span><br><span class="line">        name: [&apos;apt-transport-https&apos;, &apos;ca-certificates&apos;, &apos;curl&apos;, &apos;software-properties-common&apos;, tmux]</span><br><span class="line">        allow_unauthenticated: yes</span><br><span class="line">        update_cache: yes</span><br><span class="line"></span><br><span class="line">    # è¿™æ˜¯å¦ä¸€ç§å®‰è£…è½¯ä»¶åˆ—è¡¨çš„æ–¹å¼</span><br><span class="line">    - name: Install a list of packages</span><br><span class="line">      apt:</span><br><span class="line">        name: &apos;&#123;&#123; packages &#125;&#125;&apos;</span><br><span class="line">        update_cache: yes</span><br><span class="line">      vars:</span><br><span class="line">        packages:</span><br><span class="line">          - git</span><br><span class="line">          - rsync</span><br><span class="line">          - gcc</span><br><span class="line">          - dirmngr</span><br><span class="line">          - bwn-ng</span><br><span class="line">          - tmux</span><br><span class="line">          - tree</span><br><span class="line"></span><br><span class="line">    - name: æ›´æ–°å¹¶å®‰è£… gnupg2</span><br><span class="line">      apt:</span><br><span class="line">        name: gnupg2</span><br><span class="line">        allow_unauthenticated: no</span><br><span class="line">        update_cache: yes</span><br><span class="line"></span><br><span class="line">    # å‚ç…§æ–‡æ¡£ https://docs.ansible.com/ansible/latest/modules/apt_key_module.html?highlight=apt%20key</span><br><span class="line">    - name: æ·»åŠ æ–°çš„å…¬é’¥</span><br><span class="line">      apt_key:</span><br><span class="line">        url: https://download.docker.com/linux/debian/gpg</span><br><span class="line">        state: present</span><br><span class="line"></span><br><span class="line">    # å‚è€ƒæ–‡æ¡£ https://docs.ansible.com/ansible/latest/modules/command_module.html#command-module</span><br><span class="line">    - name: è¯»å–ç³»ç»Ÿå‘è¡Œç‰ˆæœ¬å·</span><br><span class="line">      command: lsb_release -sc</span><br><span class="line">      register: result</span><br><span class="line"></span><br><span class="line">    # å‚ç…§æ–‡æ¡£ https://docs.ansible.com/ansible/latest/modules/apt_repository_module.html?highlight=add%20apt%20repository</span><br><span class="line">    - apt_repository:</span><br><span class="line">        repo: deb [arch=amd64] https://download.docker.com/linux/debian &#123;&#123; result.stdout &#125;&#125; stable</span><br><span class="line">        state: present</span><br><span class="line">        filename: docker-ce</span><br><span class="line"></span><br><span class="line">    # å®‰è£…docker-ce,docker-compose</span><br><span class="line">    - name: æ›´æ–°å¹¶å®‰è£… &apos;docker-ce&apos;, ,&apos;bridge-utils&apos;</span><br><span class="line">      apt:</span><br><span class="line">        name: [&apos;docker-ce&apos;, &apos;bridge-utils&apos;]</span><br><span class="line">        allow_unauthenticated: yes</span><br><span class="line">        update_cache: yes</span><br><span class="line"></span><br><span class="line">    - name:</span><br><span class="line">      command: uname -s</span><br><span class="line">      register: vendor</span><br><span class="line"></span><br><span class="line">    - name:</span><br><span class="line">      command: uname -m</span><br><span class="line">      register: arch</span><br><span class="line"></span><br><span class="line">    # å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„docker-compose,ä½¿ç”¨aptå®‰è£…çš„ç‰ˆæœ¬å¾ˆè€.</span><br><span class="line">    - name: å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„docker-compose-1.23.2</span><br><span class="line">      get_url:</span><br><span class="line">        url: https://github.com/docker/compose/releases/download/1.23.2/docker-compose-&#123;&#123; vendor.stdout &#125;&#125;-&#123;&#123; arch.stdout &#125;&#125;</span><br><span class="line">        dest: /usr/local/bin/docker-compose</span><br><span class="line">        mode: 0755</span><br><span class="line"></span><br><span class="line">    - name: é‡å¯æœºå™¨</span><br><span class="line">      reboot:</span><br><span class="line">        reboot_timeout: 3600</span><br></pre></td></tr></table></figure>
</li>
<li><p>é‡å¯ä¹‹å,åº”è¯¥å°±å¯ä»¥ç”¨ä¸‹é¢å‘½ä»¤è¡ŒæŸ¥çœ‹<code>docker</code>ä¿¡æ¯äº†.</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ ansible -i ~/.ansible/hosts all -u lcy  -m command -a &quot;docker info&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ³¨æ„</strong>:å¦‚ä¸å®‰è£…<code>bridge-utils</code>å¹¶é‡å¯,<code>docker</code>æ— æ³•å¯åŠ¨,å¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Dec 29 10:26:16 DB001 dockerd[20493]: time=&quot;2018-12-29T10:26:16.760508487+08:00&quot; level=info msg=&quot;stopping event stream following graceful shutdown&quot; error=&quot;&lt;nil&gt;&quot; module=libcontainerd namespace=moby</span><br><span class="line">Dec 29 10:26:16 DB001 dockerd[20493]: Error starting daemon: Error initializing network controller: Error creating default &quot;bridge&quot; network: package not installed</span><br><span class="line">Dec 29 10:26:16 DB001 systemd[1]: docker.service: Main process exited, code=exited, status=1/FAILURE</span><br><span class="line">Dec 29 10:26:16 DB001 systemd[1]: Failed to start Docker Application Container Engine.</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="æ·»åŠ ç”¨æˆ·ä¸ç»„"><a href="#æ·»åŠ ç”¨æˆ·ä¸ç»„" class="headerlink" title="æ·»åŠ ç”¨æˆ·ä¸ç»„"></a>æ·»åŠ ç”¨æˆ·ä¸ç»„</h3><ul>
<li>å…³äºä¸å¼€å¯ç”¨æˆ·çš„<code>sudo</code>åŠŸèƒ½,æœ‰ä¸¤ç§æ–¹æ³•,ä¸€æ˜¯å¯ä»¥ä¿®æ”¹è¿œç¨‹ä¸»æœºçš„<code>/etc/sudoers</code>æ–‡ä»¶.å¯ä»¥<a href="https://docs.ansible.com/ansible/latest/modules/lineinfile_module.html?highlight=sudoers" target="_blank" rel="noopener">å‚ç…§è¿™é‡Œ</a> ä¹Ÿå¯ä»¥ä½¿ç”¨å¤åˆ¶æ›¿æ¢çš„æ–¹æ³•,<a href="https://docs.ansible.com/ansible/latest/modules/copy_module.html?highlight=sudoers" target="_blank" rel="noopener">å‚ç…§è¿™é‡Œ</a>.ä¹Ÿå¯ä»¥æŠŠç”¨æˆ·åŠ è¿›<code>sudo</code>ç»„é‡Œ.</li>
<li><p>å¦‚æœè¦æ¯ä¸€ä¸ªç”¨æˆ·æ·»åŠ ä¸€ä¸ªåˆå§‹å¯†ç ,å¯ä»¥<a href="https://docs.ansible.com/ansible/latest/reference_appendices/faq.html#how-do-i-generate-crypted-passwords-for-the-user-module" target="_blank" rel="noopener">å‚ç…§è¿™é‡Œ</a>.Linux ä¸‹å¯ä»¥ä½¿ç”¨<code>mkpasswd</code>å‘½ä»¤,å¦‚æœå…¶å®ƒç³»ç»Ÿ,å¯ä»¥ä½¿ç”¨<code>passlib</code>è¿™ä¸ª <code>python</code>çš„åŒ…æ¥æ›¿æ¢.å¦‚è¦ä½¿ç”¨<code>sudo</code>ä¸ç”¨å¯†ç ,è¦æ·»åŠ <code>NOPASSWORD</code>å…³é”®å­—.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~$ mkpasswd --method=sha-512</span><br><span class="line">Password:</span><br><span class="line">$6$5QYVZSmH7$FXQcAQ8FsjMVk0x.ATQgpFHhgImp7hdITMh7zAE.VeAkQYDzdFAOxx6jqVFOY.52nRW4a6SjzEUnK.JSh73W61</span><br><span class="line"></span><br><span class="line">~$ python -c &quot;from passlib.hash import sha512_crypt; import getpass; print(sha512_crypt.using(rounds=5000).hash(getpass.getpass()))&quot;</span><br><span class="line">Password:</span><br><span class="line">$6$J15B6vXoZeekBlVy$.F6PelDYQRCeqapZ2/V3BQ5IjJXCdhG4g5NgoeNvnGJqf1dValk38IDzBuMfmctLMgQ4llyzVT3WN4pYrIpmZ0</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸‹é¢æ˜¯æ·»åŠ ä¸¤ä¸ªç”¨æˆ·,å¹¶åŠ å…¥ç›¸å…³ç»„,ä»¥åŠä¿®æ”¹<code>sshd_config</code>çš„ç›¸å…³å‚æ•°.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- name: æ·»åŠ ç”¨æˆ·</span><br><span class="line">  hosts: all</span><br><span class="line">  user: root</span><br><span class="line">  tasks:</span><br><span class="line">    - name: remove users</span><br><span class="line">      user:</span><br><span class="line">        name: &apos;&#123;&#123; item &#125;&#125;&apos;</span><br><span class="line">        state: absent # absent è¡¨ç¤ºç§»é™¤,present è¡¨ç¤ºæ·»åŠ </span><br><span class="line">        remove: yes</span><br><span class="line">      with_items:</span><br><span class="line">        - lcy</span><br><span class="line">        - gavin_kou</span><br><span class="line"></span><br><span class="line">    - name: add the user &quot;&#123;&#123; item &#125;&#125;&quot;</span><br><span class="line">      # å‚è€ƒé“¾æ¥ https://docs.ansible.com/ansible/latest/modules/user_module.html?highlight=user</span><br><span class="line">      user:</span><br><span class="line">        name: &apos;&#123;&#123; item &#125;&#125;&apos;</span><br><span class="line">        append: yes</span><br><span class="line">        groups: docker,sudo</span><br><span class="line">        shell: /bin/bash</span><br><span class="line">        state: present</span><br><span class="line">        generate_ssh_key: yes</span><br><span class="line">        ssh_key_bits: 2048</span><br><span class="line">        # ssh_key_file: .ssh/id_rsa</span><br><span class="line">      # è¿™é‡Œå¯ä»¥ä½¿ç”¨ with_itemsæ¥åšæ•°ç»„å¾ªç¯. https://docs.ansible.com/ansible/latest/user_guide/playbooks_loops.html?highlight=with_items</span><br><span class="line">      with_items:</span><br><span class="line">        - lcy</span><br><span class="line">        - gavin_kou</span><br><span class="line"></span><br><span class="line">    - name: å¤åˆ¶æœ¬çš„å…¬é’¥åˆ°è¿œç¨‹ç”¨æˆ·ä¸‹.</span><br><span class="line">      # å‚è€ƒé“¾æ¥ https://docs.ansible.com/ansible/latest/modules/authorized_key_module.html</span><br><span class="line">      authorized_key:</span><br><span class="line">        user: lcy</span><br><span class="line">        state: present</span><br><span class="line">        # exclusive: True</span><br><span class="line">        key: &quot;&#123;&#123; lookup(&apos;file&apos;, lookup(&apos;env&apos;,&apos;HOME&apos;) + &apos;/.ssh/id_rsa.pub&apos;) &#125;&#125;\n&quot;</span><br><span class="line"></span><br><span class="line">    - name: Set authorized key for user ubuntu copying it from current user</span><br><span class="line">      # å‚è€ƒé“¾æ¥ https://docs.ansible.com/ansible/latest/modules/authorized_key_module.html</span><br><span class="line">      authorized_key:</span><br><span class="line">        user: gavin_kou</span><br><span class="line">        state: present</span><br><span class="line">        key: &quot;&#123;&#123; lookup(&apos;file&apos;,&apos;~/.ansible/gavin.pub&apos;) &#125;&#125;\n&quot;</span><br><span class="line">    # å‚è€ƒé“¾æ¥ https://docs.ansible.com/ansible/latest/modules/lineinfile_module.html?highlight=sudoers</span><br><span class="line">    - lineinfile:</span><br><span class="line">        path: /etc/sudoers</span><br><span class="line">        state: present</span><br><span class="line">        regexp: &apos;^%sudo\s&apos;</span><br><span class="line">        line: &apos;%sudo ALL=(ALL) NOPASSWD: ALL&apos;</span><br><span class="line">        validate: &apos;/usr/sbin/visudo -cf %s&apos;</span><br><span class="line"></span><br><span class="line">    # å…³é—­sshçš„rootç™»å½•åŠŸèƒ½.æ‰€ä»¥è¿è¡Œå®Œè¿™ä¸ªå‰§æœ¬å°±ä¸èƒ½ä½¿ç”¨rootç”¨æˆ·æ‰§è¡Œç¬¬äºŒæ¬¡äº†.</span><br><span class="line">    - lineinfile:</span><br><span class="line">        path: /etc/ssh/sshd_config</span><br><span class="line">        state: present</span><br><span class="line">        regexp: &apos;^PermitRootLogin\s&apos;</span><br><span class="line">        line: &apos;PermitRootLogin no&apos;</span><br><span class="line"></span><br><span class="line">    - lineinfile:</span><br><span class="line">        path: /etc/ssh/sshd_config</span><br><span class="line">        state: present</span><br><span class="line">        regexp: &apos;^#ClientAliveInterval\s&apos;</span><br><span class="line">        line: &apos;ClientAliveInterval 30&apos;</span><br><span class="line"></span><br><span class="line">    - lineinfile:</span><br><span class="line">        path: /etc/ssh/sshd_config</span><br><span class="line">        state: present</span><br><span class="line">        regexp: &apos;^#ClientAliveCountMax\s&apos;</span><br><span class="line">        line: &apos;ClientAliveCountMax 3&apos;</span><br><span class="line">    # å‚è€ƒæ¶ˆæ¯ https://docs.ansible.com/ansible/latest/modules/systemd_module.html</span><br><span class="line">    - name: é‡åŠ è½½sshd</span><br><span class="line">      systemd:</span><br><span class="line">        name: sshd</span><br><span class="line">        state: reloaded</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Dockerçš„å›¾å½¢ç•Œé¢"><a href="#Dockerçš„å›¾å½¢ç•Œé¢" class="headerlink" title="Dockerçš„å›¾å½¢ç•Œé¢"></a><code>Docker</code>çš„å›¾å½¢ç•Œé¢</h2><ul>
<li><a href="http://www.cnblogs.com/hanxiaohui/p/8528368.html" target="_blank" rel="noopener">docker å“ªäº›å¹³å°æŠ€æœ¯(3)</a></li>
<li><a href="https://github.com/kevana/ui-for-docker" target="_blank" rel="noopener">UI For Docker</a>å·²ç»<code>deprecated</code>,è¿˜æ˜¯ä½¿ç”¨<code>Portainer</code>.</li>
<li><p><a href="https://github.com/portainer/portainer" target="_blank" rel="noopener">Portainer</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$  docker run -d -p 9000:9000 --privileged -v /var/run/docker.sock:/var/run/docker.sock --name web-ui uifd/ui-for-docker</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Portainer</code>æ˜¯ä¸€ä¸ªå¼€æºã€è½»é‡çº§<code>Docker</code>ç®¡ç†ç”¨æˆ·ç•Œé¢,åŸºäº<code>Docker API</code>,æä¾›çŠ¶æ€æ˜¾ç¤ºé¢æ¿ã€åº”ç”¨æ¨¡æ¿å¿«é€Ÿéƒ¨ç½²ã€å®¹å™¨é•œåƒç½‘ç»œæ•°æ®å·çš„åŸºæœ¬æ“ä½œï¼ˆåŒ…æ‹¬ä¸Šä¼ ä¸‹è½½é•œåƒ,åˆ›å»ºå®¹å™¨ç­‰æ“ä½œï¼‰ã€äº‹ä»¶æ—¥å¿—æ˜¾ç¤ºã€å®¹å™¨æ§åˆ¶å°æ“ä½œ<code>Swarm</code>é›†ç¾¤å’ŒæœåŠ¡ç­‰é›†ä¸­ç®¡ç†å’Œæ“ä½œã€ç™»å½•ç”¨æˆ·ç®¡ç†å’Œæ§åˆ¶ç­‰åŠŸèƒ½.åŠŸèƒ½ååˆ†å…¨é¢,åŸºæœ¬èƒ½æ»¡è¶³ä¸­å°å‹å•ä½å¯¹å®¹å™¨ç®¡ç†çš„å…¨éƒ¨éœ€æ±‚.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ docker run -d -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data ã€€-v /etc/hosts:/etc/hosts --name portainer-ui portainer/portainer</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="æ·»åŠ å…¶å®ƒDockeræœåŠ¡å™¨åˆ°portainer"><a href="#æ·»åŠ å…¶å®ƒDockeræœåŠ¡å™¨åˆ°portainer" class="headerlink" title="æ·»åŠ å…¶å®ƒDockeræœåŠ¡å™¨åˆ°portainer"></a>æ·»åŠ å…¶å®ƒ<code>Docker</code>æœåŠ¡å™¨åˆ°<code>portainer</code></h3><ul>
<li><a href="https://docs.docker.com/engine/security/https/" target="_blank" rel="noopener">Protect the Docker daemon socket</a><code>TLS</code>é“¾æ¥å‚è€ƒè¿™é‡Œ.</li>
<li><a href="https://www.portainer.io/2018/10/using-portainer-agent/" target="_blank" rel="noopener">Using the Portainer Agent</a></li>
<li><code>portainer</code>æ·»åŠ å¤–éƒ¨<code>Docker</code>å®ä¾‹æœ‰ä¸‰ç§æ¨¡å¼,ä¸€ç§æ˜¯<code>dockerd -H tcp://192.168.xx.xx:2376</code>,é€šè¿‡ç›‘å¬<code>TCP socket</code>æ–¹å¼.è¿™é‡Œå¯ä»¥ç”¨é€šè¿‡<code>TLS</code>æ¥ä¿è¯å®‰å…¨.ç¬¬äºŒç§å°±æ˜¯åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šå®‰è£…<code>portainer</code>çš„<a href="https://www.portainer.io/2018/10/using-portainer-agent/" target="_blank" rel="noopener">agent</a>.ä»¥ä¸Šä¸¤ç§æ–¹æ³•,åˆ›å»º<code>TLS</code>è¯ä¹¦æ¯”è¾ƒéº»çƒ¦,å®‰è£…<code>agent</code>ä¼šæ¶ˆè€—ä¸€äº›èµ„æº.<a href="https://docs.docker.com/engine/reference/commandline/dockerd/" target="_blank" rel="noopener">Docker</a> ä»<code>18.09</code>å¼€å§‹,å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡<code>SSH</code>è®¿é—®:<code>docker -H ssh://me@example.com ps</code>,ä½†æ˜¯<code>portainer</code>ä¸æ”¯æŒè¿™ç§åè®®æ–¹å¼, åªæ”¯æŒä¸¤ç§åè®®:<code>tcp://</code>,<code>unix://</code>.</li>
<li><p>ä¸‹é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨<code>TLS</code>è¯ä¹¦è¿æ¥è¿œç¨‹çš„ <code>Docker Engine</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºCAç§é’¥</span><br><span class="line">~$ openssl genrsa -aes256 -out ca.key 4096</span><br><span class="line">#ã€€ä½¿å’ŒCAç§é’¥åˆ›å»ºCAè¯ä¹¦.</span><br><span class="line">~$ openssl req -new -x509 -days 365 -key ca.key -sha256 -out ca.pem</span><br><span class="line">#ã€€åˆ›å»ºæœåŠ¡å™¨ç§é’¥åŒ™</span><br><span class="line">~$ã€€openssl genrsa -out server.key 4096</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ›å»ºæœåŠ¡å™¨<code>CSR</code>æ–‡ä»¶.æ³¨æ„<code>CN(Common Name)</code>å¦‚æœæ˜¯åŸŸåå¦‚:<code>www.examples.com</code>,åˆ™å®¢æˆ·ç«¯å¿…é¡»è¿‡<code>www.examples.com</code>è®¿é—®åˆ°è¯¥æœåŠ¡å™¨.æ‰èƒ½éªŒè¯é€šè¿‡.<code>TLS</code>è¿æ¥æ—¶,éœ€è¦é™åˆ¶å®¢æˆ·ç«¯çš„<code>IP</code>æˆ–è€…åŸŸååˆ—è¡¨.å¯ä»¥ç”¨ä½¿ç”¨å¯†é’¥æ‰©å±•æ–‡ä»¶æ”¯æŒ.å¦‚åªå…è®¸<code>127.0.0.1 å’Œ 192.168.1.100</code>å®¢æˆ·ç«¯è®¿é—®.<code>echo subhectAltName = IP:127.0.0.1,IP:192.168.1.100 &gt; allowips.cnf</code>,åœ¨ä¸‹é¢åˆ›å»ºæœåŠ¡å™¨è¯ä¹¦å‘½ä»¤ååŠ ä¸Š<code>-extfile allowips.cnf</code>å°±å¯ä»¥æ”¯æŒäº†.</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ openssl req -subj &quot;/CN=*&quot; -sha256 -new -key server.key -out server.csr</span><br><span class="line">~$ openssl x509 -req -days 365 -sha256 -in server.csr -CA ca.pem -CAkey ca.key -CAcreateserial -out server.pem</span><br><span class="line">Signature ok</span><br><span class="line">subject=CN = *</span><br><span class="line">Getting CA Private Key</span><br><span class="line">Enter pass phrase for ca.key:</span><br></pre></td></tr></table></figure>
<p>-ã€€åˆ›å»ºå®¢æˆ·ç«¯ç§é’¥ä¸<code>CSR</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ openssl genrsa -out client.key 4096</span><br><span class="line">~$ openssl req -subj &quot;/CN=*&quot; -new -key client.key -out client.csr</span><br><span class="line"></span><br><span class="line">#ã€€å¦‚æœéœ€è¦å®¢æˆ·ç«¯çš„éªŒè¯å°±åŠ å…¥ä¸‹é¢çš„æ‰©å±•.</span><br><span class="line">~$ã€€echo extendedKeyUsage = clientAuth &gt; client.cnf</span><br><span class="line">~$ã€€openssl x509 -req -days 365 -sha256 -in client.csr -CA ca.pem -CAkey ca.key -CAcreateserial -out client.pem -extfile client.cnf</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿è¡ŒæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯æµ‹è¯•.ä¸ºä¿è¯å…¬é’¥æ–‡ä»¶å®‰å…¨,éœ€è¦ä¿®æ”¹å…¬é’¥åŒ™æ–‡ä»¶çš„è®¿é—®æƒé™:<code>chmod -v 0400 ca.key server.key client.key</code>.é˜²æ­¢è¯ä¹¦è¢«ç¯¡æ”¹:<br><code>chmod -v 0444 ca.pem server.pem client.pem</code>.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">~$ tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ ca.key</span><br><span class="line">â”œâ”€â”€ ca.pem</span><br><span class="line">â”œâ”€â”€ ca.srl</span><br><span class="line">â”œâ”€â”€ client.key</span><br><span class="line">â”œâ”€â”€ client.pem</span><br><span class="line">â”œâ”€â”€ server.key</span><br><span class="line">â””â”€â”€ server.pem</span><br><span class="line"># æœåŠ¡ç«¯è¿è¡Œ</span><br><span class="line">~$ sudo dockerd --tlsverify --tlscacert=ca.pem --tlscert=server.pem --tlskey=server.key -H tcp://0.0.0.0:2376</span><br><span class="line">#ã€€å®¢æˆ·ç«¯è¿è¡Œ.è¿™é‡Œå¿…é¡»ä½¿ç”¨ä¸»æœºåè¿æ¥,æ‰€ä»¥ä¸Šè¿°portainer-uiå®¹å™¨è¿è¡Œ,ä½¿ç”¨ã€€-v /etc/hosts:/etc/hostsã€€é€‰é¡¹.</span><br><span class="line">~$ docker --tlsverify --tlscacert=ca.pem --tlscert=client.pem --tlskey=client.key -H tcp://&lt;ä¸»æœºå&gt;:2376 version</span><br><span class="line">#ã€€Docker ä» 18.09 å¼€å§‹æ”¯æŒé€šè¿‡SSHè®¿é—®,è¿™ä¸ªæ›´å®‰å…¨æ›´ä¾¿æ·.</span><br><span class="line">~$ã€€docker -H ssh://user@domain.com version</span><br><span class="line">Client:</span><br><span class="line"> Version:           18.09.1</span><br><span class="line"> API version:       1.39</span><br><span class="line"> Go version:        go1.10.6</span><br><span class="line"> Git commit:        4c52b90</span><br><span class="line"> Built:             Wed Jan  9 19:35:59 2019</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      false</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          18.09.1</span><br><span class="line">  API version:      1.39 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.10.6</span><br><span class="line">  Git commit:       4c52b90</span><br><span class="line">  Built:            Wed Jan  9 19:02:44 2019</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="ä¿®æ”¹æœåŠ¡ç«¯systemd-service"><a href="#ä¿®æ”¹æœåŠ¡ç«¯systemd-service" class="headerlink" title="ä¿®æ”¹æœåŠ¡ç«¯systemd service"></a>ä¿®æ”¹æœåŠ¡ç«¯<code>systemd service</code></h4><ul>
<li>å¸¦è¯ä¹¦å¯åŠ¨çš„<code>docker</code>è¿›ç¨‹å¯ä»¥æŒ‰ç…§ä¸Šè¿°çš„æ‰‹åŠ¨è¿è¡Œçš„å½¢å¼,ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹ç³»ç»Ÿçš„<code>systemed</code>æ¥å¼€å¯,æŠŠæœåŠ¡ç«¯çš„è¯ä¹¦æ–‡ä»¶å¤åˆ¶åˆ°<code>/etc/docker/</code>ä¸‹é¢.æ–¹æ³•å¦‚ä¸‹:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ cat /lib/systemd/system/docker.service</span><br><span class="line">[...]</span><br><span class="line">#ExecStart=/usr/bin/dockerd -H fd://ã€€ã€€è¿™æ˜¯åŸæ¥é»˜è®¤çš„,åªå¼€æ”¾æœ¬åœ°è¿æ¥.</span><br><span class="line">ExecStart=/usr/bin/dockerd --tlsverify --tlscacert=/etc/docker/ca.pem --tlscert=/etc/docker/server.pem --tlskey=/etc/docker/server.key -H tcp://0.0.0.0:2376ã€€-H fd://</span><br><span class="line">[...]</span><br><span class="line">~$ sudo systemctl daemon-reload   #é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶.</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="å¼€å¯å®¢æˆ·ç«¯é»˜è®¤è¯ä¹¦æ¨¡å¼"><a href="#å¼€å¯å®¢æˆ·ç«¯é»˜è®¤è¯ä¹¦æ¨¡å¼" class="headerlink" title="å¼€å¯å®¢æˆ·ç«¯é»˜è®¤è¯ä¹¦æ¨¡å¼"></a>å¼€å¯å®¢æˆ·ç«¯é»˜è®¤è¯ä¹¦æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ mkdir -pv ~/.docker</span><br><span class="line">~$ cp ca.pem ~/.docker</span><br><span class="line">~$ cp client.key ~/.docker/key.pem # ä¸€å®šè¦æ”¹è¿™ä¸ªåå­—</span><br><span class="line">~$ cp client.pem ~/.docker/cert.pemã€€# ä¸€å®šè¦æ”¹è¿™ä¸ªåå­—</span><br><span class="line">~$ export DOCKER_HOST=tcp://&lt;HOST&gt;:2376 DOCKER_TLS_VERIFY=1</span><br><span class="line">~$ docker ps ã€€ã€€#ã€€è¯ä¹¦æ¨¡å¼è¿æ¥</span><br></pre></td></tr></table></figure>
<h2 id="Dockeré”™è¯¯"><a href="#Dockeré”™è¯¯" class="headerlink" title="Dockeré”™è¯¯"></a><code>Docker</code>é”™è¯¯</h2><ul>
<li>å¦‚æœå‡ºç°å¦‚ä¸‹çš„é”™è¯¯,è¦ä½¿ç”¨<code>systemctl restart docker.service</code>æ‰èƒ½è§£å†³.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker: Error response from daemon: driver failed programming external connectivity on endpoint condescending_lalande (668389b4f87cc892fc233313eb738d0995c4080d3daabf28bf8c9bbe241a5434):  (iptables failed: iptables --wait -t filter -A DOCKER ! -i docker0 -o docker0 -p tcp -d 172.17.0.2 --dport 9000 -j ACCEPT: iptables: No chain/target/match by that name.</span><br><span class="line"> (exit status 1)).</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Ansibleä¸Dockeré›†æˆä½¿ç”¨"><a href="#Ansibleä¸Dockeré›†æˆä½¿ç”¨" class="headerlink" title="Ansibleä¸Dockeré›†æˆä½¿ç”¨"></a><code>Ansible</code>ä¸<code>Docker</code>é›†æˆä½¿ç”¨</h2><ul>
<li><p>æ“ä½œ<code>VOLUME</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">~$ docker volume create redis_vol</span><br><span class="line">~$ docker volume inspect redis_vol</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2019-01-09T17:28:44+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/redis_vol/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;redis_vol&quot;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"># åˆ é™¤æ‰€æœ‰çš„å·</span><br><span class="line">~$ docker volume prune</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¿…é¡»å®‰è£…<code>docker-py</code>,ä¸‹é¢é€šè¿‡ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¾‹å­æ¥è¯´æ˜.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#ã€€å¦‚æœæ˜¯python3çš„è¯,æœ‰äº›æ¨¡å—ä¼šæç¤ºè¦æ¢æˆå®‰è£…:ã€€pip3 install docker</span><br><span class="line">~$ pip install docker-py</span><br><span class="line">~$ tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ main.yaml</span><br><span class="line">â”œâ”€â”€ pgsql</span><br><span class="line">â”‚   â”œâ”€â”€ file</span><br><span class="line">â”‚   â”‚   â””â”€â”€ Dockerfile</span><br><span class="line">â”‚   â””â”€â”€ pgsql.yaml</span><br><span class="line">â””â”€â”€ redis</span><br><span class="line">    â”œâ”€â”€ file</span><br><span class="line">    â”‚   â””â”€â”€ Dockerfile</span><br><span class="line">    â””â”€â”€ redis.yaml</span><br></pre></td></tr></table></figure>
</li>
<li><p>main.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: DB001</span><br><span class="line">  become: yes</span><br><span class="line">  tasks:</span><br><span class="line">    - include: pgsql/pgsql.yaml</span><br><span class="line">    - include: redis/redis.yaml</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="RedisæœåŠ¡å™¨"><a href="#RedisæœåŠ¡å™¨" class="headerlink" title="RedisæœåŠ¡å™¨"></a><code>Redis</code>æœåŠ¡å™¨</h3><ul>
<li><a href="https://docs.docker.com/samples/library/redis/" target="_blank" rel="noopener">https://docs.docker.com/samples/library/redis/</a></li>
<li><a href="https://github.com/docker-library/redis" target="_blank" rel="noopener">https://github.com/docker-library/redis</a></li>
<li><p>Dockerfile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…redisæœåŠ¡</span><br><span class="line">FROM debian:stretch</span><br><span class="line"># CMD echo &quot;hello debian from Dockerfile.&quot;</span><br><span class="line"># https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-debian-9</span><br><span class="line">ENV DEBIAN_FRONTEND noninteractive</span><br><span class="line"></span><br><span class="line">RUN sed -i &quot;s/deb.debian.org/mirrors.cloud.aliyuncs.com/g&quot; /etc/apt/sources.list</span><br><span class="line">RUN apt-get update  &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get -y install redis-server</span><br><span class="line"># RUN sed -i &apos;s/^appendonly no$/appendonly yes/g&apos; /etc/redis/redis.conf</span><br><span class="line"># RUN sed -i &apos;s/^daemonize yes$/daemonize no/g&apos; /etc/redis/redis.conf</span><br><span class="line">EXPOSE 6379/tcp</span><br><span class="line"># CMD [ &quot;/etc/init.d/redis-server start&quot; ]</span><br><span class="line">USER root</span><br><span class="line">RUN  rm -rf /data</span><br><span class="line">RUN mkdir /data &amp;&amp; chown redis:redis -R  /data</span><br><span class="line">VOLUME [&quot;/data&quot; ]</span><br><span class="line">RUN chown redis:redis -R  /data</span><br><span class="line">CMD [&quot;redis-server&quot;,&quot;/etc/redis/redis.conf&quot;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>redis.yaml</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- name: åˆ›å»ºWORKDIR</span><br><span class="line">  file:</span><br><span class="line">    path: workdir</span><br><span class="line">    state: directory</span><br><span class="line">    recurse: yes</span><br><span class="line"></span><br><span class="line">- name: ä¸Šä¼ Dockerfileåˆ°ç›®æ ‡æœºçš„/tmp</span><br><span class="line">  # https://docs.ansible.com/ansible/latest/modules/synchronize_module.html?highlight=synchronize</span><br><span class="line">  synchronize:</span><br><span class="line">    src: redis/file/Dockerfile</span><br><span class="line">    dest: workdir</span><br><span class="line"></span><br><span class="line">- name: Redis Server</span><br><span class="line">  # å‚è€ƒåœ°å€ https://docs.ansible.com/ansible/latest/modules/docker_container_module.html?highlight=docker</span><br><span class="line">  docker_image:</span><br><span class="line">    name: redis</span><br><span class="line">    tag: v6</span><br><span class="line">    path: workdir</span><br><span class="line">    state: present</span><br><span class="line"></span><br><span class="line">- name: åˆ›å»ºVOLUMEçš„ç›®å½•</span><br><span class="line">  # https://docs.ansible.com/ansible/latest/modules/file_module.html</span><br><span class="line">  become: yes</span><br><span class="line">  file:</span><br><span class="line">    path: ./redis-vol</span><br><span class="line">    state: directory</span><br><span class="line">    # è¿™é‡Œè¿™äº†é¿å…ä½¿ç”¨rootè¿è¡Œdocker,åŒæ—¶ä¹Ÿé¿å…ä½¿ç”¨rootè¿è¡Œredis-server,æŠŠè¿™ä¸ªå·ç›®å½•æ‰€æœ‰è€…æ”¹æˆdockeré‡Œçš„redisçš„uid:gidçš„å€¼,æ‰èƒ½æ»¡è¶³å‰è¿°ä½¿ç”¨.è¿™é‡Œä¸º101</span><br><span class="line">    owner: 101</span><br><span class="line">    group: 101</span><br><span class="line">    recurse: yes</span><br><span class="line"></span><br><span class="line">- name: create volume</span><br><span class="line">  # è¿™é‡Œä½¿ç”¨ã€€docker_volumeã€€è¿™ä¸ªæ¨¡å—æœ‰é—®é¢˜,åªèƒ½ä½¿ä¸‹é¢çš„å‘½ä»¤åˆ›å»ºå·.åˆ›å»ºå·ä¸èƒ½æŒ‡å®šè·¯å¾„,ä½†æ˜¯å¯ä»¥ä½¿ç”¨å¦‚: --opt type:ext4 --opt device=/dev/sdX è¿™ä¸ªdeviceå¿…é¡»æ˜¯åˆ†åŒº,å—è®¾å¤‡,ä¸èƒ½æ˜¯ç›®å½•.</span><br><span class="line">  command: docker volume create redis_vol3</span><br><span class="line"></span><br><span class="line">- name: Redis server</span><br><span class="line">  # å‚è€ƒåœ°å€ https://docs.ansible.com/ansible/latest/modules/docker_container_module.html?highlight=docker</span><br><span class="line">  docker_container:</span><br><span class="line">    name: redis-server</span><br><span class="line">    # å¯¹åº”ä¸Šé¢åˆ›å»ºçš„é•œåƒ.</span><br><span class="line">    image: &apos;redis:v6&apos;</span><br><span class="line">    # command: redis-server --apendonly yes</span><br><span class="line">    state: started</span><br><span class="line">    recreate: yes</span><br><span class="line">    user: redis</span><br><span class="line">    # è®¾ç½®å¯†ç ç™»å½•,1234</span><br><span class="line">    command: redis-server  --requirepass 1234 --appendonly yes --dir /data</span><br><span class="line">    published_ports:</span><br><span class="line">      - &apos;6379:6379&apos;</span><br><span class="line">    volumes:</span><br><span class="line">      - ./redis-vol:/data</span><br></pre></td></tr></table></figure>
<ul>
<li>æµ‹è¯• Redis æœåŠ¡.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~$ redis-cli</span><br><span class="line">127.0.0.1:6379&gt; auth 1234</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set dd 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; save  # å†™å…¥ç£ç›˜.</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; exit</span><br><span class="line"></span><br><span class="line">~$ redis-cli</span><br><span class="line">127.0.0.1:6379&gt; auth 1234</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get dd</span><br><span class="line">&quot;100&quot;</span><br><span class="line">127.0.0.1:6379&gt; config get dirã€€#ã€€æŸ¥çœ‹ç³»ç»Ÿçš„ç›®å½•.</span><br><span class="line">1) &quot;dir&quot;</span><br><span class="line">2) &quot;/data&quot;</span><br><span class="line">127.0.0.1:6379&gt; quit</span><br></pre></td></tr></table></figure>
<h3 id="Postgresqlæ•°æ®åº“"><a href="#Postgresqlæ•°æ®åº“" class="headerlink" title="Postgresqlæ•°æ®åº“"></a><code>Postgresql</code>æ•°æ®åº“</h3><ul>
<li><p>æ¯”è¾ƒå¤æ‚çš„å®ä¾‹å¯ä»¥å‚è€ƒ<a href="https://github.com/sameersbn/docker-postgresql" target="_blank" rel="noopener">docker-postgresql</a>,è¿™ä¸ªæ”¯æŒ<code>ENTRYPOINT</code>å‚æ•°,ä¸»ä»å¤åˆ¶åŠŸèƒ½.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">~$ cat Dockerfile</span><br><span class="line"># å‚è€ƒè¿™é‡Œ https://docs.docker.com/engine/examples/postgresql_service/#install-postgresql-on-docker</span><br><span class="line">FROM debian:stretch</span><br><span class="line">MAINTAINER lcy</span><br><span class="line"></span><br><span class="line">ENV DEBIAN_FRONTEND noninteractive</span><br><span class="line"># æ·»åŠ è¿™ä¸€è¡Œæ˜¯ä¸ºäº†é¿å…ä¸‹é¢çš„é”™è¯¯:</span><br><span class="line"># -----------------------------------------------</span><br><span class="line"># debconf: unable to initialize frontend: Dialog</span><br><span class="line"># debconf: (Dialog frontend will not work on a dumb terminal, an emacs shell buffer, or without a controlling terminal.)</span><br><span class="line"># debconf: falling back to frontend: Readline</span><br><span class="line"># debconf: unable to initialize frontend: Readline</span><br><span class="line"># debconf: (Can&apos;t locate Term/ReadLine.pm in @INC (@INC contains: /etc/perl /usr/local/lib/perl/5.14.2 /usr/local/share/perl/5.14.2 /usr/lib/perl5 /usr/share/perl5 /usr/lib/perl/5.14 /usr/share/perl/5.14 /usr/local/lib/site_perl .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7, &lt;&gt; line 19.)</span><br><span class="line"># debconf: falling back to frontend: Teletype</span><br><span class="line"># dpkg-preconfigure: unable to re-open stdin:</span><br><span class="line">#------------------------------------------------</span><br><span class="line"></span><br><span class="line"># RUN echo &apos;debconf debconf/frontend select Noninteractive&apos; | debconf-set-selections</span><br><span class="line"># Add the PostgreSQL PGP key to verify their Debian packages.</span><br><span class="line"># It should be the same key as https://www.postgresql.org/media/keys/ACCC4CF8.asc</span><br><span class="line"># è¿™é‡Œå› ä¸ºéƒ¨ç½²åœ¨é˜¿é‡Œäº‘ä¸Š,æ‰€ä»¥æŠŠè½¯ä»¶ä»“åº“æ”¹æˆé˜¿é‡Œäº‘,åŠ é€Ÿä¸‹è½½,ä¸”å…æµé‡.</span><br><span class="line">RUN sed -i &quot;s/deb.debian.org/mirrors.cloud.aliyuncs.com/g&quot; /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line">ENV PG_VERSION=10</span><br><span class="line">ENV PG_USER=postgres</span><br><span class="line">ENV PG_HOME=/var/lib/postgresql</span><br><span class="line">ENV PG_RUNDIR=/run/postgresql \</span><br><span class="line">    PG_LOGDIR=/var/log/postgresql \</span><br><span class="line">    PG_DATADIR=$&#123;PG_HOME&#125;/$&#123;PG_VERSION&#125;/main \</span><br><span class="line">    PG_BINDIR=/usr/lib/postgresql/$&#123;PG_VERSION&#125;/bin \</span><br><span class="line">    PG_CONFIG=/etc/postgresql/$&#123;PG_VERSION&#125;/main/postgresql.conf</span><br><span class="line"></span><br><span class="line"># ä¸‹é¢ä¸¤ä¸ªæ˜¯å¿…éœ€å®‰è£…æ‰èƒ½,æ‰èƒ½ç”¨apt-keyæ·»åŠ å…¬é’¥</span><br><span class="line">RUN apt-get update  &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get install -y  apt-utils  dirmngr gnupg2</span><br><span class="line"></span><br><span class="line"># CMD [&quot;ping&quot;,&quot;-c&quot;,&quot;5&quot;,&quot;p80.pool.sks-keyservers.net&quot;] è¿™é‡Œæœ‰å¯èƒ½ä¼šè¿è¡Œå¤±è´¥,å¦‚:è¯»ä¸åˆ°æ•°æ®,æ²¡æœ‰è§£æçš„åŸŸååœ°å€ç­‰.</span><br><span class="line">RUN apt-key adv --no-tty --keyserver ipv4.pool.sks-keyservers.net --recv-keys B97B0AFCAA1A47F044F244A07FCC7D46ACCC4CF8</span><br><span class="line"></span><br><span class="line"># Add PostgreSQL&apos;s repository. It contains the most recent stable release</span><br><span class="line">#     of PostgreSQL, ``10``.</span><br><span class="line">RUN echo &quot;deb http://apt.postgresql.org/pub/repos/apt/ stretch-pgdg main&quot; &gt; /etc/apt/sources.list.d/pgdg.list</span><br><span class="line"></span><br><span class="line"># Install ``python-software-properties``, ``software-properties-common`` and PostgreSQL 10.6</span><br><span class="line">#  There are some warnings (in red) that show up during the build. You can hide</span><br><span class="line">#  them by prefixing each apt-get statement with DEBIAN_FRONTEND=noninteractive</span><br><span class="line"></span><br><span class="line">RUN apt-get update &amp;&amp; DEBIAN_FRONTEND=noninteractive  apt-get install -y software-properties-common postgresql-10 postgresql-client-10 postgresql-contrib-10</span><br><span class="line"># è¿™é‡Œè¦æ³¨æ„æ–‡ä»¶è·¯å¾„çš„rwxæƒé™é—®é¢˜.</span><br><span class="line">USER root</span><br><span class="line">RUN mkdir -p $&#123;PG_DATADIR&#125; &amp;&amp; chown -R postgres:postgres $&#123;PG_DATADIR&#125;</span><br><span class="line">RUN mkdir -p $&#123;PG_LOGDIR&#125; &amp;&amp; chown -R postgres:postgres $&#123;PG_LOGDIR&#125;</span><br><span class="line"></span><br><span class="line"># Adjust PostgreSQL configuration so that remote connections to the</span><br><span class="line"># database are possible.</span><br><span class="line">USER postgres</span><br><span class="line">RUN echo &quot;host all  all    0.0.0.0/0  md5&quot; &gt;&gt; /etc/postgresql/10/main/pg_hba.conf</span><br><span class="line"></span><br><span class="line"># And add ``listen_addresses`` to ``/etc/postgresql/10.6/main/postgresql.conf``</span><br><span class="line">RUN echo &quot;listen_addresses=&apos;*&apos;&quot; &gt;&gt; /etc/postgresql/10/main/postgresql.conf</span><br><span class="line"></span><br><span class="line"># Create a PostgreSQL role named ``docker`` with ``docker`` as the password and</span><br><span class="line"># then create a database `docker` owned by the ``docker`` role.</span><br><span class="line"># Note: here we use ``&amp;&amp;\`` to run commands one after the other - the ``\``</span><br><span class="line">#       allows the RUN command to span multiple lines.</span><br><span class="line">RUN  /etc/init.d/postgresql start &amp;&amp; psql --command &quot;CREATE USER docker WITH SUPERUSER PASSWORD &apos;docker&apos;;&quot; &amp;&amp; createdb -O docker docker</span><br><span class="line"></span><br><span class="line"># Expose the PostgreSQL port</span><br><span class="line">EXPOSE 5432/tcp</span><br><span class="line"># Add VOLUMEs to allow backup of config, logs and databases</span><br><span class="line">VOLUME  [&quot;/etc/postgresql&quot;, &quot;/var/log/postgresql&quot;, &quot;/var/lib/postgresql/10/main&quot;]</span><br><span class="line"># RUN  $&#123;PG_BINDIR&#125;/initdb -D $&#123;PG_DATADIR&#125;</span><br><span class="line"></span><br><span class="line"># Set the default command to run when starting the container</span><br><span class="line"># è¿™é‡Œå¦‚æœæ˜¯9.6ç‰ˆæœ¬é‚£å°±è¦å†™æˆ/usr/lib/postgresql/9.6/bin/postgres.å¥½åƒ10.6å°±ç›´æ¥å¦‚ä¸‹é¢å†™å°±å¯ä»¥äº†.</span><br><span class="line">CMD [&quot;/usr/lib/postgresql/10/bin/postgres&quot;, &quot;-D&quot;, &quot;/var/lib/postgresql/10/main&quot;, &quot;-c&quot;, &quot;config_file=/etc/postgresql/10/main/postgresql.conf&quot;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>pgsql.yaml</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- name: åˆ›å»ºWORKDIR</span><br><span class="line">  file:</span><br><span class="line">    path: workdir</span><br><span class="line">    state: directory</span><br><span class="line">    recurse: yes</span><br><span class="line"></span><br><span class="line">- name: ä¸Šä¼ Dockerfileåˆ°ç›®æ ‡æœºçš„/tmp</span><br><span class="line">  # https://docs.ansible.com/ansible/latest/modules/synchronize_module.html?highlight=synchronize</span><br><span class="line">  synchronize:</span><br><span class="line">    src: pgsql/file/Dockerfile</span><br><span class="line">    dest: workdir</span><br><span class="line"></span><br><span class="line">- name: ç¼–è¯‘PostgreSQL Serveré•œåƒ</span><br><span class="line">  # å‚è€ƒåœ°å€ https://docs.ansible.com/ansible/latest/modules/docker_image_module.html?highlight=docker_image</span><br><span class="line">  # https://www.postgresql.org/download/linux/debian/</span><br><span class="line">  docker_image:</span><br><span class="line">    name: postgresql-10</span><br><span class="line">    tag: v6</span><br><span class="line">    path: workdir</span><br><span class="line">    # dockerfile: file/Dockerfile</span><br><span class="line">    state: present</span><br><span class="line"></span><br><span class="line">- name: åˆ›å»ºVOLUMEçš„ç›®å½•</span><br><span class="line">  # https://docs.ansible.com/ansible/latest/modules/file_module.html</span><br><span class="line">  become: yes</span><br><span class="line">  file:</span><br><span class="line">    path: ./pgsql-vol/10/main</span><br><span class="line">    state: directory</span><br><span class="line">    # è¿™é‡Œè¿™äº†é¿å…ä½¿ç”¨rootè¿è¡Œdocker,åŒæ—¶ä¹Ÿé¿å…ä½¿ç”¨rootè¿è¡Œpostgresql,æŠŠè¿™ä¸ªå·ç›®å½•æ‰€æœ‰è€…æ”¹æˆdockeré‡Œçš„postgresçš„uid:gidçš„å€¼,æ‰èƒ½æ»¡è¶³å‰è¿°ä½¿ç”¨.è¿™é‡Œä¸ºuid=111(postgres) gid=121(postgres) groups=121(postgres),120(ssl-cert)</span><br><span class="line">    owner: postgres</span><br><span class="line">    group: postgres</span><br><span class="line">    recurse: yes</span><br><span class="line"></span><br><span class="line"># # https://docs.ansible.com/ansible/latest/modules/docker_volume_module.html?highlight=docker_volume</span><br><span class="line"># - name: åˆ›å»ºæ•°æ®å®¹å™¨å·</span><br><span class="line">#   docker_volume:</span><br><span class="line">#       name: pgdb_001</span><br><span class="line">#       driver_options:</span><br><span class="line">#           device: ./docker/volume/pgsql-vol</span><br><span class="line"></span><br><span class="line">- name: åˆ›å»º postgresql å®¹å™¨</span><br><span class="line">  # å‚è€ƒåœ°å€ https://docs.ansible.com/ansible/latest/modules/docker_container_module.html?highlight=docker</span><br><span class="line">  # è¿™é‡Œå¯ä»¥ç­‰åŒäºcommandæ¨¡å—çš„å‘½ä»¤:  ``command: docker run -p 5432:5432 -d --name pgsql7 --user postgres  -v ~/pgsql-vol:/var/lib/postgresql postgresql-10:v6``</span><br><span class="line">  docker_container:</span><br><span class="line">    name: pgsql</span><br><span class="line">    image: &apos;postgresql-10:v6&apos;</span><br><span class="line">    # docker ç½‘ç»œéƒ¨åˆ† https://docs.ansible.com/ansible/latest/modules/docker_network_module.html</span><br><span class="line">    # network_mode: host</span><br><span class="line">    dns_servers:</span><br><span class="line">      - &apos;8.8.8.8&apos;</span><br><span class="line">      - &apos;100.100.2.136&apos;</span><br><span class="line">    published_ports:</span><br><span class="line">      - &apos;5432:5432&apos;</span><br><span class="line">    state: started</span><br><span class="line">    # restart_policy: always</span><br><span class="line">    # detach: no</span><br><span class="line">    user: postgres</span><br><span class="line">    # https://www.katacoda.com/courses/docker/persisting-data-using-volumes</span><br><span class="line">    volumes:</span><br><span class="line">      - ./pgsql-vol:/var/lib/postgresql</span><br></pre></td></tr></table></figure>
<h2 id="Jenkinså®‰è£…"><a href="#Jenkinså®‰è£…" class="headerlink" title="Jenkinså®‰è£…"></a><code>Jenkins</code>å®‰è£…</h2><ul>
<li><a href="https://jenkins.io/doc/book/installing" target="_blank" rel="noopener">Installing Jenkins</a></li>
<li><a href="https://wiki.jenkins.io/display/JENKINS/Ansible+Plugin" target="_blank" rel="noopener">Ansible Plugin</a></li>
</ul>
<h1 id="è°¢è°¢æ”¯æŒ"><a href="#è°¢è°¢æ”¯æŒ" class="headerlink" title="è°¢è°¢æ”¯æŒ"></a>è°¢è°¢æ”¯æŒ</h1><ul>
<li>å¾®ä¿¡äºŒç»´ç :</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/26/STM32ä¸RTOSå®è·µ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/26/STM32ä¸RTOSå®è·µ/" class="post-title-link" itemprop="url">STM32ä¸RTOSå®å®è·µ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-09-26 23:07:59" itemprop="dateCreated datePublished" datetime="2020-09-26T23:07:59+08:00">2020-09-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-08-04 23:47:22" itemprop="dateModified" datetime="2022-08-04T23:47:22+08:00">2022-08-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>å‚è€ƒé“¾æ¥<ul>
<li><a href="https://www.st.com/en/evaluation-tools/nucleo-f767zi.html" target="_blank" rel="noopener">Nucleo F767ZI website.</a></li>
<li><a href="https://www.st.com/resource/en/reference_manual/dm00224583-stm32f76xxx-and-stm32f77xxx-advanced-armbased-32bit-mcus-stmicroelectronics.pdf" target="_blank" rel="noopener">RM0410 STM32F76xxx and STM32F77xxx advanced ArmÂ®-based 32-bit MCUs 4.0.PDF</a></li>
<li><a href="https://www.st.com/resource/en/datasheet/stm32f767zi.pdf" target="_blank" rel="noopener">stm32f767zi.pdf</a></li>
<li><a href="https://elinux.org/STM32" target="_blank" rel="noopener">elinux.org</a></li>
</ul>
</li>
</ul>
<h1 id="å¼€å‘æ¿ç®€ä»‹"><a href="#å¼€å‘æ¿ç®€ä»‹" class="headerlink" title="å¼€å‘æ¿ç®€ä»‹"></a>å¼€å‘æ¿ç®€ä»‹</h1><ul>
<li>The STM32 Nucleo-144 F767ZI boards offer combinations of performance and power that provide an affordable and flexible<br>way for users to build prototypes and try out new concepts. For compatible boards, the SMPS significantly reduces power<br>consumption in Run mode.</li>
<li>The Arduino-compatible ST Zio connector expands functionality of the Nucleo open development platform, with a wide choice<br>of specialized Arduino* Uno V3 shields.</li>
<li>The STM32 Nucleo-144 board does not require any separate probe as it integrates the ST-LINK/V2-1 debugger/programmer.</li>
<li>The STM32 Nucleo-144 board comes with the STM32 comprehensive free software libraries and examples available with the<br>STM32Cube MCU Package.</li>
</ul>
<ul>
<li>Key Features<ul>
<li>STM32 microcontroller in LQFP144 package</li>
<li>Ethernet compliant with IEEE-802.3-2002 (depending on STM32 support)</li>
<li>USB OTG or full-speed device (depending on STM32 support)</li>
<li>3 user LEDs</li>
<li>2 user and reset push-buttons</li>
<li>32.768 kHz crystal oscillator</li>
<li>Board connectors:<ul>
<li>USB with Micro-AB</li>
<li>SWD</li>
<li>Ethernet RJ45 (depending on STM32 support)</li>
<li>ST Zio connector including Arduino* Uno V3</li>
<li>ST morpho</li>
</ul>
</li>
<li>Flexible power-supply options: ST-LINK USB VBUS or external sources.</li>
<li>On-board ST-LINK/V2-1 debugger/programmer with USB re-enumeration</li>
<li>capability: mass storage, virtual COM port and debug port.</li>
<li>Comprehensive free software libraries and examples available with the STM32Cube MCU package.</li>
</ul>
</li>
<li>æ ¹æ®æ–‡æ¡£<code>The Cortex Â® -M7 with FPU core is binary compatible with the Cortex Â® -M4 core.</code>è¯´æ˜ ,Cortex-M7å†…æ ¸æ¯”M4æ€§æ›´<br>é«˜,ä¸”äºŒè¿›åˆ¶å…¼å®¹.</li>
</ul>
<h1 id="Zephyr"><a href="#Zephyr" class="headerlink" title="Zephyr"></a>Zephyr</h1><ul>
<li><a href="https://docs.zephyrproject.org/latest/boards/arm/nucleo_f767zi/doc/index.html" target="_blank" rel="noopener">ST Nucleo F767ZI</a></li>
</ul>
<h2 id="ç³»ç»Ÿç®€ä»‹"><a href="#ç³»ç»Ÿç®€ä»‹" class="headerlink" title="ç³»ç»Ÿç®€ä»‹"></a>ç³»ç»Ÿç®€ä»‹</h2><ul>
<li><code>Zephyr</code> å†…æ ¸æ˜¯ä¸€ä¸ªå†…å­˜å ç”¨æä½çš„å†…æ ¸,å®ƒä¸»è¦è®¾è®¡ç”¨äºèµ„æºå—é™ç³»ç»Ÿ:ä»ç®€å•çš„åµŒå…¥å¼ç¯å¢ƒä¼ æ„Ÿå™¨ã€LED å¯ç©¿æˆ´è®¾å¤‡,åˆ°å¤æ‚çš„æ™ºèƒ½æ‰‹è¡¨ã€IoT æ— çº¿ç½‘å…³.<code>Zephyr</code> åœ¨è¢«è®¾è®¡æ—¶å°±æ”¯æŒå¤šæ¶æ„,åŒ…æ‹¬<code>ARM Cortex-M</code>,<code>Intel x86</code>,<code>ARC</code>,<code>NIOS II</code> å’Œ <code>RISC V</code>.ä½¿ç”¨<code>Zephyr</code>çš„ä¸€å¤§ä¼˜ç‚¹æ˜¯æ“ä½œç³»ç»Ÿ(OS)å’Œè½¯ä»¶å¼€å‘å·¥å…·åŒ…(SDK)å¯æ”¯æŒæ•°ç™¾ä¸ªå¼€å‘æ¿.</li>
</ul>
<h2 id="å®‰è£…Zephyrç¯å¢ƒ"><a href="#å®‰è£…Zephyrç¯å¢ƒ" class="headerlink" title="å®‰è£…Zephyrç¯å¢ƒ"></a>å®‰è£…Zephyrç¯å¢ƒ</h2><h3 id="åˆå§‹åŒ–å·¥ç¨‹"><a href="#åˆå§‹åŒ–å·¥ç¨‹" class="headerlink" title="åˆå§‹åŒ–å·¥ç¨‹"></a>åˆå§‹åŒ–å·¥ç¨‹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ pip3 install west</span><br><span class="line">~$ west init ~/zephyrproject</span><br><span class="line">~$ <span class="built_in">cd</span> zephyrproject</span><br><span class="line">~$ west update  <span class="comment"># è¿™é‡Œä¼šé€šè¿‡west,åŒæ­¥å¤§é‡çš„gitåº“.</span></span><br><span class="line">~$ west zephyr-export</span><br></pre></td></tr></table></figure>
<ul>
<li>æ›´æ–°åçš„ç›®å½•ç»“æ„å¦‚ä¸‹:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">~ zephyrproject$ tree -L 2</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ bootloader</span><br><span class="line">â”‚   â””â”€â”€ mcuboot</span><br><span class="line">â”œâ”€â”€ modules</span><br><span class="line">â”‚   â”œâ”€â”€ bsim_hw_models</span><br><span class="line">â”‚   â”œâ”€â”€ crypto</span><br><span class="line">â”‚   â”œâ”€â”€ debug</span><br><span class="line">â”‚   â”œâ”€â”€ fs</span><br><span class="line">â”‚   â”œâ”€â”€ hal</span><br><span class="line">â”‚   â”œâ”€â”€ lib</span><br><span class="line">â”‚   â””â”€â”€ tee</span><br><span class="line">â”œâ”€â”€ tools</span><br><span class="line">â”‚   â”œâ”€â”€ ci-tools</span><br><span class="line">â”‚   â”œâ”€â”€ edtt</span><br><span class="line">â”‚   â””â”€â”€ net-tools</span><br><span class="line">â””â”€â”€ zephyr</span><br><span class="line">    â”œâ”€â”€ arch</span><br><span class="line">    â”œâ”€â”€ boards</span><br><span class="line">    â”œâ”€â”€ cmake</span><br><span class="line">    â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">    â”œâ”€â”€ CODE_OF_CONDUCT.md</span><br><span class="line">    â”œâ”€â”€ CODEOWNERS</span><br><span class="line">    â”œâ”€â”€ CONTRIBUTING.rst</span><br><span class="line">    â”œâ”€â”€ doc</span><br><span class="line">    â”œâ”€â”€ drivers</span><br><span class="line">    â”œâ”€â”€ dts</span><br><span class="line">    â”œâ”€â”€ include</span><br><span class="line">    â”œâ”€â”€ Kconfig</span><br><span class="line">    â”œâ”€â”€ Kconfig.zephyr</span><br><span class="line">    â”œâ”€â”€ kernel</span><br><span class="line">    â”œâ”€â”€ lib</span><br><span class="line">    â”œâ”€â”€ LICENSE</span><br><span class="line">    â”œâ”€â”€ MAINTAINERS.yml</span><br><span class="line">    â”œâ”€â”€ Makefile</span><br><span class="line">    â”œâ”€â”€ misc</span><br><span class="line">    â”œâ”€â”€ modules</span><br><span class="line">    â”œâ”€â”€ README.rst</span><br><span class="line">    â”œâ”€â”€ samples</span><br><span class="line">    â”œâ”€â”€ scripts</span><br><span class="line">    â”œâ”€â”€ share</span><br><span class="line">    â”œâ”€â”€ soc</span><br><span class="line">    â”œâ”€â”€ subsys</span><br><span class="line">    â”œâ”€â”€ tests</span><br><span class="line">    â”œâ”€â”€ VERSION</span><br><span class="line">    â”œâ”€â”€ version.h.in</span><br><span class="line">    â”œâ”€â”€ west.yml</span><br><span class="line">    â”œâ”€â”€ zephyr-env.cmd</span><br><span class="line">    â””â”€â”€ zephyr-env.sh</span><br><span class="line"></span><br><span class="line">32 directories, 15 files</span><br></pre></td></tr></table></figure>
<ul>
<li>å®‰è£…å¤§é‡çš„Pythonä¾èµ–åº“<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~ zephyrproject$  pip install -r ./zephyr/scripts/requirements.txt</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å®‰è£…å·¥å…·é“¾"><a href="#å®‰è£…å·¥å…·é“¾" class="headerlink" title="å®‰è£…å·¥å…·é“¾"></a>å®‰è£…å·¥å…·é“¾</h3><ul>
<li>æœ€æ–°çš„å‘è¡Œç‰ˆ<a href="https://github.com/zephyrproject-rtos/sdk-ng/releases" target="_blank" rel="noopener">ä¸‹è½½æœ€æ–°ç‰ˆ</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ wget https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v0.11.4/zephyr-sdk-0.11.4-setup.run</span><br><span class="line">~$ chmod +x zephyr-sdk-0.11.4-setup.run</span><br><span class="line">~$ ./zephyr-sdk-0.11.4-setup.run -- -d ~/zephyr-sdk-0.11.4</span><br></pre></td></tr></table></figure>
<ul>
<li>è§£å‹å®‰è£…å®Œæˆå,ä¼šæœ‰ä¸€ä¸ª<code>~/.zephyrrc</code>çš„ç¯å¢ƒå˜é‡æ–‡ä»¶.ä¸‹é¢å®‰è£…<code>udev</code>æ–‡ä»¶.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo cp ~/zephyr-sdk-0.11.4/sysroots/x86_64-pokysdk-linux/usr/share/openocd/contrib/60-openocd.rules  /etc/udev/rules.d/</span><br><span class="line">~$ sudo udevadm control --reload</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="æ¿çº§ç¤ºä¾‹ç¨‹åº"><a href="#æ¿çº§ç¤ºä¾‹ç¨‹åº" class="headerlink" title="æ¿çº§ç¤ºä¾‹ç¨‹åº"></a>æ¿çº§ç¤ºä¾‹ç¨‹åº</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">~$  west build -p auto  -b nucleo_f767zi samples/hello_world</span><br><span class="line">[......]</span><br><span class="line">-- west build: building application</span><br><span class="line">[1/131] Preparing syscall dependency handling</span><br><span class="line"></span><br><span class="line">[126/131] Linking C executable zephyr/zephyr_prebuilt.elf</span><br><span class="line">Memory region         Used Size  Region Size  %age Used</span><br><span class="line">           FLASH:       13448 B         2 MB      0.64%</span><br><span class="line">            DTCM:          0 GB       128 KB      0.00%</span><br><span class="line">            SRAM:        4432 B       384 KB      1.13%</span><br><span class="line">        IDT_LIST:         200 B         2 KB      9.77%</span><br><span class="line">[131/131] Linking C executable zephyr/zephyr.elf</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç¼–è¯‘ç›®å½•çš„æ–‡ä»¶ç»“æ„.</span></span><br><span class="line">~$ ls  build/zephyr/</span><br><span class="line">arch                 drivers       kconfig      linker.cmd.dep              nucleo_f767zi.dts.pre.d    zephyr.bin  zephyr.map</span><br><span class="line">boards               edt.pickle    kernel       linker_pass_final.cmd       nucleo_f767zi.dts.pre.tmp  zephyr.dts  zephyr_prebuilt.elf</span><br><span class="line">cmake                include       lib          linker_pass_final.cmd.dep   runners.yaml               zephyr.elf  zephyr_prebuilt.map</span><br><span class="line">CMakeFiles           isrList.bin   libzephyr.a  misc                        soc                        zephyr.hex  zephyr.stat</span><br><span class="line">cmake_install.cmake  isr_tables.c  linker.cmd   nucleo_f767zi.dts_compiled  subsys                     zephyr.lst</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿æ¥åˆ°ç›®æ ‡æ¿å­çš„USB,ä½¿ç”¨ä¸‹é¢å‘½ä»¤çƒ§å†™å…¥ç¤ºä¾‹.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">~$ west flash</span><br><span class="line">Open On-Chip Debugger 0.10.0+dev-01341-g580d06d9d-dirty (2020-06-25-12:07)</span><br><span class="line">Licensed under GNU GPL v2</span><br><span class="line">For bug reports, <span class="built_in">read</span></span><br><span class="line">        http://openocd.org/doc/doxygen/bugs.html</span><br><span class="line">Info : The selected transport took over low-level target control. The results might differ compared to plain JTAG/SWD</span><br><span class="line">Info : clock speed 2000 kHz</span><br><span class="line">Info : STLINK V2J23M7 (API v2) VID:PID 0483:374B</span><br><span class="line">Info : Target voltage: 3.245850</span><br><span class="line">Info : stm32f7x.cpu: hardware has 8 breakpoints, 4 watchpoints</span><br><span class="line">Info : Listening on port 3333 <span class="keyword">for</span> gdb connections</span><br><span class="line">    TargetName         Type       Endian TapName            State</span><br><span class="line">--  ------------------ ---------- ------ ------------------ ------------</span><br><span class="line"> 0* stm32f7x.cpu       hla_target little stm32f7x.cpu       running</span><br><span class="line"></span><br><span class="line">Info : Unable to match requested speed 2000 kHz, using 1800 kHz</span><br><span class="line">Info : Unable to match requested speed 2000 kHz, using 1800 kHz</span><br><span class="line">target halted due to debug-request, current mode: Thread</span><br><span class="line">xPSR: 0x01000000 pc: 0x08000268 msp: 0x20020e8c</span><br><span class="line">Info : device id = 0x10006451</span><br><span class="line">Info : flash size = 2048 kbytes</span><br><span class="line">Info : Single Bank 2048 kiB STM32F76x/77x found</span><br><span class="line">auto erase enabled</span><br><span class="line">wrote 32768 bytes from file /fullpath/zephyrproject/zephyr/build/zephyr/zephyr.hex <span class="keyword">in</span> 1.283166s (24.938 KiB/s)</span><br></pre></td></tr></table></figure>
<ul>
<li>é€šè¿‡USBè¿æ¥çš„<code>/dev/ttyACM0</code>ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡º.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo minicom -o -b 115200 -D /dev/ttyACM0</span><br><span class="line">*** Booting Zephyr OS build v2.4.0-rc3-10-g0a0cb52fb229  ***</span><br><span class="line">Hello World! nucleo_f767zi</span><br></pre></td></tr></table></figure>
<h3 id="æ¿çº§è°ƒè¯•"><a href="#æ¿çº§è°ƒè¯•" class="headerlink" title="æ¿çº§è°ƒè¯•"></a>æ¿çº§è°ƒè¯•</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~$ west debug</span><br><span class="line">-- west debug: rebuilding</span><br><span class="line">[0/1] <span class="built_in">cd</span> /fullpath/zephyrproject/zephyr/build/zephyr/cmake/flash &amp;&amp; /usr/bin/cmake -E <span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line">-- west debug: using runner openocd</span><br><span class="line">/fullpath/zephyr-sdk-0.11.4/arm-zephyr-eabi/bin/arm-zephyr-eabi-gdb: error <span class="keyword">while</span> loading shared libraries: libpython3.8.so.1.0: cannot open shared object file: No such file or directory</span><br><span class="line">FATAL ERROR: <span class="built_in">command</span> exited with status 127: /fullpath/zephyr-sdk-0.11.4/arm-zephyr-eabi/bin/arm-zephyr-eabi-gdb -ex <span class="string">'target remote :3333'</span> /fullpath/zephyrproject/zephyr/build/zephyr/zephyr.elf</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚ä¸Šé¢é”™è¯¯,æ˜¯å› ä¸ºè¿™é‡Œæ˜¯ä½¿ç”¨<code>pyenv</code>å®‰è£…çš„<code>python-3.8.2</code>,ä¸åœ¨ç³»ç»Ÿå†…çš„æœç´¢è·¯å¾„é‡Œ,è€Œä¸”é»˜è®¤è¿˜æ˜¯é™æ€(static)ç¼–è¯‘çš„,æ‰€ä»¥ä¼šå‡ºæ˜¾ä¸Šé¢çš„é”™è¯¯.ä¸‹é¢æ¥é‡è£…å®ƒ,å¹¶ä¸”ä½¿ç”¨<code>LD_LIBRARY_PATH</code>æŒ‡å®šè·¯å¾„.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$ CONFIGURE_OPTS=--<span class="built_in">enable</span>-shared pyenv install 3.8.2</span><br><span class="line">pyenv: /home/michael/.pyenv/versions/3.8.2 already exists</span><br><span class="line"><span class="built_in">continue</span> with installation? (y/N) y</span><br><span class="line">Installing Python-3.8.2...</span><br><span class="line">Installed Python-3.8.2 to /home/michael/.pyenv/versions/3.8.2</span><br><span class="line"></span><br><span class="line">~$ tree -L 1 /home/michael/.pyenv/versions/3.8.2/lib</span><br><span class="line">/home/michael/.pyenv/versions/3.8.2/lib</span><br><span class="line">â”œâ”€â”€ libpython3.8.a</span><br><span class="line">â”œâ”€â”€ libpython3.8.so -&gt; libpython3.8.so.1.0</span><br><span class="line">â”œâ”€â”€ libpython3.8.so.1.0</span><br><span class="line">â”œâ”€â”€ libpython3.so</span><br><span class="line">â”œâ”€â”€ pkgconfig</span><br><span class="line">â””â”€â”€ python3.8</span><br><span class="line"></span><br><span class="line">2 directories, 4 files</span><br></pre></td></tr></table></figure>
<ul>
<li>å†æ¬¡è¿è¡Œè°ƒè¯•.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">~$ LD_LIBRARY_PATH=/home/michael/.pyenv/versions/3.8.2/lib west debug</span><br><span class="line">-- west debug: rebuilding</span><br><span class="line">[....]</span><br><span class="line">This GDB was configured as <span class="string">"--host=x86_64-build_pc-linux-gnu --target=arm-zephyr-eabi"</span>.</span><br><span class="line">Type <span class="string">"show configuration"</span> <span class="keyword">for</span> configuration details.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">[...]</span><br><span class="line">Reading symbols from /fullpath/zephyrproject/zephyr/build/zephyr/zephyr.elf...</span><br><span class="line">Info : stm32f7x.cpu: hardware has 0 breakpoints, 10 watchpoints</span><br><span class="line">Info : Listening on port 3333 <span class="keyword">for</span> gdb connections</span><br><span class="line">    TargetName         Type       Endian TapName            State</span><br><span class="line">--  ------------------ ---------- ------ ------------------ ------------</span><br><span class="line"> 0* stm32f7x.cpu       hla_target little stm32f7x.cpu       halted</span><br><span class="line"></span><br><span class="line">Info : Listening on port 6333 <span class="keyword">for</span> tcl connections</span><br><span class="line">Info : Listening on port 4444 <span class="keyword">for</span> telnet connections</span><br><span class="line">Remote debugging using :3333</span><br><span class="line">Info : accepting <span class="string">'gdb'</span> connection on tcp/3333</span><br><span class="line">Debugger attaching: halting execution</span><br><span class="line">Info : Unable to match requested speed 2000 kHz, using 1800 kHz</span><br><span class="line">Info : Unable to match requested speed 2000 kHz, using 1800 kHz</span><br><span class="line">target halted due to debug-request, current mode: Thread</span><br><span class="line">xPSR: 0x01000000 pc: 0x08001004 msp: 0x20020810</span><br><span class="line">force hard breakpoints</span><br><span class="line">Info : device id = 0x10006451</span><br><span class="line">Info : flash size = 2048 kbytes</span><br><span class="line">Info : Single Bank 2048 kiB STM32F76x/77x found</span><br><span class="line">Info : flash size = 1024 bytes</span><br><span class="line">0x08001004 <span class="keyword">in</span> z_vprintk (out=0x0, ctx=0x0, fmt=0x0, ap=...) at /fullpath/zephyrproject/zephyr/lib/os/printk.c:292</span><br><span class="line">292					<span class="keyword">while</span> (*s) &#123;</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<h2 id="æµ‹è¯•éæ ‡å‡†æ¿å­-STM32F030-DEMO-BOARD"><a href="#æµ‹è¯•éæ ‡å‡†æ¿å­-STM32F030-DEMO-BOARD" class="headerlink" title="æµ‹è¯•éæ ‡å‡†æ¿å­(STM32F030 DEMO BOARD)"></a>æµ‹è¯•éæ ‡å‡†æ¿å­(STM32F030 DEMO BOARD)</h2><ul>
<li><a href="https://docs.zephyrproject.org/latest/boards/arm/stm32f030_demo/doc/index.html" target="_blank" rel="noopener">STM32F030 DEMO BOARD</a></li>
<li>æˆ‘æ‰‹é‡Œçš„è¿™å—<code>stm32f030_demo</code>æ˜¯æ²¡æœ‰<code>STLINK-V2</code>è°ƒè¯•å™¨çš„,ä½†æ˜¯å®ƒæœ‰å¼•å‡º<code>GND,VCC,DIO,CLK</code>è¿™æ ·ä¸€ç»„æ¥å£,åˆšæ‰å¥½æ‰‹ä¸Šæœ‰ä¸€ä¸ª<code>JLink-OB</code>ä¹Ÿæ˜¯è¿™æ ·çš„æ¥å£,ä¸‹é¢å°±ç”¨å®ƒæ¥çƒ§å†™ä¸è°ƒè¯•.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ west build -b stm32f030_demo samples/basic/blinky</span><br></pre></td></tr></table></figure>
<ul>
<li><p>é…ç½®<code>openocd</code>è¿æ¥å‚æ•°.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ cat &gt; jlink-ob-stm32f0.cfg&lt;&lt;EOF</span><br><span class="line"><span class="built_in">source</span> [find interface/jlink.cfg]</span><br><span class="line">transport select swd</span><br><span class="line"><span class="built_in">source</span> [find target/stm32f0x.cfg]</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨<code>openocd</code>çƒ§å†™.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cd</span> build/zephyr</span><br><span class="line">~$ openocd -f ~/jlink-ob-stm32f0.cfg -c init -c <span class="string">"reset halt"</span> -c <span class="string">"stm32f0x mass_erase 0"</span> -c <span class="string">"flash write_bank 0 zephyr.bin 0"</span> -c <span class="string">"reset run"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Nuttx"><a href="#Nuttx" class="headerlink" title="Nuttx"></a>Nuttx</h1><h2 id="ç³»ç»Ÿç®€ä»‹-1"><a href="#ç³»ç»Ÿç®€ä»‹-1" class="headerlink" title="ç³»ç»Ÿç®€ä»‹"></a>ç³»ç»Ÿç®€ä»‹</h2><ul>
<li><code>NuttX</code>æ˜¯ä¸€ä¸ªä¸“æ³¨äºæ ‡å‡†åˆè§„å’Œå°å†…å­˜å ç”¨çš„å®æ—¶æ“ä½œç³»ç»Ÿ<code>(RTOS)</code>.å®ƒå¯ä»¥åœ¨8ä½åˆ°32ä½çš„å¾®æ§åˆ¶å™¨ä¸Šéƒ¨ç½².<code>NuttX</code>åœ¨ç¼–å†™æ—¶ä¸»è¦å‚ç…§äº†<code>POSIX</code>å’Œ<code>ANSI</code>æ ‡å‡†.å¯¹äºé‚£äº›æ ‡å‡†ä¸­æ²¡æœ‰çš„éƒ¨åˆ†,å¦‚<code>fork()</code>ç­‰,åˆ™å‚è€ƒäº†<code>VxWorks</code>æˆ–å…¶ä»–<code>RTOS</code>.<code>NuttX</code>åŸºæœ¬ä¸Šå®Œå…¨æ˜¯ç”±Cè¯­è¨€å®ç°çš„,å¹¶ä¸”é€šè¿‡<code>Kconfig</code>ç”Ÿæˆ<code>GNU makefile</code>.<code>NuttX</code>çš„å‘è¡Œç‰ˆåŒ…æ‹¬äº†<code>NuttX</code>å†…æ ¸æœ¬èº«å’Œç›¸å½“ä¸€éƒ¨åˆ†çš„ä¸­é—´ä»¶å’Œæ¿çº§æ”¯æŒåŒ….<code>NuttX</code>çš„å†…æ ¸å’Œç»å¤§å¤šæ•°ä»£ç å®Œå…¨æ˜¯ç”±<code>Gregory Nutt</code>å®Œæˆçš„,å¹¶ç”±ä»–ä¸“é—¨ç»´æŠ¤.æ‰€æœ‰çš„ç¤¾åŒºè´¡çŒ®éƒ½å¿…é¡»ç»è¿‡ä»–æ‰¹å‡†.<code>NuttX</code>æœ€æ—©æ˜¯åœ¨2007å¹´ç”±<code>Gregory Nutt</code>äºBSDåè®®ä¸‹é‡Šå‡ºçš„.</li>
</ul>
<h2 id="ä½¿ç”¨BuildRootæ„å»ºå·¥å…·é“¾-éå¿…è¦"><a href="#ä½¿ç”¨BuildRootæ„å»ºå·¥å…·é“¾-éå¿…è¦" class="headerlink" title="ä½¿ç”¨BuildRootæ„å»ºå·¥å…·é“¾(éå¿…è¦)"></a>ä½¿ç”¨<code>BuildRoot</code>æ„å»ºå·¥å…·é“¾(éå¿…è¦)</h2><ul>
<li><p>å¦‚æœè¦ä½¿ç”¨<code>BuildRoot</code>å®šåˆ¶ç¼–è¯‘çš„å·¥å…·é“¾å°±æ˜¯å¦‚ä¸‹é…ç½®:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://bitbucket.org/nuttx/buildroot.git buildroot</span><br><span class="line">~$ cp configs/cortexm7f-eabi-defconfig-7.4.0 .config</span><br><span class="line">~$ make menuconfig</span><br><span class="line"><span class="comment"># ç»ˆé…ç½®å¦‚ä¸‹</span></span><br><span class="line">~$ grep -v <span class="string">'^$\|^#'</span> .config</span><br><span class="line">BR2_HAVE_DOT_CONFIG=y</span><br><span class="line">BR2_arm=y</span><br><span class="line">BR2_cortex_m7f=y</span><br><span class="line">BR2_GCC_CORTEX=y</span><br><span class="line">BR2_GCC_CORTEX_M7F=y</span><br><span class="line">BR2_ARM_EABI=y</span><br><span class="line">BR2_ARCH=<span class="string">"arm"</span></span><br><span class="line">BR2_GCC_TARGET_TUNE=<span class="string">"cortex-m7"</span></span><br><span class="line">BR2_GCC_TARGET_ARCH=<span class="string">"armv7-m"</span></span><br><span class="line">BR2_GCC_TARGET_ABI=<span class="string">"aapcs-linux"</span></span><br><span class="line">BR2_WGET=<span class="string">"wget --passive-ftp"</span></span><br><span class="line">BR2_SVN=<span class="string">"svn co"</span></span><br><span class="line">BR2_ZCAT=<span class="string">"zcat"</span></span><br><span class="line">BR2_BZCAT=<span class="string">"bzcat"</span></span><br><span class="line">BR2_TAR_OPTIONS=<span class="string">""</span></span><br><span class="line">BR2_DL_DIR=<span class="string">"<span class="variable">$(BASE_DIR)</span>/../archives"</span></span><br><span class="line">BR2_STAGING_DIR=<span class="string">"<span class="variable">$(BUILD_DIR)</span>/staging_dir"</span></span><br><span class="line">BR2_NUTTX_DIR=<span class="string">"<span class="variable">$(TOPDIR)</span>/../nuttx"</span></span><br><span class="line">BR2_TOPDIR_PREFIX=<span class="string">""</span></span><br><span class="line">BR2_TOPDIR_SUFFIX=<span class="string">""</span></span><br><span class="line">BR2_GNU_BUILD_SUFFIX=<span class="string">"pc-elf"</span></span><br><span class="line">BR2_GNU_TARGET_SUFFIX=<span class="string">"nuttx-eabi"</span></span><br><span class="line">BR2_PACKAGE_BINUTILS=y</span><br><span class="line">BR2_BINUTILS_VERSION_2_28_1=y</span><br><span class="line">BR2_BINUTILS_SUPPORTS_NUTTX_OS=y</span><br><span class="line">BR2_BINUTILS_VERSION=<span class="string">"2.28.1"</span></span><br><span class="line">BR2_EXTRA_BINUTILS_CONFIG_OPTIONS=<span class="string">""</span></span><br><span class="line">BR2_PACKAGE_GCC=y</span><br><span class="line">BR2_GCC_VERSION_7_4_0=y</span><br><span class="line">BR2_GCC_SUPPORTS_SYSROOT=y</span><br><span class="line">BR2_GCC_SUPPORTS_NUTTX_OS=y</span><br><span class="line">BR2_GCC_SUPPORTS_DOWN_PREREQ=y</span><br><span class="line">BR2_GCC_DOWNLOAD_PREREQUISITES=y</span><br><span class="line">BR2_GCC_VERSION=<span class="string">"7.4.0"</span></span><br><span class="line">BR2_EXTRA_GCC_CONFIG_OPTIONS=<span class="string">""</span></span><br><span class="line">BR2_INSTALL_LIBSTDCPP=y</span><br><span class="line">BR2_PACKAGE_GDB_HOST=y</span><br><span class="line">BR2_GDB_VERSION_8_0_1=y</span><br><span class="line">BR2_PACKAGE_GDB_TUI=y</span><br><span class="line">BR2_GDB_VERSION=<span class="string">"8.0.1"</span></span><br><span class="line">BR2_PACKAGE_NXFLAT=y</span><br><span class="line">BR2_PACKAGE_GENROMFS=y</span><br><span class="line">BR2_PACKAGE_KCONFIG_FRONTENDS=y</span><br><span class="line">BR2_KCONFIG_VERSION_4_11_0_1=y</span><br><span class="line">BR2_KCONFIG_FRONTENDS_VERSION=<span class="string">"4.11.0.1"</span></span><br><span class="line">BR2_LARGEFILE=y</span><br><span class="line">BR2_SOFT_FLOAT=y</span><br><span class="line">BR2_TARGET_OPTIMIZATION=<span class="string">"-Os -pipe"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¼–è¯‘æˆåŠŸå,ä¼šåœ¨<code>buildroot</code>ç”Ÿæˆä¸€ä¸ªç›®å½•,ç»“æ„å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~$ tree -L 2 build_arm_hf/</span><br><span class="line">build_arm_hf/</span><br><span class="line">â”œâ”€â”€ root</span><br><span class="line">â””â”€â”€ staging_dir</span><br><span class="line">    â”œâ”€â”€ arm-elf -&gt; arm-nuttx-eabi</span><br><span class="line">    â”œâ”€â”€ arm-nuttx-eabi</span><br><span class="line">    â”œâ”€â”€ bin</span><br><span class="line">    â”œâ”€â”€ include</span><br><span class="line">    â”œâ”€â”€ lib</span><br><span class="line">    â”œâ”€â”€ libexec</span><br><span class="line">    â”œâ”€â”€ share</span><br><span class="line">    â””â”€â”€ usr</span><br><span class="line"></span><br><span class="line">10 directories, 0 files</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h2><ul>
<li><a href="https://cwiki.apache.org/confluence/display/NUTTX/Configuration+Variables#menu_348" target="_blank" rel="noopener">nuttx Wiki</a></li>
<li>æŠŠä¸Šé¢å·¥å…·é“¾çš„ç»å¯¹è·¯å¾„åŠ å…¥Shellç¯å¢ƒå˜é‡ä¸­ä½¿ç”¨,ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„å·¥å…·é“¾,å¦‚:<code>Zephyr</code>çš„<code>arm-zephyr-eabi</code>,ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚:<code>gcc-arm-none-eabi-6-2017-q2-update</code>çš„å·¥å…·é“¾,åœ¨<code>Debian</code>ä¸‹å¯ä»¥å®‰è£…ç³»ç»Ÿè‡ªå¸¦çš„<code>gcc-arm-none-eabi</code>åŒ….åœ¨<code>make menuconfig</code>æ—¶,é€‰æ‹©<code>CONFIG_ARMV7M_TOOLCHAIN_GNU_EABIL=y</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ tools/configure.sh -L | grep <span class="string">"f767"</span></span><br><span class="line">  nucleo-144:f767-netnsh</span><br><span class="line">  nucleo-144:f767-nsh</span><br><span class="line">  nucleo-144:f767-evalos</span><br></pre></td></tr></table></figure>
<ul>
<li><p>å› ä¸º<code>NULEO-F767ZI</code>æ˜¯æœ‰ä¸€ä¸ªä»¥å¤ªç½‘æ¥å£,è¿™é‡Œé€‰æ‹©ä½¿ç”¨<code>nucleo-144:f767-netnsh</code>é…ç½®æ–‡ä»¶.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ tools/configure.sh  nucleo-144:f767-netnsh</span><br><span class="line">~$ make oldconfig</span><br><span class="line">~$ make menuconfig</span><br><span class="line">~$ make   <span class="comment"># å¦‚æœæ˜¯ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·é“¾,å°±å¦‚è¿™æ ·: make CROSSDEV=arm-none-eabi-</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿™é‡Œæœ€ç»ˆæµ‹è¯•çš„ç³»ç»Ÿé…ç½®å¦‚ä¸‹:</p>
</li>
</ul>
<h2 id="ESP8266é€šä¿¡"><a href="#ESP8266é€šä¿¡" class="headerlink" title="ESP8266é€šä¿¡"></a>ESP8266é€šä¿¡</h2><ul>
<li><p>è¿™é‡Œæ˜¯ä½¿ç”¨æ¿ä¸Šçš„<code>USART6</code>é€šä¿¡,è€Œ<code>USART3</code>é»˜è®¤æ˜¯åšä¸ºç³»ç»Ÿçš„<code>CONSOLE</code>çš„æ¥å£,</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_STM32F7_USART6=y</span><br><span class="line">CONFIG_USART6_SERIALDRIVER=y</span><br><span class="line">CONFIG_DEV_CONSOLE=y</span><br><span class="line">CONFIG_NSH_CONSOLE=y</span><br><span class="line">CONFIG_SERIAL_CONSOLE=y</span><br><span class="line">CONFIG_USART3_SERIAL_CONSOLE=y</span><br><span class="line">CONFIG_NUCLEO_CONSOLE_VIRTUAL=y</span><br><span class="line">CONFIG_NETUTILS_ESP8266_DEV_PATH=<span class="string">"/dev/ttyS1"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…CUå‘½ä»¤,å°±æ˜¯ç±»ä¼¼äºputty,minicomè¿™æ ·çš„ä¸²å£é€šä¿¡å·¥å…·.</span></span><br><span class="line">CONFIG_SYSTEM_CUTERM=y</span><br><span class="line">CONFIG_SYSTEM_CUTERM_DEFAULT_DEVICE=<span class="string">"/dev/ttyS0"</span></span><br><span class="line">CONFIG_SYSTEM_CUTERM_DEFAULT_BAUD=115200</span><br><span class="line">CONFIG_SYSTEM_CUTERM_STACKSIZE=2048</span><br><span class="line">CONFIG_SYSTEM_CUTERM_PRIORITY=100</span><br></pre></td></tr></table></figure>
</li>
<li><p>åŒæ—¶éœ€è¦åœ¨<code>boards/arm/stm32f7/nucleo-144/include/board.h</code>æ·»åŠ <code>USART6</code>çš„æ¥å£å®šä¹‰.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line"><span class="comment">#  define GPIO_USART6_RX GPIO_USART6_RX_2</span></span><br><span class="line"><span class="comment">#  define GPIO_USART6_TX GPIO_USART6_TX_2</span></span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<ul>
<li><p>è¿æ¥<code>ESP8266</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">STM32F767ZI-NUCLEO          ESP01</span><br><span class="line"></span><br><span class="line">         D0 RX     ---&gt;      TX</span><br><span class="line">         D1 TX     ---&gt;      RX</span><br><span class="line">         GND       ---&gt;      GND</span><br><span class="line">         3V3       ---&gt;      3V3</span><br><span class="line">         3V3       ---&gt;      CH_PD <span class="comment"># æ‹‰é«˜è¿›å…¥æ­£å¸¸æ¨¡å¼</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿æ¥æµ‹è¯•</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">nsh&gt; cu -s 115200 -l /dev/ttyS1</span><br><span class="line">AT</span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line">AT+GMR</span><br><span class="line">AT version:1.7.4.0(May 11 2020 19:13:04)</span><br><span class="line">SDK version:3.0.4(9532ceb)</span><br><span class="line">compile time:May 27 2020 10:12:17</span><br><span class="line">Bin version(Wroom 02):1.7.4</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">AT+SYSRAM?</span><br><span class="line">+SYSRAM:51952</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="å¤–æ¥SPI-SDè¯»å¡å™¨"><a href="#å¤–æ¥SPI-SDè¯»å¡å™¨" class="headerlink" title="å¤–æ¥SPI-SDè¯»å¡å™¨"></a>å¤–æ¥SPI-SDè¯»å¡å™¨</h2><ul>
<li>è¿™é‡Œä½¿ç”¨<code>SPI3:(PB3:CLK),(PB4:MISO),(PB5:MOSI)</code>æ¥å¤–æ¥<code>SD</code>è¯»å¡å™¨,æ ¹æ®æ•°æ®æ‰‹å†Œ<a href="https://www.st.com/resource/en/datasheet/stm32f767zi.pdf" target="_blank" rel="noopener">stm32f767zi.pdf</a>,<code>NSS(CS)</code>ç‰‡é€‰å¯ä»¥æ˜¯è½¯ä»¶å®šä¹‰ä¹Ÿå¯ä»¥ä½¿å®ƒç¡¬ä»¶<code>(PA4:GPIO_SPI3_NSS_2)</code>å®šä¹‰çš„,å› ä¸ºè¿™é‡Œçš„ä½¿ç”¨åœºæ™¯éå¸¸ç®€å•,å°±æ˜¯ç”¨<code>PA4</code>æ¥åšä»æœºçš„<code>CS</code>ç‰‡é€‰.</li>
<li><code>nuttx</code>çš„ç³»ç»Ÿå†…<code>boards/arm/stm32f7/nucleo-144/src</code>æ²¡æœ‰<code>mmcsd</code>ç›¸å…³çš„æ–‡ä»¶,è¿™é‡Œå¯ä»¥æœ‰ä»å…¶å®ƒæ¿å­çš„<br><code>stm32_mmcsd.c</code>æ–‡ä»¶å¤åˆ¶ä¿®æ”¹ä¸€ä¸‹å°±å¯ä»¥ä½¿ç”¨.</li>
<li>åœ¨<code>boards/arm/stm32f7/nucleo-144/src/nucle-144.h</code>å®šä¹‰<code>CS</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line"><span class="comment">#define GPIO_SPI_CS (GPIO_OUTPUT | GPIO_PUSHPULL | GPIO_SPEED_50MHz | \</span></span><br><span class="line">                     GPIO_OUTPUT_SET)</span><br><span class="line"><span class="comment">#if defined(CONFIG_MMCSD_SPI)</span></span><br><span class="line"><span class="comment">#define GPIO_SPI3_CARD_CS (GPIO_SPI_CS | GPIO_PORTA | GPIO_PIN4)</span></span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨<code>boards/arm/stm32f7/nucleo-144/src/stm32_mmcsd.c</code>å†…å®šä¹‰å‡½æ•°çš„å®ç°.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[....]</span><br><span class="line"><span class="comment">#ifdef CONFIG_STM32F7_SPI3</span></span><br><span class="line">int stm32_spi3register(struct spi_dev_s *dev, spi_mediachange_t callback,</span><br><span class="line">                       void *arg)</span><br><span class="line">&#123;</span><br><span class="line">  /* TODO: media change callback */</span><br><span class="line">  <span class="built_in">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"></span><br><span class="line">/*****************************************************************************</span><br><span class="line"> * Name: stm32_mmcsd_initialize</span><br><span class="line"> *</span><br><span class="line"> * Description:</span><br><span class="line"> *   Initialize SPI-based SD card and card detect thread.</span><br><span class="line"> ****************************************************************************/</span><br><span class="line"></span><br><span class="line">int stm32_mmcsd_initialize(int port, int minor)</span><br><span class="line">&#123;</span><br><span class="line">  struct spi_dev_s *spi;</span><br><span class="line">  int rv;</span><br><span class="line"></span><br><span class="line">  stm32_configgpio(GPIO_SPI3_CARD_CS);   /* Assign CS */</span><br><span class="line">  stm32_gpiowrite(GPIO_SPI3_CARD_CS, 1); /* Ensure the CS is inactive */</span><br><span class="line"></span><br><span class="line">  mcinfo(<span class="string">"INFO: Initializing mmcsd port %d minor %d \n"</span>,</span><br><span class="line">         port, minor);</span><br><span class="line"></span><br><span class="line">  spi = stm32_spibus_initialize(port);</span><br><span class="line">  <span class="keyword">if</span> (spi == NULL)</span><br><span class="line">  &#123;</span><br><span class="line">    mcerr(<span class="string">"ERROR: Failed to initialize SPI port %d\n"</span>, port);</span><br><span class="line">    <span class="built_in">return</span> -ENODEV;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  rv = mmcsd_spislotinitialize(minor, minor, spi);</span><br><span class="line">  <span class="keyword">if</span> (rv &lt; 0)</span><br><span class="line">  &#123;</span><br><span class="line">    mcerr(<span class="string">"ERROR: Failed to bind SPI port %d to SD slot %d\n"</span>,</span><br><span class="line">          port, minor);</span><br><span class="line">    <span class="built_in">return</span> rv;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  spiinfo(<span class="string">"INFO: mmcsd card has been initialized successfully\n"</span>);</span><br><span class="line">  <span class="built_in">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ä¿®æ”¹æ–‡ä»¶<code>boards/arm/stm32f7/nucleo-144/src/stm32_spi.c</code>å†…çš„ç›¸å…³å‡½æ•°å†…å®¹.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line"><span class="comment">#ifdef CONFIG_STM32F7_SPI3</span></span><br><span class="line">void stm32_spi3select(FAR struct spi_dev_s *dev, uint32_t devid, bool selected)</span><br><span class="line">&#123;</span><br><span class="line">  spiinfo(<span class="string">"devid: %d CS: %s\n"</span>, (int)devid, selected ? <span class="string">"assert"</span> : <span class="string">"de-assert"</span>);</span><br><span class="line"><span class="comment">#if defined(CONFIG_MMCSD_SPI)</span></span><br><span class="line">  stm32_gpiowrite(GPIO_SPI3_CARD_CS, !selected);</span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">uint8_t stm32_spi3status(FAR struct spi_dev_s *dev, uint32_t devid)</span><br><span class="line">&#123;</span><br><span class="line">  uint8_t ret = 0;</span><br><span class="line"><span class="comment">#if defined(CONFIG_MMCSD_SPI)</span></span><br><span class="line">  <span class="keyword">if</span> (devid == SPIDEV_MMCSD(0))</span><br><span class="line">  &#123;</span><br><span class="line">    /* Note: SD_DET is pulled high when there\<span class="string">'s no SD card present. */</span></span><br><span class="line"><span class="string">    /* å› ä¸ºè¯»å¡æ²¡CDè„š(æ’å¡æ£€æµ‹),æˆ–è€…ä¸ç”¨è¯¥åŠŸèƒ½,å°±å¿…é¡»è¿”å›å¡å·²ç»æ’å…¥çš„æ¡ä»¶.</span></span><br><span class="line"><span class="string">     * å‡­æ­¤æ¡ä»¶å»è¿›è¡Œä¸‹ä¸€æ­¥,è¯»å¡å†™å¡æ“ä½œ,å¾ˆé‡è¦. */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ret |= SPI_STATUS_PRESENT;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">#endif</span></span><br><span class="line"><span class="string">  return ret;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨ç³»ç»Ÿåˆå§‹åŒ–çš„æµç¨‹å†…åŠ å…¥<code>MMCSD_SPI</code>çš„åˆå§‹æµç¨‹.ä¿®æ”¹æ–‡ä»¶<code>boards/arm/stm32f7/nucleo-144/src/stm32_appinitialize.c</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line"><span class="comment">#ifdef CONFIG_MMCSD_SPI</span></span><br><span class="line">  /* Initialize the MMC/SD SPI driver (SPI2 is used) */</span><br><span class="line"></span><br><span class="line">  ret = stm32_mmcsd_initialize(3, CONFIG_NSH_MMCSDMINOR);</span><br><span class="line">  <span class="keyword">if</span> (ret &lt; 0)</span><br><span class="line">  &#123;</span><br><span class="line">    syslog(LOG_ERR, <span class="string">"Failed to initialize SD slot %d: %d\n"</span>,</span><br><span class="line">           CONFIG_NSH_MMCSDMINOR, ret);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line">[....]</span><br></pre></td></tr></table></figure>
</li>
<li><p>æœ€åæ˜¯ä¿®æ”¹<code>boards/arm/stm32f7/nucleo-144/src/Makefile</code>æ–‡ä»¶,åŠ å…¥å¦‚ä¸‹å†…å®¹.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line">ifeq ($(CONFIG_MMCSD_SPI),y)</span><br><span class="line">CSRCS += stm32_mmcsd.c</span><br><span class="line">endif</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="QSPIé©±åŠ¨-æœªæµ‹è¯•æˆåŠŸ"><a href="#QSPIé©±åŠ¨-æœªæµ‹è¯•æˆåŠŸ" class="headerlink" title="QSPIé©±åŠ¨(æœªæµ‹è¯•æˆåŠŸ)"></a>QSPIé©±åŠ¨(æœªæµ‹è¯•æˆåŠŸ)</h2><ul>
<li>ä¸çŸ¥ä¸ºä½•,å·¥ç¨‹æ–‡ä»¶å†…æ²¡æœ‰å®šä¹‰<code>QSPI</code>çš„ç®¡è„š.è¿™é‡Œåªæ˜¯é€šè¿‡ç¼–è¯‘,è¿˜æœªæˆåŠŸè¯»å†™å®ƒ.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">~$ grep <span class="string">"/* QSPI"</span>  boards/arm/stm32f7/nucleo-144/include/board.h -A 20</span><br><span class="line">/* QSPI</span><br><span class="line"> *</span><br><span class="line"> * reference from UM1974 chapter 6.14</span><br><span class="line"> *  stm32f7/hardware/stm32f76xx77xx_pinmap.h</span><br><span class="line"> *</span><br><span class="line"> * PB6   GPIO_QSPI_CS   CN10-13</span><br><span class="line"> * PB2   GPIO_QSPI_SCK  CN10-15</span><br><span class="line"> * PD11  GPIO_QSPI_IO0  CN10-23</span><br><span class="line"> * PD12  GPIO_QSPI_IO1  CN10-21</span><br><span class="line"> * PE2   GPIO_QSPI_IO2  CN10-25</span><br><span class="line"> * PD13  GPIO_QSPI_IO3  CN10-19</span><br><span class="line"> *</span><br><span class="line"> * */</span><br><span class="line"><span class="comment">#define GPIO_QSPI_CS   GPIO_QUADSPI_BK1_NCS_1</span></span><br><span class="line"><span class="comment">#define GPIO_QSPI_SCK  GPIO_QUADSPI_CLK_1</span></span><br><span class="line"><span class="comment">#define GPIO_QSPI_IO0  GPIO_QUADSPI_BK1_IO0_3</span></span><br><span class="line"><span class="comment">#define GPIO_QSPI_IO1  GPIO_QUADSPI_BK1_IO1_3</span></span><br><span class="line"><span class="comment">#define GPIO_QSPI_IO2  GPIO_QUADSPI_BK1_IO2_1</span></span><br><span class="line"><span class="comment">#define GPIO_QSPI_IO3  GPIO_QUADSPI_BK1_IO3_2</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="çƒ§å†™ä¸æµ‹è¯•"><a href="#çƒ§å†™ä¸æµ‹è¯•" class="headerlink" title="çƒ§å†™ä¸æµ‹è¯•"></a>çƒ§å†™ä¸æµ‹è¯•</h2><ul>
<li><p>ç¼–è¯‘æˆåŠŸå<code>nuttx</code>å†…ä¼šæœ‰<code>nuttx,nuttx.bin,nuttx.hex</code>ä¸‰ä¸ªæ–‡ä»¶,é€šè¿‡<code>openocd</code>çƒ§å†™ä¸è°ƒè¯•ç›®æ ‡æ¿å­.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo openocd -f board/stm32f7discovery.cfg -c init -c <span class="string">"reset halt"</span> -c <span class="string">"flash write_image erase nuttx.bin 0x08000000"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿æ¥ç½‘å¡ä¸USBæ¥å£,ä½¿ç”¨<code>minicom</code>è¿æ¥ä¸²å£,è¿›å…¥ç³»ç»Ÿ.æœ‰æ—¶å¼•åŒä¼šé•¿æ—¶é—´æ— æ³•åˆå§‹åŒ–,å°è¯•æŒ‰ä¸€ä¸‹æ¿å­ä¸Šçš„<code>B1 USER</code>æŒ‰é”®.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$ minicom -o -b 115200 -D /dev/ttyACM0</span><br><span class="line"></span><br><span class="line">nsh&gt; <span class="built_in">help</span></span><br><span class="line"><span class="built_in">help</span> usage:  <span class="built_in">help</span> [-v] [&lt;cmd&gt;]</span><br><span class="line"></span><br><span class="line">  .         cat       df        hexdump   mkdir     mw        <span class="built_in">set</span>       umount</span><br><span class="line">  [         <span class="built_in">cd</span>        <span class="built_in">echo</span>      ifconfig  mkfatfs   nslookup  sleep     <span class="built_in">unset</span></span><br><span class="line">  ?         cp        <span class="built_in">exec</span>      ifdown    mkfifo    ps        <span class="built_in">source</span>    usleep</span><br><span class="line">  addroute  cmp       exitifup      mkrd      <span class="built_in">pwd</span>       <span class="built_in">test</span>      wget</span><br><span class="line">  arp       dirname   <span class="literal">false</span>     <span class="built_in">kill</span>      mh        rm        time      xd</span><br><span class="line">  basename  dd        free      ls        mount     rmdir     <span class="literal">true</span></span><br><span class="line">  <span class="built_in">break</span>     delroute  <span class="built_in">help</span>      mb        mv        route     uname</span><br><span class="line"></span><br><span class="line">Builtin Apps:</span><br><span class="line">  ping6      renew      ntpcstop   sh</span><br><span class="line">  ntpcstart  ping       mm         nsh</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Iotjs"><a href="#Iotjs" class="headerlink" title="Iotjs"></a>Iotjs</h3><ul>
<li><a href="https://github.com/jerryscript-project/iotjs/wiki/Build-for-STM32F4-NuttX" target="_blank" rel="noopener">Build for STM32F4 NuttX</a></li>
<li>è¿™é‡Œæ˜¯å‚ç…§<code>STM32F4</code>æ¥å®è·µçš„.æŠŠ<code>iotjs</code>åŒæ­¥åˆ°ä¸<code>nuttx,apps</code>åŒä¸€çº§ç›®å½•.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/Samsung/iotjs.git</span><br><span class="line">~$ ls</span><br><span class="line">apps  buildroot  iotjs  nuttx</span><br><span class="line"><span class="comment"># é¡»è¦å…ˆæ„å»ºå®ƒ.</span></span><br><span class="line">~$ <span class="built_in">cd</span> iotjs &amp;&amp; tools/build.py  --target-arch=arm --target-os=nuttx --nuttx-home=/fullpath/nuttx --target-board=stm32f7nucleo --jerry-heaplimit=78</span><br><span class="line">==&gt; Initialize submodule</span><br><span class="line"></span><br><span class="line">git submodule init</span><br><span class="line"></span><br><span class="line">Submodule <span class="string">'deps/http-parser'</span> (https://github.com/Samsung/http-parser.git) registered <span class="keyword">for</span> path <span class="string">'deps/http-parser'</span></span><br><span class="line">Submodule <span class="string">'deps/jerry'</span> (https://github.com/jerryscript-project/jerryscript.git) registered <span class="keyword">for</span> path <span class="string">'deps/jerry'</span></span><br><span class="line">Submodule <span class="string">'deps/libtuv'</span> (https://github.com/Samsung/libtuv.git) registered <span class="keyword">for</span> path <span class="string">'deps/libtuv'</span></span><br><span class="line">Submodule <span class="string">'deps/mbedtls'</span> (https://github.com/ARMmbed/mbedtls.git) registered <span class="keyword">for</span> path <span class="string">'deps/mbedtls'</span></span><br><span class="line">git submodule update</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ç¼–è¯‘ä¸­å‡ºç°ä¸‹é¢çš„é”™è¯¯,æ˜¯å› ä¸ºå¤´æ–‡ä»¶é‡Œçš„ä¸€äº›æ¡ä»¶å®å®šä¹‰çš„ç»“æœ,ä¹Ÿå°±æ˜¯è¯´åœ¨<code>nuttx</code>ç³»ç»Ÿå†…æ²¡æœ‰é€‰æ‹©<code>CONFIG_SERIAL_TERMIOS=y</code>,æ‰€ä»¥æ‰ä¼šå¯¼è‡³<code>error: field &#39;orig_termios&#39; has incomplete type</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In file included from /fullpath/iotjs/deps/libtuv/include/uv.h:77:0,</span><br><span class="line">                 from /fullpath/iotjs/deps/libtuv/src/fs-poll.c:22:</span><br><span class="line">/fullpath/iotjs/deps/libtuv/include/uv-unix.h:428:18: error: field <span class="string">'orig_termios'</span> has incomplete <span class="built_in">type</span></span><br><span class="line">   struct termios orig_termios;                                                \</span><br><span class="line">                  ^</span><br><span class="line">/fullpath/iotjs/deps/libtuv/include/uv.h:680:3: note: <span class="keyword">in</span> expansion of macro <span class="string">'UV_TTY_PRIVATE_FIELDS'</span></span><br><span class="line">   UV_TTY_PRIVATE_FIELDS</span><br><span class="line">   ^</span><br><span class="line">make[5]: *** [CMakeFiles/tuv.dir/build.make:63: CMakeFiles/tuv.dir/src/fs-poll.c.obj] Error 1</span><br><span class="line">make[4]: *** [CMakeFiles/Makefile2:73: CMakeFiles/tuv.dir/all] Error 2</span><br><span class="line">make[3]: *** [Makefile:130: all] Error 2</span><br><span class="line">make[2]: *** [CMakeFiles/libtuv.dir/build.make:111: deps/libtuv/src/libtuv-stamp/libtuv-build] Error 2</span><br><span class="line">make[1]: *** [CMakeFiles/Makefile2:184: CMakeFiles/libtuv.dir/all] Error 2</span><br><span class="line">make: *** [Makefile:130: all] Error 2</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨<code>apps/system</code>å†…,åˆ›å»ºä¸€ä¸ª<code>iotjs</code>çš„ç›®å½•,å…·çš„<code>app</code>å†…å®¹æ˜¯æ¥è‡ªäº<code>STM32F4</code>ä¸‹é¢çš„.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ mkdir apps/system/iotjs</span><br><span class="line">~$ cp iotjs/config/nuttx/stm32f4dis/app/*  apps/system/iotjs</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¿…é¡»è¦åœ¨<code>app/system/Kconfig</code>åŠ ä¸Šä¸€æ¡<code>source &quot;/&lt;fullpath&gt;/apps/system/iotjs/Kconfig&quot;</code>è®°å½•.</p>
</li>
</ul>
<h2 id="ä½¿ç”¨ä¸²å£ä¸ESP8266é€šä¿¡"><a href="#ä½¿ç”¨ä¸²å£ä¸ESP8266é€šä¿¡" class="headerlink" title="ä½¿ç”¨ä¸²å£ä¸ESP8266é€šä¿¡"></a>ä½¿ç”¨ä¸²å£ä¸ESP8266é€šä¿¡</h2><ul>
<li><p>åœ¨ä½¿ç”¨<code>ESP8266</code>æ—¶,è¦æ³¨æ„é…ç½®å‡ ä¸ªå¿…é¡»é¡¹,è¿™é‡Œä½¿ç”¨æ¿ä¸Šçš„<code>UART4</code>æ¥é€šä¿¡.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-&gt; System Type -&gt; STM32 Peripheral Support -&gt; [*] UART4</span><br><span class="line">-&gt; Application Configuration -&gt; Network Utilities -&gt; [*] ESP8266</span><br><span class="line">-&gt; Application Configuration -&gt; System Libraries and NSH Add-Ons -&gt; [*] CU minimal serial terminal</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>UART4</code>å®šä¹‰ç¼ºå¤±çš„é”™è¯¯</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CC:  chip/stm32_serial.c</span><br><span class="line">chip/stm32_serial.c:1037:20: error: <span class="string">'GPIO_UART4_TX'</span> undeclared here (not <span class="keyword">in</span> a <span class="keyword">function</span>)</span><br><span class="line">   .tx_gpio       = GPIO_UART4_TX,</span><br><span class="line">                    ^</span><br><span class="line">chip/stm32_serial.c:1038:20: error: <span class="string">'GPIO_UART4_RX'</span> undeclared here (not <span class="keyword">in</span> a <span class="keyword">function</span>)</span><br><span class="line">   .rx_gpio       = GPIO_UART4_RX,</span><br><span class="line">                    ^</span><br><span class="line">make[1]: *** [Makefile:154: stm32_serial.o] Error 1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="STM32F103æœ€å°ç³»ç»Ÿ"><a href="#STM32F103æœ€å°ç³»ç»Ÿ" class="headerlink" title="STM32F103æœ€å°ç³»ç»Ÿ"></a>STM32F103æœ€å°ç³»ç»Ÿ</h2><ul>
<li>è¿™é‡Œä½¿ç”¨çš„æœ€å°æ¿ç³»ç»Ÿ,æ ‡å‡†<code>JTAG</code>ä¸å¤§éƒ¨åˆ†ç®¡è„šèƒ½å¼•å‡ºæ¥,æ¸…æ™°æ˜äº†,è¿™é‡Œé‡ç‚¹å‚ç…§<code>nuttx</code>æ¿å­å†…çš„<code>README.md</code>.ä½†æ˜¯è¿™é‡Œåœ¨ä½¿ç”¨<code>USB</code>å¼€å¯<code>CDC/ACM</code>ä¸²å£æ—¶æ²¡æˆåŠŸ.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ tools/configure.sh  stm32f103-minimum:usbnsh</span><br></pre></td></tr></table></figure>
<ul>
<li><p>çœ‹äº†è¿™ä¸ªç³»ç»Ÿå†…çš„æ–‡æ¡£è¯´æ˜,<code>STM32F103C8T6</code>çš„å†…éƒ¨<code>flash</code>æ˜¯<code>128KB</code>è€Œä¸æ˜¯å®ƒæ•°æ®æ–‡æ¡£æ‰€è¯´çš„<code>64KB</code>,æ‰€ä¸‹è¿™é‡Œä¿®æ”¹<code>ld</code>æ–‡ä»¶å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">~$ cat boards/arm/stm32/stm32f103-minimum/scripts/ld.script</span><br><span class="line">[....]</span><br><span class="line">/* The STM32F103C8T6 has 64Kb of FLASH beginning at address 0x0800:0000 and</span><br><span class="line"> * 20Kb of SRAM beginning at address 0x2000:0000.  When booting from FLASH,</span><br><span class="line"> * FLASH memory is aliased to address 0x0000:0000 <span class="built_in">where</span> the code expects to</span><br><span class="line"> * begin execution by jumping to the entry point <span class="keyword">in</span> the 0x0800:0000 address</span><br><span class="line"> * range.</span><br><span class="line"> *</span><br><span class="line"> * NOTE: While the STM32F103C8T6 states that the part has 64Kb of FLASH,</span><br><span class="line"> * all parts that I have seen <span class="keyword">do</span>, <span class="keyword">in</span> fact, have 128Kb of FLASH.  That</span><br><span class="line"> * additional 64Kb of FLASH can be utilized by simply change the LENGTH</span><br><span class="line"> * of the flash region from 64K to 128K.</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">MEMORY</span><br><span class="line">&#123;</span><br><span class="line">  flash (rx) : ORIGIN = 0x08000000, LENGTH = 128K</span><br><span class="line">  sram (rwx) : ORIGIN = 0x20000000, LENGTH = 20K</span><br><span class="line">&#125;</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
</li>
<li><p>é…ç½®<code>openocd</code>é€šè¿‡<code>Jlink-OB</code>æ¥çƒ§å†™è°ƒè¯•.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">~$ cat ~/jlink-ob-stm32f1-swd.cfg</span><br><span class="line"><span class="built_in">source</span> [find interface/jlink.cfg]</span><br><span class="line">transport select swd</span><br><span class="line"><span class="built_in">source</span> [find target/stm32f1x.cfg]</span><br><span class="line"></span><br><span class="line"><span class="comment"># çƒ§å†™</span></span><br><span class="line">~$ openocd -f ~/jlink-ob-stm32f1-swd.cfg -c init -c <span class="string">"reset halt"</span> -c <span class="string">"flash write_image erase nuttx.bin 0x08000000"</span> -c <span class="string">"reset run"</span></span><br><span class="line">Open On-Chip Debugger 0.10.0+dev-01423-g3ffa14b04-dirty (2020-10-14-08:59)</span><br><span class="line">Licensed under GNU GPL v2</span><br><span class="line">For bug reports, <span class="built_in">read</span></span><br><span class="line">	http://openocd.org/doc/doxygen/bugs.html</span><br><span class="line">Info : J-Link ARM-OB STM32 compiled Aug 22 2012 19:52:04</span><br><span class="line">Info : Hardware version: 7.00</span><br><span class="line">Info : VTarget = 3.300 V</span><br><span class="line">Info : clock speed 1000 kHz</span><br><span class="line">Info : SWD DPIDR 0x1ba01477</span><br><span class="line">Info : stm32f1x.cpu: hardware has 6 breakpoints, 4 watchpoints</span><br><span class="line">Info : starting gdb server <span class="keyword">for</span> stm32f1x.cpu on 3333</span><br><span class="line">Info : Listening on port 3333 <span class="keyword">for</span> gdb connections</span><br><span class="line">target halted due to debug-request, current mode: Thread</span><br><span class="line">xPSR: 0x01000000 pc: 0x08000130 msp: 0x20000f54</span><br><span class="line">Info : device id = 0x20036410</span><br><span class="line">Info : flash size = 128kbytes</span><br><span class="line">auto erase enabled</span><br><span class="line">wrote 78848 bytes from file nuttx.bin <span class="keyword">in</span> 7.988087s (9.639 KiB/s)</span><br></pre></td></tr></table></figure>
</li>
<li><p>é…ç½®<code>openocd</code>é€šè¿‡å…¶å®ƒå¸¦æœ‰<code>ST-Link</code>è°ƒè¯•æ¿å­æ¥çƒ§å†™è°ƒè¯•,ä¸€èˆ¬çš„å®˜æ–¹è¯„ä¼°æ¿éƒ½ä¼šå¸¦æœ‰è°ƒè¯•å™¨å¦‚,<code>NUCLEO</code>çš„ç³»åˆ—,è¿™é‡Œæ˜¯ä½¿ç”¨<code>NUCLEO-L152RE</code>æ¿ä¸Šçš„<code>ST-LINK</code>æ¥çƒ§å†™è°ƒè¯•.é¦–å…ˆ,æŠŠ<code>NUCLEO-L152RE</code>æ¿ä¸Š<code>CN2</code>è·³çº¿å–æ‰,æ ¹æ®å®˜æ–¹æ–‡æ¡£<code>(SWD)CN4</code>çš„ç«¯çº¿åºæ˜¯<code>1:VDD,2:SWCLK,3:GND,4:SWDIO,5:NRST,6:SWO</code>,è¿™é‡Œåªéœ€è¦ä¸‰æ ¹è¿æ¥æ—¢å¯,</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">      SWD         STM32F103C8T6</span><br><span class="line">  PIN2 SWCLK ----&gt;   P14 SWCLK</span><br><span class="line">  PIN3  GND  ----&gt;    GND</span><br><span class="line">  PIN4 SWDIO ----&gt;   P13 SWDIO</span><br><span class="line"></span><br><span class="line">~$ openocd -f interface/stlink.cfg -f target/stm32f1x.cfg  -c init -c <span class="string">"reset halt"</span> -c <span class="string">"flash write_image erase nuttx.bin 0x08000000"</span> -c <span class="string">"reset run"</span></span><br><span class="line">Open On-Chip Debugger 0.10.0+dev-01423-g3ffa14b04-dirty (2020-10-14-08:59)</span><br><span class="line">Licensed under GNU GPL v2</span><br><span class="line">For bug reports, <span class="built_in">read</span></span><br><span class="line">	http://openocd.org/doc/doxygen/bugs.html</span><br><span class="line">Info : auto-selecting first available session transport <span class="string">"hla_swd"</span>. To override use <span class="string">'transport select &lt;transport&gt;'</span>.</span><br><span class="line">Info : The selected transport took over low-level target control. The results might differ compared to plain JTAG/SWD</span><br><span class="line">Info : clock speed 1000 kHz</span><br><span class="line">Info : STLINK V2J22M5 (API v2) VID:PID 0483:374B</span><br><span class="line">Info : Target voltage: 3.262028</span><br><span class="line">Info : stm32f1x.cpu: hardware has 6 breakpoints, 4 watchpoints</span><br><span class="line">Info : starting gdb server <span class="keyword">for</span> stm32f1x.cpu on 3333</span><br><span class="line">Info : Listening on port 3333 <span class="keyword">for</span> gdb connections</span><br><span class="line">target halted due to debug-request, current mode: Thread</span><br><span class="line">xPSR: 0x01000000 pc: 0x08000130 msp: 0x20000d40</span><br><span class="line">Info : device id = 0x20036410</span><br><span class="line">Info : flash size = 128kbytes</span><br><span class="line">auto erase enabled</span><br><span class="line">wrote 109568 bytes from file nuttx.bin <span class="keyword">in</span> 5.901268s (18.132 KiB/s)</span><br></pre></td></tr></table></figure>
<ul>
<li>å› ä¸º<code>STM32F103C8T6</code>çš„å†…å­˜åªæœ‰<code>20K</code>,æ‰€ä»¥å¾ˆå®¹æ˜“å°±çˆ†äº†,æœ€å…¸çš„å°±æ˜¯æ— æ³•è¿è¡Œå†…ç½®<code>app</code>,å¦‚ä¸‹æ‰€ç¤º:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">NuttShell (NSH) NuttX-9.1.0</span><br><span class="line">nsh&gt; ?</span><br><span class="line"><span class="built_in">help</span> usage:  <span class="built_in">help</span> [-v] [&lt;cmd&gt;]</span><br><span class="line"></span><br><span class="line">  .          cmp        <span class="built_in">exit</span>       <span class="built_in">kill</span>       mount      rmdir      <span class="literal">true</span></span><br><span class="line">  [          dirname    <span class="built_in">export</span>     ls         mv         rmmod      uname</span><br><span class="line">  ?          date       <span class="literal">false</span>      lsmod      mw         <span class="built_in">set</span>        umount</span><br><span class="line">  basename   dd         free       mb         <span class="built_in">printf</span>     sleep      <span class="built_in">unset</span></span><br><span class="line">  cat        df         <span class="built_in">help</span>       mkdir      ps         <span class="built_in">source</span>     usleep</span><br><span class="line">  <span class="built_in">cd</span>         <span class="built_in">echo</span>       hexdump    mksmartfs  <span class="built_in">pwd</span>        <span class="built_in">test</span>       xd</span><br><span class="line">  cp         <span class="built_in">exec</span>       insmod     mh         rm         time</span><br><span class="line"></span><br><span class="line">Builtin Apps:</span><br><span class="line">  chat   sh     hello  spi    nsh    cu</span><br><span class="line">nsh&gt; free</span><br><span class="line">             total       used       free    largest</span><br><span class="line">Umem:        17072      15272       1800       1736</span><br><span class="line"></span><br><span class="line">nsh&gt; spi</span><br><span class="line">nsh: spi: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure>
<ul>
<li>åŸæ¥æ˜¯å› ä¸º,å†…å­˜ä¸å¤Ÿ,æ— æ³•æŠŠç¨‹åºä»<code>FLASH</code>å¤åˆ¶åˆ°å†…å­˜ä¸­è¿è¡Œ,æ‰€ä»¥ä¼šå‡ºç°ä¸Šé¢é”™è¯¯,å¦‚æœæ‰“å¼€ç¼–è¯‘è°ƒè¯•é”™è¯¯å‡º,ä¼šä»<code>nsh shell</code>å¾—åˆ°æ›´è¿›ä¸€æ­¥çš„é”™è¯¯ä¿¡æ¯è¯¦æƒ…,<a href="https://groups.google.com/g/nuttx/c/Wkp635Y4Wkg" target="_blank" rel="noopener">å‚è€ƒ</a>.</li>
<li>æˆ‘è¿™é‡Œå¤„ç†çš„æ–¹æ³•å°±æ˜¯æŠŠ<code>å„ç§çº¿ç¨‹æ ˆ(STACKSIZE)çš„ä½“ç§¯</code>ç¼©å°åˆ°æœ€å¤§åªèƒ½æ˜¯<code>1024</code>,å¦‚ä¸Šæ‰€ç¤º,å†…å­˜åªæœ‰<code>1800</code>,ä½†æ˜¯ç¼–è¯‘æ—¶è®¾ç½®çš„<code>spi tool</code>çš„<code>STACKSIZE</code>æ˜¯<code>2048</code>.</li>
</ul>
<h3 id="è¿æ¥ESP8266"><a href="#è¿æ¥ESP8266" class="headerlink" title="è¿æ¥ESP8266"></a>è¿æ¥ESP8266</h3><ul>
<li><p>è¿™é‡Œæ˜¯ä½¿ç”¨<code>USART3</code>,å¹¶ä¸”æ˜¯è®¾ç½®:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-&gt; System Type -&gt; U[S]ART Configuration -&gt; Serial Driver Configuration -&gt; [*] Disable reordering of ttySx devices.</span><br></pre></td></tr></table></figure>
<p>ESP8266çš„ä¸²å£è·¯å¾„æ˜¯<code>/dev/ttyS1</code>. è¿æ¥å›¾å¦‚ä¸‹.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  STM32            ESP8266</span><br><span class="line">PB10 TX3  ------&gt;   RX</span><br><span class="line">PB11 RX3  ------&gt;   TX</span><br><span class="line">   3V3    ------&gt;   CH_PD  <span class="comment"># è¿™é‡Œåº”è¯¥ä½¿ç”¨ä¸€ä¸ªGPIOæ¥é©±åŠ¨å®ƒ.</span></span><br><span class="line">   3V3    ------&gt;   3V3</span><br><span class="line">   GND    ------&gt;   GND</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">nsh&gt; ?</span><br><span class="line"><span class="built_in">help</span> usage:  <span class="built_in">help</span> [-v] [&lt;cmd&gt;]</span><br><span class="line"></span><br><span class="line">  .          cmp        <span class="built_in">exit</span>       <span class="built_in">kill</span>       mount      rmdir      <span class="literal">true</span></span><br><span class="line">  [          dirname    <span class="built_in">export</span>     ls         mv         rmmod      uname</span><br><span class="line">  ?          date       <span class="literal">false</span>      lsmod      mw         <span class="built_in">set</span>        umount</span><br><span class="line">  basename   dd         free       mb         <span class="built_in">printf</span>     sleep      <span class="built_in">unset</span></span><br><span class="line">  cat        df         <span class="built_in">help</span>       mkdir      ps         <span class="built_in">source</span>     usleep</span><br><span class="line">  <span class="built_in">cd</span>         <span class="built_in">echo</span>       hexdump    mksmartfs  <span class="built_in">pwd</span>        <span class="built_in">test</span>       xd</span><br><span class="line">  cp         <span class="built_in">exec</span>       insmod     mh         rm         time</span><br><span class="line"></span><br><span class="line">Builtin Apps:</span><br><span class="line">  chat  sh    spi   nsh   cu</span><br><span class="line">nsh&gt; cu -s 115200 -l /dev/ttyS1</span><br><span class="line">AT</span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line">AT+GMR</span><br><span class="line">AT version:1.7.4.0(May 11 2020 19:13:04)</span><br><span class="line">SDK version:3.0.4(9532ceb)</span><br><span class="line">compile time:May 27 2020 10:12:17</span><br><span class="line">Bin version(Wroom 02):1.7.4</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<h3 id="è¯»å†™SDå¡-over-SPI"><a href="#è¯»å†™SDå¡-over-SPI" class="headerlink" title="è¯»å†™SDå¡(over SPI)"></a>è¯»å†™SDå¡(over SPI)</h3><ul>
<li><p>è¿™é‡Œåªèƒ½ä½¿ç”¨<code>SPI1</code>åšä¸º<code>SD</code>æ¥å£,å› ä¸ºåœ¨<code>boards/arm/stm32/stm32f103-minimum/src/stm32_mmcsd.c</code>å†…åœ¨å·²ç»ç¡¬ç¼–ç å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/*****************************************************************************</span><br><span class="line"> * Pre-processor Definitions</span><br><span class="line"> ****************************************************************************/</span><br><span class="line"></span><br><span class="line"><span class="comment">#ifndef CONFIG_STM32_SPI1</span></span><br><span class="line"><span class="comment">#  error "SD driver requires CONFIG_STM32_SPI1 to be enabled"</span></span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ifdef CONFIG_DISABLE_MOUNTPOINT</span></span><br><span class="line"><span class="comment">#  error "SD driver requires CONFIG_DISABLE_MOUNTPOINT to be disabled"</span></span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"></span><br><span class="line">/*****************************************************************************</span><br><span class="line"> * Private Definitions</span><br><span class="line"> ****************************************************************************/</span><br><span class="line"></span><br><span class="line">static const int SD_SPI_PORT = 1; /* SD is connected to SPI1 port */</span><br><span class="line">static const int SD_SLOT_NO  = 0; /* There is only one SD slot */</span><br></pre></td></tr></table></figure>
</li>
<li><p>åŸºæœ¬çš„å¿…é¡»é…ç½®é¡¹å¦‚ä¸‹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_STM32_SPI=y</span><br><span class="line">CONFIG_STM32_SPI1=y</span><br><span class="line">CONFIG_SPI=y</span><br><span class="line">CONFIG_SPI_EXCHANGE=y</span><br><span class="line">CONFIG_SPI_DRIVER=y</span><br><span class="line">CONFIG_MMCSD_SPI=y</span><br><span class="line">CONFIG_MMCSD_SPICLOCK=20000000</span><br><span class="line">CONFIG_MMCSD_SPIMODE=0</span><br><span class="line"></span><br><span class="line">CONFIG_MMCSD=y</span><br><span class="line">CONFIG_MMCSD_NSLOTS=1</span><br><span class="line">CONFIG_MMCSD_SPI=y</span><br><span class="line">CONFIG_MMCSD_SPICLOCK=20000000</span><br><span class="line">CONFIG_MMCSD_SPIMODE=0</span><br><span class="line">CONFIG_MMCSD_IDMODE_CLOCK=400000</span><br><span class="line">CONFIG_NSH_MMCSDMINOR=0</span><br><span class="line">CONFIG_NSH_MMCSDSLOTNO=0</span><br><span class="line">CONFIG_NSH_MMCSDSPIPORTNO=1</span><br><span class="line"></span><br><span class="line">CONFIG_FS_FAT=y</span><br><span class="line">CONFIG_FAT_LCNAMES=y</span><br><span class="line">CONFIG_FAT_LFN=y</span><br><span class="line">CONFIG_FAT_MAXFNAME=32</span><br><span class="line">CONFIG_FAT_LFN_ALIAS_TRAILCHARS=0</span><br><span class="line">CONFIG_FSUTILS_MKFATFS=y</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="è¯»å†™W25Q32FV"><a href="#è¯»å†™W25Q32FV" class="headerlink" title="è¯»å†™W25Q32FV"></a>è¯»å†™W25Q32FV</h3><ul>
<li><p>é€šè¿‡æŸ¥çœ‹ä»£ç å‘ç°,<code>W25Q32FV</code>ä¹Ÿæ˜¯ä½¿ç”¨<code>SPI1</code>é»˜è®¤ä¹Ÿæ˜¯ç¡¬ç¼–ç å†™,è¿™é‡Œæ˜¯é»˜è®¤ä½¿ç”¨<code>SPI1</code>æ˜¯çš„å¸¸è§„å¿…é¡»é€‰é¡¹.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_STM32_SPI1=y</span><br><span class="line">CONFIG_STM32_SPI=y</span><br><span class="line"></span><br><span class="line">CONFIG_MTD_W25=y</span><br><span class="line">CONFIG_W25_SPIMODE=0</span><br><span class="line">CONFIG_W25_SPIFREQUENCY=20000000</span><br><span class="line"></span><br><span class="line">CONFIG_MTD=y</span><br><span class="line">CONFIG_MTD_PARTITION=y</span><br><span class="line">CONFIG_MTD_BYTE_WRITE=y</span><br><span class="line">CONFIG_MTD_SMART=y</span><br><span class="line">CONFIG_MTD_SMART_SECTOR_SIZE=1024</span><br><span class="line">CONFIG_MTD_SMART_WEAR_LEVEL=y</span><br><span class="line">CONFIG_MTD_W25=y</span><br><span class="line">CONFIG_FSUTILS_MKSMARTFS=y</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŒ‰ç…§ä¸Šé¢çš„é…ç½®,è¿æ¥<code>W25QF32V</code>çš„çº¿è·¯å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">W25QF32V       STM32F103</span><br><span class="line"></span><br><span class="line">  CS    ----&gt;   PA4/NSS</span><br><span class="line">  DO    ----&gt;   PA6/MISO</span><br><span class="line">  DI    ----&gt;   PA7/MOSI</span><br><span class="line">  CLK   ----&gt;   PA5/SCK</span><br><span class="line">  GND   ----&gt;   GND</span><br><span class="line">  VCC   ----&gt;   3V3</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ ¼åŒ–æ ¼,æŒ‚è½½,è¯»å†™æµ‹è¯•.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nsh&gt; mkdir /tmp</span><br><span class="line">nsh&gt; ls /</span><br><span class="line">/:</span><br><span class="line"> dev/</span><br><span class="line"> mnt/</span><br><span class="line"> proc/</span><br><span class="line">nsh&gt; mksmartfs /dev/smart0p1</span><br><span class="line">nsh&gt; mount -t smartfs /dev/smart0p1 /tmp</span><br><span class="line">nsh&gt; <span class="built_in">echo</span> <span class="string">"11223456"</span> &gt; /tmp/file1.txt</span><br><span class="line">nsh&gt; cat /tmp/file1.txt</span><br><span class="line">11223456</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>STM32F103C8T6</code>ä¸Šå¤§éƒ¨åˆ†çš„æ¥å£éƒ½æè¿°äº†<code>Pin</code>çš„åŠŸèƒ½,å°‘éƒ¨åˆ†å¦‚:<code>PB12,PB13...</code>,è¿™äº›éœ€è¦æŸ¥è¯¢<a href="https://www.st.com/resource/en/datasheet/stm32f103c8.pdf" target="_blank" rel="noopener">stm32f103c8.pdf</a>å†…çš„,<code>Chapter 3, Table 5</code>å†…å®¹.</p>
</li>
</ul>
<h2 id="æ‰©å±•ä½¿ç”¨SPI2"><a href="#æ‰©å±•ä½¿ç”¨SPI2" class="headerlink" title="æ‰©å±•ä½¿ç”¨SPI2"></a>æ‰©å±•ä½¿ç”¨<code>SPI2</code></h2><ul>
<li><code>STM32F103C8T6</code>æœ€å°æ¿,å¼•å‡ºäº†ä¸¤ä¸ª<code>SPI</code>:<ul>
<li><code>SPI1: PA4(NSS),  PA5(SCK),  PA6(MISO),  PA7(MOSI)</code></li>
<li><code>SPI2: PB12(NSS), PB13(SCK), PB14(MISO), PB15(MOSI)</code></li>
</ul>
</li>
<li>ä½†æ˜¯åœ¨<code>Nuttx</code>çš„é‡Œåªå¼€å¯äº†<code>SPI1</code>,åŒæ—¶åªèƒ½æ¥ä¸€ä¸ªå¤–è®¾.æ‰€ä»¥,æˆ‘è¦å‚ç…§æ–‡ä»¶æ¥ä¿®æ”¹å®ƒ,ç›®æ ‡æ˜¯æŠŠ<code>SPI1</code>è¿æ¥åˆ°<code>SD over SPI</code>,<code>SPI2</code>è¿æ¥åˆ°<code>W25QF32V</code>.</li>
<li><p>æ ¹æ®<code>FLASH_SPI1_CS</code>æ·»åŠ <code>FLASH_SPI2_CS</code>å®å®šä¹‰,æŒ‡å®š<code>PB12</code>,æœ€ç»ˆæ–‡ä»¶å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~$ cat boards/arm/stm32/stm32f103-minimum/src/stm32f103_minimum.h</span><br><span class="line">[...]</span><br><span class="line">/* SPI chip selects */</span><br><span class="line"></span><br><span class="line"><span class="comment">#define FLASH_SPI2_CS     (GPIO_OUTPUT|GPIO_CNF_OUTPP|GPIO_MODE_50MHz|\</span></span><br><span class="line">                           GPIO_OUTPUT_SET|GPIO_PORTB|GPIO_PIN12)</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹<code>stm32_spi.c</code>,è¿™ä¸ªæ–‡ä»¶ä¿®æ”¹æ¯”è¾ƒå¤š,åšæˆ<code>patch</code>æ–‡ä»¶å¦‚:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">~$ git diff  boards/arm/stm32/stm32f103-minimum/src/stm32_spi.c  &gt; spi2.patch</span><br><span class="line">diff --git a/boards/arm/stm32/stm32f103-minimum/src/stm32_spi.c b/boards/arm/stm32/stm32f103-minimum/src/stm32_spi.c</span><br><span class="line">index 6f3a585902..01b5b861e8 100644</span><br><span class="line">--- a/boards/arm/stm32/stm32f103-minimum/src/stm32_spi.c</span><br><span class="line">+++ b/boards/arm/stm32/stm32f103-minimum/src/stm32_spi.c</span><br><span class="line">@@ -75,7 +75,7 @@ void stm32_spidev_initialize(void)</span><br><span class="line">    */</span><br><span class="line"></span><br><span class="line"> <span class="comment">#ifdef CONFIG_MTD_W25</span></span><br><span class="line">-  stm32_configgpio(FLASH_SPI1_CS);      /* FLASH chip select */</span><br><span class="line">+  stm32_configgpio(FLASH_SPI2_CS);      /* FLASH chip select */</span><br><span class="line"> <span class="comment">#endif</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">#ifdef CONFIG_CAN_MCP2515</span></span><br><span class="line">@@ -197,7 +197,7 @@ void stm32_spi1select(FAR struct spi_dev_s *dev, uint32_t devid,</span><br><span class="line"> <span class="comment">#endif</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">#ifdef CONFIG_MTD_W25</span></span><br><span class="line">-  stm32_gpiowrite(FLASH_SPI1_CS, !selected);</span><br><span class="line">+  //stm32_gpiowrite(FLASH_SPI1_CS, !selected);</span><br><span class="line"> <span class="comment">#endif</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">@@ -227,6 +227,9 @@ uint8_t stm32_spi1status(FAR struct spi_dev_s *dev, uint32_t devid)</span><br><span class="line"> void stm32_spi2select(FAR struct spi_dev_s *dev, uint32_t devid,</span><br><span class="line">                       bool selected)</span><br><span class="line"> &#123;</span><br><span class="line">+<span class="comment">#ifdef CONFIG_MTD_W25</span></span><br><span class="line">+  stm32_gpiowrite(FLASH_SPI2_CS, !selected);</span><br><span class="line">+<span class="comment">#endif</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> uint8_t stm32_spi2status(FAR struct spi_dev_s *dev, uint32_t devid)</span><br><span class="line">@@ -294,6 +297,16 @@ int stm32_spi1cmddata(FAR struct spi_dev_s *dev, uint32_t devid,</span><br><span class="line">   <span class="built_in">return</span> -ENODEV;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">#endif</span></span><br><span class="line">+</span><br><span class="line">+<span class="comment">#ifdef CONFIG_STM32_SPI2</span></span><br><span class="line">+int stm32_spi2cmddata(FAR struct spi_dev_s *dev, uint32_t devid,</span><br><span class="line">+                      bool cmd)</span><br><span class="line">+&#123;</span><br><span class="line">+    <span class="built_in">return</span> -ENODEV;</span><br><span class="line">+&#125;</span><br><span class="line">+<span class="comment">#endif</span></span><br><span class="line">+</span><br><span class="line">+</span><br><span class="line"> <span class="comment">#endif</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">#endif /* CONFIG_STM32_SPI1 || CONFIG_STM32_SPI2 */</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹<code>stm32_w25.c</code>å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">git diff  boards/arm/stm32/stm32f103-minimum/src/stm32_w25.c</span><br><span class="line">diff --git a/boards/arm/stm32/stm32f103-minimum/src/stm32_w25.c b/boards/arm/stm32/stm32f103-minimum/src/stm32_w25.c</span><br><span class="line">index 6e9d12718d..63ba5153ce 100644</span><br><span class="line">--- a/boards/arm/stm32/stm32f103-minimum/src/stm32_w25.c</span><br><span class="line">+++ b/boards/arm/stm32/stm32f103-minimum/src/stm32_w25.c</span><br><span class="line">@@ -47,7 +47,7 @@</span><br><span class="line"> <span class="comment">#include &lt;errno.h&gt;</span></span><br><span class="line"> <span class="comment">#include &lt;debug.h&gt;</span></span><br><span class="line"></span><br><span class="line">-<span class="comment">#ifdef CONFIG_STM32_SPI1</span></span><br><span class="line">+<span class="comment">#ifdef CONFIG_STM32_SPI2</span></span><br><span class="line"> <span class="comment">#  include &lt;nuttx/spi/spi.h&gt;</span></span><br><span class="line"> <span class="comment">#  include &lt;nuttx/mtd/mtd.h&gt;</span></span><br><span class="line"> <span class="comment">#  include &lt;nuttx/fs/smart.h&gt;</span></span><br><span class="line">@@ -67,13 +67,13 @@</span><br><span class="line">  * timer</span><br><span class="line">  */</span><br><span class="line"></span><br><span class="line">-<span class="comment">#define W25_SPI_PORT 1</span></span><br><span class="line">+<span class="comment">#define W25_SPI_PORT 2</span></span><br><span class="line"></span><br><span class="line"> /* Configuration ************************************************************/</span><br><span class="line"> /* Can<span class="string">'t support the W25 device if it SPI1 or W25 support is not enabled */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> #define HAVE_W25  1</span></span><br><span class="line"><span class="string">-#if !defined(CONFIG_STM32_SPI1) || !defined(CONFIG_MTD_W25)</span></span><br><span class="line"><span class="string">+#if !defined(CONFIG_STM32_SPI2) || !defined(CONFIG_MTD_W25)</span></span><br><span class="line"><span class="string"> #  undef HAVE_W25</span></span><br><span class="line"><span class="string"> #endif</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹<code>stm32_bringup.c</code>å¦‚ä¸‹.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~$ git diff boards/arm/stm32/stm32f103-minimum/src/stm32_bringup.c</span><br><span class="line">diff --git a/boards/arm/stm32/stm32f103-minimum/src/stm32_bringup.c b/boards/arm/stm32/stm32f103-minimum/src/stm32_bringup.c</span><br><span class="line">index efa651034e..b4b0379bde 100644</span><br><span class="line">--- a/boards/arm/stm32/stm32f103-minimum/src/stm32_bringup.c</span><br><span class="line">+++ b/boards/arm/stm32/stm32f103-minimum/src/stm32_bringup.c</span><br><span class="line">@@ -143,7 +143,7 @@</span><br><span class="line"></span><br><span class="line"> /* Can<span class="string">'t support the W25 device if it SPI1 or W25 support is not enabled */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-#if !defined(CONFIG_STM32_SPI1) || !defined(CONFIG_MTD_W25)</span></span><br><span class="line"><span class="string">+#if !defined(CONFIG_STM32_SPI2) || !defined(CONFIG_MTD_W25)</span></span><br><span class="line"><span class="string"> #  undef HAVE_W25</span></span><br><span class="line"><span class="string"> #endif</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="å¼€å¯ä¸²å£è°ƒè¯•"><a href="#å¼€å¯ä¸²å£è°ƒè¯•" class="headerlink" title="å¼€å¯ä¸²å£è°ƒè¯•"></a>å¼€å¯ä¸²å£è°ƒè¯•</h2><ul>
<li>å¦‚æœæ²¡æœ‰åœ¨é…ç½®ç³»ç»Ÿé‡Œæ‰“å¼€ç›¸åº”çš„<code>DEBUG</code>é€‰é¡¹,ç³»ç»Ÿåªå‡ºé”™æ—¶,åªä¼šç»™å‡ºä¸€ä¸ªç®€å•é”™è¯¯å·.ä¸‹é¢æ˜¯æ‰“å¼€é’ˆå¯¹<code>SPI,FS,MMC/SD</code>çš„å‡ºé”™æç¤º.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_DEBUG_ALERT=y</span><br><span class="line">CONFIG_DEBUG_FEATURES=y</span><br><span class="line">CONFIG_DEBUG_ERROR=y</span><br><span class="line">CONFIG_DEBUG_FS=y</span><br><span class="line">CONFIG_DEBUG_FS_ERROR=y</span><br><span class="line">CONFIG_DEBUG_IRQ=y</span><br><span class="line">CONFIG_DEBUG_IRQ_ERROR=y</span><br><span class="line">CONFIG_DEBUG_MEMCARD=y</span><br><span class="line">CONFIG_DEBUG_MEMCARD_ERROR=y</span><br><span class="line">CONFIG_DEBUG_SPI=y</span><br><span class="line">CONFIG_DEBUG_SPI_ERROR=y</span><br><span class="line">CONFIG_DEBUG_FULLOPT=y</span><br><span class="line">CONFIG_ARCH_HAVE_HARDFAULT_DEBUG=y</span><br><span class="line">CONFIG_ARCH_HAVE_MEMFAULT_DEBUG=y</span><br><span class="line">CONFIG_STM32_DISABLE_IDLE_SLEEP_DURING_DEBUG=y</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nsh&gt; mount -t vfat /dev/mmcsd1 /mnt/sd1</span><br><span class="line">        nsh: mount: mount failed: 19</span><br></pre></td></tr></table></figure>
<ul>
<li><p>å¦‚æœç¢°åˆ°ç±»ä¼¼çš„é”™è¯¯å·,å¯ä»¥æ‰“å¼€<code>nuttx/include/errno.h</code>,ä¼šçœ‹åˆ°å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define ENODEV              19</span></span><br><span class="line"><span class="comment">#define ENODEV_STR          "No such device"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æœ€ç»ˆåŒæ—¶å¼€å¯<code>SPI1,SPI2</code>çš„æ¥å£,åŒ…å«äº†<code>SPI,FS,MMC/SD,MTD</code>ä¸€äº›å¿…é¡»é€‰é¡¹,é…ç½®å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CONFIG_STM32_SPI1=y</span><br><span class="line">CONFIG_STM32_SPI2=y</span><br><span class="line">CONFIG_STM32_SPI=y</span><br><span class="line"></span><br><span class="line">CONFIG_ARCH_HAVE_SPI_BITORDER=y</span><br><span class="line">CONFIG_SPI=y</span><br><span class="line">CONFIG_SPI_EXCHANGE=y</span><br><span class="line">CONFIG_SPI_CMDDATA=y</span><br><span class="line">CONFIG_SPI_DRIVER=y</span><br><span class="line">CONFIG_MMCSD=y</span><br><span class="line">CONFIG_MMCSD_NSLOTS=1</span><br><span class="line">CONFIG_MMCSD_SPI=y</span><br><span class="line">CONFIG_MMCSD_SPICLOCK=20000000</span><br><span class="line">CONFIG_MMCSD_SPIMODE=0</span><br><span class="line">CONFIG_MMCSD_IDMODE_CLOCK=400000</span><br><span class="line"></span><br><span class="line">CONFIG_MTD=y</span><br><span class="line">CONFIG_MTD_PARTITION=y</span><br><span class="line">CONFIG_MTD_BYTE_WRITE=y</span><br><span class="line">CONFIG_MTD_SMART=y</span><br><span class="line">CONFIG_MTD_SMART_SECTOR_SIZE=1024</span><br><span class="line">CONFIG_MTD_SMART_WEAR_LEVEL=y</span><br><span class="line">CONFIG_MTD_W25=y</span><br><span class="line">CONFIG_W25_SPIMODE=0</span><br><span class="line">CONFIG_W25_SPIFREQUENCY=20000000</span><br><span class="line"></span><br><span class="line">CONFIG_FS_NEPOLL_DESCRIPTORS=8</span><br><span class="line">CONFIG_FS_MQUEUE_MPATH=<span class="string">"/var/mqueue"</span></span><br><span class="line">CONFIG_FS_FAT=y</span><br><span class="line">CONFIG_FS_SMARTFS=y</span><br><span class="line">CONFIG_SMARTFS_ERASEDSTATE=0xff</span><br><span class="line">CONFIG_SMARTFS_MAXNAMLEN=16</span><br><span class="line">CONFIG_FS_PROCFS=y</span><br><span class="line">CONFIG_FS_PROCFS_REGISTER=y</span><br><span class="line">CONFIG_FS_PROCFS_EXCLUDE_ENVIRON=y</span><br><span class="line"></span><br><span class="line">CONFIG_FSUTILS_MKFATFS=y</span><br><span class="line">CONFIG_FSUTILS_MKSMARTFS=y</span><br><span class="line">CONFIG_NSH_MMCSDMINOR=0</span><br><span class="line">CONFIG_NSH_MMCSDSLOTNO=0</span><br><span class="line">CONFIG_NSH_MMCSDSPIPORTNO=1</span><br><span class="line">CONFIG_NSH_CODECS_BUFSIZE=128</span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯•ç³»ç»Ÿå¦‚ä¸‹.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">NuttShell (NSH) NuttX-9.1.0</span><br><span class="line">nsh&gt; ls /dev</span><br><span class="line">/dev:</span><br><span class="line"> console</span><br><span class="line"> mmcsd0</span><br><span class="line"> null</span><br><span class="line"> smart0p0</span><br><span class="line"> smart0p1</span><br><span class="line"> smart0p2</span><br><span class="line"> smart0p3</span><br><span class="line"> ttyS0</span><br><span class="line">nsh&gt; free</span><br><span class="line">             total       used       free    largest</span><br><span class="line">Umem:        17536      12872       4664       4664</span><br><span class="line">nsh&gt; mkdir /mnt /p0</span><br><span class="line">nsh: mkdir: too many arguments</span><br><span class="line">nsh&gt; mkdir /mnt</span><br><span class="line">nsh&gt; mkdir /p0</span><br><span class="line">nsh&gt; mount -t vfat /dev/mmcsd0 /mnt</span><br><span class="line">nsh&gt; mount -t smartfs /dev/smart0p0 /p0</span><br><span class="line">nsh&gt; df</span><br><span class="line">  Block  Number</span><br><span class="line">  Size   Blocks     Used Available Mounted on</span><br><span class="line"> 16384    15611        3     15608 /mnt</span><br><span class="line">  1024       64       11        53 /p0</span><br><span class="line">     0        0        0         0 /proc</span><br><span class="line">nsh&gt; free</span><br><span class="line">             total       used       free    largest</span><br><span class="line">Umem:        17536      14888       2648       2584</span><br><span class="line">nsh&gt; ls /p0</span><br><span class="line">/p0:</span><br><span class="line"> file.txt</span><br><span class="line">nsh&gt; cat /p0/file.txt</span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">nsh&gt; free</span><br><span class="line">             total       used       free    largest</span><br><span class="line">Umem:        17536      14888       2648       2584</span><br><span class="line">nsh&gt; ls /mnt</span><br><span class="line">/mnt:</span><br><span class="line"> file1.txt</span><br><span class="line">nsh&gt; cat /mnt/file1.txt</span><br><span class="line">1112222ssss</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="NUCLEO-L152RE-MB1136-c-03"><a href="#NUCLEO-L152RE-MB1136-c-03" class="headerlink" title="NUCLEO-L152RE (MB1136 c-03)"></a>NUCLEO-L152RE (MB1136 c-03)</h2><ul>
<li><a href="https://os.mbed.com/platforms/ST-Nucleo-L152RE/" target="_blank" rel="noopener">ST-Nucleo-L152RE</a></li>
<li><a href="https://blog.csdn.net/ABAP_Brave/article/details/53067431" target="_blank" rel="noopener">TFTLCDåŸç†ä¸é©±åŠ¨ä¸æŒ‡ä»¤ä»‹ç»</a></li>
<li><a href="https://controllerstech.com/interface-tft-display-with-stm32/" target="_blank" rel="noopener">Description</a></li>
<li><a href="https://blog.erratasec.com/2016/11/how-to-teach-endian.html" target="_blank" rel="noopener">how-to-teach-endian</a></li>
<li><a href="https://stm32f407-tech-doc.readthedocs.io/en/latest/base/13FSMC/FSMC-TFT%20LCD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95.html" target="_blank" rel="noopener">FSMC-TFT LCDè°ƒè¯•è®°å½•</a></li>
<li><a href="https://ebf-stm32f103-zhinanzhe-std-tutorial.readthedocs.io/zh_CN/latest/book/LCD.html" target="_blank" rel="noopener">é‡ç«LCDâ€”æ¶²æ™¶æ˜¾ç¤º</a></li>
<li>LCDæœ‰å¦‚ä¸‹æ§åˆ¶çº¿:<ul>
<li>CS:<code>Chip Select</code> ç‰‡é€‰,ä½ç”µå¹³æœ‰æ•ˆ</li>
<li>RS:<code>Register Select</code> å¯„å­˜å™¨é€‰æ‹©</li>
<li>WR:<code>Write</code> å†™ä¿¡å·,ä½ç”µå¹³æœ‰æ•ˆ</li>
<li>RD:<code>Read</code> è¯»ä¿¡å·,ä½ç”µå¹³æœ‰æ•ˆ</li>
<li>RESET:é‡å¯ä¿¡å·,ä½ç”µå¹³æœ‰æ•ˆ</li>
<li>DB0-DB15:æ•°æ®çº¿</li>
</ul>
</li>
<li>RSä¸º1(è¡¨ç¤ºDB0-15ä¸Šä¼ é€’çš„æ˜¯è¦è¢«å†™åˆ°å¯„å­˜å™¨çš„å€¼),å¦‚æœä¸º0,è¡¨ç¤ºä¼ é€’çš„æ˜¯æ•°æ®.</li>
<li>å†™(WR=0,RD=1),è¯»(WR=1,RD=0)</li>
<li><p>RESETä¸€ç›´ä¸ºé«˜,å¦‚æœRESETä¸ºä½,ä¼šå¯¼è‡´èŠ¯ç‰‡é‡å¯</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ openocd -f board/stm32ldiscovery.cfg  -c init -c <span class="string">"reset halt"</span> -c <span class="string">"flash write_image erase nuttx.bin  0x08000000"</span> -c <span class="string">"reset run"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ“ä½œIOå£,å‚è€ƒ<a href="www.st.com/stonline/products/literature/rm/13902.pdf">STM32F10xxxå‚è€ƒæ‰‹å†Œ</a>,ç¬¬8ç« ,<code>8.2.5 GPIOx_BSRR</code>çš„å¯„å­˜å™¨å†…å®¹.</p>
<h1 id="æäº¤ä»£ç ç»™NuttX"><a href="#æäº¤ä»£ç ç»™NuttX" class="headerlink" title="æäº¤ä»£ç ç»™NuttX"></a>æäº¤ä»£ç ç»™<code>NuttX</code></h1></li>
<li><a href="https://docs.github.com/cn/free-pro-team@latest/github/collaborating-with-issues-and-pull-requests/merging-a-pull-request" target="_blank" rel="noopener">Githubä¸­æ–‡æ–‡æ¡£</a></li>
<li><a href="https://nuttx.apache.org/docs/latest/contributing/making-changes.html#submitting-your-changes-to-nuttx" target="_blank" rel="noopener">Making Changes Using Git</a></li>
<li><code>NuttX</code>ä»£ç æ˜¯åœ¨<a href="https://github.com/apache/incubator-nuttx" target="_blank" rel="noopener">Github</a>ä¸Š,æ‰€ä»¥è¦ä¸ºå®ƒæäº¤ä»£ç ,éœ€è¦å…ˆæœ‰<code>Github</code>å¸å·.</li>
<li>åœ¨è‡ªå·±çš„<code>Github</code>é‡Œ<code>fork</code><a href="https://github.com/apache/incubator-nuttx/" target="_blank" rel="noopener">NuttX</a>.å†åœ¨æœ¬åœ°å…‹éš†åˆšæ‰<code>fork</code>çš„<code>NuttX</code>.</li>
<li>å¹¶ä¸”æŠŠåŸ<code>https://github.com/apache/incubator-nuttx.git</code>è®¾ç½®æˆä¸Šæ¸¸(upstream).</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> &lt;your forked incubator-nuttx project <span class="built_in">clone</span> url&gt;</span><br><span class="line">~$ git remote add upstream https://github.com/apache/incubator-nuttx.git</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ›å»ºä¸€ä¸ªæœ¬åœ°çš„å¼€å‘åˆ†æ”¯,å¹¶ä¸”æŠŠå®ƒ<code>pull</code>è‡ªå·±<code>fork</code>é¡¹ç›®ä¸­å».</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ git checkout -b dev/stm32l152re-ili93418b-driver</span><br><span class="line">Switched to a new branch <span class="string">'dev/stm32l152re-ili93418b-driver'</span></span><br><span class="line"></span><br><span class="line">~$ git push</span><br><span class="line">fatal: The current branch dev/stm32l152re-ili93418b-driver has no upstream branch.</span><br><span class="line">To push the current branch and <span class="built_in">set</span> the remote as upstream, use</span><br><span class="line"></span><br><span class="line">    git push --<span class="built_in">set</span>-upstream origin dev/stm32l152re-ili93418b-driver</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŒ‰ç…§æç¤º,éœ€è¦å…³è”åˆ°è¿œç¨‹åˆ†æ”¯,æŠŠæœ¬åœ°åˆ†æ”¯<code>dev/stm32l152re-ili93418b-driver</code>æ¨é€åˆ°<code>origin</code>è¿œç¨‹åˆ†æ”¯ä¸Š.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~$ git push --<span class="built_in">set</span>-upstream origin dev/stm32l152re-ili93418b-driver</span><br><span class="line">Username <span class="keyword">for</span> <span class="string">'https://github.com'</span>: xxxxxx</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">'https://xxxxxxx@github.com'</span>:</span><br><span class="line">Total 0 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote:</span><br><span class="line">remote: Create a pull request <span class="keyword">for</span> <span class="string">'dev/stm32l152re-ili93418b-driver'</span> on GitHub by visiting:</span><br><span class="line">remote:      https://github.com/xxxxxx/incubator-nuttx/pull/new/dev/stm32l152re-ili93418b-driver</span><br><span class="line">remote:</span><br><span class="line">To https://github.com/xxxxx/incubator-nuttx</span><br><span class="line"> * [new branch]            dev/stm32l152re-ili93418b-driver -&gt; dev/stm32l152re-ili93418b-driver</span><br><span class="line">Branch <span class="string">'dev/stm32l152re-ili93418b-driver'</span> <span class="built_in">set</span> up to track remote branch <span class="string">'dev/stm32l152re-ili93418b-driver'</span> from <span class="string">'origin'</span>.</span><br></pre></td></tr></table></figure>
</li>
<li><p>å…³è”åˆ°è¿œç¨‹åˆ†æ”¯å,ä»¥åå°±å¯ä»¥ç›´æ¥<code>push</code>,æŸ¥çœ‹<code>.git/config</code>å¦‚ä¸‹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~$ cat .git/config</span><br><span class="line">[core]</span><br><span class="line">	repositoryformatversion = 0</span><br><span class="line">	filemode = <span class="literal">true</span></span><br><span class="line">	bare = <span class="literal">false</span></span><br><span class="line">	logallrefupdates = <span class="literal">true</span></span><br><span class="line">[remote <span class="string">"origin"</span>]</span><br><span class="line">	url = https://github.com/xxxxx/incubator-nuttx</span><br><span class="line">	fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">[branch <span class="string">"master"</span>]</span><br><span class="line">	remote = origin</span><br><span class="line">	merge = refs/heads/master</span><br><span class="line">[remote <span class="string">"upstream"</span>]</span><br><span class="line">	url = https://github.com/apache/incubator-nuttx.git</span><br><span class="line">	fetch = +refs/heads/*:refs/remotes/upstream/*</span><br><span class="line">[branch <span class="string">"dev/stm32l152re-ili93418b-driver"</span>]</span><br><span class="line">	remote = origin</span><br><span class="line">	merge = refs/heads/dev/stm32l152re-ili93418b-driver</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¯»å–ä¸Šæ¸¸çš„æ›´æ–°å¹¶ä¸”åˆå¹¶åˆ°æœ¬åœ°çš„<code>master</code>åˆ†æ”¯.å†<code>push</code>åˆ°è‡ªå·±çš„<code>origin</code>çš„åˆ›åº“.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ git checkout master  <span class="comment"># æœ¬åœ°åˆ‡æ¢åˆ°masteråˆ†æ”¯</span></span><br><span class="line">~$ git fetch upstream  <span class="comment"># è¯»å–ä¸Šæ¸¸æ›´æ”¹,åŒæ­¥.</span></span><br><span class="line">~$ git merge upstream/master  <span class="comment"># åˆå¹¶ä¸Šæ¸¸åˆ°æœ¬åœ°</span></span><br><span class="line">~$ git push             <span class="comment"># pushåŒæ­¥,æŠŠæœ¬çš„masteråŒæ­¥è¿œç«¯çš„origin/master</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ›å»ºæ–°çš„æ›´æ”¹æˆ–æ–‡ä»¶å¹¶ä¸”<code>push</code>åˆ°è¿œç¨‹åˆ†æ”¯</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ git add new-file.c</span><br><span class="line">~$ git commit new-file.c</span><br><span class="line">~$ git push</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ­¤æ—¶<code>github</code>çš„åˆ†æ”¯ä¸Šé¢,ä¼šæœ‰ä¸€ä¸ªæç¤º,<code>Create Pull Request</code>,æŠŠå½“å‰çš„åˆ†æ”¯æ¨é€åˆ°<code>upstream</code>ä¸Šå»,æäº¤åˆå¹¶è¯·æ±‚.</p>
</li>
<li>å¦‚æœè¿è¡Œ<code>rebase upstream/master</code>å,å‘ç°ä»£ç æœ‰é—®é¢˜,å¯ä»¥ä½¿ç”¨<code>git reset --hard HEAD~1</code>å›é€€åˆ°æŒ‡å®šçš„èŠ‚ç‚¹,<code>~[num]</code>å›é€€ç¬¬å‡ ä¸ªç»“ç‚¹.è¿™é‡Œå¯ä»¥ä½¿ç”¨<code>gitg</code>å›¾å½¢å·¥å…·å¯ä»¥ç›´è§‚çš„æ˜¾ç¤º.å‡å¦‚è¿™é‡Œæ˜¯å›é€€åˆ°åˆ›å»ºåˆ†æ”¯æ—¶ç¬¬ä¸€æ¬¡<code>commit</code>ä¹‹å‰, åœ¨äº›å¯ä»¥é‡æ–°ä¿®æ”¹æˆ–æ·»åŠ æ–‡ä»¶,å†é‡æ–°<code>commit</code>, å¹¶ä¸”è¦ä½¿ç”¨<code>git push --force</code>æ‰è¡Œ.ä¹‹åå†å¯ä»¥<code>git fetch upstream; git rebase upstream/master</code>.</li>
</ul>
<h2 id="åˆå¹¶å¤šä¸ªcommitä¸ºä¸€ä¸ªå®Œæ•´commit"><a href="#åˆå¹¶å¤šä¸ªcommitä¸ºä¸€ä¸ªå®Œæ•´commit" class="headerlink" title="åˆå¹¶å¤šä¸ªcommitä¸ºä¸€ä¸ªå®Œæ•´commit"></a>åˆå¹¶å¤šä¸ª<code>commit</code>ä¸ºä¸€ä¸ªå®Œæ•´<code>commit</code></h2><ul>
<li><p>ä¸ºäº†ä¿æŒæäº¤è®°å½•çš„æ›´ç®€æ´æ˜äº†,éœ€è¦æŠŠå¤šä¸ª<code>commit</code>åˆå¹¶åˆ°ä¸€ä¸ªå®Œæ•´çš„<code>commit</code>,ç„¶åå†<code>push</code>åˆ°ä¸Šæ¸¸åº“ä¸­.å‘½ä»¤çš„æ–¹å¼æ˜¯:<code>git rebase -i  [startpoint]  [endpoint]</code>.å¦‚æœä¸æŒ‡å®š<code>endpoint</code>,åˆ™è¯¥åŒºé—´çš„ç»ˆç‚¹é»˜è®¤æ˜¯å½“å‰åˆ†æ”¯<code>HEAD</code>æ‰€æŒ‡å‘çš„<code>commit</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">~$ git rebase -i HEAD~3</span><br><span class="line">pick a68185edc0f2cbd38c8fdbcffaf516278f4f Fix merge conflicts</span><br><span class="line">pick efe10a20278f53af9e6fff5754de39b8c8c4 net/icmp: add sanity check to avoid wild data length</span><br><span class="line">pick fb7480c67637bfa2164f4f76ceff6f509d24 net/neighbor/neighbor_ethernet_out.c: fix build error without ICMPv6</span><br><span class="line">pick 0a262336bd9964b693b57fe93d992482d5d3 arch/arm/src/stm32/stm32_otghsdev.c: Fix syslog formats</span><br><span class="line">[....]</span><br><span class="line"><span class="comment"># Rebase dd4b5e0c68..18d489a8dd onto dd4b5e0c68 (32 commands)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Commands:</span></span><br><span class="line"><span class="comment"># p, pick &lt;commit&gt; = use commit  /* ä¿ç•™è¯¥commit */</span></span><br><span class="line"><span class="comment"># r, reword &lt;commit&gt; = use commit, but edit the commit message /* ä¿ç•™è¯¥commit,ä½†æˆ‘éœ€è¦ä¿®æ”¹è¯¥commitçš„æ³¨é‡Š */</span></span><br><span class="line"><span class="comment"># e, edit &lt;commit&gt; = use commit, but stop for amending /* ä¿ç•™è¯¥commit, ä½†æˆ‘è¦åœä¸‹æ¥ä¿®æ”¹è¯¥æäº¤(ä¸ä»…ä»…ä¿®æ”¹æ³¨é‡Š) */</span></span><br><span class="line"><span class="comment"># s, squash &lt;commit&gt; = use commit, but meld into previous commit /* å°†è¯¥commitå’Œå‰ä¸€ä¸ªcommitåˆå¹¶ */</span></span><br><span class="line"><span class="comment"># f, fixup &lt;commit&gt; = like "squash", but discard this commit's log message /* å¦‚sqaush,ä½†æ˜¯ä¸ä¿ç•™è¯¥æäº¤çš„æ³¨é‡Šä¿¡æ¯ */</span></span><br><span class="line"><span class="comment"># x, exec &lt;command&gt; = run command (the rest of the line) using shell /* æ‰§è¡Œshellå‘½ä»¤ */</span></span><br><span class="line"><span class="comment"># b, break = stop here (continue rebase later with 'git rebase --continue')</span></span><br><span class="line"><span class="comment"># d, drop &lt;commit&gt; = remove commit /* ä¸¢å¼ƒè¯¥commit */</span></span><br><span class="line"><span class="comment"># l, label &lt;label&gt; = label current HEAD with a name</span></span><br><span class="line"><span class="comment"># t, reset &lt;label&gt; = reset HEAD to a label</span></span><br><span class="line"><span class="comment"># m, merge [-C &lt;commit&gt; | -c &lt;commit&gt;] &lt;label&gt; [# &lt;oneline&gt;]</span></span><br><span class="line"><span class="comment"># .       create a merge commit using the original merge commit's</span></span><br><span class="line"><span class="comment"># .       message (or the oneline, if no original merge commit was</span></span><br><span class="line"><span class="comment"># .       specified). Use -c &lt;commit&gt; to reword the commit message.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># These lines can be re-ordered; they are executed from top to bottom.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If you remove a line here THAT COMMIT WILL BE LOST.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># However, if you remove everything, the rebase will be aborted.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note that empty commits are commented out</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚ä¸Šé¢çš„è¯´æ˜ä¸€æ ·,æ”¯æŒå¤šç§ç¼–è¾‘,ç°åœ¨å‡å¦‚æ”¹æˆå¦‚ä¸‹æ‰€ç¤º.ä¿®æ”¹å®Œæˆåä¿å­˜,å°±ä¼šè½¬åˆ°æ³¨é‡Šçš„ä¿®æ”¹ç•Œé¢,å†ä¿å­˜.å®ƒå°±æ‰§è¡Œäº†<code>rebase</code>,å†ç”¨<code>git push -f</code>æŠŠç›¸åº”çš„ä¿®æ”¹å¼ºåˆ¶æäº¤ä¸Šå».</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pick c029a68185edc0f2cbd38c8fdbcffaf516278f4f Fix merge conflicts</span><br><span class="line">s efe10a20278f53af9e6fff5754de39b8c8c4 net/icmp: add sanity check to avoid wild data length</span><br><span class="line">s fb7480c67637bfa2164f4f76ceff6f509d24 net/neighbor/neighbor_ethernet_out.c: fix build error without ICMPv6</span><br><span class="line">f 0a262336bd9964b693b57fe93d992482d5d3 arch/arm/src/stm32/stm32_otghsdev.c: Fix syslog formats</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®ƒå…¶å®æ˜¯åœ¨<code>.git</code>ä¸‹é¢çš„æ–‡ä»¶.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ head  .git/rebase-merge/git-rebase-todo.backup</span><br><span class="line">pick a68185edc0f2cbd38c8fdbcffaf516278f4f Fix merge conflicts</span><br><span class="line">pick efe10a20278f53af9e6fff5754de39b8c8c4 net/icmp: add sanity check to avoid wild data length</span><br><span class="line">pick fb7480c67637bfa2164f4f76ceff6f509d24 net/neighbor/neighbor_ethernet_out.c: fix build error without ICMPv6</span><br><span class="line">pick 0a262336bd9964b693b57fe93d992482d5d3 arch/arm/src/stm32/stm32_otghsdev.c: Fix syslog formats</span><br><span class="line">[....]</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ†æ”¯åˆå¹¶åˆ°ä¸»çº¿æ—¶,å¯ä»¥åˆ é™¤è¯¥åˆ†æ”¯.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ git branch -d &lt;æœ¬åœ°åˆ†æ”¯&gt;</span><br><span class="line">~$ git push  origin --delete &lt;è¿œç«¯åˆ†æ”¯&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœå› ä¸º<code>rebase</code>æ—¶æ‰€äº§ç”Ÿçš„<code>CONFLICT (content): Merge conflict in src/xxxx.cpp</code>,å¹¶ä¸”ç¡®å®šå†²çªå¯ä»¥ä»¥ä¸€æ–¹ä¸ºæ ‡å‡†å¤„ç†,å¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤è‡ªåŠ¨å¤„ç†.<code>--theirs</code>å°±æ˜¯ä½¿ç”¨<code>pull</code>ä¸Šæ¸¸ä»“åº“ç‰ˆæœ¬,<code>--ours</code>æ˜¯ä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬,å†æŠŠå®ƒ<code>commit</code>å°±ç®—æ˜¯åˆå¹¶æˆåŠŸäº†.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ git checkout --theirs src/xxxx.cpp</span><br><span class="line">~$ git commit</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Gitå…¶å®ƒåº”ç”¨"><a href="#Gitå…¶å®ƒåº”ç”¨" class="headerlink" title="Gitå…¶å®ƒåº”ç”¨"></a>Gitå…¶å®ƒåº”ç”¨</h2><ul>
<li>ä½¿ç”¨<code>git</code>æŠŠæŒ‡å®šçš„ä¸€ä¸ª<code>commit</code>å¯¼å‡ºæˆ<code>patch</code>.<a href="https://stackoverflow.com/questions/6658313/how-can-i-generate-a-git-patch-for-a-specific-commit" target="_blank" rel="noopener">how can i generate a git patch for a specific commit</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ git format-patch -1 HEAD</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨è‡ªåŠ¨å¤„ç†åˆå¹¶åˆ†æ”¯çš„å†²çªæ—¶,å¦‚æœåªæœ‰ä¸€è¾¹æ˜¯ä¿®æ”¹çš„æƒ…å†µä¸‹,å‚è€ƒ<a href="https://stackoverflow.com/questions/10697463/resolve-git-merge-conflicts-in-favor-of-their-changes-during-a-pull" target="_blank" rel="noopener">è¿™é‡Œ</a>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ git merge --strategy-option theirs</span><br></pre></td></tr></table></figure>
<h2 id="gitæäº¤æ—¶è‡ªåŠ¨ä¿®æ”¹-è‡ªå¢-ç‰ˆæœ¬å·çš„æ–‡ä»¶"><a href="#gitæäº¤æ—¶è‡ªåŠ¨ä¿®æ”¹-è‡ªå¢-ç‰ˆæœ¬å·çš„æ–‡ä»¶" class="headerlink" title="gitæäº¤æ—¶è‡ªåŠ¨ä¿®æ”¹(è‡ªå¢)ç‰ˆæœ¬å·çš„æ–‡ä»¶"></a><code>git</code>æäº¤æ—¶è‡ªåŠ¨ä¿®æ”¹(è‡ªå¢)ç‰ˆæœ¬å·çš„æ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">~$ cat .git/hooks/pre-commit</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> VER_FILE=src/utils/utils.pri</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -e <span class="variable">$&#123;VER_FILE&#125;</span> ]; <span class="keyword">then</span></span><br><span class="line">   <span class="built_in">exit</span> 1;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"start to update the version in <span class="variable">$VER_FILE</span>"</span></span><br><span class="line"><span class="comment"># 211.8.73</span></span><br><span class="line"><span class="built_in">export</span> VERSION=$(grep <span class="string">"^VERSION ="</span> <span class="variable">$&#123;VER_FILE&#125;</span> | awk <span class="string">'&#123;print $3&#125;'</span> | tr -d <span class="string">'\r'</span>)</span><br><span class="line"><span class="comment"># VARR(211 8 73)</span></span><br><span class="line">IFS=<span class="string">'.'</span> <span class="built_in">read</span> -r -a VARR &lt;&lt;&lt; <span class="string">"<span class="variable">$VERSION</span>"</span></span><br><span class="line"><span class="comment"># VARR(211 8 74)</span></span><br><span class="line">VARR[2]=$((VARR[2]+1))</span><br><span class="line"><span class="comment"># 211. 8 .74</span></span><br><span class="line">VERSION=$(<span class="built_in">echo</span> <span class="variable">$&#123;VARR[@]&#125;</span> | fold -w3 | paste -sd.)</span><br><span class="line"><span class="comment"># replace 211.8.73 with 211.8.74</span></span><br><span class="line">sed -i <span class="string">"/^VERSION/s/=.*/= <span class="variable">$&#123;VERSION// /&#125;</span>/"</span> <span class="variable">$&#123;VER_FILE&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="gitä½¿ç”¨å›¾å½¢å·¥å…·-meld-å¯¹æ¯”ä»£ç "><a href="#gitä½¿ç”¨å›¾å½¢å·¥å…·-meld-å¯¹æ¯”ä»£ç " class="headerlink" title="gitä½¿ç”¨å›¾å½¢å·¥å…·(meld)å¯¹æ¯”ä»£ç "></a><code>git</code>ä½¿ç”¨å›¾å½¢å·¥å…·(meld)å¯¹æ¯”ä»£ç </h2><ul>
<li><p>åœ¨<code>.git/config</code>æ·»åŠ ä¸‹é¢å†…å®¹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Add the following to your .gitconfig file.</span></span><br><span class="line">[diff]</span><br><span class="line">    tool = meld</span><br><span class="line">[difftool]</span><br><span class="line">    prompt = <span class="literal">false</span></span><br><span class="line">[difftool <span class="string">"meld"</span>]</span><br><span class="line">    cmd = meld <span class="string">"<span class="variable">$LOCAL</span>"</span> <span class="string">"<span class="variable">$REMOTE</span>"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯¹æ¯”ä¸åŒåˆ†æ”¯ä¸Šçš„åŒä¸€ä¸ªæ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ git difftool mybranch master -- target.file</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯¹æ¯”å½“å‰åˆ†æ”¯ä¸<code>other-branch</code>çš„<code>src</code>ç›®å½•ä¸‹çš„æ–‡ä»¶,<code>--</code>åçš„å‚æ•°å¯ä»¥çœæ‰,ä¹Ÿå¯ä»¥å…·ä½“æŒ‡æŸä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•å.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ git difftool other-branch -- src</span><br></pre></td></tr></table></figure>
</li>
<li><p>å½“å‰åˆ†æ”¯çš„æ–‡ä»¶ä¸å…¶å®ƒçš„<code>commit</code>å¯¹æ¯”.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ git difftool HEAD~2 -- src/file.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆå¹¶<code>other-branch</code>åˆ°å½“å‰åˆ†æ”¯,å¹¶ä½¿ç”¨<code>other-branch</code>æ¥è§£å†³å†²çª(theirs).</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ git merge -X theirs other-branch</span><br></pre></td></tr></table></figure>
</li>
<li><p>å›é€€ä¸€ä¸ªåˆå¹¶</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --merge HEAD~1</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¼ºåˆ¶<code>fetch</code>è¿œç¨‹ä»“åº“,è¦†ç›–æœ¬åœ°ä»“åº“,æ›¿ä»£<code>pull</code>æ—¶å†²çªæç¤º(æ…ç”¨)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fetch from the default remote, origin</span></span><br><span class="line">~$ git fetch</span><br><span class="line"><span class="comment"># reset your current branch (master) to origin's master</span></span><br><span class="line">~$ git reset --hard origin/master</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="STM32F4-Discovery-MB997C"><a href="#STM32F4-Discovery-MB997C" class="headerlink" title="STM32F4-Discovery(MB997C)"></a>STM32F4-Discovery(MB997C)</h2><h3 id="Audio-CS43L22-æ”¯æŒ"><a href="#Audio-CS43L22-æ”¯æŒ" class="headerlink" title="Audio(CS43L22)æ”¯æŒ"></a>Audio(CS43L22)æ”¯æŒ</h3><h3 id="SPI-SDå¡æ”¯æŒ"><a href="#SPI-SDå¡æ”¯æŒ" class="headerlink" title="SPI SDå¡æ”¯æŒ"></a>SPI SDå¡æ”¯æŒ</h3><h3 id="USB-OTG"><a href="#USB-OTG" class="headerlink" title="USB-OTG"></a>USB-OTG</h3><h2 id="BLE-Sniffer"><a href="#BLE-Sniffer" class="headerlink" title="BLE Sniffer"></a>BLE Sniffer</h2><ul>
<li><a href="Inspired by http://dmitry.gr/index.php?r=05.Projects&amp;proj=11.%20Bluetooth%20LE%20fakery">Faking Bluetooth LE</a></li>
<li><a href="https://wiki.elvis.science/index.php?title=Bluetooth_Sniffing_with_Ubertooth:_A_Step-by-step_guide" target="_blank" rel="noopener">Bluetooth_Sniffing_with_Ubertooth:_A_Step-by-step_guide</a></li>
<li><a href="https://jimmywongiot.com/2020/07/08/how-to-install-nrf-sniffer-through-nrf52-dk-board/" target="_blank" rel="noopener">how-to-install-nrf-sniffer-through-nrf52-dk-board</a></li>
<li><a href="https://kalilinuxtutorials.com/btlejack-bluetooth-low-energy-swiss-army-knife/" target="_blank" rel="noopener">btlejack-bluetooth-low-energy-swiss-army-knife</a></li>
<li><a href="https://how2electronics.com/nrf24l01-arduino-wireless-temperature-monitor-dht11/" target="_blank" rel="noopener">nrf24l01-arduino-wireless-temperature-monitor-dht11</a></li>
<li><a href="https://www.elec-cafe.com/arduino-wireless-temperature-lcd-display-nrf24l01-dht11/" target="_blank" rel="noopener">arduino-wireless-temperature-lcd-display-nrf24l01-dht11</a></li>
</ul>
<h3 id="Ethernet-8720A"><a href="#Ethernet-8720A" class="headerlink" title="Ethernet 8720A"></a>Ethernet 8720A</h3><h1 id="Arm-Mbed-OS"><a href="#Arm-Mbed-OS" class="headerlink" title="Arm Mbed-OS"></a>Arm Mbed-OS</h1><ul>
<li>å‚è€ƒé“¾æ¥<ul>
<li><a href="https://github.com/ARMmbed/mbed-os" target="_blank" rel="noopener">Github ARMmbed mbed-os</a></li>
<li><a href="https://os.mbed.com/" target="_blank" rel="noopener">Mbed</a></li>
<li><a href="https://os.mbed.com/docs/mbed-os/v6.3/introduction/index.html" target="_blank" rel="noopener">Mbed OS v6</a></li>
<li><a href="https://os.mbed.com/platforms/ST-Nucleo-F767ZI/" target="_blank" rel="noopener">ST-Nucleo-F767ZI</a></li>
</ul>
</li>
</ul>
<h2 id="é…ç½®å¼€å‘ç¯å¢ƒ"><a href="#é…ç½®å¼€å‘ç¯å¢ƒ" class="headerlink" title="é…ç½®å¼€å‘ç¯å¢ƒ"></a>é…ç½®å¼€å‘ç¯å¢ƒ</h2><ul>
<li>è¿™é‡Œä½¿ç”¨çš„æ˜¯å½“å‰æœ€æ–°çš„<code>v6.3</code>ç‰ˆæœ¬.<code>Mbed</code>æ”¯æŒä¸‰ç§ä¸åŒç±»å‹çš„å¼€å‘ç¯å¢ƒ(æ¡Œé¢IDE,åœ¨çº¿IDE,å‘½ä»¤è¡Œ),ä¸”æ”¯æŒå¤šç³»ç»Ÿå¹³å°(Win,Mac,Linux),è¿™æ˜¯ä½¿ç”¨<code>Keil,IAR</code>æ‰€ä¸èƒ½æ¯”æ‹Ÿçš„.è¿™é‡Œä¼šæ ¹æ®å®˜æ–¹æ–‡æ¡£è¯´æ˜,å®è·µä¸€ä¸‹æ¡Œé¢ä¸å‘½ä»¤è¡Œçš„å¼€å‘.è€Œä¸”å®ƒä½¿ç”¨çš„æ˜¯<code>C++</code>è¯­è¨€å¼€å‘,è¿™æ ·æœ‰åˆ«äºä¼ ç»Ÿçš„<code>Keil,IAR</code>çš„Cè¯­å¼€å‘,å®ƒçš„ä»£ç é£æ ¼ä¸<code>Arduino</code>ä¸€æ ·.å¹¶ä¸”å®ƒå†…ç½®çš„å®æ—¶æ“ä½œç³»ç»Ÿå°±æ˜¯<code>FreeRTOS</code>.</li>
</ul>
<h3 id="Mbed-Studio"><a href="#Mbed-Studio" class="headerlink" title="Mbed Studio"></a>Mbed Studio</h3><ul>
<li><p>ä½¿ç”¨<code>Mbed Studio</code>éœ€è¦æ³¨å†Œä¸€ä¸ªå¸å·,å®‰è£…å®Œæˆç¬¬ä¸€æ¬¡æ‰“å¼€<code>IDE</code>,ä¼šéœ€è¦å…ˆç™»å½•.å®ƒä¸<code>Web Stduio</code>è¿˜æœ‰åŒä¸€ä¸ªä¼˜ç‚¹,å¯ä»¥ä»çº¿ä¸Šå¯¼å…¥å®˜æ–¹çš„æ¨¡ç‰ˆå·¥ç¨‹.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ wget -c https://studio.mbed.com/installers/latest/linux/MbedStudio.sh</span><br><span class="line">~$ ./MbedStudio.sh</span><br><span class="line">~$ du -sh ~/.<span class="built_in">local</span>/bin/mbed-studio</span><br><span class="line">~$ ls ~/.config/Mbed Studio</span><br><span class="line"> api-targets.json   Cache         Cookies           GPUCache        library-pipeline   mbed-studio.log    <span class="string">'Network Persistent State'</span></span><br><span class="line"> blob_storage       config.json   Cookies-journal   library-cache  <span class="string">'Local Storage'</span>     mbed-studio-tools   recentworkspace.json</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Mbed Studio</code>åŸæœ¬æ˜¯ä½¿ç”¨<code>Arm Compiler 6</code>,è¿™é‡Œå¯ä»¥ä¹Ÿå¯ä»¥åˆ‡æ¢åˆ°<a href="https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads" target="_blank" rel="noopener">Arm Embedded GCC Compiler</a></p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ cat &gt; ~/.config/Mbed Studio/external-tools.json &lt;&lt;EOF</span><br><span class="line">&gt; &#123;</span><br><span class="line">&gt;    <span class="string">"bundled"</span>: &#123;</span><br><span class="line">&gt;       <span class="string">"gcc"</span>: <span class="string">"/fullpath/gcc-arm-none-eabi-9-2020-q2-update/bin"</span></span><br><span class="line">&gt;     &#125;,</span><br><span class="line">&gt;     <span class="string">"defaultToolchain"</span>: <span class="string">"GCC_ARM"</span></span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; EOF</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚ä¸Šé¢æ‰€ç¤º,<code>Mbed Studio</code>ä¹Ÿæ˜¯å¦‚åŒ<code>VScode</code>è¿™æ ·çš„IDE,ä¹Ÿæ˜¯ä½¿ç”¨<code>json</code>æ ¼å¼é…ç½®æ–‡ä»¶,<br>æ‰“å¼€ç•Œé¢èœå•:<code>File -&gt; Settings -&gt; Open Perferences</code>.</li>
</ul>
<h3 id="æµ‹è¯•FRDM-KL25Z"><a href="#æµ‹è¯•FRDM-KL25Z" class="headerlink" title="æµ‹è¯•FRDM-KL25Z"></a>æµ‹è¯•FRDM-KL25Z</h3><ul>
<li><a href="https://os.mbed.com/handbook/Firmware-FRDM-KL25Z" target="_blank" rel="noopener">Firmware FRDM KL25Z</a></li>
<li><a href="http://www.pemicro.com/opensda/" target="_blank" rel="noopener">OpenSDA</a></li>
</ul>
<h4 id="æ›´æ–°OpenSDAçš„å›ºä»¶"><a href="#æ›´æ–°OpenSDAçš„å›ºä»¶" class="headerlink" title="æ›´æ–°OpenSDAçš„å›ºä»¶"></a>æ›´æ–°<code>OpenSDA</code>çš„å›ºä»¶</h4><ul>
<li><code>Mbed Studio</code>éœ€è¦æœ€æ–°çš„å›ºä»¶æ¥æ”¯æŒè°ƒè¯•<code>FRDM-KL25Z</code>,è‡³å°‘éœ€è¦<code>mbed_if_v2.0_frdm_kl25z.s19</code>æ‰èƒ½æ”¯æŒ<code>CMSIS-DAP</code>,æ‰€ä»¥éœ€æŒ‰ç…§ä¸Šè¿°é“¾æ¥ä¸‹è½½åˆ°å›ºä»¶(Pemicro_OpenSDA_Debug_MSD_Update_Apps_2020_05_12.zip).è§£å‹å,æ–‡ä»¶å¤¹æœ‰<code>*.SDA</code>åç¼€çš„å›ºä»¶æ–‡ä»¶,è¿˜æœ‰ä¸€äº›<code>Notes</code>ä¸æŒ‡å¯¼æ‰‹å†Œç­‰.ç”µè„‘è¿åˆ°<code>KL25Z</code>çš„<code>SDA</code>æ¥å£æ—¶,ä¼šåœ¨ç³»ç»Ÿå†…çœ‹åˆ°ä¸€ä¸ª<code>FRDM-KL25Z</code>çš„ç›˜ç¬¦.</li>
<li>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜,å‡çº§å›ºä»¶æ—¶,å¿…é¡»è®©æ¿å­è¿›å…¥<code>Bootloder</code>æ¨¡å¼,æ­¤æ—¶å®ƒä¼šæŒ‚è½½ç›˜ç¬¦å«<code>BOOTLODER</code>.å‘ç°åªèƒ½<code>Windows</code>çš„ç³»ç»Ÿä¸‹è¿›è¡Œå‡çº§,æŒ‰ä½æ¿å­ä¸Šçš„<code>RST</code>é”®,æ¥å…¥<code>SDA</code>ä¸Šç”µ,å› ä¸ºæ¿å­å†…çš„å›ºä»¶æ˜¯<code>v1.01</code>,åœ¨<code>Linux</code>ä¸‹æ— æ³•æŒ‚è½½å‡ºä¸€ä¸ª<code>USB</code>ç›˜ç¬¦, è€Œåªèƒ½åœ¨<code>windows XP,Win 7</code>ä¸‹æ˜¯å¯ä»¥æŒ‚è½½çš„ä¸”å¯ä»¥å‡çº§æˆåŠŸ.è¿™é‡ŒåŸå› æ²¡æœ‰æ·±ç©¶å®ƒäº†.</li>
<li>è§£å‹å›ºä»¶åçš„ç›®å½•å†…è¿˜æœ‰ä¸€ä¸ª<code>OpenSDA_Bootloader_Update_App_v111_2013_12_11.zip</code>,å†è§£å‹å‡ºå°±æ˜¯<code>BOOTUPDATEAPP_Pemicro_v111.SDA</code>è¦å‡çº§çš„å›ºä»¶æ–‡ä»¶,è¿™é‡ŒæŠŠ<code>MSD-DEBUG-FRDM-KL25Z_Pemicro_v118.SDA,BOOTUPDATEAPP_Pemicro_v111.SDA,20140530_k20dx128_kl25z_if_opensda.s19</code>ä¸‰ä¸ªæ–‡ä»¶ç›´æ¥å¤åˆ¶è¿›<code>BOOTLOADER</code>ç›˜ç¬¦å†…,å°±å¯ä»¥å‡çº§äº†.å‡çº§å®Œæˆå,æ¥å…¥<code>SDA</code>ååœ¨<code>Linux</code>ä¸‹ä¼šè‡ªåŠ¨æŒ‚è½½ä¸€ä¸ª<code>MBED</code>ç›˜.</li>
<li>å†æ¬¡æŒ‰ä½æ¿å­ä¸Šçš„<code>RST</code>é”®,æ¥å…¥<code>SDA</code>ä¸Šç”µ,è¿›å…¥<code>BOOTLOADER</code>æ¨¡å¼,æ‰“å¼€<code>BOOTLOADER</code>ç›˜å†…çš„<code>SDA_INFO.HTM</code>è·³è½¬åˆ°ç½‘é¡µ,æŸ¥çœ‹ç½‘é¡µçš„ä¿¡æ¯æ˜¯å¦ä¸å‡çº§çš„å›ºä»¶ç‰ˆæœ¬å¯¹åº”ä¸Š.å¹¶ä¸”å›ºä»¶åœ¨<code>v1.11</code>è¿›,ä¹Ÿå°±å¯ä»¥è‡ªåŠ¨åœ¨<code>Linux</code>ä¸‹æŒ‚è½½<code>BOOTLOADER</code>ç›˜äº†,å¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œåç»­ç‰ˆæœ¬çš„å‡çº§äº†.</li>
<li>æ–°å»ºå·¥ç¨‹,å¯¼å…¥å®˜æ–¹ç¤ºä¾‹<code>mbed-os-example-blinky</code>,ç•Œé¢å¦‚ä¸‹:<br><img src="/imgs/mbed-studio-blinky-project.png" alt="mbed-studio-blinky-project.png"></li>
<li>æ›´æ–°å,å¯ä»¥ä½¿ç”¨<code>openocd</code>è¿æ¥è°ƒè¯•.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">~$ openocd -c <span class="string">"adapter driver cmsis-dap"</span> -f board/frdm-kl25z.cfg</span><br><span class="line">Open On-Chip Debugger 0.10.0+dev-01423-g3ffa14b04-dirty (2020-10-14-08:59)</span><br><span class="line">Licensed under GNU GPL v2</span><br><span class="line">For bug reports, <span class="built_in">read</span></span><br><span class="line">	http://openocd.org/doc/doxygen/bugs.html</span><br><span class="line">Warn : Interface already configured, ignoring</span><br><span class="line">Info : auto-selecting first available session transport <span class="string">"swd"</span>. To override use <span class="string">'transport select &lt;transport&gt;'</span>.</span><br><span class="line">Info : add flash_bank kinetis kl25.pflash</span><br><span class="line">Info : Listening on port 6666 <span class="keyword">for</span> tcl connections</span><br><span class="line">Info : Listening on port 4444 <span class="keyword">for</span> telnet connections</span><br><span class="line">Info : CMSIS-DAP: SWD  Supported</span><br><span class="line">Info : CMSIS-DAP: FW Version = 1.0</span><br><span class="line">Info : CMSIS-DAP: Interface Initialised (SWD)</span><br><span class="line">Info : SWCLK/TCK = 0 SWDIO/TMS = 1 TDI = 0 TDO = 0 nTRST = 0 nRESET = 1</span><br><span class="line">Info : CMSIS-DAP: Interface ready</span><br><span class="line">Info : clock speed 1000 kHz</span><br><span class="line">Info : SWD DPIDR 0x0bc11477</span><br><span class="line">Info : SWD DPIDR 0x0bc11477</span><br><span class="line">Error: Failed to write memory at 0xe000edf0</span><br><span class="line">Info : kl25.cpu: external reset detected</span><br><span class="line">Warn : **** Your Kinetis MCU is probably locked-up <span class="keyword">in</span> RESET/WDOG loop. ****</span><br><span class="line">Warn : **** Common reason is a blank flash (at least a reset vector).  ****</span><br><span class="line">Warn : **** Issue <span class="string">'kinetis mdm halt'</span> <span class="built_in">command</span> or <span class="keyword">if</span> SRST is connected   ****</span><br><span class="line">Warn : **** and configured, use <span class="string">'reset halt'</span>                           ****</span><br><span class="line">Warn : **** If MCU cannot be halted, it is likely secured and running  ****</span><br><span class="line">Warn : **** <span class="keyword">in</span> RESET/WDOG loop. Issue <span class="string">'kinetis mdm mass_erase'</span>         ****</span><br><span class="line">Info : starting gdb server <span class="keyword">for</span> kl25.cpu on 3333</span><br><span class="line">Info : Listening on port 3333 <span class="keyword">for</span> gdb connections</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Mbed-CLI"><a href="#Mbed-CLI" class="headerlink" title="Mbed CLI"></a>Mbed CLI</h3><ul>
<li>è¿™é‡Œæ˜¯åœ¨<code>Linux</code>ä¸‹é¢çš„å®‰è£…éœ€æ±‚,éœ€è¦ç³»ç»Ÿå…ˆå®‰è£…äº†<code>Git,Python3.7.x,Mercurial</code>ç­‰ç¯å¢ƒ.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get install python3 python3-pip git mercurial -y</span><br><span class="line">~$ pip install mbed-cli</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="å®‰è£…é…ç½®äº¤å‰å·¥å…·é“¾"><a href="#å®‰è£…é…ç½®äº¤å‰å·¥å…·é“¾" class="headerlink" title="å®‰è£…é…ç½®äº¤å‰å·¥å…·é“¾"></a>å®‰è£…é…ç½®äº¤å‰å·¥å…·é“¾</h4><ul>
<li>æ ¹æ®<a href="https://os.mbed.com/docs/mbed-os/v6.3/build-tools/index.html#compiler-versions" target="_blank" rel="noopener">è¿™é‡Œæç¤º</a>,æ”¯æŒä¸‰ç§å‚å•†å·¥å…·:<a href="https://developer.arm.com/products/software-development-tools/compilers/arm-compiler/downloads/version-6" target="_blank" rel="noopener">Arm Compiler 6.13 Professional.</a>,<a href="http://www2.keil.com/mdk5/529" target="_blank" rel="noopener"> Keil MDK 5.29</a>,<a href="[GNU Arm Embedded version 9 (9-2019-q4-major">GNU Arm Embedded version 9 (9-2019-q4-major)</a>](<a href="https://developer.arm.com/open-source/gnu-toolchain/gnu-rm/downloads).è¿™é‡Œæ ¹æ®ä¸Šè¿°ä¸­çš„é“¾æ¥å»ä¸‹è½½å®‰è£…é€šç”¨çš„`GCC" target="_blank" rel="noopener">https://developer.arm.com/open-source/gnu-toolchain/gnu-rm/downloads).è¿™é‡Œæ ¹æ®ä¸Šè¿°ä¸­çš„é“¾æ¥å»ä¸‹è½½å®‰è£…é€šç”¨çš„`GCC</a> ARM`å·¥å…·é“¾.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ mbed config -G ARM_GCC_PATH /fullpath/gcc-arm-none-eabi-9-2020-q2-update/bin</span><br><span class="line">[mbed] fullpath/gcc-arm-none-eabi-9-2020-q2-update/bin now <span class="built_in">set</span> as global ARM_GCC</span><br><span class="line">~$ mbed config --list</span><br><span class="line">[mbed] Global config:</span><br><span class="line">GCC_ARM_PATH=/fullpath/gcc-arm-none-eabi-9-2020-q2-update/bin</span><br><span class="line">ARMC6_PATH=/fullpath/ARMCompiler6.15/bin</span><br><span class="line"></span><br><span class="line">[mbed] Local config (/home/michael):</span><br><span class="line">Couldn<span class="string">'t find valid mbed program in /home/michael</span></span><br></pre></td></tr></table></figure>
<h3 id="æ–°å»ºå·¥ç¨‹"><a href="#æ–°å»ºå·¥ç¨‹" class="headerlink" title="æ–°å»ºå·¥ç¨‹"></a>æ–°å»ºå·¥ç¨‹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~$ mbed new mbed-example-program</span><br><span class="line">[mbed] Working path <span class="string">"/fullpath/Mbed Programs"</span> (directory)</span><br><span class="line">[mbed] Creating new program <span class="string">"mbed-example-program"</span> (git)</span><br><span class="line">[mbed] Adding library <span class="string">"mbed-os"</span> from <span class="string">"https://github.com/ARMmbed/mbed-os"</span> at branch/tag <span class="string">"latest"</span></span><br><span class="line">[mbed] Updating reference <span class="string">"mbed-os"</span> -&gt; <span class="string">"https://github.com/ARMmbed/mbed-os/#0db72d0cf26539016efbe38f80d6f2cb7a3d4414"</span></span><br><span class="line">[mbed] Auto-installing missing Python modules (mbed_cloud_sdk, mbed_ls, mbed_host_tests, mbed_greentea, manifest_tool, icetea, pycryptodome, cryptography)...</span><br><span class="line">~$ tree -L 1 mbed-example-program/</span><br><span class="line">mbed-example-program/</span><br><span class="line">â”œâ”€â”€ mbed_app.json</span><br><span class="line">â”œâ”€â”€ mbed-os</span><br><span class="line">â”œâ”€â”€ mbed-os.lib</span><br><span class="line">â””â”€â”€ mbed_settings.py</span><br><span class="line"></span><br><span class="line">1 directory, 3 files</span><br><span class="line">~$ mbed ls -a</span><br><span class="line">[mbed] Working path <span class="string">"/fullpath/Mbed Programs/mbed-example-program"</span> (program)</span><br><span class="line">mbed-example-program (mbed-example-program)</span><br><span class="line">`- mbed-os (https://github.com/ARMmbed/mbed-os<span class="comment">#0db72d0cf265)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸Šé¢æ–°å»ºçš„å·¥ç¨‹,é»˜è®¤æ·»åŠ äº†<code>mbed-os</code>çš„æ”¯æŒ,ä¹Ÿå¯ä»¥ä½¿ç”¨<code>--create-only</code>é€‰é¡¹åˆ›å»ºä¸å«ç³»ç»Ÿçš„å·¥ç¨‹.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ mbed new project2 --create-only</span><br><span class="line">[mbed] Working path <span class="string">"/fullpath/Mbed Programs"</span> (directory)</span><br><span class="line">[mbed] Creating new program <span class="string">"project2"</span> (git)</span><br><span class="line">~$ tree -L 1 project2/</span><br><span class="line">project2/</span><br><span class="line">â””â”€â”€ mbed_settings.py</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å¯¼å…¥å·¥ç¨‹"><a href="#å¯¼å…¥å·¥ç¨‹" class="headerlink" title="å¯¼å…¥å·¥ç¨‹"></a>å¯¼å…¥å·¥ç¨‹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ mbed import https://github.com/ARMmbed/mbed-os-example-blinky<span class="comment">#mbed-os-5.15.0  my-blink</span></span><br><span class="line">[mbed] Working path <span class="string">"/fullpath/github/ArmMbed"</span> (directory)</span><br><span class="line">[mbed] Importing program <span class="string">"my-blink"</span> from <span class="string">"https://github.com/ARMmbed/mbed-os-example-blinky"</span> at branch/tag <span class="string">"mbed-os-5.15.0"</span></span><br><span class="line">[mbed] Adding library <span class="string">"mbed-os"</span> from <span class="string">"https://github.com/ARMmbed/mbed-os"</span> at rev <span class="comment">#64853b354fa1</span></span><br></pre></td></tr></table></figure>
<h3 id="ä¸ºå·¥ç¨‹æ·»åŠ åº“"><a href="#ä¸ºå·¥ç¨‹æ·»åŠ åº“" class="headerlink" title="ä¸ºå·¥ç¨‹æ·»åŠ åº“"></a>ä¸ºå·¥ç¨‹æ·»åŠ åº“</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cd</span> my-blink</span><br><span class="line">~$ mbed add https://github.com/ARMmbed/mbed-cloud-client</span><br><span class="line">[mbed] Working path <span class="string">"/fullpath/Mbed Programs/my-blink"</span> (program)</span><br><span class="line">[mbed] Adding library <span class="string">"mbed-cloud-client"</span> from <span class="string">"https://github.com/ARMmbed/mbed-cloud-client"</span> at latest revision <span class="keyword">in</span> the current branch</span><br><span class="line">[mbed] Updating reference <span class="string">"mbed-cloud-client"</span> -&gt; <span class="string">"https://github.com/ARMmbed/mbed-cloud-client/#f72a23e0dc21de4c82ee53fe947153341419a5b9"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœè¦åˆ é™¤åº“å°±ç›´æ¥:<code>mbed remove mbed-cloud-client</code></li>
</ul>
<h3 id="ç¼–è¯‘å·¥ç¨‹"><a href="#ç¼–è¯‘å·¥ç¨‹" class="headerlink" title="ç¼–è¯‘å·¥ç¨‹"></a>ç¼–è¯‘å·¥ç¨‹</h3><ul>
<li><p>æŸ¥çœ‹å¯ä»¥æ”¯æŒçš„æ¿å­.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~$ mbed compile --supported  <span class="comment"># mbed compile -S</span></span><br><span class="line">[mbed] Working path <span class="string">"/fullpath/ArmMbed/mbed-os-example-blinky"</span> (program)</span><br><span class="line">| Target        | mbed OS 2 | mbed OS 5 | ARM       | uARM | GCC_ARM   | IAR       |</span><br><span class="line">| ------------- | --------- | --------- | --------- | ---- | --------- | --------- |</span><br><span class="line">| ADV_WISE_1510 | -         | Supported | Supported | -    | Supported | Supported |</span><br><span class="line">| ADV_WISE_1570 | -         | Supported | Supported | -    | Supported | Supported |</span><br><span class="line">| ARCH_MAX      | -         | Supported | Supported | -    | Supported | Supported |</span><br><span class="line">| ARCH_PRO      | -         | Supported | Supported | -    | Supported | Supported |</span><br><span class="line">[......]</span><br><span class="line"></span><br><span class="line">~$</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¼–è¯‘</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">~$ mbed compile -m KL25Z -t GCC_ARM</span><br><span class="line">[mbed] Working path <span class="string">"/fullpath/ArmMbed/my-blink"</span> (program)</span><br><span class="line">Building project my-blink (KL25Z, GCC_ARM)</span><br><span class="line">Scan: my-blink</span><br><span class="line">Compile [  0.4%]: at24mac.cpp</span><br><span class="line">[...]</span><br><span class="line">Link: my-blink</span><br><span class="line">Elf2Bin: my-blink</span><br><span class="line">| Module           | .text         | .data       | .bss        |</span><br><span class="line">| ---------------- | ------------- | ----------- | ----------- |</span><br><span class="line">| [fill]           | 48(+48)       | 0(+0)       | 28(+28)     |</span><br><span class="line">| [lib]/c.a        | 4828(+4828)   | 2108(+2108) | 89(+89)     |</span><br><span class="line">| [lib]/gcc.a      | 1004(+1004)   | 0(+0)       | 0(+0)       |</span><br><span class="line">| [lib]/misc       | 200(+200)     | 4(+4)       | 28(+28)     |</span><br><span class="line">| main.o           | 84(+84)       | 0(+0)       | 0(+0)       |</span><br><span class="line">| mbed-os/drivers  | 92(+92)       | 0(+0)       | 0(+0)       |</span><br><span class="line">| mbed-os/hal      | 1440(+1440)   | 4(+4)       | 67(+67)     |</span><br><span class="line">| mbed-os/platform | 4204(+4204)   | 264(+264)   | 220(+220)   |</span><br><span class="line">| mbed-os/rtos     | 6468(+6468)   | 168(+168)   | 5973(+5973) |</span><br><span class="line">| mbed-os/targets  | 2424(+2424)   | 4(+4)       | 19(+19)     |</span><br><span class="line">| Subtotals        | 20792(+20792) | 2552(+2552) | 6424(+6424) |</span><br><span class="line">Total Static RAM memory (data + bss): 8976(+8976) bytes</span><br><span class="line">Total Flash memory (text + data): 23344(+23344) bytes</span><br><span class="line"></span><br><span class="line">Image: ./BUILD/KL25Z/GCC_ARM/my-blink.bin</span><br></pre></td></tr></table></figure>
</li>
<li><p>è®¾ç½®é»˜è®¤çš„<code>target</code>ä¸äº¤å‰å·¥å…·é“¾</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ mbed target KL25Z</span><br><span class="line">[mbed] Working path <span class="string">"/fullpath/Mbed Programs/my-blink"</span> (program)</span><br><span class="line">[mbed] KL25Z now <span class="built_in">set</span> as default target <span class="keyword">in</span> program <span class="string">"my-blink"</span></span><br><span class="line">~$ mbed toolchain GCC_ARM</span><br><span class="line">[mbed] Working path <span class="string">"/fullpath/Mbed Programs/my-blink"</span> (program)</span><br><span class="line">[mbed] GCC_ARM now <span class="built_in">set</span> as default toolchain <span class="keyword">in</span> program <span class="string">"my-blink"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="æµ‹è¯•ä¸è°ƒè¯•"><a href="#æµ‹è¯•ä¸è°ƒè¯•" class="headerlink" title="æµ‹è¯•ä¸è°ƒè¯•"></a>æµ‹è¯•ä¸è°ƒè¯•</h3><ul>
<li><p>è¿è¡Œä»£ç æµ‹è¯•</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ mbed <span class="built_in">test</span> -m KL25Z -t GCC_ARM</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹æµ‹è¯•åˆ—è¡¨</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ mbed <span class="built_in">test</span> --compile-list  | head</span><br><span class="line">Test Case:</span><br><span class="line">    Name: mbed-os-features-device_key-tests-device_key-functionality</span><br><span class="line">    Path: ./mbed-os/features/device_key/TESTS/device_key/functionality</span><br><span class="line">Test Case:</span><br><span class="line">    Name: mbed-os-features-frameworks-utest-tests-unit_tests-basic_test</span><br><span class="line">    Path: ./mbed-os/features/frameworks/utest/TESTS/unit_tests/basic_test</span><br><span class="line">Test Case:</span><br><span class="line">[....]</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿æ¥æ¿å­è¿è¡Œæµ‹è¯•</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~$ mbed <span class="built_in">test</span> -m KL25Z -t GCC_ARM --run</span><br><span class="line">[mbed] Working path <span class="string">"/home/michael/3TB-DISK/Mbed Programs/my-blink"</span> (program)</span><br><span class="line">mbedgt: greentea <span class="built_in">test</span> automation tool ver. 1.7.4</span><br><span class="line">mbedgt: <span class="built_in">test</span> specification file <span class="string">'./BUILD/tests/KL25Z/GCC_ARM/test_spec.json'</span> (specified with --<span class="built_in">test</span>-spec option)</span><br><span class="line">mbedgt: using <span class="string">'./BUILD/tests/KL25Z/GCC_ARM/test_spec.json'</span> from current directory!</span><br><span class="line">mbedgt: detecting connected mbed-enabled devices...</span><br><span class="line">mbedgt: detected 1 device</span><br><span class="line">mbedgt: processing target <span class="string">'KL25Z'</span> toolchain <span class="string">'GCC_ARM'</span> compatible platforms... (note: switch <span class="built_in">set</span> to --parallel 1)</span><br><span class="line">mbedgt: running 4 tests <span class="keyword">for</span> platform <span class="string">'KL25Z'</span> and toolchain <span class="string">'GCC_ARM'</span></span><br><span class="line">mbedgt: mbed-host-test-runner: started</span><br><span class="line">mbedgt: retry mbedhtrun 1/1</span><br><span class="line">mbedgt: [<span class="string">'mbedhtrun'</span>, <span class="string">'-m'</span>, <span class="string">'KL25Z'</span>, <span class="string">'-p'</span>, <span class="string">'/dev/ttyACM0:9600'</span>, <span class="string">'-f'</span>, <span class="string">'"BUILD/tests/KL25Z/GCC_ARM/mbed-os/TESTS/psa/spm_smoke/spm_smoke.bin"'</span>, <span class="string">'-e'</span>, <span class="string">'"mbed-os/TESTS/host_tests"'</span>, <span class="string">'-d'</span>, <span class="string">'/media/michael/MBED'</span>, <span class="string">'-c'</span>, <span class="string">'default'</span>, <span class="string">'-t'</span>, <span class="string">'02000201242BD1925E8A1EE0'</span>, <span class="string">'-r'</span>, <span class="string">'default'</span>, <span class="string">'-C'</span>, <span class="string">'4'</span>, <span class="string">'--sync'</span>, <span class="string">'5'</span>, <span class="string">'-P'</span>, <span class="string">'60'</span>] failed after 1 count</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Ardunioåº“"><a href="#Ardunioåº“" class="headerlink" title="Ardunioåº“"></a><code>Ardunio</code>åº“</h1><ul>
<li>Links:<ul>
<li><a href="https://github.com/stm32duino/Arduino_Core_STM32" target="_blank" rel="noopener">stm32duino</a></li>
<li><a href="https://github.com/stm32duino/wiki/wiki/Getting-Started" target="_blank" rel="noopener">wiki</a></li>
<li><code>Nucleo-F767ZI</code>ä¸<code>Nucleo-L152RE</code>éƒ½æ˜¯å…¼å®¹<code>Arduino</code>ç®¡è„šçš„,è¿™é‡Œæ˜¯ä½¿ç”¨<code>Nucleo-L152RE</code>ä¸ºç›®æ ‡å¯¹åƒ.</li>
</ul>
</li>
</ul>
<h2 id="æ·»åŠ STM32-Cores"><a href="#æ·»åŠ STM32-Cores" class="headerlink" title="æ·»åŠ STM32 Cores"></a>æ·»åŠ <code>STM32 Cores</code></h2><ul>
<li>æ‰“å¼€<code>Arduino IDE</code>çš„<code>File-&gt;Preferences</code>,åœ¨<code>Additional Board Manager URLs:</code>å†…,åŠ å…¥è¿™ä¸ªé“¾æ¥<a href="https://github.com/stm32duino/BoardManagerFiles/raw/master/STM32/package_stm_index.json" target="_blank" rel="noopener">https://github.com/stm32duino/BoardManagerFiles/raw/master/STM32/package_stm_index.json</a></li>
<li>æ·»åŠ å®Œæˆ,å®ƒä¼šæ›´æ–°æ•°æ®.è¿›å…¥<code>Tools -&gt; Boards -&gt; Boards Manager</code>è¿‡æ»¤â€stm32â€æˆ–è€…ä¸‹æ‹‰,é€‰æ‹©å®‰è£…<code>STM32 Cores</code>.</li>
</ul>
<h2 id="çƒ§å†™æ–¹å¼"><a href="#çƒ§å†™æ–¹å¼" class="headerlink" title="çƒ§å†™æ–¹å¼"></a>çƒ§å†™æ–¹å¼</h2><ul>
<li><p>ä¸‹è½½<a href="https://www.st.com/content/st_com/en/products/development-tools/software-development-tools/stm32-software-development-tools/stm32-programmers/stm32cubeprog.html" target="_blank" rel="noopener">stm32-programmers</a>,è§£å‹å,ç›´æ¥è¿è¡Œ<code>Linux</code>ä¸‹çš„å®‰è£…ç¨‹åº,æ ¹æ®å‘å¯¼æç¤º,å®‰è£…åœ¨å½“å‰ç”¨æˆ·çš„ç›®å½•ä¸‹.å®‰è£…å®Œå,ç›®å½•å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/STMicroelectronics/STM32Cube/STM32CubeProgrammer/bin$ ls</span><br><span class="line">ExternalLoader  HSM           libssl.so        libstp11_SAM.so.conf  STM32CubeProgrammer          STM32MP_KeyGen_CLI       STM32_Programmer_CLI</span><br><span class="line">FlashLoader     libcrypto.so  libstp11_SAM.so  RSSe                  STM32CubeProgrammerLauncher  STM32MP_SigningTool_CLI  STM32_Programmer.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿™é‡Œæ˜¯ä½¿ç”¨<code>Nucleo-L152RE</code>ä¸ºç›®æ ‡æ¿,é€‰æ‹©<code>Tools -&gt; Boards: &lt;any&gt; -&gt; STM32 Boards (select from submenu -&gt; Nucleo-64</code>.</p>
</li>
<li><code>Upload</code>æ–¹æ³•,é€‰æ‹©<code>Tools -&gt; Upload method -&gt; STM32CubeProgrammer (SWD)</code></li>
</ul>
<h2 id="æ›´æ–°ST-Linkçš„å›ºä»¶"><a href="#æ›´æ–°ST-Linkçš„å›ºä»¶" class="headerlink" title="æ›´æ–°ST-Linkçš„å›ºä»¶"></a>æ›´æ–°ST-Linkçš„å›ºä»¶</h2><ul>
<li><p><a href="https://support.particle.io/hc/en-us/articles/360039251414-JTAG-and-SWD-Guide" target="_blank" rel="noopener">JTAG and SWD Guide</a></p>
</li>
<li><p>çƒ§å†™æ—¶æç¤ºå¦‚ä¸‹çš„é”™è¯¯.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> STM32CubeProgrammer v2.4.0</span><br><span class="line">      -------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Error: Old ST-LINK firmware version. Upgrade ST-LINK firmware</span><br><span class="line">Error: Old ST-LINK firmware version. Upgrade ST-LINK firmware</span><br><span class="line">Error: Old ST-LINK firmware!Please upgrade it.</span><br><span class="line">Error: Old ST-LINK firmware!Please upgrade it.</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸‹è½½<a href="https://www.st.com/content/st_com/en/products/development-tools/software-development-tools/stm32-software-development-tools/stm32-programmers/stsw-link007.html" target="_blank" rel="noopener">stsw-link007</a>,åè§£å‹å®ƒ.</p>
</li>
<li><p>è§£å‹ç›®å½•å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ tree -L 2  stsw-link007</span><br><span class="line">stsw-link007</span><br><span class="line">â”œâ”€â”€ AllPlatforms</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ native</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ StlinkRulesFilesForLinux</span><br><span class="line">â”‚Â Â  â””â”€â”€ STLinkUpgrade.jar</span><br><span class="line">â”œâ”€â”€ readme.txt</span><br><span class="line">â””â”€â”€ Windows</span><br><span class="line">    â”œâ”€â”€ ST-LinkUpgrade.exe</span><br><span class="line">    â””â”€â”€ STLinkUSBDriver.dll</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ ¹æ®å®ƒçš„<code>readme.txt</code>æç¤º,å®‰è£…å®Œæˆ<code>StlinkRulesFilesForLinux</code>åä¸‹é¢,å°±å¯ä»¥è¿è¡Œæ›´æ–°GUIç¨‹åºæ›´æ–°å›ºä»¶äº†.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ java -jar STLinkUpgrade.jar</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ›´æ–°å®Œæœ€æ–°çš„å›ºä»¶åå¯ä»¥,ç”¨<code>STå®˜æ–¹</code>çš„<code>STM32CubeProgrammer</code>è¯»å†™,ä½†æ˜¯æƒ³ç”¨å®ƒçš„<code>ST-link</code>å¤–æ¥ç»™<code>STM32F103</code>æœ€å°ç³»ç»Ÿæ¿åš<code>SWD</code>çƒ§å†™è°ƒè¯•æ—¶å‡ºé”™äº†.</p>
</li>
</ul>
<h2 id="å¼€æºStlink-tools"><a href="#å¼€æºStlink-tools" class="headerlink" title="å¼€æºStlink-tools"></a>å¼€æº<code>Stlink-tools</code></h2><ul>
<li><a href="https://longer-vision-robot.gitbook.io/stm32f767zi-full-stack/chapter-2.-programming-for-stm32/2.5-test-on-stm32f767zi-blinky" target="_blank" rel="noopener">Plug in Nucleo-144 STM32F767ZI</a></li>
<li>åœ¨<code>Linux</code>ä¸‹æœ‰å¼€æº<a href="https://github.com/stlink-org/stlink" target="_blank" rel="noopener">stlink</a>,ä¹Ÿå¯ä»¥ç›´æ¥è¿è¡Œ<code>apt-get install stlink-tools</code>å®‰è£…å‘è¡Œç‰ˆ.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ st-info --probe</span><br><span class="line">Found 1 stlink programmers</span><br><span class="line"> serial:     30363641464634383535353037353531383731xxxxxx</span><br><span class="line"> hla-serial: <span class="string">"\x30\x36\x36\x41\x46\x46\x34\x38\x35\x35\x35\x30\x37\x35\x35\x31\x38\x37\x31\x38\x32\x37\x34\x37"</span></span><br><span class="line"> flash:      2097152 (pagesize: 2048)</span><br><span class="line"> sram:       524288</span><br><span class="line"> chipid:     0x0451</span><br><span class="line"> descr:      F76xxx</span><br></pre></td></tr></table></figure>
<ul>
<li>stlink-gui</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ apt-get install stlink-gui</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿æ¥æˆåŠŸåè¯»å–å†…å­˜å¦‚ä¸‹ã€‚</li>
</ul>
<h2 id="SPI-SDç¤ºä¾‹"><a href="#SPI-SDç¤ºä¾‹" class="headerlink" title="SPI SDç¤ºä¾‹"></a><code>SPI SD</code>ç¤ºä¾‹</h2><ul>
<li>è¿™é‡Œé€‰æ‹©æ ‡å‡†åº“å†…çš„<code>File -&gt; Examples -&gt; Examples for any board -&gt; SD -&gt; listfiles</code>çš„ç¤ºä¾‹,ç¨‹åºå¦‚ä¸‹æ‰€ç¤º,ç®¡è„šå®šä¹‰å…¼å®¹<code>Nucleo-L152RE</code>,åªæ˜¯<code>CS</code>è¿™é‡Œä¸åŸç¨‹åºå®šä¹‰ä¸ç¬¦.<code>Nucleo-L152RE</code>é‡Œæ˜¯<code>pin 10 (CS)</code>,æ‰€ä»¥åªéœ€è¦åœ¨ç¨‹åºå†…æ”¹æˆ<code>!SD.begin(10)</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">The circuit:</span><br><span class="line">  SD card attached to SPI bus as follows:</span><br><span class="line">** MOSI - pin 11</span><br><span class="line">** MISO - pin 12</span><br><span class="line">** CLK - pin 13</span><br><span class="line">** CS - pin 4 (<span class="keyword">for</span> MKRZero SD: SDCARD_SS_PIN)</span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line"><span class="keyword">if</span> (!SD.begin(10)) &#123;</span><br><span class="line">   Serial.println(<span class="string">"initialization failed!"</span>);</span><br><span class="line">   <span class="keyword">while</span> (1);</span><br><span class="line"> &#125;</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸€é”®<code>upload</code>,å¦‚æœç¼–è¯‘çƒ§å†™æˆåŠŸå,ä½¿ç”¨ä¸²å£æŸ¥çœ‹å®ƒçš„è¾“å‡º.</li>
</ul>
<h1 id="æ ‘è“æ´¾ç›¸å…³"><a href="#æ ‘è“æ´¾ç›¸å…³" class="headerlink" title="æ ‘è“æ´¾ç›¸å…³"></a>æ ‘è“æ´¾ç›¸å…³</h1><ul>
<li><a href="https://www.instructables.com/Arbitrary-Wave-Generator-With-the-Raspberry-Pi-Pic/" target="_blank" rel="noopener">Arbitrary Wave Generator With the Raspberry Pi Pico</a></li>
<li><a href="https://xakcop.com/post/re-2.4ghz/" target="_blank" rel="noopener">Reversing 2.4GHz remote control</a></li>
<li><a href="https://www.riveducha.com/raspberry-pi-gpio-send-radio-signals" target="_blank" rel="noopener">Riverâ€™s Educational Channel</a></li>
<li><a href="https://github.com/F5OEO/rpitx" target="_blank" rel="noopener">F5OEO/rpitx</a></li>
</ul>
<h1 id="FreeRTOS"><a href="#FreeRTOS" class="headerlink" title="FreeRTOS"></a>FreeRTOS</h1><h1 id="åè®®åˆ†æå·¥å…·"><a href="#åè®®åˆ†æå·¥å…·" class="headerlink" title="åè®®åˆ†æå·¥å…·"></a>åè®®åˆ†æå·¥å…·</h1><h2 id="FTDI232H"><a href="#FTDI232H" class="headerlink" title="FTDI232H"></a>FTDI232H</h2><ul>
<li><a href="https://plaes.org/technotes/embedded-systems/ftdi-ft232h-for-hardware-hacking/" target="_blank" rel="noopener">FTDI FT232H for hardware hacking</a></li>
<li><a href="https://hackaday.io/project/164346-andxor-dc27-badge/log/166464-swd-all-the-things" target="_blank" rel="noopener">SWD all the things!</a></li>
<li><a href="https://iosoft.blog/2018/12/08/ftdi-python-part-4/" target="_blank" rel="noopener">Programming FTDI devices in Python: Part 4</a></li>
<li><a href="https://www.allaboutcircuits.com/technical-articles/getting-started-with-openocd-using-ft2232h-adapter-for-swd-debugging/" target="_blank" rel="noopener">Getting Started with OPENOCD Using FT2232H Adapter for SWD Debugging </a></li>
<li><a href="https://iosoft.blog/category/ftdi/" target="_blank" rel="noopener">Viewing ARM CPU activity in real time</a><br><img src="/imgs/ftdi232h_usb.png" alt="ftdi232h_usb.png"></li>
</ul>
<h3 id="PyFTDI"><a href="#PyFTDI" class="headerlink" title="PyFTDI"></a>PyFTDI</h3><ul>
<li><a href="https://eblot.github.io/pyftdi/index.html" target="_blank" rel="noopener">PyFTDI doc</a></li>
<li><a href="https://audiodiwhy.blogspot.com/2020/12/ftdi232h-breakout-board-part-2-e-z-spi.html" target="_blank" rel="noopener">FTDI232H BoB P. II: E-Z SPI &amp; I2C </a></li>
<li>æ˜¾ç¤ºæ‰€æœ‰è®¾å¤‡<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from pyftdi.ftdi import Ftdi</span><br><span class="line">Ftdi.show_devices()</span><br><span class="line">Available interfaces:</span><br><span class="line">  ftdi://ftdi:232h:6:49/1   (Single RS232-HS)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="I2C"><a href="#I2C" class="headerlink" title="I2C"></a>I2C</h3><ul>
<li>i2cé€šä¿¡, <code>SCL(AD0),SDA(AD1,AD2)</code>. <code>I2C</code>çš„åœ°å€æ˜¯ä¸€ä¸ª<code>7-bit</code>çš„æ•°å€¼,åŠ ä¸Šç¬¬<code>8-bit</code>æ–¹å‘ä½(0:å†™,1:è¯»),æ„æˆä¸€ä¸ª<code>8-bit</code>æ•°å€¼.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">from pyftdi.i2c import I2cController</span><br><span class="line"><span class="comment"># Instantiate an I2C controller</span></span><br><span class="line">i2c = I2cController()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure the first interface (IF/1) of the FTDI device as an I2C master</span></span><br><span class="line">i2c.configure(<span class="string">'ftdi://ftdi:2232h/1'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get a port to an I2C slave device</span></span><br><span class="line">slave = i2c.get_port(0x21)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Send one byte, then receive one byte</span></span><br><span class="line">slave.exchange([0x04], 1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Write a register to the I2C slave</span></span><br><span class="line">slave.write_to(0x06, b<span class="string">'\x00'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Read a register from the I2C slave</span></span><br><span class="line">slave.read_from(0x00, 1)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h3><ul>
<li><p>ä¸‹é¢æ˜¯é€šè¿‡ä½¿ç”¨<code>UM232H</code>æ¥è¯»å–ä¸€é¢—è£¸<code>SPI NOR Flash W25Qxx</code>çš„å‚å•†ç¼–å·(jedec_id).æ¥çº¿å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">UM232H           W25Q64FV</span><br><span class="line">  AD0   &lt;-----&gt;   CLK   pin6</span><br><span class="line">  AD1   &lt;-----&gt;   DI    pin5</span><br><span class="line">  AD2   &lt;-----&gt;   DO    pin2</span><br><span class="line">  AD3   &lt;-----&gt;   CS    pin1</span><br><span class="line">  GND   &lt;-----&gt;   GND   pin4</span><br><span class="line">  VCC   &lt;-----&gt;   VCC   pin8</span><br><span class="line">  VCC   &lt;-----&gt;   /HOLD pin7</span><br><span class="line">  VCC   &lt;-----&gt;   /WP   pin3</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç®€å•æµ‹è¯•è¯»å–<code>jedec_id</code></p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import usb</span><br><span class="line">import usb.util</span><br><span class="line">from pyftdi.spi import SpiController</span><br><span class="line">dev = usb.core.find(idVendor=0x0403, idProduct=0x6014)</span><br><span class="line"></span><br><span class="line">spi =  SpiController()</span><br><span class="line">spi.configure(dev)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get a port to a SPI slave w/ /CS on A*BUS3 and SPI mode 0 @ 12MHz</span></span><br><span class="line">slave = spi.get_port(cs=0,freq=12E6,mode=0)</span><br><span class="line"></span><br><span class="line">jedec_id = slave.exchange([0x9f],3)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(hex(jedec_id[1]&lt;&lt; 8 | jedec_id[2]))</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨<a href="https://github.com/eblot/pyspiflash" target="_blank" rel="noopener">pyspiflash</a>æµ‹è¯•<code>SPI flash</code>è¯»å†™.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pyspiflash/spiflash/tests$ ./serialflash.py</span><br><span class="line">Using FTDI device ftdi://ftdi:232h:1:67/1</span><br><span class="line">Flash device: Winbond W25Q64 8 MiB @ SPI freq 12.0 MHz</span><br><span class="line">.Read 8192 KiB <span class="keyword">in</span> 7 seconds @ 1152 KiB/s</span><br><span class="line">..Erase 1024 KiB from flash @ 0x700000 (may take a <span class="keyword">while</span>...)</span><br><span class="line">Erased 1024 KiB <span class="keyword">in</span> 17 seconds @ 59 KiB/s</span><br><span class="line">Build <span class="built_in">test</span> sequence</span><br><span class="line">Writing 1024 KiB to flash (may take a <span class="keyword">while</span>...)</span><br><span class="line">Wrote 1024 KiB <span class="keyword">in</span> 14 seconds @ 70 KiB/s</span><br><span class="line">Reading 1024 KiB from flash</span><br><span class="line">Read 1024 KiB <span class="keyword">in</span> 915 ms @ 1118 KiB/s</span><br><span class="line">Verify flash</span><br><span class="line">Reference: 4942ea371ad576065759f232f429a8abf10c755a</span><br><span class="line">Retrieved: 4942ea371ad576065759f232f429a8abf10c755a</span><br><span class="line">...</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 6 tests <span class="keyword">in</span> 42.775s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<h3 id="FlashROMè¯»å–"><a href="#FlashROMè¯»å–" class="headerlink" title="FlashROMè¯»å–"></a>FlashROMè¯»å–</h3><ul>
<li><a href="https://www.flashrom.org/FT2232SPI_Programmer" target="_blank" rel="noopener">FT2232SPI_Programmer</a></li>
<li><a href="https://ivanorsolic.github.io/post/hardwarehacking1/" target="_blank" rel="noopener">Unpacking the binary firmware /w Binwalk</a></li>
<li><a href="https://security.humanativaspa.it/zyxel-firmware-extraction-and-password-analysis/" target="_blank" rel="noopener">Zyxel firmware extraction and password analysis</a></li>
<li><a href="https://flashrom.org/Documentation" target="_blank" rel="noopener">flashrom</a></li>
</ul>
<ul>
<li><p>æ¢æµ‹flashçš„ç±»å‹ã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~$ flashrom -L</span><br><span class="line"></span><br><span class="line">~$ flashrom -p ft2232_spi:<span class="built_in">type</span>=2232H,port=A</span><br><span class="line">flashrom v1.2 on Linux 5.16.13-20220310 (x86_64)</span><br><span class="line">flashrom is free software, get the <span class="built_in">source</span> code at https://flashrom.org</span><br><span class="line"></span><br><span class="line">Using clock_gettime <span class="keyword">for</span> delay loops (clk_id: 1, resolution: 1ns).</span><br><span class="line">Found Macronix flash chip <span class="string">"MX25L6405"</span> (8192 kB, SPI) on ft2232_spi.</span><br><span class="line">Found Macronix flash chip <span class="string">"MX25L6405D"</span> (8192 kB, SPI) on ft2232_spi.</span><br><span class="line">Found Macronix flash chip <span class="string">"MX25L6406E/MX25L6408E"</span> (8192 kB, SPI) on ft2232_spi.</span><br><span class="line">Found Macronix flash chip <span class="string">"MX25L6436E/MX25L6445E/MX25L6465E/MX25L6473E/MX25L6473F"</span> (8192 kB, SPI) on ft2232_spi.</span><br><span class="line">Multiple flash chip definitions match the detected chip(s): <span class="string">"MX25L6405"</span>, <span class="string">"MX25L6405D"</span>, <span class="string">"MX25L6406E/MX25L6408E"</span>, <span class="string">"MX25L6436E/MX25L6445E/MX25L6465E/MX25L6473E/MX25L6473F"</span></span><br><span class="line">Please specify <span class="built_in">which</span> chip definition to use with the -c &lt;chipname&gt; option.</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¯»å–flashå†…å®¹ã€‚</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~$ flashrom -p ft2232_spi:<span class="built_in">type</span>=2232H,port=A -r <span class="built_in">test</span>-mx25l6445e.rom -c <span class="string">"MX25L6436E/MX25L6445E/MX25L6465E/MX25L6473E/MX25L6473F"</span></span><br><span class="line">flashrom v1.2 on Linux 5.16.13-20220310 (x86_64)</span><br><span class="line">flashrom is free software, get the <span class="built_in">source</span> code at https://flashrom.org</span><br><span class="line"></span><br><span class="line">Using clock_gettime <span class="keyword">for</span> delay loops (clk_id: 1, resolution: 1ns).</span><br><span class="line">Found Macronix flash chip <span class="string">"MX25L6436E/MX25L6445E/MX25L6465E/MX25L6473E/MX25L6473F"</span> (8192 kB, SPI) on ft2232_spi.</span><br><span class="line">Reading flash... <span class="keyword">done</span>.</span><br></pre></td></tr></table></figure>
<h3 id="å±å¹•é©±åŠ¨"><a href="#å±å¹•é©±åŠ¨" class="headerlink" title="å±å¹•é©±åŠ¨"></a>å±å¹•é©±åŠ¨</h3><ul>
<li><a href="https://luma-oled.readthedocs.io/en/latest/" target="_blank" rel="noopener">Luma.OLED</a></li>
<li><a href="https://github.com/rm-hull/luma.core" target="_blank" rel="noopener">rm-hull/luma.core</a></li>
<li><a href="https://github.com/rm-hull/luma.oled" target="_blank" rel="noopener">rm-hull/luma.oled</a></li>
</ul>
<h3 id="OpenOCD"><a href="#OpenOCD" class="headerlink" title="OpenOCD"></a>OpenOCD</h3><ul>
<li>è®©<code>OpenOCD</code>æ”¯æŒ<code>FTDI</code>çš„<code>MPSSE</code>åŠŸèƒ½,<code>--enable-ftdi  Enable building support for the MPSSE mode of FTDI</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cd</span> openocd</span><br><span class="line">~$ ./configure   --<span class="built_in">enable</span>-sysfsgpio   --<span class="built_in">enable</span>-buspirate --<span class="built_in">enable</span>-ftdi</span><br></pre></td></tr></table></figure>
<ul>
<li>é™¤äº†éœ€è¦å¼€å¯<code>openocd</code>çš„æ”¯æŒ,è¿˜æœ‰å°±æ˜¯æ¥çº¿,è¿™é‡Œè¯•ç”¨äº†<code>interface/ftdi/ft232h-module-swd.cfg</code>,<code>interface/ftdi/minimodule-swd.cfg</code>ä¸¤ä¸ªé…ç½®æ–‡ä»¶éƒ½å¯ä»¥è¿æ¥æˆåŠŸ.é…ç½®æ–‡ä»¶å†…æœ‰æ¥çº¿æ³¨é‡Š,å‚è€ƒä¸Šé¢çš„ä¸€äº›é“¾æ¥å¥½åƒæ˜¯è¯´è¦åœ¨<code>ADBUS1,ADBUS2</code>ä¸­é—´æ¥ä¸€ä¸ª<code>470 ohm</code>çš„ç”µé˜», ä½†æ˜¯è¿™é‡Œæ²¡æœ‰æ¥.åªæ˜¯è¦ç¡®è®¤é…ç½®æ–‡ä»¶å†…çš„<code>vid_pid</code>ä¸æ‰€è¿æ¥çš„ç¡¬ä»¶åŒ¹é….</li>
<li>ä½¿ç”¨<code>Jlink-ob</code>æˆ–è€…å…¶å®ƒæ¿ä¸Šçš„<code>STLink</code>åªéœ€è¦ä¸‰æ ¹çº¿,ä½†æ˜¯è¿™é‡Œå¿…éœ€è¦æ¥<code>nTRST</code>,å¦‚:<code>stm32f103zet6</code>å°±æ˜¯<code>PB4</code>.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># FT232HQ minimodule channel 0 (Channel A)</span></span><br><span class="line"><span class="comment"># Connector  FTDI              Target</span></span><br><span class="line"><span class="comment"># Pin        Name</span></span><br><span class="line"><span class="comment"># ---------  ------            ------</span></span><br><span class="line"><span class="comment"># CN2-10      GND               GND</span></span><br><span class="line"><span class="comment"># CN2-13     ADBUS0 (TCK)      SWCLK</span></span><br><span class="line"><span class="comment"># CN2-14     ADBUS2 (TDI/TDO)  SWDIO</span></span><br><span class="line"><span class="comment"># CN2-15     ADBUS1 (TDO/TDI)  SWDIO</span></span><br><span class="line"><span class="comment"># CN2-17     ADBUS4 (GPIOL0)   nTRST</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ openocd -f interface/ftdi/ft232h-module-swd.cfg -f target/stm32f1x.cfg -c init \</span><br><span class="line">   -c <span class="string">"reset halt"</span> -c <span class="string">"flash write_image erase nuttx.bin 0x08000000"</span></span><br></pre></td></tr></table></figure>
<h2 id="æ ‘è“æ´¾-RassberyPi"><a href="#æ ‘è“æ´¾-RassberyPi" class="headerlink" title="æ ‘è“æ´¾(RassberyPi)"></a>æ ‘è“æ´¾(RassberyPi)</h2><ul>
<li><a href="https://iosoft.blog/2019/01/28/raspberry-pi-openocd/" target="_blank" rel="noopener">Raspberry Pi and OpenOCD</a></li>
<li><a href="https://catch22eu.github.io/website/baremetal/openocd_sysfs_stm32/" target="_blank" rel="noopener">BareMetal GCC: Raspberry Pi as JTAG SWD Adapter</a></li>
</ul>
<h2 id="Saleae-é€»è¾‘åˆ†æä»ª"><a href="#Saleae-é€»è¾‘åˆ†æä»ª" class="headerlink" title="Saleae é€»è¾‘åˆ†æä»ª"></a>Saleae é€»è¾‘åˆ†æä»ª</h2><ul>
<li><a href="https:///www.saleae.com" target="_blank" rel="noopener">Saleae</a></li>
<li><p><a href="https://support.saleae.com/protocol-analyzers/unofficially-supported-protocols" target="_blank" rel="noopener">Unofficially Supported Protocols</a></p>
</li>
<li><p><code>Saleae</code>é€»è¾‘åˆ†æä»ªé™¤äº†å®ƒå®˜æ–¹å†…ç½®æ”¯æŒçš„ä¸€äº›åè®®,è¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹<a href="https://support.saleae.com/protocol-analyzers/unofficially-supported-protocols" target="_blank" rel="noopener">Unofficially Supported Protocols</a>åè®®æ‰©å±•.</p>
</li>
</ul>
<h3 id="Saleae-AnalzerSDK"><a href="#Saleae-AnalzerSDK" class="headerlink" title="Saleae AnalzerSDK"></a>Saleae AnalzerSDK</h3><ul>
<li><a href="https://support.saleae.com/saleae-api-and-sdk/protocol-analyzer-sdk" target="_blank" rel="noopener">Protocol Analyzer SDK</a></li>
<li><a href="https://github.com/saleae/SampleAnalyzer" target="_blank" rel="noopener">SampleAnalyzer</a>,ç¤ºä¾‹ç¨‹åº.</li>
<li><a href="https://github.com/saleae/AnalyzerSDK" target="_blank" rel="noopener">AnalyzerSDK</a></li>
<li><a href="https://github.com/saleae/SampleAnalyzer/blob/master/docs/Saleae%20Analyzer%20SDK%20(older" target="_blank" rel="noopener">Saleae Analyzer SDK Documentation</a>.pdf)</li>
</ul>
<h3 id="SDIOåè®®æ’ä»¶"><a href="#SDIOåè®®æ’ä»¶" class="headerlink" title="SDIOåè®®æ’ä»¶"></a>SDIOåè®®æ’ä»¶</h3><ul>
<li><a href="https://github.com/ewfuentes/SaleaeSDIOAnalyzer" target="_blank" rel="noopener">SaleaeSDIOAnalyzer</a></li>
<li><code>AnalyzerSDK</code>ä¸<code>SaleaeSDIOAnalyzer</code>ä¸¤ä¸ªç›®å½•å¿…éœ€è¦åœ¨åŒä¸€çº§ç›®å½•å†…,å†è¿›å…¥åˆ°<code>SaleaeSDIOAnalyzer</code>å†…,ç›´æ¥<code>cmake . &amp;&amp; make</code>.å¦‚æœæ— é”™,å°±ä¼šç”Ÿæˆ<code>libSDIOAnalyzer.so</code>.</li>
<li>Configure Logic to look for the Analyzer Plugin<br>  Launch Logic manually<br>  Options -&gt; Preferences<br>  Under [For Developers], â€œSearch this path for Analyzer Pluginsâ€<br>  Browse for the ../sdmmc-analyzer/xcode4/build/Debug directory<br>  Click â€œSaveâ€ and close Logic</li>
</ul>
<h3 id="SDMMCåè®®"><a href="#SDMMCåè®®" class="headerlink" title="SDMMCåè®®"></a>SDMMCåè®®</h3><ul>
<li><a href="https://github.com/dirker/sdmmc-analyzer" target="_blank" rel="noopener">SD/MMC Analyzer for Logic</a></li>
<li>è¿™ä¸ªæºç æ˜¯ç”¨<code>python</code>è„šæœ¬å»ç¼–è¯‘çš„,è¿™é‡Œåœ¨å®ƒçš„ç›®å½•å»ºä¸€ä¸ª<code>CMake</code>è„šæœ¬æ¥å¤„ç†ç¼–è¯‘.æˆåŠŸåä¼šçœ‹åˆ°ä¸€ä¸ª<code>libSDMMCAnalyzer.so</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">sdmmc-analyzer$ cat CMakeLists.txt</span><br><span class="line">project(<span class="string">"Saleae SDMMC Analyzer"</span>)</span><br><span class="line">cmake_minimum_required(VERSION 3.0)</span><br><span class="line"></span><br><span class="line">message(WARNING <span class="string">"CMake support is still experimental!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Find Analyzer include dir</span></span><br><span class="line">find_path(</span><br><span class="line">    ANALYZER_SDK_INCLUDE_DIR</span><br><span class="line">    NAMES</span><br><span class="line">    Analyzer.h</span><br><span class="line">    AnalyzerChannelData.h</span><br><span class="line">    AnalyzerHelpers.h</span><br><span class="line">    AnalyzerResults.h</span><br><span class="line">    AnalyzerSettings.h</span><br><span class="line">    AnalyzerTypes.h</span><br><span class="line">    SimulationChannelDescriptor.h</span><br><span class="line">    PATHS</span><br><span class="line">    ../include/</span><br><span class="line">    ../AnalyzerSDK/include</span><br><span class="line">    DOC</span><br><span class="line">    <span class="string">"Include directory of the analyzer SDK."</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(NOT ANALYZER_SDK_INCLUDE_DIR)</span><br><span class="line">    message(SEND_ERROR <span class="string">"Analyzer SDK include directory not found"</span>)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">    message(STATUS</span><br><span class="line">        <span class="string">"Analyzer SDK include directory found at <span class="variable">$&#123;ANALYZER_SDK_INCLUDE_DIR&#125;</span>"</span>)</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line"><span class="comment"># needed to differ between 32 and 64 bit library</span></span><br><span class="line"><span class="built_in">set</span>(ANALYZER_BITNESS)</span><br><span class="line"><span class="built_in">set</span>(ANALYZER_LIB_NAME <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(CMAKE_SIZEOF_VOID_P EQUAL 4)</span><br><span class="line">    message(STATUS <span class="string">"32 Bit detected"</span>)</span><br><span class="line">    <span class="built_in">set</span>(ANALYZER_BITNESS 32)</span><br><span class="line">    <span class="built_in">set</span>(ANALYZER_LIB_NAME <span class="string">"Analyzer"</span>)</span><br><span class="line">elseif(CMAKE_SIZEOF_VOID_P EQUAL 8)</span><br><span class="line">    message(STATUS <span class="string">"64 Bit detected"</span>)</span><br><span class="line">    <span class="built_in">set</span>(ANALYZER_BITNESS 64)</span><br><span class="line">    <span class="built_in">set</span>(ANALYZER_LIB_NAME <span class="string">"Analyzer64"</span>)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">    message(FATAL_ERROR <span class="string">"Environment not supported"</span>)</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(NOT (WIN32 OR UNIX))</span><br><span class="line">    <span class="comment"># I have no idea what to do under MacOS</span></span><br><span class="line">    message(WARNING <span class="string">"Environment may not be supported"</span>)</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line"><span class="comment"># find library</span></span><br><span class="line">find_library(</span><br><span class="line">    ANALYZER_SDK_LIBRARY</span><br><span class="line">    NAMES</span><br><span class="line">    <span class="variable">$&#123;ANALYZER_LIB_NAME&#125;</span></span><br><span class="line">    PATHS</span><br><span class="line">    ../lib/</span><br><span class="line">    ../AnalyzerSDK/lib/</span><br><span class="line">    DOC</span><br><span class="line">    <span class="string">"Analyzer SDK library. \</span></span><br><span class="line"><span class="string">If you set it yourself, choose the correct architecture"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(NOT ANALYZER_SDK_LIBRARY)</span><br><span class="line">    message(SEND_ERROR <span class="string">"Analyzer SDK library not found"</span>)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">    message(STATUS <span class="string">"Analyzer SDK library found at <span class="variable">$&#123;ANALYZER_SDK_LIBRARY&#125;</span>"</span>)</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add_library(SDMMCAnalyzer SHARED</span><br><span class="line">    src/SDMMCAnalyzer.cpp</span><br><span class="line">    src/SDMMCAnalyzer.h</span><br><span class="line">    src/SDMMCAnalyzerResults.cpp</span><br><span class="line">    src/SDMMCAnalyzerResults.h</span><br><span class="line">    src/SDMMCAnalyzerSettings.cpp</span><br><span class="line">    src/SDMMCAnalyzerSettings.h</span><br><span class="line">    src/SDMMCHelpers.cpp</span><br><span class="line">    src/SDMMCHelpers.h</span><br><span class="line">    src/SDMMCSimulationDataGenerator.cpp</span><br><span class="line">    src/SDMMCSimulationDataGenerator.h</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">target_include_directories(SDMMCAnalyzer PUBLIC</span><br><span class="line">    <span class="built_in">source</span></span><br><span class="line">    <span class="variable">$&#123;ANALYZER_SDK_INCLUDE_DIR&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">target_link_libraries(SDMMCAnalyzer</span><br><span class="line">    PUBLIC</span><br><span class="line">    <span class="variable">$&#123;ANALYZER_SDK_LIBRARY&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">target_compile_features(SDMMCAnalyzer</span><br><span class="line">    PRIVATE</span><br><span class="line">    cxx_nullptr</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="QSPIåè®®æ’ä»¶"><a href="#QSPIåè®®æ’ä»¶" class="headerlink" title="QSPIåè®®æ’ä»¶"></a>QSPIåè®®æ’ä»¶</h3><ul>
<li><a href="https://github.com/dedicatedcomputing/saleae_qspi" target="_blank" rel="noopener">dedicatedcomputing /saleae_qspi </a><br>ä¹Ÿç±»ä¼¼å¦‚ä¸Šé¢çš„æ“ä½œ,æ·»åŠ <code>CMake</code>è„šæœ¬å¤„ç†.</li>
</ul>
<h1 id="STM8S103"><a href="#STM8S103" class="headerlink" title="STM8S103"></a>STM8S103</h1><ul>
<li><p>Links:</p>
<ul>
<li><a href="https://www.cnx-software.com/2015/04/13/how-to-program-stm8s-1-board-in-linux/" target="_blank" rel="noopener">How to Program STMicro STM8S $1 Board in Linux</a></li>
<li><a href="https://github.com/hbendalibraham/stm8_started" target="_blank" rel="noopener">Getting started with STM8 Development Tools on GNU/LINUX</a></li>
<li><a href="https://www.ondrovo.com/a/20170107-stm8-getting-started/" target="_blank" rel="noopener">Getting started with STM8 on Linux</a></li>
</ul>
</li>
<li><p><code>STM8S103</code>æ˜¯æ”¯æŒ<code>SDCC (Small Devices C compiler)</code>ç¼–è¯‘å™¨çš„,è€Œä¸”<code>SDCC</code>ç‰ˆæœ¬é¡»å¤§äº<code>v3.4.0</code>ä»¥ä¸Šã€‚</p>
</li>
</ul>
<h2 id="SDCCç¤ºä¾‹ç¼–è¯‘"><a href="#SDCCç¤ºä¾‹ç¼–è¯‘" class="headerlink" title="SDCCç¤ºä¾‹ç¼–è¯‘"></a>SDCCç¤ºä¾‹ç¼–è¯‘</h2><h2 id="Arduinoæ”¯æŒ"><a href="#Arduinoæ”¯æŒ" class="headerlink" title="Arduinoæ”¯æŒ"></a>Arduinoæ”¯æŒ</h2><ul>
<li><a href="https://circuitdigest.com/microcontroller-projects/programming-stm8s-microcontrollers-using-arduino-ide" target="_blank" rel="noopener">Programming STM8S Microcontrollers using Arduino IDE</a></li>
<li><a href="https://tenbaht.github.io/sduino/" target="_blank" rel="noopener">sduino</a></li>
</ul>
<h2 id="ç¼–ç¨‹å·¥å…·"><a href="#ç¼–ç¨‹å·¥å…·" class="headerlink" title="ç¼–ç¨‹å·¥å…·"></a>ç¼–ç¨‹å·¥å…·</h2><ul>
<li><a href="https://github.com/vdudouyt/stm8flash" target="_blank" rel="noopener">stm8flash</a></li>
<li><code>stm8flash</code>å¼€æºå·¥å…·,æ˜¯é’ˆå¯¹<code>stlink</code>ç¡¬ä»¶çƒ§å†™çš„ï¼Œæˆ‘è¿™é‡Œè¿˜æ˜¯ä½¿ç”¨<code>openocd+ft2232</code>è¿™æ ·çš„æ–¹å¼å¯¹å®ƒè¿›è¡Œç¼–ç¨‹çƒ§å†™ã€‚</li>
</ul>
<h1 id="å…¶å®ƒèµ„æº"><a href="#å…¶å®ƒèµ„æº" class="headerlink" title="å…¶å®ƒèµ„æº"></a>å…¶å®ƒèµ„æº</h1><ul>
<li><a href="https://github.com/barafael/cute-copter" target="_blank" rel="noopener">A little whimsy copter based on a PCB frame, not at all premium components. </a></li>
<li><a href="https://github.com/Klipper3d/klipper/" target="_blank" rel="noopener">Klipper is a 3d-printer firmware </a></li>
<li><a href="https://www.rtems.org/" target="_blank" rel="noopener">RTEMS</a></li>
</ul>
<h1 id="è°¢è°¢æ”¯æŒ"><a href="#è°¢è°¢æ”¯æŒ" class="headerlink" title="è°¢è°¢æ”¯æŒ"></a>è°¢è°¢æ”¯æŒ</h1><ul>
<li>å¾®ä¿¡äºŒç»´ç :</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/25/ä¸ºAtmel-SAM4S-Xplained-Proç¼–è¯‘å®‰è£…NuttXç³»ç»Ÿ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/25/ä¸ºAtmel-SAM4S-Xplained-Proç¼–è¯‘å®‰è£…NuttXç³»ç»Ÿ/" class="post-title-link" itemprop="url">ä¸ºAtmel-SAM4S-Xplained-Proç¼–è¯‘å®‰è£…NuttXç³»ç»Ÿ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-09-25 18:12:57" itemprop="dateCreated datePublished" datetime="2020-09-25T18:12:57+08:00">2020-09-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-02-26 23:52:54" itemprop="dateModified" datetime="2022-02-26T23:52:54+08:00">2022-02-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ç¼–è¯‘Nuttx"><a href="#ç¼–è¯‘Nuttx" class="headerlink" title="ç¼–è¯‘Nuttx"></a>ç¼–è¯‘Nuttx</h1><h2 id="Atmel-SAM4S-Xplained-Pro"><a href="#Atmel-SAM4S-Xplained-Pro" class="headerlink" title="Atmel SAM4S Xplained Pro"></a>Atmel SAM4S Xplained Pro</h2><ul>
<li><a href="https://github.com/aethaniel/ExperimentalCore-sam" target="_blank" rel="noopener">ExperimentalCore-sam</a></li>
<li><a href="https://high12noon.neocities.org/nuttx-adventures.html" target="_blank" rel="noopener">Adventures with NuttX</a></li>
<li><a href="https://nuttx.nl/" target="_blank" rel="noopener">Nuttx NL</a></li>
</ul>
<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><ul>
<li>Core<ul>
<li>ARM Cortex-M4 with 2 Kbytes of cache running at up to 120 MHz</li>
<li>Memory Protection Unit (MPU)</li>
<li>DSP Instruction Set</li>
<li>Thumb Â® -2 instruction set</li>
</ul>
</li>
<li>Memories<ul>
<li>Up to 2048 Kbytes embedded Flash with optional dual-bank and cache memory, ECC, Security Bit and Lock Bits</li>
<li>Up to 160 Kbytes embedded SRAM</li>
<li>16 Kbytes ROM with embedded boot loader routines (UART, USB) and IAP routines</li>
<li>8-bit Static Memory Controller (SMC): SRAM, PSRAM, NOR and NAND Flash support</li>
</ul>
</li>
</ul>
<ul>
<li><p>åŒæ­¥<code>nuttx</code>ä¸<code>nuttx-apps</code>ä¸¤ä¸ªæºä»£ç ï¼Œå®ƒä»¬ä¸¤ä¸ªå¹³çº§ç›®å½•.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/apache/incubator-nuttx nuttx</span><br><span class="line">~$ git <span class="built_in">clone</span> https://github.com/apache/incubator-nuttx-apps.git apps</span><br><span class="line"></span><br><span class="line">~$ <span class="built_in">cd</span> nuttx</span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰æ”¯æŒæ¿å­.</span></span><br><span class="line">~$ tools/configure.sh -L | grep <span class="string">"sam"</span></span><br><span class="line">~$ tools/configure.sh -l  sam4s-xplained-pro:nsh</span><br><span class="line">~$ cp  boards/arm/sam34/sam4s-xplained-pro/configs/nsh/defconfig .config</span><br><span class="line">~$ cp boards/arm/sam34/sam4s-xplained-pro/scripts/Make.defs .</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œä½¿ç”¨ä¸€ä¸ª ç¬¬ä¸‰æ–¹çš„å·¥å…·é“¾(gcc-arm-none-eabi-6-2017-q2-update) arm-none-eabi- ä¹Ÿå¯ä»¥ç¼–è¯‘æˆåŠŸ.é€‰æ‹© CONFIG_ARMV7M_TOOLCHAIN_GNU_EABIL=y</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">~$ <span class="built_in">export</span> PATH=/fullpath/gcc-arm-none-eabi-6-2017-q2-update/bin:<span class="variable">$PATH</span></span><br><span class="line">~$ make CROSSDEV=arm-none-eabi-</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹äº¤ã•šå·¥å…·é“¾æ”¯æŒçš„CPUç‰¹æ€§.</span></span><br><span class="line">~$ arm-none-eabi-g++ -<span class="built_in">print</span>-multi-lib</span><br><span class="line">.;</span><br><span class="line">thumb;@mthumb</span><br><span class="line">fpu;@mfloat-abi=hard</span><br><span class="line">armv6-m;@mthumb@march=armv6s-m</span><br><span class="line">armv7-m;@mthumb@march=armv7-m</span><br><span class="line">armv7e-m;@mthumb@march=armv7e-m</span><br><span class="line">armv7-ar/thumb;@mthumb@march=armv7</span><br><span class="line">cortex-m7;@mthumb@mcpu=cortex-m7</span><br><span class="line">armv7e-m/softfp;@mthumb@march=armv7e-m@mfloat-abi=softfp@mfpu=fpv4-sp-d16</span><br><span class="line">armv7e-m/fpu;@mthumb@march=armv7e-m@mfloat-abi=hard@mfpu=fpv4-sp-d16</span><br><span class="line">armv7-ar/thumb/softfp;@mthumb@march=armv7@mfloat-abi=softfp@mfpu=vfpv3-d16</span><br><span class="line">armv7-ar/thumb/fpu;@mthumb@march=armv7@mfloat-abi=hard@mfpu=vfpv3-d16</span><br><span class="line">cortex-m7/softfp/fpv5-sp-d16;@mthumb@mcpu=cortex-m7@mfloat-abi=softfp@mfpu=fpv5-sp-d16</span><br><span class="line">cortex-m7/softfp/fpv5-d16;@mthumb@mcpu=cortex-m7@mfloat-abi=softfp@mfpu=fpv5-d16</span><br><span class="line">cortex-m7/fpu/fpv5-sp-d16;@mthumb@mcpu=cortex-m7@mfloat-abi=hard@mfpu=fpv5-sp-d16</span><br><span class="line">cortex-m7/fpu/fpv5-d16;@mthumb@mcpu=cortex-m7@mfloat-abi=hard@mfpu=fpv5-d16</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸‹é¢é”™è¯¯ï¼Œå¯ä»¥æ‰“å¼€æºç ä½ç½®ï¼Œæ³¨é‡Šæ‰å®ƒ.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arch/arm/src/imxrt/Kconfig:1114: syntax error</span><br><span class="line">arch/arm/src/imxrt/Kconfig:1113: invalid option</span><br><span class="line">make: *** [tools/Makefile.unix:471: olddefconfig] Error 1</span><br><span class="line">ERROR: failed to refresh</span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨BuildRootæ„å»ºæŒ‡äº¤å‰å·¥å…·é“¾"><a href="#ä½¿ç”¨BuildRootæ„å»ºæŒ‡äº¤å‰å·¥å…·é“¾" class="headerlink" title="ä½¿ç”¨BuildRootæ„å»ºæŒ‡äº¤å‰å·¥å…·é“¾"></a>ä½¿ç”¨BuildRootæ„å»ºæŒ‡äº¤å‰å·¥å…·é“¾</h2><ul>
<li><a href="http://reclonelabs.com/building-nuttx-in-ubuntu-from-scratch/" target="_blank" rel="noopener">buildroot nuttx</a></li>
<li>è¿™é‡Œæ˜¯ä½¿ç”¨<code>NuttX</code>æä¾›çš„ä¿®æ”¹åçš„<code>BuildRoot</code>ç‰ˆæœ¬.é€šè¿‡<code>buildroot</code>ç¼–è¯‘å‡ºä¸€ä¸ªç‰¹æ®Šç‰ˆæœ¬çš„äº¤å‰å·¥å…·é“¾ï¼Œå†ç”¨å®ƒå»ç¼–è¯‘å‡ºæœ€ç»ˆçš„<code>nuttx</code>ç³»ç»Ÿé•œåƒ.<code>buildroot</code>çš„æºç ç›®å½•ä¸<code>nuttx,nuttx-apps</code>ä¹Ÿæ˜¯å¹³çº§çš„ç›®å½•.åœ¨å®è·µè¿‡ç¨‹ä¸­å¼€å¯äº†<code>BR2_GCC_CORTEX_M4F_SP</code>å¯¼è‡´ä¸‹é¢çš„<code>DBUG</code>é‡Œå‡ºé”™çš„åŸå› .ä¹Ÿå°±æ˜¯è¯´<code>Atmel SAM4S Xplained Pro</code>æ˜¯<code>cortex-m4</code>å†…æ ¸ï¼Œä½†æ˜¯å®ƒä¸å¸¦<code>FPU</code>ï¼Œå¼ºé€‰<code>FPU</code>è‚¯å®šæ˜¯å‡ºé”™çš„ï¼Œ</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://bitbucket.org/nuttx/buildroot.git buildroot</span><br><span class="line">~$ cp configs/cortexm4f-eabi-defconfig-4.7.4 .config</span><br><span class="line"><span class="comment"># é…ç½®ä¸€ä¸ªåˆé€‚çš„ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯:binutils-2.26.1 ,gcc-4.7.4,gdb-8.0.1ï¼Œå› ä¸ºæ˜¯cortexm4f-eabi-defconfig-4.7.4ï¼Œæ‰€ä»¥è¿™é‡Œé€‰æ‹©gcc-4.7.4</span></span><br><span class="line"><span class="comment"># åœ¨nuttxé…ç½®æ—¶ï¼Œé€‰æ‹© CONFIG_ARMV7M_TOOLCHAIN_BUILDROOT=yï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹å¦‚ä¸Šé¢æ˜¯é€‰æ‹© CONFIG_ARMV7M_TOOLCHAIN_GNU_EABIL=y</span></span><br><span class="line">~$ make menuconfig</span><br><span class="line">~$ make</span><br><span class="line"><span class="comment"># è¿™é‡Œæœ€ç»ˆçš„é…ç½®æ˜¯å¦‚ä¸‹:</span></span><br><span class="line">~$  grep -v <span class="string">'^$\|^#'</span> .config</span><br><span class="line">BR2_HAVE_DOT_CONFIG=y</span><br><span class="line">BR2_arm=y</span><br><span class="line">BR2_cortex_m3=y</span><br><span class="line">BR2_GCC_CORTEX=y</span><br><span class="line">BR2_ARM_EABI=y</span><br><span class="line">BR2_ARCH=<span class="string">"arm"</span></span><br><span class="line">BR2_GCC_TARGET_TUNE=<span class="string">"cortex-m3"</span></span><br><span class="line">BR2_GCC_TARGET_ARCH=<span class="string">"armv7-m"</span></span><br><span class="line">BR2_GCC_TARGET_ABI=<span class="string">"aapcs-linux"</span></span><br><span class="line">BR2_WGET=<span class="string">"wget --passive-ftp"</span></span><br><span class="line">BR2_SVN=<span class="string">"svn co"</span></span><br><span class="line">BR2_ZCAT=<span class="string">"zcat"</span></span><br><span class="line">BR2_BZCAT=<span class="string">"bzcat"</span></span><br><span class="line">BR2_TAR_OPTIONS=<span class="string">""</span></span><br><span class="line">BR2_DL_DIR=<span class="string">"<span class="variable">$(BASE_DIR)</span>/dl"</span></span><br><span class="line">BR2_STAGING_DIR=<span class="string">"<span class="variable">$(BUILD_DIR)</span>/staging_dir"</span></span><br><span class="line">BR2_NUTTX_DIR=<span class="string">"<span class="variable">$(TOPDIR)</span>/../nuttx"</span></span><br><span class="line">BR2_TOPDIR_PREFIX=<span class="string">""</span></span><br><span class="line">BR2_TOPDIR_SUFFIX=<span class="string">""</span></span><br><span class="line">BR2_GNU_BUILD_SUFFIX=<span class="string">"pc-elf"</span></span><br><span class="line">BR2_GNU_TARGET_SUFFIX=<span class="string">"nuttx-eabi"</span></span><br><span class="line">BR2_PREFER_IMA=y</span><br><span class="line">BR2_PACKAGE_BINUTILS=y</span><br><span class="line">BR2_BINUTILS_VERSION_2_26_1=y</span><br><span class="line">BR2_BINUTILS_VERSION=<span class="string">"2.26.1"</span></span><br><span class="line">BR2_EXTRA_BINUTILS_CONFIG_OPTIONS=<span class="string">""</span></span><br><span class="line">BR2_PACKAGE_GCC=y</span><br><span class="line">BR2_GCC_VERSION_4_7_4=y</span><br><span class="line">BR2_GCC_SUPPORTS_SYSROOT=y</span><br><span class="line">BR2_GCC_SUPPORTS_DOWN_PREREQ=y</span><br><span class="line">BR2_GCC_DOWNLOAD_PREREQUISITES=y</span><br><span class="line">BR2_GCC_VERSION=<span class="string">"4.7.4"</span></span><br><span class="line">BR2_EXTRA_GCC_CONFIG_OPTIONS=<span class="string">""</span></span><br><span class="line">BR2_INSTALL_LIBSTDCPP=y</span><br><span class="line">BR2_PACKAGE_GDB_HOST=y</span><br><span class="line">BR2_GDB_VERSION_8_0_1=y</span><br><span class="line">BR2_PACKAGE_GDB_TUI=y</span><br><span class="line">BR2_GDB_VERSION=<span class="string">"8.0.1"</span></span><br><span class="line">BR2_PACKAGE_GENROMFS=y</span><br><span class="line">BR2_PACKAGE_KCONFIG_FRONTENDS=y</span><br><span class="line">BR2_KCONFIG_VERSION_4_11_0_1=y</span><br><span class="line">BR2_KCONFIG_FRONTENDS_VERSION=<span class="string">"4.11.0.1"</span></span><br><span class="line">BR2_LARGEFILE=y</span><br><span class="line">BR2_TARGET_OPTIMIZATION=<span class="string">"-Os -pipe"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘æˆåŠŸåå¯ä»¥ä½¿ç”¨: arm-nutxx-eabi-g++ -print-multi-lib</span></span><br><span class="line">BR2_ENABLE_MULTILIB=y</span><br><span class="line">BR2_LARGEFILE=y</span><br><span class="line">BR2_SOFT_FLOAT=y</span><br><span class="line">BR2_TARGET_OPTIMIZATION=<span class="string">"-Os -pipe"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœæˆåŠŸä¼šç”Ÿæˆå¦‚ä¸‹çš„ç›®å½•.<strong>æ³¨æ„</strong>ï¼Œå¦‚æœå¼€å¯äº†<code>BR2_ENABLE_MULTILIB=y</code>ä¸<code>BR2_SOFT_FLOAT=y</code>ç”Ÿæˆçš„ç›®æ ‡ç›®å½•æ˜¯<code>build_arm_nofpu</code>ï¼Œå¦åˆ™ç”Ÿæˆçš„ç›®å½•å°±æ˜¯<code>build_arm</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~$ tree -L 2 build_arm_hf/</span><br><span class="line">build_arm_hf/</span><br><span class="line">â”œâ”€â”€ root</span><br><span class="line">â””â”€â”€ staging_dir</span><br><span class="line">    â”œâ”€â”€ arm-elf -&gt; arm-nuttx-eabi</span><br><span class="line">    â”œâ”€â”€ arm-nuttx-eabi</span><br><span class="line">    â”œâ”€â”€ bin</span><br><span class="line">    â”œâ”€â”€ include</span><br><span class="line">    â”œâ”€â”€ lib</span><br><span class="line">    â”œâ”€â”€ libexec</span><br><span class="line">    â”œâ”€â”€ share</span><br><span class="line">    â””â”€â”€ usr</span><br><span class="line"></span><br><span class="line">10 directories, 0 files</span><br></pre></td></tr></table></figure>
<ul>
<li>æµ‹è¯•å·¥å…·é“¾</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">export</span> PATH=`<span class="built_in">pwd</span>`/build_arm_hr/staging_dir/bin:<span class="variable">$PATH</span></span><br><span class="line">~$ arm-nuttx-eabi-g++ -<span class="built_in">print</span>-multi-lib</span><br><span class="line">.;</span><br><span class="line">thumb;@mthumb</span><br><span class="line">fpu;@mfloat-abi=hard</span><br></pre></td></tr></table></figure>
<ul>
<li><p>å¦‚æœå‡ºç°ä¸‹é¢çš„é”™è¯¯ï¼Œåœ¨<code>make menuconfig</code>é€‰æ‹©ä¸€ä¸ªé«˜ç‰ˆæœ¬çš„<code>gdb</code>å°è¯•ä¸€ä¸‹.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/fullpath/buildroot/toolchain_build_arm_hf/gdb-7.9.1/gdb/python/python.c: In <span class="keyword">function</span> â€˜_initialize_pythonâ€™:</span><br><span class="line">/fullpath/buildroot/toolchain_build_arm_hf/gdb-7.9.1/gdb/python/python.c:1690:3: error: too few arguments to <span class="keyword">function</span> â€˜_PyImport_FixupBuiltinâ€™</span><br><span class="line">   _PyImport_FixupBuiltin (gdb_module, <span class="string">"_gdb"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœå‡ºç°<code>gcc</code>ç¼–è¯‘æ—¶æ— æ³•ä¸‹è½½<code>mpc,mpfr,gmp</code>çš„ä¾èµ–åŒ…æ—¶ï¼ŒæŸ¥çœ‹ä¸€ä¸‹<code>toolchain_build_arm_hf/gcc-4.9.4/contrib/download_prerequisites</code>.ä¿®æ”¹ç‰ˆæœ¬å·ï¼Œæˆ–è€…ä¸‹è½½çš„åœ°å€.</p>
</li>
</ul>
<h3 id="gcc-4-7-4çš„è¡¥ä¸"><a href="#gcc-4-7-4çš„è¡¥ä¸" class="headerlink" title="gcc-4.7.4çš„è¡¥ä¸"></a>gcc-4.7.4çš„è¡¥ä¸</h3><ul>
<li>åœ¨æ„å»ºäº¤ã•šå·¥å…·é“¾æ—¶å¦‚æœå‡ºç°ä¸‹é¢çš„é”™è¯¯</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In file included from .../gcc-4.7.4/gcc/cp/except.c:990:0:</span><br><span class="line">cfns.gperf: At top level:</span><br><span class="line">cfns.gperf:101:1: error: <span class="string">'gnu_inline'</span> attribute present on <span class="string">'libc_name_p'</span></span><br><span class="line">cfns.gperf:26:14: error: but not here</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿™é‡Œå¼•ç”¨äº†<a href="https://patchwork.ozlabs.org/project/gcc/patch/1438919226-30427-1-git-send-email-vapier@gentoo.org/" target="_blank" rel="noopener">cfns: fix mismatch in gnu_inline attributes</a>çš„è¡¥ä¸.ç›´æ¥åˆ›å»ºåœ¨<code>BuildRoot</code>çš„æºç é‡Œ.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">~$ cat &gt; toolchain/gcc/4.7.4/gnu_inline.patch &lt;&lt;EOF</span><br><span class="line">diff --git a/gcc/cp/cfns.gperf b/gcc/cp/cfns.gperf</span><br><span class="line">index 68acd3d..953262f 100644</span><br><span class="line">--- a/gcc/cp/cfns.gperf</span><br><span class="line">+++ b/gcc/cp/cfns.gperf</span><br><span class="line">@@ -22,6 +22,9 @@  __inline</span><br><span class="line"> static unsigned int <span class="built_in">hash</span> (const char *, unsigned int);</span><br><span class="line"> <span class="comment">#ifdef __GNUC__</span></span><br><span class="line"> __inline</span><br><span class="line">+<span class="comment">#ifdef __GNUC_STDC_INLINE__</span></span><br><span class="line">+__attribute__ ((__gnu_inline__))</span><br><span class="line">+<span class="comment">#endif</span></span><br><span class="line"> <span class="comment">#endif</span></span><br><span class="line"> const char * libc_name_p (const char *, unsigned int);</span><br><span class="line"> %&#125;</span><br><span class="line">diff --git a/gcc/cp/cfns.h b/gcc/cp/cfns.h</span><br><span class="line">index 1c6665d..6d00c0e 100644</span><br><span class="line">--- a/gcc/cp/cfns.h</span><br><span class="line">+++ b/gcc/cp/cfns.h</span><br><span class="line">@@ -53,6 +53,9 @@  __inline</span><br><span class="line"> static unsigned int <span class="built_in">hash</span> (const char *, unsigned int);</span><br><span class="line"> <span class="comment">#ifdef __GNUC__</span></span><br><span class="line"> __inline</span><br><span class="line">+<span class="comment">#ifdef __GNUC_STDC_INLINE__</span></span><br><span class="line">+__attribute__ ((__gnu_inline__))</span><br><span class="line">+<span class="comment">#endif</span></span><br><span class="line"> <span class="comment">#endif</span></span><br><span class="line"> const char * libc_name_p (const char *, unsigned int);</span><br><span class="line"> /* maximum key range = 391, duplicates = 0 */</span><br><span class="line"> EOF</span><br></pre></td></tr></table></figure>
<h3 id="GCC-4-7-4çš„ç¼–è¯‘é”™è¯¯"><a href="#GCC-4-7-4çš„ç¼–è¯‘é”™è¯¯" class="headerlink" title="GCC-4.7.4çš„ç¼–è¯‘é”™è¯¯"></a>GCC-4.7.4çš„ç¼–è¯‘é”™è¯¯</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">make[4]: Entering directory <span class="string">'/fullpath/buildroot/toolchain_build_arm_nofpu/gcc-4.7.4-build/libiberty/testsuite'</span></span><br><span class="line">make[4]: Nothing to be <span class="keyword">done</span> <span class="keyword">for</span> <span class="string">'install'</span>.</span><br><span class="line">make[4]: Leaving directory <span class="string">'/fullpath/buildroot/toolchain_build_arm_nofpu/gcc-4.7.4-build/libiberty/testsuite'</span></span><br><span class="line">make[3]: Leaving directory <span class="string">'/fullpath/buildroot/toolchain_build_arm_nofpu/gcc-4.7.4-build/libiberty'</span></span><br><span class="line">/bin/bash: line 3: <span class="built_in">cd</span>: arm-nuttx-eabi/libgcc: No such file or directory</span><br><span class="line">make[2]: *** [Makefile:10334: install-target-libgcc] Error 1</span><br><span class="line">make[2]: Leaving directory <span class="string">'/fullpath/buildroot/toolchain_build_arm_nofpu/gcc-4.7.4-build'</span></span><br><span class="line">make[1]: *** [Makefile:2115: install] Error 2</span><br><span class="line">make[1]: Leaving directory <span class="string">'/fullpath/buildroot/toolchain_build_arm_nofpu/gcc-4.7.4-build'</span></span><br><span class="line">make: *** [toolchain/gcc/gcc-nuttx-4.x.mk:159: /fullpath/buildroot/toolchain_build_arm_nofpu/gcc-4.7.4-build/.installed] Error 2</span><br></pre></td></tr></table></figure>
<ul>
<li>ç¼–è¯‘æ—¶å‡ºç°ä¸Šé¢çš„é”™è¯¯ï¼Œè¿™å¥½åƒæ˜¯è¿™ä¸ªGCCç‰ˆæœ¬çš„é—®é¢˜ï¼Œåœ¨<code>4.9.x</code>å¥½åƒæ²¡æœ‰å‡ºè¿™æ ·çš„é”™è¯¯ï¼ŒåŒæ˜¯æŸ¥çœ‹äº†å„çº§çš„<code>config.log</code>ä¸å„çº§çš„<code>Makefile</code>ä¹Ÿæ²¡æœ‰æ‰¾å‡ºé—®é¢˜ï¼Œåæ¥åªæœ‰è¿›å…¥åˆ°ç¼–è¯‘çš„ç›®å½•å†…<code>toolchain_build_arm/gcc-4.7.4-build</code>å†…ç›´æ¥è¿è¡Œ<code>make</code>,æ— é”™çš„è¯å†å›åˆ°<code>buildroot</code>å†…ï¼Œå†è¿è¡Œ<code>make</code>è¿™é‡Œå°±æ­£å¸¸å®Œæˆäº†.</li>
</ul>
<h2 id="é…ç½®NuttXç³»ç»Ÿ"><a href="#é…ç½®NuttXç³»ç»Ÿ" class="headerlink" title="é…ç½®NuttXç³»ç»Ÿ"></a>é…ç½®<code>NuttX</code>ç³»ç»Ÿ</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ tools/configure.sh -l  sam4s-xplained-pro:nsh</span><br><span class="line">~$ cp  boards/arm/sam34/sam4s-xplained-pro/configs/nsh/defconfig .config</span><br><span class="line">~$ cp boards/arm/sam34/sam4s-xplained-pro/scripts/Make.defs .</span><br><span class="line">~$ make menuconfig</span><br><span class="line">~$ make</span><br><span class="line">[...]</span><br><span class="line">LD: nuttx</span><br><span class="line">make[1]: Leaving directory <span class="string">'/fullpath/nuttx/arch/arm/src'</span></span><br><span class="line">CP: nuttx.hex</span><br><span class="line">CP: nuttx.bin</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Nuttx</code>çš„æœ€ç»ˆé…ç½®å¦‚ä¸‹:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ grep -v <span class="string">'^$\|^#'</span> .config</span><br></pre></td></tr></table></figure>
<ul>
<li>ç¼–è¯‘æ—¶å‡ºç°ä¸‹é¢é”™è¯¯ï¼Œè¿™ä¸ªæœ‰å¯èƒ½æ˜¯é…ç½®æ—¶æ²¡æœ‰é€‰æ‹©<code>CONFIG_ARCH_IRQPRIO=y</code>ï¼Œç„¶åå°±å»<code>make</code>åçš„ç»“æœ.é€šè¿‡æœç´¢<code>nuttx</code>æºç æ—¶å‘ç°ï¼Œ<code>getcontrol(void)</code>æ˜¯å®šä¹‰åœ¨<code>arch/arm/include/armv7-m/irq.h</code>é‡Œçš„å†…è”å‡½æ•°.æœ€ç»ˆåœ¨<code>arch/arm/src/chip/sam_start.c</code>å‰é¢ï¼Œæ·»åŠ <code>#include &lt;nuttx/irq.h&gt;</code>å°±å¯ä»¥äº†.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/fullpath/nuttx/staging/libarch.a(sam_start.o): In <span class="keyword">function</span> `sam_fpuconfig<span class="string">':</span></span><br><span class="line"><span class="string">/fullpath/nuttx/arch/arm/src/chip/sam_start.c:159: undefined reference to `getcontrol`</span></span><br><span class="line"><span class="string">/fullpath/nuttx/arch/arm/src/chip/sam_start.c:161: undefined reference to `setcontrol`</span></span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨OpenOCDè°ƒè¯•"><a href="#ä½¿ç”¨OpenOCDè°ƒè¯•" class="headerlink" title="ä½¿ç”¨OpenOCDè°ƒè¯•"></a>ä½¿ç”¨OpenOCDè°ƒè¯•</h2><ul>
<li><a href="https://docs.lvgl.io/v7/en/html/get-started/nuttx.html" target="_blank" rel="noopener">NuttX RTOS</a></li>
<li><a href="https://nuttx.apache.org/docs/latest/quickstart/debugging.html" target="_blank" rel="noopener">Debugging Nuttx</a></li>
</ul>
<h3 id="ç¼–è¯‘OpenOCD"><a href="#ç¼–è¯‘OpenOCD" class="headerlink" title="ç¼–è¯‘OpenOCD"></a>ç¼–è¯‘OpenOCD</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> http://repo.or.cz/r/openocd.git</span><br><span class="line">~$ <span class="built_in">cd</span> openocd &amp;&amp; mkdir build-linux &amp;&amp; <span class="built_in">cd</span> build-linux</span><br><span class="line">~$ ../configure --<span class="built_in">enable</span>-ftdi --<span class="built_in">enable</span>-stlink --<span class="built_in">enable</span>-ti-icdi --<span class="built_in">enable</span>-ulink --<span class="built_in">enable</span>-usb-blaster-2 --<span class="built_in">enable</span>-ft232r --<span class="built_in">enable</span>-xds110  --<span class="built_in">enable</span>-usbprog --<span class="built_in">enable</span>-armjtagew --<span class="built_in">enable</span>-cmsis-dap --<span class="built_in">enable</span>-usb-blaster  --<span class="built_in">enable</span>-openjtag --<span class="built_in">enable</span>-jlink --<span class="built_in">enable</span>-bcm2835gpio --<span class="built_in">enable</span>-imx_gpio --<span class="built_in">enable</span>-oocd_trace --<span class="built_in">enable</span>-buspirate --<span class="built_in">enable</span>-sysfsgpio</span><br><span class="line">~$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<ul>
<li><p>æ ¹æ®<code>Nuttx</code>å®˜æ–¹çš„<a href="https://nuttx.apache.org/docs/latest/quickstart/debugging.html" target="_blank" rel="noopener">Debugging Nuttx</a>æç¤ºï¼ŒåŸºäºæŸäº›ç‰¹æ€§è°ƒè¯•ï¼Œå¯èƒ½éœ€è¦ä¿®æ”¹ç›¸åº”çš„<code>openocd/src/rtos/nuttx_header.h</code>å†…çš„å®å®šä¹‰å¦‚:<code>CONFIG_DISABLE_MQUEUE=y</code>.</p>
</li>
<li><p>è¿è¡Œ<code>OpenOCD</code>æœåŠ¡,é€šè¿‡PCç«¯çš„USBè¿æ¥åˆ°<code>Atmel-SAM4S_Xpained-Pro</code>ä¸Šå†™æœ‰<code>DEBUG USB</code>çš„æ¥å£ä¸Š,<strong>æ³¨æ„</strong>ï¼Œè¯¥USBæ¥å£æ˜¯æ¿ä¸Šè°ƒè¯•å™¨(EDBG)çš„ç»„åˆæ¥å£ï¼Œå®ƒåŒ…å«ä¸‰ä¸ªæ¥å£åŠŸèƒ½:DEBUG,Virtual COM Port, Data Gateway Interface(DGI).</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œå¦‚æœå®šä¹‰æ¿çº§é…ç½®ä¹Ÿå¯ç›´æ¥: openocd -f board/atmel_sam4s_xplained_pro.cfg -c init -c "reset halt"</span></span><br><span class="line">~$ openocd -f interface/cmsis-dap.cfg -f target/at91sam4sd32x.cfg -c init -c <span class="string">"reset halt"</span></span><br><span class="line">Open On-Chip Debugger 0.10.0+dev-01408-g762ddcb74-dirty (2020-09-25-00:32)</span><br><span class="line">Licensed under GNU GPL v2</span><br><span class="line">For bug reports, <span class="built_in">read</span></span><br><span class="line">	http://openocd.org/doc/doxygen/bugs.html</span><br><span class="line">Info : auto-selecting first available session transport <span class="string">"swd"</span>. To override use <span class="string">'transport select &lt;transport&gt;'</span>.</span><br><span class="line">Info : CMSIS-DAP: SWD  Supported</span><br><span class="line">Info : CMSIS-DAP: JTAG Supported</span><br><span class="line">Info : CMSIS-DAP: FW Version = 1.0</span><br><span class="line">Info : CMSIS-DAP: Serial<span class="comment"># = ATML1803040200001055</span></span><br><span class="line">Info : CMSIS-DAP: Interface Initialised (SWD)</span><br><span class="line">Info : SWCLK/TCK = 1 SWDIO/TMS = 1 TDI = 1 TDO = 1 nTRST = 0 nRESET = 1</span><br><span class="line">Info : CMSIS-DAP: Interface ready</span><br><span class="line">Info : clock speed 500 kHz</span><br><span class="line">Info : SWD DPIDR 0x2ba01477</span><br><span class="line">Info : sam4.cpu: hardware has 6 breakpoints, 4 watchpoints</span><br><span class="line">Info : starting gdb server <span class="keyword">for</span> sam4.cpu on 3333</span><br><span class="line">Info : Listening on port 3333 <span class="keyword">for</span> gdb connections</span><br><span class="line">target halted due to debug-request, current mode: Thread</span><br><span class="line">xPSR: 0x01000000 pc: 0x00400554 msp: 0x200034d0</span><br><span class="line">Info : Listening on port 6666 <span class="keyword">for</span> tcl connections</span><br><span class="line">Info : Listening on port 4444 <span class="keyword">for</span> telnet connections</span><br><span class="line">Info : accepting <span class="string">'telnet'</span> connection on tcp/4444</span><br><span class="line">Info : dropped <span class="string">'telnet'</span> connection</span><br><span class="line">Info : accepting <span class="string">'telnet'</span> connection on tcp/4444</span><br><span class="line">Info : dropped <span class="string">'telnet'</span> connection</span><br><span class="line">Info : accepting <span class="string">'gdb'</span> connection on tcp/3333</span><br><span class="line">target halted due to debug-request, current mode: Thread</span><br><span class="line">xPSR: 0x01000000 pc: 0x00400554 msp: 0x200034d0</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨GDBæ¡¥æ¥åˆ°<code>OpenOCD</code>æœåŠ¡ä¸Šå»è°ƒè¯•.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">~$ arm-nuttx-eabi-gdb nuttx</span><br><span class="line">GNU gdb (GDB) 8.0.1</span><br><span class="line">Copyright (C) 2017 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type <span class="string">"show copying"</span></span><br><span class="line">and <span class="string">"show warranty"</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">"--host=x86_64-pc-elf --target=arm-nuttx-eabi"</span>.</span><br><span class="line">Type <span class="string">"show configuration"</span> <span class="keyword">for</span> configuration details.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class="line">Find the GDB manual and other documentation resources online at:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span><br><span class="line">For <span class="built_in">help</span>, <span class="built_in">type</span> <span class="string">"help"</span>.</span><br><span class="line">Type <span class="string">"apropos word"</span> to search <span class="keyword">for</span> commands related to <span class="string">"word"</span>...</span><br><span class="line">Reading symbols from nuttx...done.</span><br><span class="line">(gdb) target extended-remote :3333</span><br><span class="line">0x00400554 <span class="keyword">in</span> arm_earlyserialinit () at chip/sam_serial.c:1345</span><br><span class="line">1345	  up_disableallints(TTYS1_DEV.priv, NULL);</span><br><span class="line">(gdb) load   <span class="comment"># åŠ è½½åˆ°æ¿å­ä¸Šå»,ä¹Ÿå°±çƒ§å†™å…¥æ¿å­.</span></span><br><span class="line"><span class="comment"># OpenOCDçš„ç»ˆç«¯ä¸Šä¹Ÿæœ‰ç›¸åº”çš„ä¿¡æ¯è¾“å‡º.</span></span><br><span class="line">Loading section .text, size 0x19003 lma 0x400000</span><br><span class="line">Loading section .ARM.extab, size 0x30 lma 0x419004</span><br><span class="line">Loading section .ARM.exidx, size 0xd0 lma 0x419034</span><br><span class="line">Loading section .data, size 0x220 lma 0x419104</span><br><span class="line">Start address 0x4000cc, load size 103203</span><br><span class="line">Transfer rate: 18 KB/sec, 10320 bytes/write.</span><br><span class="line">(gdb) cont  <span class="comment">#ç»§ç»­è¿è¡Œï¼Œè¿™é‡Œå‡ºç°å¼‚å¸¸äº†ï¼Œè¿™äººé”™è¯¯çš„ç¤ºä¾‹ï¼Œæ˜¯å› ä¸ºå·¥å…·é“¾é€‰æ‹©äº†`BR2_GCC_CORTEX_M4F_SP=y`,ä¸ç›®æ ‡æ¿å­ä¸åŒ¹é…ï¼ŒSAM4S-XPROå®ƒæ˜¯Cortex-m4ä½†æ˜¯å®ƒæ²¡æœ‰FPU.</span></span><br><span class="line">Continuing.</span><br><span class="line">sam4.cpu -- clearing lockup after double fault</span><br><span class="line"></span><br><span class="line">Program received signal SIGINT, Interrupt.</span><br><span class="line">exception_common () at armv7-m/gnu/arm_exception.S:176</span><br><span class="line">176		vstmdb	sp!, &#123;s16-s31&#125;			/* Save the non-volatile FP context */</span><br><span class="line">(gdb) i r  <span class="comment"># è¯¦ç»†GDBçš„æŒ‡ä»¤ï¼Œå‚è€ƒè¯¥ç‰ˆæœ¬çš„è¯´æ˜æ–‡æ¡£,æœ€æƒå¨ï¼Œæœ€è¯¦ç»†.</span></span><br><span class="line">r0             0x3	3</span><br><span class="line">r1             0x1	1</span><br><span class="line">r2             0x20001e78	536878712</span><br><span class="line">[....]</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ä¹Ÿå¯ä»¥æŠŠå‡ ä¸ªå‚æ•°åˆåœ¨ä¸€è¡Œå‘½ä»¤ä¸‹æäº¤ï¼Œå¦‚<code>arm-nuttx-eabi-gdb -ex &quot;target remote :3333&quot; -ex &quot;mon reset halt&quot;  nuttx</code></p>
</li>
<li><p>å…³äºç±»ä¼¼<code>ATSAM4SD32C.cpu -- clearing lockup after double fault</code>,å‚è€ƒäº†<a href="https://electronics.stackexchange.com/questions/30688/clearing-lockup-after-double-fault" target="_blank" rel="noopener">stackexchange</a>å¤„ç†.</p>
</li>
<li><p>æŸ¥çœ‹ç›®æ ‡æ–‡ä»¶çš„å†…å®¹.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ file nuttx</span><br><span class="line">nuttx: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), statically linked, with debug_info, not stripped</span><br><span class="line">~$ file nuttx.bin</span><br><span class="line">nuttx.bin: data</span><br><span class="line">~$ file nuttx.hex</span><br><span class="line">nuttx.hex: ASCII text, with CRLF line terminators</span><br></pre></td></tr></table></figure>
<h2 id="GDBè°ƒè¯•"><a href="#GDBè°ƒè¯•" class="headerlink" title="GDBè°ƒè¯•"></a>GDBè°ƒè¯•</h2><ul>
<li><a href="https://darkdust.net/files/GDB%20Cheat%20Sheet.pdf" target="_blank" rel="noopener">GDB Cheat Sheet.pdf</a></li>
<li><a href="https://sourceware.org/gdb/current/onlinedocs/gdb/" target="_blank" rel="noopener">Debugging with GDB</a></li>
</ul>
<h3 id="OpenOCDæœåŠ¡"><a href="#OpenOCDæœåŠ¡" class="headerlink" title="OpenOCDæœåŠ¡"></a><code>OpenOCD</code>æœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ~$ openocd -f board/atmel_sam4s_xplained_pro.cfg -c init -c 'reset halt' -c '$_TARGETNAME configure -rtos nuttx'</span></span><br><span class="line">~$ openocd -f board/atmel_sam4s_xplained_pro.cfg -c <span class="string">'$_TARGETNAME configure -rtos nuttx'</span></span><br></pre></td></tr></table></figure>
<h3 id="GDBè¿æ¥"><a href="#GDBè¿æ¥" class="headerlink" title="GDBè¿æ¥"></a>GDBè¿æ¥</h3><ul>
<li>åœ¨<code>nuttx</code>çš„ç›®å½•ä¸‹è¿è¡Œï¼Œä¸ºäº†åŠ è½½<code>nuttx</code>æ–‡ä»¶.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~ nuttx$ arm-none-eabi-gdb -ex <span class="string">"target remote :3333"</span> -ex <span class="string">"mon reset halt"</span>  nuttx</span><br></pre></td></tr></table></figure>
<ul>
<li>å®šä¹‰ä¸€äº›<code>gdb hook</code>å‡½æ•°ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿ä¸€äº›è°ƒè¯•,æœ€å¥½çš„æ–¹å¼æ˜¯æŠŠè¿™äº›<code>define</code>æ”¾åœ¨<code>~/.gdbinit</code>å†…, ä½†æ˜¯è¦æ³¨æ„ï¼Œä½ å¦‚æœåœ¨ç”¨ç³»ç»Ÿ<code>gdb</code>å»è°ƒé<code>nuttx</code>çš„ç¨‹åºæ—¶ï¼Œ<br>è®°å¾—è¦åˆ äº†<code>~/.gdbinit</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(gdb) define hookpost-file</span><br><span class="line">Type commands <span class="keyword">for</span> definition of <span class="string">"hookpost-file"</span>.</span><br><span class="line">End with a line saying just <span class="string">"end"</span>.</span><br><span class="line">&gt;  <span class="built_in">eval</span> <span class="string">"monitor nuttx.pid_offset %d"</span>, &amp;((struct tcb_s *)(0))-&gt;pid</span><br><span class="line">&gt;  <span class="built_in">eval</span> <span class="string">"monitor nuttx.xcpreg_offset %d"</span>, &amp;((struct tcb_s *)(0))-&gt;xcp.regs</span><br><span class="line">&gt;  <span class="built_in">eval</span> <span class="string">"monitor nuttx.state_offset %d"</span>, &amp;((struct tcb_s *)(0))-&gt;task_state</span><br><span class="line">&gt;  <span class="built_in">eval</span> <span class="string">"monitor nuttx.name_offset %d"</span>, &amp;((struct tcb_s *)(0))-&gt;name</span><br><span class="line">&gt;  <span class="built_in">eval</span> <span class="string">"monitor nuttx.name_size %d"</span>, sizeof(((struct tcb_s *)(0))-&gt;name)</span><br><span class="line">&gt;end</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿æ¥è¿œç¨‹<code>openocd</code>çš„ç«¯å£</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) target extended-remote :3333</span><br><span class="line">Remote debugging using :3333</span><br><span class="line">__start () at chip/sam_start.c:269</span><br><span class="line">269	&#123;</span><br><span class="line">(gdb) file nuttx</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸Šçº¿çš„<code>file nuttx</code>æ˜¯åŠ è½½æ–‡ä»¶çš„<code>symbols</code>ï¼Œå› ä¸ºå®šä¹‰äº†<code>hook-file</code>,æ‰€ä»¥ä¼šåœ¨<code>openocd</code>å†…æ˜¾ç¤ºï¼Œå¦‚:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Error: No symbols <span class="keyword">for</span> NuttX  <span class="comment"># æœ‰å¯èƒ½ä¼šæ˜¾ç¤ºï¼Œå¦‚æœæ¯æ¬¡éƒ½æ˜¾ç¤ºï¼Œæ˜¯å› ä¸ºæ²¡æœ‰æ‰“å¼€`CONFIG_DEBUG_SYMBOLS`</span></span><br><span class="line">Info : pid_offset: 12</span><br><span class="line">Info : xcpreg_offset: 132</span><br><span class="line">Info : state_offset: 26</span><br><span class="line">Info : name_offset: 208</span><br><span class="line">Info : name_size: 16</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥çœ‹è°ƒè¯•çº¿ç¨‹ä¿¡æ¯.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info threads</span><br><span class="line">warning: <span class="keyword">while</span> parsing threads: not well-formed (invalid token)</span><br><span class="line">  Id   Target Id         Frame</span><br><span class="line">* 1    Remote target     __start () at chip/sam_start.c:269</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥çœ‹å¯„å­˜å™¨çš„ä¿¡æ¯</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info registers</span><br><span class="line">r0             0x0	0</span><br><span class="line">r1             0x20004360	536888160</span><br><span class="line">r2             0x20004360	536888160</span><br><span class="line">r3             0x1	1</span><br><span class="line">r4             0xc	12</span><br><span class="line">r5             0x200010cc	536875212</span><br><span class="line">r6             0x200010cc	536875212</span><br><span class="line">r7             0x3	3</span><br><span class="line">r8             0x0	0</span><br><span class="line">r9             0x0	0</span><br><span class="line">r10            0x0	0</span><br><span class="line">r11            0x0	0</span><br><span class="line">r12            0x20004290	536887952</span><br><span class="line">sp             0x20004340	0x20004340</span><br><span class="line">lr             0x8012621	134293025</span><br><span class="line">pc             0x8003b4c	0x8003b4c &lt;memcpy+20&gt;</span><br><span class="line">xPSR           0x61000000	1627389952</span><br></pre></td></tr></table></figure>
<h3 id="è®¾ç½®æ–­ç‚¹"><a href="#è®¾ç½®æ–­ç‚¹" class="headerlink" title="è®¾ç½®æ–­ç‚¹"></a>è®¾ç½®æ–­ç‚¹</h3><ul>
<li><p><a href="https://sourceware.org/gdb/current/onlinedocs/gdb/Breakpoints.html#Breakpoints" target="_blank" rel="noopener">Breakpoints</a></p>
</li>
<li><p>ä¸‹é¢è®¾ç½®çš„æ–­ç‚¹æ˜¯åœ¨æ–‡ä»¶çš„æŸè¡Œä¸Šé¢ï¼Œä¸ºé˜²æ­¢è°ƒè¯•æ—¶ç¨‹åºè·‘é£ï¼Œç¡¬ä»¶é‡å¯ååˆéœ€è¦é‡æ–°è®¾ç½®æ–­ç‚¹ï¼Œè¿™é‡Œä¿å­˜æ–­ç‚¹åˆ°<code>bp.txt</code>æ–‡ä»¶ä¸Šï¼Œä¸‹æ¬¡å¯ä»¥ä½¿ç”¨<code>source bp.txt</code>åŠ è½½.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b chip/sam_hsmci.c:757</span><br><span class="line">Breakpoint 1 at 0x417cf8: file chip/sam_hsmci.c, line 757.</span><br><span class="line">(gdb) b mmcsd/mmcsd_sdio.c:2780</span><br><span class="line">Breakpoint 2 at 0x415fc4: file mmcsd/mmcsd_sdio.c, line 2780.</span><br><span class="line">(gdb) save breakpoints bp.txt</span><br><span class="line">Saved to file <span class="string">'bp.txt'</span>.</span><br><span class="line">(gdb) rbreak bp.txt</span><br><span class="line">(gdb) info b</span><br><span class="line">Num     Type           Disp Enb Address    What</span><br><span class="line">1       breakpoint     keep y   0x00417cf8 <span class="keyword">in</span> sam_clock at chip/sam_hsmci.c:757</span><br><span class="line">2       breakpoint     keep y   0x00415fc4 <span class="keyword">in</span> mmcsd_probe at mmcsd/mmcsd_sdio.c:2780</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥çœ‹è°ƒç”¨æ ˆï¼Œæœ‰æ—¶è°ƒè¯•æ¿å­ï¼Œåœ¨æ¿å­åˆå§‹ç¡¬ä»¶æ—¶ï¼Œä¸²å£æ‰“å°è¿˜æ²¡æœ‰å°±ç»ªæ—¶ï¼Œæ­¤æ—¶ç”¨<code>backtrace</code>æŸ¥çœ‹è°ƒç”¨æ ˆå¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚:æ™¶æŒ¯ä¸èµ·æŒ¯.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(gdb) backtrace</span><br><span class="line"><span class="comment">#0  sam_clock (dev=0x2000016c &lt;g_sdiodev&gt;, rate=CLOCK_SD_TRANSFER_1BIT)</span></span><br><span class="line">    at chip/sam_hsmci.c:1580</span><br><span class="line"><span class="comment">#1  0x00415e56 in mmcsd_sdinitialize (priv=0x200043b0) at mmcsd/mmcsd_sdio.c:3023</span></span><br><span class="line"><span class="comment">#2  mmcsd_probe (priv=priv@entry=0x200043b0) at mmcsd/mmcsd_sdio.c:3465</span></span><br><span class="line"><span class="comment">#3  0x004162d2 in mmcsd_mediachange (arg=0x200043b0) at mmcsd/mmcsd_sdio.c:2545</span></span><br><span class="line"><span class="comment">#4  0x004185f2 in sdio_mediachange (dev=0x2000016c &lt;g_sdiodev&gt;, cardinslot=&lt;optimized out&gt;)</span></span><br><span class="line">    at chip/sam_hsmci.c:2799</span><br><span class="line"><span class="comment">#5  0x004148e4 in sam_hsmci_initialize () at sam_hsmci.c:180</span></span><br><span class="line"><span class="comment">#6  0x0041478a in board_app_initialize (arg=arg@entry=0) at sam_appinit.c:129</span></span><br><span class="line"><span class="comment">#7  0x004120fa in boardctl (cmd=cmd@entry=65281, arg=arg@entry=0) at boardctl.c:326</span></span><br><span class="line"><span class="comment">#8  0x00405cfa in nsh_initialize () at nsh_init.c:103</span></span><br><span class="line"><span class="comment">#9  0x00405ccc in nsh_main (argc=1, argv=0x200059c8) at nsh_main.c:143</span></span><br><span class="line"><span class="comment">#10 0x00403858 in nxtask_startup (entrypt=0x405ca9 &lt;nsh_main&gt;, argc=1, argv=0x200059c8)</span></span><br><span class="line">    at <span class="built_in">sched</span>/task_startup.c:165</span><br><span class="line"><span class="comment">#11 0x00401320 in nxtask_start () at task/task_start.c:144</span></span><br><span class="line"><span class="comment">#12 0x00000000 in ?? ()</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å•æ­¥(s = Step into, n = Step over),å•æ­¥æ­¥å…¥(Step Into)æœ‰æ—¶ä¼šè¿›å…¥å¾ˆæ·±çš„è°ƒç”¨æ ˆï¼Œå¦‚æœè¦é€€å›å¯ä»¥ä½¿ç”¨<code>finish</code>æŒ‡ä»¤è·³å‡º.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(gdb) step</span><br><span class="line">100	      ret = nxsig_nanosleep(&amp;rqtp, &amp;rmtp);</span><br><span class="line">(gdb) stepi</span><br><span class="line">nxsig_nanosleep (rqtp=rqtp@entry=0x20004330, rmtp=rmtp@entry=0x20004338) at signal/sig_nanosleep.c:108</span><br><span class="line">108	&#123;</span><br><span class="line">(gdb) n</span><br><span class="line">116	  <span class="keyword">if</span> (rqtp == NULL || rqtp-&gt;tv_nsec &lt; 0 || rqtp-&gt;tv_nsec &gt;= 1000000000)</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥çœ‹å˜é‡</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">btle_main (argc=&lt;error reading variable: value has been optimized out&gt;, argv=&lt;error reading variable: value has been optimized out&gt;) at nrf24l01_btle.c:372</span><br><span class="line">372	      memcpy(chunk(buffer,pls)-&gt;data,&amp;hum,2);</span><br><span class="line">(gdb) p hum</span><br><span class="line"><span class="variable">$5</span> = 1844</span><br><span class="line">(gdb) p temp</span><br><span class="line"><span class="variable">$6</span> = 3139</span><br><span class="line">(gdb) p buffer.playload</span><br><span class="line">There is no member named playload.</span><br><span class="line">(gdb) x buffer.payload</span><br><span class="line">0x200010d4 &lt;buffer+8&gt;:	0x06000102</span><br><span class="line">(gdb) x/32b buffer.payload</span><br><span class="line">0x200010d4 &lt;buffer+8&gt;:	2	1	0	6	9	0	0	0</span><br><span class="line">0x200010dc &lt;buffer+16&gt;:	0	0	7	22	0	0	0	0</span><br><span class="line">0x200010e4 &lt;buffer+24&gt;:	0	0	40	7	-56	0	0	0</span><br><span class="line">0x200010ec &lt;current&gt;:	0	0	0	0	0	0	0	0</span><br><span class="line">(gdb) x/32x buffer.payload     <span class="comment"># hexæ ¼å¼æ•°ç»„.</span></span><br><span class="line">0x200010d4 &lt;buffer+8&gt;:	0x02	0x01	0x00	0x06	0x09	0x00	0x00	0x00</span><br><span class="line">0x200010dc &lt;buffer+16&gt;:	0x00	0x00	0x07	0x16	0x00	0x00	0x00	0x00</span><br><span class="line">0x200010e4 &lt;buffer+24&gt;:	0x00	0x00	0x28	0x07	0xc8	0x00	0x00	0x00</span><br><span class="line">0x200010ec &lt;current&gt;:	0x00	0x00	0x00	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">(gdb) <span class="built_in">print</span> /x buffer.payload  <span class="comment"># ä½¿ç”¨æ‰“å°æŸ¥çœ‹æ•°ç»„.</span></span><br><span class="line"><span class="variable">$2</span> = &#123;0x2, 0x1, 0x0, 0x6, 0x9, 0x0, 0x0, 0x0, 0x0, 0x0, 0x7, 0x16, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x28, 0x7, 0xc8, 0x0, 0x0, 0x0&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>hexdump æŸ¥çœ‹åœ°å€ï¼Œæ•°ç»„</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x /32bx data</span><br><span class="line">0x20004374:	0x44	0x12	0x00	0x20	0x20	0x00	0x00	0x00</span><br><span class="line">0x2000437c:	0x95	0x3a	0x01	0x08	0x44	0x12	0x00	0x20</span><br><span class="line">0x20004384:	0x03	0x00	0x00	0x00	0x04	0x00	0x00	0x00</span><br><span class="line">0x2000438c:	0x07	0x5d	0x01	0x08	0x10	0x00	0x00	0x00</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥çœ‹ç»“æ„ä½“çš„å†…å®¹</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">set</span> <span class="built_in">print</span> pretty on</span><br><span class="line">(gdb) p dev</span><br><span class="line"><span class="variable">$4</span> = (struct nrf24l01_dev_s *) 0x20003370</span><br><span class="line">(gdb) p *dev</span><br><span class="line"><span class="variable">$5</span> = &#123;</span><br><span class="line">  spi = 0x20000174 &lt;g_spi2dev&gt;,</span><br><span class="line">  config = 0x20000140 &lt;nrf_cfg&gt;,</span><br><span class="line">  state = ST_STANDBY,</span><br><span class="line">  tx_payload_noack = 0 <span class="string">'\000'</span>,</span><br><span class="line">  en_aa = 63 <span class="string">'?'</span>,</span><br><span class="line">  en_pipes = 1 <span class="string">'\001'</span>,</span><br><span class="line">  ce_enabled = 0 <span class="string">'\000'</span>,</span><br><span class="line">  lastxmitcount = 0 <span class="string">'\000'</span>,</span><br><span class="line">  addrlen = 5 <span class="string">'\005'</span>,</span><br><span class="line">  pipedatalen = <span class="string">"!\000\000\000\000"</span>,</span><br><span class="line">  pipe0addr = <span class="string">"\001\312\376\022\064"</span>,</span><br><span class="line">  last_recvpipeno = 0 <span class="string">'\000'</span>,</span><br><span class="line">  sem_tx = &#123;</span><br><span class="line">    semcount = 0</span><br><span class="line">  &#125;,</span><br><span class="line">  tx_pending = 1 <span class="string">'\001'</span>,</span><br><span class="line">  rx_fifo = 0x200033d0 <span class="string">"h\020"</span>,</span><br><span class="line">  fifo_len = 0,</span><br><span class="line">  nxt_read = 0,</span><br><span class="line">  nxt_write = 0,</span><br><span class="line"> [.....]</span><br></pre></td></tr></table></figure>
<h2 id="çƒ§å†™å›ºä»¶"><a href="#çƒ§å†™å›ºä»¶" class="headerlink" title="çƒ§å†™å›ºä»¶"></a>çƒ§å†™å›ºä»¶</h2><ul>
<li>çƒ§å†™<code>flash0</code>,åœ°å€<code>0x00400000</code>åœ¨é“¾æ¥è„šæœ¬æ–‡ä»¶<code>boards/arm/sam34/sam4s-xplained-pro/scripts/sam4s-xplained-pro.ld</code>é‡Œæœ‰å®šä¹‰.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">~$ openocd -f board/atmel_sam4s_xplained_pro.cfg -c init -c <span class="string">"reset halt"</span> -c <span class="string">"flash write_image erase nuttx.bin 0x00400000"</span> -c <span class="string">"reset"</span></span><br><span class="line">Open On-Chip Debugger 0.10.0+dev-01408-g762ddcb74-dirty (2020-09-25-00:32)</span><br><span class="line">Licensed under GNU GPL v2</span><br><span class="line">For bug reports, <span class="built_in">read</span></span><br><span class="line">	http://openocd.org/doc/doxygen/bugs.html</span><br><span class="line">Info : auto-selecting first available session transport <span class="string">"swd"</span>. To override use <span class="string">'transport select &lt;transport&gt;'</span>.</span><br><span class="line">Info : CMSIS-DAP: SWD  Supported</span><br><span class="line">Info : CMSIS-DAP: JTAG Supported</span><br><span class="line">Info : CMSIS-DAP: FW Version = 1.0</span><br><span class="line">Info : CMSIS-DAP: Serial<span class="comment"># = ATML1803040200001055</span></span><br><span class="line">Info : CMSIS-DAP: Interface Initialised (SWD)</span><br><span class="line">Info : SWCLK/TCK = 1 SWDIO/TMS = 1 TDI = 1 TDO = 1 nTRST = 0 nRESET = 1</span><br><span class="line">Info : CMSIS-DAP: Interface ready</span><br><span class="line">Info : clock speed 500 kHz</span><br><span class="line">Info : SWD DPIDR 0x2ba01477</span><br><span class="line">Info : ATSAM4SD32C.cpu: hardware has 6 breakpoints, 4 watchpoints</span><br><span class="line">Info : starting gdb server <span class="keyword">for</span> ATSAM4SD32C.cpu on 3333</span><br><span class="line">Info : Listening on port 3333 <span class="keyword">for</span> gdb connections</span><br><span class="line">target halted due to debug-request, current mode: Thread</span><br><span class="line">xPSR: 0x01000000 pc: 0x004000cc msp: 0x20001ee4</span><br><span class="line">Info : sam4 does not auto-erase <span class="keyword">while</span> programming (Erasing relevant sectors)</span><br><span class="line">Info : sam4 First: 0x00000000 Last: 0x0000000c</span><br><span class="line">Info : Erasing sector: 0x00000000</span><br><span class="line">Info : Erasing sector: 0x00000001</span><br><span class="line">Info : Erasing sector: 0x00000002</span><br><span class="line">Info : Erasing sector: 0x00000003</span><br><span class="line">Info : Erasing sector: 0x00000004</span><br><span class="line">Info : Erasing sector: 0x00000005</span><br><span class="line">Info : Erasing sector: 0x00000006</span><br><span class="line">Info : Erasing sector: 0x00000007</span><br><span class="line">Info : Erasing sector: 0x00000008</span><br><span class="line">Info : Erasing sector: 0x00000009</span><br><span class="line">Info : Erasing sector: 0x0000000a</span><br><span class="line">Info : Erasing sector: 0x0000000b</span><br><span class="line">Info : Erasing sector: 0x0000000c</span><br><span class="line">auto erase enabled</span><br><span class="line">wrote 106496 bytes from file nuttx.bin <span class="keyword">in</span> 5.418800s (19.192 KiB/s)</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿æ¥åˆ°å®ƒçš„<code>UART</code>æ¥å£ï¼Œè¿›å…¥ç³»ç»Ÿ.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo minicom -o -b 115200 -D /dev/ttyACM0</span><br><span class="line">NuttShell (NSH) NuttX-9.1.0</span><br><span class="line">nsh&gt; mm  <span class="comment">#æµ‹è¯•ä¸€ä¸‹å†…å­˜.</span></span><br></pre></td></tr></table></figure>
<h1 id="NAND-ç§»æ¤"><a href="#NAND-ç§»æ¤" class="headerlink" title="NAND ç§»æ¤"></a>NAND ç§»æ¤</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sam_nand_initialize: CS0</span><br><span class="line">nand_initialize: cmdaddr=0x60400000 addraddr=0x60200000 dataaddr=0x60000000</span><br><span class="line">onfi_ebidetect: cmdaddr=60400000 addraddr=60200000 dataaddr=60000000</span><br><span class="line">onfi_read: cmdaddr=60400000 addraddr=60200000 dataaddr=60000000</span><br><span class="line">onfi_read: Returning:</span><br><span class="line">onfi_read:   manufacturer:  0x2c</span><br><span class="line">onfi_read:   buswidth:      0</span><br><span class="line">onfi_read:   luns:          1</span><br><span class="line">onfi_read:   eccsize:       4</span><br><span class="line">onfi_read:   model:         0x @</span><br><span class="line">onfi_read:   sparesize:     64</span><br><span class="line">onfi_read:   pagesperblock: 64</span><br><span class="line">onfi_read:   blocksperlun:  2048</span><br><span class="line">onfi_read:   pagesize:      2048</span><br><span class="line">nand_initialize: Found ONFI compliant NAND FLASH</span><br><span class="line">nand_devscan: Retrieving bad block information. nblocks=2048</span><br></pre></td></tr></table></figure>
<ul>
<li>è¯»/å†™é¡µ(page),æ“¦é™¤å—(block).åœ¨æ¦‚å¿µä¸Šï¼Œç”±å¤§åˆ°å°æ¥è¯´ï¼Œå°±æ˜¯:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Nand Flash â‡’ Chip â‡’ Plane â‡’ Block â‡’ Page â‡’ oob</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> hexdump /dev/mtdblock0 count=128</span><br><span class="line">/dev/mtdblock0 at 00000000:</span><br><span class="line">0000: eb 3c 90 4e 55 54 54 58 20 20 20 00 08 20 01 00 .&lt;.NUTTX   .. ..</span><br><span class="line">0010: 02 00 02 00 00 f8 05 00 3f 00 ff 00 00 00 00 00 ........?.......</span><br><span class="line">0020: 00 00 02 00 00 00 29 00 00 00 00 20 20 20 20 20 ......)....</span><br><span class="line">0030: 20 20 20 20 20 20 46 41 54 31 36 20 20 20 0e 1f       FAT16   ..</span><br><span class="line">0040: be 5b 7c ac 22 c0 74 0b 56 b4 0e bb 07 00 <span class="built_in">cd</span> 10 .[|.\".t.V.......</span><br><span class="line">0050: 5e eb f0 32 e4 <span class="built_in">cd</span> 16 <span class="built_in">cd</span> 19 eb fe 54 68 69 73 20 ^..2.......This</span><br><span class="line">0060: 69 73 20 6e 6f 74 20 61 20 62 6f 6f 74 61 62 6c is not a bootabl</span><br><span class="line">0070: 65 20 64 69 73 6b 2e 20 20 50 6c 65 61 73 65 20 e disk.  Please</span><br></pre></td></tr></table></figure>
<ul>
<li><p>æ ¼å¼åŒ–<code>nuttx</code>ä»£ç </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status | grep <span class="string">"modified:"</span> | awk <span class="string">'&#123;print $2&#125;'</span> | xargs tools/checkpatch.sh -f</span><br></pre></td></tr></table></figure>
</li>
<li><p>å†…å­˜åˆ†å¸ƒ<code>SAMA5D3 Series</code>æ˜¯å‚ç…§<code>Datasheet</code>ç¬¬5ç« <code>Memories</code>. SAM4Sæ˜¯<code>SAM4S Datasheet  Chapter 6 . Product Mapping</code></p>
</li>
</ul>
<h1 id="Arduino-Due"><a href="#Arduino-Due" class="headerlink" title="Arduino Due"></a>Arduino Due</h1><ul>
<li><a href="https://store.arduino.cc/usa/due" target="_blank" rel="noopener">Arduino Due</a></li>
<li><a href="http://rdiez.shoutwiki.com/wiki/Hacking_with_the_Arduino_Due" target="_blank" rel="noopener">Hacking with the Arduino Due</a></li>
<li><a href="https://www.arduino.cc/en/Hacking/PinMappingSAM3X" target="_blank" rel="noopener">SAM3X-Arduino Pin Mapping</a></li>
<li>The Arduino Due is a microcontroller board based on the Atmel SAM3X8E ARM Cortex-M3 CPU. It is the first Arduino board based on a 32-bit ARM core microcontroller. It has 54 digital input/output pins (of which 12 can be used as PWM outputs), 12 analog inputs, 4 UARTs (hardware serial ports), a 84 MHz clock, an USB OTG capable connection, 2 DAC (digital to analog), 2 TWI, a power jack, an SPI header, a JTAG header, a reset button and an erase button.</li>
<li>æ ¹æ®å®˜æ–¹è­¦ç¤º:<code>Arduino Due</code>çš„ç®¡è„šåªå®¹<code>3.3v</code>,é«˜äº<code>3.3v</code>ä¼šæŸåæ¿å­.</li>
</ul>
<h2 id="BOSSACçƒ§å†™"><a href="#BOSSACçƒ§å†™" class="headerlink" title="BOSSACçƒ§å†™"></a>BOSSACçƒ§å†™</h2><ul>
<li>è¿™é‡Œå°†ä½¿ç”¨å®ƒå®˜æ–¹çš„çƒ§å†™å·¥å…·<code>BOSSAC</code>,å®ƒä¸€èˆ¬ä½äºç”¨æˆ·ç›®å½•ä¸‹.å¦‚:<code>~/.arduino15/packages/arduino/tools/bossac/1.7.0-arduino3/bossac</code>.</li>
</ul>
<h3 id="æ£€æµ‹ç›®æ ‡æ¿å­ä¿¡æ¯"><a href="#æ£€æµ‹ç›®æ ‡æ¿å­ä¿¡æ¯" class="headerlink" title="æ£€æµ‹ç›®æ ‡æ¿å­ä¿¡æ¯"></a>æ£€æµ‹ç›®æ ‡æ¿å­ä¿¡æ¯</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$  bossac -p ttyACM0 -U <span class="literal">false</span> -i</span><br><span class="line">No device found on ttyACM0</span><br></pre></td></tr></table></figure>
<ul>
<li>éœ€è¦è®¾ç½®æ­£ç¡®çš„ç«¯å£å‚æ•°,å¦‚æœå†ä¸è¡Œï¼ŒæŒ‰<code>reset</code>å†é‡è¯•ï¼Œå¦‚ä¸‹:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$ stty -F /dev/ttyACM0 speed 1200 cs8 -cstopb -parenb</span><br><span class="line">115200</span><br><span class="line">~ $ bossac -p ttyACM0 -U <span class="literal">false</span> -i</span><br><span class="line">Atmel SMART device 0x285e0a60 found</span><br><span class="line">Device       : ATSAM3X8</span><br><span class="line">Chip ID      : 285e0a60</span><br><span class="line">Version      : v1.1 Dec 15 2010 19:25:04</span><br><span class="line">Address      : 524288</span><br><span class="line">Pages        : 2048</span><br><span class="line">Page Size    : 256 bytes</span><br><span class="line">Total Size   : 512KB</span><br><span class="line">Planes       : 2</span><br><span class="line">Lock Regions : 32</span><br><span class="line">Locked       : none</span><br><span class="line">Security     : <span class="literal">false</span></span><br><span class="line">Boot Flash   : <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h3 id="çƒ§å…¥nuttx-bin"><a href="#çƒ§å…¥nuttx-bin" class="headerlink" title="çƒ§å…¥nuttx.bin"></a>çƒ§å…¥<code>nuttx.bin</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ bossac -p ttyACM0 -U <span class="literal">false</span> -e -w -v -b nuttx.bin -R</span><br><span class="line">Atmel SMART device 0x285e0a60 found</span><br><span class="line">Erase flash</span><br><span class="line"><span class="keyword">done</span> <span class="keyword">in</span> 0.041 seconds</span><br><span class="line"></span><br><span class="line">Write 62368 bytes to flash (244 pages)</span><br><span class="line">[==============================] 100% (244/244 pages)</span><br><span class="line"><span class="keyword">done</span> <span class="keyword">in</span> 12.866 seconds</span><br><span class="line"></span><br><span class="line">Verify 62368 bytes of flash</span><br><span class="line">[==============================] 100% (244/244 pages)</span><br><span class="line">Verify successful</span><br><span class="line"><span class="keyword">done</span> <span class="keyword">in</span> 12.240 seconds</span><br><span class="line">Set boot flash <span class="literal">true</span></span><br><span class="line">CPU reset.</span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨SWDçƒ§å†™"><a href="#ä½¿ç”¨SWDçƒ§å†™" class="headerlink" title="ä½¿ç”¨SWDçƒ§å†™"></a>ä½¿ç”¨SWDçƒ§å†™</h2><ul>
<li>é™¤äº†ä½¿ç”¨<code>BOSSAC</code>ï¼Œæœ¬æ¥æƒ³ä½¿ç”¨<code>SWD</code>æ¥å£ä¸<code>OpenOCD</code>æ¥çƒ§å†™è°ƒè¯•.å› ä¸º<code>Due</code>æ¿æœ‰ä¸€ä¸ªæ’4é’ˆçš„<code>DEBUG</code>æ¥å£ï¼Œé’ˆè„šæ˜¯:<code>1:RESET,2:SWDIO,3:SWCLK,4:GND</code>.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ cat &gt; ~/sam3x8e.cfg&lt;&lt;EOF</span><br><span class="line"><span class="built_in">source</span> [find interface/stlink.cfg]</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> CPUTAPID 0x2ba01477</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> [find board/atmel_sam3x_ek.cfg]</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">~$ openocd -f ~/sam3x8e.cfg  -c init -c halt -c <span class="string">"flash write_image erase nuttx.bin 0x80000"</span> -c <span class="string">"at91sam3 gpnvm set 1"</span> -c <span class="string">"exit"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="ä½¿ç”¨æ¿è½½AT16u2çƒ§å†™"><a href="#ä½¿ç”¨æ¿è½½AT16u2çƒ§å†™" class="headerlink" title="ä½¿ç”¨æ¿è½½AT16u2çƒ§å†™"></a>ä½¿ç”¨æ¿è½½<code>AT16u2</code>çƒ§å†™</h2><ul>
<li><p><a href="https://github.com/lanserge/at16u2_cmsis_dap" target="_blank" rel="noopener">at16u2_cmsis_dap</a></p>
</li>
<li><p>åœ¨ç½‘ä¸Šå‘ç°å¯ä»¥ä¿®æ”¹<code>AT16u2</code>çš„å›ºä»¶ï¼Œä½¿å®ƒæˆä¸º<code>CMSIS_DAP</code>,ä»è€Œå¯ä»¥æ”¯æŒ<code>openocd</code>çš„çƒ§å†™è°ƒè¯•.</p>
</li>
</ul>
<h3 id="æ›´æ–°AT16u2çš„å›ºä»¶"><a href="#æ›´æ–°AT16u2çš„å›ºä»¶" class="headerlink" title="æ›´æ–°AT16u2çš„å›ºä»¶"></a>æ›´æ–°AT16u2çš„å›ºä»¶</h3><ul>
<li><a href="https://www.arduino.cc/en/Hacking/Upgrading16U2Due" target="_blank" rel="noopener">Upgrading16U2Due</a></li>
<li><p>çƒ§å†™<code>AVR</code>èŠ¯ç‰‡éœ€è¦ä¸€ä¸ªçƒ§å†™å™¨ï¼Œå¦‚:<code>avr JATG-ICE, AVR-ISP,Atmel-ICE,USBasp</code>.ä¹Ÿå¯ä»¥æŠŠä¸€å—<code>arduino</code>æ¿å­å˜æˆ<code>AVR-ISP</code>.å¦‚:<code>Arduino Uno</code>. ä½†æ˜¯è¿™é‡Œæœ‰ä¸€å—<code>NUCLEO-L152RE</code>å®ƒæœ‰å…¼å®¹<code>arduino</code>çš„æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://github.com/stm32duino/Arduino_Core_STM32" target="_blank" rel="noopener">stm32duino</a>æŠŠå®ƒå˜æˆ<code>AVR-ISP</code>çƒ§å†™å™¨,çƒ§å…¥å®˜æ–¹çš„<code>ArduinoISP</code>è¿›å».</p>
</li>
<li><p>æ‰“å¼€<code>Arduino IDE --&gt; File --&gt; examples(Builtin-examples) --&gt; 11.ArduinoISP --&gt; ArduinoISP</code>,çƒ§å†™ä¸Šä¼ åˆ°<code>NUCLEO-L152RE</code>.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NUCLEO-L152RE        Arduino Due (ICSP)</span><br><span class="line">  D10 CS     &lt;------&gt;   Reset</span><br><span class="line">  D11 MOSI   &lt;------&gt;   MOSI</span><br><span class="line">  D12 MISO   &lt;------&gt;   MISO</span><br><span class="line">  D13 SCK    &lt;------&gt;   SCK</span><br><span class="line">      GND    &lt;------&gt;   GND</span><br><span class="line">      +5V    &lt;------&gt;   +5V</span><br></pre></td></tr></table></figure>
<h4 id="avrdude"><a href="#avrdude" class="headerlink" title="avrdude"></a>avrdude</h4><ul>
<li><p><a href="https://download.savannah.gnu.org/releases/avrdude/" target="_blank" rel="noopener">ä¸‹è½½avrdudeæºç </a>ï¼Œ<code>avrdude</code>æ˜¯ä¸€ä¸ªå¼€æºçš„<code>AVR</code>çƒ§å†™è½¯ä»¶ï¼Œå®ƒæœ€æ–°åœ°æ¿æœ¬æ˜¯<a href="https://download.savannah.gnu.org/releases/avrdude/avrdude-6.3.tar.gz" target="_blank" rel="noopener">avrdude-6.3</a>,é€šè¿‡æºç å¯ä»¥æŸ¥çœ‹å®ƒæ‰€æ”¯æŒçš„ç¡¬ä»¶è¯¦æƒ….</p>
</li>
<li><p>ä¸‹é¢æ˜¯ä½¿ç”¨<code>NUCLEO-L152RE</code>åšä¸ºä¸€ä¸ªçƒ§å†™å™¨ï¼ŒæŒ‰ç…§ä¸Šé¢æ¥çº¿ï¼Œå¯¹<code>Arduino Due</code>æ¿ä¸Šçš„<code>at16u2</code>çš„å›ºä»¶è¿›è¡Œæ›´æ–°.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cd</span>   ~/.arduino15/packages/arduino/tools/avrdude/6.3.0-arduino17/</span><br><span class="line">~$ tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â  â””â”€â”€ avrdude</span><br><span class="line">â””â”€â”€ etc</span><br><span class="line">    â””â”€â”€ avrdude.conf</span><br><span class="line"></span><br><span class="line">~$ avrdude -c arduino  -P /dev/ttyACM0 -b 19200 -p atmega16u2 -vvv -U flash:w:at16u2_cmsis_dap/at16u2_cmsis_dap.elf.hex:i</span><br><span class="line"></span><br><span class="line">avrdude: Version 6.3-20171130</span><br><span class="line">         Copyright (c) 2000-2005 Brian Dean, http://www.bdmicro.com/</span><br><span class="line">         Copyright (c) 2007-2014 Joerg Wunsch</span><br><span class="line"></span><br><span class="line">         System wide configuration file is <span class="string">"/etc/avrdude.conf"</span></span><br><span class="line">         User configuration file is <span class="string">"/home/michael/.avrduderc"</span></span><br><span class="line">         User configuration file does not exist or is not a regular file, skipping</span><br><span class="line"></span><br><span class="line">         Using Port                    : /dev/ttyACM0</span><br><span class="line">         Using Programmer              : arduino</span><br><span class="line">         Overriding Baud Rate          : 19200</span><br><span class="line">         AVR Part                      : ATmega16U2</span><br><span class="line">         Chip Erase delay              : 9000 us</span><br><span class="line">         PAGEL                         : PD7</span><br><span class="line">         BS2                           : PC6</span><br><span class="line">         RESET disposition             : possible i/o</span><br><span class="line">         RETRY pulse                   : SCK</span><br><span class="line">         serial program mode           : yes</span><br><span class="line">         parallel program mode         : yes</span><br><span class="line">         Timeout                       : 200</span><br><span class="line">         StabDelay                     : 100</span><br><span class="line">         CmdexeDelay                   : 25</span><br><span class="line">         SyncLoops                     : 32</span><br><span class="line">         ByteDelay                     : 0</span><br><span class="line">         PollIndex                     : 3</span><br><span class="line">         PollValue                     : 0x53</span><br><span class="line">         Memory Detail                 :</span><br><span class="line"></span><br><span class="line">                                  Block Poll               Page                       Polled</span><br><span class="line">           Memory Type Mode Delay Size  Indx Paged  Size   Size <span class="comment">#Pages MinW  MaxW   ReadBack</span></span><br><span class="line">           ----------- ---- ----- ----- ---- ------ ------ ---- ------ ----- ----- ---------</span><br><span class="line">           eeprom        65    20     4    0 no        512    4    128  9000  9000 0x00 0x00</span><br><span class="line">                                  Block Poll               Page                       Polled</span><br><span class="line">           Memory Type Mode Delay Size  Indx Paged  Size   Size <span class="comment">#Pages MinW  MaxW   ReadBack</span></span><br><span class="line">           ----------- ---- ----- ----- ---- ------ ------ ---- ------ ----- ----- ---------</span><br><span class="line">           flash         65     6   128    0 yes     16384  128    128  4500  4500 0x00 0x00</span><br><span class="line">                                  Block Poll               Page                       Polled</span><br><span class="line">           Memory Type Mode Delay Size  Indx Paged  Size   Size <span class="comment">#Pages MinW  MaxW   ReadBack</span></span><br><span class="line">           ----------- ---- ----- ----- ---- ------ ------ ---- ------ ----- ----- ---------</span><br><span class="line">           lfuse          0     0     0    0 no          1    0      0  9000  9000 0x00 0x00</span><br><span class="line">                                  Block Poll               Page                       Polled</span><br><span class="line">           Memory Type Mode Delay Size  Indx Paged  Size   Size <span class="comment">#Pages MinW  MaxW   ReadBack</span></span><br><span class="line">           ----------- ---- ----- ----- ---- ------ ------ ---- ------ ----- ----- ---------</span><br><span class="line">           hfuse          0     0     0    0 no          1    0      0  9000  9000 0x00 0x00</span><br><span class="line">                                  Block Poll               Page                       Polled</span><br><span class="line">           Memory Type Mode Delay Size  Indx Paged  Size   Size <span class="comment">#Pages MinW  MaxW   ReadBack</span></span><br><span class="line">           ----------- ---- ----- ----- ---- ------ ------ ---- ------ ----- ----- ---------</span><br><span class="line">           efuse          0     0     0    0 no          1    0      0  9000  9000 0x00 0x00</span><br><span class="line">                                  Block Poll               Page                       Polled</span><br><span class="line">           Memory Type Mode Delay Size  Indx Paged  Size   Size <span class="comment">#Pages MinW  MaxW   ReadBack</span></span><br><span class="line">           ----------- ---- ----- ----- ---- ------ ------ ---- ------ ----- ----- ---------</span><br><span class="line">           lock           0     0     0    0 no          1    0      0  9000  9000 0x00 0x00</span><br><span class="line">                                  Block Poll               Page                       Polled</span><br><span class="line">           Memory Type Mode Delay Size  Indx Paged  Size   Size <span class="comment">#Pages MinW  MaxW   ReadBack</span></span><br><span class="line">           ----------- ---- ----- ----- ---- ------ ------ ---- ------ ----- ----- ---------</span><br><span class="line">           calibration    0     0     0    0 no          1    0      0     0     0 0x00 0x00</span><br><span class="line">                                  Block Poll               Page                       Polled</span><br><span class="line">           Memory Type Mode Delay Size  Indx Paged  Size   Size <span class="comment">#Pages MinW  MaxW   ReadBack</span></span><br><span class="line">           ----------- ---- ----- ----- ---- ------ ------ ---- ------ ----- ----- ---------</span><br><span class="line">           signature      0     0     0    0 no          3    0      0     0     0 0x00 0x00</span><br><span class="line"></span><br><span class="line">         Programmer Type : Arduino</span><br><span class="line">         Description     : Arduino</span><br><span class="line">         Hardware Version: 2</span><br><span class="line">         Firmware Version: 1.18</span><br><span class="line">         Topcard         : Unknown</span><br><span class="line">         Vtarget         : 0.0 V</span><br><span class="line">         Varef           : 0.0 V</span><br><span class="line">         Oscillator      : Off</span><br><span class="line">         SCK period      : 0.1 us</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="è·³çº¿"><a href="#è·³çº¿" class="headerlink" title="è·³çº¿"></a>è·³çº¿</h3><ul>
<li>å› ä¸º<code>Due</code>æ¿ä¸Šçš„<code>GND,RESET</code>å·²ç»è¿æ¥åˆ°<code>AT16u2</code>ä¸Šäº†ï¼Œè¿™é‡Œ<code>Due</code>æ¿å†…åªéœ€ä¸¤æ ¹è·³çº¿å°±å¤Ÿäº†.æ‰€ä»¥æ­¤æ—¶çš„<code>at16u2</code>å°±æ˜¯ä¸€ä¸ª<code>CMSIS-DAP</code>çš„è®¾å¤‡äº†.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> ICSP            DEBUG(SWD)</span><br><span class="line"></span><br><span class="line">SCK (3)  &lt;-----&gt;   SCK (2)</span><br><span class="line">MOSI(4)  &lt;-----&gt;   SDO (3)</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨<code>OpenOCD</code>çƒ§å†™.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ openocd -f interface/cmsis-dap.cfg -f board/atmel_sam3x_ek.cfg  -c init -c halt -c <span class="string">"flash write_image erase nuttx.bin 0x80000"</span> -c <span class="string">"at91sam3 gpnvm set 1"</span> -c <span class="string">"exit"</span></span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨UM232H-FTDI-åšçƒ§å†™å™¨"><a href="#ä½¿ç”¨UM232H-FTDI-åšçƒ§å†™å™¨" class="headerlink" title="ä½¿ç”¨UM232H(FTDI)åšçƒ§å†™å™¨"></a>ä½¿ç”¨<code>UM232H(FTDI)</code>åšçƒ§å†™å™¨</h2><ul>
<li>ä¸Šé¢çš„åšæ³•æ˜¯ä½¿ç”¨ä¸€å—<code>arduino</code>æ¿åšä¸ºçƒ§å†™å™¨ï¼Œè¿™é‡Œæ˜¯ä½¿ç”¨<code>FT232H USB to SPI/I2C</code>çš„å°æ¿æ¥åšä¸ºçƒ§å†™å™¨,è¿æ¥æ¿ä¸Šçš„<code>DEBUG(SWD)</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># FT232HQ minimodule channel 0 (Channel A)</span></span><br><span class="line"><span class="comment"># Connector  FTDI               Arduino Due(SWD)</span></span><br><span class="line"><span class="comment"># Pin        Name</span></span><br><span class="line"><span class="comment"># ---------  ------             ------</span></span><br><span class="line"><span class="comment"># CN2-10      GND                GND   (pin1)</span></span><br><span class="line"><span class="comment"># CN2-13     ADBUS0 (TCK)       SWCLK  (pin2)</span></span><br><span class="line"><span class="comment"># CN2-14     ADBUS2 (TDI/TDO)   SWDIO  (pin3)</span></span><br><span class="line"><span class="comment"># CN2-15     ADBUS1 (TDO/TDI)   SWDIO  (pin3)</span></span><br><span class="line"><span class="comment"># CN2-17     ADBUS4 (GPIOL0)    nTRST  (pin4)</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>ä¹Ÿå¯ä»¥ä½¿ç”¨<code>Due</code>æ¿ä¸Šçš„æ ‡å‡†çš„<code>ARM-JTAG-10pin</code>å»è°ƒè¯•ï¼Œæ¥çº¿çš„æ–¹å¼å¦‚åŒä¸Šé¢ï¼Œå¯ä»¥ä½¿ç”¨<code>JTAG</code>ä¿¡å·ï¼Œä¹Ÿå¯ä»¥åªæ¥<code>SWD</code>ä¿¡å·.å¦‚æœè½¬æ¥åˆ°ä¸€ä¸ª<code>20Pin</code>çš„æ¿ä¸Šï¼Œå°±éœ€è¦å¯¹æ¥ç›¸åº”çš„ä¿¡å·çº¿.</p>
</li>
<li><p>ä½¿ç”¨<code>OpenOCD</code>çƒ§å†™,å¦‚æœæ¿ä¸ŠåŸæ¥æ˜¯<code>arduino</code>é•œåƒï¼Œéœ€è¦æŒ‰ä¸‹<code>reset</code>åï¼Œé©¬ä¸Šè¿è¡Œä¸‹é¢å‘½ä»¤.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ openocd -f interface/ftdi/ft232h-module-swd.cfg  -f board/atmel_sam3x_ek.cfg  -c init -c halt -c <span class="string">"flash write_image erase nuttx.bin 0x80000"</span> -c <span class="string">"at91sam3 gpnvm set 1"</span> -c <span class="string">"exit"</span></span><br></pre></td></tr></table></figure>
<h3 id="OpenOCDè¿æ¥"><a href="#OpenOCDè¿æ¥" class="headerlink" title="OpenOCDè¿æ¥"></a>OpenOCDè¿æ¥</h3><h3 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h3><ul>
<li>Write code to FLASH donâ€™t change boot mode and donâ€™t reset.  This lets<br>you examine the FLASH contents that you just loaded while the bootloader<br>is still active.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ bossac.exe --port=COM26 --usb-port=<span class="literal">false</span> -e -w -v --boot=0 nuttx.bin</span><br><span class="line">Write 64628 bytes to flash</span><br><span class="line">[==============================] 100% (253/253 pages)</span><br><span class="line">Verify 64628 bytes of flash</span><br><span class="line">[==============================] 100% (253/253 pages)</span><br><span class="line">Verify successful</span><br></pre></td></tr></table></figure>
<ul>
<li>Verify the FLASH contents (the bootloader must be running)</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ bossac.exe --port=COM26 --usb-port=<span class="literal">false</span> -v nuttx.bin</span><br><span class="line">Verify 64628 bytes of flash</span><br><span class="line">[==============================] 100% (253/253 pages)</span><br><span class="line">Verify successful</span><br></pre></td></tr></table></figure>
<ul>
<li>Read from FLASH to a file  (the bootloader must be running):</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ bossac.exe --port=COM26 --usb-port=<span class="literal">false</span> --<span class="built_in">read</span>=4096 nuttx.dump</span><br><span class="line">Read 4096 bytes from flash</span><br><span class="line">[==============================] 100% (16/16 pages)</span><br></pre></td></tr></table></figure>
<ul>
<li>Change to boot from FLASH</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ bossac.exe --port=COM26 --usb-port=<span class="literal">false</span> --boot=1</span><br><span class="line">Set boot flash <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="æ¢å¤AT16u2çš„å›ºä»¶"><a href="#æ¢å¤AT16u2çš„å›ºä»¶" class="headerlink" title="æ¢å¤AT16u2çš„å›ºä»¶"></a>æ¢å¤<code>AT16u2</code>çš„å›ºä»¶</h3><ul>
<li><p><a href="https://github.com/arduino/ArduinoCore-sam" target="_blank" rel="noopener">ArduinoCore-sam</a></p>
</li>
<li><p>ä¸‹é¢æ˜¯æŠŠ<code>Arduino Due</code>æ¿ä¸Šçš„<code>AT16u2</code>æ¢å¤å®ƒåŸæ¥çš„å›ºä»¶åŠŸèƒ½ï¼Œè¿™é‡Œæ˜¯ä½¿ç”¨<code>FT232H</code>è¿å®ƒçš„<code>ICSP</code>è€Œä¸æ˜¯ç”¨ä¸€ä¸ª<code>Arduino</code>æ¿æ¥åšçƒ§å†™å™¨.<code>arduino</code>å®ƒæ‰€æœ‰æ”¯æŒçš„å›ºä»¶éƒ½åœ¨å®ƒçš„å®‰è£…åŒ…å†…,å› ä¸º<code>Arduino Due</code>æ˜¯<code>SAM3X8E</code>çš„èŠ¯ç‰‡ï¼Œè¿™é‡Œé€‰æ‹©æŸ¥çœ‹<code>~/.arduino15/packages/arduino/hardware/sam/</code>ç›®å½•.å¦‚ä¸‹.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~$ tree ~/.arduino15/packages/arduino/hardware/sam/1.6.12/firmwares</span><br><span class="line">.arduino15/packages/arduino/hardware/sam/1.6.12/firmwares</span><br><span class="line">â””â”€â”€ atmega16u2</span><br><span class="line">    â”œâ”€â”€ Arduino-DUE-usbserial-prod-firmware-2012-11-05.hex</span><br><span class="line">    â”œâ”€â”€ Arduino-DUE-usbserial-prod-firmware-2013-02-05.hex</span><br><span class="line">    â””â”€â”€ arduino-usbserial</span><br><span class="line">        â”œâ”€â”€ Arduino-usbserial.c</span><br><span class="line">        â”œâ”€â”€ Arduino-usbserial.h</span><br><span class="line">        â”œâ”€â”€ Board</span><br><span class="line">        â”‚Â Â  â””â”€â”€ LEDs.h</span><br><span class="line">        â”œâ”€â”€ Descriptors.c</span><br><span class="line">        â”œâ”€â”€ Descriptors.h</span><br><span class="line">        â”œâ”€â”€ Lib</span><br><span class="line">        â”‚Â Â  â””â”€â”€ LightweightRingBuff.h</span><br><span class="line">        â”œâ”€â”€ makefile</span><br><span class="line">        â””â”€â”€ readme.txt</span><br><span class="line"></span><br><span class="line">4 directories, 10 files</span><br></pre></td></tr></table></figure>
<ul>
<li>å…³äºå¦‚ä½•æ¥çº¿çš„é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹<code>/etc/avrdude.conf</code>ï¼Œæ ¹æ®é‡Œé¢çš„æ³¨é‡ŠæŒ‡å¯¼ï¼Œç»“åˆè‡ªå·²æ¿å­æ¥çº¿.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    FT232H              Arduino Due (ICSP)</span><br><span class="line"></span><br><span class="line">pin15 ADBUS2   &lt;------&gt;   MISO  pin1</span><br><span class="line">        +5V    &lt;------&gt;   +5V      2</span><br><span class="line">pin13 ADBUS0   &lt;------&gt;   SCK      3</span><br><span class="line">pin14 ADBUS1   &lt;------&gt;   MOSI     4</span><br><span class="line">pin16 ADBUS3   &lt;------&gt;   Reset    5</span><br><span class="line">        GND    &lt;------&gt;   GND      6</span><br></pre></td></tr></table></figure>
<ul>
<li>çƒ§å†™å‘½ä»¤å¦‚ä¸‹ï¼Œå¦‚æœ‰é—®é¢˜å¯ä»¥ï¼Œæ·»åŠ <code>-vvv</code>çƒ§å†™æŸ¥çœ‹.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">~$ avrdude -C /etc/avrdude.conf -c UM232H -P /dev/ttyUSB0 -b 19200 -p atmega16u2 -U flash:w:Arduino-DUE-usbserial-prod-firmware-2013-02-05.hex:i</span><br><span class="line"></span><br><span class="line">avrdude: AVR device initialized and ready to accept instructions</span><br><span class="line"></span><br><span class="line">Reading | <span class="comment">################################################## | 100% 0.01s</span></span><br><span class="line"></span><br><span class="line">avrdude: Device signature = 0x1e9489 (probably m16u2)</span><br><span class="line">avrdude: NOTE: <span class="string">"flash"</span> memory has been specified, an erase cycle will be performed</span><br><span class="line">         To <span class="built_in">disable</span> this feature, specify the -D option.</span><br><span class="line">avrdude: erasing chip</span><br><span class="line">avrdude: reading input file <span class="string">"Arduino-DUE-usbserial-prod-firmware-2013-02-05.hex"</span></span><br><span class="line">avrdude: writing flash (4314 bytes):</span><br><span class="line"></span><br><span class="line">Writing | <span class="comment">################################################## | 100% 7.56s</span></span><br><span class="line"></span><br><span class="line">avrdude: 4314 bytes of flash written</span><br><span class="line">avrdude: verifying flash memory against Arduino-DUE-usbserial-prod-firmware-2013-02-05.hex:</span><br><span class="line">avrdude: load data flash data from input file Arduino-DUE-usbserial-prod-firmware-2013-02-05.hex:</span><br><span class="line">avrdude: input file Arduino-DUE-usbserial-prod-firmware-2013-02-05.hex contains 4314 bytes</span><br><span class="line">avrdude: reading on-chip flash data:</span><br><span class="line"></span><br><span class="line">Reading | <span class="comment">################################################## | 100% 7.28s</span></span><br><span class="line"></span><br><span class="line">avrdude: verifying ...</span><br><span class="line">avrdude: 4314 bytes of flash verified</span><br><span class="line"></span><br><span class="line">avrdude: safemode: Fuses OK (E:F4, H:D9, L:FF)</span><br><span class="line"></span><br><span class="line">avrdude <span class="keyword">done</span>.  Thank you.</span><br></pre></td></tr></table></figure>
<h1 id="è°¢è°¢æ”¯æŒ"><a href="#è°¢è°¢æ”¯æŒ" class="headerlink" title="è°¢è°¢æ”¯æŒ"></a>è°¢è°¢æ”¯æŒ</h1><ul>
<li>å¾®ä¿¡äºŒç»´ç :</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/16/CSVä¸EXCELçš„æ–‡ä»¶å¤„ç†/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/16/CSVä¸EXCELçš„æ–‡ä»¶å¤„ç†/" class="post-title-link" itemprop="url">CSVä¸EXCELçš„æ–‡ä»¶å¤„ç†</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-09-16 17:25:42" itemprop="dateCreated datePublished" datetime="2020-09-16T17:25:42+08:00">2020-09-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-02-26 23:52:54" itemprop="dateModified" datetime="2022-02-26T23:52:54+08:00">2022-02-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å¤„ç†CSV"><a href="#å¤„ç†CSV" class="headerlink" title="å¤„ç†CSV"></a>å¤„ç†CSV</h1><ul>
<li>ç¤ºä¾‹æ–‡ä»¶çš„å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ head  TFWP_2020Q1_Positive_EN.csv</span><br><span class="line"><span class="string">"Employers Who Were Issued a Positive Labour Market Impact Assessment (LMIA) by Program Stream, National Occupational Classification (NOC) 2011 and Business Location, January to March 2020"</span>,,,,,</span><br><span class="line">Province/Territory,Program Stream,Employer ,Address,Occupation,Approved Positions</span><br><span class="line">Newfoundland and Labrador,    High Wage,Anglo Eastern Ship Managment Ltd,<span class="string">"Wanchai, A0A0A0"</span>,<span class="string">"2273-Deck officers, water transport"</span>,4</span><br><span class="line">Newfoundland and Labrador,    High Wage,Anglo Eastern Ship Managment Ltd,<span class="string">"Wanchai, A0A0A0"</span>,<span class="string">"2274-Engineer officers, water transport"</span>,4</span><br><span class="line">Newfoundland and Labrador,    High Wage,Anglo Eastern Ship Managment Ltd,<span class="string">"Wanchai, A0A0A0"</span>,7242-Industrial electricians,1</span><br><span class="line">Newfoundland and Labrador,    High Wage,Anglo Eastern Ship Managment Ltd,<span class="string">"Wanchai, A0A0A0"</span>,7532-Water transport deck and engine room crew,9</span><br><span class="line">Newfoundland and Labrador,    High Wage,Anglo Eastern Ship Managment Ltd,<span class="string">"Wanchai, A0A0A0"</span>,7612-Other trades helpers and labourers,1</span><br><span class="line">Newfoundland and Labrador,    High Wage,Bailey Veterinary Surgical Specialty Ltd.,<span class="string">"St. John's, A1N3J7"</span>,3114-Veterinarians,1</span><br><span class="line">Newfoundland and Labrador,    High Wage,Eastern Regional Health Authority,<span class="string">"Mount Pearl, A1N3J5"</span>,3111-Specialist physicians,1</span><br><span class="line">Newfoundland and Labrador,    High Wage,WesTower Communications Ltd.,<span class="string">"St. John's, A1A5G6"</span>,7245-Telecommunications line and cable workers,2</span><br><span class="line"></span><br><span class="line">[....]</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚ä¸Šé¢æ‰€ç¤ºï¼Œç¬¬ä¸€è¡Œåº”è¯¥ç®—æ˜¯ä¸€ä¸ªæ ‡é¢˜ï¼Œç¬¬äºŒè¡Œæ˜¯CSVæ–‡ä»¶çš„åˆ—å­—æ®µï¼Œä»¥é€—å·é—´éš”.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [34]: import pandas as pd</span><br><span class="line"><span class="comment"># è¿™é‡Œè·³è¿‡äº†ç¬¬ä¸€è¡Œçš„è¯»å–,ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ skiprows=1,nrows=8814ï¼Œä»ç¬¬äºŒå¼€å§‹è¯»å–8814è¡Œ.</span></span><br><span class="line">In [35]: a = pd.read_csv(<span class="string">"/home/michael/Documents/TFWP_2020Q1_Positive_EN.csv"</span>,encoding=<span class="string">"latin"</span>,skiprows=1)</span><br><span class="line">In [37]: a.head()</span><br><span class="line">Out[37]:</span><br><span class="line">          Province/Territory Program Stream                         Employer           Address                                      Occupation  Approved Positions</span><br><span class="line">0  Newfoundland and Labrador      High Wage  Anglo Eastern Ship Managment Ltd  Wanchai, A0A0A0             2273-Deck officers, water transport                 4.0</span><br><span class="line">1  Newfoundland and Labrador      High Wage  Anglo Eastern Ship Managment Ltd  Wanchai, A0A0A0         2274-Engineer officers, water transport                 4.0</span><br><span class="line">2  Newfoundland and Labrador      High Wage  Anglo Eastern Ship Managment Ltd  Wanchai, A0A0A0                    7242-Industrial electricians                 1.0</span><br><span class="line">3  Newfoundland and Labrador      High Wage  Anglo Eastern Ship Managment Ltd  Wanchai, A0A0A0  7532-Water transport deck and engine room crew                 9.0</span><br><span class="line">4  Newfoundland and Labrador      High Wage  Anglo Eastern Ship Managment Ltd  Wanchai, A0A0A0         7612-Other trades helpers and labourers                 1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚ï¼šç›´æ¥è¾“å‡ºæˆHTMLæˆ–EXCEL.</span></span><br><span class="line">In [38]: a.to_html(<span class="string">"name.html"</span>)</span><br><span class="line"></span><br><span class="line">In [39]: a.to_excel(<span class="string">"name.xlsx"</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿‡æ»¤ä¸€äº›ç‰¹å®šå­—æ®µï¼Œå¦‚ä¸‹é¢ï¼ŒæŸ¥æ‰¾å‡º<code>Occupation</code>å­—æ®µä¸­ï¼Œä»¥<code>2175-Web</code>å¼€å¤´çš„æ‰€æœ‰è¡Œè®°å½•.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a[a.Occupation.str.startswith(<span class="string">'2175-Web'</span>)]</span><br><span class="line">Out[85]:</span><br><span class="line">     Province/Territory         Program Stream                                        Employer                   Address                         Occupation  Approved Positions</span><br><span class="line">53          Nova Scotia              High Wage                              10094277 Canada Inc          Halifax, B3J2T9  2175-Web designers and developers                   2</span><br><span class="line">124         Nova Scotia   Global Talent Stream                             3rDi Laboratory Inc.        Wolfville, B4P3R6  2175-Web designers and developers                   2</span><br><span class="line">207              Quebec              High Wage                         213A Studio CrÃ©atif Inc.         MontrÃ©al, H2S3X3  2175-Web designers and developers                   1</span><br><span class="line">249              Quebec              High Wage                            9122-4790 QuÃ©bec Inc.            Laval, H7M5Y6  2175-Web designers and developers                   1</span><br><span class="line">511              Quebec              High Wage                                     GÃ©oplus Inc.            Laval, H7L5B7  2175-Web designers and developers                   1</span><br><span class="line">609              Quebec              High Wage       les produits de fenetres sol-r (2000) inc.         montreal, H4N1H8  2175-Web designers and developers                   1</span><br><span class="line">668              Quebec              High Wage                                      Ossiaco Inc         Montreal, H3C2G9  2175-Web designers and developers                   1</span><br></pre></td></tr></table></figure>
<h2 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [2]: pd.read_csv(<span class="string">"/home/michael/Documents/TFWP_2020Q1_Positive_EN.csv"</span>)</span><br><span class="line">[.....]</span><br><span class="line">UnicodeDecodeError: <span class="string">'utf-8'</span> codec can<span class="string">'t decode byte 0xea in position 1: invalid continuation byte</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å°è¯•ä½¿ç”¨<code>encoding=&quot;latin&quot;</code>è¯»å–ï¼Œå¦‚:<code>pd.read_csv(&quot;/home/michael/Documents/TFWP_2020Q1_Positive_EN.csv&quot;,encoding=&quot;latin&quot;)</code></li>
</ul>
<h1 id="è°¢è°¢æ”¯æŒ"><a href="#è°¢è°¢æ”¯æŒ" class="headerlink" title="è°¢è°¢æ”¯æŒ"></a>è°¢è°¢æ”¯æŒ</h1><ul>
<li>å¾®ä¿¡äºŒç»´ç :</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/07/å¼€å§‹Flutterå…¥å‘å®æ“/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/07/å¼€å§‹Flutterå…¥å‘å®æ“/" class="post-title-link" itemprop="url">å¼€å§‹Flutterå…¥å‘å®æ“</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-08-07 10:53:35" itemprop="dateCreated datePublished" datetime="2020-08-07T10:53:35+08:00">2020-08-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-02-26 23:52:54" itemprop="dateModified" datetime="2022-02-26T23:52:54+08:00">2022-02-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>å‚è€ƒé“¾ç»“<ul>
<li><a href="https://flutter.dev/docs/get-started" target="_blank" rel="noopener">Get started</a></li>
<li><a href="https://flutter.dev/docs" target="_blank" rel="noopener">Flutter Documentation</a></li>
<li><a href="https://flutterchina.club/faq/" target="_blank" rel="noopener">ä¸­æ–‡FAQ</a></li>
</ul>
</li>
</ul>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><ul>
<li>Flutteræ˜¯è°·æ­Œçš„ç§»åŠ¨UIæ¡†æ¶ï¼Œå¯ä»¥å¿«é€Ÿå¼€å‘å‡ºé«˜è´¨é‡çš„åŸç”Ÿç”¨æˆ·ç•Œé¢ï¼Œå¹¶ä¸”Flutteræ˜¯å®Œå…¨å…è´¹å¼€æºçš„.ç°åœ¨Flutterè‡³å°‘å¯ä»¥è·¨5ç§å¹³å°ï¼Œå¦‚ï¼šMacOS,Windows,Linux,Android,iOS,ç”šè‡³è¿˜å¯ä»¥åœ¨è°·å“¥çš„Fuchsiaç³»ç»Ÿä¸Šè¿è¡Œ.</li>
</ul>
<h1 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h1><ul>
<li>å½“ç„¶ï¼Œæœ€æ–°ï¼Œæœ€æƒå¨çš„æŠ€æœ¯èµ„æºè¿˜æ˜¯å®ƒçš„å®˜ç½‘æ–‡æ¡£.è¿™é‡Œå¤§éƒ¨åˆ†éƒ½æŒ‰ç…§å®˜ç½‘æ–‡æ¡£çš„æ­¥éª¤æ¥è¿›è¡Œçš„.</li>
</ul>
<h2 id="å®‰è£…Flutter"><a href="#å®‰è£…Flutter" class="headerlink" title="å®‰è£…Flutter"></a>å®‰è£…Flutter</h2><ul>
<li>æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯<code>Debian</code>ç³»ç»Ÿï¼Œè€Œä¸”é€‰æ‹©ä½¿ç”¨å®ƒçš„<a href="https://github.com/flutter/flutter.git" target="_blank" rel="noopener">GitHub</a>çš„æºæ¥å®‰è£…ï¼Œè€Œä¸æ˜¯ä¸‹è½½å®‰ä¸€ä¸ªå›ºå®šç‰ˆæœ¬çš„<code>Flutter</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/flutter/flutter.git</span><br><span class="line"></span><br><span class="line">~$ <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:`<span class="built_in">pwd</span>`/flutter/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯é€‰çš„ï¼Œé¢„å…ˆä¸‹è½½ä¸€äº›å¼€å‘æ–‡ä»¶.</span></span><br><span class="line">~$ flutter precache</span><br><span class="line"></span><br><span class="line"> ~$ flutter doctor</span><br><span class="line"> ~$  <span class="built_in">which</span> flutter dart</span><br><span class="line">/fullpath/flutter/bin/flutter</span><br><span class="line">/fullpath/flutter/bin/dart</span><br></pre></td></tr></table></figure>
<h2 id="ç¼–è¾‘å™¨æ”¯æŒ"><a href="#ç¼–è¾‘å™¨æ”¯æŒ" class="headerlink" title="ç¼–è¾‘å™¨æ”¯æŒ"></a>ç¼–è¾‘å™¨æ”¯æŒ</h2><h3 id="Android-Studio-and-IntelliJï¼ŒVS-Code-Emacs"><a href="#Android-Studio-and-IntelliJï¼ŒVS-Code-Emacs" class="headerlink" title="Android Studio and IntelliJï¼ŒVS Code, Emacs"></a>Android Studio and IntelliJï¼ŒVS Code, Emacs</h3><ul>
<li><code>Android Studio</code> è‡³å°‘éœ€è¦3.6.3ä»¥ä¸Šçš„ç‰‡æœ¬.<code>ASä¸VS</code>éœ€è¦å®‰è£…ä¸Š<code>Flutter plugin</code>ä¸<code>Dart plugin</code>æ’ä»¶æ‰©å±•.<code>Emacs</code>éœ€è¦å®‰è£…<code>lsp-dart package</code>.</li>
</ul>
<h3 id="å›½å†…é•œåƒæº"><a href="#å›½å†…é•œåƒæº" class="headerlink" title="å›½å†…é•œåƒæº"></a>å›½å†…é•œåƒæº</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">export</span> PUB_HOSTED_URL=https://pub.flutter-io.cn</span><br><span class="line">~$ <span class="built_in">export</span> FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn</span><br><span class="line">~$  git <span class="built_in">clone</span> -b dev https://github.com/flutter/flutter.git</span><br><span class="line">~$ <span class="built_in">export</span> PATH=<span class="string">"<span class="variable">$PWD</span>/flutter/bin:<span class="variable">$PATH</span>"</span></span><br><span class="line">~$ <span class="built_in">cd</span> ./flutter</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦å¤–è¿˜æœ‰ä¸Šæµ·äº¤å¤§çš„æº:<ul>
<li>FLUTTER_STORAGE_BASE_URL: <a href="https://mirrors.sjtug.sjtu.edu.cn/" target="_blank" rel="noopener">https://mirrors.sjtug.sjtu.edu.cn/</a></li>
<li>PUB_HOSTED_URL: <a href="https://dart-pub.mirrors.sjtug.sjtu.edu.cn/" target="_blank" rel="noopener">https://dart-pub.mirrors.sjtug.sjtu.edu.cn/</a></li>
</ul>
</li>
</ul>
<h2 id="æ›´æ–°Flutter"><a href="#æ›´æ–°Flutter" class="headerlink" title="æ›´æ–°Flutter"></a>æ›´æ–°Flutter</h2><ul>
<li>æ›´æ–°Flutter SDK</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ flutter upgrade</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Flutter</code>æœ‰4ç§å‘å¸ƒç‰ˆæœ¬:<code>stable,beta,dev,master</code>,ä¸€èˆ¬æ¨å­˜ä½¿ç”¨<code>stable</code>ç‰ˆæœ¬.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ flutter channel  <span class="comment"># æŸ¥çœ‹</span></span><br><span class="line">~$ flutter channel dev</span><br><span class="line">~$ flutter upgrade</span><br></pre></td></tr></table></figure>
<ul>
<li>æ›´æ–°åŒ…èµ„æºï¼Œç±»ä¼¼å¤§å¤šWEBå¼€å‘ä¸€æ ·çš„, å¦‚ä¿®æ”¹äº†å·¥ç¨‹å†…çš„<code>pubspec.yaml</code>åï¼Œå¯ä»¥é€šè¿‡æ›´æ–°æ¥è§£å†³ä¾èµ–.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ flutter pub upgrade</span><br></pre></td></tr></table></figure>
<ul>
<li>å¤„ç†è¿‡æ—¶åŒ…çš„ä¾èµ–ï¼Œå¯ä»¥å‚è€ƒ<a href="https://dart.dev/tools/pub/cmd/pub-outdated" target="_blank" rel="noopener">pub outdated documentation</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ flutter pub u</span><br></pre></td></tr></table></figure>
<ul>
<li>é€‰æ‹©ç‰¹å®šç‰ˆæœ¬</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ flutter version v1.21.0+hotfix.3</span><br></pre></td></tr></table></figure>
<h2 id="è¿è¡Œflutter-doctor"><a href="#è¿è¡Œflutter-doctor" class="headerlink" title="è¿è¡Œflutter doctor"></a>è¿è¡Œ<code>flutter doctor</code></h2><p>*</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¥æˆlicenses.</span></span><br><span class="line">~$ flutter doctor --android-licenses</span><br><span class="line">~$ flutter doctor -v</span><br><span class="line">[âœ“] Flutter (Channel master, 1.21.0-6.0.pre.227, on Linux, locale en_US.UTF-8)</span><br><span class="line">    â€¢ Flutter version 1.21.0-6.0.pre.227 at /home/michael/3TB-DISK/github/flutter</span><br><span class="line">    â€¢ Framework revision e9117c1902 (12 hours ago), 2020-08-06 08:15:25 -0700</span><br><span class="line">    â€¢ Engine revision 36db6cfdd1</span><br><span class="line">    â€¢ Dart version 2.10.0 (build 2.10.0-3.0.dev 14a6aac97b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[âœ“] Android toolchain - develop <span class="keyword">for</span> Android devices (Android SDK version 30.0.1)</span><br><span class="line">    â€¢ Android SDK at /home/michael/3TB-DISK/Android/Sdk/</span><br><span class="line">    â€¢ Platform android-30, build-tools 30.0.1</span><br><span class="line">    â€¢ ANDROID_HOME = /home/michael/3TB-DISK/Android/Sdk/</span><br><span class="line">    â€¢ ANDROID_SDK_ROOT = /home/michael/3TB-DISK/Android/Sdk/</span><br><span class="line">    â€¢ Java binary at: /home/michael/IDE_DIR/android-studio/jre/bin/java</span><br><span class="line">    â€¢ Java version OpenJDK Runtime Environment (build 1.8.0_242-release-1644-b3-6222593)</span><br><span class="line">    â€¢ All Android licenses accepted.</span><br><span class="line"></span><br><span class="line">[âœ“] Linux toolchain - develop <span class="keyword">for</span> Linux desktop</span><br><span class="line">    â€¢ clang version 7.0.1-8 (tags/RELEASE_701/final)</span><br><span class="line">    â€¢ cmake version 3.13.4</span><br><span class="line">    â€¢ ninja version 1.8.2</span><br><span class="line">    â€¢ pkg-config version 0.29</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[âœ“] Android Studio (version 4.0)</span><br><span class="line">    â€¢ Android Studio at /home/michael/IDE_DIR/android-studio</span><br><span class="line">    â€¢ Flutter plugin version 48.0.2</span><br><span class="line">    â€¢ Dart plugin version 193.7361</span><br><span class="line">    â€¢ Java version OpenJDK Runtime Environment (build 1.8.0_242-release-1644-b3-6222593)</span><br><span class="line"></span><br><span class="line">[âœ“] VS Code (version 1.47.3)</span><br><span class="line">    â€¢ VS Code at /usr/share/code</span><br><span class="line">    â€¢ Flutter extension version 3.13.2</span><br><span class="line"></span><br><span class="line">[!] Proxy Configuration</span><br><span class="line">    â€¢ HTTP_PROXY is <span class="built_in">set</span></span><br><span class="line">    ! NO_PROXY is not <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">[âœ“] Connected device (1 available)</span><br><span class="line">    â€¢ Linux (desktop) â€¢ linux â€¢ linux-x64 â€¢ Linux</span><br><span class="line">! Doctor found issues <span class="keyword">in</span> 1 categories.</span><br></pre></td></tr></table></figure>
<h2 id="åˆ›å»ºç¬¬ä¸€ä¸ªç¨‹åº"><a href="#åˆ›å»ºç¬¬ä¸€ä¸ªç¨‹åº" class="headerlink" title="åˆ›å»ºç¬¬ä¸€ä¸ªç¨‹åº"></a>åˆ›å»ºç¬¬ä¸€ä¸ªç¨‹åº</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ flutter create myapp</span><br><span class="line">~$ <span class="built_in">cd</span> myapp</span><br><span class="line">~$ flutter run -d linux</span><br></pre></td></tr></table></figure>
<h1 id="Webå¼€å‘"><a href="#Webå¼€å‘" class="headerlink" title="Webå¼€å‘"></a>Webå¼€å‘</h1><ul>
<li>å¦‚æœæƒ³ç”¨<code>Flutter</code>å¼€å‘<code>Webåº”ç”¨</code>ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œç°åœ¨åªæ˜¯æ—©æœŸæ”¯æŒï¼Œéœ€è¦åˆ‡æ¢åˆ°<code>beta</code>ç‰ˆæœ¬.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">~$ flutter channel beta</span><br><span class="line">~$ flutter upgrade</span><br><span class="line"></span><br><span class="line">~$ flutter config --<span class="built_in">enable</span>-web</span><br><span class="line">Setting <span class="string">"enable-web"</span> value to <span class="string">"true"</span>.</span><br><span class="line"></span><br><span class="line">You may need to restart any open editors <span class="keyword">for</span> them to <span class="built_in">read</span> new settings.</span><br><span class="line">~$ cat ~/.flutter_settings</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"enable-linux-desktop"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"enable-windows-desktop"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"enable-web"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">~$  flutter devices</span><br><span class="line">3 connected devices:</span><br><span class="line"></span><br><span class="line">Linux (desktop)  â€¢ linux      â€¢ linux-x64      â€¢ Linux</span><br><span class="line">Web Server (web) â€¢ web-server â€¢ web-javascript â€¢ Flutter Tools</span><br><span class="line">Chrome (web)     â€¢ chrome     â€¢ web-javascript â€¢ Google Chrome 71.0.3578.98</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="åˆ›å»ºæ–°å·¥ç¨‹"><a href="#åˆ›å»ºæ–°å·¥ç¨‹" class="headerlink" title="åˆ›å»ºæ–°å·¥ç¨‹"></a>åˆ›å»ºæ–°å·¥ç¨‹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ flutter create myapp</span><br><span class="line">~$ <span class="built_in">cd</span> myapp</span><br><span class="line">~$ flutter run -d chrome</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœä¸Šé¢è¿è¡Œå‡ºé”™ï¼Œæç¤ºå¦‚ï¼š<code>Unable to connect to Chrome debug port: 16799</code>ï¼Œæ£€æŸ¥æ˜¯å¦åœ¨ç¯å¢ƒå˜é‡é‡Œè®¾ç½®äº†<code>HTTP_PROXY</code>,unsetåå†è¿è¡Œ.</li>
</ul>
<h3 id="å¯¹å·²æœ‰çš„åº”ç”¨æ·»åŠ Webæ”¯æŒ"><a href="#å¯¹å·²æœ‰çš„åº”ç”¨æ·»åŠ Webæ”¯æŒ" class="headerlink" title="å¯¹å·²æœ‰çš„åº”ç”¨æ·»åŠ Webæ”¯æŒ"></a>å¯¹å·²æœ‰çš„åº”ç”¨æ·»åŠ Webæ”¯æŒ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ flutter create .</span><br></pre></td></tr></table></figure>
<h3 id="ç¼–è¯‘å·¥ç¨‹"><a href="#ç¼–è¯‘å·¥ç¨‹" class="headerlink" title="ç¼–è¯‘å·¥ç¨‹"></a>ç¼–è¯‘å·¥ç¨‹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ flutter build web</span><br></pre></td></tr></table></figure>
<h1 id="Androidå¼€å‘"><a href="#Androidå¼€å‘" class="headerlink" title="Androidå¼€å‘"></a>Androidå¼€å‘</h1><ul>
<li>å¦‚ä¸Šé¢è¿è¡Œ<code>flutter doctor</code>æ‰€ç¤ºï¼Œåœ¨<code>Android Studio</code>é‡Œå®‰è£…å¥½<code>Dart Plugin</code>ä¸<code>Flutter plugin</code>. è¿™é‡Œåœ¨IDEæ–°å»ºä¸€ä¸ª<code>Flutter Application</code>å·¥ç¨‹.</li>
</ul>
<h1 id="æ¡Œé¢å¼€å‘"><a href="#æ¡Œé¢å¼€å‘" class="headerlink" title="æ¡Œé¢å¼€å‘"></a>æ¡Œé¢å¼€å‘</h1><h1 id="è°¢è°¢æ”¯æŒ"><a href="#è°¢è°¢æ”¯æŒ" class="headerlink" title="è°¢è°¢æ”¯æŒ"></a>è°¢è°¢æ”¯æŒ</h1><ul>
<li>å¾®ä¿¡äºŒç»´ç :</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/13/TI-CC2640R2-LaunchPadå¼€å‘æŒ‡å—/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/13/TI-CC2640R2-LaunchPadå¼€å‘æŒ‡å—/" class="post-title-link" itemprop="url">TI-CC2640R2-LaunchPadå¼€å‘æŒ‡å—</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-03-13 21:18:44" itemprop="dateCreated datePublished" datetime="2020-03-13T21:18:44+08:00">2020-03-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-08-17 21:23:21" itemprop="dateModified" datetime="2022-08-17T21:23:21+08:00">2022-08-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><p>å‚è€ƒé“¾æ¥</p>
<ul>
<li><a href="https://e2echina.ti.com/question_answer/w/faq/553.cc2640r2f-cc2640-cc2650" target="_blank" rel="noopener">CC25xxç›¸å…³çš„FAQ</a></li>
<li><a href="https://www.ti.com.cn/tool/cn/BLE-STACK" target="_blank" rel="noopener">è“ç‰™åè®®æ ˆ</a></li>
<li><a href="https://www.hackster.io/firmwareguru/secure-ota-firmware-update-with-cc2650-e14683" target="_blank" rel="noopener">Secure OTA Firmware Update with CC2650</a></li>
<li><a href="https://e2echina.ti.com/question_answer/wireless_connectivity/bluetooth/f/103/t/146495" target="_blank" rel="noopener">how to update CC2640 firmware via UART in linux</a></li>
<li><a href="https://github.com/JelmerT/cc2538-bsl" target="_blank" rel="noopener">TI CC13xx/CC2538/CC26xx Serial Boot Loader</a></li>
</ul>
</li>
<li><p><a href="simplelink_cc2640r2_sdk_1_50_00_58/docs/blestack/ble_user_guide/html/ble-stack-3.x-guide/reference.html#term-46">æœ¯è¯­ç®€ä»‹</a></p>
<ul>
<li>BLE :Bluetooth Low Energy</li>
<li>BR/EDR: Basic Rate/Enhanced Data Rate</li>
<li>GAP: Generic Access Protocol</li>
<li>HCI: Host Control Interface</li>
<li>BIM: Boot Image Manager, the software bootloader</li>
<li>CCFG: Customer Configuration Area, contains lock-bits on flash page 31 and the Customer Configuration Table (.ccfg)</li>
<li>OAD: Over the Air Download</li>
<li>SNP: Simple Network Processor, a BLE network processor implementation that supports the peripheral and broadcaster GAP Roles.</li>
<li>AP: Application Processor, the host MCU that implements the user application. Connected to a network processor via a serial interface such as NPI</li>
<li>SC: Sensor Controller</li>
<li>SCS: Sensor Controller Studio</li>
</ul>
</li>
</ul>
<h1 id="ç¡¬ä»¶ç®€ä»‹"><a href="#ç¡¬ä»¶ç®€ä»‹" class="headerlink" title="ç¡¬ä»¶ç®€ä»‹"></a>ç¡¬ä»¶ç®€ä»‹</h1><h2 id="ç¡¬ä»¶æ¶æ„"><a href="#ç¡¬ä»¶æ¶æ„" class="headerlink" title="ç¡¬ä»¶æ¶æ„"></a>ç¡¬ä»¶æ¶æ„</h2><ul>
<li><a href="http://www.ti.com.cn/product/cn/CC2640R2F" target="_blank" rel="noopener">CC2640R2F</a>å™¨ä»¶æ˜¯ä¸€æ¬¾æ— çº¿å¾®æ§åˆ¶å™¨<code>(MCU)</code>,ä¸»è¦é€‚ç”¨äº<code>BluetoothÂ® 4.2</code>å’Œ<code>Bluetooth 5</code>ä½åŠŸè€— åº”ç”¨.<a href="http://www.ti.com.cn/cn/lit/ds/symlink/cc2640r2f.pdf" target="_blank" rel="noopener"><strong>cc2640r2fæ•°æ®æ‰‹å†Œ</strong></a>.<br><img src="/imgs/ti/cc2640r2f_arch_block-diagram.jpeg" alt="cc2640r2f_arch_block-diagram.jpeg"></li>
<li>ä¸‹é¢ç¬”è®°æ˜¯å‚ç…§<code>simplelink_cc2640r2_sdk_1_50_00_58/docs/blestack/ble_user_guide</code>æ–‡æ¡£,éªŒè¯æ€»ç»“çš„.å»ºè®®æœ‰é—®é¢˜æŸ¥çœ‹å®˜æ–¹SDKå„ç§æ–‡æ¡£.</li>
</ul>
<h2 id="BLEè½¯ä»¶æ¶æ„"><a href="#BLEè½¯ä»¶æ¶æ„" class="headerlink" title="BLEè½¯ä»¶æ¶æ„"></a>BLEè½¯ä»¶æ¶æ„</h2><ul>
<li><code>CC2640R2</code>Fè“ç‰™è½¯ä»¶ç¯å¢ƒåŒ…å«ä¸¤ä¸ªéƒ¨åˆ†:APPåº”ç”¨ç¨‹åº,è“ç‰™åè®®æ ˆ.åº”ç”¨ç¨‹åºä¸­åŒ…å«<code>TI RTOS</code>å†…æ ¸,é©±åŠ¨,è“ç‰™Profieä¸‰éƒ¨.å®ƒä»¬ä¸¤éƒ¨åˆ†ä¹‹é—´æ¶ˆæ¯é€šä¿¡æ˜¯é€šè¿‡<code>ICall</code>æ¥å®ç°.</li>
<li>è“ç‰™æ ˆçš„SDKä¸­æœ‰æ˜¯<code>exe</code>çš„å®‰è£…åŒ…,å¦‚æœæ˜¯Linuxç³»ç»Ÿéœ€è¦ä»<code>exe</code>é‡Œå¤åˆ¶å‡ºæ¥ä½¿ç”¨,ä¹Ÿå¯ä»¥ä½¿ç”¨<a href="https://www.winehq.org" target="_blank" rel="noopener">WineHQ</a>æ¥å®‰è£…æœ¬ç”¨æˆ·ç›®å½•ä¸‹.<br><img src="/imgs/ti/cc2640r2f_app_icall_stack.jpeg" alt="cc2640r2f_app_icall_stack.jpeg"></li>
</ul>
<h1 id="å¼€ç®±æµ‹è¯•"><a href="#å¼€ç®±æµ‹è¯•" class="headerlink" title="å¼€ç®±æµ‹è¯•"></a>å¼€ç®±æµ‹è¯•</h1><h2 id="è“ç‰™ä¸»æœºæµ‹è¯•-Host-test"><a href="#è“ç‰™ä¸»æœºæµ‹è¯•-Host-test" class="headerlink" title="è“ç‰™ä¸»æœºæµ‹è¯•(Host_test)"></a>è“ç‰™ä¸»æœºæµ‹è¯•(Host_test)</h2><ul>
<li>Academyæ•™ç¨‹æ˜¯åœ¨<code>simplelink_academy_cc2640r2sdk_3_40_02_00/modules/projects/ble_hosttest/information.html</code></li>
</ul>
<h3 id="å¯¼å…¥å·¥ç¨‹"><a href="#å¯¼å…¥å·¥ç¨‹" class="headerlink" title="å¯¼å…¥å·¥ç¨‹"></a>å¯¼å…¥å·¥ç¨‹</h3><ul>
<li>ä»æœ¬åœ°<code>simplelink_cc2640r2_sdk_3_40_00_10</code>SDKé‡Œçš„<code>examples</code>å¯¼å…¥å·¥ç¨‹<code>examples/rtos/CC2640R2_LAUNCHXL/blestack/host_test/tirtos/host_test_cc2640r2lp_app</code>,å¯¼å…¥æˆåŠŸå.</li>
<li>ä¼šçœ‹åˆ°ä¸¤ä¸ªå·¥ç¨‹<code>host_test_cc2640r2lp_app</code>ä¸<code>host_test_cc2640r2lp_stack_library</code>,è¿™ä¸ª<code>_app</code>å·¥ç¨‹æ˜¯è¦ä¾èµ–<code>_stack_library</code>å·¥ç¨‹,æ‰€ä»¥åªç¼–è¯‘ä¸<code>Debug</code>è¿™ä¸ª<code>_app</code>å·¥ç¨‹æ—¶,å®ƒä¼šå…ˆå»è°ƒåŠ¨ç¼–è¯‘<code>_stack_library</code>å·¥ç¨‹,è¯¥å·¥ç¨‹ä¼šç”Ÿæˆä¸€ä¸ªåº“æ–‡ä»¶<code>_stack_library/FlashROM_Library/host_test_cc2640r2lp_stack_library.lib</code>å»ç»™åˆ°<code>_app</code>å·¥ç¨‹é“¾æ¥çš„,è¿™é‡Œä¸åƒæ˜¯ä¹‹å‰çš„ç‰ˆæœ¬æŠŠ<code>stack</code>ç¼–è¯‘æˆç‹¬ç«‹çš„<code>hex</code>æˆ–<code>bin</code>æ–‡ä»¶,è€Œæ˜¯åšä¸ºä¸€ä¸ªåº“å»ç»™<code>app</code>é“¾æ¥è°ƒç”¨.</li>
</ul>
<h3 id="ç¼–è¯‘å·¥ç¨‹"><a href="#ç¼–è¯‘å·¥ç¨‹" class="headerlink" title="ç¼–è¯‘å·¥ç¨‹"></a>ç¼–è¯‘å·¥ç¨‹</h3><ul>
<li>ç¼–è¯‘å·¥ç¨‹,å¦‚æœæƒ³çŸ¥é“<code>IDE</code>åœ¨ç¼–è¯‘å·¥ç¨‹æ—¶ç»†èŠ‚,å¯ä»¥è¿™æ ·æ“ä½œ,æŠŠ<code>Window--&gt;Preferences--&gt;Build--&gt;Console verbosity level</code>é€‰æ‹©<code>Verbose</code>.</li>
<li>ä¸‹é¢æ˜¯<code>_app</code>å·¥ç¨‹çš„ç¼–è¯‘ä¸é“¾æ¥ä»¥åŠæœ€ç»ˆç”Ÿæˆ<code>hex</code>æ–‡ä»¶çš„ç»†èŠ‚.æ³¨æ„<code>${SDK_DIR}</code>ä¸<code>${CCS_DIR}</code>,<code>${WORKSPACE}</code>æ˜¯æ›¿æ¢è¿‡çš„å®é™…ç»å¯¹è·¯å¾„çš„å˜é‡.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line">Finished building: <span class="string">"<span class="variable">$&#123;SDK_DIR&#125;</span>/simplelink_cc2640r2_sdk_3_40_00_10/source/ti/blestack/icall/app/icall_hci_tl.c"</span></span><br><span class="line"></span><br><span class="line">Building target: <span class="string">"host_test_cc2640r2lp_app.out"</span></span><br><span class="line">Invoking: ARM Linker</span><br><span class="line"><span class="string">"<span class="variable">$&#123;CCS_DIR&#125;</span>/ccs/tools/compiler/ti-cgt-arm_18.12.3.LTS/bin/armcl"</span></span><br><span class="line">--cmd_file=<span class="string">"<span class="variable">$&#123;SDK_DIR&#125;</span>/simplelink_cc2640r2_sdk_3_40_00_10/source/ti/blestack/config/build_components.opt"</span></span><br><span class="line">--cmd_file=<span class="string">"<span class="variable">$&#123;SDK_DIR&#125;</span>/simplelink_cc2640r2_sdk_3_40_00_10/source/ti/blestack/config/factory_config.opt"</span></span><br><span class="line">--cmd_file=<span class="string">"<span class="variable">$&#123;WORKSPACE&#125;</span>/host_test_cc2640r2lp_stack_library/TOOLS/build_config.opt"</span></span><br><span class="line">-mv7M3 --code_state=16 -me -O4 --opt_for_speed=0 --define=DeviceFamily_CC26X0R2</span><br><span class="line">--define=Display_DISABLE_ALL --define=CC2640R2_LAUNCHXL --define=CC26XX --define=CC26XX_R2 --define=ICALL_EVENTS</span><br><span class="line">--define=ICALL_JT --define=ICALL_LITE --define=ICALL_MAX_NUM_ENTITIES=6 --define=ICALL_MAX_NUM_TASKS=3</span><br><span class="line">--define=ICALL_STACK0_ADDR --define=MAX_NUM_BLE_CONNS=1 --define=MAX_PDU_SIZE=255 --define=NPI_USE_UART --define=xNPI_USE_SPI</span><br><span class="line">--define=NPI_SPI_CONFIG=Board_SPI0 --define=xPOWER_SAVING --define=STACK_LIBRARY --define=USE_ICALL --define=xdc_runtime_Assert_DISABLE_ALL --define=xdc_runtime_Log_DISABLE_ALL -g --c99 --gcc --diag_warning=225 --diag_wrap=off</span><br><span class="line">--display_error_number --gen_func_subsections=on --abi=eabi -z -m<span class="string">"host_test_cc2640r2lp_app.map"</span> --heap_size=0 --stack_size=256</span><br><span class="line">-i<span class="string">"<span class="variable">$&#123;CCS_DIR&#125;</span>/ccs/tools/compiler/ti-cgt-arm_18.12.3.LTS/lib"</span> -i<span class="string">"<span class="variable">$&#123;CCS_DIR&#125;</span>/ccs/tools/compiler/ti-cgt-arm_18.12.3.LTS/include"</span></span><br><span class="line">--reread_libs --define=CC26X0ROM=2 --diag_suppress=16002-D --diag_suppress=10247-D --diag_suppress=10325-D --diag_suppress=10229-D</span><br><span class="line">--diag_suppress=16032-D --diag_wrap=off --display_error_number --warn_sections</span><br><span class="line">--xml_link_info=<span class="string">"host_test_cc2640r2lp_app_linkInfo.xml"</span></span><br><span class="line">--rom_model -o <span class="string">"host_test_cc2640r2lp_app.out"</span> <span class="string">"./Application/host_test_app.obj"</span> <span class="string">"./Application/util.obj"</span> <span class="string">"./Drivers/ECC/ECCROMCC26XX.obj"</span> <span class="string">"./Drivers/RF/RFCC26XX_singleMode.obj"</span> <span class="string">"./Drivers/TRNG/TRNGCC26XX.obj"</span> <span class="string">"./ICall/icall.obj"</span> <span class="string">"./ICall/icall_cc2650.obj"</span> <span class="string">"./ICall/icall_user_config.obj"</span> <span class="string">"./ICallBLE/ble_user_config.obj"</span> <span class="string">"./ICallBLE/icall_api_lite.obj"</span> <span class="string">"./ICallBLE/icall_hci_tl.obj"</span></span><br><span class="line"><span class="string">"./NPI/Transport/SPI/npi_tl_spi.obj"</span> <span class="string">"./NPI/Transport/UART/npi_tl_uart.obj"</span> <span class="string">"./NPI/Transport/npi_tl.obj"</span> <span class="string">"./NPI/npi_frame_hci.obj"</span> <span class="string">"./NPI/npi_rxbuf.obj"</span> <span class="string">"./NPI/npi_task.obj"</span> <span class="string">"./PROFILES/devinfoservice.obj"</span> <span class="string">"./PROFILES/gatt_uuid.obj"</span> <span class="string">"./PROFILES/gattservapp_util.obj"</span> <span class="string">"./PROFILES/peripheral.obj"</span> <span class="string">"./PROFILES/simple_gatt_profile.obj"</span> <span class="string">"./Startup/board.obj"</span> <span class="string">"./Startup/ccfg_app_ble.obj"</span> <span class="string">"./Startup/main.obj"</span></span><br><span class="line">-l<span class="string">"configPkg/linker.cmd"</span> -l<span class="string">"<span class="variable">$&#123;SDK_DIR&#125;</span>/simplelink_cc2640r2_sdk_3_40_00_10/source/ti/devices/cc26x0r2/driverlib/bin/ccs/driverlib.lib"</span></span><br><span class="line">-l<span class="string">"<span class="variable">$&#123;SDK_DIR&#125;</span>/simplelink_cc2640r2_sdk_3_40_00_10/kernel/tirtos/packages/ti/dpl/lib/dpl_cc26x0r2.aem3"</span></span><br><span class="line">-l<span class="string">"<span class="variable">$&#123;SDK_DIR&#125;</span>/simplelink_cc2640r2_sdk_3_40_00_10/source/ti/drivers/lib/drivers_cc26x0r2.aem3"</span></span><br><span class="line">-l<span class="string">"<span class="variable">$&#123;SDK_DIR&#125;</span>/simplelink_cc2640r2_sdk_3_40_00_10/source/ti/display/lib/display.aem3"</span></span><br><span class="line">-l<span class="string">"<span class="variable">$&#123;SDK_DIR&#125;</span>/simplelink_cc2640r2_sdk_3_40_00_10/source/ti/grlib/lib/ccs/m3/grlib.a"</span></span><br><span class="line">-l<span class="string">"<span class="variable">$&#123;WORKSPACE&#125;</span>/host_test_cc2640r2lp_stack_library/FlashROM_Library/ble_r2.symbols"</span></span><br><span class="line">-l<span class="string">"<span class="variable">$&#123;WORKSPACE&#125;</span>/host_test_cc2640r2lp_stack_library/FlashROM_Library/lib_linker.cmd"</span></span><br><span class="line">-l<span class="string">"<span class="variable">$&#123;WORKSPACE&#125;</span>/host_test_cc2640r2lp_stack_library/FlashROM_Library/host_test_cc2640r2lp_stack_library.lib"</span></span><br><span class="line">-l<span class="string">"<span class="variable">$&#123;SDK_DIR&#125;</span>/simplelink_cc2640r2_sdk_3_40_00_10/source/ti/blestack/common/cc26xx/ccs/cc26xx_app.cmd"</span> -llibc.a</span><br><span class="line">&lt;Linking&gt;</span><br><span class="line">Finished building target: <span class="string">"host_test_cc2640r2lp_app.out"</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$&#123;CCS_DIR&#125;</span>/ccs/tools/compiler/ti-cgt-arm_18.12.3.LTS/bin/armhex -order MS --memwidth=8 --romwidth=8 --intel</span><br><span class="line">-o host_test_cc2640r2lp_app.hex host_test_cc2640r2lp_app.out</span><br><span class="line">Translating to Intel format...</span><br><span class="line">   <span class="string">"host_test_cc2640r2lp_app.out"</span> .resetVecs ==&gt; .resetVecs</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<ul>
<li><p>è¿æ¥<code>TI-CC2640R2-LaunchPad</code>æ¿å­,æŸ¥çœ‹æ¿å­ä¸Šçš„<code>XDS110</code>ä¸²å·.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$ ti/ccs920/ccs/ccs_base/common/uscif/xds110/xdsdfu -e</span><br><span class="line"></span><br><span class="line">USB Device Firmware Upgrade Utility</span><br><span class="line">Copyright (c) 2008-2019 Texas Instruments Incorporated.  All rights reserved.</span><br><span class="line">Scanning USB buses <span class="keyword">for</span> supported XDS110 devices...</span><br><span class="line">&lt;&lt;&lt;&lt; Device 0 &gt;&gt;&gt;&gt;</span><br><span class="line"></span><br><span class="line">VID: 0x0451    PID: 0xbef3</span><br><span class="line">Device Name:   XDS110 Embed with CMSIS-DAP</span><br><span class="line">Version:       3.0.0.11</span><br><span class="line">Manufacturer:  Texas Instruments</span><br><span class="line">Serial Num:    L50012VN</span><br><span class="line">Mode:          Runtime</span><br><span class="line">Configuration: Standard</span><br><span class="line"></span><br><span class="line">Found 1 device.</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹<code>host_test_cc2640r2lp_app</code>å·¥ç¨‹æ–‡ä»¶çš„<code>targetConfigs/CC2640R2F.ccxml</code>,æ‰“å¼€åä¼šæ˜¾ç¤º<code>Basic</code>ç•Œé¢å¦‚ä¸‹å›¾:<br><img src="/imgs/ti/cc2640_debugger_connection.png" alt="cc2640_debugger_connection"><br><img src="/imgs/ti/cc2640_debugger_connection_serial.png" alt="cc2640_debugger_connection_serial"></p>
</li>
<li>æŠŠä¸²å·<code>L50012VN</code>å†™å…¥ä¸Šå›¾çš„<code>Enter the serial number</code>æ ä¸­,å¹¶ä¿å­˜.ç°åœ¨å¯ä»¥è°ƒè¯•æˆ–åŠ è½½<code>host_test_cc2640r2lp_app</code>å·¥ç¨‹åˆ°<code>TI-CC2640R2-LaunchPad</code>æ¿å­.</li>
</ul>
<h3 id="BToolæµ‹è¯•"><a href="#BToolæµ‹è¯•" class="headerlink" title="BToolæµ‹è¯•"></a>BToolæµ‹è¯•</h3><ul>
<li><code>BTool</code>æ˜¯ä¸€ä¸ªPCå·¥å…·,å¯ä»¥å•ç‹¬ä¸‹è½½,<code>SimpleLink SDK</code>é‡Œå¸¦æœ‰æœ€æ–°ç‰ˆæœ¬,å®ƒåœ¨<code>${SIMPLELINK_CORE_SDK_INSTALL_DIR}/simplelink_cc2640r2_sdk_1_50_00_58/tools/blestack/btool</code>.</li>
<li><p>å®ƒçš„ä½¿ç”¨è¯´æ˜åœ¨<code>${SIMPLELINK_CORE_SDK_INSTALL_DIR}/simplelink_cc2640r2_sdk_3_40_00_10/docs/ble5stack/btool_user_guide/BTool_Users_Guide/index.html</code>.</p>
</li>
<li><p>åœ¨Linuxä¸‹ä½¿ç”¨<code>btool.exe</code>éœ€è¦å®‰è£…<code>mono</code>æ”¯æŒ.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo apt-get install mono -y</span><br><span class="line">~$ <span class="built_in">cd</span> simplelink_cc2640r2_sdk_1_50_00_58/tools/blestack/</span><br><span class="line">~$ mono btool.exe</span><br></pre></td></tr></table></figure>
</li>
<li><p>Serial Bootloader (SBL)ä¸²å£å¯åŠ¨,Over-the-Air Download(OAD)ç©ºä¸­ä¸‹è½½.</p>
</li>
</ul>
<h1 id="Bootloader"><a href="#Bootloader" class="headerlink" title="Bootloader"></a>Bootloader</h1><ul>
<li>å‚ç…§å®˜æ–¹æ–‡æ¡£ã€ŠCC13x0, CC26x0 SimpleLinkTM Wireless MCU Technical Reference Manual.pdfã€‹ç¬¬8ç« æè¿°,<a href="http://www.ti.com/lit/ug/swcu117h/swcu117h.pdf" target="_blank" rel="noopener">swcu117h.pdf</a>,<code>ROM bootlaoder</code>ä¸»è¦åŠŸèƒ½æ˜¯ä¸ºäº†ä¸‹è½½å›ºä»¶çš„,ä¹Ÿå¯ä»¥é€šè¿‡å®ƒè¯»å–å›ºä»¶.å®‰å…¨èµ·è§å¯ä»¥å…³é—­<code>Bootloader</code>åŠŸèƒ½,ä¹Ÿå¯ä»¥è®¾ç½®â€åé—¨(8.1.2 Bootloader Backdoor)â€.ä¸<code>bootloader</code>çš„é€šä¿¡æ¥å£å¯ä»¥æ˜¯<code>2-pin UART</code>ä¸<code>SSI</code>.</li>
</ul>
<h2 id="åå‘å·¥ç¨‹"><a href="#åå‘å·¥ç¨‹" class="headerlink" title="åå‘å·¥ç¨‹"></a>åå‘å·¥ç¨‹</h2><ul>
<li><a href="https://leveldown.de/blog/svd-loader/" target="_blank" rel="noopener">SVD-Loader for Ghidra: Simplifying bare-metal ARM reverse engineering</a></li>
<li><p><a href="https://github.com/leveldown-security/SVD-Loader-Ghidra" target="_blank" rel="noopener">SVD-Loader-Ghidra</a></p>
<h3 id="dump-ROM"><a href="#dump-ROM" class="headerlink" title="dump ROM"></a>dump ROM</h3></li>
<li><p>åˆ é™¤flashå†…å­˜</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> ti/uniflash_7.1.0$ ./dslite.sh --mode cc13xx-cc26xx-mass-erase -d XDS110</span><br><span class="line">Executing the following <span class="built_in">command</span>:</span><br><span class="line">&gt; /fullpath/ti/uniflash_7.1.0/deskdb/content/TICloudAgent/linux/ccs_base/DebugServer/bin/DSLite cc13xx-cc26xx-mass-erase -d XDS110</span><br><span class="line"></span><br><span class="line">For more details and examples, please refer to the UniFlash Quick Start guide.</span><br><span class="line"></span><br><span class="line">Cortex_M3_0: GEL Output: Memory Map Initialization Complete.</span><br><span class="line">Performing Device Unlock via Mass Erase...</span><br><span class="line">Cortex_M3_0: MassErase(): Initializing.</span><br><span class="line">Cortex_M3_0: MassErase(): Issuing Board Reset.</span><br><span class="line">Cortex_M3_0: MassErase(): Mass erase complete.</span><br><span class="line">Device Unlocked</span><br></pre></td></tr></table></figure>
<h2 id="å®‰è£…GHIDRA"><a href="#å®‰è£…GHIDRA" class="headerlink" title="å®‰è£…GHIDRA"></a>å®‰è£…<code>GHIDRA</code></h2><ul>
<li><a href="https://github.com/NationalSecurityAgency/ghidra" target="_blank" rel="noopener">NationalSecurityAgency/ghidra</a></li>
<li><a href="https://adoptium.net/releases.html?variant=openjdk11&amp;jvmVariant=hotspot" target="_blank" rel="noopener">JDK 11 64-bit</a></li>
<li><p><a href="Gradle 6.8+ or 7.x">Gradle 6.8+ or 7.x</a></p>
</li>
<li><p>è¿™é‡Œæ˜¯ä»å®ƒçš„æºç å»ç¼–è¯‘çš„ï¼Œéœ€è¦<code>JDK 11</code>çš„æ”¯æŒ.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">export</span> JAVA_HOME=~/IDE_DIR/jdk-11.0.14.1+1/</span><br><span class="line">~$ <span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line">~$ sdk install gradle 7.4.1</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/NationalSecurityAgency/ghidra.git</span><br><span class="line">~$ <span class="built_in">cd</span> ghidra</span><br><span class="line">~$ gradle -I gradle/support/fetchDependencies.gradle init</span><br></pre></td></tr></table></figure>
<h2 id="å®‰è£…SVDæ’ä»¶"><a href="#å®‰è£…SVDæ’ä»¶" class="headerlink" title="å®‰è£…SVDæ’ä»¶"></a>å®‰è£…<code>SVD</code>æ’ä»¶</h2><ul>
<li>å…‹éš†<a href="https://github.com/leveldown-security/SVD-Loader-Ghidra" target="_blank" rel="noopener">https://github.com/leveldown-security/SVD-Loader-Ghidra</a>åˆ°<code>$USER_HOME/ghidra_scripts</code>ç›®å½•ä¸‹ã€‚æˆ–è€…æ”¾åˆ°å®‰è£…ç›®å½•çš„<code>$GHIDRA_HOME/Ghidra/Features</code>ç›®å½•ä¸‹éƒ½å¯ä»¥ã€‚æˆ–è€…æ‰“å¼€<code>Windows-&gt; Script Manager -&gt; Manage Script directories</code>çš„èœå•é¡¹,é è¿‘å³ä¸Šè§’å…³é—­æŒ‰é’®çš„ä½ç½®ã€‚æ‰“å¼€è„šæœ¬æ‰«æè·¯å¾„çš„åˆ—è¡¨ï¼Œæ·»åŠ ä¸€ä¸ªç›®å½•è·¯å¾„ï¼Œé€‰æ‹©<code>SVD-Loader-Ghidra</code>æ‰€åœ¨ä½ç½®ï¼Œå†åˆ·æ–°æ‰€æœ‰çš„è„šæœ¬åˆ—è¡¨. å°±ä¼šåœ¨å·¦è¾¹æ é‡Œï¼Œå¤šäº†ä¸€è¡Œ<code>leveldown security</code>çš„ç›®å½•ã€‚</li>
</ul>
<h1 id="è®¾å¤‡é…ç½®"><a href="#è®¾å¤‡é…ç½®" class="headerlink" title="è®¾å¤‡é…ç½®"></a>è®¾å¤‡é…ç½®</h1><h2 id="å‚å®¶é…ç½®-Factory-Configuration-FCFG"><a href="#å‚å®¶é…ç½®-Factory-Configuration-FCFG" class="headerlink" title="å‚å®¶é…ç½® Factory Configuration(FCFG)"></a>å‚å®¶é…ç½® Factory Configuration(FCFG)</h2><h2 id="ç”¨æˆ·é…ç½®-Customer-Configuration-CCFG"><a href="#ç”¨æˆ·é…ç½®-Customer-Configuration-CCFG" class="headerlink" title="ç”¨æˆ·é…ç½® Customer Configuration(CCFG)"></a>ç”¨æˆ·é…ç½® Customer Configuration(CCFG)</h2><ul>
<li><code>CCFG</code>ç‰‡åŒºæ˜¯åœ¨<code>FLASH</code>çš„å°¾éƒ¨(0x1fff=128*1024)å®ƒæ˜¯ç”¨æ¥è®¾ç½®ç¡¬ä»¶åŠŸèƒ½çš„,è€Œä¸”æ˜¯ä¸é©±åŠ¨ç¨‹åºç‰ˆæœ¬æ˜¯ç›¸å…³è”çš„,<code>CCFG</code>çš„ä¿®æ”¹å¿…éœ€ä¸ç›¸åº”é©±åŠ¨ç¨‹åºä¸€è‡´.å…·ä½“è¯¦æƒ…å¯ä»¥æŸ¥çœ‹SDKé‡Œçš„ç¤ºä¾‹å·¥ç¨‹æºç .</li>
<li>å¦‚:<code>simplelink_cc2640r2_sdk_3_40_00_10/examples/rtos/CC2640R2_LAUNCHXL/ble5stack/host_test/src/ccfg_app_blc.c</code>.å®ƒæ˜¯åŒ…å«ä¸€ä¸ªè®¾å¤‡å¯åŠ¨æ–‡ä»¶<code>simplelink_cc2640r2_sdk_3_40_00_10/source/ti/devices/cc26x0r2/startup_files/ccfg.c</code>.</li>
<li>çœ‹æ–‡ä»¶å†…çš„æè¿°,æ˜¯é€šè¿‡å®æŠŠè¿™äº›å®šä¹‰ä½(bit)å€¼æ‹¼æ¥æˆå­—èŠ‚,å†é™„åŠ åˆ°<code>FLASH</code>çš„å°¾ç«¯,å®˜æ–¹å»ºè®®å¦‚æœè¦ä¿®æ”¹å‚æ•°,è‚¯å®šæ˜¯ä¸è¦å»æ”¹åŠ¨åŸSDKå†…çš„æ–‡ä»¶,å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæ–‡ä»¶å¦‚<customer_ccfg.c>:è¦†ç›–åŸæ¥çš„å‚æ•°å€¼å¦‚:</customer_ccfg.c></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define SET_CCFG_BL_CONFIG_BOOTLOADER_ENABLE  0xC5 // Enable ROM boot loader</span></span><br><span class="line"><span class="comment">#define SET_CCFG_MODE_CONF_SCLK_LF_OPTION     0x3  // LF RCOSC</span></span><br><span class="line">//---- Use default values <span class="keyword">for</span> all others ----</span><br><span class="line"><span class="comment">#include "&lt;project-path&gt;/source/ti/devices/&lt;device&gt;/startup_files/ccfg.c"</span></span><br></pre></td></tr></table></figure>
<h1 id="OADä¸‹è½½"><a href="#OADä¸‹è½½" class="headerlink" title="OADä¸‹è½½"></a>OADä¸‹è½½</h1><p><a href="file:///home/michael/3TB-DISK/Embedded-System/TIREX/simplelink_cc2640r2_sdk_1_50_00_58/docs/blestack/ble_user_guide/html/cc2640/architecture.html#hardware-and-software-architecture" target="_blank" rel="noopener">è¿›åº¦</a></p>
<h1 id="è°¢è°¢æ”¯æŒ"><a href="#è°¢è°¢æ”¯æŒ" class="headerlink" title="è°¢è°¢æ”¯æŒ"></a>è°¢è°¢æ”¯æŒ</h1><ul>
<li>å¾®ä¿¡äºŒç»´ç :</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yjdwbj"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">yjdwbj</p>
  <div class="site-description" itemprop="description">æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">52</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">åˆ†ç±»</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yjdwbj</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="机器学习框架介绍 Keras vs PyTorch：谁是「第一」深度学习框架？  CUDANVIDIA CUDA Toolkit Release NotesLinux 安装指导 ##　本机系统 123456789101112131415161718192021222324~$ nvidia-debugdump -lFound 1 NVIDIA devices	Device ID:">
<meta name="keywords" content="Cuda,Linux,ML,Nvidia">
<meta property="og:type" content="article">
<meta property="og:title" content="机器学习(ML)环境的搭建">
<meta property="og:url" content="http://yoursite.com/2021/01/13/机器学习-ML-环境的搭建/index.html">
<meta property="og:site_name" content="Sunrise 博客">
<meta property="og:description" content="机器学习框架介绍 Keras vs PyTorch：谁是「第一」深度学习框架？  CUDANVIDIA CUDA Toolkit Release NotesLinux 安装指导 ##　本机系统 123456789101112131415161718192021222324~$ nvidia-debugdump -lFound 1 NVIDIA devices	Device ID:">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/imgs/mm_reward_qrcode_1525013906055.png">
<meta property="og:updated_time" content="2021-12-14T08:41:33.122Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="机器学习(ML)环境的搭建">
<meta name="twitter:description" content="机器学习框架介绍 Keras vs PyTorch：谁是「第一」深度学习框架？  CUDANVIDIA CUDA Toolkit Release NotesLinux 安装指导 ##　本机系统 123456789101112131415161718192021222324~$ nvidia-debugdump -lFound 1 NVIDIA devices	Device ID:">
<meta name="twitter:image" content="http://yoursite.com/imgs/mm_reward_qrcode_1525013906055.png">

<link rel="canonical" href="http://yoursite.com/2021/01/13/机器学习-ML-环境的搭建/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>机器学习(ML)环境的搭建 | Sunrise 博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sunrise 博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/13/机器学习-ML-环境的搭建/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="最是人间留不住,朱颜辞镜花辞树">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          机器学习(ML)环境的搭建
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-13 19:11:23" itemprop="dateCreated datePublished" datetime="2021-01-13T19:11:23+08:00">2021-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-14 16:41:33" itemprop="dateModified" datetime="2021-12-14T16:41:33+08:00">2021-12-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="机器学习框架介绍"><a href="#机器学习框架介绍" class="headerlink" title="机器学习框架介绍"></a>机器学习框架介绍</h1><ul>
<li><a href="https://www.jiqizhixin.com/articles/keras-or-pytorch" target="_blank" rel="noopener">Keras vs PyTorch：谁是「第一」深度学习框架？</a></li>
</ul>
<h1 id="CUDA"><a href="#CUDA" class="headerlink" title="CUDA"></a>CUDA</h1><p><a href="https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html" target="_blank" rel="noopener">NVIDIA CUDA Toolkit Release Notes</a><br><a href="https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html" target="_blank" rel="noopener">Linux 安装指导</a></p>
<p>##　本机系统</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">~$ nvidia-debugdump -l</span><br><span class="line">Found 1 NVIDIA devices</span><br><span class="line">	Device ID:              0</span><br><span class="line">	Device name:            Quadro P600   (*PrimaryCard)</span><br><span class="line">	GPU internal ID:        0422018092726</span><br><span class="line"></span><br><span class="line">~$ cat /etc/*release</span><br><span class="line">PRETTY_NAME=<span class="string">"Debian GNU/Linux 9 (stretch)"</span></span><br><span class="line">NAME=<span class="string">"Debian GNU/Linux"</span></span><br><span class="line">VERSION_ID=<span class="string">"9"</span></span><br><span class="line">VERSION=<span class="string">"9 (stretch)"</span></span><br><span class="line">ID=debian</span><br><span class="line">HOME_URL=<span class="string">"https://www.debian.org/"</span></span><br><span class="line">SUPPORT_URL=<span class="string">"https://www.debian.org/support"</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">"https://bugs.debian.org/"</span></span><br><span class="line"></span><br><span class="line">~$ gcc -v</span><br><span class="line">Using built-in specs.</span><br><span class="line">COLLECT_GCC=gcc</span><br><span class="line">COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/6/lto-wrapper</span><br><span class="line">Target: x86_64-linux-gnu</span><br><span class="line">Configured with: ../src/configure -v --with-pkgversion=<span class="string">'Debian 6.3.0-18+deb9u1'</span> --with-bugurl=file:///usr/share/doc/gcc-6/README.Bugs --<span class="built_in">enable</span>-languages=c,ada,c++,java,go,d,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-6 --program-prefix=x86_64-linux-gnu- --<span class="built_in">enable</span>-shared --<span class="built_in">enable</span>-linker-build-id --libexecdir=/usr/lib --without-included-gettext --<span class="built_in">enable</span>-threads=posix --libdir=/usr/lib --<span class="built_in">enable</span>-nls --with-sysroot=/ --<span class="built_in">enable</span>-clocale=gnu --<span class="built_in">enable</span>-libstdcxx-debug --<span class="built_in">enable</span>-libstdcxx-time=yes --with-default-libstdcxx-abi=new --<span class="built_in">enable</span>-gnu-unique-object --<span class="built_in">disable</span>-vtable-verify --<span class="built_in">enable</span>-libmpx --<span class="built_in">enable</span>-plugin --<span class="built_in">enable</span>-default-pie --with-system-zlib --<span class="built_in">disable</span>-browser-plugin --<span class="built_in">enable</span>-java-awt=gtk --<span class="built_in">enable</span>-gtk-cairo --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-6-amd64/jre --<span class="built_in">enable</span>-java-home --with-jvm-root-dir=/usr/lib/jvm/java-1.5.0-gcj-6-amd64 --with-jvm-jar-dir=/usr/lib/jvm-exports/java-1.5.0-gcj-6-amd64 --with-arch-directory=amd64 --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --with-target-system-zlib --<span class="built_in">enable</span>-objc-gc=auto --<span class="built_in">enable</span>-multiarch --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --<span class="built_in">enable</span>-multilib --with-tune=generic --<span class="built_in">enable</span>-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu</span><br><span class="line">Thread model: posix</span><br><span class="line">gcc version 6.3.0 20170516 (Debian 6.3.0-18+deb9u1)</span><br></pre></td></tr></table></figure>
<h2 id="安装CUDA"><a href="#安装CUDA" class="headerlink" title="安装CUDA"></a>安装<code>CUDA</code></h2><ul>
<li>根据它官方的指导选择安装适合版本.</li>
</ul>
<p>Table 1. CUDA Toolkit and Compatible Driver Versions<br>|CUDA Toolkit 　| Linux x86_64 Driver Version |　 Windows x86_64 Driver Version|<br>|:–:|:—:|:—-:|<br>CUDA 10.0.130 |&gt;= 410.48 |&gt;= 411.31|<br>CUDA 9.2 (9.2.148 Update 1) |&gt;= 396.37| &gt;= 398.26|<br>CUDA 9.2 (9.2.88) |&gt;= 396.26 |&gt;= 397.44|<br>CUDA 9.1 (9.1.85) |&gt;= 390.46 |&gt;= 391.29|<br>CUDA 9.0 (9.0.76) |&gt;= 384.81 |&gt;= 385.54|<br>CUDA 8.0 (8.0.61 GA2) |&gt;= 375.26 |&gt;= 376.51|<br>CUDA 8.0 (8.0.44) |&gt;= 367.48 |&gt;= 369.30|<br>CUDA 7.5 (7.5.16) |&gt;= 352.31 |&gt;= 353.66|<br>CUDA 7.0 (7.0.28) |&gt;= 346.46 |&gt;= 347.62|</p>
<ul>
<li>下载最低要求版本的<code>Nvidia</code>官方驱动.<a href="http://cn.download.nvidia.com/XFree86/Linux-x86_64/410.78/NVIDIA-Linux-x86_64-410.78.run" target="_blank" rel="noopener">NVIDIA-Linux-x86_64-410.78.run</a></li>
<li>卸载系统原来安装的驱动.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ dpkg -l | grep <span class="string">"nvidia"</span> | awk <span class="string">'&#123;print $2&#125;'</span> | xargs sudo dpkg --purge</span><br></pre></td></tr></table></figure>
<ul>
<li>下载最新版本的<code>CUDA</code>工具包.<a href="https://developer.download.nvidia.com/compute/cuda/10.0/secure/Prod/local_installers/cuda_10.0.130_410.48_linux.run?j0ZWXA-WVRqKfUBpEbr_PoKcZMFC4A_GF2tVIqikkd86eHzZ7a6JMzSLMW7QDNY4c31aZNCz4r8xr-mAll_HXTNTv38nBKeSXPfDWh5Om9TUQxeGn5-DUMWuLPBVyN7owCuzkqIg0cEj7Qy-ak6V4EVjQcTqJSQnvz46pMIwCCFkWjWldDkmBaY4ym4" target="_blank" rel="noopener">cuda_10.0.130_410.48_linux.run</a>,或者安装<a href="https://developer.download.nvidia.com/compute/cuda/10.0/secure/Prod/local_installers/cuda-repo-ubuntu1804-10-0-local-10.0.130-410.48_1.0-1_amd64.deb?t5lvzn9mOt6TXU8k0EIHIpxsvPxTl625K5sYSjGJR1xuhM9RXs2_xKvLXCne1-HL94FvndxavqoSL-e1OB6SJKTSU0XuOinK9LkzgPDpRUm_u0Sz5-snuL6iOowDYqlj8Zjhia80gBKO2HZtszRN5XUZtaZdJ3Yfdix-0oEFbeTMX6kSoZ54Bx2ou8D7f3UehVwqJHHF9v_x4Qj1uzl736rLOpFCMDeqP97wvXw" target="_blank" rel="noopener">cuda-repo-ubuntu1804-10-0-local-10.0.130-410.48_1.0-1_amd64.deb</a></li>
<li>安装步骤,先安装显卡驱动,再安装<code>NVIDIA CUDA Toolkit</code>,如果是安装<code>cuda_10.0.130_410.48_linux.run</code>,安装过程中注意交互选项.</li>
</ul>
<ul>
<li>测试安装</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">~$ nvidia-smi</span><br><span class="line">Fri Nov 23 11:00:29 2018</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 410.48                 Driver Version: 410.48                    |</span><br><span class="line">|-------------------------------+----------------------+----------------------+</span><br><span class="line">| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|===============================+======================+======================|</span><br><span class="line">|   0  Quadro P600         Off  | 00000000:01:00.0  On |                  N/A |</span><br><span class="line">| 34%   31C    P8    N/A /  N/A |    401MiB /  1999MiB |      4%      Default |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line"></span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| Processes:                                                       GPU Memory |</span><br><span class="line">|  GPU       PID   Type   Process name                             Usage      |</span><br><span class="line">|=============================================================================|</span><br><span class="line">|    0       898      G   /usr/lib/xorg/Xorg                           156MiB |</span><br><span class="line">|    0     13787      G   ...uest-channel-token=15869920746181936845    96MiB |</span><br><span class="line">|    0     16550      G   ...-token=D890EF91A7BB8E03F6D8D7795CC12E48   145MiB |</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<ul>
<li>安装相应版本的<code>cuDNN</code>库,<a href="https://developer.download.nvidia.com/compute/machine-learning/cudnn/secure/v7.4.1.5/prod/10.0_20181108/cudnn-10.0-linux-x64-v7.4.1.5.tgz?yy5bIMR_T6teT802n-6Q1N7XOLT_IUZSyGPnOriJWgNToZqQHrWJ7icJRMWzM-t-i6cstubN8zgjNM47iWexqg5a_g58BNZCwtYCjOBybcDzssG0sBpYF-yDeadCmHy6dFaYLSyj-7aVJBFYNRqHm-9UAP03TsBDCBH7xdztNFZOYLmHVIw271t5fTy1yYDTtCSf8Qs32lbYoNNaJnaXPe8p" target="_blank" rel="noopener">cudnn-10.0-linux-x64-v7.4.1.5.tgz</a></li>
</ul>
<ul>
<li>安装相应版本的<a href="https://developer.nvidia.com/nccl" target="_blank" rel="noopener"><code>NCCL</code></a>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ tar xvf cudnn-10.0-linux-x64-v7.4.1.5.tgz -C /usr/<span class="built_in">local</span></span><br></pre></td></tr></table></figure>
<h2 id="Debian-Buster下安装Nvidia-tesla驱动"><a href="#Debian-Buster下安装Nvidia-tesla驱动" class="headerlink" title="Debian Buster下安装Nvidia-tesla驱动"></a>Debian Buster下安装<code>Nvidia-tesla</code>驱动</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">~$ apt-get install nvidia-tesla-460-kernel-dkms nvidia-tesla-460-driver libnvidia-tesla-460-cuda1</span><br><span class="line">~$ nvidia-smi</span><br><span class="line">Sat Mar 27 21:01:55 2021</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 460.32.03    Driver Version: 460.32.03    CUDA Version: 11.2     |</span><br><span class="line">|-------------------------------+----------------------+----------------------+</span><br><span class="line">| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|                               |                      |               MIG M. |</span><br><span class="line">|===============================+======================+======================|</span><br><span class="line">|   0  GeForce GT 1030     On   | 00000000:05:00.0  On |                  N/A |</span><br><span class="line">| N/A   38C    P5    N/A /  30W |    449MiB /  2000MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N/A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line"></span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| Processes:                                                                  |</span><br><span class="line">|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |</span><br><span class="line">|        ID   ID                                                   Usage      |</span><br><span class="line">|=============================================================================|</span><br><span class="line">|    0   N/A  N/A      3365      G   /usr/lib/xorg/Xorg                326MiB |</span><br><span class="line">|    0   N/A  N/A     10847      G   ...AAAAAAAAA= --shared-files       22MiB |</span><br><span class="line">|    0   N/A  N/A     15542      G   ...chael/firefox/firefox-bin        0MiB |</span><br><span class="line">|    0   N/A  N/A     16429      G   ...AAAAAAAA== --shared-files       97MiB |</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="安装-PyCuda"><a href="#安装-PyCuda" class="headerlink" title="安装 PyCuda"></a>安装 PyCuda</h2><ul>
<li><a href="https://codeyarns.com/2015/07/31/pip-install-error-with-pycuda/" target="_blank" rel="noopener">Pip install error with PyCUDA</a><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/cuda-10.0/bin:<span class="variable">$PATH</span></span><br><span class="line">~$ pip install pycuda</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Nvidia-Docker安装"><a href="#Nvidia-Docker安装" class="headerlink" title="Nvidia Docker安装"></a><code>Nvidia Docker</code>安装</h2><p><a href="https://github.com/NVIDIA/nvidia-docker" target="_blank" rel="noopener">nvidia-docker</a></p>
<ul>
<li>这里按照上面链接的文档安装如下.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If you have nvidia-docker 1.0 installed: we need to remove it and all existing GPU containers</span></span><br><span class="line">docker volume ls -q -f driver=nvidia-docker | xargs -r -I&#123;&#125; -n1 docker ps -q -a -f volume=&#123;&#125; | xargs -r docker rm -f</span><br><span class="line">sudo apt-get purge -y nvidia-docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add the package repositories</span></span><br><span class="line">curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | \</span><br><span class="line">  sudo apt-key add -</span><br><span class="line">distribution=$(. /etc/os-release;<span class="built_in">echo</span> <span class="variable">$ID</span><span class="variable">$VERSION_ID</span>)</span><br><span class="line">curl -s -L https://nvidia.github.io/nvidia-docker/<span class="variable">$distribution</span>/nvidia-docker.list | \</span><br><span class="line">  sudo tee /etc/apt/sources.list.d/nvidia-docker.list</span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install nvidia-docker2 and reload the Docker daemon configuration</span></span><br><span class="line">sudo apt-get install -y nvidia-docker2</span><br><span class="line">sudo pkill -SIGHUP dockerd <span class="comment">#　如果之前有安装过Docker,这一步很重要,停掉之前的进程.</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="用Docker安装Tensorflow-GPU"><a href="#用Docker安装Tensorflow-GPU" class="headerlink" title="用Docker安装Tensorflow GPU"></a>用<code>Docker</code>安装<code>Tensorflow GPU</code></h3><ul>
<li><a href="https://www.tensorflow.org/install/gpu" target="_blank" rel="noopener">TensorFlow gpu</a></li>
<li><a href="https://github.com/nlintz/TensorFlow-Tutorials" target="_blank" rel="noopener">TensorFlow-Tutorials</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ docker pull tensorflow/tensorflow:latest-gpu \</span><br><span class="line">~$ nvidia-docker run -it --rm tensorflow/tensorflow:latest-gpu    python -c <span class="string">"import tensorflow as tf; tf.enable_eager_execution(); print(tf.reduce_sum(tf.random_normal([1000, 1000])))"</span></span><br><span class="line">2018-11-23 03:45:33.118841: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA</span><br><span class="line">2018-11-23 03:45:33.196995: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:964] successful NUMA node <span class="built_in">read</span> from SysFS had negative value (-1), but there must be at least one NUMA node,so returning NUMA node zero</span><br><span class="line">2018-11-23 03:45:33.197568: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1432] Found device 0 with properties:</span><br><span class="line">name: Quadro P600 major: 6 minor: 1 memoryClockRate(GHz): 1.5565</span><br><span class="line">pciBusID: 0000:01:00.0</span><br><span class="line">totalMemory: 1.95GiB freeMemory: 1.57GiB</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<h2 id="Nvidia-GPU-CLOUD容器云"><a href="#Nvidia-GPU-CLOUD容器云" class="headerlink" title="Nvidia GPU CLOUD容器云"></a><code>Nvidia GPU CLOUD</code>容器云</h2><h3 id="安装与运行Caffe2容器"><a href="#安装与运行Caffe2容器" class="headerlink" title="安装与运行Caffe2容器,"></a>安装与运行<code>Caffe2</code>容器,</h3><ul>
<li><a href="https://caffe2.ai/docs/getting-started.html?platform=ubuntu&amp;configuration=docker" target="_blank" rel="noopener">从 caffe2.ai 安装指南</a>,</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ docker run --runtime=nvidia -it caffe2ai/caffe2:latest python -m caffe2.python.operator_test.relu_op_test</span><br><span class="line">Trying example: test_relu(self=&lt;__main__.TestRelu testMethod=test_relu&gt;, X=array([[[-0.42894608],</span><br><span class="line">        [-0.65820682],</span><br><span class="line">        [ 0.39978197],</span><br><span class="line">		[...]</span><br></pre></td></tr></table></figure>
<ul>
<li><p><a href="https://ngc.nvidia.com/catalog/containers/nvidia%2Fcaffe2" target="_blank" rel="noopener">从 Nvidia GPU CLOUD (NGC) 上安装</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ docker pull nvcr.io/nvidia/caffe2:18.08-py3</span><br><span class="line"><span class="comment"># 运行测试.</span></span><br><span class="line">~$ nvidia-docker run --runtime=nvidia -it nvcr.io/nvidia/caffe2:18.08-py3  python -m caffe2.python.operator_test.relu_op_test</span><br></pre></td></tr></table></figure>
</li>
<li><p>下面在<code>Docker</code>里运行<code>jupyter notebook</code>的实例,把它在<code>docker</code>里的<strong>8888</strong>端口映射到宿主机的<strong>9999</strong>端口,通过宿主机的浏览器,输入<code>http://127.0.0.1:9999/</code>可以访问到它.</p>
</li>
<li><code>--rm</code> 当容器关闭后删除它</li>
<li><code>--it</code> 以交互模式运行</li>
<li><code>-v</code>　映射宿主机的目录到容器里.如上文就是把宿主机的<code>/data/AI-DIR/TensorFlow/jupyter-notebook</code>,映射到容器里的<code>/data/jupyter</code>目录.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ nvidia-docker run --rm  --shm-size=1g --<span class="built_in">ulimit</span> memlock=-1 --<span class="built_in">ulimit</span> stack=67108864 -v /data/AI-DIR/TensorFlow/jupyter-notebook:/data/jupyter  -it-p 9999:8888 nvcr.io/nvidia/caffe2:18.08-py3  sh -c <span class="string">"jupyter notebook --no-browser --allow-root --ip 0.0.0.0 /data/jupyter"</span></span><br><span class="line"></span><br><span class="line">============</span><br><span class="line">== Caffe2 ==</span><br><span class="line">============</span><br><span class="line"></span><br><span class="line">NVIDIA Release 18.08 (build 599137)</span><br><span class="line"></span><br><span class="line">Container image Copyright (c) 2018, NVIDIA CORPORATION. All rights reserved.</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<h1 id="安装PyTorch"><a href="#安装PyTorch" class="headerlink" title="安装PyTorch"></a>安装<code>PyTorch</code></h1><ul>
<li><a href="https://github.com/pytorch/pytorch/#from-source" target="_blank" rel="noopener">PyTorch 安装</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ docker pull nvcr.io/nvidia/pytorch:18.11-py3</span><br></pre></td></tr></table></figure>
<h2 id="从源码安装PyTorch"><a href="#从源码安装PyTorch" class="headerlink" title="从源码安装PyTorch"></a>从源码安装<code>PyTorch</code></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ pyenv activate  py3dev  <span class="comment"># 通过　pyenv　进入　Python 3.6的虚拟环境.</span></span><br><span class="line">~$ pip install numpy pyyaml mkl mkl-include setuptools cmake cffi typing <span class="comment"># py3dev　环境中安装依赖库.</span></span><br><span class="line">~$ <span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/cuda-10.0/bin:<span class="variable">$PATH</span></span><br><span class="line">~$ <span class="built_in">export</span> CUDA=1</span><br><span class="line">~$ pip install pycuda</span><br><span class="line">~$ git <span class="built_in">clone</span> --recursive https://github.com/pytorch/pytorch</span><br><span class="line">~$ <span class="built_in">cd</span> pytorch</span><br><span class="line">~$ python setup.py install</span><br></pre></td></tr></table></figure>
<ul>
<li>如果在使用<code>numpy</code>中出现<code>libmkl_rt.so: cannot open shared object file: No such file or directory</code>错误,要安装<code>libmkl_rt</code>再重新安装<code>numpy</code>的库.</li>
<li>现在<code>caffe2</code>已经进入到<code>PyTorch</code>源码里如果导入下面模块时,出现<strong>ModuleNotFoundError: No module named ‘past’</strong>错误,要先安装依赖<code>pip install future</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> caffe2.python.predictor.predictor_exporter <span class="keyword">as</span> pe</span><br><span class="line"><span class="keyword">from</span> caffe2.python <span class="keyword">import</span> core,model_helper,net_drawer,workspace,visualize,brew</span><br><span class="line">ModuleNotFoundError: No module named <span class="string">'past'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>警告<code>net_drawer will not run correctly. Please install the correct dependencies.</code>,该警告是因没有安装<code>pydot</code>.安装<code>pip install pydot</code>.</li>
</ul>
<h1 id="源码安装TensorFlow-支持-CUDA-10"><a href="#源码安装TensorFlow-支持-CUDA-10" class="headerlink" title="源码安装TensorFlow (支持 CUDA 10)"></a>源码安装<code>TensorFlow (支持 CUDA 10)</code></h1><ul>
<li><a href="https://medium.com/@o.kroeger/tensorflow-mnist-and-your-own-handwritten-digits-4d1cd32bbab4" target="_blank" rel="noopener">Tensorflow, MNIST and your own handwritten digits</a></li>
<li><a href="https://github.com/caicloud/tensorflow-tutorial" target="_blank" rel="noopener">Tensorflow 实战 Google 深度学习框架源代码</a></li>
</ul>
<h2 id="安装Bazel"><a href="#安装Bazel" class="headerlink" title="安装Bazel"></a>安装<code>Bazel</code></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">echo</span> <span class="string">'deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8'</span> | sudo tee /etc/apt/sources.list.d/bazel.list</span><br><span class="line">~$ curl https://bazel.build/bazel-release.pub.gpg | sudo apt-key add -</span><br><span class="line">~$ sudo apt-get update</span><br><span class="line">~$ sudo apt-get install bazel</span><br></pre></td></tr></table></figure>
<ul>
<li>因为墙的原因,可能上述安装会很慢,可以直接从<a href="https://github.com/bazelbuild/bazel/releases" target="_blank" rel="noopener">https://github.com/bazelbuild/bazel/releases</a>一个安装脚本.现在如果使用<code>apt-get install bazel</code>会安装最新的<code>0.20.0</code>版本,但是现在的<code>TensorFlow 1.12.0</code>只支持<code>bazel 0.19.2</code>的版本编译.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ bazel version</span><br><span class="line">WARNING: --batch mode is deprecated. Please instead explicitly shut down your Bazel server using the <span class="built_in">command</span> <span class="string">"bazel shutdown"</span>.</span><br><span class="line">Build label: 0.19.2</span><br><span class="line">Build target: bazel-out/k8-opt/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar</span><br><span class="line">Build time: Mon Nov 19 16:25:09 2018 (1542644709)</span><br><span class="line">Build timestamp: 1542644709</span><br><span class="line">Build timestamp as int: 1542644709</span><br></pre></td></tr></table></figure>
<h2 id="下载TensorFlow源码"><a href="#下载TensorFlow源码" class="headerlink" title="下载TensorFlow源码"></a>下载<code>TensorFlow</code>源码</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/cuda/bin:<span class="variable">$PATH</span></span><br><span class="line">~$ <span class="built_in">export</span> LD_LIBRARY_PATH=/usr/<span class="built_in">local</span>/cuda-10.0/lib64:/usr/<span class="built_in">local</span>/cuda-10.0/extras/CUPTI/lib64:<span class="variable">$LD_LIBRARY_PATH</span></span><br><span class="line">~$ git <span class="built_in">clone</span> https://github.com/tensorflow/tensorflow.git</span><br><span class="line">~$ pyenv activate py3dev</span><br><span class="line">~$ pip install wheel</span><br><span class="line">~$ ./configure</span><br><span class="line">WARNING: --batch mode is deprecated. Please instead explicitly shut down your Bazel server using the <span class="built_in">command</span> <span class="string">"bazel shutdown"</span>.</span><br><span class="line">You have bazel 0.19.2 installed.</span><br><span class="line">Please specify the location of python. [Default is fullpath/.pyenv/versions/py3dev/bin/python]:</span><br><span class="line"></span><br><span class="line">Found possible Python library paths:</span><br><span class="line">  /fullpath/.pyenv/versions/py3dev/lib/python3.6/site-packages</span><br><span class="line">Please input the desired Python library path to use.  Default is [/fullpath/.pyenv/versions/py3dev/lib/python3.6/site-packages]</span><br><span class="line">Do you wish to build TensorFlow with XLA JIT support? [Y/n]: Y</span><br><span class="line">XLA JIT support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line">Do you wish to build TensorFlow with OpenCL SYCL support? [y/N]: N</span><br><span class="line">No OpenCL SYCL support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line">Do you wish to build TensorFlow with ROCm support? [y/N]: N</span><br><span class="line">No ROCm support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line">Do you wish to build TensorFlow with CUDA support? [y/N]: y</span><br><span class="line">CUDA support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line">Please specify the CUDA SDK version you want to use. [Leave empty to default to CUDA 9.0]: 10.0</span><br><span class="line">Please specify the location <span class="built_in">where</span> CUDA 10.0 toolkit is installed. Refer to README.md <span class="keyword">for</span> more details. [Default is /usr/<span class="built_in">local</span>/cuda]:</span><br><span class="line">Please specify the cuDNN version you want to use. [Leave empty to default to cuDNN 7]:</span><br><span class="line">Please specify the location <span class="built_in">where</span> cuDNN 7 library is installed. Refer to README.md <span class="keyword">for</span> more details. [Default is /usr/<span class="built_in">local</span>/cuda]:</span><br><span class="line"></span><br><span class="line">Do you wish to build TensorFlow with TensorRT support? [y/N]: N</span><br><span class="line">No TensorRT support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line"></span><br><span class="line">Please specify the locally installed NCCL version you want to use. [Default is to use https://github.com/nvidia/nccl]:</span><br><span class="line"></span><br><span class="line">Please specify a list of comma-separated Cuda compute capabilities you want to build with.</span><br><span class="line">You can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.</span><br><span class="line">Please note that each additional compute capability significantly increases your build time and binary size. [Default is: 3.5,7.0]:</span><br><span class="line"></span><br><span class="line">Do you want to use clang as CUDA compiler? [y/N]: N</span><br><span class="line">nvcc will be used as CUDA compiler.</span><br><span class="line">Please specify <span class="built_in">which</span> gcc should be used by nvcc as the host compiler. [Default is /usr/bin/gcc]:</span><br><span class="line">Do you wish to build TensorFlow with MPI support? [y/N]: N</span><br><span class="line">No MPI support will be enabled <span class="keyword">for</span> TensorFlow.</span><br><span class="line"></span><br><span class="line">Please specify optimization flags to use during compilation when bazel option <span class="string">"--config=opt"</span> is specified [Default is -march=native -Wno-sign-compare]:</span><br><span class="line">Would you like to interactively configure ./WORKSPACE <span class="keyword">for</span> Android builds? [y/N]: y</span><br><span class="line">Please specify the home path of the Android NDK to use. [Default is /fullpath/Android/Sdk/ndk-bundle]:</span><br><span class="line">Please specify the home path of the Android SDK to use. [Default is /fullpath/Android/Sdk]:</span><br><span class="line">Please specify the Android SDK API level to use. [Available levels: [<span class="string">'13'</span>, <span class="string">'14'</span>, <span class="string">'15'</span>, <span class="string">'16'</span>, <span class="string">'17'</span>, <span class="string">'18'</span>, <span class="string">'19'</span>, <span class="string">'20'</span>, <span class="string">'21'</span>, <span class="string">'22'</span>, <span class="string">'23'</span>, <span class="string">'24'</span>, <span class="string">'25'</span>, <span class="string">'26'</span>, <span class="string">'27'</span>, <span class="string">'28'</span>]] [Default is 28]:</span><br><span class="line"></span><br><span class="line">Please specify an Android build tools version to use. [Available versions: [<span class="string">'21.1.2'</span>, <span class="string">'23.0.3'</span>, <span class="string">'24.0.3'</span>, <span class="string">'25.0.0'</span>, <span class="string">'25.0.2'</span>, <span class="string">'25.0.3'</span>, <span class="string">'26.0.2'</span>, <span class="string">'27.0.0'</span>, <span class="string">'27.0.3'</span>, <span class="string">'28.0.0-rc2'</span>, <span class="string">'28.0.2'</span>, <span class="string">'28.0.3'</span>]] [Default is 28.0.3]:</span><br><span class="line"></span><br><span class="line">Preconfigured Bazel build configs. You can use any of the below by adding <span class="string">"--config=&lt;&gt;"</span> to your build <span class="built_in">command</span>. See .bazelrc <span class="keyword">for</span> more details.</span><br><span class="line">        --config=mkl            <span class="comment"># Build with MKL support.</span></span><br><span class="line">        --config=monolithic     <span class="comment"># Config for mostly static monolithic build.</span></span><br><span class="line">        --config=gdr            <span class="comment"># Build with GDR support.</span></span><br><span class="line">        --config=verbs          <span class="comment"># Build with libverbs support.</span></span><br><span class="line">        --config=ngraph         <span class="comment"># Build with Intel nGraph support.</span></span><br><span class="line">        --config=dynamic_kernels        <span class="comment"># (Experimental) Build kernels into separate shared objects.</span></span><br><span class="line">Preconfigured Bazel build configs to DISABLE default on features:</span><br><span class="line">        --config=noaws          <span class="comment"># Disable AWS S3 filesystem support.</span></span><br><span class="line">        --config=nogcp          <span class="comment"># Disable GCP support.</span></span><br><span class="line">        --config=nohdfs         <span class="comment"># Disable HDFS support.</span></span><br><span class="line">        --config=noignite       <span class="comment"># Disable Apacha Ignite support.</span></span><br><span class="line">        --config=nokafka        <span class="comment"># Disable Apache Kafka support.</span></span><br><span class="line">        --config=nonccl         <span class="comment"># Disable NVIDIA NCCL support.</span></span><br><span class="line">Configuration finished</span><br><span class="line"></span><br><span class="line">~$ bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package</span><br><span class="line"></span><br><span class="line">~$ ./bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg <span class="comment"># 编译Python安装包.</span></span><br><span class="line">Wed Dec 5 10:54:27 CST 2018 : === Preparing sources <span class="keyword">in</span> dir: /tmp/tmp.OZdwkuc2YO</span><br><span class="line">~/github/tensorflow ~/github/tensorflow</span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line">~$ pip install /tmp/tensorflow_pkg/tensorflow-1.12.0rc0-cp36-cp36m-linux_x86_64.whl <span class="comment"># 安装Python</span></span><br><span class="line">~$ LD_LIBRARY_PATH=/usr/<span class="built_in">local</span>/cuda/lib64:/usr/<span class="built_in">local</span>/cuda-10.0/extras/CUPTI/lib64:<span class="variable">$LD_LIBRARY_PATH</span> jupyter notebook <span class="comment"># 在notebook里测试运行tensorflow</span></span><br></pre></td></tr></table></figure>
<ul>
<li>如果出现下面<strong>failed call to cuInit: CUDA_ERROR_UNKNOWN: unknown error</strong>这个错误,要在终端里先运行<code>apt-get install nvidia-modprobe</code>这个命令,并且重启系统.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">In [<span class="number">2</span>]: tf.test.is_built_with_cuda()</span><br><span class="line">Out[<span class="number">2</span>]: <span class="literal">True</span></span><br><span class="line">In [<span class="number">3</span>]: tf.test.is_gpu_available(cuda_only=<span class="literal">False</span>,min_cuda_compute_capability=<span class="literal">None</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">12</span>:<span class="number">03</span>:<span class="number">06.128401</span>: E tensorflow/stream_executor/cuda/cuda_driver.cc:<span class="number">300</span>] failed call to cuInit: CUDA_ERROR_UNKNOWN: unknown error</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">12</span>:<span class="number">03</span>:<span class="number">06.128442</span>: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:<span class="number">161</span>] retrieving CUDA diagnostic information <span class="keyword">for</span> host: debian</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">12</span>:<span class="number">03</span>:<span class="number">06.128448</span>: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:<span class="number">168</span>] hostname: debian</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">12</span>:<span class="number">03</span>:<span class="number">06.128470</span>: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:<span class="number">192</span>] libcuda reported version <span class="keyword">is</span>: <span class="number">410.48</span><span class="number">.0</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">12</span>:<span class="number">03</span>:<span class="number">06.128488</span>: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:<span class="number">196</span>] kernel reported version <span class="keyword">is</span>: <span class="number">410.48</span><span class="number">.0</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">12</span>:<span class="number">03</span>:<span class="number">06.128493</span>: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:<span class="number">303</span>] kernel version seems to match DSO: <span class="number">410.48</span><span class="number">.0</span></span><br><span class="line">Out[<span class="number">3</span>]: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]:  tf.test.is_gpu_available(cuda_only=<span class="literal">False</span>,min_cuda_compute_capability=<span class="literal">None</span>)</span><br><span class="line">Out[<span class="number">4</span>]: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#　重启系统之后,可以正常使用GPU了.</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: tf.Session().list_devices()</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.981018</span>: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:<span class="number">998</span>] successful NUMA node read <span class="keyword">from</span> SysFS had negative value (<span class="number">-1</span>), but there must be at least one NUMA node, so returning NUMA node zero</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.982813</span>: I tensorflow/compiler/xla/service/service.cc:<span class="number">150</span>] XLA service <span class="number">0x55d255632230</span> executing computations on platform CUDA. Devices:</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.982835</span>: I tensorflow/compiler/xla/service/service.cc:<span class="number">158</span>]   StreamExecutor device (<span class="number">0</span>): Quadro P600, Compute Capability <span class="number">6.1</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.983889</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">1431</span>] Found device <span class="number">0</span> <span class="keyword">with</span> properties:</span><br><span class="line">name: Quadro P600 major: <span class="number">6</span> minor: <span class="number">1</span> memoryClockRate(GHz): <span class="number">1.5565</span></span><br><span class="line">pciBusID: <span class="number">0000</span>:<span class="number">01</span>:<span class="number">00.0</span></span><br><span class="line">totalMemory: <span class="number">1.95</span>GiB freeMemory: <span class="number">1.74</span>GiB</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.983931</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">1510</span>] Adding visible gpu devices: <span class="number">0</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.986678</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">982</span>] Device interconnect StreamExecutor <span class="keyword">with</span> strength <span class="number">1</span> edge matrix:</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.986711</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">988</span>]      <span class="number">0</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">22.986726</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">1001</span>] <span class="number">0</span>:   N</span><br><span class="line">2018-12-05 15:02:22.986953: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1113] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 1560 MB memory) -&gt; physical GPU (device: 0, name: Quadro P600, pci bus id: 0000:01:00.0, compute capability: 6.1)</span><br><span class="line">Out[<span class="number">2</span>]:</span><br><span class="line">[_DeviceAttributes(/job:localhost/replica:<span class="number">0</span>/task:<span class="number">0</span>/device:CPU:<span class="number">0</span>, CPU, <span class="number">268435456</span>, <span class="number">4411150611837152607</span>),</span><br><span class="line"> _DeviceAttributes(/job:localhost/replica:<span class="number">0</span>/task:<span class="number">0</span>/device:XLA_CPU:<span class="number">0</span>, XLA_CPU, <span class="number">17179869184</span>, <span class="number">8331037032149977949</span>),</span><br><span class="line"> _DeviceAttributes(/job:localhost/replica:<span class="number">0</span>/task:<span class="number">0</span>/device:XLA_GPU:<span class="number">0</span>, XLA_GPU, <span class="number">17179869184</span>, <span class="number">1279689307458374322</span>),</span><br><span class="line"> _DeviceAttributes(/job:localhost/replica:<span class="number">0</span>/task:<span class="number">0</span>/device:GPU:<span class="number">0</span>, GPU, <span class="number">1636106240</span>, <span class="number">7170667474598106347</span>)]</span><br><span class="line"></span><br><span class="line">Out[<span class="number">3</span>]: tf.test.is_gpu_available(cuda_only=<span class="literal">False</span>,min_cuda_compute_capability=<span class="literal">None</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">52.037618</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">1510</span>] Adding visible gpu devices: <span class="number">0</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">52.037647</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">982</span>] Device interconnect StreamExecutor <span class="keyword">with</span> strength <span class="number">1</span> edge matrix:</span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">52.037652</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">988</span>]      <span class="number">0</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-05</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">52.037656</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">1001</span>] <span class="number">0</span>:   N</span><br><span class="line">2018-12-05 15:05:52.037737: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1113] Created TensorFlow device (/device:GPU:0 with 1560 MB memory) -&gt; physical GPU (device: 0, name: Quadro P600, pci bus id: 0000:01:00.0, compute capability: 6.1)</span><br><span class="line">Out[<span class="number">4</span>]: <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h2 id="运行TensorBoard可视化前端"><a href="#运行TensorBoard可视化前端" class="headerlink" title="运行TensorBoard可视化前端"></a>运行<code>TensorBoard</code>可视化前端</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">input1 = tf.constant([<span class="number">1.0</span>,<span class="number">2.0</span>,<span class="number">3.0</span>],name=<span class="string">'input1'</span>)</span><br><span class="line">input2 = tf.constant([<span class="number">2.0</span>,<span class="number">3.0</span>,<span class="number">4.0</span>],name=<span class="string">'input2'</span>)</span><br><span class="line">output = tf.add_n([input1,input2],name=<span class="string">'add'</span>)</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    writer = tf.summary.FileWriter(graph=sess.graph,logdir=<span class="string">'./graph'</span>)</span><br><span class="line">    sess.run(output)</span><br></pre></td></tr></table></figure>
<ul>
<li>运行上面示例代码片断,打开终端运行<code>tensorboard --logdir=&#39;./graph&#39; --port=6006</code>,它的 WEB 服务器运行之后,可以通过浏览器访问可视端了.</li>
</ul>
<h2 id="Tensorflow使用笔记"><a href="#Tensorflow使用笔记" class="headerlink" title="Tensorflow使用笔记"></a><code>Tensorflow</code>使用笔记</h2><h3 id="TFRecord读写"><a href="#TFRecord读写" class="headerlink" title="TFRecord读写"></a><code>TFRecord</code>读写</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.examples.tutorials.mnist <span class="keyword">import</span> input_data</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义函数转化变量类型.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_int64_feature</span><span class="params">(value)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> tf.train.Feature(int64_list=tf.train.Int64List(value=[value]))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_bytes_feature</span><span class="params">(value)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> tf.train.Feature(bytes_list=tf.train.BytesList(value=[value]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># mnist/data 是存放从网上下载的mnist数据位置</span></span><br><span class="line">mnist = input_data.read_data_sets(<span class="string">'./mnist/data'</span>,dtype=tf.uint8,one_hot=<span class="literal">True</span>)</span><br><span class="line">images = mnist.train.images</span><br><span class="line">labels = mnist.train.labels</span><br><span class="line"></span><br><span class="line">pixels = images.shape[<span class="number">1</span>]</span><br><span class="line">num_examples = mnist.train.num_examples</span><br><span class="line"></span><br><span class="line">filename = <span class="string">'./mnist/output.tfrecords'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将数据转化为tf.train.Example格式.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_make_example</span><span class="params">(pixels, label, image)</span>:</span></span><br><span class="line">    image_raw = image.tostring()</span><br><span class="line">    example = tf.train.Example(features=tf.train.Features(feature=&#123;</span><br><span class="line">        <span class="string">'pixels'</span>: _int64_feature(pixels),</span><br><span class="line">        <span class="string">'label'</span>: _int64_feature(np.argmax(label)),</span><br><span class="line">        <span class="string">'image_raw'</span>: _bytes_feature(image_raw)</span><br><span class="line">    &#125;))</span><br><span class="line">    <span class="keyword">return</span> example</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.python_io.TFRecordWriter(filename) <span class="keyword">as</span> writer:</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> range(num_examples):</span><br><span class="line">        example = _make_example(pixels,labels[index],images[index])</span><br><span class="line">        writer.write(example.SerializeToString())</span><br><span class="line">print(<span class="string">'写入TFRecord测试文件'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>用同样的格式读取<code>TFRecord</code>文件记录.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">reader = tf.TFRecordReader()</span><br><span class="line">filename_queue = tf.train.string_input_producer([<span class="string">'./mnist/output.tfrecords'</span>])</span><br><span class="line">_,serialized_example = reader.read(filename_queue)</span><br><span class="line">features = tf.parse_single_example(</span><br><span class="line">    serialized_example,</span><br><span class="line">    features=&#123;</span><br><span class="line">        <span class="string">'pixels'</span>: tf.FixedLenFeature([],tf.int64),</span><br><span class="line">        <span class="string">'label'</span>:tf.FixedLenFeature([],tf.int64),</span><br><span class="line">        <span class="string">'image_raw'</span>: tf.FixedLenFeature([],tf.string),</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">images = tf.decode_raw(features[<span class="string">'image_raw'</span>],tf.uint8)</span><br><span class="line">labels = tf.cast(features[<span class="string">'label'</span>],tf.int32)</span><br><span class="line">pixels = tf.cast(features[<span class="string">'pixels'</span>],tf.int32)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    coord = tf.train.Coordinator()</span><br><span class="line">    threads = tf.train.start_queue_runners(coord=coord)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        image,label,pixel = sess.run([images,labels,pixels])</span><br><span class="line">    coord.request_stop()</span><br><span class="line">    coord.join(threads)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="读取原始图片"><a href="#读取原始图片" class="headerlink" title="读取原始图片"></a>读取原始图片</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">image_raw_data = tf.gfile.FastGFile(<span class="string">'../img3.png'</span>,<span class="string">'rb'</span>).read()</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    img_data = tf.image.decode_png(image_raw_data)</span><br><span class="line">    <span class="comment"># 输出解码之后的三维矩阵.</span></span><br><span class="line">    print(img_data.eval())</span><br><span class="line">    plt.imshow(img_data.eval())</span><br><span class="line">    plt.show()</span><br><span class="line">    img_data.set_shape([<span class="number">420</span>,<span class="number">420</span>,<span class="number">3</span>])</span><br><span class="line">    print(img_data.get_shape())</span><br></pre></td></tr></table></figure>
<ul>
<li>调整图片的尺寸<br>| Method 取值 | 调整算法                                   |<br>| :———: | :—————————————– |<br>|      0      | 双线性插值法(Bilinear interploation)       |<br>|      1      | 最近邻居法(Nearest neighbor interpolation) |<br>|      2      | 双三次插值法(Bicubic interpolation)        |<br>|      3      | 面积插值法(Area interpolation)             |</li>
</ul>
<figure class="highlight ipython"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    <span class="comment"># 如果直接以0-255范围的整数数据输入resize_images，那么输出将是0-255之间的实数，</span></span><br><span class="line">    <span class="comment"># 不利于后续处理.本书建议在调整图片大小前，先将图片转为0-1范围的实数.</span></span><br><span class="line">    image_float = tf.image.convert_image_dtype(img_data,tf.float32)</span><br><span class="line">    resized = tf.image.resize_images(image_float,[<span class="number">400</span>,<span class="number">400</span>],method=<span class="number">0</span>)</span><br><span class="line">    plt.imshow(resized.eval())</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
<ul>
<li><p>裁剪与填充图片</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    croped = tf.image.resize_image_with_crop_or_pad(img_data,<span class="number">300</span>,<span class="number">300</span>)</span><br><span class="line">    padded = tf.image.resize_image_with_crop_or_pad(img_data,<span class="number">520</span>,<span class="number">520</span>)</span><br><span class="line">    plt.imshow(croped.eval())</span><br><span class="line">    plt.show()</span><br><span class="line">    plt.imshow(padded.eval())</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
</li>
<li><p>截取中心<code>%50</code>区域</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">  central_cropped = tf.image.central_crop(img_data, <span class="number">0.5</span>)</span><br><span class="line">  plt.imshow(central_cropped.eval())</span><br><span class="line">  plt.show()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="安装使用Keras"><a href="#安装使用Keras" class="headerlink" title="安装使用Keras"></a>安装使用<code>Keras</code></h1><ul>
<li>链接：<ul>
<li><a href="https://blog.keras.io/building-autoencoders-in-keras.html" target="_blank" rel="noopener">Building Autoencoders in Keras</a></li>
<li><a href="https://gitbook.cn/books/5994670facae7150950eb8b0/index.html" target="_blank" rel="noopener">如何零基础用 Keras 快速搭建实用深度学习模型</a></li>
<li><a href="https://towardsdatascience.com/image-classification-in-10-minutes-with-mnist-dataset-54c35b77a38d" target="_blank" rel="noopener">Image Classification in 10 Minutes with MNIST Dataset</a></li>
<li><a href="https://towardsdatascience.com/basics-of-image-classification-with-keras-43779a299c8b" target="_blank" rel="noopener">Basics of image classification with Keras</a></li>
<li><a href="https://blog.keras.io/building-a-simple-keras-deep-learning-rest-api.html" target="_blank" rel="noopener">Building a simple Keras + deep learning REST API</a></li>
<li><a href="https://nextjournal.com/gkoehler/digit-recognition-with-keras" target="_blank" rel="noopener">MNIST Handwritten Digit Recognition in Keras</a></li>
</ul>
</li>
</ul>
<ul>
<li><code>Keras</code>是提供一些高可用的<code>Python API</code>,能帮助你快速的构建和训练自己的深度学习模型，它的后端是<code>TensorFlow</code>或者<code>Theano</code>.它很简约, 模块化的方法使建立并运行神经网络变得轻巧.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [1]: import keras</span><br><span class="line">Using TensorFlow backend.</span><br><span class="line"></span><br><span class="line">In [2]: keras.__version__</span><br><span class="line">Out[2]: <span class="string">'2.2.4'</span></span><br><span class="line"></span><br><span class="line">In [3]: !cat /home/lcy/.keras/keras.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"floatx"</span>: <span class="string">"float32"</span>,</span><br><span class="line">    <span class="string">"epsilon"</span>: 1e-07,</span><br><span class="line">    <span class="string">"backend"</span>: <span class="string">"tensorflow"</span>,</span><br><span class="line">    <span class="string">"image_data_format"</span>: <span class="string">"channels_last"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Keras-MNIST手写数据测试"><a href="#Keras-MNIST手写数据测试" class="headerlink" title="Keras MNIST手写数据测试"></a><code>Keras MNIST</code>手写数据测试</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Sequential,load_model</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense,Dropout,Conv2D,Flatten,MaxPooling2D,Activation</span><br><span class="line"><span class="keyword">from</span> keras.datasets.mnist <span class="keyword">import</span> load_data</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># 清除GPU的会话数据</span></span><br><span class="line">keras.backend.clear_session()</span><br><span class="line">(X_train,Y_train),(x_test,y_test) = load_data()</span><br><span class="line">X_train = X_train.reshape(X_train.shape[<span class="number">0</span>],<span class="number">28</span>,<span class="number">28</span>,<span class="number">1</span>)</span><br><span class="line">x_test = x_test.reshape(x_test.shape[<span class="number">0</span>],<span class="number">28</span>,<span class="number">28</span>,<span class="number">1</span>)</span><br><span class="line">input_shape=(<span class="number">28</span>,<span class="number">28</span>,<span class="number">1</span>)</span><br><span class="line">X_train = X_train.astype(<span class="string">'float32'</span>)</span><br><span class="line">x_test = x_test.astype(<span class="string">'float32'</span>)</span><br><span class="line">X_train /= <span class="number">255</span></span><br><span class="line">x_test /= <span class="number">255</span></span><br><span class="line">print(<span class="string">'x_train shape:'</span>,X_train.shape)</span><br><span class="line">print(<span class="string">'Number of images in x_train'</span>,X_train.shape[<span class="number">0</span>])</span><br><span class="line">print(<span class="string">'Number of images in x_test'</span>,x_test.shape[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卷积网络</span></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Conv2D(<span class="number">28</span>,kernel_size=(<span class="number">3</span>,<span class="number">3</span>),input_shape=input_shape))</span><br><span class="line">model.add(MaxPooling2D(pool_size=(<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line">model.add(Flatten())</span><br><span class="line">model.add(Dense(<span class="number">128</span>))</span><br><span class="line">model.add(Activation(<span class="string">'relu'</span>))</span><br><span class="line">model.add(Dropout(<span class="number">0.02</span>))</span><br><span class="line">model.add(Dense(<span class="number">10</span>))</span><br><span class="line">model.add(Activation(<span class="string">'softmax'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#　编译多分类函数分类器</span></span><br><span class="line">model.compile(optimizer=<span class="string">'adam'</span>,loss=<span class="string">'sparse_categorical_crossentropy'</span>,metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">model.fit(x=X_train,y=Y_train,epochs=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#　保存训练模型到HDF5文件里</span></span><br><span class="line">history = model.fit(X_train,Y_train,batch_size=<span class="number">128</span>,epochs=<span class="number">20</span>,verbose=<span class="number">2</span>,validation_data=(x_test,y_test))</span><br><span class="line">save_dir = <span class="string">'./results/'</span></span><br><span class="line">mode_name=<span class="string">'keras_mnist.h5'</span></span><br><span class="line">mode_path = os.path.join(save_dir,mode_name)</span><br><span class="line">model.save(mode_path)</span><br><span class="line">print(<span class="string">'Saved trained model at %s'</span> % mode_path)</span><br><span class="line"></span><br><span class="line"><span class="comment">#　打印它的训练图形</span></span><br><span class="line">fig = plt.figure()</span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">plt.plot(history.history[<span class="string">'acc'</span>])</span><br><span class="line">plt.plot(history.history[<span class="string">'val_acc'</span>])</span><br><span class="line">plt.title(<span class="string">'model accuracy'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'accuracy'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'epoch'</span>)</span><br><span class="line">plt.legend([<span class="string">'train'</span>, <span class="string">'test'</span>], loc=<span class="string">'lower right'</span>)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">plt.plot(history.history[<span class="string">'loss'</span>])</span><br><span class="line">plt.plot(history.history[<span class="string">'val_loss'</span>])</span><br><span class="line">plt.title(<span class="string">'model loss'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'loss'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'epoch'</span>)</span><br><span class="line">plt.legend([<span class="string">'train'</span>, <span class="string">'test'</span>], loc=<span class="string">'upper right'</span>)</span><br><span class="line"></span><br><span class="line">plt.tight_layout()</span><br><span class="line">fig</span><br><span class="line"></span><br><span class="line"><span class="comment">#　使用一部分测试图片验证模型</span></span><br><span class="line">mnist_model = load_model(<span class="string">'./results/keras_mnist.h5'</span>)</span><br><span class="line">loss_and_metrics = mnist_model.evaluate(x_test,y_test,verbose=<span class="number">2</span>)</span><br><span class="line">print(<span class="string">'Test Loss'</span>,loss_and_metrics[<span class="number">0</span>])</span><br><span class="line">print(<span class="string">'Test Accuracy'</span>,loss_and_metrics[<span class="number">1</span>])</span><br><span class="line">predicted_classes =mnist_model.predict_classes(x_test)</span><br><span class="line">corrent_indices = np.nonzero(predicted_classes == y_test)[<span class="number">0</span>]</span><br><span class="line">incorrent_indices = np.nonzero(predicted_classes != y_test)[<span class="number">0</span>]</span><br><span class="line">print()</span><br><span class="line">print(len(corrent_indices),<span class="string">' classifed correctly'</span>)</span><br><span class="line">print(len(incorrent_indices),<span class="string">' classified incorrectly'</span>)</span><br><span class="line"></span><br><span class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">7</span>,<span class="number">14</span>)</span><br><span class="line">figure_evaluation = plt.figure()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印９个正确预测的图片</span></span><br><span class="line"><span class="keyword">for</span> i ,correct <span class="keyword">in</span> enumerate(corrent_indices[:<span class="number">9</span>]):</span><br><span class="line">    plt.subplot(<span class="number">6</span>,<span class="number">3</span>,i+<span class="number">1</span>)</span><br><span class="line">    plt.imshow(x_test[correct].reshape(<span class="number">28</span>,<span class="number">28</span>),cmap=<span class="string">'gray'</span>,interpolation=<span class="string">'none'</span>)</span><br><span class="line">    plt.title(<span class="string">'Predicted: &#123;&#125;,Trutch: &#123;&#125;'</span>.format(predicted_classes[correct],y_test[correct]))</span><br><span class="line">    plt.xticks([])</span><br><span class="line">    plt.yticks([])</span><br><span class="line"><span class="comment"># 打印９个错误预测的图片</span></span><br><span class="line"><span class="keyword">for</span> i ,correct <span class="keyword">in</span> enumerate(incorrent_indices[:<span class="number">9</span>]):</span><br><span class="line">    plt.subplot(<span class="number">6</span>,<span class="number">3</span>,i+<span class="number">1</span>)</span><br><span class="line">    plt.imshow(x_test[correct].reshape(<span class="number">28</span>,<span class="number">28</span>),cmap=<span class="string">'gray'</span>,interpolation=<span class="string">'none'</span>)</span><br><span class="line">    plt.title(<span class="string">'Predicted: &#123;&#125;,Truth: &#123;&#125;'</span>.format(predicted_classes[correct],y_test[correct]))</span><br><span class="line">    plt.xticks([])</span><br><span class="line">    plt.yticks([])</span><br><span class="line">figure_evaluation</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#　读入自己的手动生成的图片做测试</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> keras_preprocessing.image <span class="keyword">import</span> img_to_array</span><br><span class="line"><span class="keyword">from</span> keras_applications <span class="keyword">import</span> imagenet_utils</span><br><span class="line">data_dir = <span class="string">'/data/AI-DIR/TensorFlow/mnist/test-data/'</span></span><br><span class="line">list_dir = os.listdir(data_dir)</span><br><span class="line">print(len(list_dir))</span><br><span class="line">image_height = <span class="number">28</span></span><br><span class="line">image_width = <span class="number">28</span></span><br><span class="line">channels = <span class="number">1</span></span><br><span class="line">img_data = np.ndarray(shape=(len(list_dir),image_height,image_width,channels))</span><br><span class="line">label_data = np.zeros(len(list_dir),dtype=<span class="string">'uint8'</span>)</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> list_dir:</span><br><span class="line">    <span class="comment">#　读取目录下的图片,并把它转换成灰度图片.</span></span><br><span class="line">    png = Image.open(os.path.join(data_dir,file),<span class="string">'r'</span>).convert(<span class="string">'L'</span>)</span><br><span class="line">    gray = png.point(<span class="keyword">lambda</span> x: <span class="number">0</span> <span class="keyword">if</span> x == <span class="number">255</span> <span class="keyword">else</span> <span class="number">255</span>)</span><br><span class="line">    image = img_to_array(gray)</span><br><span class="line">    img_data[i] = image</span><br><span class="line">    label_data[i] = int(file[<span class="number">4</span>])</span><br><span class="line"><span class="comment">#     print('png file: ',file)</span></span><br><span class="line">    i+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'test_data len'</span>,len(img_data))</span><br><span class="line">print(<span class="string">'test_data shape'</span>,img_data.shape)</span><br><span class="line">print(<span class="string">'test label '</span>,label_data)</span><br><span class="line"></span><br><span class="line">loss_and_metrics = mnist_model.evaluate(img_data,label_data,verbose=<span class="number">2</span>)</span><br><span class="line">print(<span class="string">'Test Loss'</span>,loss_and_metrics[<span class="number">0</span>])</span><br><span class="line">print(<span class="string">'Test Accuracy'</span>,loss_and_metrics[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">predicted_classes =mnist_model.predict_classes(img_data)</span><br><span class="line">corrent_indices = np.nonzero(predicted_classes == label_data)[<span class="number">0</span>]</span><br><span class="line">incorrent_indices = np.nonzero(predicted_classes != label_data)[<span class="number">0</span>]</span><br><span class="line">print()</span><br><span class="line">print(len(corrent_indices),<span class="string">' classifed correctly'</span>)</span><br><span class="line">print(len(incorrent_indices),<span class="string">' classified incorrectly'</span>)</span><br><span class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">7</span>,<span class="number">14</span>)</span><br><span class="line">figure_evaluation = plt.figure()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印９个错误预测的图片</span></span><br><span class="line"><span class="keyword">for</span> i ,correct <span class="keyword">in</span> enumerate(incorrent_indices[:<span class="number">9</span>]):</span><br><span class="line">    plt.subplot(<span class="number">6</span>,<span class="number">3</span>,i+<span class="number">1</span>)</span><br><span class="line">    plt.imshow(img_data[correct].reshape(<span class="number">28</span>,<span class="number">28</span>),cmap=<span class="string">'gray'</span>,interpolation=<span class="string">'none'</span>)</span><br><span class="line">    plt.title(<span class="string">'Predicted: &#123;&#125;,Truth: &#123;&#125;'</span>.format(predicted_classes[correct],label_data[correct]))</span><br><span class="line">    plt.xticks([])</span><br><span class="line">    plt.yticks([])</span><br><span class="line"></span><br><span class="line">figure_evaluation</span><br></pre></td></tr></table></figure>
<h2 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h2><h3 id="导入tkinter模块"><a href="#导入tkinter模块" class="headerlink" title="导入tkinter模块"></a>导入<code>tkinter</code>模块</h3><ul>
<li><p>提示无法导入<code>tkinter</code>模块,这里安装可能就比较麻烦.错误如下:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">In [4]: import matplotlib.pyplot as plt</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">ModuleNotFoundError                       Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-4-a0d2faabd9e9&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 import matplotlib.pyplot as plt</span><br><span class="line">[...]</span><br><span class="line">ModuleNotFoundError: No module named <span class="string">'_tkinter'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>解块方法如下:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ apt-get install tk-dev</span><br><span class="line">~$ pyenv uninstall 3.6.6</span><br><span class="line">~$ pyenv install 3.6.6</span><br><span class="line">~$ pyenv virtualenv py3dev</span><br><span class="line">~$ pyenv activate py3dev</span><br><span class="line">~$ python -m tkinter  <span class="comment"># 测试模块.</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="导入ggplot模块"><a href="#导入ggplot模块" class="headerlink" title="导入ggplot模块"></a>导入<code>ggplot</code>模块</h3><ul>
<li><code>from ggplot import *</code>语句导入 ggplot 包时报错如下:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~/.pyenv/versions/3.6.6/envs/py3dev/lib/python3.6/site-packages/ggplot/stats/smoothers.py <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">      2                         unicode_literals)</span><br><span class="line">      3 import numpy as np</span><br><span class="line">----&gt; 4 from pandas.lib import Timestamp</span><br><span class="line">      5 import pandas as pd</span><br><span class="line">      6 import statsmodels.api as sm</span><br><span class="line"></span><br><span class="line">ImportError: cannot import name <span class="string">'Timestamp'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>解决方法:编辑文件<code>.../site-packages/ggplot/stats/smoothers.py</code>.把原来的<code>from pandas.lib import Timestamp</code>改成<code>from pandas import Timestamp</code>,保存 OK.</li>
</ul>
<h1 id="安装Kaggle-API"><a href="#安装Kaggle-API" class="headerlink" title="安装Kaggle API"></a>安装<code>Kaggle API</code></h1><ul>
<li><a href="https://github.com/Kaggle/kaggle-api" target="_blank" rel="noopener">Kaggle API</a></li>
<li>在<code>www.kaggle.com</code>上面注册一个帐号,进入到帐号管理页面,在<code>API</code>一栏会有两个按钮<code>Create New API Token</code>,<code>Expire API Token</code>,点击<code>Create New API Token</code>浏览器就会自动下载一个名为<code>kaggle.json</code>的文件,并且会有 Toast 提示<code>Ensure kaggle.json is in the location ~/.kaggle/kaggle.json to use the API.</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ pip install kaggle</span><br><span class="line">~$ mkdir ~/.kaggle</span><br><span class="line">~$ mv ~/Download/kaggle.json ~/.kaggle/</span><br><span class="line">~$ chmod <span class="number">600</span> ~/.kaggle/kaggle.json</span><br></pre></td></tr></table></figure>
<h2 id="下载数据"><a href="#下载数据" class="headerlink" title="下载数据"></a>下载数据</h2><ul>
<li>进入到<code>https://www.kaggle.com/competitions</code>页面,选择一行具体的项目进去,在页面底部有一个必须<strong>接受</strong>的对话框,<code>I Understand and Accept</code>,否则不能下载该项目的数据.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#　下载数据到指定目录.</span></span><br><span class="line">~$ kaggle competitions download -c traveling-santa-2018-prime-paths  -p /fullpath/Traveling-Santa-2018-Prime-Paths/</span><br><span class="line">~$ kaggle competitions  list</span><br><span class="line">ref                                            deadline             category            reward  teamCount  userHasEntered</span><br><span class="line">---------------------------------------------  -------------------  ---------------  ---------  ---------  --------------</span><br><span class="line">digit-recognizer                               2030-01-01 00:00:00  Getting Started  Knowledge       2708            True</span><br><span class="line">titanic                                        2030-01-01 00:00:00  Getting Started  Knowledge      10578           False</span><br><span class="line">house-prices-advanced-regression-techniques    2030-01-01 00:00:00  Getting Started  Knowledge       4519           False</span><br><span class="line">imagenet-object-localization-challenge         2029-12-31 07:00:00  Research         Knowledge         30           False</span><br><span class="line">competitive-data-science-predict-future-sales  2019-12-31 23:59:00  Playground           Kudos       1869           False</span><br><span class="line">histopathologic-cancer-detection               2019-03-31 23:59:00  Playground       Knowledge        140           False</span><br><span class="line">humpback-whale-identification                  2019-02-28 23:59:00  Featured           <span class="variable">$25</span>,000        144           False</span><br><span class="line">elo-merchant-category-recommendation           2019-02-26 23:59:00  Featured           <span class="variable">$50</span>,000        630           False</span><br><span class="line">ga-customer-revenue-prediction                 2019-02-15 23:59:00  Featured           <span class="variable">$45</span>,000       1104           False</span><br><span class="line">quora-insincere-questions-classification       2019-02-05 23:59:00  Featured           <span class="variable">$25</span>,000       1666           False</span><br><span class="line">pubg-finish-placement-prediction               2019-01-30 23:59:00  Playground            Swag        857           False</span><br><span class="line">human-protein-atlas-image-classification       2019-01-10 23:59:00  Featured           <span class="variable">$37</span>,000       1388           False</span><br><span class="line">traveling-santa-2018-prime-paths               2019-01-10 23:59:00  Featured           <span class="variable">$25</span>,000        958            True</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<h1 id="谢谢支持"><a href="#谢谢支持" class="headerlink" title="谢谢支持"></a>谢谢支持</h1><ul>
<li>微信二维码:</li>
</ul>
<p><img src="/imgs/mm_reward_qrcode_1525013906055.png" width="40%" height="40%" align="center/"></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Cuda-Linux-ML-Nvidia/" rel="tag"># Cuda,Linux,ML,Nvidia</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/01/08/AVR单片机指南/" rel="prev" title="AVR单片机指南">
      <i class="fa fa-chevron-left"></i> AVR单片机指南
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/02/02/玩转FPGA-DE0-Nano/" rel="next" title="玩转FPGA_DE0-Nano">
      玩转FPGA_DE0-Nano <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#机器学习框架介绍"><span class="nav-number">1.</span> <span class="nav-text">机器学习框架介绍</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CUDA"><span class="nav-number">2.</span> <span class="nav-text">CUDA</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#安装CUDA"><span class="nav-number">2.1.</span> <span class="nav-text">安装CUDA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Debian-Buster下安装Nvidia-tesla驱动"><span class="nav-number">2.2.</span> <span class="nav-text">Debian Buster下安装Nvidia-tesla驱动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装-PyCuda"><span class="nav-number">2.3.</span> <span class="nav-text">安装 PyCuda</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nvidia-Docker安装"><span class="nav-number">2.4.</span> <span class="nav-text">Nvidia Docker安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#用Docker安装Tensorflow-GPU"><span class="nav-number">2.4.1.</span> <span class="nav-text">用Docker安装Tensorflow GPU</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nvidia-GPU-CLOUD容器云"><span class="nav-number">2.5.</span> <span class="nav-text">Nvidia GPU CLOUD容器云</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装与运行Caffe2容器"><span class="nav-number">2.5.1.</span> <span class="nav-text">安装与运行Caffe2容器,</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装PyTorch"><span class="nav-number">3.</span> <span class="nav-text">安装PyTorch</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#从源码安装PyTorch"><span class="nav-number">3.1.</span> <span class="nav-text">从源码安装PyTorch</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#源码安装TensorFlow-支持-CUDA-10"><span class="nav-number">4.</span> <span class="nav-text">源码安装TensorFlow (支持 CUDA 10)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#安装Bazel"><span class="nav-number">4.1.</span> <span class="nav-text">安装Bazel</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#下载TensorFlow源码"><span class="nav-number">4.2.</span> <span class="nav-text">下载TensorFlow源码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#运行TensorBoard可视化前端"><span class="nav-number">4.3.</span> <span class="nav-text">运行TensorBoard可视化前端</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tensorflow使用笔记"><span class="nav-number">4.4.</span> <span class="nav-text">Tensorflow使用笔记</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TFRecord读写"><span class="nav-number">4.4.1.</span> <span class="nav-text">TFRecord读写</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#读取原始图片"><span class="nav-number">4.4.2.</span> <span class="nav-text">读取原始图片</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装使用Keras"><span class="nav-number">5.</span> <span class="nav-text">安装使用Keras</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Keras-MNIST手写数据测试"><span class="nav-number">5.1.</span> <span class="nav-text">Keras MNIST手写数据测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#错误"><span class="nav-number">5.2.</span> <span class="nav-text">错误</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#导入tkinter模块"><span class="nav-number">5.2.1.</span> <span class="nav-text">导入tkinter模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导入ggplot模块"><span class="nav-number">5.2.2.</span> <span class="nav-text">导入ggplot模块</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装Kaggle-API"><span class="nav-number">6.</span> <span class="nav-text">安装Kaggle API</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#下载数据"><span class="nav-number">6.1.</span> <span class="nav-text">下载数据</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#谢谢支持"><span class="nav-number">7.</span> <span class="nav-text">谢谢支持</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yjdwbj"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">yjdwbj</p>
  <div class="site-description" itemprop="description">最是人间留不住,朱颜辞镜花辞树</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yjdwbj</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>

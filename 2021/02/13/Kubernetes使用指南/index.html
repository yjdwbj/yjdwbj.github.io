<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0-rc2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="PaaSæ¦‚è¿° PaaS(Platform as a service),å¹³å°å³æœåŠ¡,æŒ‡å°†è½¯ä»¶ç ”å‘çš„å¹³å°(æˆ–ä¸šåŠ¡åŸºç¡€å¹³å°)ä½œä¸ºä¸€ç§æœåŠ¡,ä»¥SaaSçš„æ¨¡å¼æäº¤ç»™ç”¨æˆ·.PaaSæ˜¯äº‘è®¡ç®—æœåŠ¡çš„å…¶ä¸­ä¸€ç§æ¨¡å¼,äº‘è®¡ç®—æ˜¯ä¸€ç§æŒ‰ä½¿ç”¨é‡ä»˜è´¹çš„æ¨¡å¼çš„æœåŠ¡,ç±»ä¼¼ä¸€ç§ç§ŸèµæœåŠ¡,æœåŠ¡å¯ä»¥æ˜¯åŸºç¡€è®¾æ–½è®¡ç®—èµ„æº(IaaS),å¹³å°(PaaS),è½¯ä»¶(SaaS).ç§Ÿç”¨ITèµ„æºçš„æ–¹å¼æ¥å®ç°ä¸šåŠ¡éœ€è¦,å¦‚åŒæ°´åŠ›ã€ç”µåŠ›èµ„æºä¸€æ ·,è®¡ç®—ã€å­˜å‚¨ã€ç½‘">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetesä½¿ç”¨æŒ‡å—">
<meta property="og:url" content="http://example.com/2021/02/13/Kubernetes%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="Sunrise åšå®¢">
<meta property="og:description" content="PaaSæ¦‚è¿° PaaS(Platform as a service),å¹³å°å³æœåŠ¡,æŒ‡å°†è½¯ä»¶ç ”å‘çš„å¹³å°(æˆ–ä¸šåŠ¡åŸºç¡€å¹³å°)ä½œä¸ºä¸€ç§æœåŠ¡,ä»¥SaaSçš„æ¨¡å¼æäº¤ç»™ç”¨æˆ·.PaaSæ˜¯äº‘è®¡ç®—æœåŠ¡çš„å…¶ä¸­ä¸€ç§æ¨¡å¼,äº‘è®¡ç®—æ˜¯ä¸€ç§æŒ‰ä½¿ç”¨é‡ä»˜è´¹çš„æ¨¡å¼çš„æœåŠ¡,ç±»ä¼¼ä¸€ç§ç§ŸèµæœåŠ¡,æœåŠ¡å¯ä»¥æ˜¯åŸºç¡€è®¾æ–½è®¡ç®—èµ„æº(IaaS),å¹³å°(PaaS),è½¯ä»¶(SaaS).ç§Ÿç”¨ITèµ„æºçš„æ–¹å¼æ¥å®ç°ä¸šåŠ¡éœ€è¦,å¦‚åŒæ°´åŠ›ã€ç”µåŠ›èµ„æºä¸€æ ·,è®¡ç®—ã€å­˜å‚¨ã€ç½‘">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://d33wubrfki0l68.cloudfront.net/518e18713c865fe67a5f23fc64260806d72b38f5/61d75/images/docs/post-ccm-arch.png">
<meta property="article:published_time" content="2021-02-13T04:44:32.000Z">
<meta property="article:modified_time" content="2022-02-26T15:52:54.700Z">
<meta property="article:author" content="yjdwbj">
<meta property="article:tag" content="Docker,Linux,Kubernetes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://d33wubrfki0l68.cloudfront.net/518e18713c865fe67a5f23fc64260806d72b38f5/61d75/images/docs/post-ccm-arch.png">

<link rel="canonical" href="http://example.com/2021/02/13/Kubernetes%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Kubernetesä½¿ç”¨æŒ‡å— | Sunrise åšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sunrise åšå®¢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/13/Kubernetes%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise åšå®¢">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Kubernetesä½¿ç”¨æŒ‡å—
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-02-13 12:44:32" itemprop="dateCreated datePublished" datetime="2021-02-13T12:44:32+08:00">2021-02-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-02-26 23:52:54" itemprop="dateModified" datetime="2022-02-26T23:52:54+08:00">2022-02-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="PaaSæ¦‚è¿°"><a href="#PaaSæ¦‚è¿°" class="headerlink" title="PaaSæ¦‚è¿°"></a><code>PaaS</code>æ¦‚è¿°</h1><ul>
<li><code>PaaS(Platform as a service)</code>,å¹³å°å³æœåŠ¡,æŒ‡å°†è½¯ä»¶ç ”å‘çš„å¹³å°(æˆ–ä¸šåŠ¡åŸºç¡€å¹³å°)ä½œä¸ºä¸€ç§æœåŠ¡,ä»¥<code>SaaS</code>çš„æ¨¡å¼æäº¤ç»™ç”¨æˆ·.<code>PaaS</code>æ˜¯äº‘è®¡ç®—æœåŠ¡çš„å…¶ä¸­ä¸€ç§æ¨¡å¼,äº‘è®¡ç®—æ˜¯ä¸€ç§æŒ‰ä½¿ç”¨é‡ä»˜è´¹çš„æ¨¡å¼çš„æœåŠ¡,ç±»ä¼¼ä¸€ç§ç§ŸèµæœåŠ¡,æœåŠ¡å¯ä»¥æ˜¯åŸºç¡€è®¾æ–½è®¡ç®—èµ„æº(IaaS),å¹³å°(PaaS),è½¯ä»¶(SaaS).ç§Ÿç”¨ITèµ„æºçš„æ–¹å¼æ¥å®ç°ä¸šåŠ¡éœ€è¦,å¦‚åŒæ°´åŠ›ã€ç”µåŠ›èµ„æºä¸€æ ·,è®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œå°†æˆä¸ºä¼ä¸šITè¿è¡Œçš„ä¸€ç§è¢«ä½¿ç”¨çš„èµ„æº,æ— éœ€è‡ªå·±å»ºè®¾,å¯æŒ‰éœ€è·å¾—.<code>PaaS</code>çš„å®è´¨æ˜¯å°†äº’è”ç½‘çš„èµ„æºæœåŠ¡åŒ–ä¸ºå¯ç¼–ç¨‹æ¥å£,ä¸ºç¬¬ä¸‰æ–¹å¼€å‘è€…æä¾›æœ‰å•†ä¸šä»·å€¼çš„èµ„æºå’ŒæœåŠ¡å¹³å°.ç®€è€Œè¨€ä¹‹,<code>IaaS</code>å°±æ˜¯å–ç¡¬ä»¶åŠè®¡ç®—èµ„æº,<code>PaaS</code>å°±æ˜¯å–å¼€å‘ã€è¿è¡Œç¯å¢ƒ,<code>SaaS</code>å°±æ˜¯å–è½¯ä»¶.</li>
</ul>
<table>
<thead>
<tr>
<th align="center">ç±»å‹</th>
<th>è¯´æ˜</th>
<th>æ¯”å–»</th>
<th>ä¾‹å­</th>
</tr>
</thead>
<tbody><tr>
<td align="center">IaaS:Infrastructure-as-a-Service(åŸºç¡€è®¾æ–½å³æœåŠ¡)</td>
<td>æä¾›çš„æœåŠ¡æ˜¯è®¡ç®—åŸºç¡€è®¾æ–½</td>
<td>åœ°çš®,éœ€è¦è‡ªå·±ç›–æˆ¿å­</td>
<td>Amazon EC2(äºšé©¬é€Šå¼¹æ€§äº‘è®¡ç®—),é˜¿é‡Œäº‘</td>
</tr>
<tr>
<td align="center">PaaS: Platform-as-a-Service(å¹³å°å³æœåŠ¡)</td>
<td>æä¾›çš„æœåŠ¡æ˜¯è½¯ä»¶ç ”å‘çš„å¹³å°æˆ–ä¸šåŠ¡åŸºç¡€å¹³å°</td>
<td>å•†å“æˆ¿,éœ€è¦è‡ªå·±è£…ä¿®</td>
<td>GAE(è°·æ­Œå¼€å‘è€…å¹³å°),heroku</td>
</tr>
<tr>
<td align="center">SaaS: Software-as-a-Service(è½¯ä»¶å³æœåŠ¡)</td>
<td>æä¾›çš„æœåŠ¡æ˜¯è¿è¡Œåœ¨äº‘è®¡ç®—åŸºç¡€è®¾æ–½ä¸Šçš„åº”ç”¨ç¨‹åº</td>
<td>é…’åº—å¥—æˆ¿,å¯ä»¥ç›´æ¥å…¥ä½</td>
<td>è°·æ­Œçš„ Gmail é‚®ç®±</td>
</tr>
</tbody></table>
<h2 id="Kubernetesæ¦‚è¿°"><a href="#Kubernetesæ¦‚è¿°" class="headerlink" title="Kubernetesæ¦‚è¿°"></a><code>Kubernetes</code>æ¦‚è¿°</h2><ul>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/">What is Kubernetes?</a></li>
<li><code>Kubernetes</code>æ˜¯<code>Google</code>å¼€æºçš„å®¹å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿ.å®ƒæ„å»º<code>Docker</code>æŠ€æœ¯ä¹‹ä¸Š,ä¸ºå®¹å™¨åŒ–çš„åº”ç”¨æä¾›èµ„æºè°ƒåº¦ã€éƒ¨ç½²è¿è¡Œã€æœåŠ¡å‘ç°ã€æ‰©å®¹ç¼©å®¹ç­‰æ•´ä¸€å¥—åŠŸèƒ½,æœ¬è´¨ä¸Šå¯çœ‹ä½œæ˜¯åŸºäºå®¹å™¨æŠ€æœ¯çš„<code>Micro-PaaS</code>å¹³å°,å³ç¬¬ä¸‰ä»£<code>PaaS</code>çš„ä»£è¡¨æ€§é¡¹ç›®.</li>
<li>Kubernetesæ¶æ„å›¾<br><img src="https://d33wubrfki0l68.cloudfront.net/518e18713c865fe67a5f23fc64260806d72b38f5/61d75/images/docs/post-ccm-arch.png" alt="Kubernetes"></li>
</ul>
<h3 id="Kubernetesçš„åŸºæœ¬æ¦‚å¿µ"><a href="#Kubernetesçš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="Kubernetesçš„åŸºæœ¬æ¦‚å¿µ"></a><code>Kubernetes</code>çš„åŸºæœ¬æ¦‚å¿µ</h3><h4 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a><code>Pod</code></h4><ul>
<li><code>Pod</code>æ˜¯è‹¥å¹²ä¸ªç›¸å…³å®¹å™¨çš„ç»„åˆ,æ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µ,<code>Pod</code>åŒ…å«çš„å®¹å™¨è¿è¡Œåœ¨åŒä¸€ä¸ªå®¿ä¸»æœºä¸Š,è¿™äº›å®¹å™¨ä½¿ç”¨ç›¸åŒçš„ç½‘ç»œå‘½åç©ºé—´,IPåœ°å€å’Œç«¯å£,ç›¸äº’ä¹‹é—´èƒ½é€šè¿‡<code>localhost</code>æ¥å‘ç°å’Œé€šä¿¡,å…±äº«ä¸€å—å­˜å‚¨å·ç©ºé—´.åœ¨<code>Kubernetes</code>ä¸­åˆ›å»ºã€è°ƒåº¦å’Œç®¡ç†çš„æœ€å°å•ä½æ˜¯<code>Pod</code>.ä¸€ä¸ª<code>Pod</code>ä¸€èˆ¬åªæ”¾ä¸€ä¸ªä¸šåŠ¡å®¹å™¨å’Œä¸€ä¸ªç”¨äºç»Ÿä¸€ç½‘ç»œç®¡ç†çš„ç½‘ç»œå®¹å™¨.</li>
</ul>
<h4 id="Replication-Controller"><a href="#Replication-Controller" class="headerlink" title="Replication Controller"></a><code>Replication Controller</code></h4><ul>
<li><code>Replication Controller</code>æ˜¯ç”¨æ¥æ§åˆ¶ç®¡ç†<code>Pod</code>å‰¯æœ¬(Replica,æˆ–è€…ç§°å®ä¾‹),<code>Replication Controller</code>ç¡®ä¿ä»»ä½•æ—¶å€™<code>Kubernetes</code>é›†ç¾¤ä¸­æœ‰æŒ‡å®šæ•°é‡çš„<code>Pod</code>å‰¯æœ¬åœ¨è¿è¡Œ,å¦‚æœå°‘äºæŒ‡å®šæ•°é‡çš„<code>Pod</code>å‰¯æœ¬,<code>Replication Controller</code>ä¼šå¯åŠ¨æ–°çš„<code>Pod</code>å‰¯æœ¬,åä¹‹ä¼šæ€æ­»å¤šä½™çš„ä»¥ä¿è¯æ•°é‡ä¸å˜.å¦å¤–<code>Replication Controller</code>æ˜¯å¼¹æ€§ä¼¸ç¼©ã€æ»šåŠ¨å‡çº§çš„å®ç°æ ¸å¿ƒ.</li>
</ul>
<h4 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a><code>Deployment</code></h4><ul>
<li><code>Deployment</code>æ˜¯ä¸€ç§æ›´åŠ ç®€å•çš„æ›´æ–°<code>RC</code>å’Œ<code>Pod</code>çš„æœºåˆ¶.é€šè¿‡åœ¨<code>Deployment</code>ä¸­æè¿°æœŸæœ›çš„é›†ç¾¤çŠ¶æ€,<code>Deployment Controller</code>ä¼šå°†ç°åœ¨çš„é›†ç¾¤çŠ¶æ€åœ¨ä¸€ä¸ªå¯æ§çš„é€Ÿåº¦ä¸‹æ¸æ¸æ›´æ–°æˆæœŸæœ›çš„é›†ç¾¤çŠ¶æ€.<code>Deployment</code>çš„ä¸»è¦çš„èŒè´£åŒæ ·æ˜¯ä¸ºäº†ä¿è¯<code>Pod</code>çš„æ•°é‡å’Œå¥åº·,è€Œä¸”ç»å¤§å¤šæ•°çš„åŠŸèƒ½ä¸<code>Replication Controller</code>å®Œå…¨ä¸€æ ·,å› äº›å¯ä»¥è¢«çœ‹ä½œæ–°ä¸€ä»£çš„<code>RC</code>çš„è¶…é›†.å®ƒçš„ç‰¹æ€§æœ‰:äº‹ä»¶å’ŒçŠ¶æ€æŸ¥çœ‹,å›æ»š,ç‰ˆæœ¬è®°å½•,æš‚åœå’Œå¯åŠ¨,å¤šç§å‡çº§æ–¹æ¡ˆ:<code>Recreate,RollingUpdate</code>.</li>
</ul>
<h4 id="Job"><a href="#Job" class="headerlink" title="Job"></a><code>Job</code></h4><ul>
<li>ä»ç¨‹åºçš„è¿è¡Œå½¢æ€ä¸Šæ¥åŒºåˆ†,æˆ‘ä»¬å¯ä»¥å°†<code>Pod</code>åˆ†æˆä¸¤ç±»:é•¿æœŸè¿è¡ŒæœåŠ¡(jboss,mysql,nginxç­‰)å’Œä¸€æ¬¡æ€§ä»»åŠ¡(å¦‚å¹¶è¡Œæ•°æ®è®¡ç®—,æµ‹è¯•).<code>RC</code>åˆ›å»ºçš„<code>Pod</code>æ˜¯é•¿æ—¶è¿è¡Œçš„æœåŠ¡,è€Œ<code>Job</code>åˆ›å»ºçš„<code>Pod</code>çš„éƒ½æ˜¯ä¸€æ¬¡æ€§ä»»åŠ¡.</li>
</ul>
<h4 id="StatefulSet"><a href="#StatefulSet" class="headerlink" title="StatefulSet"></a><code>StatefulSet</code></h4><ul>
<li><code>StatefulSet</code>æ˜¯åœ¨ä¸æœ‰çŠ¶æ€çš„åº”ç”¨åŠåˆ†å¸ƒå¼ç³»ç»Ÿä¸€èµ·ä½¿ç”¨çš„.<code>StatefulSet</code>ä½¿ç”¨èµ·æ¥ç›¸å¯¹å¤æ‚,å½“åº”ç”¨å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹æ—¶æ‰ä½¿ç”¨å®ƒ.<ul>
<li>æœ‰å”¯ä¸€çš„ç¨³å®šç½‘ç»œæ ‡è¯†ç¬¦éœ€æ±‚.</li>
<li>æœ‰ç¨³å®šæ€§,æŒä¹…åŒ–æ•°æ®å­˜å‚¨éœ€æ±‚.</li>
<li>æœ‰åºçš„éƒ¨ç½²å’Œæ‰©å±•éœ€æ±‚.</li>
<li>æœ‰åºçš„åˆ é™¤å’Œç»ˆæ­¢éœ€æ±‚.</li>
<li>æœ‰åºçš„è‡ªåŠ¨æ»šåŠ¨æ›´æ–°éœ€æ±‚.</li>
</ul>
</li>
</ul>
<h4 id="Service"><a href="#Service" class="headerlink" title="Service"></a><code>Service</code></h4><ul>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/services-networking/service/">Kubernetes Serviceæ–‡æ¡£</a></li>
<li><code>Service</code>æ˜¯çœŸå®åº”ç”¨æœåŠ¡çš„æŠ½è±¡,å®šä¹‰äº†<code>Pod</code>çš„é€»è¾‘é›†åˆå’Œè®¿é—®è¿™ä¸ª<code>Pod</code>é›†åˆçš„ç­–ç•¥,<code>Service</code>å°†ä»£ç†<code>Pod</code>å¯¹å¤–è¡¨ç°ä¸ºä¸€ä¸ªå•ä¸€è®¿é—®æ¥å£,å¤–éƒ¨ä¸éœ€è¦äº†è§£åç«¯<code>Pod</code>å¦‚ä½•è¿è¡Œ,è¿™ç»™æ‰©å±•æˆ–ç»´æŠ¤å¸¦æ¥å¾ˆå¤§çš„å¥½å¤„,æä¾›äº†ä¸€å¥—ç®€åŒ–çš„æœåŠ¡ä»£ç†å’Œå‘ç°æœºåˆ¶.<code>Service</code>å…±æœ‰å››ç§ç±»å‹:<ul>
<li><code>ClusterIP</code>: é€šè¿‡é›†ç¾¤å†…éƒ¨çš„IPåœ°å€æš´éœ²æœåŠ¡,æ­¤åœ°å€ä»…åœ¨é›†ç¾¤å†…éƒ¨å¯è¾¾,è€Œæ— æ³•è¢«é›†ç¾¤å¤–éƒ¨çš„å®¢æˆ·ç«¯è®¿é—®,æ­¤ä¸ºé»˜è®¤çš„<code>Service</code>ç±»å‹.</li>
<li><code>NodePort</code>: è¿™ç§ç±»å‹å»ºç«‹åœ¨<code>ClusterIP</code>ç±»å‹ä¹‹æ­¢,å…¶åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„IPåœ°å€çš„æŸé™æ€ç«¯å£(NodePort)æš´éœ²æœåŠ¡,å› æ­¤,å®ƒä¾ç„¶ä¼šä¸º<code>Service</code>åˆ†é…é›†ç¾¤IPåœ°å€,å¹¶å°†æ­¤ä½œä¸º<code>NodePort</code>çš„è·¯ç”±ç›®æ ‡.</li>
<li><code>LoadBalancer</code>: è¿™ç§ç±»å‹å»ºæ„åœ¨<code>NodePort</code>ç±»å‹ä¹‹ä¸Š,å…¶é€šè¿‡<code>cloud provider</code>æä¾›çš„è´Ÿè½½å‡è¡¡å™¨å°†æœåŠ¡æš´éœ²åˆ°é›†ç¾¤å¤–éƒ¨.å› æ­¤<code>LoadBalancer</code>ä¸€æ ·å…·æœ‰<code>NodePort</code>å’Œ<code>ClusterIP</code>.(ç›®å‰åªæœ‰äº‘æœåŠ¡å•†æ‰å¯æ”¯æŒ,å¦‚æœæ˜¯ç”¨<code>VirtualBox</code>åšå®éªŒ,åªèƒ½æ˜¯<code>ClusterIP</code>æˆ–<code>NodePort</code>)</li>
<li><code>ExternalName</code>: å…¶é€šè¿‡å°†<code>Service</code>æ˜ å°„åˆ°ç”±<code>externalName</code>å­—æ®µçš„å†…å®¹æŒ‡å®šçš„ä¸»æœºåæ¥æš´éœ²æœåŠ¡,æ­¤ä¸»æœºåéœ€è¦è¢«<code>DNS</code>æœåŠ¡è§£æåˆ°<code>CNAME</code>ç±»å‹çš„è®°å½•.</li>
</ul>
</li>
</ul>
<h4 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a><code>Ingress</code></h4><ul>
<li><code>Ingrees</code>èµ„æº,å®ƒå®ç°çš„æ˜¯â€<code>HTTP(S)è´Ÿè½½å‡è¡¡å™¨</code>â€œ,å®ƒæ˜¯<code>k8s API</code>çš„æ ‡å‡†èµ„æºç±»å‹ä¹‹ä¸€,å®ƒå…¶å®å°±æ˜¯åŸºäºDNSåç§°æˆ–URLè·¯å¾„æŠŠè¯·æ±‚è½¬å‘åˆ°æŒ‡å®šçš„<code>Service</code>èµ„æºçš„è§„åˆ™,ç”¨äºå°†é›†ç¾¤å¤–éƒ¨çš„è¯·æ±‚æµé‡è½¬å‘åˆ°é›†ç¾¤å†…éƒ¨å®ŒæˆæœåŠ¡å‘å¸ƒ,<code>Ingress</code>èµ„æºè‡ªèº«å¹¶ä¸èƒ½è¿›è¡Œæµé‡ç©¿é€,å®ƒä»…æ˜¯ä¸€ç»„è·¯ç”±è§„åˆ™çš„é›†åˆ. ä¸åŒäº<code>Deployment</code>æ§åˆ¶å™¨ç­‰,<code>Ingress</code>æ§åˆ¶å™¨å¹¶ä¸ç›´æ¥è¿è¡Œä¸º<code>kube-controller-manager</code>çš„ä¸€éƒ¨åˆ†,å®ƒæ˜¯<code>k8s</code>é›†ç¾¤çš„ä¸€ä¸ªé‡è¦é™„ä»¶,ç±»ä¼¼äº<code>CoreDNS</code>,éœ€è¦åœ¨é›†ç¾¤ä¸Šå•ç‹¬éƒ¨ç½².</li>
</ul>
<h4 id="Label"><a href="#Label" class="headerlink" title="Label"></a><code>Label</code></h4><ul>
<li><code>Label</code>æ˜¯ç”¨äºåŒºåˆ†<code>Podã€Serviceã€Replication Controller</code>çš„<code>Key/Value</code>é”®å€¼å¯¹,å®é™…ä¸Š<code>Kubernetes</code>ä¸­çš„ä»»æ„<code>API</code>å¯¹è±¡éƒ½å¯ä»¥é€šè¿‡<code>Label</code>è¿›è¡Œæ ‡è¯†.æ¯ä¸ª<code>API</code>å¯¹è±¡å¯ä»¥æœ‰å¤šä¸ª<code>Label</code>,ä½†æ˜¯æ¯ä¸ª<code>Label</code>çš„<code>Key</code>åªèƒ½å¯¹åº”ä¸€ä¸ª<code>Value</code>.<code>Label</code>æ˜¯<code>Service</code>å’Œ<code>Replication Controller</code>è¿è¡Œçš„åŸºç¡€,å®ƒä»¬éƒ½é€šè¿‡<code>Label</code>æ¥å…³è”<code>Pod</code>,ç›¸æ¯”äºå¼ºç»‘å®šæ¨¡å‹,è¿™æ˜¯ä¸€ç§éå¸¸å¥½çš„æ¾è€¦åˆå…³ç³».</li>
</ul>
<h4 id="Node"><a href="#Node" class="headerlink" title="Node"></a><code>Node</code></h4><ul>
<li><code>Kubernets</code>å±äºä¸»ä»çš„åˆ†å¸ƒå¼é›†ç¾¤æ¶æ„,<code>Kubernets Node</code>(ç®€ç§°ä¸º<code>Node</code>,æ—©æœŸç‰ˆæœ¬å«åš<code>Minion</code>)è¿è¡Œå¹¶ç®¡ç†å®¹å™¨.<code>Node</code>ä½œä¸º<code>Kubernetes</code>çš„æ“ä½œå•å…ƒ,å°†ç”¨æ¥åˆ†é…ç»™<code>Pod</code>(æˆ–è€…è¯´å®¹å™¨)è¿›è¡Œç»‘å®š,<code>Pod</code>æœ€ç»ˆè¿è¡Œåœ¨<code>Node</code>ä¸Š,<code>Node</code>å¯ä»¥è®¤ä¸ºæ˜¯<code>Pod</code>çš„å®¿ä¸»æœº.</li>
</ul>
<h3 id="Kubernetesæ¶æ„"><a href="#Kubernetesæ¶æ„" class="headerlink" title="Kubernetesæ¶æ„"></a><code>Kubernetes</code>æ¶æ„</h3><h4 id="MasterèŠ‚ç‚¹"><a href="#MasterèŠ‚ç‚¹" class="headerlink" title="MasterèŠ‚ç‚¹"></a><code>Master</code>èŠ‚ç‚¹</h4><ul>
<li><code>Master</code>æ˜¯<code>k8s</code>é›†ç¾¤çš„å¤§è„‘,è¿è¡ŒæœåŠ¡æœ‰:<ul>
<li>kube-apiserver</li>
<li>kube-scheduler</li>
<li>kube-controller-manager</li>
<li>etcd,Pod ç½‘ç»œ(å¦‚ Flannel,Canal)</li>
</ul>
</li>
</ul>
<h5 id="API-Server-kube-apiserver"><a href="#API-Server-kube-apiserver" class="headerlink" title="API Server(kube-apiserver)"></a><code>API Server(kube-apiserver)</code></h5><ul>
<li><code>Api Server</code>æ˜¯<code>k8s</code>é›†ç¾¤çš„å‰ç«¯æ¥å£,å„ç§å·¥å…·å¯ä»¥é€šè¿‡å®ƒç®¡ç†<code>Cluster</code>çš„å„ç§èµ„æº.</li>
</ul>
<h5 id="Scheduler-kube-scheduler"><a href="#Scheduler-kube-scheduler" class="headerlink" title="Scheduler(kube-scheduler)"></a><code>Scheduler(kube-scheduler)</code></h5><ul>
<li><code>Scheduler</code>è´Ÿè´£å†³å®šå°†<code>Pod</code>æ”¾åœ¨é‚£ä¸ª<code>Node</code>ä¸Šè¿è¡Œ.å®ƒè°ƒè¯•æ—¶ä¼šå……åˆ†è€ƒè™‘<code>Cluster </code>çš„æ‹“æ‰‘ç»“æ„,æ‰¾åˆ°ä¸€ä¸ªæœ€ä¼˜æ–¹æ¡ˆ.</li>
</ul>
<h5 id="Controller-Manager-kube-controller-manager"><a href="#Controller-Manager-kube-controller-manager" class="headerlink" title="Controller Manager(kube-controller-manager)"></a><code>Controller Manager(kube-controller-manager)</code></h5><ul>
<li><code>Controller Manager</code>è´Ÿè´£ç®¡ç†<code>Cluster </code>å„ç§èµ„æº.ä¿è¯èµ„æºçš„å¤„äºé¢„æœŸçš„çŠ¶æ€.å®ƒæ˜¯ç”±å¤šç§<code>controller</code> ç»„æˆçš„.</li>
</ul>
<h5 id="etcd"><a href="#etcd" class="headerlink" title="etcd"></a><code>etcd</code></h5><ul>
<li><code>etcd</code>è´Ÿè´£ä¿å­˜<code>k8s</code>çš„é…ç½®ä¿¡æ¯å’Œå„ç§èµ„æºçš„çŠ¶æ€ä¿¡æ¯.å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶,<code>etcd</code>ä¼šå¿«é€Ÿåœ°é€šçŸ¥<code>k8s</code>ç›¸å…³ç»„ä»¶.</li>
</ul>
<h5 id="Podç½‘ç»œ"><a href="#Podç½‘ç»œ" class="headerlink" title="Podç½‘ç»œ"></a><code>Pod</code>ç½‘ç»œ</h5><p>-<code>Pod</code>è¦èƒ½å¤Ÿç›¸äº’é€šä¿¡,<code>k8s</code>å¿…é¡»éƒ¨ç½²<code>Pod</code>ç½‘ç»œ,<code>flannel</code> æ˜¯å…¶ä¸­ä¸€ä¸ªå¯é€‰çš„æ–¹æ¡ˆ.</p>
<h4 id="NodeèŠ‚ç‚¹"><a href="#NodeèŠ‚ç‚¹" class="headerlink" title="NodeèŠ‚ç‚¹"></a><code>Node</code>èŠ‚ç‚¹</h4><ul>
<li><code>Node</code>æ˜¯<code>Pod</code>è¿è¡Œçš„åœ°æ–¹,<code>k8s</code> æ”¯æŒ<code>Docker,rkt</code>ç­‰å®¹å™¨çš„<code>Runtime</code>.å®ƒä¸Šé¢è¿è¡Œçš„ç»„ä»¶æœ‰<code>kubelet,kube-proxy,Pod</code>ç½‘ç»œ.</li>
</ul>
<h5 id="kubelet"><a href="#kubelet" class="headerlink" title="kubelet"></a><code>kubelet</code></h5><ul>
<li><code>kubelet</code>æ˜¯<code>Node</code>çš„<code>agent</code>,å½“<code>Scheduler</code>ç¡®å®šåœ¨æŸä¸ª<code>Node</code>ä¸Šè¿è¡Œ<code>Pod</code>å,ä¼šå°†<code>Pod</code>çš„å…·ä½“é…ç½®ä¿¡æ¯(image,volume)å‘ç»™è¯¥èŠ‚ç‚¹çš„<code>kubelet</code>.<code>kubelet</code>æ ¹æ®è¿™è¯¥ä¿¡æ¯åˆ›å»ºå„è¿è¡Œå®¹å™¨,å¹¶å‘<code>master</code>æŠ¥å‘ŠçŠ¶æ€.</li>
</ul>
<h5 id="kube-proxy"><a href="#kube-proxy" class="headerlink" title="kube-proxy"></a><code>kube-proxy</code></h5><ul>
<li><code>service</code>åœ¨é€»è¾‘ä¸Šä»£è¡¨äº†åç«¯çš„å¤šä¸ª<code>Pod</code>,å¤–ç•Œé€šè¿‡<code>service</code>è®¿é—®<code>Pod</code>.service æ¥æ”¶åˆ°çš„è¯·æ±‚æ˜¯å¦‚ä½•è½¬å‘åˆ°ç›¸åº”çš„<code>Pod</code>.å¦‚æœ‰å¤šä¸ªå‰¯æœ¬,<code>kube-proxy</code>ä¼šå®ç°è´Ÿè½½å‡è¡¡.</li>
</ul>
<h5 id="Secret-ConfigMap"><a href="#Secret-ConfigMap" class="headerlink" title="Secret &amp; ConfigMap"></a><code>Secret &amp; ConfigMap</code></h5><ul>
<li><code>Secret</code>å¯ä»¥ä¸º<code>Pod</code>æä¾›å¯†ç ,<code>Token</code>,ç§é’¥ç­‰æ•æ„Ÿæ•°æ®;å¯¹äºä¸€äº›éæ•æ„Ÿçš„æ•°æ®,æ¯”å¦‚åº”ç”¨çš„é…ç½®ä¿¡æ¯,å¯ä»¥ä½¿ç”¨<code>ConfigMap</code>.</li>
</ul>
<h4 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h4><h5 id="ç½‘ç»œç›¸å…³"><a href="#ç½‘ç»œç›¸å…³" class="headerlink" title="ç½‘ç»œç›¸å…³"></a>ç½‘ç»œç›¸å…³</h5><ul>
<li><strong>ACI</strong> provides integrated container networking and network security with Cisco ACI.</li>
<li><strong>Calico</strong> is a secure L3 networking and network policy provider.</li>
<li><strong>Canal</strong> unites Flannel and Calico, providing networking and network policy.</li>
<li><strong>Cilium</strong> is a L3 network and network policy plugin that can enforce HTTP&#x2F;API&#x2F;L7 policies transparently. Both routing and overlay&#x2F;encapsulation mode are supported.</li>
<li><strong>CNI-Genie</strong> enables Kubernetes to seamlessly connect to a choice of CNI plugins, such as Calico, Canal, Flannel, Romana, or Weave.</li>
<li><strong>Contiv</strong> provides configurable networking (native L3 using BGP, overlay using vxlan, classic L2, and Cisco-SDN&#x2F;ACI) for various use cases and a rich policy framework.  Contiv project is fully open sourced. The installer provides both kubeadm and non-kubeadm based installation options.</li>
<li><strong>Contrail</strong>, based on Tungsten Fabric, is a open source, multi-cloud network virtualization and policy management platform. Contrail and Tungsten Fabric are integrated with  orchestration systems such as Kubernetes, OpenShift, OpenStack and Mesos, and provide isolation modes for virtual machines, containers&#x2F;pods and bare metal workloads.</li>
<li><strong>Flannel</strong> is an overlay network provider that can be used with Kubernetes.</li>
<li><strong>Knitter</strong> is a network solution supporting multiple networking in Kubernetes.</li>
<li><strong>Multus</strong> is a Multi plugin for multiple network support in Kubernetes to support all CNI plugins (e.g. Calico, Cilium, Contiv, Flannel), in addition to SRIOV, DPDK, OVS-DPDK and VPP based workloads in Kubernetes.</li>
<li><strong>NSX-T</strong> Container Plug-in (NCP) provides integration between VMware NSX-T and container orchestrators such as Kubernetes, as well as integration between NSX-T and \     container-based CaaS&#x2F;PaaS platforms such as Pivotal Container Service (PKS) and OpenShift.</li>
<li><strong>Nuage</strong> is an SDN platform that provides policy-based networking between Kubernetes Pods and non-Kubernetes environments with visibility and security monitoring.</li>
<li><strong>Romana</strong> is a Layer 3 networking solution for<code>Pod</code>networks that also supports the NetworkPolicy API. Kubeadm add-on installation details available here.</li>
<li><strong>Weave Net</strong> provides networking and network policy, will carry on working on both sides of a network partition, and does not require an external database.</li>
</ul>
<h5 id="æœåŠ¡å‘ç°"><a href="#æœåŠ¡å‘ç°" class="headerlink" title="æœåŠ¡å‘ç°"></a>æœåŠ¡å‘ç°</h5><ul>
<li><strong>CoreDNS</strong> is a flexible, extensible DNS server which can be installed as the in-cluster DNS for pods.</li>
</ul>
<h5 id="å¯è§†åŒ–é¢æ¿"><a href="#å¯è§†åŒ–é¢æ¿" class="headerlink" title="å¯è§†åŒ–é¢æ¿"></a>å¯è§†åŒ–é¢æ¿</h5><ul>
<li><strong>Dashboard</strong> is a dashboard web interface for Kubernetes.</li>
<li><strong>Weave Scope</strong> is a tool for graphically visualizing your containers, pods, services etc. Use it in conjunction with a Weave Cloud account or host the UI yourself.</li>
</ul>
<h2 id="å®‰è£…Minikube"><a href="#å®‰è£…Minikube" class="headerlink" title="å®‰è£…Minikube"></a>å®‰è£…<code>Minikube</code></h2><ul>
<li>é“¾æ¥:<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/minikube">Github - minikube</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubectl">Github - kubectl</a></li>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/minikube/">Running Kubernetes Locally via Minikube</a></li>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/">Creating a single master cluster with kubeadm</a></li>
<li><a target="_blank" rel="noopener" href="https://jimmysong.io/kubernetes-handbook/">Kubernetes ä¸­æ–‡æŒ‡å—&#x2F;äº‘åŸç”Ÿåº”ç”¨æ¶æ„å®è·µæ‰‹å†Œ</a></li>
<li><a target="_blank" rel="noopener" href="https://kubevirt.io/2018/Hello-KubeVirt-on-Minikube.html">Hello Kubevirt On Minikube</a></li>
<li><a target="_blank" rel="noopener" href="https://computingforgeeks.com/how-to-run-minikube-on-kvm/">How to run Minikube on KVM</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/linagora-engineering/install-k8s-minikube-on-top-of-kvm-on-debian-9-9cd5b646063c">Install k8s Minikube on top of KVM on Debian 9</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.okd.io/latest/install_config/storage_examples/shared_storage.html">Sharing an NFS Persistent Volume (PV) Across Two Pods</a></li>
</ul>
</li>
</ul>
<ul>
<li>ä½¿ç”¨<code>Minikube</code> æ˜¯è¿è¡Œ <code>Kubernetes</code> é›†ç¾¤æœ€ç®€å•,æœ€å¿«æ·çš„é€”è·¯å¾„.<code>Minikube</code>æ˜¯ä¸€ä¸ªæ„å»ºå•èŠ‚ç‚¹é›†ç¾¤çš„å·¥å…·,å¯¹äºæµ‹è¯•<code>Kubernetes</code>å’Œæœ¬åœ°å¼€å‘åº”ç”¨éƒ½éå¸¸æœ‰ç”¨,è¿™é‡Œåœ¨<code>Debian</code>ä¸‹å®‰è£…,å®ƒé»˜è®¤ä¼šè¦ä½¿ç”¨åˆ°<code>VirtualBox</code>è™šæ‹Ÿæœºä¸ºé©±åŠ¨,ä¹Ÿå¯ä»¥å®‰è£…<code>kvm2</code>ä¸ºé©±åŠ¨.<code>Minikube</code>çš„å‚è€ƒæ–‡æ¡£<a target="_blank" rel="noopener" href="https://docs.docker.com/machine/">docker-machine</a>çš„å‚æ•°.</li>
<li>ç¬¬ä¸€æ¬¡ä½¿ç”¨<code>minikube start</code>,å®ƒä¼šåœ¨åˆ›å»ºä¸€ä¸ª<code>~/.minikube</code>ç›®å½•,ä¼šä¸‹è½½<a target="_blank" rel="noopener" href="https://storage.googleapis.com/minikube/iso/minikube-v0.35.0.iso">minikube-vxxx.iso</a>åˆ°<code>~/.minikube/cache/</code>ä¸‹é¢,å¦‚æœä¸‹è½½ååˆ†ç¼“æ…¢,å¯ä»¥æ‰‹åŠ¨<code>https://storage.googleapis.com/minikube/iso/minikube-v0.35.0.iso</code>ä¸‹è½½å¤åˆ¶åˆ°ç›®å½•ä¸‹.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.35.0/minikube-linux-amd64 &amp;&amp; <span class="built_in">chmod</span> +x minikube &amp;&amp; sudo <span class="built_in">cp</span> minikube /usr/local/bin/ &amp;&amp; <span class="built_in">rm</span> minikube</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ä»è¿™é‡Œhttps://storage.googleapis.com/minikube/releases/v0.35.0/minikube-linux-amd64ä¸‹è½½.</span></span><br><span class="line"><span class="comment"># ä¸‹è½½kvm2é©±åŠ¨</span></span><br><span class="line">~$ wget https://github.com/kubernetes/minikube/releases/download/v0.35.0/docker-machine-driver-kvm2</span><br><span class="line">~$ <span class="built_in">chmod</span> +x docker-machine-driver-kvm2 &amp;&amp; <span class="built_in">mv</span> docker-machine-driver-kvm2 /usr/local/bin &amp;&amp; <span class="built_in">rm</span> minikube</span><br></pre></td></tr></table></figure>

<ul>
<li>å¯åŠ¨ä¸€ä¸ª<code>Minikube</code>è™šæ‹Ÿæœº,å¦‚æœç›´æ¥<code>minikube start</code>å°±ä¼šé»˜è®¤ä½¿ç”¨<code>VirtualBox</code>å¯åŠ¨.ç½‘ç»œéƒ¨åˆ†ä½¿ç”¨<code>default</code>.<code>--kvm-network</code>çš„å‚æ•°,æ¥æºäº<code>virsh net-list</code>.<code>minikube-net</code>æ˜¯ä¸€ä¸ªéš”ç¦»çš„ç½‘ç»œ,ä¹Ÿä¸æ˜¯è¯´ä¸èƒ½è”ç½‘çš„,å¦‚æœéœ€è¦è¿ç½‘,è¦ä¸æœ¬æœºçš„ç½‘å¡æˆ–è€…ç½‘ç»œåšæ¡¥æ¥æˆ–<code>NAT</code>.</li>
<li><code>k8s.gcr.io</code>åœ¨å›½å†…æ˜¯æ— æ³•ç›´æ¥è®¿é—®çš„,æ‰€ä»¥ä¼šé€ æˆ<code>minikube</code>æ— æ³•æ‹–å–ç›¸å…³çš„é•œåƒ,æœ€ç»ˆå¯¼è‡´<code>minikube</code>æ— æ³•æ­£å¸¸ä½¿ç”¨.åœ¨æ­¤æœ‰å‡ ä¸ªæ–¹æ³•å¯ä»¥å˜é€šä¸€ä¸‹,æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä»£ç†:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--docker-env HTTP_PROXY=&lt;ip:port&gt; --docker-env HTTPS_PROXY=&lt;ip:port&gt; --docker-env NO_PROXY=127.0.0.1,localhost`</span><br></pre></td></tr></table></figure></li>
<li>å¦‚æœæœåŠ¡å™¨å¯ä»¥è®¿é—®å¤–ç½‘,åˆ™å¯åœ¨<code>docker daemon</code>çš„å¯åŠ¨å‚æ•°(<code>/etc/sysconfig/docker</code>)ä¸­<code>OPTIONS</code><br>åŠ ä¸Š<code>--insecure-registry k8s.gcr.io</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">~$  minikube start --vm-driver=kvm2 --kvm-network minikube-net --registry-mirror=https://registry.docker-cn.com --kubernetes-version v1.14.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»é˜¿é‡Œä¸‹è½½è¿‡æ¥,æœ€å¥½æ˜¯å¯ä»¥ä½¿ç”¨ä»£ç†ç›´æ¥ä»k8s.gcr.ioä¸‹è½½.</span></span><br><span class="line">~$ docker pull  registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.14.0</span><br><span class="line">~$ docker pull  registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.14.0</span><br><span class="line">~$ docker pull  registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.14.0</span><br><span class="line">~$ docker pull  registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.14.0</span><br><span class="line">~$ docker pull  registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.3.1</span><br><span class="line">~$ docker pull  registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.3.10</span><br><span class="line">~$ docker pull  registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨è„šæœ¬æ‰¹é‡æŠŠå®ƒä»¬æ¢tag,ä¹Ÿå¯ä»¥æŠŠå®ƒæ¨é€åˆ°è‡ªå·±å…¬å¸çš„ç§æœ‰ä»“åº“ä¸­å»,æµ‹è¯•ä½¿ç”¨é‡å†™TAGçš„æ–¹æ³•å¥½åƒä¸è¡Œ,è¿˜æ˜¯è¦ç”¨ä»£ç†æ‰èƒ½æ­£å¸¸ä¸‹è½½.</span></span><br><span class="line">~$ docker images | grep <span class="string">&quot;aliyuncs.com&quot;</span> | awk <span class="string">&#x27;&#123;split($1,a,&quot;/&quot;); print &quot;docker tag &quot; $1&quot;:&quot;$2 &quot; k8s.gcr.io/&quot;a[3]&quot;:&quot;$2&#125;&#x27;</span></span><br><span class="line">~$ docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.14.0 k8s.gcr.io/kube-proxy:v1.14.0</span><br><span class="line">~$ docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.14.0 k8s.gcr.io/kube-apiserver:v1.14.0</span><br><span class="line">~$ docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.14.0 k8s.gcr.io/kube-scheduler:v1.14.0</span><br><span class="line">~$ docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.14.0 k8s.gcr.io/kube-controller-manager:v1.14.0</span><br><span class="line">~$ docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.3.1 k8s.gcr.io/coredns:1.3.1</span><br><span class="line">~$ docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.3.10 k8s.gcr.io/etcd:3.3.10</span><br><span class="line">~$ docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1 k8s.gcr.io/pause:3.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†ç”¨æ‰‹åŠ¨åˆå§‹åŒ–è¿™äº›imageåˆ°å®¹å™¨</span></span><br><span class="line">~$ sudo kubeadm init --kubernetes-version=v1.14.0</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ç»è¿‡æµ‹è¯•ç›´æ¥ä½¿ç”¨<code>kubeadm</code>ä¹Ÿå¯ä»¥ç›´æ¥æ‹‰å–å…¶å®ƒçš„å›½å†…é•œåƒè¿›è¡Œå®‰è£…,ä½¿ç”¨ä»£ç†ä¹Ÿå¯ä»¥å®‰è£…,è€ƒè™‘åˆ°æ‰¾åˆ°ä¸€ä¸ªç¨³å®šå¯é çš„ä»£ç†è¿˜æ˜¯æœ‰ä¸€äº›éš¾åº¦.å› ä¸º<code>minikube start --vm-driver=kvm2</code>æ˜¯ç›´æ¥åœ¨åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœº,å¹¶é€šè¿‡<code>sudo kubeadm config images pull --config /var/lib/kubeadm.yaml</code>åœ¨è™šæ‹Ÿæœºæ‹‰å–ç›¸åº”çš„<code>docker</code>é•œåƒç»„ä»¶åˆ°æœ¬åœ°éƒ¨ç½²å„ç§<code>k8s</code>çš„æœåŠ¡.å®ƒé»˜è®¤æ˜¯ä½¿ç”¨<code>https://k8s.gcr.io/v2/</code>è¿™åŸŸåå»æ‹‰å–é•œåƒ,</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ minikube start --vm-driver=kvm2 --kvm-network minikube-net --registry-mirror=https://registry.docker-cn.com</span><br></pre></td></tr></table></figure></li>
<li><p>å‘ç°å‚æ•°<code>--registry-mirror</code>å¹¶æ²¡æœ‰èµ·ä½œç”¨,è¿˜æ˜¯ä¼šæŠ¥é”™å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> Unable to pull images, <span class="built_in">which</span> may be OK: running cmd: sudo kubeadm config images pull --config /var/lib/kubeadm.yaml: <span class="built_in">command</span> failed: sudo kubeadm config images pull --config /var/lib/kubeadm.yaml</span><br><span class="line">stdout:</span><br><span class="line">stderr: failed to pull image <span class="string">&quot;k8s.gcr.io/kube-apiserver:v1.14.0&quot;</span>: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="keyword">while</span> waiting <span class="keyword">for</span> connection (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸‹è½½<code>kubectl</code>åˆ°æœ¬åœ°å¼€å‘æœºå™¨(æ§åˆ¶ç«¯)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl</span><br><span class="line">~$ <span class="built_in">chmod</span> +x kubectl &amp;&amp; sudo <span class="built_in">mv</span> kubectl /usr/local/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å…¥è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</span></span><br><span class="line">~$ <span class="built_in">echo</span> <span class="string">&quot;source &lt;(kubectl completion bash)&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line">~$ kubectl get nodes</span><br><span class="line">NAME       STATUS   ROLES    AGE   VERSION</span><br><span class="line">minikube   Ready    &lt;none&gt;   94m   v1.13.4</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="æºç ç¼–è¯‘Minikube"><a href="#æºç ç¼–è¯‘Minikube" class="headerlink" title="æºç ç¼–è¯‘Minikube"></a>æºç ç¼–è¯‘<code>Minikube</code></h1><ul>
<li><p>ä¸‹è½½æœ€æ–°GOè¯­è¨€ç¼–è¯‘å™¨</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ wget -c https://golang.google.cn/doc/install?download=go1.12.4.linux-amd64.tar.gz</span><br><span class="line">~$ sudo tar xvf go1.12.4.linux-amd64.tar.gz -C /opt/</span><br><span class="line">~$ <span class="built_in">export</span> PATH=/opt/go/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸‹è½½æºç ,è¦å…ˆåˆ›å»º<code>/opt/go/src/k8s.io</code>ç›®å½•,åœ¨è¯¥ç›®å½•ä¸‹å…‹éš†ä»£ç .å¹¶ä¸”ä¿®æ”¹é•œåƒåœ°å€</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo <span class="built_in">mkdir</span> /opt/go/src/k8s.io &amp;&amp; <span class="built_in">cd</span> /opt/go/src/k8s.io &amp;&amp;   git <span class="built_in">clone</span> https://github.com/kubernetes/minikube.git</span><br><span class="line">~$ <span class="built_in">cd</span> minikube &amp;&amp; <span class="keyword">for</span> item <span class="keyword">in</span> `grep  -l <span class="string">&quot;k8s.gcr.io&quot;</span> -r *`;<span class="keyword">do</span> sed -i <span class="string">&quot;s#k8s.gcr.io#registry.cn-hangzhou.aliyuncs.com/google_containers#g&quot;</span> <span class="variable">$item</span>  ;<span class="keyword">done</span></span><br><span class="line">~$ make</span><br><span class="line">~$ sudo <span class="built_in">cp</span> out/minikube-linux-amd64 /usr/local/bin/minikube</span><br></pre></td></tr></table></figure></li>
<li><p>ç»¼ä¸Šæ‰€è¿°,å› ä¸ºä½¿ç”¨<code>docker tag</code>è¿˜æ˜¯æœ‰é—®é¢˜,æºç æ„å»ºçš„<code>Minikube</code>å¯ä»¥å®Œç¾è§£å†³å¢™çš„é—®é¢˜,å¦‚æœå»ç½‘ä¸Šä¸‹è½½ç¬¬ä¸‰æ–¹çš„<code>Minikube</code>äºŒè¿›åˆ¶æ€•æœ‰å¤¹å¸¦ç§è´§çš„é—®é¢˜.</p>
</li>
</ul>
<h2 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âŒ›  Waiting <span class="keyword">for</span> pods: apiserver proxyğŸ’£  Error restarting cluster: <span class="built_in">wait</span>: waiting <span class="keyword">for</span> k8s-app=kube-proxy: timed out waiting <span class="keyword">for</span> the condition</span><br><span class="line"></span><br><span class="line">ğŸ˜¿  Sorry that minikube crashed. If this was unexpected, we would love to hear from you:</span><br><span class="line">ğŸ‘‰  https://github.com/kubernetes/minikube/issues/new</span><br></pre></td></tr></table></figure>

<h1 id="æ‰‹åŠ¨å¸ƒç½²å®‰è£…Kubernetesç»„ä»¶"><a href="#æ‰‹åŠ¨å¸ƒç½²å®‰è£…Kubernetesç»„ä»¶" class="headerlink" title="æ‰‹åŠ¨å¸ƒç½²å®‰è£…Kubernetesç»„ä»¶"></a>æ‰‹åŠ¨å¸ƒç½²å®‰è£…<code>Kubernetes</code>ç»„ä»¶</h1><ul>
<li>Links:<ul>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/independent/install-kubeadm/">Installing kubeadm</a></li>
<li><a target="_blank" rel="noopener" href="https://yq.aliyun.com/teams/11/type_blog-cid_200-page_1">é˜¿é‡Œäº‘â€“å®¹å™¨æœåŠ¡ Docker&amp;Kubernetes å®¹å™¨æœåŠ¡ Docker&amp;Kubernetes</a></li>
<li><a target="_blank" rel="noopener" href="https://ieevee.com/tech/2018/09/01/kubeadm.html">å¢™å†…å®‰è£… kubernetes æ•™ç¨‹</a></li>
<li><a target="_blank" rel="noopener" href="http://mirrors.ustc.edu.cn/">ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å¼€æºè½¯ä»¶é•œåƒ</a></li>
</ul>
</li>
</ul>
<h2 id="Debian-Ubuntuå‘è¡Œç‰ˆå®‰è£…kubeadm"><a href="#Debian-Ubuntuå‘è¡Œç‰ˆå®‰è£…kubeadm" class="headerlink" title="Debian,Ubuntuå‘è¡Œç‰ˆå®‰è£…kubeadm"></a><code>Debian,Ubuntu</code>å‘è¡Œç‰ˆå®‰è£…<code>kubeadm</code></h2><ul>
<li>kubeadm: the command to bootstrap the cluster.</li>
<li>kubelet: the component that runs on all of the machines in your cluster and does things like starting pods and containers.</li>
<li>kubectl: the command line util to talk to your cluster.</li>
<li>ä¸­æ–‡<ul>
<li><code>kubeadm</code>: ç”¨æ¥åˆå§‹åŒ–é›†ç¾¤çš„æŒ‡ä»¤.</li>
<li><code>kubelet</code>: åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨<code>Pod</code>å’Œ<code>container</code>ç­‰.</li>
<li><code>kubectl</code>: ç”¨æ¥ä¸é›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·.</li>
</ul>
</li>
<li>è¿™ä¸‰ä¸ªç»„ä»¶çš„å®‰è£…æ—¶å€™è¦æ³¨æ„å®ƒä»¬ä¹‹é—´çš„ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜.</li>
</ul>
<h3 id="å®˜æ–¹è½¯ä»¶ä»“åº“-åœ¨å›½å†…ä¸èƒ½ä½¿ç”¨"><a href="#å®˜æ–¹è½¯ä»¶ä»“åº“-åœ¨å›½å†…ä¸èƒ½ä½¿ç”¨" class="headerlink" title="å®˜æ–¹è½¯ä»¶ä»“åº“,åœ¨å›½å†…ä¸èƒ½ä½¿ç”¨"></a>å®˜æ–¹è½¯ä»¶ä»“åº“,åœ¨å›½å†…ä¸èƒ½ä½¿ç”¨</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~$ apt-get update &amp;&amp; apt-get install -y apt-transport-https curl dirmngr</span><br><span class="line">~$ curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -</span><br><span class="line"><span class="comment"># æˆ–è€…ç”¨å¦‚ä¸‹çš„æ–¹å¼å®‰è£…å…¬é’¥,éœ€è¦ä¾èµ–å®‰è£…dirmngr</span></span><br><span class="line">~$ sudo apt-key  adv --keyserver  keyserver.ubuntu.com --recv-keys  6A030B21BA07F4FB</span><br><span class="line">~$ sudo bash -c <span class="string">&quot;cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span></span><br><span class="line"><span class="string">    deb https://apt.kubernetes.io/ kubernetes-xenial main</span></span><br><span class="line"><span class="string">    EOF&quot;</span></span><br><span class="line"><span class="comment"># ç»æµ‹è¯• apt.kubernetes.io é‡å®šå‘åˆ°k8s.ioä¸èƒ½è®¿é—®,å¯ä»¥ä½¿ç”¨å›½å†…é•œåƒ http://mirrors.ustc.edu.cn/kubernetes/</span></span><br><span class="line">~$ apt-get update</span><br><span class="line">~$ apt-get install -y kubelet kubeadm kubectl</span><br><span class="line">~$ apt-mark hold kubelet kubeadm kubectl</span><br></pre></td></tr></table></figure>

<h3 id="é˜¿é‡Œäº‘é•œåƒä»“åº“"><a href="#é˜¿é‡Œäº‘é•œåƒä»“åº“" class="headerlink" title="é˜¿é‡Œäº‘é•œåƒä»“åº“"></a>é˜¿é‡Œäº‘é•œåƒä»“åº“</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~$ apt-get update &amp;&amp; apt-get install -y apt-transport-https</span><br><span class="line">~$ curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add -</span><br><span class="line">~$ sudo bash -c <span class="string">&quot;cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span></span><br><span class="line"><span class="string">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main</span></span><br><span class="line"><span class="string">EOF&quot;</span></span><br><span class="line">~$ sudo apt-get update &amp;&amp; sudo apt-get install kubelet kubeadm kubectl -y</span><br><span class="line">~$ sudo apt-mark hold kubelet kubeadm kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨curlä¸‹è½½äºŒè¿›åˆ¶ ,è¦ç”¨ä»£ç†.</span></span><br><span class="line">~$ curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/darwin/amd64/kubectl</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>æŸ¥è¯¢å½“å‰ç‰ˆæœ¬éœ€è¦é‚£äº›<code>docker image</code>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ kubeadm config images list --kubernetes-version v1.14.0</span><br><span class="line">k8s.gcr.io/kube-apiserver:v1.14.0</span><br><span class="line">k8s.gcr.io/kube-controller-manager:v1.14.0</span><br><span class="line">k8s.gcr.io/kube-scheduler:v1.14.0</span><br><span class="line">k8s.gcr.io/kube-proxy:v1.14.0</span><br><span class="line">k8s.gcr.io/pause:3.1</span><br><span class="line">k8s.gcr.io/etcd:3.3.10</span><br><span class="line">k8s.gcr.io/coredns:1.3.1</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…MasterèŠ‚ç‚¹"><a href="#å®‰è£…MasterèŠ‚ç‚¹" class="headerlink" title="å®‰è£…MasterèŠ‚ç‚¹"></a>å®‰è£…<code>Master</code>èŠ‚ç‚¹</h3><h4 id="ç½‘ç»œæ¨¡å‹"><a href="#ç½‘ç»œæ¨¡å‹" class="headerlink" title="ç½‘ç»œæ¨¡å‹"></a>ç½‘ç»œæ¨¡å‹</h4><ul>
<li>ç›®å‰<code>Kubernetes</code>æ”¯æŒå¤šç§ç½‘ç»œæ–¹æ¡ˆ,å¦‚: <code>Flannel,Canal,Weave Net,Calico</code>ç­‰.å®ƒéƒ½æ˜¯å®ç°äº†<code>CNI</code>çš„è§„èŒƒ.<br>ä¸‹é¢ä»¥å®‰è£…<a target="_blank" rel="noopener" href="https://docs.projectcalico.org/v3.6/getting-started/kubernetes/"><code>Canal</code></a>ä¸ºç¤ºä¾‹.å…¶å®ƒå„å®‰è£…<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/">å‚è€ƒè¿™é‡Œçš„ Installing a<code>Pod</code>network add-on éƒ¨åˆ†</a>,<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/setup/independent/create-cluster-kubeadm/">ä¸­æ–‡æ–‡æ¡£</a>,åœ¨<code>kubeadm init</code>æ˜¯å¿…é¡»è¦æŒ‡å®šä¸€ä¸ªç½‘ç»œ,ä¸ç„¶ä¼šå‡ºç°å…¶å®ƒé—®é¢˜.æ ¹æ®ä¸Šè¿°é“¾æ¥æŒ‡å¯¼å¦‚:<ul>
<li><code>Calico ç½‘ç»œæ¨¡å‹</code>:<code>kubeadm init --pod-network-cidr=192.168.0.0/16</code>,å®ƒåªå·¥åœ¨<code>amd64</code>,<code>arm64</code>,<code>ppc64le</code>ä¸‰ä¸ªå¹³å°.</li>
<li><code>Flannel ç½‘ç»œæ¨¡å‹</code>:<code>kubeadm init --pod-network-cidr=10.244.0.0/16</code>,å¹¶ä¿®æ”¹å†…æ ¸å‚æ•°<br><code>sysctl net.bridge.bridge-nf-call-iptables=1</code>,å·¥ä½œåœ¨Linuxçš„<code>amd64,arm,arm64,ppc64le,s390x</code></li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl apply -f \</span><br><span class="line">https://docs.projectcalico.org/v3.6/getting-started/kubernetes/installation/hosted/kubernetes-datastore/calico-networking/1.7/calico.yaml</span><br><span class="line">configmap/calico-config created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org created</span><br><span class="line">[...]</span><br><span class="line">serviceaccount/calico-kube-controllers created</span><br></pre></td></tr></table></figure>

<ul>
<li>å®‰è£…<code>Master</code>èŠ‚ç‚¹,æ³¨æ„åœ¨å›½å†…å¿…é¡»æŒ‡å®š<code>--image-repository</code>,é»˜è®¤çš„<code>k8s.gcr.io</code>æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®çš„,è¿˜æœ‰<code>--kubernetes-version</code>å¿…é¡»ä¸<code>kubelet</code>çš„ç»„ä»¶ç‰ˆæœ¬åŒ¹é….</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo kubeadm init --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers  --kubernetes-version v1.14.0 --pod-network-cidr=10.244.0.0/16</span><br><span class="line">[init] Using Kubernetes version: v1.14.0</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">	[WARNING IsDockerSystemdCheck]: detected <span class="string">&quot;cgroupfs&quot;</span> as the Docker cgroup driver. The recommended driver is <span class="string">&quot;systemd&quot;</span>. Please follow the guide at https://kubernetes.io/docs/setup/cri/</span><br><span class="line">[preflight] Pulling images required <span class="keyword">for</span> setting up a Kubernetes cluster</span><br><span class="line">[preflight] This might take a minute or two, depending on the speed of your internet connection</span><br><span class="line">[preflight] You can also perform this action <span class="keyword">in</span> beforehand using <span class="string">&#x27;kubeadm config images pull&#x27;</span></span><br><span class="line">[...]</span><br><span class="line"><span class="comment"># å®‰è£…æˆåŠŸå,æ³¨æ„ä¸‹é¢æç¤ºçš„æ“ä½œé¡¹æµç¨‹ä¾æ¬¡è¿›è¡Œ.</span></span><br><span class="line">[addons] Applied essential addon: CoreDNS</span><br><span class="line">[addons] Applied essential addon: kube-proxy</span><br><span class="line"></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a`Pod`network to the cluster.</span><br><span class="line">Run <span class="string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can <span class="built_in">join</span> any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm <span class="built_in">join</span> 172.18.127.186:6443 --token z8r97j.3ovdfddb6df9lnq7 \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:07767a67fa6c38feda7471ee5e1a15a0a9c417cfdf6cf457ff577297f22d9415</span><br></pre></td></tr></table></figure>

<ul>
<li>æ ¹æ®<code>kubeadm init</code>çš„å‚æ•°,å®‰è£…<code>Flannelç½‘ç»œæ’ä»¶</code><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/a70459be0084506e4ec919aa1c114638878db11b/Documentation/kube-flannel.yml</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/flannel created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/flannel created</span><br><span class="line">serviceaccount/flannel created</span><br><span class="line">configmap/kube-flannel-cfg created</span><br><span class="line">daemonset.extensions/kube-flannel-ds-amd64 created</span><br><span class="line">daemonset.extensions/kube-flannel-ds-arm64 created</span><br><span class="line">daemonset.extensions/kube-flannel-ds-arm created</span><br><span class="line">daemonset.extensions/kube-flannel-ds-ppc64le created</span><br><span class="line">daemonset.extensions/kube-flannel-ds-s390x created</span><br></pre></td></tr></table></figure></li>
<li>æŒ‰ç…§ä¸Šè¿°å®‰è£…æˆåŠŸåçš„æç¤º,é…ç½®<code>Master</code>èŠ‚ç‚¹ä¿¡æ¯.å¹¶å®‰è£…ç½‘ç»œæ’ä»¶è¯·<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/cluster-administration/addons/">å‚è€ƒè¿™é‡Œ</a>.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">~$ sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">~$ sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹token</span></span><br><span class="line">~$ kubeadm token list</span><br><span class="line">TOKEN                     TTL       EXPIRES                     USAGES                   DESCRIPTION                                                EXTRA GROUPS</span><br><span class="line">5smm64.9zpyhaqxghohh6b2   23h       2019-04-20T14:45:14+08:00   authentication,signing   The default bootstrap token generated by <span class="string">&#x27;kubeadm init&#x27;</span>.   system:bootstrappers:kubeadm:default-node-token</span><br></pre></td></tr></table></figure>

<h4 id="ä¿®æ”¹Kubeletçš„å¯åŠ¨å‚æ•°"><a href="#ä¿®æ”¹Kubeletçš„å¯åŠ¨å‚æ•°" class="headerlink" title="ä¿®æ”¹Kubeletçš„å¯åŠ¨å‚æ•°"></a>ä¿®æ”¹<code>Kubelet</code>çš„å¯åŠ¨å‚æ•°</h4><ul>
<li><code>kubelet</code>ç»„ä»¶æ˜¯é€šè¿‡<code>systemctl</code>æ¥ç®¡ç†çš„,å› æ­¤å¯ä»¥åœ¨æ¯ä¸ªèŠ‚ç‚¹é‡Œçš„<code>/etc/systemed/system</code>æ‰¾åˆ°å®ƒçš„é…ç½®æ–‡ä»¶.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~<span class="comment"># cat /etc/systemd/system/kubelet.service.d/10-kubeadm.conf</span></span><br><span class="line"><span class="comment"># Note: This dropin only works with kubeadm and kubelet v1.11+</span></span><br><span class="line">[Service]</span><br><span class="line">Environment=<span class="string">&quot;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf&quot;</span></span><br><span class="line">Environment=<span class="string">&quot;KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml&quot;</span></span><br><span class="line"><span class="comment"># This is a file that &quot;kubeadm init&quot; and &quot;kubeadm join&quot; generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically</span></span><br><span class="line">EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env</span><br><span class="line"><span class="comment"># This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use</span></span><br><span class="line"><span class="comment"># the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.</span></span><br><span class="line">EnvironmentFile=-/etc/default/kubelet</span><br><span class="line">ExecStart=</span><br><span class="line">ExecStart=/usr/bin/kubelet <span class="variable">$KUBELET_KUBECONFIG_ARGS</span> <span class="variable">$KUBELET_CONFIG_ARGS</span> <span class="variable">$KUBELET_KUBEADM_ARGS</span> <span class="variable">$KUBELET_EXTRA_ARGS</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="å®‰è£…é›†ç¾¤èŠ‚ç‚¹"><a href="#å®‰è£…é›†ç¾¤èŠ‚ç‚¹" class="headerlink" title="å®‰è£…é›†ç¾¤èŠ‚ç‚¹"></a>å®‰è£…é›†ç¾¤èŠ‚ç‚¹</h3><ul>
<li>åœ¨å¦ä¸€ä¸ªæœºå™¨é‡Œå®‰è£…ä¸Šè¿°çš„ä¸‰ä¸ªç»„ä»¶,å°±å¯ä»¥è¿è¡Œä¸‹é¢å‘½ä»¤åŠ å…¥<code>k8s</code>é›†ç¾¤ç®¡ç†äº†.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo kubeadm <span class="built_in">join</span> 172.18.127.186:6443 --token z8r97j.3ovdfddb6df9lnq7     --discovery-token-ca-cert-hash sha256:07767a67fa6c38feda7471ee5e1a15a0a9c417cfdf6cf457ff577297f22d9415</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">	[WARNING IsDockerSystemdCheck]: detected <span class="string">&quot;cgroupfs&quot;</span> as the Docker cgroup driver. The recommended driver is <span class="string">&quot;systemd&quot;</span>. Please follow the guide at https://kubernetes.io/docs/setup/cri/</span><br><span class="line">[preflight] Reading configuration from the cluster...</span><br><span class="line">[preflight] FYI: You can look at this config file with <span class="string">&#x27;kubectl -n kube-system get cm kubeadm-config -oyaml&#x27;</span></span><br><span class="line">[kubelet-start] Downloading configuration <span class="keyword">for</span> the kubelet from the <span class="string">&quot;kubelet-config-1.14&quot;</span> ConfigMap <span class="keyword">in</span> the kube-system namespace</span><br><span class="line">[kubelet-start] Writing kubelet configuration to file <span class="string">&quot;/var/lib/kubelet/config.yaml&quot;</span></span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file <span class="string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span></span><br><span class="line">[kubelet-start] Activating the kubelet service</span><br><span class="line">[kubelet-start] Waiting <span class="keyword">for</span> the kubelet to perform the TLS Bootstrap...</span><br><span class="line"></span><br><span class="line">This node has joined the cluster:</span><br><span class="line">* Certificate signing request was sent to apiserver and a response was received.</span><br><span class="line">* The Kubelet was informed of the new secure connection details.</span><br><span class="line"></span><br><span class="line">Run <span class="string">&#x27;kubectl get nodes&#x27;</span> on the control-plane to see this node <span class="built_in">join</span> the cluster.</span><br></pre></td></tr></table></figure></li>
<li>åœ¨ Master èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹æ•°.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl  get node</span><br><span class="line">NAME             STATUS   ROLES    AGE    VERSION</span><br><span class="line">aliyun-machine   Ready    master   110m   v1.14.0</span><br><span class="line">dig001           Ready    &lt;none&gt;   84m    v1.14.0</span><br><span class="line">fe001            Ready    &lt;none&gt;   2m8s   v1.14.0</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥çœ‹é›†ç¾¤çš„è¦å®Œæ•´æ¶æ„,Master ä¸Šä¹Ÿå¯ä»¥è¿è¡Œåº”ç”¨,å³ Master åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ª Node.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get pod --all-namespaces -o wide</span><br><span class="line">NAMESPACE     NAME                                 READY   STATUS    RESTARTS   AGE     IP               NODE         NOMINATED NODE   READINESS GATES</span><br><span class="line">kube-system   coredns-d5947d4b-sr5zt               1/1     Running   0          6m3s    10.244.0.6       k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   coredns-d5947d4b-tznh2               1/1     Running   0          6m3s    10.244.0.5       k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   etcd-k8s-master                      1/1     Running   0          5m11s   172.18.127.186   k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-apiserver-k8s-master            1/1     Running   0          5m15s   172.18.127.186   k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-controller-manager-k8s-master   1/1     Running   0          5m13s   172.18.127.186   k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-flannel-ds-amd64-9d965          1/1     Running   0          5m17s   172.18.127.186   k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-flannel-ds-amd64-c8dkh          1/1     Running   0          38s     172.18.192.76    dig001       &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-flannel-ds-amd64-kswj2          1/1     Running   0          52s     172.18.253.222   fe001        &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-proxy-5g9vp                     1/1     Running   0          38s     172.18.192.76    dig001       &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-proxy-cqzfl                     1/1     Running   0          52s     172.18.253.222   fe001        &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-proxy-pjbbg                     1/1     Running   0          6m3s    172.18.127.186   k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-scheduler-k8s-master            1/1     Running   0          5m19s   172.18.127.186   k8s-master   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>è·å–Podçš„å®Œæ•´ä¿¡æ¯<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get pod &lt;podname&gt; --output json   <span class="comment"># ç”¨JSONæ ¼å¼æ˜¾ç¤ºPodçš„å®Œæ•´ä¿¡æ¯</span></span><br><span class="line">~$ kubectl get pod &lt;podname&gt; --output yaml   <span class="comment"># ç”¨YAMLæ ¼å¼æ˜¾ç¤ºPodçš„å®Œæ•´ä¿¡æ¯</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="æ‹†é™¤k8sé›†ç¾¤"><a href="#æ‹†é™¤k8sé›†ç¾¤" class="headerlink" title="æ‹†é™¤k8sé›†ç¾¤"></a>æ‹†é™¤<code>k8s</code>é›†ç¾¤</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl drain &lt;node name&gt; --delete-local-data --force --ignore-daemonsets</span><br><span class="line">~$ kubectl delete node &lt;node name&gt;</span><br><span class="line">~$ kubeadm reset</span><br></pre></td></tr></table></figure>

<h1 id="å®‰è£…HelloWorldå…±äº«Podæ•°æ®"><a href="#å®‰è£…HelloWorldå…±äº«Podæ•°æ®" class="headerlink" title="å®‰è£…HelloWorldå…±äº«Podæ•°æ®"></a>å®‰è£…<code>HelloWorld</code>å…±äº«<code>Pod</code>æ•°æ®</h1><ul>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/">Communicate Between Containers in the Same Pod Using a Shared Volume</a></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> <span class="comment">#  for k8s versions before 1.9.0 use apps/v1beta2  and before 1.8.0 use extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hello-world</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">write</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">debian:latest</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo \&quot;Hello World\&quot; &gt;&gt; /data/hello&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">read</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">debian:latest</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;sleep 10; cat /data/hello&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/tmp</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl apply -f hello-world.yaml</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="é€šè¿‡Githubå®‰è£…Kubernetes"><a href="#é€šè¿‡Githubå®‰è£…Kubernetes" class="headerlink" title="é€šè¿‡Githubå®‰è£…Kubernetes"></a>é€šè¿‡<code>Github</code>å®‰è£…<code>Kubernetes</code></h2><h3 id="Etcd"><a href="#Etcd" class="headerlink" title="Etcd"></a><code>Etcd</code></h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd">CoreOS Etcd</a></li>
<li>ä»<a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/releases/download/v3.3.12/etcd-v3.3.12-linux-amd64.tar.gz">Github ä¸‹è½½</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ wget -c https://github.com/etcd-io/etcd/releases/download/v3.3.12/etcd-v3.3.12-linux-amd64.tar.gz</span><br><span class="line">~$ tar zxvf etcd-v3.3.12-linux-amd64.tar.gz</span><br><span class="line">~$ <span class="built_in">cd</span> etcd-v3.3.12-linux-amd64 &amp;&amp; sudo <span class="built_in">cp</span> &#123;etcd,etcdctl&#125; /usr/local/bin</span><br></pre></td></tr></table></figure>

<ul>
<li><p>è¿è¡Œ<code>Etcd</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ etcd -name etcd --data-dir /var/lib/etcd -listen-client-urls http://0.0.0.0:2379,http://0.0.0.0:4001 \</span><br><span class="line">-advertise-client-urls http://0.0.0.0:2379,http://0.0.0.0:4001 &gt;&gt; /var/log/etcd.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥è¯¢å®ƒçš„å»ºåº·çŠ¶æ€</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ etcdctl  -C http://127.0.0.1:4001 cluster-healthmember 8e9e05c52164694d is healthy: got healthy result from http://0.0.0.0:2379</span><br><span class="line">cluster is healthy</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Kuberneteså‘å¸ƒåŒ…å®‰è£…"><a href="#Kuberneteså‘å¸ƒåŒ…å®‰è£…" class="headerlink" title="Kuberneteså‘å¸ƒåŒ…å®‰è£…"></a><code>Kubernetes</code>å‘å¸ƒåŒ…å®‰è£…</h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/">Kubernetes</a></p>
</li>
<li><p>é€šè¿‡<a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/releases/download/v1.14.0/kubernetes.tar.gz">github ä¸‹è½½</a>æœ€æ–°çš„ç‰ˆæœ¬.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">~$ wget -c https://github.com/kubernetes/kubernetes/releases/download/v1.14.0/kubernetes.tar.gz</span><br><span class="line">~$ tar xvf kubernetes.tar.gz &amp;&amp; <span class="built_in">cd</span> kubernetes</span><br><span class="line">~$ tree -L 1</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ client</span><br><span class="line">â”œâ”€â”€ cluster</span><br><span class="line">â”œâ”€â”€ docs</span><br><span class="line">â”œâ”€â”€ hack</span><br><span class="line">â”œâ”€â”€ LICENSES</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ server</span><br><span class="line">â””â”€â”€ version</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> server/README</span><br><span class="line">Server binary tarballs are no longer included <span class="keyword">in</span> the Kubernetes final tarball.</span><br><span class="line"></span><br><span class="line">Run cluster/get-kube-binaries.sh to download client and server binaries.</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ ¹æ®ä¸Šé¢çš„<code>README</code>æç¤º,æœåŠ¡ç«¯çš„ç»„ä»¶æ²¡æœ‰åŒ…å«åœ¨ä¸Šé¢çš„å‹ç¼©åŒ…,è€Œæ˜¯è¦é€šè¿‡è¿è¡Œ<code>cluster/get-kube-binaries.sh</code>ä»<code>https://dl.k8s.io/v1.14.0</code>ä¸‹è½½.ä½†æ˜¯<code>dl.k8s.io</code>åœ¨å›½å†…æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®çš„.</p>
</li>
</ul>
<h1 id="å®‰è£…MinioæœåŠ¡-å•èŠ‚ç‚¹æœåŠ¡"><a href="#å®‰è£…MinioæœåŠ¡-å•èŠ‚ç‚¹æœåŠ¡" class="headerlink" title="å®‰è£…MinioæœåŠ¡(å•èŠ‚ç‚¹æœåŠ¡)"></a>å®‰è£…<code>Minio</code>æœåŠ¡(å•èŠ‚ç‚¹æœåŠ¡)</h1><ul>
<li><p>é“¾æ¥:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/minio/minio">Github MinIO</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.min.io/cn/">MinIO Quickstart Guideæ–‡æ¡£</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/examples/tree/master/staging/storage/minio">Cloud Native Deployment of Minio using Kubernetes</a></li>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/">Configure a Pod to Use a PersistentVolume for Storage</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.min.io/cn/deploy-minio-on-kubernetes.html">MinIOä¸­æ–‡æ‰‹å†Œ</a></li>
</ul>
</li>
<li><p><code>MinIO</code>æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„<code>Kubernetes</code>ä¸‹åŸç”Ÿçš„å¯¹åƒå­˜å‚¨,å®ƒçš„<code>API</code>åŒæ ·å…¼å®¹<code>Amazon S3</code>äº‘å­˜å‚¨æœåŠ¡.ä¸‹é¢ä½¿ç”¨<code>kubectl</code>ç›´æ¥æŒ‰è£…<code>Minio</code>æ˜¯å‚ç…§<a target="_blank" rel="noopener" href="https://docs.min.io/docs/deploy-minio-on-kubernetes.html"><code>Deploy MinIO on Kubernetes</code></a>,ä¸‹é¢ä¹Ÿå¯ä»¥ä½¿ç”¨<code>Helm</code>å®‰è£…å®ƒ.</p>
</li>
<li><p>å¿«é€Ÿè¿è¡Œå•èŠ‚ç‚¹æœåŠ¡, ä¸‹é¢è¿è¡ŒæˆåŠŸ,åå¯ä»¥æ‰“å¼€<code>http://127.0.0.1:9000</code>,ä½¿ç”¨<code>minioadmin:minioadmin</code>ç™»å½•åˆ°æ§åˆ¶å°.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ podman run -p 9000:9000 -p 9001:9001 \</span><br><span class="line">  quay.io/minio/minio server /data --console-address <span class="string">&quot;:9001&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æˆ–è€…ç»‘å®šä¸€ä¸ªæœ¬æœºç›®å½•<code>minio_data</code>åˆ°å®¹å™¨å†…å».</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ podman run -v `<span class="built_in">pwd</span>`/minio_data:/data -p 9000:9000 -p 9001:9001 \</span><br><span class="line">  quay.io/minio/minio server /data --console-address <span class="string">&quot;:9001&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="MinIOæœåŠ¡ç«¯"><a href="#MinIOæœåŠ¡ç«¯" class="headerlink" title="MinIOæœåŠ¡ç«¯"></a><code>MinIO</code>æœåŠ¡ç«¯</h2><h3 id="åˆ›å»ºPV-Persistent-Volume"><a href="#åˆ›å»ºPV-Persistent-Volume" class="headerlink" title="åˆ›å»ºPV (Persistent Volume)"></a>åˆ›å»º<code>PV (Persistent Volume)</code></h3><ul>
<li>åœ¨<code>Kubernetes</code>ç¯å¢ƒä¸­,å¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/minio/operator">MinIO Kubernetes Operator</a></li>
<li>ä¸‹é¢æ˜¯ä¸€ä¸ªèµ„æºæè¿°æ–‡ä»¶,åˆ›å»ºä¸€ä¸ª10Gå¤§å°çš„,æœ¬åœ°ç±»å‹çš„<code>PV</code>. <code>PV</code>å¯ä»¥ç†è§£æˆ<code>k8s</code>é›†ç¾¤ä¸­çš„æŸä¸ªç½‘ç»œå­˜å‚¨ä¸­å¯¹åº”çš„ä¸€å—å­˜å‚¨,å®ƒä¸<code>Voleme</code>å¾ˆç±»ä¼¼.<code>PV</code>åªèƒ½æ˜¯ç½‘ç»œå­˜å‚¨,ä¸å±äºä»»ä½•çš„<code>Node</code>,ä½†å¯ä»¥åœ¨æ¯ä¸ª<code>Node</code>ä¸Šè®¿é—®å®ƒ.<code>PV</code>å¹¶ä¸æ˜¯å®šä¹‰åœ¨<code>Pod</code>ä¸Šçš„,è€Œæ˜¯ç‹¬ç«‹äº<code>Pod</code>ä¹‹å¤–çš„å®šä¹‰.<code>PV</code>ç›®å‰æ”¯æŒçš„ç±»å‹åŒ…æ‹¬:<ul>
<li>GCEPersistentDisk,</li>
<li>AWSElasticBlockStore,</li>
<li>AzureFile,FC(Fibre Channel),</li>
<li>NFS,</li>
<li>iSCSI,</li>
<li>RBD(Rados Block Device),</li>
<li>CephFS,</li>
<li>GlusterFS,</li>
<li>HostPath(ä»…ä¾›å•æœºæµ‹è¯•)ç­‰ç­‰.</li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cat</span> pv.yaml</span><br><span class="line"></span><br><span class="line">kind: PersistentVolume</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: task-pv-volume</span><br><span class="line">  labels:</span><br><span class="line">    <span class="built_in">type</span>: <span class="built_in">local</span></span><br><span class="line">spec:</span><br><span class="line">  storageClassName: standard</span><br><span class="line">  capacity:</span><br><span class="line">    storage: 10Gi</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  hostPath:</span><br><span class="line">    path: <span class="string">&quot;/tmp/data&quot;</span></span><br><span class="line"></span><br><span class="line">~$ kubectl create -f pv.yaml</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…Minio-PVC-Persistent-Volume-Claim"><a href="#å®‰è£…Minio-PVC-Persistent-Volume-Claim" class="headerlink" title="å®‰è£…Minio PVC (Persistent Volume Claim)"></a>å®‰è£…<code>Minio PVC (Persistent Volume Claim)</code></h3><ul>
<li><code>PVC</code>æŒ‡å®šæ‰€éœ€è¦çš„å­˜å‚¨å¤§å°,ç„¶å<code>k8s</code>ä¼šé€‰æ‹©æ»¡è¶³æ¡ä»¶çš„PVè¿›è¡Œç»‘å®š,å¦‚æœ<code>PVC</code>åˆ›å»ºä¹‹åæ²¡ç»‘å®šåˆ°PV,å°±ä¼šå‡ºç°<code>Pending</code>çš„é”™è¯¯,æ‰€ä»¥è¦æŒ‰ç…§<code>PV-&gt;PVC-&gt;Deployment-&gt;Service</code>è¿™ä¸ªé¡ºåºæ¥è¯•éªŒ.<code>PVC</code>çš„å‡ ç§çŠ¶æ€æœ‰:<ul>
<li>Available: ç©ºé—²çŠ¶æ€</li>
<li>Bound: å·²ç»ç»‘å®šåˆ°æŸä¸ªPVCä¸Š.</li>
<li>Released: å¯¹åº”çš„PVCå·²ç»åˆ é™¤,ä½†èµ„æºè¿˜æ²¡æœ‰è¢«é›†ç¾¤æ”¶å›.</li>
<li>Failed: PV è‡ªåŠ¨å›æ”¶å¤±è´¥.</li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl create -f https://github.com/minio/minio/blob/master/docs/orchestration/kubernetes/minio-standalone-pvc.yaml?raw=<span class="literal">true</span></span><br><span class="line">persistentvolumeclaim/minio-pv-claim created</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä¹Ÿå¯ä»¥æŠŠä¸Šé¢è¿™ä¸ªé“¾æ¥çš„æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°,ä¿®æ”¹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cat</span> minio-pvc.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  <span class="comment"># This name uniquely identifies the PVC. This is used in deployment.</span></span><br><span class="line">  name: minio-pv-claim</span><br><span class="line">spec:</span><br><span class="line">  <span class="comment"># Read more about access modes here: http://kubernetes.io/docs/user-guide/persistent-volumes/#access-modes</span></span><br><span class="line">  storageClassName: standard</span><br><span class="line">  accessModes:</span><br><span class="line">    <span class="comment"># The volume is mounted as read-write by a single node</span></span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  resources:</span><br><span class="line">    <span class="comment"># This is the request for storage. Should be available in the cluster.</span></span><br><span class="line">    requests:</span><br><span class="line">      storage: 10Gi</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹ç³»ç»Ÿä¸­çš„<code>PVC</code>çŠ¶æ€,ä¸‹é¢æ˜¾ç¤ºçŠ¶æ€æ˜¯<code>Pending</code>,ä½¿ç”¨<code>describe</code>æŸ¥çœ‹å®ƒçš„è¯¦æƒ….</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get pvc  --namespace default</span><br><span class="line">NAME             STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">minio-pv-claim   Pending</span><br><span class="line">~$ kubectl get pvc  --namespace default</span><br><span class="line">NAME             STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">minio-pv-claim   Pending                                                     2m22s</span><br><span class="line">lcy@k8s-master:~$ kubectl describe pvc minio-pv-claim</span><br><span class="line">Name:          minio-pv-claim</span><br><span class="line">Namespace:     default</span><br><span class="line">StorageClass:</span><br><span class="line">Status:        Pending</span><br><span class="line">Volume:</span><br><span class="line">Labels:        &lt;none&gt;</span><br><span class="line">Annotations:   &lt;none&gt;</span><br><span class="line">Finalizers:    [kubernetes.io/pvc-protection]</span><br><span class="line">Capacity:</span><br><span class="line">Access Modes:</span><br><span class="line">VolumeMode:    Filesystem</span><br><span class="line">Events:</span><br><span class="line">  Type       Reason         Age                 From                         Message</span><br><span class="line">  ----       ------         ----                ----                         -------</span><br><span class="line">  Normal     FailedBinding  4s (x14 over 3m2s)  persistentvolume-controller  no persistent volumes available <span class="keyword">for</span> this claim and no storage class is <span class="built_in">set</span></span><br><span class="line">Mounted By:  minio-6d4d48db87-wxr4d</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ ¹æ®ä¸Šé¢<code>Events</code>æ˜¾ç¤ºé”™è¯¯å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FailedBinding  4s (x14 over 3m2s)  persistentvolume-controller  no persistent volumes available <span class="keyword">for</span> this claim and no storage class is <span class="built_in">set</span>`</span><br></pre></td></tr></table></figure></li>
<li><p>è¿™å°±æ˜¯å®ƒä¸ºä»€ä¹ˆ<code>Pending</code>çš„åŸå› .ç»§ç»­ä¸‹ä¸€æ­¥,å¤„ç†è¿™äº›ä¾èµ–çš„é”™è¯¯.</p>
</li>
</ul>
<h3 id="å®‰è£…Minio-Deployment"><a href="#å®‰è£…Minio-Deployment" class="headerlink" title="å®‰è£…Minio Deployment"></a>å®‰è£…<code>Minio Deployment</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl create -f https://github.com/minio/minio/blob/master/docs/orchestration/kubernetes/minio-standalone-deployment.yaml?raw=<span class="literal">true</span></span><br><span class="line">deployment.extensions/minio created</span><br><span class="line"></span><br><span class="line">~$ <span class="built_in">cat</span> minio-standalone-deployment.yaml</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  <span class="comment"># This name uniquely identifies the Deployment</span></span><br><span class="line">  name: minio</span><br><span class="line">spec:</span><br><span class="line">  strategy:</span><br><span class="line">    <span class="comment"># Specifies the strategy used to replace old Pods by new ones</span></span><br><span class="line">    <span class="comment"># Refer: https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy</span></span><br><span class="line">    <span class="built_in">type</span>: Recreate</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        <span class="comment"># This label is used as a selector in Service definition</span></span><br><span class="line">        app: minio</span><br><span class="line">    spec:</span><br><span class="line">      <span class="comment"># Volumes used by this deployment</span></span><br><span class="line">      volumes:</span><br><span class="line">      - name: data</span><br><span class="line">        <span class="comment"># This volume is based on PVC</span></span><br><span class="line">        persistentVolumeClaim:</span><br><span class="line">          <span class="comment"># Name of the PVC created earlier</span></span><br><span class="line">          claimName: minio-pv-claim</span><br><span class="line">      containers:</span><br><span class="line">      - name: minio</span><br><span class="line">        <span class="comment"># Volume mounts for this container</span></span><br><span class="line">        volumeMounts:</span><br><span class="line">        <span class="comment"># Volume &#x27;data&#x27; is mounted to path &#x27;/data&#x27;</span></span><br><span class="line">        - name: data</span><br><span class="line">          mountPath: <span class="string">&quot;/data&quot;</span></span><br><span class="line">        <span class="comment"># Pulls the lastest Minio image from Docker Hub</span></span><br><span class="line">        image: minio/minio:RELEASE.2019-04-18T21-44-59Z</span><br><span class="line">        args:</span><br><span class="line">        - server</span><br><span class="line">        - /data</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        <span class="comment"># MinIO access key and secret key</span></span><br><span class="line">        - name: MINIO_ACCESS_KEY</span><br><span class="line">          value: <span class="string">&quot;minio&quot;</span></span><br><span class="line">        - name: MINIO_SECRET_KEY</span><br><span class="line">          value: <span class="string">&quot;minio123&quot;</span></span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 9000</span><br><span class="line">        <span class="comment"># Readiness probe detects situations when MinIO server instance</span></span><br><span class="line">        <span class="comment"># is not ready to accept traffic. Kubernetes doesn&#x27;t forward</span></span><br><span class="line">        <span class="comment"># traffic to the pod while readiness checks fail.</span></span><br><span class="line">        readinessProbe:</span><br><span class="line">          httpGet:</span><br><span class="line">            path: /minio/health/ready</span><br><span class="line">            port: 9000</span><br><span class="line">          initialDelaySeconds: 120</span><br><span class="line">          periodSeconds: 20</span><br><span class="line">        <span class="comment"># Liveness probe detects situations where MinIO server instance</span></span><br><span class="line">        <span class="comment"># is not working properly and needs restart. Kubernetes automatically</span></span><br><span class="line">        <span class="comment"># restarts the pods if liveness checks fail.</span></span><br><span class="line">        livenessProbe:</span><br><span class="line">          httpGet:</span><br><span class="line">            path: /minio/health/live</span><br><span class="line">            port: 9000</span><br><span class="line">          initialDelaySeconds: 120</span><br><span class="line">          periodSeconds: 20</span><br><span class="line">~$ kubectl get deployment  --namespace default</span><br><span class="line">NAME    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">minio   0/1     1            0           82s</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…Minio-Service"><a href="#å®‰è£…Minio-Service" class="headerlink" title="å®‰è£…Minio Service"></a>å®‰è£…<code>Minio Service</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl create -f https://github.com/minio/minio/blob/master/docs/orchestration/kubernetes/minio-standalone-service.yaml?raw=<span class="literal">true</span></span><br><span class="line">service/minio-service created</span><br><span class="line"></span><br><span class="line">~$ <span class="built_in">cat</span> minio-standalone-service.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  <span class="comment"># This name uniquely identifies the service</span></span><br><span class="line">  name: minio-service</span><br><span class="line">spec:</span><br><span class="line">  <span class="built_in">type</span>: LoadBalancer</span><br><span class="line">  ports:</span><br><span class="line">    - port: 9000</span><br><span class="line">      targetPort: 9000</span><br><span class="line">      protocol: TCP</span><br><span class="line">  selector:</span><br><span class="line">    <span class="comment"># Looks for labels `app:minio` in the namespace and applies the spec</span></span><br><span class="line">    app: minio</span><br><span class="line"></span><br><span class="line">~$ kubectl get svc minio-service</span><br><span class="line">NAME            TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">minio-service   LoadBalancer   10.100.57.156   &lt;pending&gt;     9000:32552/TCP   10m</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ä¸ºä»€ä¹ˆä¼šPending</span></span><br><span class="line">~$ kubectl describe pod --namespace default -l app=minio</span><br><span class="line">Name:               minio-756cb7dff7-mcm6m</span><br><span class="line">Namespace:          default</span><br><span class="line">Priority:           0</span><br><span class="line">PriorityClassName:  &lt;none&gt;</span><br><span class="line">Node:               fe001/172.18.253.222</span><br><span class="line">Start Time:         Fri, 19 Apr 2019 15:20:30 +0800</span><br><span class="line">Labels:             app=minio</span><br><span class="line">                    pod-template-hash=756cb7dff7</span><br><span class="line">Annotations:        &lt;none&gt;</span><br><span class="line">Status:             Running</span><br><span class="line">IP:                 10.244.1.4</span><br><span class="line">Controlled By:      ReplicaSet/minio-756cb7dff7</span><br><span class="line">Containers:</span><br><span class="line">  minio:</span><br><span class="line">    Container ID:  docker://119535fa5ab172b5b2155c650dc51c2d12b3c02b1e28ab9e8301eb318ab969a7</span><br><span class="line">    Image:         minio/minio:RELEASE.2019-04-18T21-44-59Z</span><br><span class="line">    Image ID:      docker-pullable://minio/minio@sha256:a26e089732b85f8c312ff6346498acec763033b1ac85e74fc897f667939ea2aa</span><br><span class="line">    Port:          9000/TCP</span><br><span class="line">    Host Port:     0/TCP</span><br><span class="line">    Args:</span><br><span class="line">      server</span><br><span class="line">      /data</span><br><span class="line">    State:          Running</span><br><span class="line">      Started:      Fri, 19 Apr 2019 15:20:51 +0800</span><br><span class="line">    Ready:          True</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Liveness:       http-get http://:9000/minio/health/live delay=120s <span class="built_in">timeout</span>=1s period=20s <span class="comment">#success=1 #failure=3</span></span><br><span class="line">    Readiness:      http-get http://:9000/minio/health/ready delay=120s <span class="built_in">timeout</span>=1s period=20s <span class="comment">#success=1 #failure=3</span></span><br><span class="line">    Environment:</span><br><span class="line">      MINIO_ACCESS_KEY:  minio</span><br><span class="line">      MINIO_SECRET_KEY:  minio123</span><br><span class="line">    Mounts:</span><br><span class="line">      /data from data (rw)</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-2vsh9 (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type              Status</span><br><span class="line">  Initialized       True</span><br><span class="line">  Ready             True</span><br><span class="line">  ContainersReady   True</span><br><span class="line">  PodScheduled      True</span><br><span class="line">Volumes:</span><br><span class="line">  data:</span><br><span class="line">    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim <span class="keyword">in</span> the same namespace)</span><br><span class="line">    ClaimName:  minio-pv-claim</span><br><span class="line">    ReadOnly:   <span class="literal">false</span></span><br><span class="line">  default-token-2vsh9:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  default-token-2vsh9</span><br><span class="line">    Optional:    <span class="literal">false</span></span><br><span class="line">QoS Class:       BestEffort</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class="keyword">for</span> 300s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute <span class="keyword">for</span> 300s</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason            Age                  From               Message</span><br><span class="line">  ----     ------            ----                 ----               -------</span><br><span class="line">  Warning  FailedScheduling  5m10s (x7 over 12m)  default-scheduler  0/3 nodes are available: 3 node(s) had taints that the pod didn\<span class="string">&#x27;t tolerate.</span></span><br><span class="line"><span class="string">  Normal   Scheduled         5m8s                 default-scheduler  Successfully assigned default/minio-756cb7dff7-mcm6m to fe001</span></span><br><span class="line"><span class="string">  Normal   Pulling           5m7s                 kubelet, fe001     Pulling image &quot;minio/minio:RELEASE.2019-04-18T21-44-59Z&quot;</span></span><br><span class="line"><span class="string">  Normal   Pulled            4m47s                kubelet, fe001     Successfully pulled image &quot;minio/minio:RELEASE.2019-04-18T21-44-59Z&quot;</span></span><br><span class="line"><span class="string">  Normal   Created           4m47s                kubelet, fe001     Created container minio</span></span><br><span class="line"><span class="string">  Normal   Started           4m47s                kubelet, fe001     Started container minio</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚ä¸Šæ‰€ç¤º,<code>Pending</code>åŸå› æ˜¯å› ä¸º<code> Warning  FailedScheduling  5m10s (x7 over 12m)  default-scheduler  0/3 nodes are available: 3 node(s) had taints that the pod didn\&#39;t tolerate.</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get pod --namespace default -l app=minio</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">minio-756cb7dff7-k2sdk   1/1     Running   0          15m</span><br><span class="line"><span class="comment"># åœ¨è¿è¡Œçš„å®¹å™¨ä¸­è¿œç¨‹æ‰§è¡Œå‘½ä»¤.ä¸‹é¢çš„åŒæ¨ªæ ä»£è¡¨ç€kubectlå‘½ä»¤é¡¹çš„ç»“æŸ.</span></span><br><span class="line">~$ kubectl <span class="built_in">exec</span> minio-756cb7dff7-k2sdk -- ping 8.8.8.8</span><br><span class="line">PING 8.8.8.8 (8.8.8.8): 56 data bytes</span><br><span class="line">64 bytes from 8.8.8.8: <span class="built_in">seq</span>=1 ttl=41 time=25.684 ms</span><br><span class="line"><span class="comment"># åœ¨å®¹å™¨ä¸­è¿è¡Œshell</span></span><br><span class="line">~$ kubectl <span class="built_in">exec</span> -it minio-756cb7dff7-k2sdk sh</span><br><span class="line">/ <span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="é€šè¿‡Ingressæš´éœ²æœåŠ¡"><a href="#é€šè¿‡Ingressæš´éœ²æœåŠ¡" class="headerlink" title="é€šè¿‡Ingressæš´éœ²æœåŠ¡"></a>é€šè¿‡<code>Ingress</code>æš´éœ²æœåŠ¡</h2><ul>
<li>å‘é›†ç¾¤å¤–éƒ¨çš„å®¢æˆ·ç«¯å…¬å¼€æœåŠ¡çš„æœ‰ä½¿ç”¨<code>LoadBalancer</code>å’Œ<code>Ingress</code>ä¸¤ç§æ–¹æ³•.æ¯ä¸ª<code>LoadBalancer</code>æœåŠ¡éƒ½éœ€è¦è‡ªå·±çš„è´Ÿè½½å‡è¡¡å™¨,ä»¥åŠç‹¬æœ‰çš„å…¬æœ‰IPçš„åœ°å€,è€Œ<code>Ingress</code>åªéœ€è¦ä¸€ä¸ªå…¬ç½‘IPå°±èƒ½ä¸ºè®¸å¤šæœåŠ¡æä¾›è®¿é—®.å½“å®¢æˆ·ç«¯å‘<code>Ingress</code>å‘é€<code>Http</code>è¯·æ±‚æ—¶,<code>Ingress</code>ä¼šæ ¹æ®è¯·æ±‚çš„ä¸»æœºåå’Œè·¯å¾„å†³å®šè¯·æ±‚è½¬å‘åˆ°çš„æœåŠ¡.<code>Ingressåœ¨</code>ç½‘ç»œæ ˆçš„(HTTP)çš„åº”ç”¨å±‚æ“ä½œ,å¹¶ä¸”å¯ä»¥æä¾›ä¸€äº›æœåŠ¡ä¸èƒ½å®ç°çš„åŠŸèƒ½.å¦‚åŸºäº<code>cookie</code>çš„<code>session affinity</code>ç­‰åŠŸèƒ½.</li>
</ul>
<h1 id="Traefikåå‘ä»£ç†"><a href="#Traefikåå‘ä»£ç†" class="headerlink" title="Traefikåå‘ä»£ç†"></a><code>Traefik</code>åå‘ä»£ç†</h1><ul>
<li>å‚è€ƒé“¾æ¥:<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/traefik/traefik">traefik</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.to/maymeow/static-sites-with-minio-and-s3www-3feh">Static Sites With Minio and S3www</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.sethcorker.com/traefik-routing-for-web-apps/">Using Traefik for routing paths to web apps</a></li>
</ul>
</li>
<li><code>Traefik</code>æ˜¯ä¸€æ¬¾äº‘åŸç”Ÿåå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡æœåŠ¡,ä½¿ç”¨<code>golang</code>å®ç°çš„.å’Œ<code>nginx</code>æœ€å¤§çš„ä¸åŒæ˜¯,å®ƒæ”¯æŒè‡ªåŠ¨åŒ–æ›´æ–°åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡é…ç½®.å¹¶ä¸”æ”¯æŒå¤šç§åç«¯:<ul>
<li>Docker &#x2F; Swarm mode</li>
<li>Kubernetes</li>
<li>Marathon</li>
<li>Rancher (Metadata)</li>
<li>File</li>
</ul>
</li>
</ul>
<h2 id="å¿«é€Ÿå®‰è£…æµ‹è¯•"><a href="#å¿«é€Ÿå®‰è£…æµ‹è¯•" class="headerlink" title="å¿«é€Ÿå®‰è£…æµ‹è¯•"></a>å¿«é€Ÿå®‰è£…æµ‹è¯•</h2><ul>
<li><p>ä¸‹è½½ä¸€ä»½<code>Traefik</code>çš„é…ç½®,å¯ä»¥ä»è¿™é‡Œå¤åˆ¶ä¸€ä»½<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/traefik/traefik/master/traefik.sample.toml">ç®€å•é…ç½®</a>,æˆ–è€…å»åˆ°<a target="_blank" rel="noopener" href="https://github.com/traefik/traefik/releases">https://github.com/traefik/traefik/releases</a>ä¸‹è½½ä¸€ä¸ª<code>Traefik</code>çš„äºŒè¿›åˆ¶çš„ç¨‹åº,è¿è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæˆå®ƒ:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ ./traefik -c traefik.toml</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç›´æ¥<code>Docker</code>è¿è¡Œæµ‹è¯•,æµè§ˆå™¨æ‰“å¼€<code>http://127.0.0.1:8080/dashboard/#/</code>è¿›å…¥æ§åˆ¶å°æŸ¥çœ‹.å®ƒæœ‰å‡ ä¸ªé‡è¦çš„æ ¸å¿ƒç»„ä»¶:</p>
<ul>
<li>Providers</li>
<li>Entrypoints</li>
<li>Routers</li>
<li>Services</li>
<li>Middlewares<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ docker run -d -p 8080:8080 -p 80:80 -v <span class="variable">$PWD</span>/traefik.toml:/etc/traefik/traefik.toml traefik</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="docker-composeæµ‹è¯•è¯´æ˜"><a href="#docker-composeæµ‹è¯•è¯´æ˜" class="headerlink" title="docker-composeæµ‹è¯•è¯´æ˜"></a><code>docker-compose</code>æµ‹è¯•è¯´æ˜</h2><ul>
<li>ä¸‹é¢æ˜¯ç”¨ä¸€ä¸ªç®€å•çš„ç»„åˆé…ç½®æµ‹è¯•,æ¥ç›´è§‚ç†è§£è¯´æ˜<code>Traefik</code>çš„ç”¨é€”ä¸ä½¿ç”¨åœºæ™¯,è¿™é‡Œä½¿ç”¨<code>v2.5</code>çš„ç‰ˆæœ¬,ä¸æ—§çš„<code>v1.2</code>æ˜¯æœ‰å·®åˆ«çš„.æµ‹è¯•çš„ç›®å½•ç»“æ„å¦‚ä¸‹:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~$ tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ minio</span><br><span class="line">â”‚Â Â  â””â”€â”€ docker-compose.yml</span><br><span class="line">â”œâ”€â”€ traefik</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ docker-compose-v2.yml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ docker-compose.yml</span><br><span class="line">â”‚Â Â  â””â”€â”€ traefik.toml</span><br><span class="line">â””â”€â”€ whoami-app</span><br><span class="line">    â”œâ”€â”€ docker-compose-v2.yml</span><br><span class="line">    â””â”€â”€ docker-compose.yml</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>è¿è¡Œ<code>Traefik</code>å®ä¾‹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">traefik$ <span class="built_in">cat</span> docker-compose-v2.yml</span><br><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  reverse-proxy:</span><br><span class="line">    <span class="comment"># The official v2 Traefik docker image</span></span><br><span class="line">    image: traefik:v2.5</span><br><span class="line">    <span class="comment"># Enables the web UI and tells Traefik to listen to docker</span></span><br><span class="line">    <span class="built_in">command</span>: --api.insecure=<span class="literal">true</span> --providers.docker</span><br><span class="line">    ports:</span><br><span class="line">      <span class="comment"># The HTTP port</span></span><br><span class="line">      - <span class="string">&quot;80:80&quot;</span></span><br><span class="line">      <span class="comment"># The Web UI (enabled by --api.insecure=true)</span></span><br><span class="line">      - <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    volumes:</span><br><span class="line">      <span class="comment"># So that Traefik can listen to the Docker events</span></span><br><span class="line">      - /var/run/docker.sock:/var/run/docker.sock</span><br><span class="line">traefik$ docker-compose -f docker-compose-v2.yml up -d</span><br><span class="line">Creating network <span class="string">&quot;traefik_default&quot;</span> with the default driver</span><br><span class="line">Creating traefik_reverse-proxy_1 ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿è¡Œ3ä¸ªæµ‹è¯•å®ä¾‹(traefik&#x2F;whoami)</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">whoami-app$ <span class="built_in">cat</span> docker-compose-v2.yml</span><br><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  <span class="built_in">whoami</span>:</span><br><span class="line">    <span class="comment"># A container that exposes an API to show its IP address</span></span><br><span class="line">    image: traefik/whoami</span><br><span class="line">    networks:</span><br><span class="line">      - traefik_default</span><br><span class="line">    labels:</span><br><span class="line">      - traefik.docker.network=traefik_default</span><br><span class="line">      - traefik.http.routers.whoami.rule=Host(`whoami.docker.localhost`)</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  traefik_default:</span><br><span class="line">    external: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">whoami-app$ docker-compose -f docker-compose-v2.yml up -d --scale <span class="built_in">whoami</span>=3</span><br><span class="line">Starting whoami-app_whoami_1 ... <span class="keyword">done</span></span><br><span class="line">Creating whoami-app_whoami_2 ... <span class="keyword">done</span></span><br><span class="line">Creating whoami-app_whoami_3 ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>å¯ä»¥é€šè¿‡æµè§ˆå™¨çš„é¡µé¢<code>http://127.0.0.1:8080/dashboard/#/http/services</code>æŸ¥çœ‹æœåŠ¡çš„çŠ¶æ€,ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ curl  http://localhost:8080/api/rawdata | jq -c <span class="string">&#x27;.services&#x27;</span></span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100  1829  100  1829    0     0  1786k      0 --:--:-- --:--:-- --:--:-- 1786k</span><br><span class="line">&#123;<span class="string">&quot;api@internal&quot;</span>:&#123;<span class="string">&quot;status&quot;</span>:<span class="string">&quot;enabled&quot;</span>,<span class="string">&quot;usedBy&quot;</span>:[<span class="string">&quot;api@internal&quot;</span>]&#125;,<span class="string">&quot;dashboard@internal&quot;</span>:&#123;<span class="string">&quot;status&quot;</span>:<span class="string">&quot;enabled&quot;</span>,<span class="string">&quot;usedBy&quot;</span>:[<span class="string">&quot;dashboard@internal&quot;</span>]&#125;,<span class="string">&quot;noop@internal&quot;</span>:&#123;<span class="string">&quot;status&quot;</span>:<span class="string">&quot;enabled&quot;</span>&#125;,<span class="string">&quot;reverse-proxy-traefik@docker&quot;</span>:&#123;<span class="string">&quot;loadBalancer&quot;</span>:&#123;<span class="string">&quot;servers&quot;</span>:[&#123;<span class="string">&quot;url&quot;</span>:<span class="string">&quot;http://172.30.0.2:80&quot;</span>&#125;],<span class="string">&quot;passHostHeader&quot;</span>:<span class="literal">true</span>&#125;,<span class="string">&quot;status&quot;</span>:<span class="string">&quot;enabled&quot;</span>,<span class="string">&quot;usedBy&quot;</span>:[<span class="string">&quot;reverse-proxy-traefik@docker&quot;</span>],<span class="string">&quot;serverStatus&quot;</span>:&#123;<span class="string">&quot;http://172.30.0.2:80&quot;</span>:<span class="string">&quot;UP&quot;</span>&#125;&#125;,<span class="string">&quot;whoami-whoami-app@docker&quot;</span>:&#123;<span class="string">&quot;loadBalancer&quot;</span>:&#123;<span class="string">&quot;servers&quot;</span>:[&#123;<span class="string">&quot;url&quot;</span>:<span class="string">&quot;http://172.31.0.4:80&quot;</span>&#125;,&#123;<span class="string">&quot;url&quot;</span>:<span class="string">&quot;http://172.31.0.2:80&quot;</span>&#125;,&#123;<span class="string">&quot;url&quot;</span>:<span class="string">&quot;http://172.31.0.3:80&quot;</span>&#125;],<span class="string">&quot;passHostHeader&quot;</span>:<span class="literal">true</span>&#125;,<span class="string">&quot;status&quot;</span>:<span class="string">&quot;enabled&quot;</span>,<span class="string">&quot;usedBy&quot;</span>:[<span class="string">&quot;whoami@docker&quot;</span>],<span class="string">&quot;serverStatus&quot;</span>:&#123;<span class="string">&quot;http://172.31.0.2:80&quot;</span>:<span class="string">&quot;UP&quot;</span>,<span class="string">&quot;http://172.31.0.3:80&quot;</span>:<span class="string">&quot;UP&quot;</span>,<span class="string">&quot;http://172.31.0.4:80&quot;</span>:<span class="string">&quot;UP&quot;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æˆ–è€…æ˜¯è¿™æ ·</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~$ curl -H Host:whoami.docker.localhost http://127.0.0.1</span><br><span class="line">Hostname: 4c9f9a107136</span><br><span class="line">IP: 127.0.0.1</span><br><span class="line">IP: 172.19.0.6</span><br><span class="line">RemoteAddr: 172.19.0.1:46902</span><br><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: whoami.docker.localhost</span><br><span class="line">User-Agent: curl/7.74.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line">X-Forwarded-For: 172.19.0.1</span><br><span class="line">X-Forwarded-Host: whoami.docker.localhost</span><br><span class="line">X-Forwarded-Port: 80</span><br><span class="line">X-Forwarded-Proto: http</span><br><span class="line">X-Forwarded-Server: 8a986b075043</span><br><span class="line">X-Real-Ip: 172.19.0.1</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="å¼€å¯è¯ä¹¦ä¸Basic-Auth"><a href="#å¼€å¯è¯ä¹¦ä¸Basic-Auth" class="headerlink" title="å¼€å¯è¯ä¹¦ä¸Basic Auth"></a>å¼€å¯è¯ä¹¦ä¸<code>Basic Auth</code></h2><ul>
<li><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¤æ‚çš„<code>docker-compose</code>,æ”¯æŒ<code>Let&#39;s Crypto</code>è‡ªåŠ¨ç”³è¯·è¯ä¹¦ã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3.3&quot;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  traefik:</span><br><span class="line">    image: <span class="string">&quot;traefik:v2.5&quot;</span></span><br><span class="line">    container_name: <span class="string">&quot;traefik&quot;</span></span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - <span class="string">&quot;--api.insecure=false&quot;</span></span><br><span class="line">      - <span class="string">&quot;--providers.docker=true&quot;</span></span><br><span class="line">      - <span class="string">&quot;--providers.docker.exposedbydefault=false&quot;</span></span><br><span class="line">      - <span class="string">&quot;--providers.file.directory=/letsencrypt/&quot;</span></span><br><span class="line">      - <span class="string">&quot;--entrypoints.web.address=:80&quot;</span></span><br><span class="line">      - <span class="string">&quot;--entrypoints.websecure.address=:443&quot;</span></span><br><span class="line">      - <span class="string">&quot;--certificatesresolvers.myresolver.acme.httpchallenge=true&quot;</span></span><br><span class="line">      - <span class="string">&quot;--certificatesresolvers.myresolver.acme.httpchallenge.entrypoint=web&quot;</span></span><br><span class="line">      <span class="comment">#- &quot;--certificatesresolvers.myresolver.acme.caserver=https://acme-staging-v02.api.letsencrypt.org/directory&quot;</span></span><br><span class="line">      - <span class="string">&quot;--certificatesresolvers.myresolver.acme.email=&lt;your email&gt;@gmail.com&quot;</span></span><br><span class="line">      - <span class="string">&quot;--certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json&quot;</span></span><br><span class="line">      <span class="comment"># Global HTTP -&gt; HTTPS</span></span><br><span class="line">      - <span class="string">&quot;--entrypoints.web.http.redirections.entryPoint.to=websecure&quot;</span></span><br><span class="line">      - <span class="string">&quot;--entrypoints.web.http.redirections.entryPoint.scheme=https&quot;</span></span><br><span class="line">      <span class="comment"># Enable dashboard</span></span><br><span class="line">      - <span class="string">&quot;--api.dashboard=true&quot;</span></span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;80:80&quot;</span></span><br><span class="line">      - <span class="string">&quot;443:443&quot;</span></span><br><span class="line">      - <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">&quot;./certs:/letsencrypt&quot;</span></span><br><span class="line">      - <span class="string">&quot;/var/run/docker.sock:/var/run/docker.sock:ro&quot;</span></span><br><span class="line">    labels:</span><br><span class="line">      - <span class="string">&quot;traefik.enable=true&quot;</span></span><br><span class="line">      - <span class="string">&quot;traefik.http.services.api@internal.loadbalancer.server.port=8080&quot;</span> <span class="comment"># required by swarm but not used.</span></span><br><span class="line">      - <span class="string">&quot;traefik.http.routers.traefik.rule=Host(`&lt;Your FQDN domain name&gt;`) &amp;&amp; (PathPrefix(`/dashboard`) || PathPrefix(`/api`))&quot;</span></span><br><span class="line">      - <span class="string">&quot;traefik.http.routers.traefik.middlewares=traefik-https-redirect&quot;</span></span><br><span class="line">      - <span class="string">&quot;traefik.http.routers.traefik.entrypoints=websecure&quot;</span></span><br><span class="line">      - <span class="string">&quot;traefik.http.routers.traefik.tls.certresolver=myresolver&quot;</span></span><br><span class="line">      - <span class="string">&quot;traefik.http.routers.traefik.tls=true&quot;</span></span><br><span class="line">      - <span class="string">&quot;traefik.http.routers.traefik.tls.options=default&quot;</span></span><br><span class="line">      - <span class="string">&quot;traefik.http.middlewares.traefik-https-redirect.redirectscheme.scheme=https&quot;</span></span><br><span class="line">      - <span class="string">&quot;traefik.http.routers.traefik.middlewares=traefik-auth&quot;</span></span><br><span class="line">      - <span class="string">&quot;traefik.http.middlewares.traefik-auth.basicauth.users=&lt;login name&gt;:$$apr1$<span class="variable">$Pf2MP</span>/Oy$$....&quot;</span></span><br><span class="line">      - <span class="string">&quot;traefik.http.routers.traefik.service=api@internal&quot;</span></span><br><span class="line">        <span class="comment">#- &#x27;traefik.http.routers.traefik.middlewares=strip&#x27;</span></span><br><span class="line">        <span class="comment">#- &#x27;traefik.http.middlewares.strip.stripprefix.prefixes=/dashboard&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">whoami</span>:</span><br><span class="line">    image: <span class="string">&quot;traefik/whoami&quot;</span></span><br><span class="line">    container_name: <span class="string">&quot;simple-service&quot;</span></span><br><span class="line">    labels:</span><br><span class="line">      - <span class="string">&quot;traefik.enable=true&quot;</span></span><br><span class="line">      - <span class="string">&quot;traefik.http.routers.whoami.rule=Host(`&lt;Your FQDN domain name&gt;`) &amp;&amp; Path(`/whoami`)&quot;</span></span><br><span class="line">      - <span class="string">&quot;traefik.http.routers.whoami.entrypoints=websecure&quot;</span></span><br><span class="line">      - <span class="string">&quot;traefik.http.routers.whoami.tls.certresolver=myresolver&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸Šé¢çš„ç”³è¯·çš„è¯ä¹¦æ˜¯é€šè¿‡<code>httpchallenge</code>,ä¹Ÿå¯ä»¥é€šè¿‡<code>dns</code>éªŒè¯çš„æ–¹å¼, å¹¶ä¸”å¼€å¯äº†<code>Traefik Dashboard</code>çš„<code>TLS+Basic Auth</code>è®¤è¯. ä¸Šé¢çš„<code>whoami</code>çš„æœåŠ¡,æ˜¯ç”¨åšç¤ºä¾‹è¯´æ˜,å°±æ­¤è¯´æ˜å¯ä»¥ä½¿ç”¨<code>Host(</code><your FQDN domain name><code>) &amp;&amp; Path(</code>&#x2F;whoami<code>)</code>æ–¹å¼,å»åå‘ä»£ç†å¾ˆå¤šä¸åŒçš„å†…éƒ¨æœåŠ¡ã€‚</p>
</li>
<li><p>å¦‚ä¸Šé¢æ‰€ç¤º,ä½¿ç”¨äº†æœ¬åœ°<code>./certs:/letsencrypt</code>æŒ‚è½½,æ‰€ä»¥<code>certs</code>ç›®å½•å†…å®¹å¦‚ä¸‹ã€‚<code>acme.json</code>æ˜¯è¯ä¹¦ç›¸å…³çš„å†…å®¹ã€‚</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ tree ./certs/</span><br><span class="line">./certs/</span><br><span class="line">â”œâ”€â”€ acme.json</span><br><span class="line">â””â”€â”€ tls.yml</span><br></pre></td></tr></table></figure>

<ul>
<li><p>åˆ›å»º<code>tls.yml</code>æ˜¯ä¸ºäº†åŠ å¼º<code>TLS</code>çš„è®¾ç½®çº§åˆ«,å†…å®¹å¦‚ä¸‹.å¯ä»¥é€šè¿‡<code>https://www.ssllabs.com</code>å»æµ‹è¯•å½“å‰æœåŠ¡å™¨çš„<code>TLS</code>å®‰å…¨è¯„åˆ†,å¦‚æœèƒ½å¾—åˆ°<code>A+</code>è¯´æ˜éå¸¸å¥½.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cat</span> certs/tls.yml</span><br><span class="line">tls:</span><br><span class="line">  options:</span><br><span class="line">    default:</span><br><span class="line">      minVersion: <span class="string">&quot;VersionTLS13&quot;</span></span><br><span class="line">      sniStrict: <span class="literal">true</span></span><br><span class="line">      cipherSuites:</span><br><span class="line">        - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</span><br><span class="line">        - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</span><br><span class="line">        - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</span><br><span class="line">        - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><br><span class="line">        - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305</span><br><span class="line">        - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ›å»º<code>Basic Auth</code>çš„ç”¨æˆ·ä¸å¯†ç ,ä¸€èˆ¬éƒ½ä½¿ç”¨<code>apache-utils</code>å·¥å…·é‡Œçš„<code>htpasswd</code>å‘½ä»¤,ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼åˆ›å»º,<code>$</code>éœ€è¦è½¬ä¹‰æˆ<code>$$</code>.</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -apr1  uses the apr1 algorithm (Apache variant of the BSD algorithm).</span></span><br><span class="line"></span><br><span class="line">~$ openssl passwd -apr1</span><br><span class="line">Password:</span><br><span class="line">Verifying - Password:</span><br><span class="line">$apr1$AzG7Y5HE<span class="variable">$dZoKWVCmxffAe1oakeHR40</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>æˆ–è€…è¿™æ ·</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">printf</span> <span class="string">&quot;&lt;Your User&gt;:<span class="subst">$(openssl passwd -apr1 &lt;Your password&gt; | sed -E <span class="string">&quot;s:[\$]:\$\$:g&quot;</span>)</span>\n&quot;</span>  &gt;&gt; ~/.htpasswd</span><br><span class="line"></span><br><span class="line">~$ <span class="built_in">printf</span> <span class="string">&quot;admin:<span class="subst">$(openssl passwd -apr1 admin | sed -E <span class="string">&quot;s:[\$]:\$\$:g&quot;</span>)</span>\n&quot;</span></span><br><span class="line">admin:$$apr1$$7eSlrnJD$<span class="variable">$XGLpWARS</span>.YLxwYPoRtUdc.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="docker-composeå®‰è£…MinIO"><a href="#docker-composeå®‰è£…MinIO" class="headerlink" title="docker-composeå®‰è£…MinIO"></a><code>docker-compose</code>å®‰è£…<code>MinIO</code></h3><ul>
<li><p>è¿è¡Œä¸€ä¸ªç¨å¾®å¤æ‚çš„<code>MinIO</code>çš„æœåŠ¡å®ä¾‹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  minio:</span><br><span class="line">    <span class="comment"># Please use fixed versions :D</span></span><br><span class="line">    image: minio/minio</span><br><span class="line">    hostname: minio</span><br><span class="line">    networks:</span><br><span class="line">      - traefik_default</span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="variable">$PWD</span>/minio-data:/data</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - server</span><br><span class="line">      - /data</span><br><span class="line">      - --console-address</span><br><span class="line">      - <span class="string">&quot;:9001&quot;</span></span><br><span class="line">    expose:</span><br><span class="line">      - 9000</span><br><span class="line">      - 9001</span><br><span class="line">    environment:</span><br><span class="line">      - MINIO_ROOT_USER=minio</span><br><span class="line">      - MINIO_ROOT_PASSWORD=minio123</span><br><span class="line">      - APP_NAME=minio</span><br><span class="line">      <span class="comment"># Do NOT use MINIO_DOMAIN or MINIO_SERVER_URL with Traefik.</span></span><br><span class="line">      <span class="comment"># All Routing is done by Traefik, just tell minio where to redirect to.</span></span><br><span class="line">      - MINIO_BROWSER_REDIRECT_URL=http://minio-console.localhost</span><br><span class="line">    labels:</span><br><span class="line">      - traefik.enable=<span class="literal">true</span></span><br><span class="line">      - traefik.docker.network=traefik_default</span><br><span class="line">      - traefik.http.routers.minio.rule=Host(`minio.localhost`)</span><br><span class="line">      - traefik.http.routers.minio-console.rule=Host(`minio-console.localhost`)</span><br><span class="line">      - traefik.http.routers.minio.service=minio</span><br><span class="line">      - traefik.http.services.minio.loadbalancer.server.port=9000</span><br><span class="line">      - traefik.http.services.minio-console.loadbalancer.server.port=9001</span><br><span class="line">      - traefik.http.routers.minio-console.service=minio-console</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  traefik_default:</span><br><span class="line">    external: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">minio$ docker-compose up -d</span><br><span class="line">Creating minio_minio_1 ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿è¡Œä¸Šé¢å®ä¾‹å,å¯ä»¥é€šæµè§ˆå™¨æ‰“å¼€<code>http://minio-console.localhost</code>,è¾“å…¥<code>minio:minio123</code>ç™»å½•åˆ°<code>minIO</code>çš„æ§åˆ¶å°é¡µé¢.ä¸ºä»€ä¹ˆä¼šé€šè¿‡<code>minio-console.localhost</code>è¿™æ ·ä¸€ä¸ªåŸŸå,å°±å¯ä»¥åå‘ä»£ç†å†…éƒ¨çš„æœåŠ¡äº†.è¿™é‡Œå¯ä»¥æ‰“å¼€<code>http://localhost:8080/dashboard/#/http/routers</code>çœ‹åˆ°ç›¸åº”çš„è·¯ç”±,ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹æœ‰é‚£äº›è·¯ç”±:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ curl http://localhost:8080/api/rawdata | jq   <span class="string">&#x27;.routers[] | .service&#x27;</span></span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100  2509    0  2509    0     0  2450k      0 --:--:-- --:--:-- --:--:-- 2450k</span><br><span class="line"><span class="string">&quot;api@internal&quot;</span></span><br><span class="line"><span class="string">&quot;dashboard@internal&quot;</span></span><br><span class="line"><span class="string">&quot;minio-console&quot;</span></span><br><span class="line"><span class="string">&quot;minio&quot;</span></span><br><span class="line"><span class="string">&quot;reverse-proxy-traefik&quot;</span></span><br><span class="line"><span class="string">&quot;whoami-whoami-app&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>è¿™é‡Œæµ‹è¯•æ—¶éœ€è¦æ³¨æ„ä¸€ä¸ªç‚¹,å¦‚æœæŠŠ<code>minio</code>ä¸<code>traefik</code>ç­‰æœåŠ¡æè¿°,å†™åœ¨åŒä¸€ä¸ª<code>docker-compose.yml</code>æ–‡ä»¶é‡Œ,æ˜¯ä¸éœ€è¦<br>æŒ‡å®š<code>networks</code>æ®µçš„,å¦‚æœåˆ†å¼€å†™çš„,æ˜¯éœ€è¦å£°æ˜ä¸<code>traefik</code>çš„æœåŠ¡åœ¨åŒä¸€ä¸ªç½‘ç»œåŸŸå†…,ä¸Šé¢çš„æµ‹è¯•å®ä¾‹ä¸­,<br><code>docker-compose</code>å¯åŠ¨<code>traefik</code>æœåŠ¡æ—¶,ä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ªåä¸º<code>traefik_default</code>ç½‘ç»œåŸŸ.æ‰€ä»¥è¿™é‡Œåœ¨ä¸Šè¿°<br>å®ä¾‹ä¸­:<code>whoami,minio</code>ä¸­,éƒ½å£°æ˜å®šä¹‰äº†<code>networks</code>çš„å­—æ®µ,æœ¬æœº<code>Docker</code>ç½‘ç»œåˆ—è¡¨å¦‚ä¸‹:</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~$ docker network <span class="built_in">ls</span></span><br><span class="line">NETWORK ID     NAME                 DRIVER    SCOPE</span><br><span class="line">f8c2befaa42f   bridge               bridge    <span class="built_in">local</span></span><br><span class="line">f27beded9896   host                 host      <span class="built_in">local</span></span><br><span class="line">244ab53cbc48   none                 null      <span class="built_in">local</span></span><br><span class="line">18ddc4985478   traefik_default      bridge    <span class="built_in">local</span></span><br><span class="line">1c5f5a863ef9   whoami-app_default   bridge    <span class="built_in">local</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>Traefik</code>åˆ›å»ºè·¯ç”±è§„åˆ™æœ‰å¤šç§æ–¹å¼,æ¯”å¦‚:</p>
<ul>
<li>åŸç”Ÿ<code>Ingress</code>å†™æ³•</li>
<li>ä½¿ç”¨<code>CRD IngressRoute</code>æ–¹å¼</li>
<li>ä½¿ç”¨<code>GatewayAPI</code>çš„æ–¹å¼</li>
</ul>
</li>
<li><p>åœæ‰æµ‹è¯•å®ä¾‹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">whoami-app$ docker-compose -f docker-compose-v2.yml down</span><br><span class="line">Stopping whoami-app_whoami_1 ... <span class="keyword">done</span></span><br><span class="line">Stopping whoami-app_whoami_3 ... <span class="keyword">done</span></span><br><span class="line">Stopping whoami-app_whoami_2 ... <span class="keyword">done</span></span><br><span class="line">Removing whoami-app_whoami_1 ... <span class="keyword">done</span></span><br><span class="line">Removing whoami-app_whoami_3 ... <span class="keyword">done</span></span><br><span class="line">Removing whoami-app_whoami_2 ... <span class="keyword">done</span></span><br><span class="line">Removing network whoami-app_default</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="MCå®¢æˆ·ç«¯"><a href="#MCå®¢æˆ·ç«¯" class="headerlink" title="MCå®¢æˆ·ç«¯"></a><code>MC</code>å®¢æˆ·ç«¯</h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://docs.min.io/docs/minio-client-complete-guide.html">MinIO Client Complete Guide Slack</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.min.io/client/mc/release/linux-amd64/mc</span><br><span class="line"><span class="built_in">chmod</span> +x mc</span><br><span class="line">./mc --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>é…ç½®ä¸€ä¸ªS3æœåŠ¡ç«¯</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./mc config host add mystorage http://minio.localhost test1234access test1234secret --api s3v4</span><br><span class="line">mc: Configuration written to `/home/michael/.mc/config.json`. Please update your access credentials.</span><br><span class="line">mc: Successfully created `/home/michael/.mc/share`.</span><br><span class="line">mc: Initialized share uploads `/home/michael/.mc/share/uploads.json` file.</span><br><span class="line">mc: Initialized share downloads `/home/michael/.mc/share/downloads.json` file.</span><br><span class="line">Added `mystorage` successfully.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹ä¿¡æ¯</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ ./mc admin info play/</span><br><span class="line">â—  play.min.io</span><br><span class="line">   Uptime: 2 days</span><br><span class="line">   Version: 2021-12-10T23:03:39Z</span><br><span class="line">   Network: 1/1 OK</span><br><span class="line">   Drives: 4/4 OK</span><br><span class="line"></span><br><span class="line">11 GiB Used, 392 Buckets, 8,989 Objects</span><br><span class="line">4 drives online, 0 drives offline</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="S3å®¢æˆ·ç«¯è¿æ¥æµ‹è¯•MinIO"><a href="#S3å®¢æˆ·ç«¯è¿æ¥æµ‹è¯•MinIO" class="headerlink" title="S3å®¢æˆ·ç«¯è¿æ¥æµ‹è¯•MinIO"></a><code>S3</code>å®¢æˆ·ç«¯è¿æ¥æµ‹è¯•<code>MinIO</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ pip3 install awscli</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">minio$ aws configure --profile minio</span><br><span class="line">AWS Access Key ID [None]: test1234minio</span><br><span class="line">AWS Secret Access Key [None]: test1234minio</span><br><span class="line">Default region name [None]: minio-lan</span><br><span class="line">Default output format [None]: json</span><br></pre></td></tr></table></figure>

<h1 id="HelmåŒ…ç®¡ç†å™¨"><a href="#HelmåŒ…ç®¡ç†å™¨" class="headerlink" title="HelmåŒ…ç®¡ç†å™¨"></a><code>Helm</code>åŒ…ç®¡ç†å™¨</h1><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/helm/helm">Helm</a>æ˜¯<code>k8s</code>çš„åŒ…ç®¡ç†å™¨,å®ƒå¯ä»¥ç±»æ¯”ä¸º<code>Debian,Ubuntu</code>çš„<code>apt</code>.<code>Red Hat</code>çš„<code>yum</code>,<code>Python</code>ä¸­çš„<code>pip</code>.<code>Nodejs</code>çš„<code>npm</code>åŒ…ç®¡ç†å™¨.<code>Helm</code>å¯ä»¥ç†è§£ä¸º<code>Kubernetes</code>çš„åŒ…ç®¡ç†å·¥å…·,å¯ä»¥æ–¹ä¾¿åœ°å‘ç°ã€å…±äº«å’Œä½¿ç”¨ä¸º<code>Kubernetes</code>æ„å»ºçš„åº”ç”¨,å®ƒåŒ…å«å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ:<ul>
<li><code>.Chart</code>:ä¸€ä¸ª<code>Helm</code>åŒ…,å…¶ä¸­åŒ…å«äº†è¿è¡Œä¸€ä¸ªåº”ç”¨æ‰€éœ€è¦çš„é•œåƒã€ä¾èµ–å’Œèµ„æºå®šä¹‰ç­‰,è¿˜å¯èƒ½åŒ…å«<code>Kubernetes</code>é›†ç¾¤ä¸­çš„æœåŠ¡å®šä¹‰,ç±»ä¼¼<code>Homebrew</code>ä¸­çš„<code>formula</code>,<code>APT</code>çš„<code>dpkg</code>æˆ–è€…<code>Yum</code>çš„<code>rpm</code>æ–‡ä»¶.</li>
<li><code>.Release</code>:åœ¨<code>Kubernetes</code>é›†ç¾¤ä¸Šè¿è¡Œçš„<code>Chart</code>çš„ä¸€ä¸ªå®ä¾‹.åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸Š,ä¸€ä¸ª<code>Chart</code>å¯ä»¥å®‰è£…å¾ˆå¤šæ¬¡.æ¯æ¬¡å®‰è£…éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„<code>Release</code>. <code>MySQL Chart</code>,å¦‚æœæƒ³åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä¸¤ä¸ªæ•°æ®åº“,å°±å¯ä»¥æŠŠè¿™ä¸ª<code>Chart</code>å®‰è£…ä¸¤æ¬¡.æ¯æ¬¡å®‰è£…éƒ½ä¼šç”Ÿæˆè‡ªå·±çš„<code>Release</code>,ä¼šæœ‰è‡ªå·±çš„<code>Release</code>åç§°.</li>
<li><code>.Repository</code>:ç”¨äºå‘å¸ƒå’Œå­˜å‚¨<code>Chart</code>çš„ä»“åº“.</li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½ä¸€ä¸ªæœ€ç‰ˆæœ¬,æŠŠå®ƒè§£å‹åˆ°/usr/local/bin</span></span><br><span class="line">~$ wget -c https://storage.googleapis.com/kubernetes-helm/helm-v2.13.1-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">~$ helm version</span><br><span class="line">Client: &amp;version.Version&#123;SemVer:<span class="string">&quot;v2.13.1&quot;</span>, GitCommit:<span class="string">&quot;618447cbf203d147601b4b9bd7f8c37a5d39fbb4&quot;</span>, GitTreeState:<span class="string">&quot;clean&quot;</span>&#125;</span><br><span class="line">Error: could not find tiller</span><br><span class="line"></span><br><span class="line">~$ helm completion bash &gt; ~/.helmrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;source ~/.helmrc&quot;</span> &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…TilleræœåŠ¡å™¨"><a href="#å®‰è£…TilleræœåŠ¡å™¨" class="headerlink" title="å®‰è£…TilleræœåŠ¡å™¨"></a>å®‰è£…<code>Tiller</code>æœåŠ¡å™¨</h2><ul>
<li><a target="_blank" rel="noopener" href="https://yq.aliyun.com/articles/159601">åˆ©ç”¨Helmç®€åŒ–Kubernetesåº”ç”¨éƒ¨ç½²</a><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~$ helm init</span><br><span class="line">Creating /home/lcy/.helm</span><br><span class="line">Creating /home/lcy/.helm/repository</span><br><span class="line">Creating /home/lcy/.helm/repository/cache</span><br><span class="line">Creating /home/lcy/.helm/repository/local</span><br><span class="line">Creating /home/lcy/.helm/plugins</span><br><span class="line">Creating /home/lcy/.helm/starters</span><br><span class="line">Creating /home/lcy/.helm/cache/archive</span><br><span class="line">Creating /home/lcy/.helm/repository/repositories.yaml</span><br><span class="line">Adding stable repo with URL: https://kubernetes-charts.storage.googleapis.com</span><br><span class="line">Error: Looks like <span class="string">&quot;https://kubernetes-charts.storage.googleapis.com&quot;</span> is not a valid chart repository or cannot be reached: <span class="built_in">read</span> tcp 172.18.127.186:54980-&gt;216.58.199.16:443: <span class="built_in">read</span>: connection reset by peer</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>å¦‚ä¸Šæ‰€ç¤º,æ— æ³•è¿æ¥åˆ°å®˜æ–¹çš„æœåŠ¡å™¨,å›½å†…åˆ©ç”¨é˜¿é‡Œäº‘æºæ¥å®‰è£…<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">~$ helm init --upgrade -i registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.13.1 --stable-repo-url https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="line">Creating /home/lcy/.helm/repository/repositories.yaml</span><br><span class="line">Adding stable repo with URL: https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="line">Adding <span class="built_in">local</span> repo with URL: http://127.0.0.1:8879/charts</span><br><span class="line"><span class="variable">$HELM_HOME</span> has been configured at /home/lcy/.helm.</span><br><span class="line"></span><br><span class="line">Tiller (the Helm server-side component) has been installed into your Kubernetes Cluster.</span><br><span class="line"></span><br><span class="line">Please note: by default, Tiller is deployed with an insecure <span class="string">&#x27;allow unauthenticated users&#x27;</span> policy.</span><br><span class="line">To prevent this, run `helm init` with the --tiller-tls-verify flag.</span><br><span class="line">For more information on securing your installation see: https://docs.helm.sh/using_helm/<span class="comment">#securing-your-helm-installation</span></span><br><span class="line">Happy Helming!</span><br><span class="line"></span><br><span class="line">~$ helm init --upgrade</span><br><span class="line"><span class="variable">$HELM_HOME</span> has been configured at /home/lcy/.helm.</span><br><span class="line"></span><br><span class="line">Tiller (the Helm server-side component) has been upgraded to the current version.</span><br><span class="line">Happy Helming!</span><br><span class="line"><span class="comment"># æŸ¥æ‰¾charts</span></span><br><span class="line">~$ helm search</span><br><span class="line">NAME                            CHART VERSION   APP VERSION     DESCRIPTION</span><br><span class="line">stable/acs-engine-autoscaler    2.1.3           2.1.1           Scales worker nodes within agent pools</span><br><span class="line">stable/aerospike                0.1.7           v3.14.1.2       A Helm chart <span class="keyword">for</span> Aerospike <span class="keyword">in</span> Kubernetes</span><br><span class="line">stable/anchore-engine           0.1.3           0.1.6           Anchore container analysis and policy evaluation engine s...</span><br><span class="line">stable/artifactory              7.0.3           5.8.4           Universal Repository Manager supporting all major packagi...</span><br><span class="line">stable/artifactory-ha           0.1.0           5.8.4           Universal Repository Manager supporting all major packagi...</span><br><span class="line">[...]</span><br><span class="line"><span class="comment"># æ›´æ–°ä»“åº“</span></span><br><span class="line">~$ helm repo update</span><br><span class="line">Hang tight <span class="keyword">while</span> we grab the latest from your chart repositories...</span><br><span class="line">...Skip <span class="built_in">local</span> chart repository</span><br><span class="line">...Successfully got an update from the <span class="string">&quot;stable&quot;</span> chart repository</span><br><span class="line">Update Complete. âˆ Happy Helming!âˆ</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»“åº“åœ°å€</span></span><br><span class="line">~$ helm repo list</span><br><span class="line">NAME  	URL</span><br><span class="line">stable	https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="line"><span class="built_in">local</span> 	http://127.0.0.1:8879/charts</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="ä½¿ç”¨Helm-Chartéƒ¨ç½²MinIO"><a href="#ä½¿ç”¨Helm-Chartéƒ¨ç½²MinIO" class="headerlink" title="ä½¿ç”¨Helm Chartéƒ¨ç½²MinIO"></a>ä½¿ç”¨<code>Helm Chart</code>éƒ¨ç½²<code>MinIO</code></h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.min.io/cn/deploy-minio-on-kubernetes.html">MinIOä¸­æ–‡æ‰‹å†Œ</a></li>
<li>é»˜è®¤<code>standaline</code>æ¨¡å¼ä¸‹,éœ€è¦å¼€å¯<code>Beta API</code>çš„<code>Kubernetes 1.4+</code>.å¦‚æœæ²¡æœ‰å‡ºé”™å°±ä¼šè¿è¡ŒæˆåŠŸ,å¦‚ä¸‹æ‰€ç¤º.<br>å¦‚æœå‡ºé”™,æŒ‰ç…§åé¢çš„é”™è¯¯å¤„ç†.<br><code>accessKey</code>é»˜è®¤<code>access key	AKIAIOSFODNN7EXAMPLE</code><br><code>secretKey</code>é»˜è®¤<code>secret key	wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">~$ helm install stable/minio</span><br><span class="line">NAME:   snug-elk</span><br><span class="line">LAST DEPLOYED: Mon Apr 15 14:07:10 2019</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: DEPLOYED</span><br><span class="line"></span><br><span class="line">RESOURCES:</span><br><span class="line">==&gt; v1/ConfigMap</span><br><span class="line">NAME                      DATA  AGE</span><br><span class="line">snug-elk-minio-config-cm  2     0s</span><br><span class="line"></span><br><span class="line">==&gt; v1/PersistentVolumeClaim</span><br><span class="line">NAME            STATUS   VOLUME  CAPACITY  ACCESS MODES  STORAGECLASS  AGE</span><br><span class="line">snug-elk-minio  Pending  0s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Pod(related)</span><br><span class="line">NAME                             READY  STATUS   RESTARTS  AGE</span><br><span class="line">snug-elk-minio-7b9878bb66-mmx9n  0/1    Pending  0         0s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Secret</span><br><span class="line">NAME                 TYPE    DATA  AGE</span><br><span class="line">snug-elk-minio-user  Opaque  2     0s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Service</span><br><span class="line">NAME                TYPE          CLUSTER-IP     EXTERNAL-IP  PORT(S)         AGE</span><br><span class="line">snug-elk-minio-svc  LoadBalancer  10.103.48.186  &lt;pending&gt;    9000:32076/TCP  0s</span><br><span class="line"></span><br><span class="line">==&gt; v1beta1/Deployment</span><br><span class="line">NAME            READY  UP-TO-DATE  AVAILABLE  AGE</span><br><span class="line">snug-elk-minio  0/1    1           0          0s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NOTES:</span><br><span class="line"></span><br><span class="line">Minio can be accessed via port 9000 on an external IP address. Get the service external IP address by:</span><br><span class="line">kubectl get svc --namespace default -l app=snug-elk-minio</span><br><span class="line"></span><br><span class="line">Note that the public IP may take a couple of minutes to be available.</span><br><span class="line"></span><br><span class="line">You can now access Minio server on http://&lt;External-IP&gt;:9000. Follow the below steps to connect to Minio server with mc client:</span><br><span class="line"></span><br><span class="line">  1. Download the Minio mc client - https://docs.minio.io/docs/minio-client-quickstart-guide</span><br><span class="line"></span><br><span class="line">  2. mc config host add snug-elk-minio-local http://&lt;External-IP&gt;:9000 AKIAIOSFODNN7EXAMPLE wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY S3v4</span><br><span class="line"></span><br><span class="line">  3. mc <span class="built_in">ls</span> snug-elk-minio-local</span><br><span class="line"></span><br><span class="line">Alternately, you can use your browser or the Minio SDK to access the server - https://docs.minio.io/categories/17</span><br></pre></td></tr></table></figure>

<ul>
<li>æŸ¥çœ‹Releaseå¯¹è±¡</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get service snug-elk-minio-svc</span><br><span class="line">NAME                 TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">snug-elk-minio-svc   LoadBalancer   10.103.48.186   &lt;pending&gt;     9000:32076/TCP   3m7s</span><br><span class="line"></span><br><span class="line">~$ kubectl  get pods</span><br><span class="line">NAME                           READY   STATUS    RESTARTS   AGE</span><br><span class="line">store-minio-75bb89c596-74nz9   0/1     Pending   0          17m</span><br><span class="line"></span><br><span class="line">~$ kubectl   describe pod  store-minio-75bb89c596-74nz9</span><br><span class="line">Name:               store-minio-75bb89c596-74nz9</span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line">~$ helm list</span><br><span class="line">NAME            REVISION        UPDATED                         STATUS          CHART           APP VERSION     NAMESPACE</span><br><span class="line">snug-elk        1               Mon Apr 15 14:07:10 2019        DEPLOYED        minio-0.5.5                     default</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…MinIOå®¢æˆ·ç«¯"><a href="#å®‰è£…MinIOå®¢æˆ·ç«¯" class="headerlink" title="å®‰è£…MinIOå®¢æˆ·ç«¯"></a>å®‰è£…<code>MinIO</code>å®¢æˆ·ç«¯</h3><ul>
<li>æŒ‰ç…§ä¸Šé¢å®‰è£…æœåŠ¡å™¨çš„<code>NOTES</code>,å®‰è£…ä¸é…ç½®å®ƒçš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ wget https://dl.minio.io/client/mc/release/linux-amd64/mc</span><br><span class="line">~$ sudo <span class="built_in">mv</span> mc /usr/local/bin &amp;&amp; <span class="built_in">chmod</span> +x /usr/local/bin/mc</span><br><span class="line">~$ kubectl get svc --namespace default -l app=snug-elk-minio</span><br><span class="line">NAME                 TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">snug-elk-minio-svc   LoadBalancer   10.103.48.186   &lt;pending&gt;     9000:32076/TCP   25h</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="å®‰è£…é›†ç¾¤ç›‘æ§DashBoard"><a href="#å®‰è£…é›†ç¾¤ç›‘æ§DashBoard" class="headerlink" title="å®‰è£…é›†ç¾¤ç›‘æ§DashBoard"></a>å®‰è£…é›†ç¾¤ç›‘æ§<code>DashBoard</code></h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/dashboard/wiki/Installation">DashBoard Installation</a></li>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">Web UI (Dashboard)</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl create -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml</span><br></pre></td></tr></table></figure>
<ul>
<li>æŸ¥çœ‹å®‰è£…æ˜¯å¦æˆåŠŸ.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl  --namespace=kube-system get pod -l k8s-app=kubernetes-dashboard</span><br><span class="line">NAME                                    READY   STATUS             RESTARTS   AGE</span><br><span class="line">kubernetes-dashboard-5f7b999d65-m2zmt   0/1     ImagePullBackOff   0          10m</span><br><span class="line"></span><br><span class="line">~$ kubectl  --namespace=kube-system describe  pod -l k8s-app=kubernetes-dashboard | grep <span class="string">&quot;Events&quot;</span> -A +10</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason     Age                  From               Message</span><br><span class="line">  ----     ------     ----                 ----               -------</span><br><span class="line">  Normal   Scheduled  14m                  default-scheduler  Successfully assigned kube-system/kubernetes-dashboard-5f7b999d65-m2zmt to dig001</span><br><span class="line">  Normal   Pulling    11m (x4 over 14m)    kubelet, dig001    Pulling image <span class="string">&quot;k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1&quot;</span></span><br><span class="line">  Warning  Failed     11m (x4 over 13m)    kubelet, dig001    Failed to pull image <span class="string">&quot;k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1&quot;</span>: rpc error: code = Unknown desc = Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="keyword">while</span> waiting <span class="keyword">for</span> connection (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">  Warning  Failed     11m (x4 over 13m)    kubelet, dig001    Error: ErrImagePull</span><br><span class="line">  Warning  Failed     11m (x6 over 13m)    kubelet, dig001    Error: ImagePullBackOff</span><br><span class="line">  Normal   BackOff    4m5s (x36 over 13m)  kubelet, dig001    Back-off pulling image <span class="string">&quot;k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>æ ¹<code>kubectl -n kube-system delete $(kubectl -n kube-system get pod -o name | grep dashboard)</code>ä¸‹é¢ä¿®æ”¹å®ƒçš„é•œåƒåœ°å€,æ›¿æ¢æˆå›½å†…çš„é˜¿é‡Œäº‘çš„åœ°å€.</li>
<li>ä½¿ç”¨<code>kubectl  edit deployment/kubernetes-dashboard -n kube-system</code>æ‰“å¼€ç¼–è¾‘,æŠŠ<code>k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1</code>æ›¿æ¢æˆ<code>registry.cn-hangzhou.aliyuncs.com/google_containers/kubernetes-dashboard-amd64:v1.10.1</code>,ä¿å­˜é€€å‡º.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹å,å®‰è£…æˆäº†.</span></span><br><span class="line">~$ kubectl  --namespace=kube-system get deployment -l k8s-app=kubernetes-dashboard</span><br><span class="line">NAME                   READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">kubernetes-dashboard   1/1     1            1           51m</span><br><span class="line">~$ kubectl  --namespace=kube-system get pod -l k8s-app=kubernetes-dashboard</span><br><span class="line">NAME                                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">kubernetes-dashboard-5d9599dc98-gj8w7   1/1     Running   0          99s</span><br><span class="line">~$ kubectl  --namespace=kube-system get svc -l k8s-app=kubernetes-dashboard</span><br><span class="line">NAME                   TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubernetes-dashboard   ClusterIP   10.107.85.75   &lt;none&gt;        443/TCP   49m</span><br></pre></td></tr></table></figure>

<h3 id="ProxyåŠ SSHè½¬å‘è®¿é—®æ–¹å¼"><a href="#ProxyåŠ SSHè½¬å‘è®¿é—®æ–¹å¼" class="headerlink" title="ProxyåŠ SSHè½¬å‘è®¿é—®æ–¹å¼"></a><code>Proxy</code>åŠ <code>SSH</code>è½¬å‘è®¿é—®æ–¹å¼</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># k8sçš„æœåŠ¡å™¨ä¸Š</span></span><br><span class="line">~$ kubectl  proxy</span><br><span class="line">Starting to serve on 127.0.0.1:8001</span><br><span class="line"><span class="comment"># æ§åˆ¶ä¸»æœºä¸Šè¿è¡Œä¸‹é¢å‘½ä»¤,å†ä»æµè§ˆå™¨é‡Œæ‰“å¼€http://127.0.0.1:8001/å°±èƒ½è®¿é—®åˆ°DashBoard</span></span><br><span class="line">~$ ssh 8001:localhost:8001 &lt;user@k8s-server&gt; -Nf</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹Serviceç«¯å£ç±»å‹"><a href="#ä¿®æ”¹Serviceç«¯å£ç±»å‹" class="headerlink" title="ä¿®æ”¹Serviceç«¯å£ç±»å‹"></a>ä¿®æ”¹<code>Service</code>ç«¯å£ç±»å‹</h3><ul>
<li>é€šè¿‡<code>kubectl --namespace=kube-system edit svc kubernetes-dashboard</code>æ‰“å¼€ç¼–è¾‘,æŠŠ<code>type: ClusterIP</code>æ›¿æ¢æˆ<code>type: NodePort</code>.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl --namespace=kube-system edit svc kubernetes-dashboard</span><br><span class="line">~$ kubectl --namespace=kube-system get  svc kubernetes-dashboard</span><br><span class="line">NAME                   TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)         AGE</span><br><span class="line">kubernetes-dashboard   NodePort   10.107.85.75   &lt;none&gt;        443:31690/TCP   65m</span><br></pre></td></tr></table></figure></li>
<li>å¦‚ä¸Šæ‰€ç¤ºå¯ä»¥é€š<code>https://&lt;service-host&gt;:31690/</code>è®¿é—®åˆ°DashBoard.</li>
</ul>
<h3 id="è®¿é—®è®¤è¯"><a href="#è®¿é—®è®¤è¯" class="headerlink" title="è®¿é—®è®¤è¯"></a>è®¿é—®è®¤è¯</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/dashboard/wiki/Creating-sample-user">Creating sample user</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/dashboard/wiki/Access-control#authorization-header">Access control</a></li>
<li>ç¬¬ä¸€æ¬¡æ‰“å¼€<code>DashBoard</code>ä¼šæç¤ºä¸¤ç§ç™»å½•æ–¹å¼,<code>Kubeconfig</code>ä¸<code>Token</code>.ä¸‹é¢å‚ç…§<a target="_blank" rel="noopener" href="https://github.com/kubernetes/dashboard/wiki/Creating-sample-user">Creating sample user</a>å®‰è£…ä¸€ä¸‹.</li>
</ul>
<h4 id="åˆ›å»ºæœåŠ¡å¸å·"><a href="#åˆ›å»ºæœåŠ¡å¸å·" class="headerlink" title="åˆ›å»ºæœåŠ¡å¸å·"></a>åˆ›å»ºæœåŠ¡å¸å·</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cat</span> admin-user.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: admin-user</span><br><span class="line">  namespace: kube-system</span><br><span class="line">~$ kubectl create -f admin-user.yaml</span><br><span class="line"></span><br><span class="line">~$ kubectl -n kube-system describe secret $(kubectl -n kube-system  get secret | grep admin | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">Name:         admin-user-token-7dj2c</span><br><span class="line">Namespace:    kube-system</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  kubernetes.io/service-account.name: admin-user</span><br><span class="line">              kubernetes.io/service-account.uid: a65538aa-673b-11e9-b8a2-00163e027e39</span><br><span class="line"></span><br><span class="line">Type:  kubernetes.io/service-account-token</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">ca.crt:     1025 bytes</span><br><span class="line">namespace:  11 bytes</span><br><span class="line">token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLTdkajJjIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJhNjU1MzhhYS02NzNiLTExZTktYjhhMi0wMDE2M2UwMjdlMzkiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06YWRtaW4tdXNlciJ9.eW_YSgn_kTIQDcbB51k8HaY9LABeFg5mFFPJykYgsoyxZH_b80WEcDZn4Z4Ix2BJvhK1sBESfSa_Qn1yN5pcIzUMROIYvBGZBSnMmw2VsSpQMUTJ1ha43ql-GKCz15ro1VrhyeWeCtiVTILA0Z0DwfgO2skjY2x1KO_76sDR7r66frZDjGmgYTm-b3E6RdcETB41Wjjuj-nt3b3ZblkBr3QDKP-tlvnW_nr7LcmgF7etjU8qK_W3fj-LB_BnWRpRiamQeXLNJuC-Dq42x00gAzQuVg17rDcEiKxJWmDYYsojvm7Xg0fSwXLCdBfgysYCz5PMR05dT0QU0iYO7z_Cow</span><br></pre></td></tr></table></figure>
<ul>
<li>æ‰“å¼€DashBoardé¦–é¡µ,å¡«å…¥ä¸Šé¢çš„<code>token</code>å€¼.</li>
</ul>
<h4 id="åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š"><a href="#åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š" class="headerlink" title="åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š"></a>åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cat</span> dashboard-admin.yaml</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: kubernetes-dashboard</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: cluster-admin</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: kubernetes-dashboard</span><br><span class="line">  namespace: kube-system</span><br><span class="line"></span><br><span class="line">~$ kubectl create -f dashboard-admin.yaml</span><br><span class="line"></span><br><span class="line">~$ kubectl -n kube-system describe secret $(kubectl -n kube-system  get secret | grep <span class="string">&quot;kubernetes-dashboard-token&quot;</span> |awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">Name:         kubernetes-dashboard-token-ftk96</span><br><span class="line">Namespace:    kube-system</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  kubernetes.io/service-account.name: kubernetes-dashboard</span><br><span class="line">              kubernetes.io/service-account.uid: ba35db4d-672d-11e9-b8a2-00163e027e39</span><br><span class="line"></span><br><span class="line">Type:  kubernetes.io/service-account-token</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">ca.crt:     1025 bytes</span><br><span class="line">namespace:  11 bytes</span><br><span class="line">token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZC10b2tlbi1mdGs5NiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImJhMzVkYjRkLTY3MmQtMTFlOS1iOGEyLTAwMTYzZTAyN2UzOSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTprdWJlcm5ldGVzLWRhc2hib2FyZCJ9.gnspFBWcou3-EgMsSPPQqSt1fwWne6tLCNgHa0yrQLEH9DDRgDQh1mBDne4Z2M-s3FPlTV9DI77QneanA12jHrpLHRohQSlyiz8Pv3xa7JRb7Hfyj5PhbSlX2KtTbOlVvAdlFttFi3vw-fbUJWcALEmogwa7jnlR233slJLjZ8nAA9xsE-gr4_zYmZ2VhYGfH0dAs2H2aCklRl2Sy5VQpoDlGjKH82-FcCrLwGQyLpAA9tr0H7pivGIFqO46PWR0aBLiT1BBkmjoQJkDPy0qRxi90nG1WyFnDLHYK6BRDTZ4G-J3QhAiAK0su-7i6rJhMKm-FbnYXULIstW1LyO4tg</span><br></pre></td></tr></table></figure>

<h3 id="æ›´æ–°Dashboard"><a href="#æ›´æ–°Dashboard" class="headerlink" title="æ›´æ–°Dashboard"></a>æ›´æ–°<code>Dashboard</code></h3><ul>
<li>å®‰è£…<code>Dashboard</code>å®ƒä¸ä¼šè‡ªåŠ¨æ›´æ–°å¤ç›–æœ¬åœ°æ—§çš„ç‰ˆæœ¬,å¿…é¡»è¦æ‰‹åŠ¨æ¸…é™¤çš„æ—§çš„ç‰ˆæœ¬å†å®‰è£…æ–°çš„ç‰ˆæœ¬.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl -n kube-system delete $(kubectl -n kube-system get pod -o name | grep dashboard)</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="å®˜æ–¹å¿«é€Ÿå…¥é—¨å®ä¾‹æ•™ç¨‹"><a href="#å®˜æ–¹å¿«é€Ÿå…¥é—¨å®ä¾‹æ•™ç¨‹" class="headerlink" title="å®˜æ–¹å¿«é€Ÿå…¥é—¨å®ä¾‹æ•™ç¨‹"></a>å®˜æ–¹å¿«é€Ÿå…¥é—¨å®ä¾‹æ•™ç¨‹</h1><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/examples">https://github.com/kubernetes/examples</a></li>
</ul>
<h2 id="Guestbookå®ä¾‹"><a href="#Guestbookå®ä¾‹" class="headerlink" title="Guestbookå®ä¾‹"></a><code>Guestbook</code>å®ä¾‹</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~$ git <span class="built_in">clone</span> https://github.com/kubernetes/examples</span><br><span class="line">~$ <span class="built_in">cd</span> exmaples</span><br><span class="line">~$ tree -L 1</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ cassandra</span><br><span class="line">â”œâ”€â”€ code-of-conduct.md</span><br><span class="line">â”œâ”€â”€ CONTRIBUTING.md</span><br><span class="line">â”œâ”€â”€ guestbook</span><br><span class="line">â”œâ”€â”€ guestbook-go</span><br><span class="line">â”œâ”€â”€ guidelines.md</span><br><span class="line">â”œâ”€â”€ LICENSE</span><br><span class="line">â”œâ”€â”€ mysql-wordpress-pd</span><br><span class="line">â”œâ”€â”€ OWNERS</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ SECURITY_CONTACTS</span><br><span class="line">â””â”€â”€ staging</span><br><span class="line"></span><br><span class="line">5 directories, 7 files</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…Redis-Master-Pod"><a href="#å®‰è£…Redis-Master-Pod" class="headerlink" title="å®‰è£…Redis Master Pod"></a>å®‰è£…<code>Redis Master Pod</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cd</span> examples/guestbook$ &amp;&amp; <span class="built_in">ls</span> *.yaml</span><br><span class="line">frontend-deployment.yaml  redis-master-deployment.yaml  redis-slave-deployment.yaml</span><br><span class="line">frontend-service.yaml     redis-master-service.yaml     redis-slave-service.yaml</span><br><span class="line">~$ <span class="built_in">cat</span> redis-master-deployment.yaml</span><br><span class="line">apiVersion: apps/v1 <span class="comment">#  for k8s versions before 1.9.0 use apps/v1beta2  and before 1.8.0 use extensions/v1beta1</span></span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: redis-master</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: redis</span><br><span class="line">      role: master</span><br><span class="line">      tier: backend</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: redis</span><br><span class="line">        role: master</span><br><span class="line">        tier: backend</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: master</span><br><span class="line">        <span class="comment"># image: k8s.gcr.io/redis:e2e  # or just image: redis</span></span><br><span class="line">        image: forestgun007/redis:e2e</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 100Mi</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 6379</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>æ³¨æ„</strong>ä¸Šé¢çš„<code>k8.gcr.io</code>åœ¨å›½å†…æ˜¯ä¸èƒ½è®¿é—®çš„,æ‰€ä»¥è¦ä¿®æ”¹<code>redis-master-deployment.yaml</code>é‡Œçš„<code>image</code>,<br>è¿™é‡Œé€šè¿‡<code>docker search redis:e2e</code>æŸ¥è¯¢åˆ°ä¸€äº›<code>mirror</code>çš„é•œåƒæ–‡ä»¶.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ docker search redis:e2e</span><br><span class="line">NAME                       DESCRIPTION                          STARS               OFFICIAL            AUTOMATED</span><br><span class="line">forestgun007/redis         gcr.io/google_containers/redis:e2e   1                                       [OK]</span><br><span class="line">will835559313/gcr_redis    gcr.io/google_containers/redis:e2e   0                                       [OK]</span><br><span class="line">smallguitar/redis-master   gcr.io/google_containers/redis:e2e   0                                       [OK]</span><br><span class="line"></span><br><span class="line">~$ kubectl apply -f redis-master-deployment.yaml</span><br><span class="line">~$ kubectl get pods</span><br><span class="line">redis-slave-555b8847c4-mttt9    1/1     Running   0          16h</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…Redis-Master-Service"><a href="#å®‰è£…Redis-Master-Service" class="headerlink" title="å®‰è£…Redis Master Service"></a>å®‰è£…<code>Redis Master Service</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cat</span> redis-master-service.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: redis-master</span><br><span class="line">  labels:</span><br><span class="line">    app: redis</span><br><span class="line">    role: master</span><br><span class="line">    tier: backend</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 6379</span><br><span class="line">    targetPort: 6379</span><br><span class="line">  selector:</span><br><span class="line">    app: redis</span><br><span class="line">    role: master</span><br><span class="line">    tier: backend</span><br><span class="line">~$ kubectl apply -f redis-master-service.yaml</span><br><span class="line">~$ kubectl get service redis-master</span><br><span class="line">NAME           TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">redis-master   ClusterIP   10.106.23.86   &lt;none&gt;        6379/TCP   17h</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…Redis-Slave-Pod"><a href="#å®‰è£…Redis-Slave-Pod" class="headerlink" title="å®‰è£…Redis Slave Pod"></a>å®‰è£…<code>Redis Slave Pod</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> redis-slave-deployment.yaml</span><br><span class="line">apiVersion: apps/v1 <span class="comment">#  for k8s versions before 1.9.0 use apps/v1beta2  and before 1.8.0 use extensions/v1beta1</span></span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: redis-slave</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: redis</span><br><span class="line">      role: slave</span><br><span class="line">      tier: backend</span><br><span class="line">  replicas: 2</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: redis</span><br><span class="line">        role: slave</span><br><span class="line">        tier: backend</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: slave</span><br><span class="line">        <span class="comment"># gcr.io/google_samples/gb-redisslave:v1 åŒæ ·éœ€è¦æ”¹æˆä¸‹é¢è¿™ä¸ªé•œåƒ</span></span><br><span class="line">        image: forestgun007/gb-redisslave:v1</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 100Mi</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: GET_HOSTS_FROM</span><br><span class="line">          value: dns</span><br><span class="line">          <span class="comment"># If your cluster config does not include a dns service, then to</span></span><br><span class="line">          <span class="comment"># instead access an environment variable to find the master</span></span><br><span class="line">          <span class="comment"># service&#x27;s host, comment out the &#x27;value: dns&#x27; line above, and</span></span><br><span class="line">          <span class="comment"># uncomment the line below:</span></span><br><span class="line">          <span class="comment"># value: env</span></span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 6379</span><br><span class="line"></span><br><span class="line">~$ kubectl apply -f redis-slave-deployment.yaml</span><br><span class="line">~$ kubectl get pods</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">redis-slave-555b8847c4-mttt9    1/1     Running   0          17h</span><br><span class="line">redis-slave-555b8847c4-r24xx    1/1     Running   0          17h</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…Redis-Slave-Service"><a href="#å®‰è£…Redis-Slave-Service" class="headerlink" title="å®‰è£…Redis Slave Service"></a>å®‰è£…<code>Redis Slave Service</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl apply -f  redis-slave-service.yaml</span><br><span class="line"></span><br><span class="line">~$ kubectl get svc redis-slave</span><br><span class="line">NAME          TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">redis-slave   ClusterIP   10.103.39.53   &lt;none&gt;        6379/TCP   17h</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…Frontend-Pod"><a href="#å®‰è£…Frontend-Pod" class="headerlink" title="å®‰è£…Frontend Pod"></a>å®‰è£…<code>Frontend Pod</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">~$ <span class="built_in">cat</span> frontend-deployment.yaml</span><br><span class="line">apiVersion: apps/v1 <span class="comment">#  for k8s versions before 1.9.0 use apps/v1beta2  and before 1.8.0 use extensions/v1beta1</span></span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: frontend</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: guestbook</span><br><span class="line">      tier: frontend</span><br><span class="line">  replicas: 3</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: guestbook</span><br><span class="line">        tier: frontend</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: php-redis</span><br><span class="line">        <span class="comment"># image: gcr.io/google-samples/gb-frontend:v4</span></span><br><span class="line">        image: forestgun007/google-samples-gb-frontend:v4</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 100Mi</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: GET_HOSTS_FROM</span><br><span class="line">          value: dns</span><br><span class="line">          <span class="comment"># If your cluster config does not include a dns service, then to</span></span><br><span class="line">          <span class="comment"># instead access environment variables to find service host</span></span><br><span class="line">          <span class="comment"># info, comment out the &#x27;value: dns&#x27; line above, and uncomment the</span></span><br><span class="line">          <span class="comment"># line below:</span></span><br><span class="line">          <span class="comment"># value: env</span></span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line"></span><br><span class="line">~$ kubectl apply -f frontend-deployment.yaml</span><br><span class="line"></span><br><span class="line">~$ kubectl get pod</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">frontend-6f4cc58c94-2wv5l       1/1     Running   0          17h</span><br><span class="line">frontend-6f4cc58c94-s6s8l       1/1     Running   0          17h</span><br><span class="line">frontend-6f4cc58c94-z9qmk       1/1     Running   0          17h</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…Frontend-Service"><a href="#å®‰è£…Frontend-Service" class="headerlink" title="å®‰è£…Frontend Service"></a>å®‰è£…<code>Frontend Service</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl apply -f  frontend-service.yaml</span><br><span class="line">~$ kubectl get service frontend</span><br><span class="line">NAME       TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">frontend   NodePort   10.106.20.24   &lt;none&gt;        80:30577/TCP   17h</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="é”™è¯¯å¤„ç†-1"><a href="#é”™è¯¯å¤„ç†-1" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h1><h2 id="è¿æ¥è¯ä¹¦é”™è¯¯"><a href="#è¿æ¥è¯ä¹¦é”™è¯¯" class="headerlink" title="è¿æ¥è¯ä¹¦é”™è¯¯"></a>è¿æ¥è¯ä¹¦é”™è¯¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get node</span><br><span class="line">Unable to connect to the server: x509: certificate signed by unknown authority (possibly because of <span class="string">&quot;crypto/rsa: verification error&quot;</span> <span class="keyword">while</span> trying to verify candidate authority certificate <span class="string">&quot;kubernetes&quot;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸Šè¿°é”™è¯¯,ä¸€èˆ¬æ˜¯åœ¨<code>kubeadm reset</code>å,æ²¡æœ‰æ›´æ–°<code>~/.kube/config</code>çš„æ–‡ä»¶å‘ç”Ÿ.<code>cp /etc/kubernetes/admin.conf ~/.kube/conf</code>å°±å¯ä»¥è§£å†³.</li>
</ul>
<h2 id="åŠ å…¥èŠ‚ç‚¹é”™è¯¯"><a href="#åŠ å…¥èŠ‚ç‚¹é”™è¯¯" class="headerlink" title="åŠ å…¥èŠ‚ç‚¹é”™è¯¯"></a>åŠ å…¥èŠ‚ç‚¹é”™è¯¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo kubeadm <span class="built_in">join</span> 172.18.127.186:6443 --token z8r97j.3ovdfddb6df9lnq7     --discovery-token-ca-cert-hash sha256:07767a67fa6c38feda7471ee5e1a15a0a9c417cfdf6cf457ff577297f22d9415</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">	[WARNING IsDockerSystemdCheck]: detected <span class="string">&quot;cgroupfs&quot;</span> as the Docker cgroup driver. The recommended driver is <span class="string">&quot;systemd&quot;</span>. Please follow the guide at https://kubernetes.io/docs/setup/cri/</span><br><span class="line">error execution phase preflight: couldn<span class="string">&#x27;t validate the identity of the API Server: abort connecting to API servers after timeout of 5m0s</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœåŠ å…¥èŠ‚ç‚¹æ—¶é—´å¾ˆé•¿,ä¸”æœ€åè¿˜å‡ºé”™äº†,åŠ å‚æ•°<code>-v=6</code>,å°±ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo kubeadm <span class="built_in">join</span> 172.18.127.186:6443 --token z8r97j.3ovdfddb6df9lnq7     --discovery-token-ca-cert-hash sha256:07767a67fa6c38feda7471ee5e1a15a0a9c417cfdf6cf457ff577297f22d9415 -v=6</span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line">I0414 16:23:00.398178   13202 token.go:200] [discovery] Trying to connect to API Server <span class="string">&quot;172.18.127.186:6443&quot;</span></span><br><span class="line">I0414 16:23:00.398724   13202 token.go:75] [discovery] Created cluster-info discovery client, requesting info from <span class="string">&quot;https://172.18.127.186:6443&quot;</span></span><br><span class="line">I0414 16:23:00.402234   13202 round_trippers.go:438] GET https://172.18.127.186:6443/api/v1/namespaces/kube-public/configmaps/cluster-info 200 OK <span class="keyword">in</span> 3 milliseconds</span><br><span class="line">I0414 16:23:00.402426   13202 token.go:203] [discovery] Failed to connect to API Server <span class="string">&quot;172.18.127.186:6443&quot;</span>: token <span class="built_in">id</span> <span class="string">&quot;z8r97j&quot;</span> is invalid <span class="keyword">for</span> this cluster or it has expired. Use <span class="string">&quot;kubeadm token create&quot;</span> on the control-plane node to create a new valid token</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure></li>
<li>å¦‚æœå‡ºç°ä¸Šè¿°é”™è¯¯,åœ¨MasterèŠ‚ç‚¹è¾“å…¥ä¸‹é¢å‘½ä»¤,ç”¨å®ƒè¾“å‡ºçš„<code>kubeadm join</code>å‚æ•°,åœ¨éœ€è¦æ·»åŠ çš„èŠ‚ç‚¹ä¸ºä¸Šè¿è¡Œ.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ kubeadm  token create --print-join-command</span><br><span class="line"><span class="comment"># ä½¿ç”¨ä¸‹è¿°è¾“å‡º,é‡æ–°æ·»åŠ .</span></span><br><span class="line">kubeadm <span class="built_in">join</span> 172.18.127.186:6443 --token in1l6v.ue78pr5vvr55qcad     --discovery-token-ca-cert-hash sha256:a1f80db7a76e214dd529fc2aed660d71428994d9104c1b320bf5abb6cda4b165</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="å®‰è£…chartsé”™è¯¯"><a href="#å®‰è£…chartsé”™è¯¯" class="headerlink" title="å®‰è£…chartsé”™è¯¯"></a>å®‰è£…<code>charts</code>é”™è¯¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ helm install stable/minio</span><br><span class="line">Error: could not find a ready tiller pod</span><br></pre></td></tr></table></figure>
<ul>
<li>ç¬¬ä¸€æ­¥,æ›´æ–°ä¸€ä¸‹ä»“åº“<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ helm init --upgrade</span><br><span class="line"><span class="variable">$HELM_HOME</span> has been configured at /home/lcy/.helm.</span><br><span class="line"></span><br><span class="line">Tiller (the Helm server-side component) has been upgraded to the current version.</span><br><span class="line">Happy Helming!</span><br><span class="line"></span><br><span class="line">~$ helm repo list</span><br><span class="line">NAME    URL</span><br><span class="line">stable  https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="line"><span class="built_in">local</span>   http://127.0.0.1:8879/charts</span><br></pre></td></tr></table></figure></li>
<li>æŸ¥çœ‹<code>k8s</code>çš„å­ç³»ç»Ÿ<code>Pod</code>çš„çŠ¶æ€,æŸ¥çœ‹<code>tiller-deploy</code>éƒ¨åˆ†.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl  -n kube-system get po</span><br><span class="line">NAME                                       READY   STATUS         RESTARTS   AGE</span><br><span class="line">calico-kube-controllers-5cbcccc885-krbzj   1/1     Running        0          17h</span><br><span class="line">[]...]</span><br><span class="line">kube-scheduler-k8s-master                  1/1     Running        0          18h</span><br><span class="line">tiller-deploy-c48485567-m7kj2              0/1     ErrImagePull   0          2m50s</span><br></pre></td></tr></table></figure></li>
<li>æ ¹æ®ä¸Šè¿°è¾“å‡º,<code>tiller-deploy</code>æ‹‰å–é•œåƒå¤±è´¥,æ²¡æœ‰è¿è¡Œèµ·,ä¸‹é¢å†æŸ¥çœ‹è¯¦æƒ….</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl  describe pod tiller-deploy-c48485567-m7kj2   -n kube-system</span><br><span class="line">Name:               tiller-deploy-c48485567-m7kj2</span><br><span class="line">[...]</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason     Age                 From               Message</span><br><span class="line">  ----     ------     ----                ----               -------</span><br><span class="line">  Normal   Scheduled  16m                 default-scheduler  Successfully assigned kube-system/tiller-deploy-c48485567-m7kj2 to dig001</span><br><span class="line">  Normal   Pulling    14m (x4 over 16m)   kubelet, dig001    Pulling image <span class="string">&quot;gcr.io/kubernetes-helm/tiller:v2.13.1&quot;</span></span><br><span class="line">  Warning  Failed     13m (x4 over 16m)   kubelet, dig001    Failed to pull image <span class="string">&quot;gcr.io/kubernetes-helm/tiller:v2.13.1&quot;</span>: rpc error: code = Unknown desc = Error response from daemon: Get https://gcr.io/v2/: net/http: request canceled <span class="keyword">while</span> waiting <span class="keyword">for</span> connection (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">  Warning  Failed     13m (x4 over 16m)   kubelet, dig001    Error: ErrImagePull</span><br><span class="line">  Warning  Failed     13m (x7 over 16m)   kubelet, dig001    Error: ImagePullBackOff</span><br><span class="line">  Normal   BackOff    82s (x57 over 16m)  kubelet, dig001    Back-off pulling image <span class="string">&quot;gcr.io/kubernetes-helm/tiller:v2.13.1&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>å› ä¸ºä½¿ç”¨è¦<code>gcr.io</code>çš„ä»“åº“é€ æˆæ‹‰å–å¤±è´¥,ä¸‹é¢é€šè¿‡<code>docker search tiller | grep &quot;Mirror&quot;</code>é€‰å–ä¸€ä¸ª,å†é€šè¿‡ä¸‹é¢å‘½ä»¤ä¿®æ”¹å®ƒ.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl edit deploy tiller-deploy -n kube-system</span><br><span class="line">[....]</span><br></pre></td></tr></table></figure></li>
<li>å°†ä¸Šè¿°ä¸­çš„<code>image  gcr.io/kubernetes-helm/tiller:v2.13.1</code> æ›¿æ¢æˆ<code>image: sapcc/tiller:v2.13.1</code>,ä¸‹é¢å†è¿è¡Œå°±ä¼šæ˜¾ç¤º<code>tiller</code>æˆåŠŸè¿è¡Œ.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get pod -n kube-system | grep <span class="string">&quot;tiller&quot;</span></span><br><span class="line">tiller-deploy-b7bd9495c-bf777              1/1     Running   0          2m57s</span><br><span class="line">~$ helm version</span><br><span class="line">Client: &amp;version.Version&#123;SemVer:<span class="string">&quot;v2.13.1&quot;</span>, GitCommit:<span class="string">&quot;618447cbf203d147601b4b9bd7f8c37a5d39fbb4&quot;</span>, GitTreeState:<span class="string">&quot;clean&quot;</span>&#125;</span><br><span class="line">Server: &amp;version.Version&#123;SemVer:<span class="string">&quot;v2.13.1&quot;</span>, GitCommit:<span class="string">&quot;618447cbf203d147601b4b9bd7f8c37a5d39fbb4&quot;</span>, GitTreeState:<span class="string">&quot;clean&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Error-no-available-release-name-found"><a href="#Error-no-available-release-name-found" class="headerlink" title="Error: no available release name found"></a>Error: no available release name found</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl create serviceaccount --namespace kube-system tiller</span><br><span class="line">~$ kubectl create clusterrolebinding tiller-cluster-rule --clusterrole=cluster-admin --serviceaccount=kube-system:tiller</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/tiller-cluster-rule created</span><br><span class="line">~$ kubectl patch deploy --namespace kube-system tiller-deploy -p \<span class="string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;template&quot;:&#123;&quot;spec&quot;:&#123;&quot;serviceAccount&quot;:&quot;tiller&quot;&#125;&#125;&#125;&#125;\&#x27;</span></span><br><span class="line">deployment.extensions/tiller-deploy patched</span><br></pre></td></tr></table></figure>


<h2 id="kubeadmåˆå§‹åŒ–é”™è¯¯"><a href="#kubeadmåˆå§‹åŒ–é”™è¯¯" class="headerlink" title="kubeadmåˆå§‹åŒ–é”™è¯¯"></a><code>kubeadm</code>åˆå§‹åŒ–é”™è¯¯</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo kubeadm init --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers  --kubernetes-version v1.14.1 --pod-network-cidr=10.244.0.0/16</span><br><span class="line">[init] Using Kubernetes version: v1.14.1</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">[preflight] WARNING: Couldn\<span class="string">&#x27;t create the interface used for talking to the container runtime: docker is required for container runtime: exec: &quot;docker&quot;: executable file not found in $PATH</span></span><br><span class="line"><span class="string">error execution phase preflight: [preflight] Some fatal errors occurred:</span></span><br><span class="line"><span class="string">	[ERROR NumCPU]: the number of available CPUs 1 is less than the required 2</span></span><br><span class="line"><span class="string">	[ERROR FileContent--proc-sys-net-bridge-bridge-nf-call-iptables]: /proc/sys/net/bridge/bridge-nf-call-iptables does not exist</span></span><br><span class="line"><span class="string">	[ERROR FileContent--proc-sys-net-ipv4-ip_forward]: /proc/sys/net/ipv4/ip_forward contents are not set to 1</span></span><br><span class="line"><span class="string">[preflight] If you know what you are doing, you can make a check non-fatal with  `--ignore-preflight-errors=...`</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>ERROR NumCPU</code>åŠ å…¥è¿è¡Œå‚æ•°<code>--ignore-preflight-errors=NumCPU</code>å°±å˜æˆè­¦å‘Šäº†.</p>
</li>
<li><p><code>FileContent--proc-sys-net-bridge-bridge-nf-call-iptables</code>é”™è¯¯å¤„ç†å¦‚ä¸‹:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~$ apt-get install bridge-utils</span><br><span class="line"><span class="comment"># æœ‰å¯èƒ½è¦é‡å¯</span></span><br><span class="line">~$ modprobe bridge</span><br><span class="line">~$ modprobe br_netfilter</span><br><span class="line"></span><br><span class="line">~$ <span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt;  /etc/sysctl.d/k8s.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward=1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">~$ sysctl --system</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>kube-proxy</code>ä¸<code>iptables</code>çš„é—®é¢˜</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl -n kube-system logs  kube-proxy-xxx</span><br><span class="line">W0514 00:21:27.445425       1 server_others.go:267] Flag proxy-mode=<span class="string">&quot;&quot;</span> unknown, assuming iptables proxy</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> mysql-pass.yaml</span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql-pass</span><br><span class="line"><span class="built_in">type</span>: Opaque</span><br><span class="line">data:</span><br><span class="line">  username: cm9vdA==</span><br><span class="line">  password: cGFzczEyMw==</span><br></pre></td></tr></table></figure>
<h1 id="è°¢è°¢æ”¯æŒ"><a href="#è°¢è°¢æ”¯æŒ" class="headerlink" title="è°¢è°¢æ”¯æŒ"></a>è°¢è°¢æ”¯æŒ</h1><ul>
<li>å¾®ä¿¡äºŒç»´ç :</li>
</ul>
<img src=/imgs/mm_reward_qrcode_1525013906055.png width=40% height=40% align=center/>


    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Docker-Linux-Kubernetes/" rel="tag"># Docker,Linux,Kubernetes</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/02/02/%E7%8E%A9%E8%BD%ACFPGA-DE0-Nano/" rel="prev" title="ç©è½¬FPGA_DE0-Nano">
      <i class="fa fa-chevron-left"></i> ç©è½¬FPGA_DE0-Nano
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/02/19/Kubernetes%E5%9F%BA%E4%BA%8ECephFS%E7%9A%84%E5%AD%98%E5%82%A8/" rel="next" title="KubernetesåŸºäºCephFSçš„å­˜å‚¨">
      KubernetesåŸºäºCephFSçš„å­˜å‚¨ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#PaaS%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">PaaSæ¦‚è¿°</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Kubernetes%E6%A6%82%E8%BF%B0"><span class="nav-number">1.1.</span> <span class="nav-text">Kubernetesæ¦‚è¿°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Kubernetes%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-number">1.1.1.</span> <span class="nav-text">Kubernetesçš„åŸºæœ¬æ¦‚å¿µ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Pod"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">Pod</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Replication-Controller"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">Replication Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Deployment"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">Deployment</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Job"><span class="nav-number">1.1.1.4.</span> <span class="nav-text">Job</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#StatefulSet"><span class="nav-number">1.1.1.5.</span> <span class="nav-text">StatefulSet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Service"><span class="nav-number">1.1.1.6.</span> <span class="nav-text">Service</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Ingress"><span class="nav-number">1.1.1.7.</span> <span class="nav-text">Ingress</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Label"><span class="nav-number">1.1.1.8.</span> <span class="nav-text">Label</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Node"><span class="nav-number">1.1.1.9.</span> <span class="nav-text">Node</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kubernetes%E6%9E%B6%E6%9E%84"><span class="nav-number">1.1.2.</span> <span class="nav-text">Kubernetesæ¶æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Master%E8%8A%82%E7%82%B9"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">MasterèŠ‚ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#API-Server-kube-apiserver"><span class="nav-number">1.1.2.1.1.</span> <span class="nav-text">API Server(kube-apiserver)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Scheduler-kube-scheduler"><span class="nav-number">1.1.2.1.2.</span> <span class="nav-text">Scheduler(kube-scheduler)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Controller-Manager-kube-controller-manager"><span class="nav-number">1.1.2.1.3.</span> <span class="nav-text">Controller Manager(kube-controller-manager)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#etcd"><span class="nav-number">1.1.2.1.4.</span> <span class="nav-text">etcd</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Pod%E7%BD%91%E7%BB%9C"><span class="nav-number">1.1.2.1.5.</span> <span class="nav-text">Podç½‘ç»œ</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Node%E8%8A%82%E7%82%B9"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">NodeèŠ‚ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#kubelet"><span class="nav-number">1.1.2.2.1.</span> <span class="nav-text">kubelet</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#kube-proxy"><span class="nav-number">1.1.2.2.2.</span> <span class="nav-text">kube-proxy</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Secret-ConfigMap"><span class="nav-number">1.1.2.2.3.</span> <span class="nav-text">Secret &amp; ConfigMap</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">æ’ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3"><span class="nav-number">1.1.2.3.1.</span> <span class="nav-text">ç½‘ç»œç›¸å…³</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0"><span class="nav-number">1.1.2.3.2.</span> <span class="nav-text">æœåŠ¡å‘ç°</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96%E9%9D%A2%E6%9D%BF"><span class="nav-number">1.1.2.3.3.</span> <span class="nav-text">å¯è§†åŒ–é¢æ¿</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Minikube"><span class="nav-number">1.2.</span> <span class="nav-text">å®‰è£…Minikube</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91Minikube"><span class="nav-number">2.</span> <span class="nav-text">æºç ç¼–è¯‘Minikube</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">2.1.</span> <span class="nav-text">é”™è¯¯å¤„ç†</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E5%B8%83%E7%BD%B2%E5%AE%89%E8%A3%85Kubernetes%E7%BB%84%E4%BB%B6"><span class="nav-number">3.</span> <span class="nav-text">æ‰‹åŠ¨å¸ƒç½²å®‰è£…Kubernetesç»„ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Debian-Ubuntu%E5%8F%91%E8%A1%8C%E7%89%88%E5%AE%89%E8%A3%85kubeadm"><span class="nav-number">3.1.</span> <span class="nav-text">Debian,Ubuntuå‘è¡Œç‰ˆå®‰è£…kubeadm</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%98%E6%96%B9%E8%BD%AF%E4%BB%B6%E4%BB%93%E5%BA%93-%E5%9C%A8%E5%9B%BD%E5%86%85%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8"><span class="nav-number">3.1.1.</span> <span class="nav-text">å®˜æ–¹è½¯ä»¶ä»“åº“,åœ¨å›½å†…ä¸èƒ½ä½¿ç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93"><span class="nav-number">3.1.2.</span> <span class="nav-text">é˜¿é‡Œäº‘é•œåƒä»“åº“</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Master%E8%8A%82%E7%82%B9"><span class="nav-number">3.1.3.</span> <span class="nav-text">å®‰è£…MasterèŠ‚ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="nav-number">3.1.3.1.</span> <span class="nav-text">ç½‘ç»œæ¨¡å‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9Kubelet%E7%9A%84%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0"><span class="nav-number">3.1.3.2.</span> <span class="nav-text">ä¿®æ”¹Kubeletçš„å¯åŠ¨å‚æ•°</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9"><span class="nav-number">3.1.4.</span> <span class="nav-text">å®‰è£…é›†ç¾¤èŠ‚ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%86%E9%99%A4k8s%E9%9B%86%E7%BE%A4"><span class="nav-number">3.1.5.</span> <span class="nav-text">æ‹†é™¤k8sé›†ç¾¤</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85HelloWorld%E5%85%B1%E4%BA%ABPod%E6%95%B0%E6%8D%AE"><span class="nav-number">4.</span> <span class="nav-text">å®‰è£…HelloWorldå…±äº«Podæ•°æ®</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E8%BF%87Github%E5%AE%89%E8%A3%85Kubernetes"><span class="nav-number">4.1.</span> <span class="nav-text">é€šè¿‡Githubå®‰è£…Kubernetes</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Etcd"><span class="nav-number">4.1.1.</span> <span class="nav-text">Etcd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kubernetes%E5%8F%91%E5%B8%83%E5%8C%85%E5%AE%89%E8%A3%85"><span class="nav-number">4.1.2.</span> <span class="nav-text">Kuberneteså‘å¸ƒåŒ…å®‰è£…</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Minio%E6%9C%8D%E5%8A%A1-%E5%8D%95%E8%8A%82%E7%82%B9%E6%9C%8D%E5%8A%A1"><span class="nav-number">5.</span> <span class="nav-text">å®‰è£…MinioæœåŠ¡(å•èŠ‚ç‚¹æœåŠ¡)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MinIO%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="nav-number">5.1.</span> <span class="nav-text">MinIOæœåŠ¡ç«¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAPV-Persistent-Volume"><span class="nav-number">5.1.1.</span> <span class="nav-text">åˆ›å»ºPV (Persistent Volume)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Minio-PVC-Persistent-Volume-Claim"><span class="nav-number">5.1.2.</span> <span class="nav-text">å®‰è£…Minio PVC (Persistent Volume Claim)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Minio-Deployment"><span class="nav-number">5.1.3.</span> <span class="nav-text">å®‰è£…Minio Deployment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Minio-Service"><span class="nav-number">5.1.4.</span> <span class="nav-text">å®‰è£…Minio Service</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E8%BF%87Ingress%E6%9A%B4%E9%9C%B2%E6%9C%8D%E5%8A%A1"><span class="nav-number">5.2.</span> <span class="nav-text">é€šè¿‡Ingressæš´éœ²æœåŠ¡</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Traefik%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="nav-number">6.</span> <span class="nav-text">Traefikåå‘ä»£ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85%E6%B5%8B%E8%AF%95"><span class="nav-number">6.1.</span> <span class="nav-text">å¿«é€Ÿå®‰è£…æµ‹è¯•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#docker-compose%E6%B5%8B%E8%AF%95%E8%AF%B4%E6%98%8E"><span class="nav-number">6.2.</span> <span class="nav-text">docker-composeæµ‹è¯•è¯´æ˜</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E8%AF%81%E4%B9%A6%E4%B8%8EBasic-Auth"><span class="nav-number">6.3.</span> <span class="nav-text">å¼€å¯è¯ä¹¦ä¸Basic Auth</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-compose%E5%AE%89%E8%A3%85MinIO"><span class="nav-number">6.3.1.</span> <span class="nav-text">docker-composeå®‰è£…MinIO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MC%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">6.3.2.</span> <span class="nav-text">MCå®¢æˆ·ç«¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#S3%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5%E6%B5%8B%E8%AF%95MinIO"><span class="nav-number">6.3.3.</span> <span class="nav-text">S3å®¢æˆ·ç«¯è¿æ¥æµ‹è¯•MinIO</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Helm%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8"><span class="nav-number">7.</span> <span class="nav-text">HelmåŒ…ç®¡ç†å™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Tiller%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">7.1.</span> <span class="nav-text">å®‰è£…TilleræœåŠ¡å™¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Helm-Chart%E9%83%A8%E7%BD%B2MinIO"><span class="nav-number">7.2.</span> <span class="nav-text">ä½¿ç”¨Helm Chartéƒ¨ç½²MinIO</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85MinIO%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">7.2.1.</span> <span class="nav-text">å®‰è£…MinIOå®¢æˆ·ç«¯</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4%E7%9B%91%E6%8E%A7DashBoard"><span class="nav-number">7.3.</span> <span class="nav-text">å®‰è£…é›†ç¾¤ç›‘æ§DashBoard</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Proxy%E5%8A%A0SSH%E8%BD%AC%E5%8F%91%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F"><span class="nav-number">7.3.1.</span> <span class="nav-text">ProxyåŠ SSHè½¬å‘è®¿é—®æ–¹å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9Service%E7%AB%AF%E5%8F%A3%E7%B1%BB%E5%9E%8B"><span class="nav-number">7.3.2.</span> <span class="nav-text">ä¿®æ”¹Serviceç«¯å£ç±»å‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E8%AE%A4%E8%AF%81"><span class="nav-number">7.3.3.</span> <span class="nav-text">è®¿é—®è®¤è¯</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%B8%90%E5%8F%B7"><span class="nav-number">7.3.3.1.</span> <span class="nav-text">åˆ›å»ºæœåŠ¡å¸å·</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4%E8%A7%92%E8%89%B2%E7%BB%91%E5%AE%9A"><span class="nav-number">7.3.3.2.</span> <span class="nav-text">åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0Dashboard"><span class="nav-number">7.3.4.</span> <span class="nav-text">æ›´æ–°Dashboard</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%98%E6%96%B9%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%AE%9E%E4%BE%8B%E6%95%99%E7%A8%8B"><span class="nav-number">8.</span> <span class="nav-text">å®˜æ–¹å¿«é€Ÿå…¥é—¨å®ä¾‹æ•™ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Guestbook%E5%AE%9E%E4%BE%8B"><span class="nav-number">8.1.</span> <span class="nav-text">Guestbookå®ä¾‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Redis-Master-Pod"><span class="nav-number">8.1.1.</span> <span class="nav-text">å®‰è£…Redis Master Pod</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Redis-Master-Service"><span class="nav-number">8.1.2.</span> <span class="nav-text">å®‰è£…Redis Master Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Redis-Slave-Pod"><span class="nav-number">8.1.3.</span> <span class="nav-text">å®‰è£…Redis Slave Pod</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Redis-Slave-Service"><span class="nav-number">8.1.4.</span> <span class="nav-text">å®‰è£…Redis Slave Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Frontend-Pod"><span class="nav-number">8.1.5.</span> <span class="nav-text">å®‰è£…Frontend Pod</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Frontend-Service"><span class="nav-number">8.1.6.</span> <span class="nav-text">å®‰è£…Frontend Service</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86-1"><span class="nav-number">9.</span> <span class="nav-text">é”™è¯¯å¤„ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E8%AF%81%E4%B9%A6%E9%94%99%E8%AF%AF"><span class="nav-number">9.1.</span> <span class="nav-text">è¿æ¥è¯ä¹¦é”™è¯¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E5%85%A5%E8%8A%82%E7%82%B9%E9%94%99%E8%AF%AF"><span class="nav-number">9.2.</span> <span class="nav-text">åŠ å…¥èŠ‚ç‚¹é”™è¯¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85charts%E9%94%99%E8%AF%AF"><span class="nav-number">9.3.</span> <span class="nav-text">å®‰è£…chartsé”™è¯¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Error-no-available-release-name-found"><span class="nav-number">9.4.</span> <span class="nav-text">Error: no available release name found</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#kubeadm%E5%88%9D%E5%A7%8B%E5%8C%96%E9%94%99%E8%AF%AF"><span class="nav-number">9.5.</span> <span class="nav-text">kubeadmåˆå§‹åŒ–é”™è¯¯</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B0%A2%E8%B0%A2%E6%94%AF%E6%8C%81"><span class="nav-number">10.</span> <span class="nav-text">è°¢è°¢æ”¯æŒ</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yjdwbj"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">yjdwbj</p>
  <div class="site-description" itemprop="description">æœ€æ˜¯äººé—´ç•™ä¸ä½,æœ±é¢œè¾é•œèŠ±è¾æ ‘</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">54</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">åˆ†ç±»</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yjdwbj</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>

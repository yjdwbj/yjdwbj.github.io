<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0-rc2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="一直以来的服务器开发都会使用PostgreSQL做为数据库.有人会问为什么不用 MySQL?这个是个人喜好.Postgresql 与 MySQL 也是一些区别的.Postgresql 有一些特性是 MySQL 没有具备的.有人会说:在中国为什么 MySQL 的使用会比 PostgreSQL 流行.可能其中一个原因是 PostgreSQL 没有服务好 PHP.PostgreSQL 与 MySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="安装Postgresql-XL">
<meta property="og:url" content="http://example.com/2016/12/22/%E5%AE%89%E8%A3%85Postgresql-XL/index.html">
<meta property="og:site_name" content="Sunrise 博客">
<meta property="og:description" content="一直以来的服务器开发都会使用PostgreSQL做为数据库.有人会问为什么不用 MySQL?这个是个人喜好.Postgresql 与 MySQL 也是一些区别的.Postgresql 有一些特性是 MySQL 没有具备的.有人会说:在中国为什么 MySQL 的使用会比 PostgreSQL 流行.可能其中一个原因是 PostgreSQL 没有服务好 PHP.PostgreSQL 与 MySQL">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2016-12-22T14:17:16.000Z">
<meta property="article:modified_time" content="2022-02-26T15:52:54.704Z">
<meta property="article:author" content="yjdwbj">
<meta property="article:tag" content="Postgresql">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2016/12/22/%E5%AE%89%E8%A3%85Postgresql-XL/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>安装Postgresql-XL | Sunrise 博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sunrise 博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2016/12/22/%E5%AE%89%E8%A3%85Postgresql-XL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yjdwbj">
      <meta itemprop="description" content="最是人间留不住,朱颜辞镜花辞树">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise 博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          安装Postgresql-XL
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-12-22 22:17:16" itemprop="dateCreated datePublished" datetime="2016-12-22T22:17:16+08:00">2016-12-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-26 23:52:54" itemprop="dateModified" datetime="2022-02-26T23:52:54+08:00">2022-02-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <ul>
<li>一直以来的服务器开发都会使用<code>PostgreSQL</code>做为数据库.有人会问为什么不用 MySQL?这个是个人喜好.Postgresql 与 MySQL 也是一些区别的.Postgresql 有一些特性是 MySQL 没有具备的.有人会说:在中国为什么 MySQL 的使用会比 PostgreSQL 流行.可能其中一个原因是 PostgreSQL 没有服务好 PHP.PostgreSQL 与 MySQL 的连接方式有很大不同,PostgreSQL 是 fork 进程,MySQL 是线程连接.所以在高并发下 PostgreSQL 的连接数会很快被用完.这时就需要一个连接池处理客户端的连接.</li>
<li>Pgbouncer,pgpool,<a target="_blank" rel="noopener" href="http://www.postgres-xl.org/">PostgreSQL-XL</a></li>
</ul>
<h1 id="安装主机系统"><a href="#安装主机系统" class="headerlink" title="安装主机系统"></a>安装主机系统</h1><ul>
<li>本文的系统是基于<code>Debian 8</code>,安装 qemu-kvm 虚拟机.并于一些相关的软件.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt-get install qemu-kvm openvswitch-&#123;switch,common&#125; libvirt-bin virtinst virt-manager</span></span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line"><span class="comment"># /etc/init.d/openvswitch-switch start</span></span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ovs-vsctl show</span></span><br><span class="line">504bd042-d300-4fc3-be49-5609ea5df49f</span><br><span class="line">    Bridge <span class="string">&quot;ovs-br0&quot;</span></span><br><span class="line">        Port <span class="string">&quot;ovs-br0&quot;</span></span><br><span class="line">            Interface <span class="string">&quot;ovs-br0&quot;</span></span><br><span class="line">                <span class="built_in">type</span>: internal</span><br><span class="line">    ovs_version: <span class="string">&quot;2.5.0&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="安装基础系统"><a href="#安装基础系统" class="headerlink" title="安装基础系统"></a>安装基础系统</h1><ul>
<li>本文的做实验的虚拟机系统是基于<code>Centos 7</code>的环境. 通过<code>virsh dumpxml vhost0</code>,配置如下:</li>
</ul>
<ul>
<li>两个 CPU,8G 内存,eth0 192.168.120&#x2F;24, eth1 192.168.25.0&#x2F;24,　 eth0 是桥接主机的 openvswitch 的虚拟网卡用作于 HostOnly 内部网络.eth1 是桥主机的物理网卡,可以连接到互联安装软件</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># virsh dumpxml vhost0</span></span><br><span class="line">&lt;domain <span class="built_in">type</span>=<span class="string">&#x27;kvm&#x27;</span> <span class="built_in">id</span>=<span class="string">&#x27;53&#x27;</span>&gt;</span><br><span class="line">  &lt;name&gt;vhost0&lt;/name&gt;</span><br><span class="line">  &lt;uuid&gt;0fdbcbe7-f7e9-443e-bf9b-7ac4a6d27612&lt;/uuid&gt;</span><br><span class="line">  &lt;memory unit=<span class="string">&#x27;KiB&#x27;</span>&gt;8388608&lt;/memory&gt;</span><br><span class="line">  &lt;currentMemory unit=<span class="string">&#x27;KiB&#x27;</span>&gt;8388608&lt;/currentMemory&gt;</span><br><span class="line">  &lt;vcpu placement=<span class="string">&#x27;static&#x27;</span>&gt;2&lt;/vcpu&gt;</span><br><span class="line">  &lt;resource&gt;</span><br><span class="line">    &lt;partition&gt;/machine&lt;/partition&gt;</span><br><span class="line">  &lt;/resource&gt;</span><br><span class="line">  &lt;os&gt;</span><br><span class="line">    &lt;<span class="built_in">type</span> <span class="built_in">arch</span>=<span class="string">&#x27;x86_64&#x27;</span> machine=<span class="string">&#x27;pc-i440fx-xenial&#x27;</span>&gt;hvm&lt;/type&gt;</span><br><span class="line">    &lt;boot dev=<span class="string">&#x27;hd&#x27;</span>/&gt;</span><br><span class="line">  &lt;/os&gt;</span><br><span class="line">  &lt;features&gt;</span><br><span class="line">    &lt;acpi/&gt;</span><br><span class="line">    &lt;apic/&gt;</span><br><span class="line">    &lt;pae/&gt;</span><br><span class="line">  &lt;/features&gt;</span><br><span class="line">  &lt;cpu mode=<span class="string">&#x27;custom&#x27;</span> match=<span class="string">&#x27;exact&#x27;</span>&gt;</span><br><span class="line">    &lt;model fallback=<span class="string">&#x27;allow&#x27;</span>&gt;Broadwell-noTSX&lt;/model&gt;</span><br><span class="line">  &lt;/cpu&gt;</span><br><span class="line">  &lt;clock offset=<span class="string">&#x27;utc&#x27;</span>&gt;</span><br><span class="line">    &lt;timer name=<span class="string">&#x27;rtc&#x27;</span> tickpolicy=<span class="string">&#x27;catchup&#x27;</span>/&gt;</span><br><span class="line">    &lt;timer name=<span class="string">&#x27;pit&#x27;</span> tickpolicy=<span class="string">&#x27;delay&#x27;</span>/&gt;</span><br><span class="line">    &lt;timer name=<span class="string">&#x27;hpet&#x27;</span> present=<span class="string">&#x27;no&#x27;</span>/&gt;</span><br><span class="line">  &lt;/clock&gt;</span><br><span class="line">  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;</span><br><span class="line">  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;</span><br><span class="line">  &lt;on_crash&gt;restart&lt;/on_crash&gt;</span><br><span class="line">  &lt;pm&gt;</span><br><span class="line">    &lt;suspend-to-mem enabled=<span class="string">&#x27;no&#x27;</span>/&gt;</span><br><span class="line">    &lt;suspend-to-disk enabled=<span class="string">&#x27;no&#x27;</span>/&gt;</span><br><span class="line">  &lt;/pm&gt;</span><br><span class="line">  &lt;devices&gt;</span><br><span class="line">    &lt;emulator&gt;/usr/bin/kvm-spice&lt;/emulator&gt;</span><br><span class="line">    &lt;disk <span class="built_in">type</span>=<span class="string">&#x27;file&#x27;</span> device=<span class="string">&#x27;disk&#x27;</span>&gt;</span><br><span class="line">      &lt;driver name=<span class="string">&#x27;qemu&#x27;</span> <span class="built_in">type</span>=<span class="string">&#x27;qcow2&#x27;</span>/&gt;</span><br><span class="line">      &lt;<span class="built_in">source</span> file=<span class="string">&#x27;/data/centos7.qcow2&#x27;</span>/&gt;</span><br><span class="line">      &lt;backingStore/&gt;</span><br><span class="line">      &lt;target dev=<span class="string">&#x27;vda&#x27;</span> bus=<span class="string">&#x27;virtio&#x27;</span>/&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;virtio-disk0&#x27;</span>/&gt;</span><br><span class="line">  &lt;address <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x00&#x27;</span> slot=<span class="string">&#x27;0x07&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x0&#x27;</span>/&gt;</span><br><span class="line">    &lt;/disk&gt;</span><br><span class="line">    &lt;controller <span class="built_in">type</span>=<span class="string">&#x27;usb&#x27;</span> index=<span class="string">&#x27;0&#x27;</span> model=<span class="string">&#x27;ich9-ehci1&#x27;</span>&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;usb&#x27;</span>/&gt;</span><br><span class="line">      &lt;address <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x00&#x27;</span> slot=<span class="string">&#x27;0x06&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x7&#x27;</span>/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller <span class="built_in">type</span>=<span class="string">&#x27;usb&#x27;</span> index=<span class="string">&#x27;0&#x27;</span> model=<span class="string">&#x27;ich9-uhci1&#x27;</span>&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;usb&#x27;</span>/&gt;</span><br><span class="line">      &lt;master startport=<span class="string">&#x27;0&#x27;</span>/&gt;</span><br><span class="line">      &lt;address <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x00&#x27;</span> slot=<span class="string">&#x27;0x06&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x0&#x27;</span> multifunction=<span class="string">&#x27;on&#x27;</span>/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller <span class="built_in">type</span>=<span class="string">&#x27;usb&#x27;</span> index=<span class="string">&#x27;0&#x27;</span> model=<span class="string">&#x27;ich9-uhci2&#x27;</span>&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;usb&#x27;</span>/&gt;</span><br><span class="line">      &lt;master startport=<span class="string">&#x27;2&#x27;</span>/&gt;</span><br><span class="line">      &lt;address <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x00&#x27;</span> slot=<span class="string">&#x27;0x06&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x1&#x27;</span>/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller <span class="built_in">type</span>=<span class="string">&#x27;usb&#x27;</span> index=<span class="string">&#x27;0&#x27;</span> model=<span class="string">&#x27;ich9-uhci3&#x27;</span>&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;usb&#x27;</span>/&gt;</span><br><span class="line">      &lt;master startport=<span class="string">&#x27;4&#x27;</span>/&gt;</span><br><span class="line">      &lt;address <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x00&#x27;</span> slot=<span class="string">&#x27;0x06&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x2&#x27;</span>/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> index=<span class="string">&#x27;0&#x27;</span> model=<span class="string">&#x27;pci-root&#x27;</span>&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;pci.0&#x27;</span>/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller <span class="built_in">type</span>=<span class="string">&#x27;ide&#x27;</span> index=<span class="string">&#x27;0&#x27;</span>&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;ide&#x27;</span>/&gt;</span><br><span class="line">      &lt;address <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x00&#x27;</span> slot=<span class="string">&#x27;0x01&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x1&#x27;</span>/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller <span class="built_in">type</span>=<span class="string">&#x27;virtio-serial&#x27;</span> index=<span class="string">&#x27;0&#x27;</span>&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;virtio-serial0&#x27;</span>/&gt;</span><br><span class="line">      &lt;address <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x00&#x27;</span> slot=<span class="string">&#x27;0x05&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x0&#x27;</span>/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;interface <span class="built_in">type</span>=<span class="string">&#x27;direct&#x27;</span>&gt;</span><br><span class="line">      &lt;mac address=<span class="string">&#x27;52:54:00:a5:93:d5&#x27;</span>/&gt;</span><br><span class="line">      &lt;<span class="built_in">source</span> dev=<span class="string">&#x27;ovs-system&#x27;</span> mode=<span class="string">&#x27;bridge&#x27;</span>/&gt;</span><br><span class="line">      &lt;target dev=<span class="string">&#x27;macvtap10&#x27;</span>/&gt;</span><br><span class="line">      &lt;model <span class="built_in">type</span>=<span class="string">&#x27;virtio&#x27;</span>/&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;net0&#x27;</span>/&gt;</span><br><span class="line">      &lt;address <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x00&#x27;</span> slot=<span class="string">&#x27;0x03&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x0&#x27;</span>/&gt;</span><br><span class="line">    &lt;/interface&gt;</span><br><span class="line">    &lt;interface <span class="built_in">type</span>=<span class="string">&#x27;direct&#x27;</span>&gt;</span><br><span class="line">      &lt;mac address=<span class="string">&#x27;52:54:00:14:02:69&#x27;</span>/&gt;</span><br><span class="line">      &lt;<span class="built_in">source</span> dev=<span class="string">&#x27;enp5s0&#x27;</span> mode=<span class="string">&#x27;bridge&#x27;</span>/&gt;</span><br><span class="line">      &lt;target dev=<span class="string">&#x27;macvtap11&#x27;</span>/&gt;</span><br><span class="line">      &lt;model <span class="built_in">type</span>=<span class="string">&#x27;virtio&#x27;</span>/&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;net1&#x27;</span>/&gt;</span><br><span class="line">      &lt;address <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x00&#x27;</span> slot=<span class="string">&#x27;0x09&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x0&#x27;</span>/&gt;</span><br><span class="line">    &lt;/interface&gt;</span><br><span class="line">    &lt;console <span class="built_in">type</span>=<span class="string">&#x27;pty&#x27;</span> <span class="built_in">tty</span>=<span class="string">&#x27;/dev/pts/18&#x27;</span>&gt;</span><br><span class="line">      &lt;<span class="built_in">source</span> path=<span class="string">&#x27;/dev/pts/18&#x27;</span>/&gt;</span><br><span class="line">      &lt;target <span class="built_in">type</span>=<span class="string">&#x27;virtio&#x27;</span> port=<span class="string">&#x27;0&#x27;</span>/&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;console0&#x27;</span>/&gt;</span><br><span class="line">    &lt;/console&gt;</span><br><span class="line">    &lt;channel <span class="built_in">type</span>=<span class="string">&#x27;unix&#x27;</span>&gt;</span><br><span class="line">      &lt;<span class="built_in">source</span> mode=<span class="string">&#x27;bind&#x27;</span> path=<span class="string">&#x27;/var/lib/libvirt/qemu/channel/target/domain-pgsql-xl-gmt/org.qemu.guest_agent.0&#x27;</span>/&gt;</span><br><span class="line">      &lt;target <span class="built_in">type</span>=<span class="string">&#x27;virtio&#x27;</span> name=<span class="string">&#x27;org.qemu.guest_agent.0&#x27;</span> state=<span class="string">&#x27;disconnected&#x27;</span>/&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;channel0&#x27;</span>/&gt;</span><br><span class="line">      &lt;address <span class="built_in">type</span>=<span class="string">&#x27;virtio-serial&#x27;</span> controller=<span class="string">&#x27;0&#x27;</span> bus=<span class="string">&#x27;0&#x27;</span> port=<span class="string">&#x27;1&#x27;</span>/&gt;</span><br><span class="line">    &lt;/channel&gt;</span><br><span class="line">    &lt;channel <span class="built_in">type</span>=<span class="string">&#x27;spicevmc&#x27;</span>&gt;</span><br><span class="line">      &lt;target <span class="built_in">type</span>=<span class="string">&#x27;virtio&#x27;</span> name=<span class="string">&#x27;com.redhat.spice.0&#x27;</span> state=<span class="string">&#x27;disconnected&#x27;</span>/&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;channel1&#x27;</span>/&gt;</span><br><span class="line">      &lt;address <span class="built_in">type</span>=<span class="string">&#x27;virtio-serial&#x27;</span> controller=<span class="string">&#x27;0&#x27;</span> bus=<span class="string">&#x27;0&#x27;</span> port=<span class="string">&#x27;2&#x27;</span>/&gt;</span><br><span class="line">    &lt;/channel&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">&#x27;tablet&#x27;</span> bus=<span class="string">&#x27;usb&#x27;</span>&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;input0&#x27;</span>/&gt;</span><br><span class="line">    &lt;/input&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">&#x27;mouse&#x27;</span> bus=<span class="string">&#x27;ps2&#x27;</span>/&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">&#x27;keyboard&#x27;</span> bus=<span class="string">&#x27;ps2&#x27;</span>/&gt;</span><br><span class="line">    &lt;graphics <span class="built_in">type</span>=<span class="string">&#x27;spice&#x27;</span> port=<span class="string">&#x27;5905&#x27;</span> autoport=<span class="string">&#x27;yes&#x27;</span> listen=<span class="string">&#x27;127.0.0.1&#x27;</span>&gt;</span><br><span class="line">      &lt;listen <span class="built_in">type</span>=<span class="string">&#x27;address&#x27;</span> address=<span class="string">&#x27;127.0.0.1&#x27;</span>/&gt;</span><br><span class="line">    &lt;/graphics&gt;</span><br><span class="line">    &lt;video&gt;</span><br><span class="line">      &lt;model <span class="built_in">type</span>=<span class="string">&#x27;qxl&#x27;</span> ram=<span class="string">&#x27;65536&#x27;</span> vram=<span class="string">&#x27;65536&#x27;</span> vgamem=<span class="string">&#x27;16384&#x27;</span> heads=<span class="string">&#x27;1&#x27;</span>/&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;video0&#x27;</span>/&gt;</span><br><span class="line">      &lt;address <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x00&#x27;</span> slot=<span class="string">&#x27;0x02&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x0&#x27;</span>/&gt;</span><br><span class="line">    &lt;/video&gt;</span><br><span class="line">    &lt;redirdev bus=<span class="string">&#x27;usb&#x27;</span> <span class="built_in">type</span>=<span class="string">&#x27;spicevmc&#x27;</span>&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;redir0&#x27;</span>/&gt;</span><br><span class="line">    &lt;/redirdev&gt;</span><br><span class="line">    &lt;redirdev bus=<span class="string">&#x27;usb&#x27;</span> <span class="built_in">type</span>=<span class="string">&#x27;spicevmc&#x27;</span>&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;redir1&#x27;</span>/&gt;</span><br><span class="line">    &lt;/redirdev&gt;</span><br><span class="line">    &lt;redirdev bus=<span class="string">&#x27;usb&#x27;</span> <span class="built_in">type</span>=<span class="string">&#x27;spicevmc&#x27;</span>&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;redir2&#x27;</span>/&gt;</span><br><span class="line">    &lt;/redirdev&gt;</span><br><span class="line">    &lt;redirdev bus=<span class="string">&#x27;usb&#x27;</span> <span class="built_in">type</span>=<span class="string">&#x27;spicevmc&#x27;</span>&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;redir3&#x27;</span>/&gt;</span><br><span class="line">    &lt;/redirdev&gt;</span><br><span class="line">    &lt;memballoon model=<span class="string">&#x27;virtio&#x27;</span>&gt;</span><br><span class="line">      &lt;<span class="built_in">alias</span> name=<span class="string">&#x27;balloon0&#x27;</span>/&gt;</span><br><span class="line">      &lt;address <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x00&#x27;</span> slot=<span class="string">&#x27;0x08&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x0&#x27;</span>/&gt;</span><br><span class="line">    &lt;/memballoon&gt;</span><br><span class="line">  &lt;/devices&gt;</span><br><span class="line">  &lt;seclabel <span class="built_in">type</span>=<span class="string">&#x27;dynamic&#x27;</span> model=<span class="string">&#x27;apparmor&#x27;</span> relabel=<span class="string">&#x27;yes&#x27;</span>&gt;</span><br><span class="line">    &lt;label&gt;libvirt-0fdbcbe7-f7e9-443e-bf9b-7ac4a6d27612&lt;/label&gt;</span><br><span class="line">    &lt;imagelabel&gt;libvirt-0fdbcbe7-f7e9-443e-bf9b-7ac4a6d27612&lt;/imagelabel&gt;</span><br><span class="line">  &lt;/seclabel&gt;</span><br><span class="line">&lt;/domain&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="配置基础系统"><a href="#配置基础系统" class="headerlink" title="配置基础系统"></a>配置基础系统</h1><ul>
<li>在虚拟机里安装相关的软件并配置好环境,配置好各虚拟机之间自动使用证书登录 SSH 的功能.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip addr</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 52:54:00:a5:93:d5 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.120.20/24 brd 192.168.120.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 52:54:00:14:02:69 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.25.20/24 brd 192.168.25.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<ul>
<li>安装如下的软件包:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// 安装编译环境</span><br><span class="line"><span class="comment"># yum install -y flex bison readline-devel zlib-devel openjade docbook-style-dsssl gcc git tmux libuuid libuuid-devel pcre pcre-devel openssl-devel perl curl</span></span><br><span class="line"></span><br><span class="line">// 添加用户</span><br><span class="line"></span><br><span class="line"><span class="comment"># groupadd postgres</span></span><br><span class="line"><span class="comment"># useradd -g postgres postgres</span></span><br><span class="line"><span class="comment"># mkdir /home/postgres &amp;&amp; chown postgres.postgres -R /home/postgres</span></span><br><span class="line"></span><br><span class="line">// 关闭防火墙,不然会有多问题.</span><br><span class="line"><span class="comment"># systemctl disable iptables.service</span></span><br><span class="line"><span class="comment"># iptables -F ; iptables -X</span></span><br><span class="line"></span><br><span class="line">// 关闭SELINUX,修改配置文件/etc/selinux/config，将SELINU置为disabled</span><br><span class="line"><span class="comment"># setenforce 0</span></span><br><span class="line">// OR</span><br><span class="line"><span class="comment"># sed -i &#x27;/SELINUX/s/enforcing/disabled/&#x27; /etc/selinux/config</span></span><br><span class="line"></span><br><span class="line">//预先配置好主机名与IP对应如下</span><br><span class="line"></span><br><span class="line"><span class="comment"># cat /etc/hosts</span></span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">192.168.120.19 coord1</span><br><span class="line">192.168.120.18 gtmproxy</span><br><span class="line">192.168.120.20 gtmnode</span><br><span class="line">192.168.120.21 node01</span><br><span class="line">192.168.120.22 node02</span><br><span class="line">192.168.120.23 node03</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>修改内核参数,系统限制,有些参数要根据需求修改</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">vm.swappiness = 0</span><br><span class="line">net.ipv4.neigh.default.gc_stale_time = 120</span><br><span class="line">net.ipv4.conf.all.rp_filter = 0</span><br><span class="line">net.ipv4.conf.default.rp_filter = 0</span><br><span class="line">net.ipv4.conf.default.arp_announce = 2</span><br><span class="line">net.ipv4.conf.all.arp_announce = 2</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 10000</span><br><span class="line">net.ipv4.tcp_syncookies = 0</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 3240000</span><br><span class="line">net.ipv4.tcp_synack_retries = 2</span><br><span class="line">net.ipv6.conf.all.disable_ipv6 = 1</span><br><span class="line">net.ipv6.conf.default.disable_ipv6 = 1</span><br><span class="line">net.ipv6.conf.lo.disable_ipv6 = 1</span><br><span class="line">net.ipv4.conf.lo.arp_announce = 2</span><br><span class="line">fs.file-max = 40000500</span><br><span class="line">fs.nr_open = 40000500</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.tcp_keepalive_time = 1</span><br><span class="line">net.ipv4.tcp_keepalive_intvl = 4</span><br><span class="line">net.ipv4.tcp_keepalive_probes = 3</span><br><span class="line">net.ipv4.tcp_fin_timeout = 5</span><br><span class="line">net.ipv4.tcp_mem = 768432 2097152 15242880</span><br><span class="line">net.ipv4.tcp_rmem = 4096 4096 33554432</span><br><span class="line">net.ipv4.tcp_wmem = 4096 4096 33554432</span><br><span class="line">net.core.somaxconn = 32768</span><br><span class="line">net.ipv4.ip_local_port_range = 1025 65000</span><br><span class="line">net.core.wmem_default = 183888608</span><br><span class="line">net.core.rmem_default = 183888608</span><br><span class="line">net.core.rmem_max = 33554432</span><br><span class="line">net.core.wmem_max = 33554432</span><br><span class="line">net.core.netdev_max_backlog = 2621244</span><br><span class="line">kernel.sem = 250 65536 100 2048</span><br><span class="line">kernel.shmmni = 655360</span><br><span class="line">kernel.shmmax = 34359738368</span><br><span class="line">kernel.msgmni = 65535</span><br><span class="line">kernel.msgmax = 65536</span><br><span class="line">kernel.msgmnb = 65536</span><br><span class="line">net.netfilter.nf_conntrack_max = 1000000</span><br><span class="line">net.nf_conntrack_max = 1000000</span><br><span class="line">kernel.perf_event_max_sample_rate = 6250</span><br><span class="line">net.ipv4.tcp_max_orphans = 1048576</span><br><span class="line">kernel.sched_migration_cost_ns = 5000000</span><br><span class="line">net.core.optmem_max = 25165824</span><br><span class="line">kernel.sem = 10000 2560000 10000 256</span><br><span class="line"></span><br><span class="line"><span class="comment"># ulimit -a</span></span><br><span class="line">core file size          (blocks, -c) 0</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 515045</span><br><span class="line">max locked memory       (kbytes, -l) 64</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 20000500</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 0</span><br><span class="line">stack size              (kbytes, -s) 8192</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 515045</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="编译-PostgreSQL-XL"><a href="#编译-PostgreSQL-XL" class="headerlink" title="编译 PostgreSQL-XL"></a>编译 PostgreSQL-XL</h2><ul>
<li>使用 git clone clone 下载源代码<a target="_blank" rel="noopener" href="http://git.postgresql.org/gitweb/?p=postgres-xl.git;a=summary">postgresql-xl</a>,或者下载源码包.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># curl -O http://files.postgres-xl.org/postgres-xl-9.5r1.4.tar.gz</span></span><br><span class="line"><span class="comment"># tar xvf postgres-xl-9.5r1.4.tar.gz</span></span><br><span class="line"><span class="comment"># cd postgres-xl-9.5r1.4 &amp;&amp; ./configure &amp;&amp; make &amp;&amp; make install</span></span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line">//默认安装在这里</span><br><span class="line"><span class="comment"># ls /usr/local/pgsql/</span></span><br><span class="line">bin  include  lib  share</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="设置-postgres-用户的变量"><a href="#设置-postgres-用户的变量" class="headerlink" title="设置 postgres 用户的变量"></a>设置 postgres 用户的变量</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> .bashrc</span><br><span class="line"><span class="comment"># .bashrc</span></span><br><span class="line"><span class="comment"># User specific aliases and functions</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">rm</span>=<span class="string">&#x27;rm -i&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">cp</span>=<span class="string">&#x27;cp -i&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">mv</span>=<span class="string">&#x27;mv -i&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Source global definitions</span></span><br><span class="line"><span class="keyword">if</span> [ -f /etc/bashrc ]; <span class="keyword">then</span></span><br><span class="line">        . /etc/bashrc</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PGUSER=postgres</span><br><span class="line"><span class="comment"># export PGHOME=/usr/local/pgxl-9.5-stable</span></span><br><span class="line"><span class="built_in">export</span> PGHOME=/usr/local/pgsql</span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$PGHOME</span>/lib:<span class="variable">$LD_LIBRARY_PATH</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$HOME</span>/bin:<span class="variable">$PGHOME</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<h2 id="配置-PostgreSQL-XL"><a href="#配置-PostgreSQL-XL" class="headerlink" title="配置 PostgreSQL-XL"></a>配置 PostgreSQL-XL</h2><ul>
<li>上面的操作配置了一台虚拟机环境并且编译好了<code>Postgresql-XL</code>,现在此基础上克隆 5 台虚拟机出来,并修它们的网卡与主机名</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 确保做好SSH公钥认证登录</span><br><span class="line"><span class="comment"># for name in node01 node02 node03 coord1 gtmnode gtmproxy;  do &gt;     ssh $&#123;name&#125; &quot;echo $&#123;name&#125; &gt; /etc/hostname&quot;;done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># virsh  list</span></span><br><span class="line"> Id    Name                           State</span><br><span class="line">----------------------------------------------------</span><br><span class="line"> 52    pgsql-xl-coord1                 running</span><br><span class="line"> 53    pgsql-xl-gmtnode                running</span><br><span class="line"> 54    pgsql-xl-node01                 running</span><br><span class="line"> 55    pgsql-xl-node02                 running</span><br><span class="line"> 56    pgsql-xl-node03                 running</span><br><span class="line"> 57    pgsql-xl-gtmproxy               running</span><br></pre></td></tr></table></figure>

<ul>
<li>所有虚拟机都修改主机名与 IP,并且可以相互自动登录.现在到<code>gtmnode</code>这台机上的<code>postgres</code>用户下去部署 Postgresql-XL 集群了.</li>
</ul>
<ul>
<li>使用命令<code>pgxc_ctl prepare config minimal</code>,生成默认配置文件.里面配置比较多.这里要相应的修改.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> tree /home/postgres/</span><br><span class="line">/home/postgres/</span><br><span class="line">├── pgxc_ctl</span><br><span class="line">│   ├── coordExtraConfig</span><br><span class="line">│   ├── pgxc_ctl.conf</span><br></pre></td></tr></table></figure>

<ul>
<li>这里根据前面定的虚拟机数量,做了如下修改:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">[postgres@gtmnode ~]$ <span class="built_in">cat</span> pgxc_ctl/pgxc_ctl.conf | grep -v <span class="string">&#x27;^#&#x27;</span> | grep -v <span class="string">&#x27;^$&#x27;</span>                                                                                                                                                                                       [114/1896]</span><br><span class="line">pgxcInstallDir=<span class="variable">$HOME</span>/pgxc</span><br><span class="line">pgxcOwner=<span class="variable">$USER</span>                 <span class="comment"># owner of the Postgres-XC databaseo cluster.  Here, we use this</span></span><br><span class="line">                                                <span class="comment"># both as linus user and database user.  This must be</span></span><br><span class="line">                                                <span class="comment"># the super user of each coordinator and datanode.</span></span><br><span class="line">pgxcUser=<span class="variable">$pgxcOwner</span>             <span class="comment"># OS user of Postgres-XC owner</span></span><br><span class="line">tmpDir=/tmp                                     <span class="comment"># temporary dir used in XC servers</span></span><br><span class="line">localTmpDir=<span class="variable">$tmpDir</span>                     <span class="comment"># temporary dir used here locally</span></span><br><span class="line">configBackup=n                                  <span class="comment"># If you want config file backup, specify y to this value.</span></span><br><span class="line">configBackupHost=pgxc-linker    <span class="comment"># host to backup config file</span></span><br><span class="line">configBackupDir=<span class="variable">$HOME</span>/pgxc              <span class="comment"># Backup directory</span></span><br><span class="line">configBackupFile=pgxc_ctl.bak   <span class="comment"># Backup file name --&gt; Need to synchronize when original changed.</span></span><br><span class="line">gtmMasterServer=192.168.120.20</span><br><span class="line">gtmMasterPort=20001</span><br><span class="line">gtmMasterDir=<span class="variable">$HOME</span>/pgxc/nodes/gtm</span><br><span class="line">gtmExtraConfig=none                     <span class="comment"># Will be added gtm.conf for both Master and Slave (done at initilization only)</span></span><br><span class="line">gtmMasterSpecificExtraConfig=none       <span class="comment"># Will be added to Master&#x27;s gtm.conf (done at initialization only)</span></span><br><span class="line">gtmSlave=n                                      <span class="comment"># Specify y if you configure GTM Slave.   Otherwise, GTM slave will not be configured and</span></span><br><span class="line">                                                        <span class="comment"># all the following variables will be reset.</span></span><br><span class="line">gtmSlaveName=gtmSlave</span><br><span class="line">gtmSlaveServer=node12           <span class="comment"># value none means GTM slave is not available.  Give none if you don&#x27;t configure GTM Slave.</span></span><br><span class="line">gtmSlavePort=20001                      <span class="comment"># Not used if you don&#x27;t configure GTM slave.</span></span><br><span class="line">gtmSlaveDir=<span class="variable">$HOME</span>/pgxc/nodes/gtm        <span class="comment"># Not used if you don&#x27;t configure GTM slave.</span></span><br><span class="line">gtmSlaveSpecificExtraConfig=none <span class="comment"># Will be added to Slave&#x27;s gtm.conf (done at initialization only)</span></span><br><span class="line">gtmProxyDir=<span class="variable">$HOME</span>/pgxc/nodes/gtm_pxy</span><br><span class="line">gtmProxy=n                              <span class="comment"># Specify y if you conifugre at least one GTM proxy.   You may not configure gtm proxies</span></span><br><span class="line">                                                <span class="comment"># only when you dont&#x27; configure GTM slaves.</span></span><br><span class="line">                                                <span class="comment"># If you specify this value not to y, the following parameters will be set to default empty values.</span></span><br><span class="line">                                                <span class="comment"># If we find there&#x27;re no valid Proxy server names (means, every servers are specified</span></span><br><span class="line">                                                <span class="comment"># as none), then gtmProxy value will be set to &quot;n&quot; and all the entries will be set to</span></span><br><span class="line">                                                <span class="comment"># empty values.</span></span><br><span class="line">gtmProxyNames=(gtm_pxy1 gtm_pxy2 gtm_pxy3 gtm_pxy4)     <span class="comment"># No used if it is not configured</span></span><br><span class="line">gtmProxyServers=(node06 node07 node08 node09)                   <span class="comment"># Specify none if you dont&#x27; configure it.</span></span><br><span class="line">gtmProxyPorts=(20001 20001 20001 20001)                         <span class="comment"># Not used if it is not configured.</span></span><br><span class="line">gtmProxyDirs=(<span class="variable">$gtmProxyDir</span> <span class="variable">$gtmProxyDir</span> <span class="variable">$gtmProxyDir</span> <span class="variable">$gtmProxyDir</span>)      <span class="comment"># Not used if it is not configured.</span></span><br><span class="line">gtmPxyExtraConfig=none          <span class="comment"># Extra configuration parameter for gtm_proxy.  Coordinator section has an example.</span></span><br><span class="line">gtmPxySpecificExtraConfig=(none none none none)</span><br><span class="line">coordMasterDir=<span class="variable">$HOME</span>/pgxc/nodes/coord</span><br><span class="line">coordSlaveDir=<span class="variable">$HOME</span>/pgxc/nodes/coord_slave</span><br><span class="line">coordArchLogDir=<span class="variable">$HOME</span>/pgxc/nodes/coord_archlog</span><br><span class="line">coordNames=(coord1 coord2 )             <span class="comment"># Master and slave use the same name</span></span><br><span class="line">coordPorts=(20004 20004 )                       <span class="comment"># Master ports</span></span><br><span class="line">poolerPorts=(6433 6433 )                        <span class="comment"># Master pooler ports</span></span><br><span class="line">coordPgHbaEntries=(192.168.120.0/24)                            <span class="comment"># Assumes that all the coordinator (master/slave) accepts</span></span><br><span class="line">                                                                                                <span class="comment"># the same connection</span></span><br><span class="line">                                                                                                <span class="comment"># This entry allows only $pgxcOwner to connect.</span></span><br><span class="line">                                                                                                <span class="comment"># If you&#x27;d like to setup another connection, you should</span></span><br><span class="line">                                                                                                <span class="comment"># supply these entries through files specified below.</span></span><br><span class="line">coordMasterServers=(coord1 coord2)              <span class="comment"># none means this master is not available</span></span><br><span class="line">coordMasterDirs=(<span class="variable">$coordMasterDir</span> <span class="variable">$coordMasterDir</span> )</span><br><span class="line">coordMaxWALsernder=5    <span class="comment"># max_wal_senders: needed to configure slave. If zero value is specified,</span></span><br><span class="line">                                                <span class="comment"># it is expected to supply this parameter explicitly by external files</span></span><br><span class="line">                                                <span class="comment"># specified in the following.   If you don&#x27;t configure slaves, leave this value to zero.</span></span><br><span class="line">coordMaxWALSenders=(<span class="variable">$coordMaxWALsernder</span> <span class="variable">$coordMaxWALsernder</span> )</span><br><span class="line">                                                <span class="comment"># max_wal_senders configuration for each coordinator.</span></span><br><span class="line">                                                <span class="comment"># postgresql.conf</span></span><br><span class="line"><span class="built_in">cat</span> &gt; <span class="variable">$coordExtraConfig</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">log_destination = &#x27;stderr&#x27;</span></span><br><span class="line"><span class="string">logging_collector = on</span></span><br><span class="line"><span class="string">log_directory = &#x27;pg_log&#x27;</span></span><br><span class="line"><span class="string">listen_addresses = &#x27;*&#x27;</span></span><br><span class="line"><span class="string">max_connections = 100</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">coordSpecificExtraConfig=(none none none none)</span><br><span class="line">coordExtraPgHba=none    <span class="comment"># Extra entry for pg_hba.conf.  This file will be added to all the coordinators&#x27; pg_hba.conf</span></span><br><span class="line">coordSpecificExtraPgHba=(none none none none)</span><br><span class="line">coordAdditionalSlaves=n         <span class="comment"># Additional slave can be specified as follows: where you</span></span><br><span class="line">coordAdditionalSlaveSet=(cad1)          <span class="comment"># Each specifies set of slaves.   This case, two set of slaves are</span></span><br><span class="line">                                                                                        <span class="comment"># configured</span></span><br><span class="line">cad1_Sync=n                             <span class="comment"># All the slaves at &quot;cad1&quot; are connected with asynchronous mode.</span></span><br><span class="line">                                                        <span class="comment"># If not, specify &quot;y&quot;</span></span><br><span class="line">                                                        <span class="comment"># The following lines specifies detailed configuration for each</span></span><br><span class="line">                                                        <span class="comment"># slave tag, cad1.  You can define cad2 similarly.</span></span><br><span class="line">cad1_Servers=(node08 node09 node06 node07)      <span class="comment"># Hosts</span></span><br><span class="line">cad1_dir=<span class="variable">$HOME</span>/pgxc/nodes/coord_slave_cad1</span><br><span class="line">cad1_Dirs=(<span class="variable">$cad1_dir</span> <span class="variable">$cad1_dir</span> <span class="variable">$cad1_dir</span> <span class="variable">$cad1_dir</span>)</span><br><span class="line">cad1_ArchLogDir=<span class="variable">$HOME</span>/pgxc/nodes/coord_archlog_cad1</span><br><span class="line">cad1_ArchLogDirs=(<span class="variable">$cad1_ArchLogDir</span> <span class="variable">$cad1_ArchLogDir</span> <span class="variable">$cad1_ArchLogDir</span> <span class="variable">$cad1_ArchLogDir</span>)</span><br><span class="line">datanodeMasterDir=<span class="variable">$HOME</span>/pgxc/nodes/dn_master</span><br><span class="line">datanodeSlaveDir=<span class="variable">$HOME</span>/pgxc/nodes/dn_slave</span><br><span class="line">datanodeArchLogDir=<span class="variable">$HOME</span>/pgxc/nodes/datanode_archlog</span><br><span class="line">primaryDatanode=node01</span><br><span class="line">datanodeNames=(node01 node02 node03)</span><br><span class="line">datanodePorts=(5432 5432 5432 ) <span class="comment"># Master ports</span></span><br><span class="line">datanodePoolerPorts=(6432 6432 6432 )   <span class="comment"># Master pooler ports</span></span><br><span class="line">datanodePgHbaEntries=(192.168.120.0/24) <span class="comment"># Assumes that all the coordinator (master/slave) accepts</span></span><br><span class="line">                                                                                <span class="comment"># the same connection</span></span><br><span class="line">                                                                                <span class="comment"># This list sets up pg_hba.conf for $pgxcOwner user.</span></span><br><span class="line">                                                                                <span class="comment"># If you&#x27;d like to setup other entries, supply them</span></span><br><span class="line">                                                                                <span class="comment"># through extra configuration files specified below.</span></span><br><span class="line">datanodeMasterServers=(node01 node02 node03)    <span class="comment"># none means this master is not available.</span></span><br><span class="line">                                                                                                        <span class="comment"># This means that there should be the master but is down.</span></span><br><span class="line">                                                                                                        <span class="comment"># The cluster is not operational until the master is</span></span><br><span class="line">                                                                                                        <span class="comment"># recovered and ready to run.</span></span><br><span class="line">datanodeMasterDirs=(<span class="variable">$datanodeMasterDir</span> <span class="variable">$datanodeMasterDir</span> <span class="variable">$datanodeMasterDir</span> )</span><br><span class="line">datanodeMaxWalSender=5                                                          <span class="comment"># max_wal_senders: needed to configure slave. If zero value is</span></span><br><span class="line">                                                                                                        <span class="comment"># specified, it is expected this parameter is explicitly supplied</span></span><br><span class="line">                                                                                                        <span class="comment"># by external configuration files.</span></span><br><span class="line">                                                                                                        <span class="comment"># If you don&#x27;t configure slaves, leave this value zero.</span></span><br><span class="line">datanodeMaxWALSenders=(<span class="variable">$datanodeMaxWalSender</span> <span class="variable">$datanodeMaxWalSender</span> <span class="variable">$datanodeMaxWalSender</span> )</span><br><span class="line">                                                <span class="comment"># max_wal_senders configuration for each datanode</span></span><br><span class="line">datanodeSlave=n                 <span class="comment"># Specify y if you configure at least one coordiantor slave.  Otherwise, the following</span></span><br><span class="line">                                                <span class="comment"># configuration parameters will be set to empty values.</span></span><br><span class="line">                                                <span class="comment"># If no effective server names are found (that is, every servers are specified as none),</span></span><br><span class="line">                                                <span class="comment"># then datanodeSlave value will be set to n and all the following values will be set to</span></span><br><span class="line">                                                <span class="comment"># empty values.</span></span><br><span class="line">datanodeSlaveServers=(node07 node08 node09 node06)      <span class="comment"># value none means this slave is not available</span></span><br><span class="line">datanodeSlavePorts=(20008 20009 20008 20009)    <span class="comment"># value none means this slave is not available</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">datanodeSlavePorts=(20008 20009 20008 20009)    <span class="comment"># value none means this slave is not available</span></span><br><span class="line">datanodeSlavePoolerPorts=(20012 20013 20012 20013)      <span class="comment"># value none means this slave is not available</span></span><br><span class="line">datanodeSlaveSync=y             <span class="comment"># If datanode slave is connected in synchronized mode</span></span><br><span class="line">datanodeSlaveDirs=(<span class="variable">$datanodeSlaveDir</span> <span class="variable">$datanodeSlaveDir</span> <span class="variable">$datanodeSlaveDir</span> <span class="variable">$datanodeSlaveDir</span>)</span><br><span class="line">datanodeArchLogDirs=( <span class="variable">$datanodeArchLogDir</span> <span class="variable">$datanodeArchLogDir</span> <span class="variable">$datanodeArchLogDir</span> <span class="variable">$datanodeArchLogDir</span> )</span><br><span class="line">datanodeExtraConfig=none        <span class="comment"># Extra configuration file for datanodes.  This file will be added to all the</span></span><br><span class="line">                                                        <span class="comment"># datanodes&#x27; postgresql.conf</span></span><br><span class="line">datanodeSpecificExtraConfig=(none none none none)</span><br><span class="line">datanodeExtraPgHba=none         <span class="comment"># Extra entry for pg_hba.conf.  This file will be added to all the datanodes&#x27; postgresql.conf</span></span><br><span class="line">datanodeSpecificExtraPgHba=(none none none none)</span><br><span class="line">datanodeAdditionalSlaves=n      <span class="comment"># Additional slave can be specified as follows: where you</span></span><br><span class="line">                                                                                        <span class="comment"># configured</span></span><br><span class="line">                                                        <span class="comment"># If not, specify &quot;y&quot;</span></span><br><span class="line">                                                        <span class="comment"># The following lines specifies detailed configuration for each</span></span><br><span class="line">                                                        <span class="comment"># slave tag, cad1.  You can define cad2 similarly.</span></span><br><span class="line">walArchive=n    <span class="comment"># If you&#x27;d like to configure WAL archive, edit this section.</span></span><br><span class="line">                                <span class="comment"># Pgxc_ctl assumes that if you configure WAL archive, you configure it</span></span><br><span class="line">                                <span class="comment"># for all the coordinators and datanodes.</span></span><br><span class="line">                                <span class="comment"># Default is &quot;no&quot;.   Please specify &quot;y&quot; here to turn it on.</span></span><br><span class="line">walArchiveSet=(war1 war2)</span><br><span class="line">war1_source=(master)    <span class="comment"># you can specify master, slave or ano other additional slaves as a source of WAL archive.</span></span><br><span class="line">                                        <span class="comment"># Default is the master</span></span><br><span class="line">wal1_source=(slave)</span><br><span class="line">wal1_source=(additiona_coordinator_slave_set additional_datanode_slave_set)</span><br><span class="line">war1_host=node10        <span class="comment"># All the nodes are backed up at the same host for a given archive set</span></span><br><span class="line">war1_backupdir=<span class="variable">$HOME</span>/pgxc/backup_war1</span><br><span class="line">wal2_source=(master)</span><br><span class="line">war2_host=node11</span><br><span class="line">war2_backupdir=<span class="variable">$HOME</span>/pgxc/backup_war2</span><br><span class="line">coordSlave=n</span><br><span class="line">coordNames=( coord1 none  )</span><br><span class="line">coordMasterDirs=( /home/postgres/pgxc/nodes/coord none  )</span><br><span class="line">coordPorts=( 20004 -1  )</span><br><span class="line">poolerPorts=( 6433 -1  )</span><br><span class="line">coordMasterServers=( coord1 none  )</span><br><span class="line">coordMaxWALSenders=( 5 0  )</span><br><span class="line">coordSlaveServers=( none none  )</span><br><span class="line">coordSlavePorts=( none none  )</span><br><span class="line">coordSlavePoolerPorts=( none none  )</span><br><span class="line">coordSlaveDirs=( none none  )</span><br><span class="line">coordArchLogDirs=( none none  )</span><br><span class="line">coordSpecificExtraConfig=( none none none none  )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 这里在pgxc_ctl 命令中中修改的,这里的gtmProxy=y 把前的gtmProxy=n给替换掉了,</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gtmProxy=y</span><br><span class="line">gtmProxyNames=( gtm_pxy  )</span><br><span class="line">gtmProxyServers=( 192.168.120.18  )</span><br><span class="line">gtmProxyPorts=( 20009  )</span><br><span class="line">gtmProxyDirs=( <span class="variable">$HOME</span>/pgxc/nodes/gtm_pxy  )</span><br><span class="line">gtmPxySpecificExtraConfig=( none  )</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>请注意这里面配置的主机名要与机器一一对应上,关闭防火墙,初始化集群.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[postgres@gtmnode ~]$ pgxc_ctl init all</span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[postgres@gtmnode ~]$ pgxc_ctl</span><br><span class="line">/bin/bash</span><br><span class="line">Installing pgxc_ctl_bash script as /home/postgres/pgxc_ctl/pgxc_ctl_bash.</span><br><span class="line">Installing pgxc_ctl_bash script as /home/postgres/pgxc_ctl/pgxc_ctl_bash.</span><br><span class="line">Reading configuration using /home/postgres/pgxc_ctl/pgxc_ctl_bash --home /home/postgres/pgxc_ctl --configuration /home/postgres/pgxc_ctl/pgxc_ctl.conf</span><br><span class="line">Finished reading configuration.</span><br><span class="line">   ******** PGXC_CTL START ***************</span><br><span class="line"></span><br><span class="line">Current directory: /home/postgres/pgxc_ctl</span><br><span class="line">PGXC <span class="built_in">help</span></span><br><span class="line">You are using pgxc_ctl, the configuration utility <span class="keyword">for</span> PGXL</span><br><span class="line">Type:</span><br><span class="line">        <span class="built_in">help</span> &lt;<span class="built_in">command</span>&gt;</span><br><span class="line">        <span class="built_in">where</span> &lt;<span class="built_in">command</span>&gt; is either add, Createdb, Createuser, clean,</span><br><span class="line">                configure, deploy, failover, init, <span class="built_in">kill</span>, <span class="built_in">log</span>, monitor,</span><br><span class="line">                prepare, q, reconnect, remove, <span class="built_in">set</span>, show, start,</span><br><span class="line">                stop or unregister</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="调优数据库"><a href="#调优数据库" class="headerlink" title="调优数据库"></a>调优数据库</h2><ul>
<li>这里是参考<a target="_blank" rel="noopener" href="http://www.wanghengbin.com/2016/07/04/postgres-xl-presstest-optimize/">Postgres XL 压力测试与性能调优</a>做的调整</li>
</ul>
<ul>
<li>Coordinator 节点的 postgresql.conf</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">max_connections = 200          <span class="comment"># 允许的最大并发连接数</span></span><br><span class="line">max_prepared_transactions = 200       <span class="comment"># 允许的最大预提交事务数，与更新操作相关</span></span><br><span class="line">shared_buffers = 8GB            <span class="comment"># 用于缓存数据的内存（推荐内存的1/4)</span></span><br><span class="line">temp_buffers = 80MB</span><br><span class="line">work_mem = 100MB                <span class="comment"># 用于内部排序和一些复杂的查询的内存</span></span><br><span class="line">dynamic_shared_memory_type = posix</span><br><span class="line">max_files_per_process = 2000</span><br><span class="line">effective_io_concurrency = 8</span><br><span class="line">max_worker_processes = 64</span><br><span class="line">effective_cache_size = 8GB</span><br><span class="line">max_pool_size = 1600            <span class="comment"># Coordinator与Datanode之间的连接池的最大连接数</span></span><br><span class="line">pool_conn_keepalive = 600</span><br><span class="line">persistent_datanode_connections = on</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>Datanode 节点 postgresql.conf</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">max_connections = 1600</span><br><span class="line">shared_buffers = 8GB</span><br><span class="line">temp_buffers = 80MB</span><br><span class="line">dynamic_shared_memory_type = posix</span><br><span class="line">effective_io_concurrency = 8</span><br><span class="line">max_worker_processes = 32</span><br><span class="line">random_page_cost = 1.5</span><br><span class="line">effective_cache_size = 24GB</span><br><span class="line">max_prepared_transactions = 100</span><br><span class="line">persistent_datanode_connections = on</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>GtmProxy 节点 gtm_pxy.conf</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">worker_threads = 2</span><br><span class="line">keepalives_idle = 120</span><br><span class="line">keepalives_interval = 30</span><br><span class="line">keepalives_count = 2</span><br></pre></td></tr></table></figure>

<p>Gtm 节点 gtm.conf</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">keepalives_idle = 120</span><br><span class="line">keepalives_interval = 30</span><br><span class="line">keepalives_count = 50</span><br></pre></td></tr></table></figure>

<h3 id="安装-Pgbouncer-连接池"><a href="#安装-Pgbouncer-连接池" class="headerlink" title="安装 Pgbouncer 连接池"></a>安装 Pgbouncer 连接池</h3><ul>
<li><p>pgbouncer 是 PostgreSQL 的一个轻量级连接池，可以给客户端提供一个统一的视图.</p>
</li>
<li><p>pgbouncer 的作用:<br>a)pgbouncer 可以在后端数据库和前端应用间简历连接的桥梁，由 pgbouncer 去处理和后端的连接关系.<br>b)对客户端的连接进行限制，防止过多的恶意连接.</p>
</li>
<li><p>pgbouncer 的特点：<br>a)内存消耗低.（默认 2k&#x2F;连接）<br>b)可以把不同的数据库连接到一个机器上，而对客户端保持透明.<br>c)支持在线的重行配置而无需重启.</p>
</li>
</ul>
<hr>
<h3 id="谢谢支持"><a href="#谢谢支持" class="headerlink" title="谢谢支持"></a>谢谢支持</h3><ul>
<li>微信二维码:</li>
</ul>
<img src=/imgs/mm_reward_qrcode_1525013906055.png width=40% height=40% align=center/>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Postgresql/" rel="tag"># Postgresql</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2016/12/21/%E5%B7%A5%E4%BD%9C%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9BBash-shell%E6%B5%8B%E8%AF%95%E8%84%9A%E6%9C%AC/" rel="prev" title="工作中的一些Bash shell测试脚本">
      <i class="fa fa-chevron-left"></i> 工作中的一些Bash shell测试脚本
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/01/08/Qt%E7%9A%84%E4%B8%80%E4%BA%9B%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/" rel="next" title="Qt的一些开发技巧">
      Qt的一些开发技巧 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E4%B8%BB%E6%9C%BA%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.</span> <span class="nav-text">安装主机系统</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%9F%BA%E7%A1%80%E7%B3%BB%E7%BB%9F"><span class="nav-number">2.</span> <span class="nav-text">安装基础系统</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%9F%BA%E7%A1%80%E7%B3%BB%E7%BB%9F"><span class="nav-number">3.</span> <span class="nav-text">配置基础系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E8%AF%91-PostgreSQL-XL"><span class="nav-number">3.1.</span> <span class="nav-text">编译 PostgreSQL-XL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE-postgres-%E7%94%A8%E6%88%B7%E7%9A%84%E5%8F%98%E9%87%8F"><span class="nav-number">3.2.</span> <span class="nav-text">设置 postgres 用户的变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-PostgreSQL-XL"><span class="nav-number">3.3.</span> <span class="nav-text">配置 PostgreSQL-XL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E4%BC%98%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">3.4.</span> <span class="nav-text">调优数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Pgbouncer-%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="nav-number">3.4.1.</span> <span class="nav-text">安装 Pgbouncer 连接池</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%A2%E8%B0%A2%E6%94%AF%E6%8C%81"><span class="nav-number">3.4.2.</span> <span class="nav-text">谢谢支持</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yjdwbj"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">yjdwbj</p>
  <div class="site-description" itemprop="description">最是人间留不住,朱颜辞镜花辞树</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">53</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yjdwbj</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
